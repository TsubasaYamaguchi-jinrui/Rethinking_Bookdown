<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>6 The Haunted DAG &amp; the Causal Terror | Statistical Rethinking Second Edition</title>
  <meta name="description" content="6 The Haunted DAG &amp; the Causal Terror | Statistical Rethinking Second Edition" />
  <meta name="generator" content="bookdown 0.31 and GitBook 2.6.7" />

  <meta property="og:title" content="6 The Haunted DAG &amp; the Causal Terror | Statistical Rethinking Second Edition" />
  <meta property="og:type" content="book" />
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="6 The Haunted DAG &amp; the Causal Terror | Statistical Rethinking Second Edition" />
  
  
  

<meta name="author" content="Tsubasa Yamaguchi" />


<meta name="date" content="2023-02-01" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="the-many-variables-the-spurious-waffles.html"/>
<link rel="next" href="ulysses-compass.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<script src="libs/htmlwidgets-1.6.1/htmlwidgets.js"></script>
<link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet" />
<script src="libs/datatables-binding-0.27/datatables.js"></script>
<link href="libs/dt-core-1.12.1/css/jquery.dataTables.min.css" rel="stylesheet" />
<link href="libs/dt-core-1.12.1/css/jquery.dataTables.extra.css" rel="stylesheet" />
<script src="libs/dt-core-1.12.1/js/jquery.dataTables.min.js"></script>
<link href="libs/crosstalk-1.2.0/css/crosstalk.min.css" rel="stylesheet" />
<script src="libs/crosstalk-1.2.0/js/crosstalk.min.js"></script>
<link href="libs/tabwid-1.1.2/tabwid.css" rel="stylesheet" />
<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="custom_style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>本稿の目的</a></li>
<li class="chapter" data-level="" data-path="パッケージの読み込み.html"><a href="パッケージの読み込み.html"><i class="fa fa-check"></i>パッケージの読み込み</a></li>
<li class="chapter" data-level="1" data-path="the-golem-of-prague.html"><a href="the-golem-of-prague.html"><i class="fa fa-check"></i><b>1</b> The Golem of Prague 　</a></li>
<li class="chapter" data-level="2" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html"><i class="fa fa-check"></i><b>2</b> Small Worlds and Large Worlds</a>
<ul>
<li class="chapter" data-level="2.1" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#byesian-updating"><i class="fa fa-check"></i><b>2.1</b> Byesian Updating</a></li>
<li class="chapter" data-level="2.2" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#making-th-model"><i class="fa fa-check"></i><b>2.2</b> Making th model</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#grid-approximation"><i class="fa fa-check"></i><b>2.2.1</b> Grid approximation</a></li>
<li class="chapter" data-level="2.2.2" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#quadratic-approximation"><i class="fa fa-check"></i><b>2.2.2</b> Quadratic approximation</a></li>
<li class="chapter" data-level="2.2.3" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#mcmc"><i class="fa fa-check"></i><b>2.2.3</b> MCMC</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#practice"><i class="fa fa-check"></i><b>2.3</b> Practice</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#m1"><i class="fa fa-check"></i><b>2.3.1</b> 2M1</a></li>
<li class="chapter" data-level="2.3.2" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#m2"><i class="fa fa-check"></i><b>2.3.2</b> 2M2</a></li>
<li class="chapter" data-level="2.3.3" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#m3"><i class="fa fa-check"></i><b>2.3.3</b> 2M3</a></li>
<li class="chapter" data-level="2.3.4" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#m4"><i class="fa fa-check"></i><b>2.3.4</b> 2M4</a></li>
<li class="chapter" data-level="2.3.5" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#m5"><i class="fa fa-check"></i><b>2.3.5</b> 2M5</a></li>
<li class="chapter" data-level="2.3.6" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#m7"><i class="fa fa-check"></i><b>2.3.6</b> 2M7</a></li>
<li class="chapter" data-level="2.3.7" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#h1"><i class="fa fa-check"></i><b>2.3.7</b> 2H1</a></li>
<li class="chapter" data-level="2.3.8" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#h2"><i class="fa fa-check"></i><b>2.3.8</b> 2H2</a></li>
<li class="chapter" data-level="2.3.9" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#h3"><i class="fa fa-check"></i><b>2.3.9</b> 2H3</a></li>
<li class="chapter" data-level="2.3.10" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#h4"><i class="fa fa-check"></i><b>2.3.10</b> 2H4</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html"><i class="fa fa-check"></i><b>3</b> Sampling the Imaginary</a>
<ul>
<li class="chapter" data-level="3.1" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#sampling-from-a-grid-aproximate-posterior"><i class="fa fa-check"></i><b>3.1</b> Sampling from a grid-aproximate posterior</a></li>
<li class="chapter" data-level="3.2" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#sampling-to-summarize"><i class="fa fa-check"></i><b>3.2</b> Sampling to summarize</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#intervals-of-defined-mass"><i class="fa fa-check"></i><b>3.2.1</b> Intervals of defined mass</a></li>
<li class="chapter" data-level="3.2.2" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#highly-skewed-example"><i class="fa fa-check"></i><b>3.2.2</b> highly skewed example</a></li>
<li class="chapter" data-level="3.2.3" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#point-estimate"><i class="fa fa-check"></i><b>3.2.3</b> Point estimate　　</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#sampling-to-simulate-prediction"><i class="fa fa-check"></i><b>3.3</b> Sampling to simulate prediction</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#model-checking"><i class="fa fa-check"></i><b>3.3.1</b> Model checking</a></li>
<li class="chapter" data-level="3.3.2" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#practice-with-brms"><i class="fa fa-check"></i><b>3.3.2</b> Practice with brms</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#practice-1"><i class="fa fa-check"></i><b>3.4</b> Practice</a>
<ul>
<li class="chapter" data-level="3.4.1" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#e"><i class="fa fa-check"></i><b>3.4.1</b> 3E</a></li>
<li class="chapter" data-level="3.4.2" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#m"><i class="fa fa-check"></i><b>3.4.2</b> 3M</a></li>
<li class="chapter" data-level="3.4.3" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#h"><i class="fa fa-check"></i><b>3.4.3</b> 3H</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="geocentric-model.html"><a href="geocentric-model.html"><i class="fa fa-check"></i><b>4</b> Geocentric Model</a>
<ul>
<li class="chapter" data-level="4.1" data-path="geocentric-model.html"><a href="geocentric-model.html#why-normal-distributions-are-normal"><i class="fa fa-check"></i><b>4.1</b> Why normal distributions are normal</a></li>
<li class="chapter" data-level="4.2" data-path="geocentric-model.html"><a href="geocentric-model.html#normal-by-multiplication"><i class="fa fa-check"></i><b>4.2</b> Normal by multiplication</a></li>
<li class="chapter" data-level="4.3" data-path="geocentric-model.html"><a href="geocentric-model.html#gaussian-model-of-height"><i class="fa fa-check"></i><b>4.3</b> Gaussian model of height</a></li>
<li class="chapter" data-level="4.4" data-path="geocentric-model.html"><a href="geocentric-model.html#grid-approximationで事後分布を描く"><i class="fa fa-check"></i><b>4.4</b> Grid approximationで事後分布を描く</a>
<ul>
<li class="chapter" data-level="4.4.1" data-path="geocentric-model.html"><a href="geocentric-model.html#事後分布からサンプリングする"><i class="fa fa-check"></i><b>4.4.1</b> 事後分布からサンプリングする</a></li>
<li class="chapter" data-level="4.4.2" data-path="geocentric-model.html"><a href="geocentric-model.html#rethinking"><i class="fa fa-check"></i><b>4.4.2</b> rethinking</a></li>
<li class="chapter" data-level="4.4.3" data-path="geocentric-model.html"><a href="geocentric-model.html#finding-posterior-with-brms"><i class="fa fa-check"></i><b>4.4.3</b> Finding posterior with brms</a></li>
<li class="chapter" data-level="4.4.4" data-path="geocentric-model.html"><a href="geocentric-model.html#事後分布からのサンプリング"><i class="fa fa-check"></i><b>4.4.4</b> 事後分布からのサンプリング</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="geocentric-model.html"><a href="geocentric-model.html#linear-prediction"><i class="fa fa-check"></i><b>4.5</b> Linear prediction</a>
<ul>
<li class="chapter" data-level="4.5.1" data-path="geocentric-model.html"><a href="geocentric-model.html#finding-the-posterior-distribution"><i class="fa fa-check"></i><b>4.5.1</b> Finding the posterior distribution</a></li>
<li class="chapter" data-level="4.5.2" data-path="geocentric-model.html"><a href="geocentric-model.html#plotting-posterior-inference-agaist-the-data"><i class="fa fa-check"></i><b>4.5.2</b> Plotting posterior inference agaist the data</a></li>
<li class="chapter" data-level="4.5.3" data-path="geocentric-model.html"><a href="geocentric-model.html#plotting-regression-intervals-and-contours"><i class="fa fa-check"></i><b>4.5.3</b> Plotting regression intervals and contours</a></li>
<li class="chapter" data-level="4.5.4" data-path="geocentric-model.html"><a href="geocentric-model.html#prediction-intervals"><i class="fa fa-check"></i><b>4.5.4</b> Prediction intervals</a></li>
</ul></li>
<li class="chapter" data-level="4.6" data-path="geocentric-model.html"><a href="geocentric-model.html#curves-from-lines"><i class="fa fa-check"></i><b>4.6</b> Curves from lines</a>
<ul>
<li class="chapter" data-level="4.6.1" data-path="geocentric-model.html"><a href="geocentric-model.html#polynomial-regression"><i class="fa fa-check"></i><b>4.6.1</b> Polynomial regression</a></li>
<li class="chapter" data-level="4.6.2" data-path="geocentric-model.html"><a href="geocentric-model.html#overthinking"><i class="fa fa-check"></i><b>4.6.2</b> overthinking</a></li>
<li class="chapter" data-level="4.6.3" data-path="geocentric-model.html"><a href="geocentric-model.html#splines"><i class="fa fa-check"></i><b>4.6.3</b> Splines</a></li>
</ul></li>
<li class="chapter" data-level="4.7" data-path="geocentric-model.html"><a href="geocentric-model.html#practice-2"><i class="fa fa-check"></i><b>4.7</b> Practice</a>
<ul>
<li class="chapter" data-level="4.7.1" data-path="geocentric-model.html"><a href="geocentric-model.html#m1-2"><i class="fa fa-check"></i><b>4.7.1</b> 4M1</a></li>
<li class="chapter" data-level="4.7.2" data-path="geocentric-model.html"><a href="geocentric-model.html#m2-2"><i class="fa fa-check"></i><b>4.7.2</b> 4M2</a></li>
<li class="chapter" data-level="4.7.3" data-path="geocentric-model.html"><a href="geocentric-model.html#m4-2"><i class="fa fa-check"></i><b>4.7.3</b> 4M4</a></li>
<li class="chapter" data-level="4.7.4" data-path="geocentric-model.html"><a href="geocentric-model.html#m5-2"><i class="fa fa-check"></i><b>4.7.4</b> 4M5</a></li>
<li class="chapter" data-level="4.7.5" data-path="geocentric-model.html"><a href="geocentric-model.html#m6-1"><i class="fa fa-check"></i><b>4.7.5</b> 4M6</a></li>
<li class="chapter" data-level="4.7.6" data-path="geocentric-model.html"><a href="geocentric-model.html#m7-1"><i class="fa fa-check"></i><b>4.7.6</b> 4M7</a></li>
<li class="chapter" data-level="4.7.7" data-path="geocentric-model.html"><a href="geocentric-model.html#m8"><i class="fa fa-check"></i><b>4.7.7</b> 4M8</a></li>
<li class="chapter" data-level="4.7.8" data-path="geocentric-model.html"><a href="geocentric-model.html#h1-2"><i class="fa fa-check"></i><b>4.7.8</b> 4H1</a></li>
<li class="chapter" data-level="4.7.9" data-path="geocentric-model.html"><a href="geocentric-model.html#h2-2"><i class="fa fa-check"></i><b>4.7.9</b> 4H2</a></li>
<li class="chapter" data-level="4.7.10" data-path="geocentric-model.html"><a href="geocentric-model.html#h3-2"><i class="fa fa-check"></i><b>4.7.10</b> 4H3</a></li>
<li class="chapter" data-level="4.7.11" data-path="geocentric-model.html"><a href="geocentric-model.html#h4-2"><i class="fa fa-check"></i><b>4.7.11</b> 4H4</a></li>
<li class="chapter" data-level="4.7.12" data-path="geocentric-model.html"><a href="geocentric-model.html#h5-1"><i class="fa fa-check"></i><b>4.7.12</b> 4H5</a></li>
<li class="chapter" data-level="4.7.13" data-path="geocentric-model.html"><a href="geocentric-model.html#h6"><i class="fa fa-check"></i><b>4.7.13</b> 4H6</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html"><i class="fa fa-check"></i><b>5</b> The many variables &amp; the spurious waffles</a>
<ul>
<li class="chapter" data-level="5.1" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#spurious-association"><i class="fa fa-check"></i><b>5.1</b> Spurious association</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#グラフを用いて因果モデルを考える"><i class="fa fa-check"></i><b>5.1.1</b> グラフを用いて因果モデルを考える</a></li>
<li class="chapter" data-level="5.1.2" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#predictor-residual-plots"><i class="fa fa-check"></i><b>5.1.2</b> Predictor residual plots</a></li>
<li class="chapter" data-level="5.1.3" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#posterior-prediction-plots"><i class="fa fa-check"></i><b>5.1.3</b> Posterior prediction plots</a></li>
<li class="chapter" data-level="5.1.4" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#counterfactual-plot"><i class="fa fa-check"></i><b>5.1.4</b> Counterfactual plot</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#masked-relationship"><i class="fa fa-check"></i><b>5.2</b> Masked relationship</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#k-nモデル"><i class="fa fa-check"></i><b>5.2.1</b> K ~ Nモデル</a></li>
<li class="chapter" data-level="5.2.2" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#k-mモデル"><i class="fa fa-check"></i><b>5.2.2</b> K ~ Mモデル</a></li>
<li class="chapter" data-level="5.2.3" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#k-n-mモデル"><i class="fa fa-check"></i><b>5.2.3</b> K ~ N + Mモデル</a></li>
<li class="chapter" data-level="5.2.4" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#counterfactual-plot-を描く"><i class="fa fa-check"></i><b>5.2.4</b> Counterfactual plot を描く</a></li>
<li class="chapter" data-level="5.2.5" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#overthinking-1"><i class="fa fa-check"></i><b>5.2.5</b> Overthinking</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#categorical-variables"><i class="fa fa-check"></i><b>5.3</b> Categorical variables</a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#two-categories"><i class="fa fa-check"></i><b>5.3.1</b> Two categories</a></li>
<li class="chapter" data-level="5.3.2" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#many-categories"><i class="fa fa-check"></i><b>5.3.2</b> Many Categories</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#practice-3"><i class="fa fa-check"></i><b>5.4</b> Practice</a>
<ul>
<li class="chapter" data-level="5.4.1" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#m1-3"><i class="fa fa-check"></i><b>5.4.1</b> 5M1</a></li>
<li class="chapter" data-level="5.4.2" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#m2-3"><i class="fa fa-check"></i><b>5.4.2</b> 5M2</a></li>
<li class="chapter" data-level="5.4.3" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#m4-3"><i class="fa fa-check"></i><b>5.4.3</b> 5M4</a></li>
<li class="chapter" data-level="5.4.4" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#h1-3"><i class="fa fa-check"></i><b>5.4.4</b> 5H1</a></li>
<li class="chapter" data-level="5.4.5" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#h2-3"><i class="fa fa-check"></i><b>5.4.5</b> 5H2</a></li>
<li class="chapter" data-level="5.4.6" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#h3-3"><i class="fa fa-check"></i><b>5.4.6</b> 5H3</a></li>
<li class="chapter" data-level="5.4.7" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#h4-3"><i class="fa fa-check"></i><b>5.4.7</b> 5H4</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html"><i class="fa fa-check"></i><b>6</b> The Haunted DAG &amp; the Causal Terror</a>
<ul>
<li class="chapter" data-level="6.1" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#multicollinearity"><i class="fa fa-check"></i><b>6.1</b> Multicollinearity</a>
<ul>
<li class="chapter" data-level="6.1.1" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#multicollinear-milk"><i class="fa fa-check"></i><b>6.1.1</b> Multicollinear milk</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#post-treatment-bias"><i class="fa fa-check"></i><b>6.2</b> Post-treatment bias</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#blocked-by-consequence"><i class="fa fa-check"></i><b>6.2.1</b> Blocked by consequence</a></li>
<li class="chapter" data-level="6.2.2" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#fungus-and-d-separation"><i class="fa fa-check"></i><b>6.2.2</b> Fungus and d-separation</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#collider-bias"><i class="fa fa-check"></i><b>6.3</b> Collider bias</a>
<ul>
<li class="chapter" data-level="6.3.1" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#collider-of-false-sorrow"><i class="fa fa-check"></i><b>6.3.1</b> Collider of false sorrow</a></li>
<li class="chapter" data-level="6.3.2" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#the-haunted-dag"><i class="fa fa-check"></i><b>6.3.2</b> The haunted DAG</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#confronting-confoundings"><i class="fa fa-check"></i><b>6.4</b> Confronting confoundings</a>
<ul>
<li class="chapter" data-level="6.4.1" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#two-roads"><i class="fa fa-check"></i><b>6.4.1</b> Two roads</a></li>
<li class="chapter" data-level="6.4.2" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#backdoor-waffles"><i class="fa fa-check"></i><b>6.4.2</b> Backdoor Waffles</a></li>
</ul></li>
<li class="chapter" data-level="6.5" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#practice-4"><i class="fa fa-check"></i><b>6.5</b> Practice</a>
<ul>
<li class="chapter" data-level="6.5.1" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#m1-4"><i class="fa fa-check"></i><b>6.5.1</b> 6M1</a></li>
<li class="chapter" data-level="6.5.2" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#m2-4"><i class="fa fa-check"></i><b>6.5.2</b> 6M2</a></li>
<li class="chapter" data-level="6.5.3" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#h1-4"><i class="fa fa-check"></i><b>6.5.3</b> 6H1</a></li>
<li class="chapter" data-level="6.5.4" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#h2-4"><i class="fa fa-check"></i><b>6.5.4</b> 6H2</a></li>
<li class="chapter" data-level="6.5.5" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#h3-4"><i class="fa fa-check"></i><b>6.5.5</b> 6H3</a></li>
<li class="chapter" data-level="6.5.6" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#h4-4"><i class="fa fa-check"></i><b>6.5.6</b> 6H4</a></li>
<li class="chapter" data-level="6.5.7" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#h5-2"><i class="fa fa-check"></i><b>6.5.7</b> 6H5</a></li>
</ul></li>
<li class="chapter" data-level="6.6" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#おまけ-ランダム効果を入れてみる"><i class="fa fa-check"></i><b>6.6</b> おまけ　ランダム効果を入れてみる</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="ulysses-compass.html"><a href="ulysses-compass.html"><i class="fa fa-check"></i><b>7</b> Ulysses’ Compass</a>
<ul>
<li class="chapter" data-level="7.1" data-path="ulysses-compass.html"><a href="ulysses-compass.html#the-problems-with-parameters"><i class="fa fa-check"></i><b>7.1</b> The problems with parameters</a>
<ul>
<li class="chapter" data-level="7.1.1" data-path="ulysses-compass.html"><a href="ulysses-compass.html#more-parameters-always-improve-fit"><i class="fa fa-check"></i><b>7.1.1</b> More parameters always improve fit</a></li>
<li class="chapter" data-level="7.1.2" data-path="ulysses-compass.html"><a href="ulysses-compass.html#too-few-parameters-hurts-too"><i class="fa fa-check"></i><b>7.1.2</b> Too few parameters hurts too</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="ulysses-compass.html"><a href="ulysses-compass.html#entropy-and-accuracy"><i class="fa fa-check"></i><b>7.2</b> Entropy and accuracy</a>
<ul>
<li class="chapter" data-level="7.2.1" data-path="ulysses-compass.html"><a href="ulysses-compass.html#information-and-uncertainty"><i class="fa fa-check"></i><b>7.2.1</b> Information and uncertainty</a></li>
<li class="chapter" data-level="7.2.2" data-path="ulysses-compass.html"><a href="ulysses-compass.html#from-entropy-to-acculacy"><i class="fa fa-check"></i><b>7.2.2</b> From entropy to acculacy</a></li>
<li class="chapter" data-level="7.2.3" data-path="ulysses-compass.html"><a href="ulysses-compass.html#estimating-divergence"><i class="fa fa-check"></i><b>7.2.3</b> Estimating divergence</a></li>
<li class="chapter" data-level="7.2.4" data-path="ulysses-compass.html"><a href="ulysses-compass.html#scoring-the-right-data"><i class="fa fa-check"></i><b>7.2.4</b> Scoring the right data</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="ulysses-compass.html"><a href="ulysses-compass.html#golem-taming-regularization"><i class="fa fa-check"></i><b>7.3</b> Golem taming: regularization</a></li>
<li class="chapter" data-level="7.4" data-path="ulysses-compass.html"><a href="ulysses-compass.html#predicting-predictive-accuracy"><i class="fa fa-check"></i><b>7.4</b> Predicting predictive accuracy</a>
<ul>
<li class="chapter" data-level="7.4.1" data-path="ulysses-compass.html"><a href="ulysses-compass.html#cross-validation"><i class="fa fa-check"></i><b>7.4.1</b> Cross validation</a></li>
<li class="chapter" data-level="7.4.2" data-path="ulysses-compass.html"><a href="ulysses-compass.html#information-criteria"><i class="fa fa-check"></i><b>7.4.2</b> Information criteria</a></li>
<li class="chapter" data-level="7.4.3" data-path="ulysses-compass.html"><a href="ulysses-compass.html#overthinking-waic-calculation"><i class="fa fa-check"></i><b>7.4.3</b> overthinking: WAIC calculation</a></li>
<li class="chapter" data-level="7.4.4" data-path="ulysses-compass.html"><a href="ulysses-compass.html#comparing-cv-psis-and-waic"><i class="fa fa-check"></i><b>7.4.4</b> Comparing CV, PSIS, and WAIC</a></li>
</ul></li>
<li class="chapter" data-level="7.5" data-path="ulysses-compass.html"><a href="ulysses-compass.html#model-comparison"><i class="fa fa-check"></i><b>7.5</b> Model comparison</a>
<ul>
<li class="chapter" data-level="7.5.1" data-path="ulysses-compass.html"><a href="ulysses-compass.html#model-mis-selection"><i class="fa fa-check"></i><b>7.5.1</b> Model mis-selection</a></li>
<li class="chapter" data-level="7.5.2" data-path="ulysses-compass.html"><a href="ulysses-compass.html#outlier-and-other-illusions"><i class="fa fa-check"></i><b>7.5.2</b> Outlier and other illusions</a></li>
</ul></li>
<li class="chapter" data-level="7.6" data-path="ulysses-compass.html"><a href="ulysses-compass.html#practice-5"><i class="fa fa-check"></i><b>7.6</b> Practice</a>
<ul>
<li class="chapter" data-level="7.6.1" data-path="ulysses-compass.html"><a href="ulysses-compass.html#e2"><i class="fa fa-check"></i><b>7.6.1</b> 7E2</a></li>
<li class="chapter" data-level="7.6.2" data-path="ulysses-compass.html"><a href="ulysses-compass.html#e3"><i class="fa fa-check"></i><b>7.6.2</b> 7E3</a></li>
<li class="chapter" data-level="7.6.3" data-path="ulysses-compass.html"><a href="ulysses-compass.html#e4"><i class="fa fa-check"></i><b>7.6.3</b> 7E4</a></li>
<li class="chapter" data-level="7.6.4" data-path="ulysses-compass.html"><a href="ulysses-compass.html#m4-4"><i class="fa fa-check"></i><b>7.6.4</b> 7M4</a></li>
<li class="chapter" data-level="7.6.5" data-path="ulysses-compass.html"><a href="ulysses-compass.html#h1-5"><i class="fa fa-check"></i><b>7.6.5</b> 7H1</a></li>
<li class="chapter" data-level="7.6.6" data-path="ulysses-compass.html"><a href="ulysses-compass.html#h2-5"><i class="fa fa-check"></i><b>7.6.6</b> 7H2</a></li>
<li class="chapter" data-level="7.6.7" data-path="ulysses-compass.html"><a href="ulysses-compass.html#h3-5"><i class="fa fa-check"></i><b>7.6.7</b> 7H3</a></li>
<li class="chapter" data-level="7.6.8" data-path="ulysses-compass.html"><a href="ulysses-compass.html#h4-5"><i class="fa fa-check"></i><b>7.6.8</b> 7H4</a></li>
<li class="chapter" data-level="7.6.9" data-path="ulysses-compass.html"><a href="ulysses-compass.html#h5-3"><i class="fa fa-check"></i><b>7.6.9</b> 7H5</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="conditional-manatees.html"><a href="conditional-manatees.html"><i class="fa fa-check"></i><b>8</b> Conditional Manatees</a>
<ul>
<li class="chapter" data-level="8.1" data-path="conditional-manatees.html"><a href="conditional-manatees.html#building-an-interaction"><i class="fa fa-check"></i><b>8.1</b> Building an interaction</a>
<ul>
<li class="chapter" data-level="8.1.1" data-path="conditional-manatees.html"><a href="conditional-manatees.html#making-a-rugged-model"><i class="fa fa-check"></i><b>8.1.1</b> Making a rugged model</a></li>
<li class="chapter" data-level="8.1.2" data-path="conditional-manatees.html"><a href="conditional-manatees.html#adding-an-indicator-variable-isnt-enough"><i class="fa fa-check"></i><b>8.1.2</b> Adding an indicator variable isn’t enough</a></li>
<li class="chapter" data-level="8.1.3" data-path="conditional-manatees.html"><a href="conditional-manatees.html#adding-interaction-does-work"><i class="fa fa-check"></i><b>8.1.3</b> Adding interaction does work</a></li>
<li class="chapter" data-level="8.1.4" data-path="conditional-manatees.html"><a href="conditional-manatees.html#plotting-the-interaction"><i class="fa fa-check"></i><b>8.1.4</b> Plotting the interaction</a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="conditional-manatees.html"><a href="conditional-manatees.html#symmetry-of-interaction"><i class="fa fa-check"></i><b>8.2</b> Symmetry of interaction</a></li>
<li class="chapter" data-level="8.3" data-path="conditional-manatees.html"><a href="conditional-manatees.html#continuous-interaction"><i class="fa fa-check"></i><b>8.3</b> Continuous interaction</a>
<ul>
<li class="chapter" data-level="8.3.1" data-path="conditional-manatees.html"><a href="conditional-manatees.html#a-winter-flower"><i class="fa fa-check"></i><b>8.3.1</b> A winter flower</a></li>
<li class="chapter" data-level="8.3.2" data-path="conditional-manatees.html"><a href="conditional-manatees.html#the-models"><i class="fa fa-check"></i><b>8.3.2</b> The models</a></li>
<li class="chapter" data-level="8.3.3" data-path="conditional-manatees.html"><a href="conditional-manatees.html#plotting-posterior-predictions"><i class="fa fa-check"></i><b>8.3.3</b> Plotting posterior predictions</a></li>
<li class="chapter" data-level="8.3.4" data-path="conditional-manatees.html"><a href="conditional-manatees.html#plotting-prior-predictions"><i class="fa fa-check"></i><b>8.3.4</b> Plotting prior predictions</a></li>
</ul></li>
<li class="chapter" data-level="8.4" data-path="conditional-manatees.html"><a href="conditional-manatees.html#practice-6"><i class="fa fa-check"></i><b>8.4</b> Practice</a>
<ul>
<li class="chapter" data-level="8.4.1" data-path="conditional-manatees.html"><a href="conditional-manatees.html#m4-5"><i class="fa fa-check"></i><b>8.4.1</b> 8M4</a></li>
<li class="chapter" data-level="8.4.2" data-path="conditional-manatees.html"><a href="conditional-manatees.html#h1-6"><i class="fa fa-check"></i><b>8.4.2</b> 8H1</a></li>
<li class="chapter" data-level="8.4.3" data-path="conditional-manatees.html"><a href="conditional-manatees.html#h2-6"><i class="fa fa-check"></i><b>8.4.3</b> 8H2</a></li>
<li class="chapter" data-level="8.4.4" data-path="conditional-manatees.html"><a href="conditional-manatees.html#h3-6"><i class="fa fa-check"></i><b>8.4.4</b> 8H3</a></li>
<li class="chapter" data-level="8.4.5" data-path="conditional-manatees.html"><a href="conditional-manatees.html#h4-6"><i class="fa fa-check"></i><b>8.4.5</b> 8H4</a></li>
<li class="chapter" data-level="8.4.6" data-path="conditional-manatees.html"><a href="conditional-manatees.html#h5-4"><i class="fa fa-check"></i><b>8.4.6</b> 8H5</a></li>
<li class="chapter" data-level="8.4.7" data-path="conditional-manatees.html"><a href="conditional-manatees.html#h6-1"><i class="fa fa-check"></i><b>8.4.7</b> 8H6</a></li>
<li class="chapter" data-level="8.4.8" data-path="conditional-manatees.html"><a href="conditional-manatees.html#h7"><i class="fa fa-check"></i><b>8.4.8</b> 8H7</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="9" data-path="marcov-chain-monte-carlo.html"><a href="marcov-chain-monte-carlo.html"><i class="fa fa-check"></i><b>9</b> Marcov Chain Monte Carlo</a>
<ul>
<li class="chapter" data-level="9.1" data-path="marcov-chain-monte-carlo.html"><a href="marcov-chain-monte-carlo.html#good-king-marcov-and-his-island-kingdom"><i class="fa fa-check"></i><b>9.1</b> Good King Marcov and his island kingdom</a></li>
<li class="chapter" data-level="9.2" data-path="marcov-chain-monte-carlo.html"><a href="marcov-chain-monte-carlo.html#metropolis-algorythm"><i class="fa fa-check"></i><b>9.2</b> Metropolis algorythm</a>
<ul>
<li class="chapter" data-level="9.2.1" data-path="marcov-chain-monte-carlo.html"><a href="marcov-chain-monte-carlo.html#gibbs-sampling"><i class="fa fa-check"></i><b>9.2.1</b> Gibbs sampling</a></li>
<li class="chapter" data-level="9.2.2" data-path="marcov-chain-monte-carlo.html"><a href="marcov-chain-monte-carlo.html#high-dimentional-problem"><i class="fa fa-check"></i><b>9.2.2</b> High-dimentional problem</a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="marcov-chain-monte-carlo.html"><a href="marcov-chain-monte-carlo.html#hamiltonian-monte-carlo"><i class="fa fa-check"></i><b>9.3</b> Hamiltonian Monte Carlo</a>
<ul>
<li class="chapter" data-level="9.3.1" data-path="marcov-chain-monte-carlo.html"><a href="marcov-chain-monte-carlo.html#another-probable"><i class="fa fa-check"></i><b>9.3.1</b> Another probable</a></li>
<li class="chapter" data-level="9.3.2" data-path="marcov-chain-monte-carlo.html"><a href="marcov-chain-monte-carlo.html#limitations"><i class="fa fa-check"></i><b>9.3.2</b> Limitations</a></li>
</ul></li>
<li class="chapter" data-level="9.4" data-path="marcov-chain-monte-carlo.html"><a href="marcov-chain-monte-carlo.html#easy-hmc-ulam-brm"><i class="fa fa-check"></i><b>9.4</b> Easy HMC: <del>ulam</del> <code>brm()</code></a>
<ul>
<li class="chapter" data-level="9.4.1" data-path="marcov-chain-monte-carlo.html"><a href="marcov-chain-monte-carlo.html#preparation"><i class="fa fa-check"></i><b>9.4.1</b> Preparation</a></li>
<li class="chapter" data-level="9.4.2" data-path="marcov-chain-monte-carlo.html"><a href="marcov-chain-monte-carlo.html#sampling-from-posterior"><i class="fa fa-check"></i><b>9.4.2</b> Sampling from posterior</a></li>
<li class="chapter" data-level="9.4.3" data-path="marcov-chain-monte-carlo.html"><a href="marcov-chain-monte-carlo.html#sampling-again-in-parallel"><i class="fa fa-check"></i><b>9.4.3</b> Sampling again in parallel</a></li>
<li class="chapter" data-level="9.4.4" data-path="marcov-chain-monte-carlo.html"><a href="marcov-chain-monte-carlo.html#visualization"><i class="fa fa-check"></i><b>9.4.4</b> Visualization</a></li>
<li class="chapter" data-level="9.4.5" data-path="marcov-chain-monte-carlo.html"><a href="marcov-chain-monte-carlo.html#checking-the-chain"><i class="fa fa-check"></i><b>9.4.5</b> Checking the chain</a></li>
</ul></li>
<li class="chapter" data-level="9.5" data-path="marcov-chain-monte-carlo.html"><a href="marcov-chain-monte-carlo.html#care-and-feeding-of-your-marcov-chain"><i class="fa fa-check"></i><b>9.5</b> Care and feeding of your Marcov chain</a>
<ul>
<li class="chapter" data-level="9.5.1" data-path="marcov-chain-monte-carlo.html"><a href="marcov-chain-monte-carlo.html#how-many-samples-do-you-need"><i class="fa fa-check"></i><b>9.5.1</b> How many samples do you need</a></li>
<li class="chapter" data-level="9.5.2" data-path="marcov-chain-monte-carlo.html"><a href="marcov-chain-monte-carlo.html#how-many-chains-do-we-need"><i class="fa fa-check"></i><b>9.5.2</b> How many chains do we need</a></li>
<li class="chapter" data-level="9.5.3" data-path="marcov-chain-monte-carlo.html"><a href="marcov-chain-monte-carlo.html#taming-and-wild-chain"><i class="fa fa-check"></i><b>9.5.3</b> Taming and wild chain</a></li>
<li class="chapter" data-level="9.5.4" data-path="marcov-chain-monte-carlo.html"><a href="marcov-chain-monte-carlo.html#non-identifiable-parameters"><i class="fa fa-check"></i><b>9.5.4</b> Non-identifiable parameters</a></li>
</ul></li>
<li class="chapter" data-level="9.6" data-path="marcov-chain-monte-carlo.html"><a href="marcov-chain-monte-carlo.html#practice-7"><i class="fa fa-check"></i><b>9.6</b> Practice</a>
<ul>
<li class="chapter" data-level="9.6.1" data-path="marcov-chain-monte-carlo.html"><a href="marcov-chain-monte-carlo.html#m1-5"><i class="fa fa-check"></i><b>9.6.1</b> 9M1</a></li>
<li class="chapter" data-level="9.6.2" data-path="marcov-chain-monte-carlo.html"><a href="marcov-chain-monte-carlo.html#m2-5"><i class="fa fa-check"></i><b>9.6.2</b> 9M2</a></li>
<li class="chapter" data-level="9.6.3" data-path="marcov-chain-monte-carlo.html"><a href="marcov-chain-monte-carlo.html#m3-2"><i class="fa fa-check"></i><b>9.6.3</b> 9M3</a></li>
<li class="chapter" data-level="9.6.4" data-path="marcov-chain-monte-carlo.html"><a href="marcov-chain-monte-carlo.html#h1-7"><i class="fa fa-check"></i><b>9.6.4</b> 9H1</a></li>
<li class="chapter" data-level="9.6.5" data-path="marcov-chain-monte-carlo.html"><a href="marcov-chain-monte-carlo.html#h2-7"><i class="fa fa-check"></i><b>9.6.5</b> 9H2</a></li>
<li class="chapter" data-level="9.6.6" data-path="marcov-chain-monte-carlo.html"><a href="marcov-chain-monte-carlo.html#h3-7"><i class="fa fa-check"></i><b>9.6.6</b> 9H3</a></li>
<li class="chapter" data-level="9.6.7" data-path="marcov-chain-monte-carlo.html"><a href="marcov-chain-monte-carlo.html#h4-7"><i class="fa fa-check"></i><b>9.6.7</b> 9H4</a></li>
<li class="chapter" data-level="9.6.8" data-path="marcov-chain-monte-carlo.html"><a href="marcov-chain-monte-carlo.html#h5-5"><i class="fa fa-check"></i><b>9.6.8</b> 9H5</a></li>
<li class="chapter" data-level="9.6.9" data-path="marcov-chain-monte-carlo.html"><a href="marcov-chain-monte-carlo.html#h6-2"><i class="fa fa-check"></i><b>9.6.9</b> 9H6</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="10" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html"><i class="fa fa-check"></i><b>10</b> Big Entropy and the Generalized Linear Model</a>
<ul>
<li class="chapter" data-level="10.1" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html#maximum-entropy"><i class="fa fa-check"></i><b>10.1</b> Maximum entropy</a>
<ul>
<li class="chapter" data-level="10.1.1" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html#gaussian"><i class="fa fa-check"></i><b>10.1.1</b> Gaussian</a></li>
<li class="chapter" data-level="10.1.2" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html#binomial"><i class="fa fa-check"></i><b>10.1.2</b> Binomial</a></li>
</ul></li>
<li class="chapter" data-level="10.2" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html#generalized-linear-models"><i class="fa fa-check"></i><b>10.2</b> Generalized linear models</a>
<ul>
<li class="chapter" data-level="10.2.1" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html#meet-the-family"><i class="fa fa-check"></i><b>10.2.1</b> Meet the family</a></li>
<li class="chapter" data-level="10.2.2" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html#linking-linear-models-to-distributions"><i class="fa fa-check"></i><b>10.2.2</b> Linking linear models to distributions</a></li>
<li class="chapter" data-level="10.2.3" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html#overthinking-2"><i class="fa fa-check"></i><b>10.2.3</b> Overthinking</a></li>
<li class="chapter" data-level="10.2.4" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html#omitted-variable-bias-again"><i class="fa fa-check"></i><b>10.2.4</b> Omitted variable bias again</a></li>
<li class="chapter" data-level="10.2.5" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html#absolute-and-relative-differences"><i class="fa fa-check"></i><b>10.2.5</b> Absolute and relative differences</a></li>
<li class="chapter" data-level="10.2.6" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html#glms-and-information-criteria"><i class="fa fa-check"></i><b>10.2.6</b> GLMs and information criteria</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="11" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html"><i class="fa fa-check"></i><b>11</b> God Spiked the Integers</a>
<ul>
<li class="chapter" data-level="11.1" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#binomial-regression"><i class="fa fa-check"></i><b>11.1</b> Binomial regression</a>
<ul>
<li class="chapter" data-level="11.1.1" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#logistic-regression"><i class="fa fa-check"></i><b>11.1.1</b> Logistic regression</a></li>
<li class="chapter" data-level="11.1.2" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#relative-shark-and-absolute-deer"><i class="fa fa-check"></i><b>11.1.2</b> Relative shark and absolute deer</a></li>
<li class="chapter" data-level="11.1.3" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#aggregated-binomial-chimpanzees-again-condensed"><i class="fa fa-check"></i><b>11.1.3</b> Aggregated binomial: Chimpanzees again, condensed</a></li>
</ul></li>
<li class="chapter" data-level="11.2" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#aggregated-binomial-graduate-school-admittions."><i class="fa fa-check"></i><b>11.2</b> Aggregated binomial: Graduate school admittions.</a></li>
<li class="chapter" data-level="11.3" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#poisson-regression"><i class="fa fa-check"></i><b>11.3</b> Poisson regression</a>
<ul>
<li class="chapter" data-level="11.3.1" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#oceanic-tool-complexity"><i class="fa fa-check"></i><b>11.3.1</b> Oceanic tool complexity</a></li>
<li class="chapter" data-level="11.3.2" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#negative-binomial-gamma-poisson-models."><i class="fa fa-check"></i><b>11.3.2</b> Negative binomial (Gamma-Poisson) models.</a></li>
<li class="chapter" data-level="11.3.3" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#example-exposure-and-the-offset"><i class="fa fa-check"></i><b>11.3.3</b> Example: Exposure and the offset</a></li>
</ul></li>
<li class="chapter" data-level="11.4" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#multinomial-and-categorical-models"><i class="fa fa-check"></i><b>11.4</b> Multinomial and categorical models</a>
<ul>
<li class="chapter" data-level="11.4.1" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#predictors-matched-to-outcomes"><i class="fa fa-check"></i><b>11.4.1</b> Predictors matched to outcomes</a></li>
<li class="chapter" data-level="11.4.2" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#predictor-matched-to-observations"><i class="fa fa-check"></i><b>11.4.2</b> Predictor matched to observations</a></li>
<li class="chapter" data-level="11.4.3" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#multinomial-in-disguise-as-poisson"><i class="fa fa-check"></i><b>11.4.3</b> Multinomial in disguise as Poisson</a></li>
</ul></li>
<li class="chapter" data-level="11.5" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#practice-8"><i class="fa fa-check"></i><b>11.5</b> Practice</a>
<ul>
<li class="chapter" data-level="11.5.1" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#e1"><i class="fa fa-check"></i><b>11.5.1</b> 11E1</a></li>
<li class="chapter" data-level="11.5.2" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#e2-1"><i class="fa fa-check"></i><b>11.5.2</b> 11E2</a></li>
<li class="chapter" data-level="11.5.3" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#e3-1"><i class="fa fa-check"></i><b>11.5.3</b> 11E3</a></li>
<li class="chapter" data-level="11.5.4" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#e4-1"><i class="fa fa-check"></i><b>11.5.4</b> 11E4</a></li>
<li class="chapter" data-level="11.5.5" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#m7-2"><i class="fa fa-check"></i><b>11.5.5</b> 11M7</a></li>
<li class="chapter" data-level="11.5.6" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#m8-1"><i class="fa fa-check"></i><b>11.5.6</b> 11M8</a></li>
<li class="chapter" data-level="11.5.7" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#h1-8"><i class="fa fa-check"></i><b>11.5.7</b> 11H1</a></li>
<li class="chapter" data-level="11.5.8" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#h2-8"><i class="fa fa-check"></i><b>11.5.8</b> 11H2</a></li>
<li class="chapter" data-level="11.5.9" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#h3-8"><i class="fa fa-check"></i><b>11.5.9</b> 11H3</a></li>
<li class="chapter" data-level="11.5.10" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#h4-8"><i class="fa fa-check"></i><b>11.5.10</b> 11H4</a></li>
<li class="chapter" data-level="11.5.11" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#h5-6"><i class="fa fa-check"></i><b>11.5.11</b> 11H5</a></li>
<li class="chapter" data-level="11.5.12" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#h6-3"><i class="fa fa-check"></i><b>11.5.12</b> 11H6</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="12" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html"><i class="fa fa-check"></i><b>12</b> Monsters and Mixtures</a>
<ul>
<li class="chapter" data-level="12.1" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#over-dispersed-counts"><i class="fa fa-check"></i><b>12.1</b> Over-dispersed counts</a>
<ul>
<li class="chapter" data-level="12.1.1" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#beta-binomial."><i class="fa fa-check"></i><b>12.1.1</b> Beta binomial.</a></li>
<li class="chapter" data-level="12.1.2" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#negative-binomial-or-gamma-poisson."><i class="fa fa-check"></i><b>12.1.2</b> Negative binomial or gamma-Poisson.</a></li>
<li class="chapter" data-level="12.1.3" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#over-dispersion-entropy-and-information-criteria."><i class="fa fa-check"></i><b>12.1.3</b> Over-dispersion, entropy, and information criteria.</a></li>
</ul></li>
<li class="chapter" data-level="12.2" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#zero-inflated-outcomes"><i class="fa fa-check"></i><b>12.2</b> Zero-inflated outcomes</a>
<ul>
<li class="chapter" data-level="12.2.1" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#example-zero-inflated-poisson."><i class="fa fa-check"></i><b>12.2.1</b> Example: Zero-inflated Poisson.</a></li>
</ul></li>
<li class="chapter" data-level="12.3" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#ordered-categorical-outcomes"><i class="fa fa-check"></i><b>12.3</b> Ordered categorical outcomes</a>
<ul>
<li class="chapter" data-level="12.3.1" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#example-moral-intuition."><i class="fa fa-check"></i><b>12.3.1</b> Example: Moral intuition.</a></li>
<li class="chapter" data-level="12.3.2" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#adding-predictor-variables."><i class="fa fa-check"></i><b>12.3.2</b> Adding predictor variables.</a></li>
</ul></li>
<li class="chapter" data-level="12.4" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#ordered-categorical-predictors"><i class="fa fa-check"></i><b>12.4</b> Ordered categorical predictors</a></li>
<li class="chapter" data-level="12.5" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#practice-9"><i class="fa fa-check"></i><b>12.5</b> Practice</a>
<ul>
<li class="chapter" data-level="12.5.1" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#m1-6"><i class="fa fa-check"></i><b>12.5.1</b> 12M1</a></li>
<li class="chapter" data-level="12.5.2" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#m2-6"><i class="fa fa-check"></i><b>12.5.2</b> 12M2</a></li>
<li class="chapter" data-level="12.5.3" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#m3-3"><i class="fa fa-check"></i><b>12.5.3</b> 12M3</a></li>
<li class="chapter" data-level="12.5.4" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#h1-9"><i class="fa fa-check"></i><b>12.5.4</b> 12H1</a></li>
<li class="chapter" data-level="12.5.5" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#h2-9"><i class="fa fa-check"></i><b>12.5.5</b> 12H2</a></li>
<li class="chapter" data-level="12.5.6" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#h3-9"><i class="fa fa-check"></i><b>12.5.6</b> 12H3</a></li>
<li class="chapter" data-level="12.5.7" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#h4-9"><i class="fa fa-check"></i><b>12.5.7</b> 12H4</a></li>
<li class="chapter" data-level="12.5.8" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#h5-7"><i class="fa fa-check"></i><b>12.5.8</b> 12H5</a></li>
<li class="chapter" data-level="12.5.9" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#h6-4"><i class="fa fa-check"></i><b>12.5.9</b> 12H6</a></li>
<li class="chapter" data-level="12.5.10" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#h7-1"><i class="fa fa-check"></i><b>12.5.10</b> 12H7</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="13" data-path="models-with-memory.html"><a href="models-with-memory.html"><i class="fa fa-check"></i><b>13</b> Models with Memory</a>
<ul>
<li class="chapter" data-level="13.1" data-path="models-with-memory.html"><a href="models-with-memory.html#multilevel-tadpoles"><i class="fa fa-check"></i><b>13.1</b> Multilevel tadpoles</a></li>
<li class="chapter" data-level="13.2" data-path="models-with-memory.html"><a href="models-with-memory.html#varying-effects-and-the-underfittingoverfitting-trade-off"><i class="fa fa-check"></i><b>13.2</b> Varying effects and the underfitting/overfitting trade-off 　</a>
<ul>
<li class="chapter" data-level="13.2.1" data-path="models-with-memory.html"><a href="models-with-memory.html#the-model"><i class="fa fa-check"></i><b>13.2.1</b> The model</a></li>
<li class="chapter" data-level="13.2.2" data-path="models-with-memory.html"><a href="models-with-memory.html#simulate-survivors"><i class="fa fa-check"></i><b>13.2.2</b> Simulate survivors</a></li>
</ul></li>
<li class="chapter" data-level="13.3" data-path="models-with-memory.html"><a href="models-with-memory.html#more-than-one-type-of-cluster"><i class="fa fa-check"></i><b>13.3</b> More than one type of cluster</a>
<ul>
<li class="chapter" data-level="13.3.1" data-path="models-with-memory.html"><a href="models-with-memory.html#even-more-clusters"><i class="fa fa-check"></i><b>13.3.1</b> Even more clusters</a></li>
</ul></li>
<li class="chapter" data-level="13.4" data-path="models-with-memory.html"><a href="models-with-memory.html#divergent-transitions-and-non-centered-priors"><i class="fa fa-check"></i><b>13.4</b> Divergent transitions and non-centered priors</a>
<ul>
<li class="chapter" data-level="13.4.1" data-path="models-with-memory.html"><a href="models-with-memory.html#the-devils-funnel"><i class="fa fa-check"></i><b>13.4.1</b> The Devil’s Funnel</a></li>
<li class="chapter" data-level="13.4.2" data-path="models-with-memory.html"><a href="models-with-memory.html#non-centered-chimpanzees"><i class="fa fa-check"></i><b>13.4.2</b> Non-centered chimpanzees</a></li>
</ul></li>
<li class="chapter" data-level="13.5" data-path="models-with-memory.html"><a href="models-with-memory.html#multilevel-posterior-predictions"><i class="fa fa-check"></i><b>13.5</b> Multilevel posterior predictions</a>
<ul>
<li class="chapter" data-level="13.5.1" data-path="models-with-memory.html"><a href="models-with-memory.html#posterior-prediction-for-same-clusters"><i class="fa fa-check"></i><b>13.5.1</b> Posterior prediction for same clusters</a></li>
<li class="chapter" data-level="13.5.2" data-path="models-with-memory.html"><a href="models-with-memory.html#posterior-prediction-for-new-clusters"><i class="fa fa-check"></i><b>13.5.2</b> Posterior prediction for new clusters</a></li>
</ul></li>
<li class="chapter" data-level="13.6" data-path="models-with-memory.html"><a href="models-with-memory.html#post-stratification"><i class="fa fa-check"></i><b>13.6</b> Post stratification</a>
<ul>
<li class="chapter" data-level="13.6.1" data-path="models-with-memory.html"><a href="models-with-memory.html#meet-the-data"><i class="fa fa-check"></i><b>13.6.1</b> Meet the data</a></li>
<li class="chapter" data-level="13.6.2" data-path="models-with-memory.html"><a href="models-with-memory.html#settle-the-mr-part-of-mrp."><i class="fa fa-check"></i><b>13.6.2</b> Settle the MR part of MRP.</a></li>
<li class="chapter" data-level="13.6.3" data-path="models-with-memory.html"><a href="models-with-memory.html#post-stratify-to-put-the-p-in-mrp."><i class="fa fa-check"></i><b>13.6.3</b> Post-stratify to put the P in MRP.</a></li>
</ul></li>
<li class="chapter" data-level="13.7" data-path="models-with-memory.html"><a href="models-with-memory.html#practice-10"><i class="fa fa-check"></i><b>13.7</b> Practice</a>
<ul>
<li class="chapter" data-level="13.7.1" data-path="models-with-memory.html"><a href="models-with-memory.html#m1-7"><i class="fa fa-check"></i><b>13.7.1</b> 13M1</a></li>
<li class="chapter" data-level="13.7.2" data-path="models-with-memory.html"><a href="models-with-memory.html#m2-7"><i class="fa fa-check"></i><b>13.7.2</b> 13M2</a></li>
<li class="chapter" data-level="13.7.3" data-path="models-with-memory.html"><a href="models-with-memory.html#m3-4"><i class="fa fa-check"></i><b>13.7.3</b> 13M3</a></li>
<li class="chapter" data-level="13.7.4" data-path="models-with-memory.html"><a href="models-with-memory.html#m4-6"><i class="fa fa-check"></i><b>13.7.4</b> 13M4</a></li>
<li class="chapter" data-level="13.7.5" data-path="models-with-memory.html"><a href="models-with-memory.html#m5-3"><i class="fa fa-check"></i><b>13.7.5</b> 13M5</a></li>
<li class="chapter" data-level="13.7.6" data-path="models-with-memory.html"><a href="models-with-memory.html#m6-2"><i class="fa fa-check"></i><b>13.7.6</b> 13M6</a></li>
<li class="chapter" data-level="13.7.7" data-path="models-with-memory.html"><a href="models-with-memory.html#h1-10"><i class="fa fa-check"></i><b>13.7.7</b> 13H1</a></li>
<li class="chapter" data-level="13.7.8" data-path="models-with-memory.html"><a href="models-with-memory.html#h2-10"><i class="fa fa-check"></i><b>13.7.8</b> 13H2</a></li>
<li class="chapter" data-level="13.7.9" data-path="models-with-memory.html"><a href="models-with-memory.html#h3-10"><i class="fa fa-check"></i><b>13.7.9</b> 13H3</a></li>
<li class="chapter" data-level="13.7.10" data-path="models-with-memory.html"><a href="models-with-memory.html#h4-10"><i class="fa fa-check"></i><b>13.7.10</b> 13H4</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="14" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html"><i class="fa fa-check"></i><b>14</b> Adventures in Covariance</a>
<ul>
<li class="chapter" data-level="14.1" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#varying-slopes-by-construction"><i class="fa fa-check"></i><b>14.1</b> Varying slopes by construction</a>
<ul>
<li class="chapter" data-level="14.1.1" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#simulate-and-population"><i class="fa fa-check"></i><b>14.1.1</b> Simulate and population</a></li>
<li class="chapter" data-level="14.1.2" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#simulate-observation"><i class="fa fa-check"></i><b>14.1.2</b> Simulate observation</a></li>
<li class="chapter" data-level="14.1.3" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#the-varying-slope-model"><i class="fa fa-check"></i><b>14.1.3</b> The varying slope model</a></li>
</ul></li>
<li class="chapter" data-level="14.2" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#advanced-varing-slopes"><i class="fa fa-check"></i><b>14.2</b> Advanced varing slopes</a></li>
<li class="chapter" data-level="14.3" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#instruments-and-causal-designs"><i class="fa fa-check"></i><b>14.3</b> Instruments and causal designs</a>
<ul>
<li class="chapter" data-level="14.3.1" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#instrumental-variables"><i class="fa fa-check"></i><b>14.3.1</b> Instrumental variables</a></li>
<li class="chapter" data-level="14.3.2" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#other-designs"><i class="fa fa-check"></i><b>14.3.2</b> Other designs</a></li>
</ul></li>
<li class="chapter" data-level="14.4" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#social-relations-as-correlated-varying-effects"><i class="fa fa-check"></i><b>14.4</b> Social relations as correlated varying effects</a></li>
<li class="chapter" data-level="14.5" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#continuous-categories-and-the-gaussian-process"><i class="fa fa-check"></i><b>14.5</b> Continuous categories and the Gaussian process</a>
<ul>
<li class="chapter" data-level="14.5.1" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#example-spatial-autocorrelation-in-oceanic-tools"><i class="fa fa-check"></i><b>14.5.1</b> Example: Spatial autocorrelation in Oceanic tools</a></li>
<li class="chapter" data-level="14.5.2" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#example-phylogenetic-distance"><i class="fa fa-check"></i><b>14.5.2</b> Example: Phylogenetic distance</a></li>
</ul></li>
<li class="chapter" data-level="14.6" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#practice-11"><i class="fa fa-check"></i><b>14.6</b> Practice</a>
<ul>
<li class="chapter" data-level="14.6.1" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#m1-8"><i class="fa fa-check"></i><b>14.6.1</b> 14M1</a></li>
<li class="chapter" data-level="14.6.2" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#m2-8"><i class="fa fa-check"></i><b>14.6.2</b> 14M2</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="実行環境.html"><a href="実行環境.html"><i class="fa fa-check"></i>実行環境</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Statistical Rethinking Second Edition</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="the-haunted-dag-the-causal-terror" class="section level1 hasAnchor" number="6">
<h1><span class="header-section-number">6</span> The Haunted DAG &amp; the Causal Terror<a href="the-haunted-dag-the-causal-terror.html#the-haunted-dag-the-causal-terror" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p><strong>Preface</strong><br />
合流点を固定してしまうと、あるいは合流点の値で選抜を行ってしまうと、疑相関が生じてしまう。<br />
例えば、交付金申請に通った研究内のみで「研究の信頼性」と「研究の話題性」の相関を調べる場合。
本来それらには相関がなくても、申請に通った研究（両者の合計点が高い研究）のみに絞ると、負の相関が生じる。</p>
<p><br /></p>
<div class="sourceCode" id="cb459"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb459-1"><a href="the-haunted-dag-the-causal-terror.html#cb459-1" aria-hidden="true" tabindex="-1"></a><span class="fu">theme_set</span>(<span class="fu">theme_classic</span>())</span>
<span id="cb459-2"><a href="the-haunted-dag-the-causal-terror.html#cb459-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb459-3"><a href="the-haunted-dag-the-causal-terror.html#cb459-3" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">200</span>)</span>
<span id="cb459-4"><a href="the-haunted-dag-the-causal-terror.html#cb459-4" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">500</span> <span class="co"># number of proposal</span></span>
<span id="cb459-5"><a href="the-haunted-dag-the-causal-terror.html#cb459-5" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fl">0.1</span> <span class="co"># prop to select</span></span>
<span id="cb459-6"><a href="the-haunted-dag-the-causal-terror.html#cb459-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb459-7"><a href="the-haunted-dag-the-causal-terror.html#cb459-7" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">newsworthiness =</span> <span class="fu">rnorm</span>(n),</span>
<span id="cb459-8"><a href="the-haunted-dag-the-causal-terror.html#cb459-8" aria-hidden="true" tabindex="-1"></a>            <span class="at">trustworthiness =</span> <span class="fu">rnorm</span>(n))</span>
<span id="cb459-9"><a href="the-haunted-dag-the-causal-terror.html#cb459-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb459-10"><a href="the-haunted-dag-the-causal-terror.html#cb459-10" aria-hidden="true" tabindex="-1"></a>d <span class="sc">%&gt;%</span> </span>
<span id="cb459-11"><a href="the-haunted-dag-the-causal-terror.html#cb459-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>newsworthiness,<span class="at">y=</span>trustworthiness))<span class="sc">+</span></span>
<span id="cb459-12"><a href="the-haunted-dag-the-causal-terror.html#cb459-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()<span class="sc">+</span></span>
<span id="cb459-13"><a href="the-haunted-dag-the-causal-terror.html#cb459-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">aspect.ratio=</span><span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb459-14"><a href="the-haunted-dag-the-causal-terror.html#cb459-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">&quot;lm&quot;</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>)</span></code></pre></div>
<p><img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-205-1.png" width="672" style="display: block; margin: auto;" /></p>
<p><br /></p>
<p>合計点が上位10%のみの研究に絞ると…。</p>
<div class="sourceCode" id="cb460"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb460-1"><a href="the-haunted-dag-the-causal-terror.html#cb460-1" aria-hidden="true" tabindex="-1"></a>d <span class="sc">%&gt;%</span> </span>
<span id="cb460-2"><a href="the-haunted-dag-the-causal-terror.html#cb460-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">total =</span> trustworthiness <span class="sc">+</span> newsworthiness) <span class="sc">%&gt;%</span> </span>
<span id="cb460-3"><a href="the-haunted-dag-the-causal-terror.html#cb460-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">selected =</span> <span class="fu">ifelse</span>(total <span class="sc">&gt;=</span> <span class="fu">quantile</span>(total, <span class="dv">1</span><span class="sc">-</span>p), <span class="cn">TRUE</span>, <span class="cn">FALSE</span>)) <span class="ot">-&gt;</span> d</span>
<span id="cb460-4"><a href="the-haunted-dag-the-causal-terror.html#cb460-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb460-5"><a href="the-haunted-dag-the-causal-terror.html#cb460-5" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(d)</span></code></pre></div>
<pre><code>## # A tibble: 6 × 4
##   newsworthiness trustworthiness  total selected
##            &lt;dbl&gt;           &lt;dbl&gt;  &lt;dbl&gt; &lt;lgl&gt;   
## 1         0.0848          -0.354 -0.269 FALSE   
## 2         0.226           -1.93  -1.70  FALSE   
## 3         0.433           -0.761 -0.328 FALSE   
## 4         0.558            2.34   2.90  TRUE    
## 5         0.0598          -2.07  -2.01  FALSE   
## 6        -0.115           -1.04  -1.15  FALSE</code></pre>
<div class="sourceCode" id="cb462"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb462-1"><a href="the-haunted-dag-the-causal-terror.html#cb462-1" aria-hidden="true" tabindex="-1"></a>text <span class="ot">&lt;-</span></span>
<span id="cb462-2"><a href="the-haunted-dag-the-causal-terror.html#cb462-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="at">newsworthiness  =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">1</span>), </span>
<span id="cb462-3"><a href="the-haunted-dag-the-causal-terror.html#cb462-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">trustworthiness =</span> <span class="fu">c</span>(<span class="fl">2.25</span>, <span class="sc">-</span><span class="fl">2.5</span>),</span>
<span id="cb462-4"><a href="the-haunted-dag-the-causal-terror.html#cb462-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">selected =</span> <span class="fu">c</span>(<span class="cn">TRUE</span>, <span class="cn">FALSE</span>),</span>
<span id="cb462-5"><a href="the-haunted-dag-the-causal-terror.html#cb462-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">label    =</span> <span class="fu">c</span>(<span class="st">&quot;selected&quot;</span>, <span class="st">&quot;rejected&quot;</span>))</span>
<span id="cb462-6"><a href="the-haunted-dag-the-causal-terror.html#cb462-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb462-7"><a href="the-haunted-dag-the-causal-terror.html#cb462-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb462-8"><a href="the-haunted-dag-the-causal-terror.html#cb462-8" aria-hidden="true" tabindex="-1"></a>d <span class="sc">%&gt;%</span>  </span>
<span id="cb462-9"><a href="the-haunted-dag-the-causal-terror.html#cb462-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> newsworthiness, <span class="at">y=</span>trustworthiness,</span>
<span id="cb462-10"><a href="the-haunted-dag-the-causal-terror.html#cb462-10" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> selected))<span class="sc">+</span></span>
<span id="cb462-11"><a href="the-haunted-dag-the-causal-terror.html#cb462-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">shape =</span> selected), <span class="at">alpha =</span><span class="dv">3</span><span class="sc">/</span><span class="dv">4</span>)<span class="sc">+</span></span>
<span id="cb462-12"><a href="the-haunted-dag-the-causal-terror.html#cb462-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">data =</span> text,</span>
<span id="cb462-13"><a href="the-haunted-dag-the-causal-terror.html#cb462-13" aria-hidden="true" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">label =</span> label))<span class="sc">+</span></span>
<span id="cb462-14"><a href="the-haunted-dag-the-causal-terror.html#cb462-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_shape_manual</span>(<span class="at">values=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">19</span>))<span class="sc">+</span></span>
<span id="cb462-15"><a href="the-haunted-dag-the-causal-terror.html#cb462-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values=</span><span class="fu">c</span>(<span class="st">&quot;black&quot;</span>, <span class="st">&quot;navyblue&quot;</span>))<span class="sc">+</span></span>
<span id="cb462-16"><a href="the-haunted-dag-the-causal-terror.html#cb462-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">data =</span> . <span class="sc">%&gt;%</span> <span class="fu">filter</span>(selected <span class="sc">==</span> <span class="st">&quot;TRUE&quot;</span>),</span>
<span id="cb462-17"><a href="the-haunted-dag-the-causal-terror.html#cb462-17" aria-hidden="true" tabindex="-1"></a>              <span class="at">method =</span> <span class="st">&quot;lm&quot;</span>, <span class="at">color =</span> <span class="st">&quot;navyblue&quot;</span>,</span>
<span id="cb462-18"><a href="the-haunted-dag-the-causal-terror.html#cb462-18" aria-hidden="true" tabindex="-1"></a>              <span class="at">se =</span> F, <span class="at">size =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>, <span class="at">fullrange =</span> T)<span class="sc">+</span></span>
<span id="cb462-19"><a href="the-haunted-dag-the-causal-terror.html#cb462-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>,</span>
<span id="cb462-20"><a href="the-haunted-dag-the-causal-terror.html#cb462-20" aria-hidden="true" tabindex="-1"></a>        <span class="at">aspect.ratio=</span><span class="dv">1</span>)</span></code></pre></div>
<p><img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-206-1.png" width="672" style="display: block; margin: auto;" />
<br /></p>
<p>本章では、回帰モデルを使用する際にどの変数を加えるべきで、どの変数を加えるべきでないかを検討する。</p>
<p><br /></p>
<div id="multicollinearity" class="section level2 hasAnchor" number="6.1">
<h2><span class="header-section-number">6.1</span> Multicollinearity<a href="the-haunted-dag-the-causal-terror.html#multicollinearity" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>両脚の長さから身長を予測するモデルを考える。</p>
<div class="sourceCode" id="cb463"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb463-1"><a href="the-haunted-dag-the-causal-terror.html#cb463-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">909</span>)</span>
<span id="cb463-2"><a href="the-haunted-dag-the-causal-terror.html#cb463-2" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb463-3"><a href="the-haunted-dag-the-causal-terror.html#cb463-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb463-4"><a href="the-haunted-dag-the-causal-terror.html#cb463-4" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">height =</span> <span class="fu">rnorm</span>(n, <span class="dv">10</span>, <span class="dv">2</span>),</span>
<span id="cb463-5"><a href="the-haunted-dag-the-causal-terror.html#cb463-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">leg_prop =</span> <span class="fu">runif</span>(n, <span class="fl">0.4</span>, <span class="fl">0.5</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb463-6"><a href="the-haunted-dag-the-causal-terror.html#cb463-6" aria-hidden="true" tabindex="-1"></a>     <span class="fu">mutate</span>(<span class="at">leg_left =</span> leg_prop<span class="sc">*</span>height <span class="sc">+</span></span>
<span id="cb463-7"><a href="the-haunted-dag-the-causal-terror.html#cb463-7" aria-hidden="true" tabindex="-1"></a>              <span class="fu">rnorm</span>(n,<span class="dv">0</span>,<span class="fl">0.02</span>),</span>
<span id="cb463-8"><a href="the-haunted-dag-the-causal-terror.html#cb463-8" aria-hidden="true" tabindex="-1"></a>            <span class="at">leg_right =</span> leg_prop<span class="sc">*</span>height <span class="sc">+</span> </span>
<span id="cb463-9"><a href="the-haunted-dag-the-causal-terror.html#cb463-9" aria-hidden="true" tabindex="-1"></a>              <span class="fu">rnorm</span>(n, <span class="dv">0</span>, <span class="fl">0.02</span>))</span></code></pre></div>
<p><br /></p>
<p>当然、左右の脚の長さ同士は強く相関するし、どちらも身長と強く相関する。</p>
<div class="sourceCode" id="cb464"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb464-1"><a href="the-haunted-dag-the-causal-terror.html#cb464-1" aria-hidden="true" tabindex="-1"></a>d <span class="sc">%&gt;%</span> </span>
<span id="cb464-2"><a href="the-haunted-dag-the-causal-terror.html#cb464-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>leg_prop) <span class="sc">%&gt;%</span> </span>
<span id="cb464-3"><a href="the-haunted-dag-the-causal-terror.html#cb464-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cor</span>()</span></code></pre></div>
<pre><code>##              height  leg_left leg_right
## height    1.0000000 0.9557084 0.9559273
## leg_left  0.9557084 1.0000000 0.9997458
## leg_right 0.9559273 0.9997458 1.0000000</code></pre>
<div class="sourceCode" id="cb466"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb466-1"><a href="the-haunted-dag-the-causal-terror.html#cb466-1" aria-hidden="true" tabindex="-1"></a>d <span class="sc">%&gt;%</span> </span>
<span id="cb466-2"><a href="the-haunted-dag-the-causal-terror.html#cb466-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>leg_left, <span class="at">y=</span>leg_right))<span class="sc">+</span></span>
<span id="cb466-3"><a href="the-haunted-dag-the-causal-terror.html#cb466-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()<span class="sc">+</span></span>
<span id="cb466-4"><a href="the-haunted-dag-the-causal-terror.html#cb466-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">aspect.ratio=</span><span class="dv">1</span>)<span class="ot">-&gt;</span> p1</span>
<span id="cb466-5"><a href="the-haunted-dag-the-causal-terror.html#cb466-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb466-6"><a href="the-haunted-dag-the-causal-terror.html#cb466-6" aria-hidden="true" tabindex="-1"></a>d <span class="sc">%&gt;%</span> </span>
<span id="cb466-7"><a href="the-haunted-dag-the-causal-terror.html#cb466-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>leg_left, <span class="at">y=</span>height))<span class="sc">+</span></span>
<span id="cb466-8"><a href="the-haunted-dag-the-causal-terror.html#cb466-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()<span class="sc">+</span></span>
<span id="cb466-9"><a href="the-haunted-dag-the-causal-terror.html#cb466-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">aspect.ratio=</span><span class="dv">1</span>) <span class="ot">-&gt;</span> p2</span>
<span id="cb466-10"><a href="the-haunted-dag-the-causal-terror.html#cb466-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb466-11"><a href="the-haunted-dag-the-causal-terror.html#cb466-11" aria-hidden="true" tabindex="-1"></a>d <span class="sc">%&gt;%</span> </span>
<span id="cb466-12"><a href="the-haunted-dag-the-causal-terror.html#cb466-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>leg_right, <span class="at">y=</span>height))<span class="sc">+</span></span>
<span id="cb466-13"><a href="the-haunted-dag-the-causal-terror.html#cb466-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()<span class="sc">+</span></span>
<span id="cb466-14"><a href="the-haunted-dag-the-causal-terror.html#cb466-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">aspect.ratio=</span><span class="dv">1</span>) <span class="ot">-&gt;</span> p3</span>
<span id="cb466-15"><a href="the-haunted-dag-the-causal-terror.html#cb466-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb466-16"><a href="the-haunted-dag-the-causal-terror.html#cb466-16" aria-hidden="true" tabindex="-1"></a>p1<span class="sc">+</span>p2<span class="sc">+</span>p3</span></code></pre></div>
<p><img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-208-1.png" width="672" style="display: block; margin: auto;" /></p>
<p><br /></p>
<p>そこで、モデルを回してみると…。<br />
どちらも身長にほとんど影響していないように見えるし、両脚が異なる影響を与えているような推定結果になってしまう。</p>
<div class="sourceCode" id="cb467"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb467-1"><a href="the-haunted-dag-the-causal-terror.html#cb467-1" aria-hidden="true" tabindex="-1"></a>b6<span class="fl">.1</span> <span class="ot">&lt;-</span> </span>
<span id="cb467-2"><a href="the-haunted-dag-the-causal-terror.html#cb467-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">brm</span>(<span class="at">data =</span> d,</span>
<span id="cb467-3"><a href="the-haunted-dag-the-causal-terror.html#cb467-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> gaussian,</span>
<span id="cb467-4"><a href="the-haunted-dag-the-causal-terror.html#cb467-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">formula =</span> height <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> leg_left <span class="sc">+</span> leg_right,</span>
<span id="cb467-5"><a href="the-haunted-dag-the-causal-terror.html#cb467-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">10</span>,<span class="dv">100</span>),<span class="at">class=</span>Intercept),</span>
<span id="cb467-6"><a href="the-haunted-dag-the-causal-terror.html#cb467-6" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">2</span>,<span class="dv">10</span>),<span class="at">class=</span>b),</span>
<span id="cb467-7"><a href="the-haunted-dag-the-causal-terror.html#cb467-7" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>),<span class="at">class =</span> sigma)),</span>
<span id="cb467-8"><a href="the-haunted-dag-the-causal-terror.html#cb467-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">iter=</span><span class="dv">2000</span>,<span class="at">warmup=</span><span class="dv">1000</span>,<span class="at">chains=</span><span class="dv">4</span>,</span>
<span id="cb467-9"><a href="the-haunted-dag-the-causal-terror.html#cb467-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">backend =</span> <span class="st">&quot;cmdstanr&quot;</span>,</span>
<span id="cb467-10"><a href="the-haunted-dag-the-causal-terror.html#cb467-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">file =</span> <span class="st">&quot;output/Chapter6/b6.1&quot;</span>)</span>
<span id="cb467-11"><a href="the-haunted-dag-the-causal-terror.html#cb467-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb467-12"><a href="the-haunted-dag-the-causal-terror.html#cb467-12" aria-hidden="true" tabindex="-1"></a><span class="fu">posterior_summary</span>(b6<span class="fl">.1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb467-13"><a href="the-haunted-dag-the-causal-terror.html#cb467-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">round</span>(<span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb467-14"><a href="the-haunted-dag-the-causal-terror.html#cb467-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb467-15"><a href="the-haunted-dag-the-causal-terror.html#cb467-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>(<span class="at">var =</span> <span class="st">&quot;parameter&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb467-16"><a href="the-haunted-dag-the-causal-terror.html#cb467-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>()</span></code></pre></div>
<pre><code>## # A tibble: 6 × 5
##   parameter   Estimate Est.Error    Q2.5   Q97.5
##   &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;
## 1 b_Intercept     0.98      0.29    0.4     1.56
## 2 b_leg_left      0.17      2.59   -4.94    5.17
## 3 b_leg_right     1.83      2.59   -3.17    6.96
## 4 sigma           0.63      0.05    0.55    0.73
## 5 lprior        -12.7       0.12  -13.0   -12.6 
## 6 lp__         -109.        1.48 -113.   -107.</code></pre>
<div class="sourceCode" id="cb469"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb469-1"><a href="the-haunted-dag-the-causal-terror.html#cb469-1" aria-hidden="true" tabindex="-1"></a><span class="fu">posterior_samples</span>(b6<span class="fl">.1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb469-2"><a href="the-haunted-dag-the-causal-terror.html#cb469-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>lp__) <span class="sc">%&gt;%</span> </span>
<span id="cb469-3"><a href="the-haunted-dag-the-causal-terror.html#cb469-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mcmc_intervals</span>()</span></code></pre></div>
<p><img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-209-1.png" width="672" style="display: block; margin: auto;" /></p>
<p><br /></p>
<p>繰り返しやってみる。
推定結果にかなりばらつきが出る。</p>
<div class="sourceCode" id="cb470"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb470-1"><a href="the-haunted-dag-the-causal-terror.html#cb470-1" aria-hidden="true" tabindex="-1"></a>sim_and_fit <span class="ot">&lt;-</span> <span class="cf">function</span>(seed, <span class="at">n =</span> <span class="dv">100</span>) {</span>
<span id="cb470-2"><a href="the-haunted-dag-the-causal-terror.html#cb470-2" aria-hidden="true" tabindex="-1"></a>  n <span class="ot">&lt;-</span> n</span>
<span id="cb470-3"><a href="the-haunted-dag-the-causal-terror.html#cb470-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set.seed</span>(seed)</span>
<span id="cb470-4"><a href="the-haunted-dag-the-causal-terror.html#cb470-4" aria-hidden="true" tabindex="-1"></a>  d <span class="ot">&lt;-</span> </span>
<span id="cb470-5"><a href="the-haunted-dag-the-causal-terror.html#cb470-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tibble</span>(<span class="at">height   =</span> <span class="fu">rnorm</span>(n, <span class="at">mean =</span> <span class="dv">10</span>, <span class="at">sd =</span> <span class="dv">2</span>),</span>
<span id="cb470-6"><a href="the-haunted-dag-the-causal-terror.html#cb470-6" aria-hidden="true" tabindex="-1"></a>           <span class="at">leg_prop =</span> <span class="fu">runif</span>(n, <span class="at">min =</span> <span class="fl">0.4</span>, <span class="at">max =</span> <span class="fl">0.5</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb470-7"><a href="the-haunted-dag-the-causal-terror.html#cb470-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">leg_left  =</span> leg_prop <span class="sc">*</span> height <span class="sc">+</span> <span class="fu">rnorm</span>(n, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="fl">0.02</span>),</span>
<span id="cb470-8"><a href="the-haunted-dag-the-causal-terror.html#cb470-8" aria-hidden="true" tabindex="-1"></a>           <span class="at">leg_right =</span> leg_prop <span class="sc">*</span> height <span class="sc">+</span> <span class="fu">rnorm</span>(n, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="fl">0.02</span>))</span>
<span id="cb470-9"><a href="the-haunted-dag-the-causal-terror.html#cb470-9" aria-hidden="true" tabindex="-1"></a>  fit <span class="ot">&lt;-</span> <span class="fu">update</span>(b6<span class="fl">.1</span>, <span class="at">newdata =</span> d) </span>
<span id="cb470-10"><a href="the-haunted-dag-the-causal-terror.html#cb470-10" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb470-11"><a href="the-haunted-dag-the-causal-terror.html#cb470-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb470-12"><a href="the-haunted-dag-the-causal-terror.html#cb470-12" aria-hidden="true" tabindex="-1"></a><span class="co">#sim &lt;-</span></span>
<span id="cb470-13"><a href="the-haunted-dag-the-causal-terror.html#cb470-13" aria-hidden="true" tabindex="-1"></a> <span class="co"># tibble(seed = 1:4) %&gt;% </span></span>
<span id="cb470-14"><a href="the-haunted-dag-the-causal-terror.html#cb470-14" aria-hidden="true" tabindex="-1"></a>  <span class="co">#mutate(post = purrr::map(seed, ~sim_and_fit(.) %&gt;% </span></span>
<span id="cb470-15"><a href="the-haunted-dag-the-causal-terror.html#cb470-15" aria-hidden="true" tabindex="-1"></a>   <span class="co">#                   posterior_samples()))</span></span>
<span id="cb470-16"><a href="the-haunted-dag-the-causal-terror.html#cb470-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb470-17"><a href="the-haunted-dag-the-causal-terror.html#cb470-17" aria-hidden="true" tabindex="-1"></a>sim <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;output/Chapter6/sim.rds&quot;</span>)</span>
<span id="cb470-18"><a href="the-haunted-dag-the-causal-terror.html#cb470-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb470-19"><a href="the-haunted-dag-the-causal-terror.html#cb470-19" aria-hidden="true" tabindex="-1"></a>sim <span class="sc">%&gt;%</span> </span>
<span id="cb470-20"><a href="the-haunted-dag-the-causal-terror.html#cb470-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(post) <span class="sc">%&gt;%</span></span>
<span id="cb470-21"><a href="the-haunted-dag-the-causal-terror.html#cb470-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(b_Intercept<span class="sc">:</span>sigma) <span class="sc">%&gt;%</span> </span>
<span id="cb470-22"><a href="the-haunted-dag-the-causal-terror.html#cb470-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">seed =</span> <span class="fu">str_c</span>(<span class="st">&quot;seed &quot;</span>, seed)) <span class="sc">%&gt;%</span> </span>
<span id="cb470-23"><a href="the-haunted-dag-the-causal-terror.html#cb470-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> value, <span class="at">y =</span> name)) <span class="sc">+</span></span>
<span id="cb470-24"><a href="the-haunted-dag-the-causal-terror.html#cb470-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_pointinterval</span>(<span class="at">.width =</span> .<span class="dv">95</span>, <span class="at">color =</span> <span class="st">&quot;forestgreen&quot;</span>) <span class="sc">+</span></span>
<span id="cb470-25"><a href="the-haunted-dag-the-causal-terror.html#cb470-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;posterior&quot;</span>, <span class="at">y =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb470-26"><a href="the-haunted-dag-the-causal-terror.html#cb470-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="dv">0</span>),</span>
<span id="cb470-27"><a href="the-haunted-dag-the-causal-terror.html#cb470-27" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.border =</span> <span class="fu">element_rect</span>(<span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">fill =</span> <span class="st">&quot;transparent&quot;</span>),</span>
<span id="cb470-28"><a href="the-haunted-dag-the-causal-terror.html#cb470-28" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb470-29"><a href="the-haunted-dag-the-causal-terror.html#cb470-29" aria-hidden="true" tabindex="-1"></a>        <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb470-30"><a href="the-haunted-dag-the-causal-terror.html#cb470-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> seed, <span class="at">ncol =</span> <span class="dv">1</span>)</span></code></pre></div>
<p><img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-210-1.png" width="672" style="display: block; margin: auto;" /></p>
<p><br /></p>
<p>両脚の係数は強く相関する。</p>
<div class="sourceCode" id="cb471"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb471-1"><a href="the-haunted-dag-the-causal-terror.html#cb471-1" aria-hidden="true" tabindex="-1"></a><span class="fu">posterior_samples</span>(b6<span class="fl">.1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb471-2"><a href="the-haunted-dag-the-causal-terror.html#cb471-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(b_leg_right,b_leg_left) <span class="sc">%&gt;%</span> </span>
<span id="cb471-3"><a href="the-haunted-dag-the-causal-terror.html#cb471-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>b_leg_right,<span class="at">y=</span>b_leg_left))<span class="sc">+</span></span>
<span id="cb471-4"><a href="the-haunted-dag-the-causal-terror.html#cb471-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()</span></code></pre></div>
<p><img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-211-1.png" width="672" style="display: block; margin: auto;" /></p>
<p><br /></p>
<p>また、両者の合計はおおよそどちらか一つの変数のみを説明変数に入れたときの係数(2程度)と一致する。</p>
<div class="sourceCode" id="cb472"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb472-1"><a href="the-haunted-dag-the-causal-terror.html#cb472-1" aria-hidden="true" tabindex="-1"></a><span class="fu">posterior_samples</span>(b6<span class="fl">.1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb472-2"><a href="the-haunted-dag-the-causal-terror.html#cb472-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">sum_b =</span> b_leg_left<span class="sc">+</span>b_leg_right) <span class="sc">%&gt;%</span> </span>
<span id="cb472-3"><a href="the-haunted-dag-the-causal-terror.html#cb472-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(sum_b) <span class="sc">%&gt;%</span></span>
<span id="cb472-4"><a href="the-haunted-dag-the-causal-terror.html#cb472-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>sum_b))<span class="sc">+</span></span>
<span id="cb472-5"><a href="the-haunted-dag-the-causal-terror.html#cb472-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>()</span></code></pre></div>
<p><img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-212-1.png" width="672" style="display: block; margin: auto;" /></p>
<p><br /></p>
<p>これは、左右の脚の長さが強く相関しているため、モデルが以下の式のように近似できると考えると上手く説明できる。</p>
$
<span class="math display">\[\begin{aligned}
y_{i} &amp;\sim Normal(\mu_{i}, \sigma)\\
\mu_{i} &amp;= \alpha + (\beta_{1} + \beta_{2})x_{i}
\end{aligned}\]</span>
<p>$</p>
<div class="sourceCode" id="cb473"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb473-1"><a href="the-haunted-dag-the-causal-terror.html#cb473-1" aria-hidden="true" tabindex="-1"></a>b6<span class="fl">.1</span>_2 <span class="ot">&lt;-</span> </span>
<span id="cb473-2"><a href="the-haunted-dag-the-causal-terror.html#cb473-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">brm</span>(<span class="at">data =</span> d,</span>
<span id="cb473-3"><a href="the-haunted-dag-the-causal-terror.html#cb473-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> gaussian,</span>
<span id="cb473-4"><a href="the-haunted-dag-the-causal-terror.html#cb473-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">formula =</span> height <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> leg_right,</span>
<span id="cb473-5"><a href="the-haunted-dag-the-causal-terror.html#cb473-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">10</span>,<span class="dv">100</span>),<span class="at">class=</span>Intercept),</span>
<span id="cb473-6"><a href="the-haunted-dag-the-causal-terror.html#cb473-6" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">2</span>,<span class="dv">10</span>),<span class="at">class=</span>b),</span>
<span id="cb473-7"><a href="the-haunted-dag-the-causal-terror.html#cb473-7" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>),<span class="at">class =</span> sigma)),</span>
<span id="cb473-8"><a href="the-haunted-dag-the-causal-terror.html#cb473-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">iter=</span><span class="dv">2000</span>,<span class="at">warmup=</span><span class="dv">1000</span>,<span class="at">chains=</span><span class="dv">4</span>,</span>
<span id="cb473-9"><a href="the-haunted-dag-the-causal-terror.html#cb473-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">backend =</span> <span class="st">&quot;cmdstanr&quot;</span>,</span>
<span id="cb473-10"><a href="the-haunted-dag-the-causal-terror.html#cb473-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">file =</span> <span class="st">&quot;output/Chapter6/b6.1_2&quot;</span>)</span>
<span id="cb473-11"><a href="the-haunted-dag-the-causal-terror.html#cb473-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb473-12"><a href="the-haunted-dag-the-causal-terror.html#cb473-12" aria-hidden="true" tabindex="-1"></a><span class="fu">posterior_summary</span>(b6<span class="fl">.1</span>_2) <span class="sc">%&gt;%</span> </span>
<span id="cb473-13"><a href="the-haunted-dag-the-causal-terror.html#cb473-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">round</span>(<span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb473-14"><a href="the-haunted-dag-the-causal-terror.html#cb473-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb473-15"><a href="the-haunted-dag-the-causal-terror.html#cb473-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>(<span class="at">var =</span> <span class="st">&quot;parameter&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb473-16"><a href="the-haunted-dag-the-causal-terror.html#cb473-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>()</span></code></pre></div>
<pre><code>## # A tibble: 5 × 5
##   parameter   Estimate Est.Error    Q2.5   Q97.5
##   &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;
## 1 b_Intercept     0.98      0.29    0.4     1.56
## 2 b_leg_right     2         0.06    1.87    2.12
## 3 sigma           0.63      0.05    0.55    0.72
## 4 lprior         -9.38      0.05   -9.47   -9.3 
## 5 lp__         -105.        1.24 -108.   -104.</code></pre>
<p><br /></p>
<div id="multicollinear-milk" class="section level3 hasAnchor" number="6.1.1">
<h3><span class="header-section-number">6.1.1</span> Multicollinear milk<a href="the-haunted-dag-the-causal-terror.html#multicollinear-milk" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>霊長類の母乳のデータを用いて考える。<br />
脂肪分の割合（F）とラクトースの割合（L）でカロリー（K）を予測することを考える。<br />
FとLは強く負に相関する。</p>
<div class="sourceCode" id="cb475"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb475-1"><a href="the-haunted-dag-the-causal-terror.html#cb475-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(milk)</span>
<span id="cb475-2"><a href="the-haunted-dag-the-causal-terror.html#cb475-2" aria-hidden="true" tabindex="-1"></a>d2 <span class="ot">&lt;-</span> milk <span class="sc">%&gt;%</span> </span>
<span id="cb475-3"><a href="the-haunted-dag-the-causal-terror.html#cb475-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">K =</span> <span class="fu">standardize</span>(kcal.per.g),</span>
<span id="cb475-4"><a href="the-haunted-dag-the-causal-terror.html#cb475-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">F =</span> <span class="fu">standardize</span>(perc.fat),</span>
<span id="cb475-5"><a href="the-haunted-dag-the-causal-terror.html#cb475-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">L =</span> <span class="fu">standardize</span>(perc.lactose))</span>
<span id="cb475-6"><a href="the-haunted-dag-the-causal-terror.html#cb475-6" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(d2)</span></code></pre></div>
<pre><code>##              clade            species kcal.per.g perc.fat perc.protein
## 1    Strepsirrhine     Eulemur fulvus       0.49    16.60        15.42
## 2    Strepsirrhine           E macaco       0.51    19.27        16.91
## 3    Strepsirrhine           E mongoz       0.46    14.11        16.85
## 4    Strepsirrhine      E rubriventer       0.48    14.91        13.18
## 5    Strepsirrhine        Lemur catta       0.60    27.28        19.50
## 6 New World Monkey Alouatta seniculus       0.47    21.22        23.58
##   perc.lactose mass neocortex.perc          K          F         L
## 1        67.98 1.95          55.16 -0.9400408 -1.2172427 1.3072619
## 2        63.82 2.09             NA -0.8161263 -1.0303552 1.0112855
## 3        69.04 2.51             NA -1.1259125 -1.3915310 1.3826790
## 4        71.91 1.62             NA -1.0019980 -1.3355347 1.5868743
## 5        53.22 2.19             NA -0.2585112 -0.4696927 0.2571148
## 6        55.20 5.25          64.54 -1.0639553 -0.8938643 0.3979882</code></pre>
<div class="sourceCode" id="cb477"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb477-1"><a href="the-haunted-dag-the-causal-terror.html#cb477-1" aria-hidden="true" tabindex="-1"></a>d2 <span class="sc">%&gt;%</span> </span>
<span id="cb477-2"><a href="the-haunted-dag-the-causal-terror.html#cb477-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(F,K,L) <span class="sc">%&gt;%</span> </span>
<span id="cb477-3"><a href="the-haunted-dag-the-causal-terror.html#cb477-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pairs</span>()</span></code></pre></div>
<p><img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-214-1.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb478"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb478-1"><a href="the-haunted-dag-the-causal-terror.html#cb478-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(GGally)</span>
<span id="cb478-2"><a href="the-haunted-dag-the-causal-terror.html#cb478-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggpairs</span>(<span class="at">data =</span> d2, <span class="at">columns =</span> <span class="dv">9</span><span class="sc">:</span><span class="dv">11</span>)</span></code></pre></div>
<p><img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-214-2.png" width="672" style="display: block; margin: auto;" />
<br /></p>
<p>それぞれの変数でモデリングしてみる。</p>
<div class="sourceCode" id="cb479"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb479-1"><a href="the-haunted-dag-the-causal-terror.html#cb479-1" aria-hidden="true" tabindex="-1"></a>b6<span class="fl">.2</span>_F <span class="ot">&lt;-</span> </span>
<span id="cb479-2"><a href="the-haunted-dag-the-causal-terror.html#cb479-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">brm</span>(<span class="at">data =</span> d2,</span>
<span id="cb479-3"><a href="the-haunted-dag-the-causal-terror.html#cb479-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> gaussian,</span>
<span id="cb479-4"><a href="the-haunted-dag-the-causal-terror.html#cb479-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">formula =</span> K <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> F,</span>
<span id="cb479-5"><a href="the-haunted-dag-the-causal-terror.html#cb479-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>,<span class="fl">0.2</span>),<span class="at">class=</span>Intercept),</span>
<span id="cb479-6"><a href="the-haunted-dag-the-causal-terror.html#cb479-6" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>,<span class="fl">0.5</span>),<span class="at">class=</span>b),</span>
<span id="cb479-7"><a href="the-haunted-dag-the-causal-terror.html#cb479-7" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>),<span class="at">class=</span>sigma)),</span>
<span id="cb479-8"><a href="the-haunted-dag-the-causal-terror.html#cb479-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">iter=</span><span class="dv">4000</span>, <span class="at">warmup =</span> <span class="dv">3000</span>, <span class="at">chains=</span><span class="dv">4</span>,</span>
<span id="cb479-9"><a href="the-haunted-dag-the-causal-terror.html#cb479-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">backend =</span> <span class="st">&quot;cmdstanr&quot;</span>,</span>
<span id="cb479-10"><a href="the-haunted-dag-the-causal-terror.html#cb479-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">file =</span> <span class="st">&quot;output/Chapter6/b6.2_F&quot;</span>)</span>
<span id="cb479-11"><a href="the-haunted-dag-the-causal-terror.html#cb479-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb479-12"><a href="the-haunted-dag-the-causal-terror.html#cb479-12" aria-hidden="true" tabindex="-1"></a>b6<span class="fl">.2</span>_L <span class="ot">&lt;-</span> </span>
<span id="cb479-13"><a href="the-haunted-dag-the-causal-terror.html#cb479-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">brm</span>(<span class="at">data =</span> d2,</span>
<span id="cb479-14"><a href="the-haunted-dag-the-causal-terror.html#cb479-14" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> gaussian,</span>
<span id="cb479-15"><a href="the-haunted-dag-the-causal-terror.html#cb479-15" aria-hidden="true" tabindex="-1"></a>      <span class="at">formula =</span> K <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> L,</span>
<span id="cb479-16"><a href="the-haunted-dag-the-causal-terror.html#cb479-16" aria-hidden="true" tabindex="-1"></a>      <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>,<span class="fl">0.2</span>),<span class="at">class=</span>Intercept),</span>
<span id="cb479-17"><a href="the-haunted-dag-the-causal-terror.html#cb479-17" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>,<span class="fl">0.5</span>),<span class="at">class=</span>b),</span>
<span id="cb479-18"><a href="the-haunted-dag-the-causal-terror.html#cb479-18" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>),<span class="at">class=</span>sigma)),</span>
<span id="cb479-19"><a href="the-haunted-dag-the-causal-terror.html#cb479-19" aria-hidden="true" tabindex="-1"></a>      <span class="at">iter=</span><span class="dv">4000</span>, <span class="at">warmup =</span> <span class="dv">3000</span>, <span class="at">chains=</span><span class="dv">4</span>,</span>
<span id="cb479-20"><a href="the-haunted-dag-the-causal-terror.html#cb479-20" aria-hidden="true" tabindex="-1"></a>      <span class="at">backend =</span> <span class="st">&quot;cmdstanr&quot;</span>,</span>
<span id="cb479-21"><a href="the-haunted-dag-the-causal-terror.html#cb479-21" aria-hidden="true" tabindex="-1"></a>      <span class="at">file =</span> <span class="st">&quot;output/Chapter6/b6.2_L&quot;</span>)</span>
<span id="cb479-22"><a href="the-haunted-dag-the-causal-terror.html#cb479-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb479-23"><a href="the-haunted-dag-the-causal-terror.html#cb479-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb479-24"><a href="the-haunted-dag-the-causal-terror.html#cb479-24" aria-hidden="true" tabindex="-1"></a><span class="fu">posterior_summary</span>(b6<span class="fl">.2</span>_F) <span class="sc">%&gt;%</span> </span>
<span id="cb479-25"><a href="the-haunted-dag-the-causal-terror.html#cb479-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">round</span>(<span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb479-26"><a href="the-haunted-dag-the-causal-terror.html#cb479-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb479-27"><a href="the-haunted-dag-the-causal-terror.html#cb479-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>(<span class="at">var =</span> <span class="st">&quot;parameter&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb479-28"><a href="the-haunted-dag-the-causal-terror.html#cb479-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>()</span></code></pre></div>
<pre><code>## # A tibble: 5 × 5
##   parameter   Estimate Est.Error   Q2.5  Q97.5
##   &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;
## 1 b_Intercept     0         0.08  -0.17   0.15
## 2 b_F             0.86      0.1    0.66   1.04
## 3 sigma           0.49      0.07   0.38   0.65
## 4 lprior         -1.6       0.36  -2.37  -0.98
## 5 lp__          -22.1       1.3  -25.5  -20.6</code></pre>
<div class="sourceCode" id="cb481"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb481-1"><a href="the-haunted-dag-the-causal-terror.html#cb481-1" aria-hidden="true" tabindex="-1"></a><span class="fu">posterior_summary</span>(b6<span class="fl">.2</span>_L) <span class="sc">%&gt;%</span> </span>
<span id="cb481-2"><a href="the-haunted-dag-the-causal-terror.html#cb481-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">round</span>(<span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb481-3"><a href="the-haunted-dag-the-causal-terror.html#cb481-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb481-4"><a href="the-haunted-dag-the-causal-terror.html#cb481-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>(<span class="at">var =</span> <span class="st">&quot;parameter&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb481-5"><a href="the-haunted-dag-the-causal-terror.html#cb481-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>()</span></code></pre></div>
<pre><code>## # A tibble: 5 × 5
##   parameter   Estimate Est.Error   Q2.5  Q97.5
##   &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;
## 1 b_Intercept     0         0.07  -0.14   0.14
## 2 b_L            -0.9       0.08  -1.05  -0.74
## 3 sigma           0.41      0.06   0.32   0.55
## 4 lprior         -1.63      0.3   -2.29  -1.12
## 5 lp__          -17.4       1.3  -20.8  -15.9</code></pre>
<p><br /></p>
<p>次に、両方の変数を説明変数に入れてモデリング。係数が変化しており、ばらつきも大きくなっている。</p>
<div class="sourceCode" id="cb483"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb483-1"><a href="the-haunted-dag-the-causal-terror.html#cb483-1" aria-hidden="true" tabindex="-1"></a>b6<span class="fl">.2</span>_LF <span class="ot">&lt;-</span> </span>
<span id="cb483-2"><a href="the-haunted-dag-the-causal-terror.html#cb483-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">brm</span>(<span class="at">data =</span> d2,</span>
<span id="cb483-3"><a href="the-haunted-dag-the-causal-terror.html#cb483-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> gaussian,</span>
<span id="cb483-4"><a href="the-haunted-dag-the-causal-terror.html#cb483-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">formula =</span> K <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> L <span class="sc">+</span> F,</span>
<span id="cb483-5"><a href="the-haunted-dag-the-causal-terror.html#cb483-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>,<span class="fl">0.2</span>),<span class="at">class=</span>Intercept),</span>
<span id="cb483-6"><a href="the-haunted-dag-the-causal-terror.html#cb483-6" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>,<span class="fl">0.5</span>),<span class="at">class=</span>b),</span>
<span id="cb483-7"><a href="the-haunted-dag-the-causal-terror.html#cb483-7" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>),<span class="at">class=</span>sigma)),</span>
<span id="cb483-8"><a href="the-haunted-dag-the-causal-terror.html#cb483-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">iter=</span><span class="dv">4000</span>, <span class="at">warmup =</span> <span class="dv">3000</span>, <span class="at">chains=</span><span class="dv">4</span>,</span>
<span id="cb483-9"><a href="the-haunted-dag-the-causal-terror.html#cb483-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">backend =</span> <span class="st">&quot;cmdstanr&quot;</span>,</span>
<span id="cb483-10"><a href="the-haunted-dag-the-causal-terror.html#cb483-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">file =</span> <span class="st">&quot;output/Chapter6/b6.2_LF&quot;</span>)</span>
<span id="cb483-11"><a href="the-haunted-dag-the-causal-terror.html#cb483-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb483-12"><a href="the-haunted-dag-the-causal-terror.html#cb483-12" aria-hidden="true" tabindex="-1"></a><span class="fu">posterior_summary</span>(b6<span class="fl">.2</span>_LF) <span class="sc">%&gt;%</span> </span>
<span id="cb483-13"><a href="the-haunted-dag-the-causal-terror.html#cb483-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">round</span>(<span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb483-14"><a href="the-haunted-dag-the-causal-terror.html#cb483-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb483-15"><a href="the-haunted-dag-the-causal-terror.html#cb483-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>(<span class="at">var =</span> <span class="st">&quot;parameter&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb483-16"><a href="the-haunted-dag-the-causal-terror.html#cb483-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>()</span></code></pre></div>
<pre><code>## # A tibble: 6 × 5
##   parameter   Estimate Est.Error   Q2.5  Q97.5
##   &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;
## 1 b_Intercept     0         0.07  -0.14   0.14
## 2 b_L            -0.67      0.2   -1.06  -0.25
## 3 b_F             0.25      0.19  -0.14   0.64
## 4 sigma           0.42      0.06   0.32   0.54
## 5 lprior         -1.42      0.43  -2.56  -0.87
## 6 lp__          -17.3       1.44 -20.9  -15.4</code></pre>
<div class="sourceCode" id="cb485"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb485-1"><a href="the-haunted-dag-the-causal-terror.html#cb485-1" aria-hidden="true" tabindex="-1"></a><span class="fu">posterior_summary</span>(b6<span class="fl">.2</span>_LF) <span class="sc">%&gt;%</span> </span>
<span id="cb485-2"><a href="the-haunted-dag-the-causal-terror.html#cb485-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">round</span>(<span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb485-3"><a href="the-haunted-dag-the-causal-terror.html#cb485-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb485-4"><a href="the-haunted-dag-the-causal-terror.html#cb485-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>(<span class="at">var =</span> <span class="st">&quot;parameter&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb485-5"><a href="the-haunted-dag-the-causal-terror.html#cb485-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>()</span></code></pre></div>
<pre><code>## # A tibble: 6 × 5
##   parameter   Estimate Est.Error   Q2.5  Q97.5
##   &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;
## 1 b_Intercept     0         0.07  -0.14   0.14
## 2 b_L            -0.67      0.2   -1.06  -0.25
## 3 b_F             0.25      0.19  -0.14   0.64
## 4 sigma           0.42      0.06   0.32   0.54
## 5 lprior         -1.42      0.43  -2.56  -0.87
## 6 lp__          -17.3       1.44 -20.9  -15.4</code></pre>
<p><br /></p>
<p>およらく、データには以下のような因果関係がある。</p>
<div class="sourceCode" id="cb487"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb487-1"><a href="the-haunted-dag-the-causal-terror.html#cb487-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggdag)</span>
<span id="cb487-2"><a href="the-haunted-dag-the-causal-terror.html#cb487-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb487-3"><a href="the-haunted-dag-the-causal-terror.html#cb487-3" aria-hidden="true" tabindex="-1"></a>dag_coords <span class="ot">&lt;-</span></span>
<span id="cb487-4"><a href="the-haunted-dag-the-causal-terror.html#cb487-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="at">name =</span> <span class="fu">c</span>(<span class="st">&quot;L&quot;</span>, <span class="st">&quot;D&quot;</span>, <span class="st">&quot;F&quot;</span>, <span class="st">&quot;K&quot;</span>),</span>
<span id="cb487-5"><a href="the-haunted-dag-the-causal-terror.html#cb487-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">x    =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">2</span>),</span>
<span id="cb487-6"><a href="the-haunted-dag-the-causal-terror.html#cb487-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">y    =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">1</span>))</span>
<span id="cb487-7"><a href="the-haunted-dag-the-causal-terror.html#cb487-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb487-8"><a href="the-haunted-dag-the-causal-terror.html#cb487-8" aria-hidden="true" tabindex="-1"></a><span class="fu">dagify</span>(L <span class="sc">~</span> D,</span>
<span id="cb487-9"><a href="the-haunted-dag-the-causal-terror.html#cb487-9" aria-hidden="true" tabindex="-1"></a>       F <span class="sc">~</span> D,</span>
<span id="cb487-10"><a href="the-haunted-dag-the-causal-terror.html#cb487-10" aria-hidden="true" tabindex="-1"></a>       K <span class="sc">~</span> L <span class="sc">+</span> F,</span>
<span id="cb487-11"><a href="the-haunted-dag-the-causal-terror.html#cb487-11" aria-hidden="true" tabindex="-1"></a>       <span class="at">coords =</span> dag_coords) <span class="sc">%&gt;%</span></span>
<span id="cb487-12"><a href="the-haunted-dag-the-causal-terror.html#cb487-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb487-13"><a href="the-haunted-dag-the-causal-terror.html#cb487-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">xend =</span> xend, <span class="at">yend =</span> yend)) <span class="sc">+</span></span>
<span id="cb487-14"><a href="the-haunted-dag-the-causal-terror.html#cb487-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_dag_point</span>(<span class="fu">aes</span>(<span class="at">color =</span> name <span class="sc">==</span> <span class="st">&quot;D&quot;</span>),</span>
<span id="cb487-15"><a href="the-haunted-dag-the-causal-terror.html#cb487-15" aria-hidden="true" tabindex="-1"></a>                 <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>, <span class="at">size =</span> <span class="fl">6.5</span>, <span class="at">show.legend =</span> F) <span class="sc">+</span></span>
<span id="cb487-16"><a href="the-haunted-dag-the-causal-terror.html#cb487-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">x =</span> <span class="dv">2</span>, <span class="at">y =</span> <span class="dv">2</span>, </span>
<span id="cb487-17"><a href="the-haunted-dag-the-causal-terror.html#cb487-17" aria-hidden="true" tabindex="-1"></a>             <span class="at">size =</span> <span class="fl">6.5</span>, <span class="at">shape =</span> <span class="dv">1</span>, <span class="at">stroke =</span> <span class="dv">1</span>, <span class="at">color =</span> <span class="st">&quot;orange&quot;</span>) <span class="sc">+</span></span>
<span id="cb487-18"><a href="the-haunted-dag-the-causal-terror.html#cb487-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_dag_text</span>(<span class="at">color =</span> <span class="st">&quot;black&quot;</span>) <span class="sc">+</span></span>
<span id="cb487-19"><a href="the-haunted-dag-the-causal-terror.html#cb487-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_dag_edges</span>() <span class="sc">+</span></span>
<span id="cb487-20"><a href="the-haunted-dag-the-causal-terror.html#cb487-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;steelblue&quot;</span>, <span class="st">&quot;orange&quot;</span>)) <span class="sc">+</span></span>
<span id="cb487-21"><a href="the-haunted-dag-the-causal-terror.html#cb487-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="cn">NULL</span>, <span class="at">breaks =</span> <span class="cn">NULL</span>, <span class="at">expand =</span> <span class="fu">c</span>(.<span class="dv">1</span>, .<span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb487-22"><a href="the-haunted-dag-the-causal-terror.html#cb487-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="cn">NULL</span>, <span class="at">breaks =</span> <span class="cn">NULL</span>, <span class="at">expand =</span> <span class="fu">c</span>(.<span class="dv">1</span>, .<span class="dv">1</span>))</span></code></pre></div>
<p><img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-217-1.png" width="672" style="display: block; margin: auto;" /></p>
<p><br /></p>
</div>
</div>
<div id="post-treatment-bias" class="section level2 hasAnchor" number="6.2">
<h2><span class="header-section-number">6.2</span> Post-treatment bias<a href="the-haunted-dag-the-causal-terror.html#post-treatment-bias" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>土中の真菌に対する処置を行った場合に植物の成長が早くなるかを検討する。<br />
ここでは、処置前の植物の高さ(h0)、処置の有無(T)、処置後の真菌の量(F)、処置後の植物の高さ(h1)を考える。どの変数をモデルに含めるべきだろうか?<br />
もし処置の結果を知りたいのであれば、Fを説明変数に入れてはいけない。それはpost-treatment effectだからである。</p>
<div class="sourceCode" id="cb488"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb488-1"><a href="the-haunted-dag-the-causal-terror.html#cb488-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">71</span>)</span>
<span id="cb488-2"><a href="the-haunted-dag-the-causal-terror.html#cb488-2" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb488-3"><a href="the-haunted-dag-the-causal-terror.html#cb488-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb488-4"><a href="the-haunted-dag-the-causal-terror.html#cb488-4" aria-hidden="true" tabindex="-1"></a>d3 <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb488-5"><a href="the-haunted-dag-the-causal-terror.html#cb488-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">h0 =</span> <span class="fu">rnorm</span>(n, <span class="dv">10</span>,<span class="dv">2</span>),</span>
<span id="cb488-6"><a href="the-haunted-dag-the-causal-terror.html#cb488-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">T =</span> <span class="fu">rep</span>(<span class="dv">0</span><span class="sc">:</span><span class="dv">1</span>,<span class="at">each=</span>n<span class="sc">/</span><span class="dv">2</span>),</span>
<span id="cb488-7"><a href="the-haunted-dag-the-causal-terror.html#cb488-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">F =</span> <span class="fu">rbinom</span>(n, <span class="at">size =</span> <span class="dv">1</span>, <span class="at">prob =</span> .<span class="dv">5</span> <span class="sc">-</span> T<span class="sc">*</span><span class="fl">0.4</span>),</span>
<span id="cb488-8"><a href="the-haunted-dag-the-causal-terror.html#cb488-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">h1 =</span> h0 <span class="sc">+</span> <span class="fu">rnorm</span>(n, <span class="at">mean =</span> <span class="dv">5-3</span><span class="sc">*</span>F, <span class="at">sd=</span><span class="dv">1</span>))</span>
<span id="cb488-9"><a href="the-haunted-dag-the-causal-terror.html#cb488-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb488-10"><a href="the-haunted-dag-the-causal-terror.html#cb488-10" aria-hidden="true" tabindex="-1"></a>d3 <span class="sc">%&gt;%</span> </span>
<span id="cb488-11"><a href="the-haunted-dag-the-causal-terror.html#cb488-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">everything</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb488-12"><a href="the-haunted-dag-the-causal-terror.html#cb488-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(name) <span class="sc">%&gt;%</span> </span>
<span id="cb488-13"><a href="the-haunted-dag-the-causal-terror.html#cb488-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mean_qi</span>(<span class="at">.width =</span> .<span class="dv">89</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb488-14"><a href="the-haunted-dag-the-causal-terror.html#cb488-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_if</span>(is.double, round, <span class="at">digits =</span> <span class="dv">2</span>)</span></code></pre></div>
<pre><code>## # A tibble: 4 × 7
##   name  value .lower .upper .width .point .interval
##   &lt;chr&gt; &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;    
## 1 F      0.23   0       1     0.89 mean   qi       
## 2 h0     9.96   6.57   13.1   0.89 mean   qi       
## 3 h1    14.4   10.6    17.9   0.89 mean   qi       
## 4 T      0.5    0       1     0.89 mean   qi</code></pre>
<p>まず、処置前の高さのみを入れた以下のモデルを考える。<br />
このとき、<span class="math inline">\(p\)</span>は必ず0以上になるので、事前分布として対数正規分布を用いる。</p>
<p><span class="math inline">\(h_{1,i} \sim Normal(\mu_{i}, \sigma)\)</span><br />
<span class="math inline">\(\mu_{i} = h_{0,i}×p\)</span><br />
<span class="math inline">\(p \sim Lognormal(0, 0.25)\)</span><br />
<span class="math inline">\(\sigma \sim Exponential(1)\)</span></p>
<p><br /></p>
<p>推定結果は以下の通り。<br />
40%強の成長が見込まれる。</p>
<div class="sourceCode" id="cb490"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb490-1"><a href="the-haunted-dag-the-causal-terror.html#cb490-1" aria-hidden="true" tabindex="-1"></a>b6<span class="fl">.3</span>_h <span class="ot">&lt;-</span> </span>
<span id="cb490-2"><a href="the-haunted-dag-the-causal-terror.html#cb490-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">brm</span>(<span class="at">data=</span>d3,</span>
<span id="cb490-3"><a href="the-haunted-dag-the-causal-terror.html#cb490-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> gaussian,</span>
<span id="cb490-4"><a href="the-haunted-dag-the-causal-terror.html#cb490-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">formula =</span> h1 <span class="sc">~</span> <span class="dv">0</span> <span class="sc">+</span> h0,</span>
<span id="cb490-5"><a href="the-haunted-dag-the-causal-terror.html#cb490-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">lognormal</span>(<span class="dv">0</span>, <span class="fl">0.25</span>),<span class="at">class =</span> b),</span>
<span id="cb490-6"><a href="the-haunted-dag-the-causal-terror.html#cb490-6" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>), <span class="at">class =</span> sigma)),</span>
<span id="cb490-7"><a href="the-haunted-dag-the-causal-terror.html#cb490-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>, <span class="at">chains =</span> <span class="dv">4</span>,</span>
<span id="cb490-8"><a href="the-haunted-dag-the-causal-terror.html#cb490-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">backend =</span> <span class="st">&quot;cmdstanr&quot;</span>,</span>
<span id="cb490-9"><a href="the-haunted-dag-the-causal-terror.html#cb490-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">file =</span> <span class="st">&quot;output/Chapter6/b6.3_h&quot;</span>)</span>
<span id="cb490-10"><a href="the-haunted-dag-the-causal-terror.html#cb490-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb490-11"><a href="the-haunted-dag-the-causal-terror.html#cb490-11" aria-hidden="true" tabindex="-1"></a><span class="fu">posterior_summary</span>(b6<span class="fl">.3</span>_h) <span class="sc">%&gt;%</span> </span>
<span id="cb490-12"><a href="the-haunted-dag-the-causal-terror.html#cb490-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">round</span>(<span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb490-13"><a href="the-haunted-dag-the-causal-terror.html#cb490-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb490-14"><a href="the-haunted-dag-the-causal-terror.html#cb490-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>(<span class="at">var =</span> <span class="st">&quot;parameter&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb490-15"><a href="the-haunted-dag-the-causal-terror.html#cb490-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>()</span></code></pre></div>
<pre><code>## # A tibble: 4 × 5
##   parameter Estimate Est.Error    Q2.5   Q97.5
##   &lt;chr&gt;        &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;
## 1 b_h0          1.43      0.02    1.39    1.46
## 2 sigma         1.83      0.13    1.59    2.11
## 3 lprior       -2.72      0.16   -3.07   -2.44
## 4 lp__       -204.        1.02 -207.   -203.</code></pre>
<p><br /></p>
<p>続いて、処置の有無(T)と処置後の真菌の有無(F)もいれた以下のモデルを考える。<br />
<br /></p>
<p><span class="math inline">\(h_{1,i} \sim Normal(\mu_{i}, \sigma)\)</span><br />
<span class="math inline">\(\mu_{i} = h_{0,i}×p\)</span><br />
<span class="math inline">\(p = \alpha + \beta_{T}T_{i} + \beta_{F}F_{i}\)</span><br />
<span class="math inline">\(\alpha \sim Lognormal(0, 0.25)\)</span>
<span class="math inline">\(\beta \sim Normal(0, 0.5)\)</span><br />
<span class="math inline">\(\sigma \sim Exponential(1)\)</span></p>
<p><br /></p>
<p>結果、処置の結果が0に近いと推定される。</p>
<div class="sourceCode" id="cb492"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb492-1"><a href="the-haunted-dag-the-causal-terror.html#cb492-1" aria-hidden="true" tabindex="-1"></a>b6<span class="fl">.3</span>_htf <span class="ot">&lt;-</span> </span>
<span id="cb492-2"><a href="the-haunted-dag-the-causal-terror.html#cb492-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">brm</span>(</span>
<span id="cb492-3"><a href="the-haunted-dag-the-causal-terror.html#cb492-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> d3,</span>
<span id="cb492-4"><a href="the-haunted-dag-the-causal-terror.html#cb492-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">family =</span> gaussian,</span>
<span id="cb492-5"><a href="the-haunted-dag-the-causal-terror.html#cb492-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">formula =</span> <span class="fu">bf</span>(h1 <span class="sc">~</span> h0<span class="sc">*</span>(a <span class="sc">+</span> t<span class="sc">*</span>T <span class="sc">+</span> f<span class="sc">*</span>F),</span>
<span id="cb492-6"><a href="the-haunted-dag-the-causal-terror.html#cb492-6" aria-hidden="true" tabindex="-1"></a>                   a<span class="sc">+</span>t<span class="sc">+</span>f <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb492-7"><a href="the-haunted-dag-the-causal-terror.html#cb492-7" aria-hidden="true" tabindex="-1"></a>                   <span class="at">nl =</span> <span class="cn">TRUE</span>),</span>
<span id="cb492-8"><a href="the-haunted-dag-the-causal-terror.html#cb492-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">prior=</span><span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">lognormal</span>(<span class="dv">0</span>,<span class="fl">0.2</span>),<span class="at">nlpar =</span> a,<span class="at">lb =</span> <span class="dv">0</span>),</span>
<span id="cb492-9"><a href="the-haunted-dag-the-causal-terror.html#cb492-9" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">0.5</span>), <span class="at">nlpar =</span> t),</span>
<span id="cb492-10"><a href="the-haunted-dag-the-causal-terror.html#cb492-10" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">0.5</span>), <span class="at">nlpar =</span> f),</span>
<span id="cb492-11"><a href="the-haunted-dag-the-causal-terror.html#cb492-11" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>), <span class="at">class =</span> sigma)),</span>
<span id="cb492-12"><a href="the-haunted-dag-the-causal-terror.html#cb492-12" aria-hidden="true" tabindex="-1"></a>      <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>, <span class="at">chains =</span> <span class="dv">4</span>,</span>
<span id="cb492-13"><a href="the-haunted-dag-the-causal-terror.html#cb492-13" aria-hidden="true" tabindex="-1"></a>      <span class="at">seed=</span><span class="dv">6</span>,</span>
<span id="cb492-14"><a href="the-haunted-dag-the-causal-terror.html#cb492-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">backend =</span> <span class="st">&quot;cmdstanr&quot;</span>,</span>
<span id="cb492-15"><a href="the-haunted-dag-the-causal-terror.html#cb492-15" aria-hidden="true" tabindex="-1"></a>      <span class="at">file =</span> <span class="st">&quot;output/Chapter6/b6.3_htf&quot;</span></span>
<span id="cb492-16"><a href="the-haunted-dag-the-causal-terror.html#cb492-16" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb492-17"><a href="the-haunted-dag-the-causal-terror.html#cb492-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb492-18"><a href="the-haunted-dag-the-causal-terror.html#cb492-18" aria-hidden="true" tabindex="-1"></a><span class="fu">posterior_summary</span>(b6<span class="fl">.3</span>_htf) <span class="sc">%&gt;%</span> </span>
<span id="cb492-19"><a href="the-haunted-dag-the-causal-terror.html#cb492-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">round</span>(<span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb492-20"><a href="the-haunted-dag-the-causal-terror.html#cb492-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb492-21"><a href="the-haunted-dag-the-causal-terror.html#cb492-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>(<span class="at">var =</span> <span class="st">&quot;parameter&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb492-22"><a href="the-haunted-dag-the-causal-terror.html#cb492-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>()</span></code></pre></div>
<pre><code>## # A tibble: 6 × 5
##   parameter     Estimate Est.Error    Q2.5   Q97.5
##   &lt;chr&gt;            &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;
## 1 b_a_Intercept     1.48      0.03    1.43    1.53
## 2 b_t_Intercept     0         0.03   -0.06    0.06
## 3 b_f_Intercept    -0.27      0.04   -0.34   -0.19
## 4 sigma             1.45      0.1     1.26    1.67
## 5 lprior           -3.68      0.23   -4.17   -3.26
## 6 lp__           -182.        1.5  -186.   -180.</code></pre>
<div class="sourceCode" id="cb494"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb494-1"><a href="the-haunted-dag-the-causal-terror.html#cb494-1" aria-hidden="true" tabindex="-1"></a><span class="fu">pairs</span>(b6<span class="fl">.3</span>_htf)</span></code></pre></div>
<p><img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-221-1.png" width="672" style="display: block; margin: auto;" /></p>
<div id="blocked-by-consequence" class="section level3 hasAnchor" number="6.2.1">
<h3><span class="header-section-number">6.2.1</span> Blocked by consequence<a href="the-haunted-dag-the-causal-terror.html#blocked-by-consequence" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>これは、処置後の真菌を入れたことによって、T -&gt; h1へのパスがブロックされたからである。（<strong>h1とTについてバックドア基準を満たさない</strong>）<br />
よって、Fを除外してモデリングする必要がある。</p>
<div class="sourceCode" id="cb495"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb495-1"><a href="the-haunted-dag-the-causal-terror.html#cb495-1" aria-hidden="true" tabindex="-1"></a>b6<span class="fl">.3</span>_ht <span class="ot">&lt;-</span> </span>
<span id="cb495-2"><a href="the-haunted-dag-the-causal-terror.html#cb495-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">brm</span>(</span>
<span id="cb495-3"><a href="the-haunted-dag-the-causal-terror.html#cb495-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> d3,</span>
<span id="cb495-4"><a href="the-haunted-dag-the-causal-terror.html#cb495-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">family =</span> gaussian,</span>
<span id="cb495-5"><a href="the-haunted-dag-the-causal-terror.html#cb495-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">formula =</span> <span class="fu">bf</span>(h1 <span class="sc">~</span> h0<span class="sc">*</span>(a <span class="sc">+</span> t<span class="sc">*</span>T),</span>
<span id="cb495-6"><a href="the-haunted-dag-the-causal-terror.html#cb495-6" aria-hidden="true" tabindex="-1"></a>                   a<span class="sc">+</span>t <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb495-7"><a href="the-haunted-dag-the-causal-terror.html#cb495-7" aria-hidden="true" tabindex="-1"></a>                   <span class="at">nl =</span> <span class="cn">TRUE</span>),</span>
<span id="cb495-8"><a href="the-haunted-dag-the-causal-terror.html#cb495-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">prior=</span><span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">lognormal</span>(<span class="dv">0</span>,<span class="fl">0.2</span>),<span class="at">nlpar =</span> a,<span class="at">lb =</span> <span class="dv">0</span>),</span>
<span id="cb495-9"><a href="the-haunted-dag-the-causal-terror.html#cb495-9" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">0.5</span>), <span class="at">nlpar =</span> t),</span>
<span id="cb495-10"><a href="the-haunted-dag-the-causal-terror.html#cb495-10" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>), <span class="at">class =</span> sigma)),</span>
<span id="cb495-11"><a href="the-haunted-dag-the-causal-terror.html#cb495-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>, <span class="at">chains =</span> <span class="dv">4</span>,</span>
<span id="cb495-12"><a href="the-haunted-dag-the-causal-terror.html#cb495-12" aria-hidden="true" tabindex="-1"></a>      <span class="at">seed =</span><span class="dv">6</span>,</span>
<span id="cb495-13"><a href="the-haunted-dag-the-causal-terror.html#cb495-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">backend =</span> <span class="st">&quot;cmdstanr&quot;</span>,</span>
<span id="cb495-14"><a href="the-haunted-dag-the-causal-terror.html#cb495-14" aria-hidden="true" tabindex="-1"></a>      <span class="at">file =</span> <span class="st">&quot;output/Chapter6/b6.3_ht&quot;</span></span>
<span id="cb495-15"><a href="the-haunted-dag-the-causal-terror.html#cb495-15" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb495-16"><a href="the-haunted-dag-the-causal-terror.html#cb495-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb495-17"><a href="the-haunted-dag-the-causal-terror.html#cb495-17" aria-hidden="true" tabindex="-1"></a><span class="fu">posterior_summary</span>(b6<span class="fl">.3</span>_ht) <span class="sc">%&gt;%</span> </span>
<span id="cb495-18"><a href="the-haunted-dag-the-causal-terror.html#cb495-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">round</span>(<span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb495-19"><a href="the-haunted-dag-the-causal-terror.html#cb495-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb495-20"><a href="the-haunted-dag-the-causal-terror.html#cb495-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>(<span class="at">var =</span> <span class="st">&quot;parameter&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb495-21"><a href="the-haunted-dag-the-causal-terror.html#cb495-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>()</span></code></pre></div>
<pre><code>## # A tibble: 5 × 5
##   parameter     Estimate Est.Error    Q2.5   Q97.5
##   &lt;chr&gt;            &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;
## 1 b_a_Intercept     1.38      0.03    1.33    1.43
## 2 b_t_Intercept     0.08      0.04    0.02    0.15
## 3 sigma             1.79      0.13    1.56    2.05
## 4 lprior           -2.97      0.2    -3.39   -2.6 
## 5 lp__           -202.        1.23 -205.   -201.</code></pre>
<p><br /></p>
</div>
<div id="fungus-and-d-separation" class="section level3 hasAnchor" number="6.2.2">
<h3><span class="header-section-number">6.2.2</span> Fungus and d-separation<a href="the-haunted-dag-the-causal-terror.html#fungus-and-d-separation" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>DAGを用いて考えてみる。</p>
<div class="sourceCode" id="cb497"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb497-1"><a href="the-haunted-dag-the-causal-terror.html#cb497-1" aria-hidden="true" tabindex="-1"></a>dag_coords <span class="ot">&lt;-</span></span>
<span id="cb497-2"><a href="the-haunted-dag-the-causal-terror.html#cb497-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="at">name =</span> <span class="fu">c</span>(<span class="st">&quot;H0&quot;</span>, <span class="st">&quot;T&quot;</span>, <span class="st">&quot;F&quot;</span>, <span class="st">&quot;H1&quot;</span>),</span>
<span id="cb497-3"><a href="the-haunted-dag-the-causal-terror.html#cb497-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">x    =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">5</span>, <span class="dv">4</span>, <span class="dv">3</span>),</span>
<span id="cb497-4"><a href="the-haunted-dag-the-causal-terror.html#cb497-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">y    =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">2</span>, <span class="fl">1.5</span>, <span class="dv">1</span>))</span>
<span id="cb497-5"><a href="the-haunted-dag-the-causal-terror.html#cb497-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb497-6"><a href="the-haunted-dag-the-causal-terror.html#cb497-6" aria-hidden="true" tabindex="-1"></a>dag <span class="ot">&lt;-</span></span>
<span id="cb497-7"><a href="the-haunted-dag-the-causal-terror.html#cb497-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dagify</span>(F <span class="sc">~</span> T,</span>
<span id="cb497-8"><a href="the-haunted-dag-the-causal-terror.html#cb497-8" aria-hidden="true" tabindex="-1"></a>         H1 <span class="sc">~</span> H0 <span class="sc">+</span> F,</span>
<span id="cb497-9"><a href="the-haunted-dag-the-causal-terror.html#cb497-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">coords =</span> dag_coords)</span></code></pre></div>
<p><img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-224-1.png" width="672" style="display: block; margin: auto;" />
<br /></p>
<p>上記の因果モデルにおいて、条件付き独立を求めると、Fで条件づけたときにH1とTが独立になってしまうことが分かる。<br />
このとき、H1とTはFで条件づけたときに<strong>d分離している</strong>という。</p>
<div class="sourceCode" id="cb498"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb498-1"><a href="the-haunted-dag-the-causal-terror.html#cb498-1" aria-hidden="true" tabindex="-1"></a><span class="fu">impliedConditionalIndependencies</span>(dag)</span></code></pre></div>
<pre><code>## F _||_ H0
## H0 _||_ T
## H1 _||_ T | F</code></pre>
<p><br /></p>
<p>続いて、以下のような因果モデルを考える。<br />
このモデルでは、H0と水分(M、非観測変数)のみがH1に影響を与え、MとTがFに影響を与えるとする。このとき,
Tだけを説明変数に入れてもH1との関連は見られないが、Fを入れるとTとH1に関連がみられる。</p>
<div class="sourceCode" id="cb500"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb500-1"><a href="the-haunted-dag-the-causal-terror.html#cb500-1" aria-hidden="true" tabindex="-1"></a>dag_coords <span class="ot">&lt;-</span></span>
<span id="cb500-2"><a href="the-haunted-dag-the-causal-terror.html#cb500-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="at">name =</span> <span class="fu">c</span>(<span class="st">&quot;H0&quot;</span>, <span class="st">&quot;H1&quot;</span>, <span class="st">&quot;M&quot;</span>, <span class="st">&quot;F&quot;</span>, <span class="st">&quot;T&quot;</span>),</span>
<span id="cb500-3"><a href="the-haunted-dag-the-causal-terror.html#cb500-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">x    =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="fl">2.5</span>, <span class="dv">3</span>, <span class="dv">4</span>),</span>
<span id="cb500-4"><a href="the-haunted-dag-the-causal-terror.html#cb500-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">y    =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">2</span>))</span>
<span id="cb500-5"><a href="the-haunted-dag-the-causal-terror.html#cb500-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb500-6"><a href="the-haunted-dag-the-causal-terror.html#cb500-6" aria-hidden="true" tabindex="-1"></a><span class="co"># save our DAG</span></span>
<span id="cb500-7"><a href="the-haunted-dag-the-causal-terror.html#cb500-7" aria-hidden="true" tabindex="-1"></a>dag <span class="ot">&lt;-</span></span>
<span id="cb500-8"><a href="the-haunted-dag-the-causal-terror.html#cb500-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dagify</span>(F <span class="sc">~</span> M <span class="sc">+</span> T,</span>
<span id="cb500-9"><a href="the-haunted-dag-the-causal-terror.html#cb500-9" aria-hidden="true" tabindex="-1"></a>         H1 <span class="sc">~</span> H0 <span class="sc">+</span> M,</span>
<span id="cb500-10"><a href="the-haunted-dag-the-causal-terror.html#cb500-10" aria-hidden="true" tabindex="-1"></a>         <span class="at">coords =</span> dag_coords)</span>
<span id="cb500-11"><a href="the-haunted-dag-the-causal-terror.html#cb500-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb500-12"><a href="the-haunted-dag-the-causal-terror.html#cb500-12" aria-hidden="true" tabindex="-1"></a>dag <span class="sc">%&gt;%</span></span>
<span id="cb500-13"><a href="the-haunted-dag-the-causal-terror.html#cb500-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">xend =</span> xend, <span class="at">yend =</span> yend)) <span class="sc">+</span></span>
<span id="cb500-14"><a href="the-haunted-dag-the-causal-terror.html#cb500-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_dag_point</span>(<span class="fu">aes</span>(<span class="at">color =</span> name <span class="sc">==</span> <span class="st">&quot;M&quot;</span>),</span>
<span id="cb500-15"><a href="the-haunted-dag-the-causal-terror.html#cb500-15" aria-hidden="true" tabindex="-1"></a>                 <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>, <span class="at">size =</span> <span class="fl">6.5</span>, <span class="at">show.legend =</span> F) <span class="sc">+</span></span>
<span id="cb500-16"><a href="the-haunted-dag-the-causal-terror.html#cb500-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">x =</span> <span class="fl">2.5</span>, <span class="at">y =</span> <span class="dv">1</span>, </span>
<span id="cb500-17"><a href="the-haunted-dag-the-causal-terror.html#cb500-17" aria-hidden="true" tabindex="-1"></a>             <span class="at">size =</span> <span class="fl">6.5</span>, <span class="at">shape =</span> <span class="dv">1</span>, <span class="at">stroke =</span> <span class="dv">1</span>, <span class="at">color =</span> <span class="st">&quot;orange&quot;</span>) <span class="sc">+</span></span>
<span id="cb500-18"><a href="the-haunted-dag-the-causal-terror.html#cb500-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_dag_text</span>(<span class="at">color =</span> <span class="st">&quot;black&quot;</span>) <span class="sc">+</span></span>
<span id="cb500-19"><a href="the-haunted-dag-the-causal-terror.html#cb500-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_dag_edges</span>() <span class="sc">+</span> </span>
<span id="cb500-20"><a href="the-haunted-dag-the-causal-terror.html#cb500-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;steelblue&quot;</span>, <span class="st">&quot;orange&quot;</span>)) <span class="sc">+</span></span>
<span id="cb500-21"><a href="the-haunted-dag-the-causal-terror.html#cb500-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_dag</span>()</span></code></pre></div>
<p><img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-226-1.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb501"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb501-1"><a href="the-haunted-dag-the-causal-terror.html#cb501-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">71</span>)</span>
<span id="cb501-2"><a href="the-haunted-dag-the-causal-terror.html#cb501-2" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">1000</span></span>
<span id="cb501-3"><a href="the-haunted-dag-the-causal-terror.html#cb501-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb501-4"><a href="the-haunted-dag-the-causal-terror.html#cb501-4" aria-hidden="true" tabindex="-1"></a>d4 <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb501-5"><a href="the-haunted-dag-the-causal-terror.html#cb501-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">h0 =</span> <span class="fu">rnorm</span>(n, <span class="dv">10</span>,<span class="dv">2</span>),</span>
<span id="cb501-6"><a href="the-haunted-dag-the-causal-terror.html#cb501-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">T =</span> <span class="fu">rep</span>(<span class="dv">0</span><span class="sc">:</span><span class="dv">1</span>, <span class="at">each =</span> n<span class="sc">/</span><span class="dv">2</span>),</span>
<span id="cb501-7"><a href="the-haunted-dag-the-causal-terror.html#cb501-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">M =</span> <span class="fu">rbern</span>(n),</span>
<span id="cb501-8"><a href="the-haunted-dag-the-causal-terror.html#cb501-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">F =</span> <span class="fu">rbinom</span>(n, <span class="at">size=</span><span class="dv">1</span>, <span class="at">prob =</span> <span class="fl">0.5</span><span class="sc">-</span>T<span class="sc">*</span><span class="fl">0.4+0.4</span><span class="sc">*</span>M),</span>
<span id="cb501-9"><a href="the-haunted-dag-the-causal-terror.html#cb501-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">h1 =</span> h0 <span class="sc">+</span> <span class="fu">rnorm</span>(n, <span class="at">mean =</span><span class="dv">5</span> <span class="sc">+</span> <span class="dv">3</span><span class="sc">*</span>M, <span class="at">sd=</span><span class="dv">1</span>)</span>
<span id="cb501-10"><a href="the-haunted-dag-the-causal-terror.html#cb501-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb501-11"><a href="the-haunted-dag-the-causal-terror.html#cb501-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb501-12"><a href="the-haunted-dag-the-causal-terror.html#cb501-12" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(d4)</span></code></pre></div>
<pre><code>## # A tibble: 6 × 5
##      h0     T     M     F    h1
##   &lt;dbl&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;dbl&gt;
## 1  9.14     0     0     0  14.8
## 2  9.11     0     0     0  15.3
## 3  9.04     0     1     1  16.4
## 4 10.8      0     1     1  19.1
## 5  9.16     0     1     1  17.2
## 6  7.63     0     0     0  13.4</code></pre>
<div class="sourceCode" id="cb503"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb503-1"><a href="the-haunted-dag-the-causal-terror.html#cb503-1" aria-hidden="true" tabindex="-1"></a>b6<span class="fl">.3</span>_ht2 <span class="ot">&lt;-</span> </span>
<span id="cb503-2"><a href="the-haunted-dag-the-causal-terror.html#cb503-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">update</span>(b6<span class="fl">.3</span>_ht,</span>
<span id="cb503-3"><a href="the-haunted-dag-the-causal-terror.html#cb503-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">newdata =</span> d4,</span>
<span id="cb503-4"><a href="the-haunted-dag-the-causal-terror.html#cb503-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">seed =</span><span class="dv">6</span>,</span>
<span id="cb503-5"><a href="the-haunted-dag-the-causal-terror.html#cb503-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">file =</span> <span class="st">&quot;output/Chapter6/b6.3_ht2&quot;</span>)</span>
<span id="cb503-6"><a href="the-haunted-dag-the-causal-terror.html#cb503-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb503-7"><a href="the-haunted-dag-the-causal-terror.html#cb503-7" aria-hidden="true" tabindex="-1"></a>b6<span class="fl">.3</span>_htf2 <span class="ot">&lt;-</span> </span>
<span id="cb503-8"><a href="the-haunted-dag-the-causal-terror.html#cb503-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">update</span>(b6<span class="fl">.3</span>_htf,</span>
<span id="cb503-9"><a href="the-haunted-dag-the-causal-terror.html#cb503-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">newdata =</span> d4,</span>
<span id="cb503-10"><a href="the-haunted-dag-the-causal-terror.html#cb503-10" aria-hidden="true" tabindex="-1"></a>         <span class="at">seed =</span><span class="dv">6</span>,</span>
<span id="cb503-11"><a href="the-haunted-dag-the-causal-terror.html#cb503-11" aria-hidden="true" tabindex="-1"></a>         <span class="at">file =</span> <span class="st">&quot;output/Chapter6/b6.3_htf2&quot;</span>)</span>
<span id="cb503-12"><a href="the-haunted-dag-the-causal-terror.html#cb503-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb503-13"><a href="the-haunted-dag-the-causal-terror.html#cb503-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb503-14"><a href="the-haunted-dag-the-causal-terror.html#cb503-14" aria-hidden="true" tabindex="-1"></a><span class="fu">posterior_summary</span>(b6<span class="fl">.3</span>_ht2) <span class="sc">%&gt;%</span> </span>
<span id="cb503-15"><a href="the-haunted-dag-the-causal-terror.html#cb503-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">round</span>(<span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb503-16"><a href="the-haunted-dag-the-causal-terror.html#cb503-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb503-17"><a href="the-haunted-dag-the-causal-terror.html#cb503-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>(<span class="at">var =</span> <span class="st">&quot;parameter&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb503-18"><a href="the-haunted-dag-the-causal-terror.html#cb503-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>()</span></code></pre></div>
<pre><code>## # A tibble: 5 × 5
##   parameter     Estimate Est.Error     Q2.5    Q97.5
##   &lt;chr&gt;            &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;
## 1 b_a_Intercept     1.62      0.01     1.6      1.64
## 2 b_t_Intercept    -0.01      0.01    -0.04     0.02
## 3 sigma             2.21      0.05     2.12     2.31
## 4 lprior           -5.17      0.09    -5.36    -4.99
## 5 lp__          -2216.        1.21 -2219.   -2215.</code></pre>
<div class="sourceCode" id="cb505"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb505-1"><a href="the-haunted-dag-the-causal-terror.html#cb505-1" aria-hidden="true" tabindex="-1"></a><span class="fu">posterior_summary</span>(b6<span class="fl">.3</span>_htf2) <span class="sc">%&gt;%</span> </span>
<span id="cb505-2"><a href="the-haunted-dag-the-causal-terror.html#cb505-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">round</span>(<span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb505-3"><a href="the-haunted-dag-the-causal-terror.html#cb505-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb505-4"><a href="the-haunted-dag-the-causal-terror.html#cb505-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>(<span class="at">var =</span> <span class="st">&quot;parameter&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb505-5"><a href="the-haunted-dag-the-causal-terror.html#cb505-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>()</span></code></pre></div>
<pre><code>## # A tibble: 6 × 5
##   parameter     Estimate Est.Error     Q2.5    Q97.5
##   &lt;chr&gt;            &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;
## 1 b_a_Intercept     1.52      0.01     1.5      1.55
## 2 b_t_Intercept     0.05      0.01     0.02     0.08
## 3 b_f_Intercept     0.14      0.01     0.12     0.17
## 4 sigma             2.11      0.05     2.02     2.2 
## 5 lprior           -4.54      0.11    -4.75    -4.34
## 6 lp__          -2169.        1.41 -2172.   -2167.</code></pre>
<p><br /></p>
<p>これはなぜだろうか？<br />
次節でこの問題を見ていく。</p>
<p><br /></p>
</div>
</div>
<div id="collider-bias" class="section level2 hasAnchor" number="6.3">
<h2><span class="header-section-number">6.3</span> Collider bias<a href="the-haunted-dag-the-causal-terror.html#collider-bias" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>再び、本章冒頭の例を考える。<br />
DAGは以下のようになる。</p>
<div class="sourceCode" id="cb507"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb507-1"><a href="the-haunted-dag-the-causal-terror.html#cb507-1" aria-hidden="true" tabindex="-1"></a>dag_coords <span class="ot">&lt;-</span></span>
<span id="cb507-2"><a href="the-haunted-dag-the-causal-terror.html#cb507-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="at">name =</span> <span class="fu">c</span>(<span class="st">&quot;T&quot;</span>, <span class="st">&quot;S&quot;</span>, <span class="st">&quot;N&quot;</span>),</span>
<span id="cb507-3"><a href="the-haunted-dag-the-causal-terror.html#cb507-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">x    =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>),</span>
<span id="cb507-4"><a href="the-haunted-dag-the-causal-terror.html#cb507-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">y    =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">2</span>))</span>
<span id="cb507-5"><a href="the-haunted-dag-the-causal-terror.html#cb507-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb507-6"><a href="the-haunted-dag-the-causal-terror.html#cb507-6" aria-hidden="true" tabindex="-1"></a>dag <span class="ot">&lt;-</span> <span class="fu">dagify</span>(S <span class="sc">~</span> T,</span>
<span id="cb507-7"><a href="the-haunted-dag-the-causal-terror.html#cb507-7" aria-hidden="true" tabindex="-1"></a>       S <span class="sc">~</span> N,</span>
<span id="cb507-8"><a href="the-haunted-dag-the-causal-terror.html#cb507-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">coords =</span> dag_coords)</span>
<span id="cb507-9"><a href="the-haunted-dag-the-causal-terror.html#cb507-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb507-10"><a href="the-haunted-dag-the-causal-terror.html#cb507-10" aria-hidden="true" tabindex="-1"></a><span class="fu">gg_simple_dag</span>(dag)</span></code></pre></div>
<p><img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-229-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>このとき、Sについて条件づけると、TとNの間に疑似相関が生じてしまう。</p>
<div id="collider-of-false-sorrow" class="section level3 hasAnchor" number="6.3.1">
<h3><span class="header-section-number">6.3.1</span> Collider of false sorrow<a href="the-haunted-dag-the-causal-terror.html#collider-of-false-sorrow" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>年齢(A)が幸福(H)にどう影響するかを検討したいとする。<br />
ここでは、幸せは生まれた瞬間に決定し、年齢とは関係ないと仮定する。一方で、年齢と幸福が結婚(M)に影響を与えるとする。<br />
DAGは以下の通り。</p>
<div class="sourceCode" id="cb508"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb508-1"><a href="the-haunted-dag-the-causal-terror.html#cb508-1" aria-hidden="true" tabindex="-1"></a>dag_coords <span class="ot">&lt;-</span></span>
<span id="cb508-2"><a href="the-haunted-dag-the-causal-terror.html#cb508-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="at">name =</span> <span class="fu">c</span>(<span class="st">&quot;H&quot;</span>, <span class="st">&quot;M&quot;</span>, <span class="st">&quot;A&quot;</span>),</span>
<span id="cb508-3"><a href="the-haunted-dag-the-causal-terror.html#cb508-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">x    =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>),</span>
<span id="cb508-4"><a href="the-haunted-dag-the-causal-terror.html#cb508-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">y    =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">2</span>))</span>
<span id="cb508-5"><a href="the-haunted-dag-the-causal-terror.html#cb508-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb508-6"><a href="the-haunted-dag-the-causal-terror.html#cb508-6" aria-hidden="true" tabindex="-1"></a>dag <span class="ot">&lt;-</span> <span class="fu">dagify</span>(M <span class="sc">~</span> H,</span>
<span id="cb508-7"><a href="the-haunted-dag-the-causal-terror.html#cb508-7" aria-hidden="true" tabindex="-1"></a>       M <span class="sc">~</span> A,</span>
<span id="cb508-8"><a href="the-haunted-dag-the-causal-terror.html#cb508-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">coords =</span> dag_coords)</span>
<span id="cb508-9"><a href="the-haunted-dag-the-causal-terror.html#cb508-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb508-10"><a href="the-haunted-dag-the-causal-terror.html#cb508-10" aria-hidden="true" tabindex="-1"></a><span class="fu">gg_simple_dag</span>(dag)</span></code></pre></div>
<p><img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-230-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>シミュレーションをする。</p>
<div class="sourceCode" id="cb509"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb509-1"><a href="the-haunted-dag-the-causal-terror.html#cb509-1" aria-hidden="true" tabindex="-1"></a>d5 <span class="ot">&lt;-</span> <span class="fu">sim_happiness</span>(<span class="at">seed =</span> <span class="dv">1977</span>, <span class="at">N_years =</span> <span class="dv">1000</span>)</span>
<span id="cb509-2"><a href="the-haunted-dag-the-causal-terror.html#cb509-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb509-3"><a href="the-haunted-dag-the-causal-terror.html#cb509-3" aria-hidden="true" tabindex="-1"></a><span class="fu">posterior_summary</span>(d5) <span class="sc">%&gt;%</span> </span>
<span id="cb509-4"><a href="the-haunted-dag-the-causal-terror.html#cb509-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">round</span>(<span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb509-5"><a href="the-haunted-dag-the-causal-terror.html#cb509-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb509-6"><a href="the-haunted-dag-the-causal-terror.html#cb509-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>(<span class="at">var =</span> <span class="st">&quot;parameter&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb509-7"><a href="the-haunted-dag-the-causal-terror.html#cb509-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>()</span></code></pre></div>
<pre><code>## # A tibble: 3 × 5
##   parameter Estimate Est.Error  Q2.5 Q97.5
##   &lt;chr&gt;        &lt;dbl&gt;     &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1 age           33       18.8      2    64
## 2 married        0.3      0.46     0     1
## 3 happiness      0        1.21    -2     2</code></pre>
<div class="sourceCode" id="cb511"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb511-1"><a href="the-haunted-dag-the-causal-terror.html#cb511-1" aria-hidden="true" tabindex="-1"></a>d5 <span class="sc">%&gt;%</span> </span>
<span id="cb511-2"><a href="the-haunted-dag-the-causal-terror.html#cb511-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> age, <span class="at">y =</span> happiness, <span class="at">fill=</span> <span class="fu">as.factor</span>(married)))<span class="sc">+</span></span>
<span id="cb511-3"><a href="the-haunted-dag-the-causal-terror.html#cb511-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size=</span><span class="fl">2.3</span>, <span class="at">shape=</span><span class="dv">21</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>) <span class="sc">+</span></span>
<span id="cb511-4"><a href="the-haunted-dag-the-causal-terror.html#cb511-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;white&quot;</span>,<span class="st">&quot;blue&quot;</span>))<span class="sc">+</span></span>
<span id="cb511-5"><a href="the-haunted-dag-the-causal-terror.html#cb511-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb511-6"><a href="the-haunted-dag-the-causal-terror.html#cb511-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>)</span></code></pre></div>
<p><img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-231-1.png" width="672" style="display: block; margin: auto;" /></p>
<p><br /></p>
<p>まず、以下のモデルを考え、結婚状態をコントロールうえで年齢が幸福度に与える影響を考える。</p>
<p><br /></p>
<p><span class="math inline">\(\mu_{i} = \alpha_{MID[i]} + \beta_{A}A_{i}\)</span></p>
<div class="sourceCode" id="cb512"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb512-1"><a href="the-haunted-dag-the-causal-terror.html#cb512-1" aria-hidden="true" tabindex="-1"></a>d5 <span class="sc">%&gt;%</span> </span>
<span id="cb512-2"><a href="the-haunted-dag-the-causal-terror.html#cb512-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(age <span class="sc">&gt;</span><span class="dv">17</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb512-3"><a href="the-haunted-dag-the-causal-terror.html#cb512-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">A =</span> (age<span class="dv">-18</span>)<span class="sc">/</span>(<span class="dv">65-18</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb512-4"><a href="the-haunted-dag-the-causal-terror.html#cb512-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">M =</span> <span class="fu">factor</span>(married <span class="sc">+</span> <span class="dv">1</span>, <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;single&quot;</span>, <span class="st">&quot;married&quot;</span>))) <span class="ot">-&gt;</span> d6</span></code></pre></div>
<p><br /></p>
<p>モデルを回すと、年齢が幸福と負に関連していることになる。　　</p>
<div class="sourceCode" id="cb513"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb513-1"><a href="the-haunted-dag-the-causal-terror.html#cb513-1" aria-hidden="true" tabindex="-1"></a>b6<span class="fl">.4</span> <span class="ot">&lt;-</span> </span>
<span id="cb513-2"><a href="the-haunted-dag-the-causal-terror.html#cb513-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">brm</span>(<span class="at">data =</span> d6,</span>
<span id="cb513-3"><a href="the-haunted-dag-the-causal-terror.html#cb513-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> gaussian,</span>
<span id="cb513-4"><a href="the-haunted-dag-the-causal-terror.html#cb513-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">formula =</span> happiness <span class="sc">~</span><span class="dv">0</span> <span class="sc">+</span>  M <span class="sc">+</span> A,</span>
<span id="cb513-5"><a href="the-haunted-dag-the-causal-terror.html#cb513-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>,<span class="dv">1</span>),<span class="at">class =</span> b, </span>
<span id="cb513-6"><a href="the-haunted-dag-the-causal-terror.html#cb513-6" aria-hidden="true" tabindex="-1"></a>                      <span class="at">coef=</span>Mmarried),</span>
<span id="cb513-7"><a href="the-haunted-dag-the-causal-terror.html#cb513-7" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>,<span class="dv">1</span>),<span class="at">class =</span> b,</span>
<span id="cb513-8"><a href="the-haunted-dag-the-causal-terror.html#cb513-8" aria-hidden="true" tabindex="-1"></a>                      <span class="at">coef =</span> Msingle),</span>
<span id="cb513-9"><a href="the-haunted-dag-the-causal-terror.html#cb513-9" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>,<span class="dv">2</span>),<span class="at">class =</span> b,</span>
<span id="cb513-10"><a href="the-haunted-dag-the-causal-terror.html#cb513-10" aria-hidden="true" tabindex="-1"></a>                      <span class="at">coef =</span> A),</span>
<span id="cb513-11"><a href="the-haunted-dag-the-causal-terror.html#cb513-11" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>), <span class="at">class =</span> sigma)),</span>
<span id="cb513-12"><a href="the-haunted-dag-the-causal-terror.html#cb513-12" aria-hidden="true" tabindex="-1"></a>      <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup=</span><span class="dv">1000</span>,</span>
<span id="cb513-13"><a href="the-haunted-dag-the-causal-terror.html#cb513-13" aria-hidden="true" tabindex="-1"></a>      <span class="at">backend =</span> <span class="st">&quot;cmdstanr&quot;</span>,</span>
<span id="cb513-14"><a href="the-haunted-dag-the-causal-terror.html#cb513-14" aria-hidden="true" tabindex="-1"></a>      <span class="at">file =</span> <span class="st">&quot;output/Chapter6/b6.4&quot;</span>)</span>
<span id="cb513-15"><a href="the-haunted-dag-the-causal-terror.html#cb513-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb513-16"><a href="the-haunted-dag-the-causal-terror.html#cb513-16" aria-hidden="true" tabindex="-1"></a><span class="fu">posterior_summary</span>(b6<span class="fl">.4</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb513-17"><a href="the-haunted-dag-the-causal-terror.html#cb513-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">round</span>(<span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb513-18"><a href="the-haunted-dag-the-causal-terror.html#cb513-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb513-19"><a href="the-haunted-dag-the-causal-terror.html#cb513-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>(<span class="at">var =</span> <span class="st">&quot;parameter&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb513-20"><a href="the-haunted-dag-the-causal-terror.html#cb513-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>()</span></code></pre></div>
<pre><code>## # A tibble: 6 × 5
##   parameter  Estimate Est.Error     Q2.5    Q97.5
##   &lt;chr&gt;         &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;
## 1 b_Msingle     -0.24      0.06    -0.36    -0.11
## 2 b_Mmarried     1.26      0.09     1.09     1.43
## 3 b_A           -0.75      0.12    -0.97    -0.53
## 4 sigma          0.99      0.02     0.95     1.04
## 5 lprior        -5.34      0.12    -5.6     -5.12
## 6 lp__       -1360.        1.43 -1364.   -1359.</code></pre>
<p><br /></p>
<p>一方で、年齢のみを説明変数に入れると、年齢の影響はなくなる。<br />
つまり、結婚の有無を変数に入れたことによって年齢と幸福度の間に疑似相関が生じていた。</p>
<div class="sourceCode" id="cb515"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb515-1"><a href="the-haunted-dag-the-causal-terror.html#cb515-1" aria-hidden="true" tabindex="-1"></a>b6<span class="fl">.4</span>_2 <span class="ot">&lt;-</span> </span>
<span id="cb515-2"><a href="the-haunted-dag-the-causal-terror.html#cb515-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">brm</span>(<span class="at">data =</span> d6,</span>
<span id="cb515-3"><a href="the-haunted-dag-the-causal-terror.html#cb515-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> gaussian,</span>
<span id="cb515-4"><a href="the-haunted-dag-the-causal-terror.html#cb515-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">formula =</span> happiness <span class="sc">~</span><span class="dv">1</span> <span class="sc">+</span> A,</span>
<span id="cb515-5"><a href="the-haunted-dag-the-causal-terror.html#cb515-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>,<span class="dv">1</span>),<span class="at">class =</span> b),</span>
<span id="cb515-6"><a href="the-haunted-dag-the-causal-terror.html#cb515-6" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>,<span class="dv">2</span>),<span class="at">class =</span> Intercept),</span>
<span id="cb515-7"><a href="the-haunted-dag-the-causal-terror.html#cb515-7" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>), <span class="at">class =</span> sigma)),</span>
<span id="cb515-8"><a href="the-haunted-dag-the-causal-terror.html#cb515-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup=</span><span class="dv">1000</span>,</span>
<span id="cb515-9"><a href="the-haunted-dag-the-causal-terror.html#cb515-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">backend =</span> <span class="st">&quot;cmdstanr&quot;</span>,</span>
<span id="cb515-10"><a href="the-haunted-dag-the-causal-terror.html#cb515-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">file =</span> <span class="st">&quot;output/Chapter6/b6.4_2&quot;</span>)</span>
<span id="cb515-11"><a href="the-haunted-dag-the-causal-terror.html#cb515-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb515-12"><a href="the-haunted-dag-the-causal-terror.html#cb515-12" aria-hidden="true" tabindex="-1"></a><span class="fu">posterior_summary</span>(b6<span class="fl">.4</span>_2) <span class="sc">%&gt;%</span> </span>
<span id="cb515-13"><a href="the-haunted-dag-the-causal-terror.html#cb515-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">round</span>(<span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb515-14"><a href="the-haunted-dag-the-causal-terror.html#cb515-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb515-15"><a href="the-haunted-dag-the-causal-terror.html#cb515-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>(<span class="at">var =</span> <span class="st">&quot;parameter&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb515-16"><a href="the-haunted-dag-the-causal-terror.html#cb515-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>()</span></code></pre></div>
<pre><code>## # A tibble: 5 × 5
##   parameter   Estimate Est.Error     Q2.5    Q97.5
##   &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;
## 1 b_Intercept     0         0.08    -0.15     0.15
## 2 b_A             0         0.13    -0.26     0.25
## 3 sigma           1.22      0.03     1.16     1.27
## 4 lprior         -3.76      0.03    -3.82    -3.7 
## 5 lp__        -1553.        1.23 -1556.   -1552.</code></pre>
<p><br /></p>
</div>
<div id="the-haunted-dag" class="section level3 hasAnchor" number="6.3.2">
<h3><span class="header-section-number">6.3.2</span> The haunted DAG<a href="the-haunted-dag-the-causal-terror.html#the-haunted-dag" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>以下の例を考える。<br />
両親(P)と祖父母(G)が子どもの学業成績(C)に直接影響を与えているが、GはPを通してもCに影響を与えているとする。<br />
また、未観測の変数(U)がPとCに影響を与えているとする。</p>
<div class="sourceCode" id="cb517"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb517-1"><a href="the-haunted-dag-the-causal-terror.html#cb517-1" aria-hidden="true" tabindex="-1"></a>dag_coords <span class="ot">&lt;-</span></span>
<span id="cb517-2"><a href="the-haunted-dag-the-causal-terror.html#cb517-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="at">name =</span> <span class="fu">c</span>(<span class="st">&quot;G&quot;</span>, <span class="st">&quot;P&quot;</span>, <span class="st">&quot;C&quot;</span>, <span class="st">&quot;U&quot;</span>),</span>
<span id="cb517-3"><a href="the-haunted-dag-the-causal-terror.html#cb517-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">x    =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="fl">2.5</span>),</span>
<span id="cb517-4"><a href="the-haunted-dag-the-causal-terror.html#cb517-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">y    =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">1</span>, <span class="fl">1.5</span>))</span>
<span id="cb517-5"><a href="the-haunted-dag-the-causal-terror.html#cb517-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb517-6"><a href="the-haunted-dag-the-causal-terror.html#cb517-6" aria-hidden="true" tabindex="-1"></a>dag <span class="ot">&lt;-</span></span>
<span id="cb517-7"><a href="the-haunted-dag-the-causal-terror.html#cb517-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dagify</span>(C <span class="sc">~</span> G <span class="sc">+</span> P <span class="sc">+</span> U,</span>
<span id="cb517-8"><a href="the-haunted-dag-the-causal-terror.html#cb517-8" aria-hidden="true" tabindex="-1"></a>         P <span class="sc">~</span> G <span class="sc">+</span> U,</span>
<span id="cb517-9"><a href="the-haunted-dag-the-causal-terror.html#cb517-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">coords =</span> dag_coords)</span>
<span id="cb517-10"><a href="the-haunted-dag-the-causal-terror.html#cb517-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb517-11"><a href="the-haunted-dag-the-causal-terror.html#cb517-11" aria-hidden="true" tabindex="-1"></a><span class="fu">gg_fancy_dag</span>(dag, <span class="at">x=</span><span class="fl">2.5</span>,<span class="at">y=</span><span class="fl">1.5</span>,<span class="at">circle =</span> <span class="st">&quot;U&quot;</span>)</span></code></pre></div>
<p><img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-235-1.png" width="672" style="display: block; margin: auto;" /></p>
<p><br /></p>
<p>以下のようにシミュレーションする。<br />
ここで、GがCに直接与える影響は0と仮定する。</p>
<div class="sourceCode" id="cb518"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb518-1"><a href="the-haunted-dag-the-causal-terror.html#cb518-1" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">200</span></span>
<span id="cb518-2"><a href="the-haunted-dag-the-causal-terror.html#cb518-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb518-3"><a href="the-haunted-dag-the-causal-terror.html#cb518-3" aria-hidden="true" tabindex="-1"></a>b_GC <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb518-4"><a href="the-haunted-dag-the-causal-terror.html#cb518-4" aria-hidden="true" tabindex="-1"></a>b_GP <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb518-5"><a href="the-haunted-dag-the-causal-terror.html#cb518-5" aria-hidden="true" tabindex="-1"></a>b_PC <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb518-6"><a href="the-haunted-dag-the-causal-terror.html#cb518-6" aria-hidden="true" tabindex="-1"></a>b_U <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb518-7"><a href="the-haunted-dag-the-causal-terror.html#cb518-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb518-8"><a href="the-haunted-dag-the-causal-terror.html#cb518-8" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb518-9"><a href="the-haunted-dag-the-causal-terror.html#cb518-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb518-10"><a href="the-haunted-dag-the-causal-terror.html#cb518-10" aria-hidden="true" tabindex="-1"></a>d7 <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb518-11"><a href="the-haunted-dag-the-causal-terror.html#cb518-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">U =</span> <span class="dv">2</span><span class="sc">*</span><span class="fu">rbern</span>(n, <span class="fl">0.5</span>)<span class="sc">-</span><span class="dv">1</span>,</span>
<span id="cb518-12"><a href="the-haunted-dag-the-causal-terror.html#cb518-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">G =</span> <span class="fu">rnorm</span>(n),</span>
<span id="cb518-13"><a href="the-haunted-dag-the-causal-terror.html#cb518-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">P =</span> <span class="fu">rnorm</span>(n, b_GP<span class="sc">*</span>G <span class="sc">+</span> b_U<span class="sc">*</span>U,<span class="at">sd=</span><span class="dv">1</span>),</span>
<span id="cb518-14"><a href="the-haunted-dag-the-causal-terror.html#cb518-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">C =</span> <span class="fu">rnorm</span>(n, b_PC<span class="sc">*</span>P <span class="sc">+</span> b_U<span class="sc">*</span>U <span class="sc">+</span> b_GC<span class="sc">*</span>G,<span class="at">sd=</span><span class="dv">1</span>)</span>
<span id="cb518-15"><a href="the-haunted-dag-the-causal-terror.html#cb518-15" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb518-16"><a href="the-haunted-dag-the-causal-terror.html#cb518-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb518-17"><a href="the-haunted-dag-the-causal-terror.html#cb518-17" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(d7)</span></code></pre></div>
<pre><code>## # A tibble: 6 × 4
##       U       G     P     C
##   &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1    -1 -0.620  -1.73 -3.65
## 2    -1  0.0421 -3.01 -5.30
## 3     1 -0.911   3.06  3.88
## 4     1  0.158   1.77  3.79
## 5    -1 -0.655  -1.00 -2.01
## 6     1  1.77    5.28  8.87</code></pre>
<div class="sourceCode" id="cb520"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb520-1"><a href="the-haunted-dag-the-causal-terror.html#cb520-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggpairs</span>(d7)</span></code></pre></div>
<p><img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-236-1.png" width="672" style="display: block; margin: auto;" /></p>
<p><br /></p>
<p>C ~ G + Pのモデリングを行うと…。<br />
Pの影響が2倍近くになっており、Gが負の影響を与えているという結果になってしまっている。</p>
<div class="sourceCode" id="cb521"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb521-1"><a href="the-haunted-dag-the-causal-terror.html#cb521-1" aria-hidden="true" tabindex="-1"></a>b6<span class="fl">.5</span> <span class="ot">&lt;-</span> </span>
<span id="cb521-2"><a href="the-haunted-dag-the-causal-terror.html#cb521-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">brm</span>(<span class="at">data =</span> d7,</span>
<span id="cb521-3"><a href="the-haunted-dag-the-causal-terror.html#cb521-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> gaussian,</span>
<span id="cb521-4"><a href="the-haunted-dag-the-causal-terror.html#cb521-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">formula =</span> C <span class="sc">~</span> <span class="dv">0</span> <span class="sc">+</span> Intercept<span class="sc">+</span>P<span class="sc">+</span>G,</span>
<span id="cb521-5"><a href="the-haunted-dag-the-causal-terror.html#cb521-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>,<span class="dv">1</span>),<span class="at">class =</span> b),</span>
<span id="cb521-6"><a href="the-haunted-dag-the-causal-terror.html#cb521-6" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>),<span class="at">class=</span>sigma)),</span>
<span id="cb521-7"><a href="the-haunted-dag-the-causal-terror.html#cb521-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">backend =</span> <span class="st">&quot;cmdstanr&quot;</span>,</span>
<span id="cb521-8"><a href="the-haunted-dag-the-causal-terror.html#cb521-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">seed =</span><span class="dv">6</span>, <span class="at">file =</span> <span class="st">&quot;output/Chapter6/b6.5&quot;</span>)</span>
<span id="cb521-9"><a href="the-haunted-dag-the-causal-terror.html#cb521-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb521-10"><a href="the-haunted-dag-the-causal-terror.html#cb521-10" aria-hidden="true" tabindex="-1"></a><span class="fu">posterior_summary</span>(b6<span class="fl">.5</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb521-11"><a href="the-haunted-dag-the-causal-terror.html#cb521-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">round</span>(<span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb521-12"><a href="the-haunted-dag-the-causal-terror.html#cb521-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb521-13"><a href="the-haunted-dag-the-causal-terror.html#cb521-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>(<span class="at">var =</span> <span class="st">&quot;parameter&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb521-14"><a href="the-haunted-dag-the-causal-terror.html#cb521-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>()</span></code></pre></div>
<pre><code>## # A tibble: 6 × 5
##   parameter   Estimate Est.Error    Q2.5   Q97.5
##   &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;
## 1 b_Intercept    -0.12      0.1    -0.32    0.07
## 2 b_P             1.79      0.04    1.7     1.87
## 3 b_G            -0.84      0.11   -1.06   -0.62
## 4 sigma           1.43      0.07    1.29    1.58
## 5 lprior         -6.15      0.16   -6.47   -5.85
## 6 lp__         -361.        1.43 -365.   -359.</code></pre>
<p><br /></p>
<p>これは、Pを固定（例えば40-60%のものにデータを限定）してみるとよくわかる。<br />
Pを固定したとき、Gが低ければUは高くなるし、Gが高ければUは低くなる（U -&gt; P &lt;- Gなので）。そして、Uが高いほどはCも高いので、結果的にGが低いほどCも高いという結果が得られることになる。</p>
<div class="sourceCode" id="cb523"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb523-1"><a href="the-haunted-dag-the-causal-terror.html#cb523-1" aria-hidden="true" tabindex="-1"></a>d7 <span class="sc">%&gt;%</span> </span>
<span id="cb523-2"><a href="the-haunted-dag-the-causal-terror.html#cb523-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">C =</span> <span class="fu">standardize</span>(C), <span class="at">G =</span> <span class="fu">standardize</span>(G)) <span class="sc">%&gt;%</span> </span>
<span id="cb523-3"><a href="the-haunted-dag-the-causal-terror.html#cb523-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">P40_60 =</span> <span class="fu">ifelse</span>(P <span class="sc">&lt;</span> <span class="fu">quantile</span>(P,<span class="at">probs =</span> .<span class="dv">6</span>)<span class="sc">&amp;</span> P <span class="sc">&gt;</span> <span class="fu">quantile</span>(P, <span class="at">probs =</span> .<span class="dv">4</span>), <span class="cn">TRUE</span>,<span class="cn">FALSE</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb523-4"><a href="the-haunted-dag-the-causal-terror.html#cb523-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>G, <span class="at">y=</span>C))<span class="sc">+</span></span>
<span id="cb523-5"><a href="the-haunted-dag-the-causal-terror.html#cb523-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">shape =</span> <span class="fu">as.factor</span>(P40_60),</span>
<span id="cb523-6"><a href="the-haunted-dag-the-causal-terror.html#cb523-6" aria-hidden="true" tabindex="-1"></a>                 <span class="at">color =</span> <span class="fu">as.factor</span>(U)),</span>
<span id="cb523-7"><a href="the-haunted-dag-the-causal-terror.html#cb523-7" aria-hidden="true" tabindex="-1"></a>             <span class="at">size=</span><span class="fl">3.5</span>, <span class="at">stroke=</span><span class="dv">3</span><span class="sc">/</span><span class="dv">4</span>)<span class="sc">+</span></span>
<span id="cb523-8"><a href="the-haunted-dag-the-causal-terror.html#cb523-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span></span>
<span id="cb523-9"><a href="the-haunted-dag-the-causal-terror.html#cb523-9" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">c</span>(<span class="st">&quot;black&quot;</span>,<span class="st">&quot;navy&quot;</span>))<span class="sc">+</span></span>
<span id="cb523-10"><a href="the-haunted-dag-the-causal-terror.html#cb523-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_shape_manual</span>(<span class="at">values =</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">19</span>))<span class="sc">+</span></span>
<span id="cb523-11"><a href="the-haunted-dag-the-causal-terror.html#cb523-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">data =</span> . <span class="sc">%&gt;%</span> <span class="fu">filter</span>(P40_60<span class="sc">==</span><span class="st">&quot;TRUE&quot;</span>),</span>
<span id="cb523-12"><a href="the-haunted-dag-the-causal-terror.html#cb523-12" aria-hidden="true" tabindex="-1"></a>              <span class="at">method =</span> <span class="st">&quot;lm&quot;</span>, <span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">fullrange=</span>T,</span>
<span id="cb523-13"><a href="the-haunted-dag-the-causal-terror.html#cb523-13" aria-hidden="true" tabindex="-1"></a>              <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">size=</span><span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>)<span class="sc">+</span></span>
<span id="cb523-14"><a href="the-haunted-dag-the-causal-terror.html#cb523-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x=</span><span class="st">&quot;granpa education (G)&quot;</span>, </span>
<span id="cb523-15"><a href="the-haunted-dag-the-causal-terror.html#cb523-15" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;grandchild eduaction (C)&quot;</span>,</span>
<span id="cb523-16"><a href="the-haunted-dag-the-causal-terror.html#cb523-16" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">&quot;Parents in 45th and 60th centiles&quot;</span>)<span class="sc">+</span></span>
<span id="cb523-17"><a href="the-haunted-dag-the-causal-terror.html#cb523-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">aspect.ratio=</span><span class="dv">1</span>,</span>
<span id="cb523-18"><a href="the-haunted-dag-the-causal-terror.html#cb523-18" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>)<span class="sc">+</span></span>
<span id="cb523-19"><a href="the-haunted-dag-the-causal-terror.html#cb523-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="at">geom=</span><span class="st">&quot;text&quot;</span>, <span class="at">x=</span><span class="sc">-</span><span class="dv">2</span>,<span class="at">y=</span><span class="dv">2</span>,<span class="at">label=</span><span class="st">&quot;U = 1&quot;</span>,</span>
<span id="cb523-20"><a href="the-haunted-dag-the-causal-terror.html#cb523-20" aria-hidden="true" tabindex="-1"></a>           <span class="at">color =</span> <span class="st">&quot;navy&quot;</span>)<span class="sc">+</span></span>
<span id="cb523-21"><a href="the-haunted-dag-the-causal-terror.html#cb523-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">annotate</span>(<span class="at">geom=</span><span class="st">&quot;text&quot;</span>, <span class="at">x=</span><span class="dv">2</span>,<span class="at">y=</span><span class="sc">-</span><span class="dv">2</span>,<span class="at">label=</span><span class="st">&quot;U = -1&quot;</span>,</span>
<span id="cb523-22"><a href="the-haunted-dag-the-causal-terror.html#cb523-22" aria-hidden="true" tabindex="-1"></a>           <span class="at">color =</span> <span class="st">&quot;black&quot;</span>)</span></code></pre></div>
<p><img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-238-1.png" width="672" style="display: block; margin: auto;" /></p>
<p><br /></p>
<p>ここで、Uが観測できたとしてモデリングを行うと、Gの効果はなくなり、Pの効果も正しく推定できるようになる。　　</p>
<div class="sourceCode" id="cb524"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb524-1"><a href="the-haunted-dag-the-causal-terror.html#cb524-1" aria-hidden="true" tabindex="-1"></a>b6<span class="fl">.5</span>_2 <span class="ot">&lt;-</span> </span>
<span id="cb524-2"><a href="the-haunted-dag-the-causal-terror.html#cb524-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">brm</span>(<span class="at">data =</span> d7,</span>
<span id="cb524-3"><a href="the-haunted-dag-the-causal-terror.html#cb524-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> gaussian,</span>
<span id="cb524-4"><a href="the-haunted-dag-the-causal-terror.html#cb524-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">formula =</span> C <span class="sc">~</span> <span class="dv">0</span> <span class="sc">+</span> Intercept<span class="sc">+</span>P<span class="sc">+</span>G<span class="sc">+</span>U,</span>
<span id="cb524-5"><a href="the-haunted-dag-the-causal-terror.html#cb524-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>,<span class="dv">1</span>),<span class="at">class =</span> b),</span>
<span id="cb524-6"><a href="the-haunted-dag-the-causal-terror.html#cb524-6" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>),<span class="at">class=</span>sigma)),</span>
<span id="cb524-7"><a href="the-haunted-dag-the-causal-terror.html#cb524-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">backend =</span> <span class="st">&quot;cmdstanr&quot;</span>,</span>
<span id="cb524-8"><a href="the-haunted-dag-the-causal-terror.html#cb524-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">seed =</span><span class="dv">6</span>, <span class="at">file =</span> <span class="st">&quot;output/Chapter6/b6.5_2&quot;</span>)</span>
<span id="cb524-9"><a href="the-haunted-dag-the-causal-terror.html#cb524-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb524-10"><a href="the-haunted-dag-the-causal-terror.html#cb524-10" aria-hidden="true" tabindex="-1"></a><span class="fu">posterior_summary</span>(b6<span class="fl">.5</span>_2) <span class="sc">%&gt;%</span> </span>
<span id="cb524-11"><a href="the-haunted-dag-the-causal-terror.html#cb524-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">round</span>(<span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb524-12"><a href="the-haunted-dag-the-causal-terror.html#cb524-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb524-13"><a href="the-haunted-dag-the-causal-terror.html#cb524-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>(<span class="at">var =</span> <span class="st">&quot;parameter&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb524-14"><a href="the-haunted-dag-the-causal-terror.html#cb524-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>()</span></code></pre></div>
<pre><code>## # A tibble: 7 × 5
##   parameter   Estimate Est.Error    Q2.5   Q97.5
##   &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;
## 1 b_Intercept    -0.12      0.07   -0.26    0.02
## 2 b_P             1.02      0.07    0.88    1.14
## 3 b_G            -0.05      0.1    -0.24    0.15
## 4 b_U             1.98      0.15    1.69    2.27
## 5 sigma           1.04      0.05    0.94    1.14
## 6 lprior         -7.23      0.24   -7.74   -6.8 
## 7 lp__         -298.        1.61 -302.   -296.</code></pre>
<p><br /></p>
</div>
</div>
<div id="confronting-confoundings" class="section level2 hasAnchor" number="6.4">
<h2><span class="header-section-number">6.4</span> Confronting confoundings<a href="the-haunted-dag-the-causal-terror.html#confronting-confoundings" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>上記のように、モデルに入れる変数を身長に選ばなければ交絡が生じてしまう。<br />
ゆえに、<strong>バックドア基準</strong>を満たすような変数を入れることが肝要である。</p>
<p><br /></p>
<p>因果モデルはどんなに複雑であろうと、以下の4つの関係の組み合わせからなる。</p>
<ol style="list-style-type: decimal">
<li><p>The fork<br />
Zで条件づけられれば、XとYは独立になる。<br />
<br /></p></li>
<li><p>The Pipe<br />
Zで条件づけるとXからYへのパスがふさがれてしまう。<br />
<br /></p></li>
<li><p>The Collider<br />
Zで条件づけると、XとYの間に疑似相関が生じてしまう。<br />
<br /></p></li>
<li><p>The Descendant<br />
Dで条件づけるとZも部分的に条件づけられてしまうため、XとYの間に疑似相関が生じてしまう。</p></li>
</ol>
<p><br />
<img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-240-1.png" width="672" style="display: block; margin: auto;" /></p>
<p><br /></p>
<div id="two-roads" class="section level3 hasAnchor" number="6.4.1">
<h3><span class="header-section-number">6.4.1</span> Two roads<a href="the-haunted-dag-the-causal-terror.html#two-roads" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>以下のDAGを考える。</p>
<p><img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-241-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>バックドアをふさぐためには、AかCのすくなくともどちらかについて条件づける必要がある。Cをいれれば推定の制度も上がるので、Cを入れる方がよりよい（両方入れてもよいが、あまり意味はない）。</p>
<div class="sourceCode" id="cb526"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb526-1"><a href="the-haunted-dag-the-causal-terror.html#cb526-1" aria-hidden="true" tabindex="-1"></a>dag_6<span class="fl">.1</span> <span class="ot">&lt;-</span> </span>
<span id="cb526-2"><a href="the-haunted-dag-the-causal-terror.html#cb526-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dagitty</span>(</span>
<span id="cb526-3"><a href="the-haunted-dag-the-causal-terror.html#cb526-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;dag {</span></span>
<span id="cb526-4"><a href="the-haunted-dag-the-causal-terror.html#cb526-4" aria-hidden="true" tabindex="-1"></a><span class="st">    U [unobserved]</span></span>
<span id="cb526-5"><a href="the-haunted-dag-the-causal-terror.html#cb526-5" aria-hidden="true" tabindex="-1"></a><span class="st">    X -&gt; Y</span></span>
<span id="cb526-6"><a href="the-haunted-dag-the-causal-terror.html#cb526-6" aria-hidden="true" tabindex="-1"></a><span class="st">    X &lt;- U &lt;- A -&gt; C -&gt; Y </span></span>
<span id="cb526-7"><a href="the-haunted-dag-the-causal-terror.html#cb526-7" aria-hidden="true" tabindex="-1"></a><span class="st">    U -&gt; B &lt;- C</span></span>
<span id="cb526-8"><a href="the-haunted-dag-the-causal-terror.html#cb526-8" aria-hidden="true" tabindex="-1"></a><span class="st">    }&quot;</span></span>
<span id="cb526-9"><a href="the-haunted-dag-the-causal-terror.html#cb526-9" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb526-10"><a href="the-haunted-dag-the-causal-terror.html#cb526-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb526-11"><a href="the-haunted-dag-the-causal-terror.html#cb526-11" aria-hidden="true" tabindex="-1"></a><span class="fu">adjustmentSets</span>(dag_6<span class="fl">.1</span>, <span class="at">exposure =</span> <span class="st">&quot;X&quot;</span>, <span class="at">outcome =</span> <span class="st">&quot;Y&quot;</span>)</span></code></pre></div>
<pre><code>## { C }
## { A }</code></pre>
<p><br /></p>
</div>
<div id="backdoor-waffles" class="section level3 hasAnchor" number="6.4.2">
<h3><span class="header-section-number">6.4.2</span> Backdoor Waffles<a href="the-haunted-dag-the-causal-terror.html#backdoor-waffles" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>次に、Waffle House Divorce につい以下のモデルを考える。<br />
<img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-243-1.png" width="672" style="display: block; margin: auto;" />
<br /></p>
<p>AとM、もしくはSで条件づければWとDの間に余計な関係は生じない。</p>
<div class="sourceCode" id="cb528"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb528-1"><a href="the-haunted-dag-the-causal-terror.html#cb528-1" aria-hidden="true" tabindex="-1"></a>dag_6<span class="fl">.2</span> <span class="ot">&lt;-</span> </span>
<span id="cb528-2"><a href="the-haunted-dag-the-causal-terror.html#cb528-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dagitty</span>(</span>
<span id="cb528-3"><a href="the-haunted-dag-the-causal-terror.html#cb528-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;dag {</span></span>
<span id="cb528-4"><a href="the-haunted-dag-the-causal-terror.html#cb528-4" aria-hidden="true" tabindex="-1"></a><span class="st">    A -&gt; D</span></span>
<span id="cb528-5"><a href="the-haunted-dag-the-causal-terror.html#cb528-5" aria-hidden="true" tabindex="-1"></a><span class="st">    A -&gt; M -&gt; D</span></span>
<span id="cb528-6"><a href="the-haunted-dag-the-causal-terror.html#cb528-6" aria-hidden="true" tabindex="-1"></a><span class="st">    A &lt;- S -&gt; M</span></span>
<span id="cb528-7"><a href="the-haunted-dag-the-causal-terror.html#cb528-7" aria-hidden="true" tabindex="-1"></a><span class="st">    S -&gt; W -&gt; D</span></span>
<span id="cb528-8"><a href="the-haunted-dag-the-causal-terror.html#cb528-8" aria-hidden="true" tabindex="-1"></a><span class="st">    }&quot;</span></span>
<span id="cb528-9"><a href="the-haunted-dag-the-causal-terror.html#cb528-9" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb528-10"><a href="the-haunted-dag-the-causal-terror.html#cb528-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb528-11"><a href="the-haunted-dag-the-causal-terror.html#cb528-11" aria-hidden="true" tabindex="-1"></a><span class="fu">adjustmentSets</span>(dag_6<span class="fl">.2</span>, <span class="at">exposure =</span> <span class="st">&quot;W&quot;</span>, <span class="at">outcome =</span> <span class="st">&quot;D&quot;</span>)</span></code></pre></div>
<pre><code>## { A, M }
## { S }</code></pre>
<p><br /></p>
</div>
</div>
<div id="practice-4" class="section level2 hasAnchor" number="6.5">
<h2><span class="header-section-number">6.5</span> Practice<a href="the-haunted-dag-the-causal-terror.html#practice-4" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="m1-4" class="section level3 hasAnchor" number="6.5.1">
<h3><span class="header-section-number">6.5.1</span> 6M1<a href="the-haunted-dag-the-causal-terror.html#m1-4" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<blockquote>
<p>Modify the DAG on page 186 to include the variable V, an unobserved cause of C and Y: C←V→Y. Reanalyze the DAG. How many paths connect X to Y? Which must be closed? Which variables should you condition on now?</p>
</blockquote>
<p><img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-245-1.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb530"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb530-1"><a href="the-haunted-dag-the-causal-terror.html#cb530-1" aria-hidden="true" tabindex="-1"></a>new_dag <span class="ot">&lt;-</span> <span class="fu">dagitty</span>(<span class="st">&quot;dag { U [unobserved]</span></span>
<span id="cb530-2"><a href="the-haunted-dag-the-causal-terror.html#cb530-2" aria-hidden="true" tabindex="-1"></a><span class="st">                          V [unobserved]</span></span>
<span id="cb530-3"><a href="the-haunted-dag-the-causal-terror.html#cb530-3" aria-hidden="true" tabindex="-1"></a><span class="st">                          X -&gt; Y</span></span>
<span id="cb530-4"><a href="the-haunted-dag-the-causal-terror.html#cb530-4" aria-hidden="true" tabindex="-1"></a><span class="st">                          X &lt;- U &lt;- A -&gt; C -&gt; Y</span></span>
<span id="cb530-5"><a href="the-haunted-dag-the-causal-terror.html#cb530-5" aria-hidden="true" tabindex="-1"></a><span class="st">                          U -&gt; B &lt;- C</span></span>
<span id="cb530-6"><a href="the-haunted-dag-the-causal-terror.html#cb530-6" aria-hidden="true" tabindex="-1"></a><span class="st">                          C &lt;- V -&gt; Y }&quot;</span>)</span>
<span id="cb530-7"><a href="the-haunted-dag-the-causal-terror.html#cb530-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb530-8"><a href="the-haunted-dag-the-causal-terror.html#cb530-8" aria-hidden="true" tabindex="-1"></a><span class="fu">adjustmentSets</span>(new_dag, <span class="at">exposure =</span> <span class="st">&quot;X&quot;</span>, <span class="at">outcome =</span> <span class="st">&quot;Y&quot;</span>)</span></code></pre></div>
<pre><code>## { A }</code></pre>
<p><br /></p>
</div>
<div id="m2-4" class="section level3 hasAnchor" number="6.5.2">
<h3><span class="header-section-number">6.5.2</span> 6M2<a href="the-haunted-dag-the-causal-terror.html#m2-4" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<blockquote>
<p>Sometimes, in order to avoid multicollinearity, people inspect pairwise correlations among predictors before including them in a model. This is a bad procedure, because what matters is the conditional association, not the association before the variables are included in the model. To highlight this, consider the DAG X→Z→Y. Simulate data from this DAG so that the correlation between X and Z is very large. Then include both in a model prediction Y
. Do you observe any multicollinearity? Why or why not? What is different from the legs example in the chapter?</p>
</blockquote>
<div class="sourceCode" id="cb532"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb532-1"><a href="the-haunted-dag-the-causal-terror.html#cb532-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1984</span>)</span>
<span id="cb532-2"><a href="the-haunted-dag-the-causal-terror.html#cb532-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb532-3"><a href="the-haunted-dag-the-causal-terror.html#cb532-3" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb532-4"><a href="the-haunted-dag-the-causal-terror.html#cb532-4" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">x =</span> <span class="fu">rnorm</span>(n,<span class="dv">0</span>,<span class="dv">1</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb532-5"><a href="the-haunted-dag-the-causal-terror.html#cb532-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">z =</span> <span class="fu">rnorm</span>(n,x,<span class="fl">0.4</span>),</span>
<span id="cb532-6"><a href="the-haunted-dag-the-causal-terror.html#cb532-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">y =</span> <span class="fu">rnorm</span>(n,z,<span class="dv">1</span>))</span>
<span id="cb532-7"><a href="the-haunted-dag-the-causal-terror.html#cb532-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb532-8"><a href="the-haunted-dag-the-causal-terror.html#cb532-8" aria-hidden="true" tabindex="-1"></a><span class="fu">cor</span>(dat)</span></code></pre></div>
<pre><code>##           x         z         y
## x 1.0000000 0.9325230 0.7431466
## z 0.9325230 1.0000000 0.8063858
## y 0.7431466 0.8063858 1.0000000</code></pre>
<div class="sourceCode" id="cb534"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb534-1"><a href="the-haunted-dag-the-causal-terror.html#cb534-1" aria-hidden="true" tabindex="-1"></a><span class="fu">pairs</span>(dat)</span></code></pre></div>
<p><img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-247-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>上手く推定できてると思われる。</p>
<div class="sourceCode" id="cb535"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb535-1"><a href="the-haunted-dag-the-causal-terror.html#cb535-1" aria-hidden="true" tabindex="-1"></a>b6M2 <span class="ot">&lt;-</span> </span>
<span id="cb535-2"><a href="the-haunted-dag-the-causal-terror.html#cb535-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">brm</span>(</span>
<span id="cb535-3"><a href="the-haunted-dag-the-causal-terror.html#cb535-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> dat,</span>
<span id="cb535-4"><a href="the-haunted-dag-the-causal-terror.html#cb535-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">family =</span> gaussian,</span>
<span id="cb535-5"><a href="the-haunted-dag-the-causal-terror.html#cb535-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">formula =</span> y <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> z <span class="sc">+</span> x,</span>
<span id="cb535-6"><a href="the-haunted-dag-the-causal-terror.html#cb535-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>,<span class="fl">0.2</span>),<span class="at">class =</span> Intercept),</span>
<span id="cb535-7"><a href="the-haunted-dag-the-causal-terror.html#cb535-7" aria-hidden="true" tabindex="-1"></a>              <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>,<span class="fl">0.5</span>),<span class="at">class =</span>b),</span>
<span id="cb535-8"><a href="the-haunted-dag-the-causal-terror.html#cb535-8" aria-hidden="true" tabindex="-1"></a>              <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>),<span class="at">class=</span>sigma)),</span>
<span id="cb535-9"><a href="the-haunted-dag-the-causal-terror.html#cb535-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">iter=</span><span class="dv">4000</span>, <span class="at">warmup=</span><span class="dv">2000</span>, <span class="at">chains =</span><span class="dv">4</span>, <span class="at">seed=</span><span class="dv">1234</span>,</span>
<span id="cb535-10"><a href="the-haunted-dag-the-causal-terror.html#cb535-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">backend =</span> <span class="st">&quot;cmdstanr&quot;</span>,</span>
<span id="cb535-11"><a href="the-haunted-dag-the-causal-terror.html#cb535-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">file =</span> <span class="st">&quot;output/Chapter6/b6M2&quot;</span></span>
<span id="cb535-12"><a href="the-haunted-dag-the-causal-terror.html#cb535-12" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb535-13"><a href="the-haunted-dag-the-causal-terror.html#cb535-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb535-14"><a href="the-haunted-dag-the-causal-terror.html#cb535-14" aria-hidden="true" tabindex="-1"></a><span class="fu">posterior_summary</span>(b6M2) <span class="sc">%&gt;%</span> </span>
<span id="cb535-15"><a href="the-haunted-dag-the-causal-terror.html#cb535-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">round</span>(<span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb535-16"><a href="the-haunted-dag-the-causal-terror.html#cb535-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb535-17"><a href="the-haunted-dag-the-causal-terror.html#cb535-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>(<span class="at">var =</span> <span class="st">&quot;parameter&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb535-18"><a href="the-haunted-dag-the-causal-terror.html#cb535-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>()</span></code></pre></div>
<pre><code>## # A tibble: 6 × 5
##   parameter   Estimate Est.Error    Q2.5   Q97.5
##   &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;
## 1 b_Intercept    -0.12      0.09   -0.29    0.06
## 2 b_z             1.08      0.21    0.66    1.49
## 3 b_x             0.14      0.23   -0.31    0.6 
## 4 sigma           0.96      0.07    0.84    1.11
## 5 lprior         -3.54      0.86   -5.6    -2.29
## 6 lp__         -142.        1.45 -145.   -140.</code></pre>
<div class="sourceCode" id="cb537"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb537-1"><a href="the-haunted-dag-the-causal-terror.html#cb537-1" aria-hidden="true" tabindex="-1"></a><span class="fu">posterior_samples</span>(b6M2) <span class="sc">%&gt;%</span></span>
<span id="cb537-2"><a href="the-haunted-dag-the-causal-terror.html#cb537-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span></span>
<span id="cb537-3"><a href="the-haunted-dag-the-causal-terror.html#cb537-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>lp__) <span class="sc">%&gt;%</span></span>
<span id="cb537-4"><a href="the-haunted-dag-the-causal-terror.html#cb537-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">everything</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb537-5"><a href="the-haunted-dag-the-causal-terror.html#cb537-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> value, <span class="at">y =</span> name)) <span class="sc">+</span></span>
<span id="cb537-6"><a href="the-haunted-dag-the-causal-terror.html#cb537-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_halfeye</span>(<span class="at">.width =</span> <span class="fu">c</span>(<span class="fl">0.67</span>, <span class="fl">0.89</span>, <span class="fl">0.97</span>))</span></code></pre></div>
<p><img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-248-1.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb538"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb538-1"><a href="the-haunted-dag-the-causal-terror.html#cb538-1" aria-hidden="true" tabindex="-1"></a><span class="fu">pairs</span>(b6M2)</span></code></pre></div>
<p><img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-248-2.png" width="672" style="display: block; margin: auto;" /></p>
<p><br /></p>
<p>繰り返してみる。<br />
推定結果も両脚と身長の例ほどはばらついていない。</p>
<div class="sourceCode" id="cb539"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb539-1"><a href="the-haunted-dag-the-causal-terror.html#cb539-1" aria-hidden="true" tabindex="-1"></a>sim_and_fit <span class="ot">&lt;-</span> <span class="cf">function</span>(seed, <span class="at">n =</span> <span class="dv">100</span>) {</span>
<span id="cb539-2"><a href="the-haunted-dag-the-causal-terror.html#cb539-2" aria-hidden="true" tabindex="-1"></a>  n <span class="ot">&lt;-</span> n</span>
<span id="cb539-3"><a href="the-haunted-dag-the-causal-terror.html#cb539-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set.seed</span>(seed)</span>
<span id="cb539-4"><a href="the-haunted-dag-the-causal-terror.html#cb539-4" aria-hidden="true" tabindex="-1"></a>  dat <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">x =</span> <span class="fu">rnorm</span>(n,<span class="dv">0</span>,<span class="dv">1</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb539-5"><a href="the-haunted-dag-the-causal-terror.html#cb539-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">z =</span> <span class="fu">rnorm</span>(n,x,<span class="fl">0.4</span>),</span>
<span id="cb539-6"><a href="the-haunted-dag-the-causal-terror.html#cb539-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">y =</span> <span class="fu">rnorm</span>(n,z,<span class="dv">1</span>))</span>
<span id="cb539-7"><a href="the-haunted-dag-the-causal-terror.html#cb539-7" aria-hidden="true" tabindex="-1"></a>  fit <span class="ot">&lt;-</span> <span class="fu">update</span>(b6M2, <span class="at">newdata =</span> dat) </span>
<span id="cb539-8"><a href="the-haunted-dag-the-causal-terror.html#cb539-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb539-9"><a href="the-haunted-dag-the-causal-terror.html#cb539-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb539-10"><a href="the-haunted-dag-the-causal-terror.html#cb539-10" aria-hidden="true" tabindex="-1"></a><span class="co">#sim2 &lt;-</span></span>
<span id="cb539-11"><a href="the-haunted-dag-the-causal-terror.html#cb539-11" aria-hidden="true" tabindex="-1"></a> <span class="co"># tibble(seed = 1:4) %&gt;% </span></span>
<span id="cb539-12"><a href="the-haunted-dag-the-causal-terror.html#cb539-12" aria-hidden="true" tabindex="-1"></a>  <span class="co">#mutate(post = purrr::map(seed, ~sim_and_fit(.) %&gt;% </span></span>
<span id="cb539-13"><a href="the-haunted-dag-the-causal-terror.html#cb539-13" aria-hidden="true" tabindex="-1"></a>   <span class="co">#                   posterior_samples()))</span></span>
<span id="cb539-14"><a href="the-haunted-dag-the-causal-terror.html#cb539-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb539-15"><a href="the-haunted-dag-the-causal-terror.html#cb539-15" aria-hidden="true" tabindex="-1"></a>sim2 <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;output/Chapter6/sim2.rds&quot;</span>)</span>
<span id="cb539-16"><a href="the-haunted-dag-the-causal-terror.html#cb539-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb539-17"><a href="the-haunted-dag-the-causal-terror.html#cb539-17" aria-hidden="true" tabindex="-1"></a>sim2 <span class="sc">%&gt;%</span> </span>
<span id="cb539-18"><a href="the-haunted-dag-the-causal-terror.html#cb539-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(post) <span class="sc">%&gt;%</span></span>
<span id="cb539-19"><a href="the-haunted-dag-the-causal-terror.html#cb539-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(b_Intercept<span class="sc">:</span>sigma) <span class="sc">%&gt;%</span> </span>
<span id="cb539-20"><a href="the-haunted-dag-the-causal-terror.html#cb539-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">seed =</span> <span class="fu">str_c</span>(<span class="st">&quot;seed &quot;</span>, seed)) <span class="sc">%&gt;%</span> </span>
<span id="cb539-21"><a href="the-haunted-dag-the-causal-terror.html#cb539-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> value, <span class="at">y =</span> name)) <span class="sc">+</span></span>
<span id="cb539-22"><a href="the-haunted-dag-the-causal-terror.html#cb539-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_pointinterval</span>(<span class="at">.width =</span> .<span class="dv">95</span>, <span class="at">color =</span> <span class="st">&quot;forestgreen&quot;</span>) <span class="sc">+</span></span>
<span id="cb539-23"><a href="the-haunted-dag-the-causal-terror.html#cb539-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;posterior&quot;</span>, <span class="at">y =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb539-24"><a href="the-haunted-dag-the-causal-terror.html#cb539-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="dv">0</span>),</span>
<span id="cb539-25"><a href="the-haunted-dag-the-causal-terror.html#cb539-25" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.border =</span> <span class="fu">element_rect</span>(<span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">fill =</span> <span class="st">&quot;transparent&quot;</span>),</span>
<span id="cb539-26"><a href="the-haunted-dag-the-causal-terror.html#cb539-26" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb539-27"><a href="the-haunted-dag-the-causal-terror.html#cb539-27" aria-hidden="true" tabindex="-1"></a>        <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb539-28"><a href="the-haunted-dag-the-causal-terror.html#cb539-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> seed, <span class="at">ncol =</span> <span class="dv">1</span>)</span></code></pre></div>
<p><img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-249-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>これは、身長の例では両脚(L,R)がどちらも身長(H)を予測するのに対して、今回の例ではZのみがYを予測し、XからYへのパスはブロックされているから。<br />
このように、多重共線性が生じるかは単純に変数間の相関だけではわからず、因果モデルを考える必要がある。<br />
<br /></p>
</div>
<div id="h1-4" class="section level3 hasAnchor" number="6.5.3">
<h3><span class="header-section-number">6.5.3</span> 6H1<a href="the-haunted-dag-the-causal-terror.html#h1-4" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<blockquote>
<p>Use the Waffle House data, <code>data(WaffleDivorce)</code>, to find the total causal influence of number of Waffle Houses on divorce rate. Justify your model or models with a causal graph.</p>
</blockquote>
<div class="sourceCode" id="cb540"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb540-1"><a href="the-haunted-dag-the-causal-terror.html#cb540-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;WaffleDivorce&quot;</span>)</span>
<span id="cb540-2"><a href="the-haunted-dag-the-causal-terror.html#cb540-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb540-3"><a href="the-haunted-dag-the-causal-terror.html#cb540-3" aria-hidden="true" tabindex="-1"></a>dat2 <span class="ot">&lt;-</span> WaffleDivorce <span class="sc">%&gt;%</span> </span>
<span id="cb540-4"><a href="the-haunted-dag-the-causal-terror.html#cb540-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">M =</span> <span class="fu">standardize</span>(Marriage),</span>
<span id="cb540-5"><a href="the-haunted-dag-the-causal-terror.html#cb540-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">A =</span> <span class="fu">standardize</span>(MedianAgeMarriage),</span>
<span id="cb540-6"><a href="the-haunted-dag-the-causal-terror.html#cb540-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">D =</span> <span class="fu">standardize</span>(Divorce),</span>
<span id="cb540-7"><a href="the-haunted-dag-the-causal-terror.html#cb540-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">S =</span> <span class="fu">factor</span>(South <span class="sc">+</span> <span class="dv">1</span>, <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;North&quot;</span>, <span class="st">&quot;South&quot;</span>)),</span>
<span id="cb540-8"><a href="the-haunted-dag-the-causal-terror.html#cb540-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">W =</span> <span class="fu">standardize</span>(WaffleHouses))  </span></code></pre></div>
<p>Sを入れてモデリング。<br />
Wはほとんど影響していないことが分かる。</p>
<div class="sourceCode" id="cb541"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb541-1"><a href="the-haunted-dag-the-causal-terror.html#cb541-1" aria-hidden="true" tabindex="-1"></a>b6H1 <span class="ot">&lt;-</span> </span>
<span id="cb541-2"><a href="the-haunted-dag-the-causal-terror.html#cb541-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">brm</span>(<span class="at">data =</span> dat2,</span>
<span id="cb541-3"><a href="the-haunted-dag-the-causal-terror.html#cb541-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> gaussian,</span>
<span id="cb541-4"><a href="the-haunted-dag-the-causal-terror.html#cb541-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">formula =</span> D <span class="sc">~</span> <span class="dv">0</span> <span class="sc">+</span> W <span class="sc">+</span> S,</span>
<span id="cb541-5"><a href="the-haunted-dag-the-causal-terror.html#cb541-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>,<span class="fl">0.5</span>),<span class="at">class =</span>b),</span>
<span id="cb541-6"><a href="the-haunted-dag-the-causal-terror.html#cb541-6" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>),<span class="at">class =</span> sigma)),</span>
<span id="cb541-7"><a href="the-haunted-dag-the-causal-terror.html#cb541-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">iter=</span><span class="dv">4000</span>, <span class="at">warmup=</span><span class="dv">2000</span>,</span>
<span id="cb541-8"><a href="the-haunted-dag-the-causal-terror.html#cb541-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">backend =</span> <span class="st">&quot;cmdstanr&quot;</span>,</span>
<span id="cb541-9"><a href="the-haunted-dag-the-causal-terror.html#cb541-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">file =</span> <span class="st">&quot;output/Chapter6/b6H1&quot;</span>)</span>
<span id="cb541-10"><a href="the-haunted-dag-the-causal-terror.html#cb541-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb541-11"><a href="the-haunted-dag-the-causal-terror.html#cb541-11" aria-hidden="true" tabindex="-1"></a><span class="fu">posterior_summary</span>(b6H1) <span class="sc">%&gt;%</span> </span>
<span id="cb541-12"><a href="the-haunted-dag-the-causal-terror.html#cb541-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">round</span>(<span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb541-13"><a href="the-haunted-dag-the-causal-terror.html#cb541-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb541-14"><a href="the-haunted-dag-the-causal-terror.html#cb541-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>(<span class="at">var =</span> <span class="st">&quot;parameter&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb541-15"><a href="the-haunted-dag-the-causal-terror.html#cb541-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>()</span></code></pre></div>
<pre><code>## # A tibble: 6 × 5
##   parameter Estimate Est.Error   Q2.5  Q97.5
##   &lt;chr&gt;        &lt;dbl&gt;     &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;
## 1 b_W           0.09      0.16  -0.23   0.41
## 2 b_SNorth     -0.16      0.17  -0.49   0.17
## 3 b_SSouth      0.36      0.27  -0.17   0.88
## 4 sigma         0.97      0.1    0.79   1.19
## 5 lprior       -2.22      0.47  -3.48  -1.67
## 6 lp__        -71.4       1.42 -75.0  -69.6</code></pre>
<p><br /></p>
</div>
<div id="h2-4" class="section level3 hasAnchor" number="6.5.4">
<h3><span class="header-section-number">6.5.4</span> 6H2<a href="the-haunted-dag-the-causal-terror.html#h2-4" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<blockquote>
<p>Build a series of models to test the implied conditional independencies of the causal graph you used in the previous problem. If any of the tests fail, how do you think the graph needs to be ammended? Does the graph need more or fewer arrows? Feel free to nominate variables that aren’t in the data.</p>
</blockquote>
<p>DAGの条件付き独立がどのような時に起こるかを調べてみる。 以下の3つをモデリングしてみる。</p>
<div class="sourceCode" id="cb543"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb543-1"><a href="the-haunted-dag-the-causal-terror.html#cb543-1" aria-hidden="true" tabindex="-1"></a>dag_coords <span class="ot">&lt;-</span></span>
<span id="cb543-2"><a href="the-haunted-dag-the-causal-terror.html#cb543-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="at">name =</span> <span class="fu">c</span>(<span class="st">&quot;A&quot;</span>, <span class="st">&quot;D&quot;</span>, <span class="st">&quot;M&quot;</span>, <span class="st">&quot;S&quot;</span>, <span class="st">&quot;W&quot;</span>),</span>
<span id="cb543-3"><a href="the-haunted-dag-the-causal-terror.html#cb543-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">x    =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">3</span>),</span>
<span id="cb543-4"><a href="the-haunted-dag-the-causal-terror.html#cb543-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">y    =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">3</span>))</span>
<span id="cb543-5"><a href="the-haunted-dag-the-causal-terror.html#cb543-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb543-6"><a href="the-haunted-dag-the-causal-terror.html#cb543-6" aria-hidden="true" tabindex="-1"></a>waffle_dag <span class="ot">&lt;-</span> </span>
<span id="cb543-7"><a href="the-haunted-dag-the-causal-terror.html#cb543-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dagify</span>(A <span class="sc">~</span> S,</span>
<span id="cb543-8"><a href="the-haunted-dag-the-causal-terror.html#cb543-8" aria-hidden="true" tabindex="-1"></a>       D <span class="sc">~</span> A <span class="sc">+</span> M <span class="sc">+</span> W,</span>
<span id="cb543-9"><a href="the-haunted-dag-the-causal-terror.html#cb543-9" aria-hidden="true" tabindex="-1"></a>       M <span class="sc">~</span> A <span class="sc">+</span> S,</span>
<span id="cb543-10"><a href="the-haunted-dag-the-causal-terror.html#cb543-10" aria-hidden="true" tabindex="-1"></a>       W <span class="sc">~</span> S,</span>
<span id="cb543-11"><a href="the-haunted-dag-the-causal-terror.html#cb543-11" aria-hidden="true" tabindex="-1"></a>       <span class="at">coords =</span> dag_coords) </span>
<span id="cb543-12"><a href="the-haunted-dag-the-causal-terror.html#cb543-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb543-13"><a href="the-haunted-dag-the-causal-terror.html#cb543-13" aria-hidden="true" tabindex="-1"></a><span class="fu">impliedConditionalIndependencies</span>((waffle_dag))</span></code></pre></div>
<pre><code>## A _||_ W | S
## D _||_ S | A, M, W
## M _||_ W | S</code></pre>
<p><br /></p>
<p>モデルの結果、1と3については条件付き独立を支持する結果が得られたた。<br />
2については信用区間が0にまたがっているが若干あいまいな結果だった。これはおそらくまだ他の要因が関わっているからだと思われる。　　</p>
<div class="sourceCode" id="cb545"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb545-1"><a href="the-haunted-dag-the-causal-terror.html#cb545-1" aria-hidden="true" tabindex="-1"></a>b6H2_1 <span class="ot">&lt;-</span> <span class="fu">brm</span>(<span class="at">data =</span> dat2,</span>
<span id="cb545-2"><a href="the-haunted-dag-the-causal-terror.html#cb545-2" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> gaussian,</span>
<span id="cb545-3"><a href="the-haunted-dag-the-causal-terror.html#cb545-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">formula =</span> A <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> W <span class="sc">+</span> South,</span>
<span id="cb545-4"><a href="the-haunted-dag-the-causal-terror.html#cb545-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>,<span class="fl">0.2</span>),<span class="at">class =</span> Intercept),</span>
<span id="cb545-5"><a href="the-haunted-dag-the-causal-terror.html#cb545-5" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>,<span class="fl">0.5</span>),<span class="at">class =</span>b),</span>
<span id="cb545-6"><a href="the-haunted-dag-the-causal-terror.html#cb545-6" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>),<span class="at">class =</span> sigma)),</span>
<span id="cb545-7"><a href="the-haunted-dag-the-causal-terror.html#cb545-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">iter=</span><span class="dv">4000</span>, <span class="at">warmup=</span><span class="dv">2000</span>,</span>
<span id="cb545-8"><a href="the-haunted-dag-the-causal-terror.html#cb545-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">backend =</span> <span class="st">&quot;cmdstanr&quot;</span>,</span>
<span id="cb545-9"><a href="the-haunted-dag-the-causal-terror.html#cb545-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">file =</span> <span class="st">&quot;output/Chapter6/b6H2_1&quot;</span>)</span>
<span id="cb545-10"><a href="the-haunted-dag-the-causal-terror.html#cb545-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb545-11"><a href="the-haunted-dag-the-causal-terror.html#cb545-11" aria-hidden="true" tabindex="-1"></a>b6H2_2 <span class="ot">&lt;-</span> <span class="fu">brm</span>(<span class="at">data =</span> dat2,</span>
<span id="cb545-12"><a href="the-haunted-dag-the-causal-terror.html#cb545-12" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> gaussian,</span>
<span id="cb545-13"><a href="the-haunted-dag-the-causal-terror.html#cb545-13" aria-hidden="true" tabindex="-1"></a>      <span class="at">formula =</span> D <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> A <span class="sc">+</span> M <span class="sc">+</span> W <span class="sc">+</span> South,</span>
<span id="cb545-14"><a href="the-haunted-dag-the-causal-terror.html#cb545-14" aria-hidden="true" tabindex="-1"></a>      <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>,<span class="fl">0.2</span>),<span class="at">class =</span> Intercept),</span>
<span id="cb545-15"><a href="the-haunted-dag-the-causal-terror.html#cb545-15" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>,<span class="fl">0.5</span>),<span class="at">class =</span>b),</span>
<span id="cb545-16"><a href="the-haunted-dag-the-causal-terror.html#cb545-16" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>),<span class="at">class =</span> sigma)),</span>
<span id="cb545-17"><a href="the-haunted-dag-the-causal-terror.html#cb545-17" aria-hidden="true" tabindex="-1"></a>      <span class="at">iter=</span><span class="dv">4000</span>, <span class="at">warmup=</span><span class="dv">2000</span>,</span>
<span id="cb545-18"><a href="the-haunted-dag-the-causal-terror.html#cb545-18" aria-hidden="true" tabindex="-1"></a>      <span class="at">backend =</span> <span class="st">&quot;cmdstanr&quot;</span>,</span>
<span id="cb545-19"><a href="the-haunted-dag-the-causal-terror.html#cb545-19" aria-hidden="true" tabindex="-1"></a>      <span class="at">file =</span> <span class="st">&quot;output/Chapter6/b6H2_2&quot;</span>)</span>
<span id="cb545-20"><a href="the-haunted-dag-the-causal-terror.html#cb545-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb545-21"><a href="the-haunted-dag-the-causal-terror.html#cb545-21" aria-hidden="true" tabindex="-1"></a>b6H2_3 <span class="ot">&lt;-</span> <span class="fu">brm</span>(<span class="at">data =</span> dat2,</span>
<span id="cb545-22"><a href="the-haunted-dag-the-causal-terror.html#cb545-22" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> gaussian,</span>
<span id="cb545-23"><a href="the-haunted-dag-the-causal-terror.html#cb545-23" aria-hidden="true" tabindex="-1"></a>      <span class="at">formula =</span> M <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> W <span class="sc">+</span> South,</span>
<span id="cb545-24"><a href="the-haunted-dag-the-causal-terror.html#cb545-24" aria-hidden="true" tabindex="-1"></a>      <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>,<span class="fl">0.2</span>),<span class="at">class =</span> Intercept),</span>
<span id="cb545-25"><a href="the-haunted-dag-the-causal-terror.html#cb545-25" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>,<span class="fl">0.5</span>),<span class="at">class =</span>b),</span>
<span id="cb545-26"><a href="the-haunted-dag-the-causal-terror.html#cb545-26" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>),<span class="at">class =</span> sigma)),</span>
<span id="cb545-27"><a href="the-haunted-dag-the-causal-terror.html#cb545-27" aria-hidden="true" tabindex="-1"></a>      <span class="at">iter=</span><span class="dv">4000</span>, <span class="at">warmup=</span><span class="dv">2000</span>,</span>
<span id="cb545-28"><a href="the-haunted-dag-the-causal-terror.html#cb545-28" aria-hidden="true" tabindex="-1"></a>      <span class="at">backend =</span> <span class="st">&quot;cmdstanr&quot;</span>,</span>
<span id="cb545-29"><a href="the-haunted-dag-the-causal-terror.html#cb545-29" aria-hidden="true" tabindex="-1"></a>      <span class="at">file =</span> <span class="st">&quot;output/Chapter6/b6H2_3&quot;</span>)</span>
<span id="cb545-30"><a href="the-haunted-dag-the-causal-terror.html#cb545-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb545-31"><a href="the-haunted-dag-the-causal-terror.html#cb545-31" aria-hidden="true" tabindex="-1"></a><span class="fu">posterior_summary</span>(b6H2_1) <span class="sc">%&gt;%</span> </span>
<span id="cb545-32"><a href="the-haunted-dag-the-causal-terror.html#cb545-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">round</span>(<span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb545-33"><a href="the-haunted-dag-the-causal-terror.html#cb545-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb545-34"><a href="the-haunted-dag-the-causal-terror.html#cb545-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>(<span class="at">var =</span> <span class="st">&quot;parameter&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb545-35"><a href="the-haunted-dag-the-causal-terror.html#cb545-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>()</span></code></pre></div>
<pre><code>## # A tibble: 6 × 5
##   parameter   Estimate Est.Error   Q2.5  Q97.5
##   &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;
## 1 b_Intercept     0.11      0.15  -0.17   0.4 
## 2 b_W             0.01      0.17  -0.33   0.33
## 3 b_South        -0.4       0.32  -1.02   0.25
## 4 sigma           1         0.1    0.82   1.23
## 5 lprior         -1.51      0.66  -3.22  -0.75
## 6 lp__          -72.1       1.44 -75.7  -70.3</code></pre>
<div class="sourceCode" id="cb547"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb547-1"><a href="the-haunted-dag-the-causal-terror.html#cb547-1" aria-hidden="true" tabindex="-1"></a><span class="fu">posterior_summary</span>(b6H2_2) <span class="sc">%&gt;%</span> </span>
<span id="cb547-2"><a href="the-haunted-dag-the-causal-terror.html#cb547-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">round</span>(<span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb547-3"><a href="the-haunted-dag-the-causal-terror.html#cb547-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb547-4"><a href="the-haunted-dag-the-causal-terror.html#cb547-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>(<span class="at">var =</span> <span class="st">&quot;parameter&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb547-5"><a href="the-haunted-dag-the-causal-terror.html#cb547-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>()</span></code></pre></div>
<pre><code>## # A tibble: 8 × 5
##   parameter   Estimate Est.Error   Q2.5  Q97.5
##   &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;
## 1 b_Intercept    -0.07      0.13  -0.32   0.18
## 2 b_A            -0.55      0.16  -0.86  -0.23
## 3 b_M            -0.04      0.16  -0.34   0.27
## 4 b_W             0.11      0.14  -0.17   0.38
## 5 b_South         0.23      0.29  -0.33   0.8 
## 6 sigma           0.81      0.09   0.66   1   
## 7 lprior         -2.21      0.54  -3.53  -1.43
## 8 lp__          -62.7       1.81 -67.2  -60.2</code></pre>
<div class="sourceCode" id="cb549"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb549-1"><a href="the-haunted-dag-the-causal-terror.html#cb549-1" aria-hidden="true" tabindex="-1"></a><span class="fu">posterior_summary</span>(b6H2_3) <span class="sc">%&gt;%</span> </span>
<span id="cb549-2"><a href="the-haunted-dag-the-causal-terror.html#cb549-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">round</span>(<span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb549-3"><a href="the-haunted-dag-the-causal-terror.html#cb549-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb549-4"><a href="the-haunted-dag-the-causal-terror.html#cb549-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>(<span class="at">var =</span> <span class="st">&quot;parameter&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb549-5"><a href="the-haunted-dag-the-causal-terror.html#cb549-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>()</span></code></pre></div>
<pre><code>## # A tibble: 6 × 5
##   parameter   Estimate Est.Error   Q2.5  Q97.5
##   &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;
## 1 b_Intercept    -0.04      0.15  -0.33   0.25
## 2 b_W            -0.02      0.17  -0.35   0.31
## 3 b_South         0.15      0.32  -0.48   0.76
## 4 sigma           1.02      0.11   0.84   1.26
## 5 lprior         -1.27      0.48  -2.49  -0.72
## 6 lp__          -73.1       1.44 -76.8  -71.3</code></pre>
<p><br /></p>
</div>
<div id="h3-4" class="section level3 hasAnchor" number="6.5.5">
<h3><span class="header-section-number">6.5.5</span> 6H3<a href="the-haunted-dag-the-causal-terror.html#h3-4" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<blockquote>
<p>Use a model to infer the total causal influence of area on weight. Would increasing the area available to each fox make it heavier (healthier)? You might want to standardize the variables. Regardless, use prior predictive simulation to show that your model’s prior predictions stay within the possible outcome range.</p>
</blockquote>
<p><img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-254-1.png" width="672" style="display: block; margin: auto;" /></p>
<p><br /></p>
<p>areaとweightは他の変数を条件づけなくてもバックドア基準を満たすため、どの変数も入れなくてよい。</p>
<div class="sourceCode" id="cb551"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb551-1"><a href="the-haunted-dag-the-causal-terror.html#cb551-1" aria-hidden="true" tabindex="-1"></a>dag_fox <span class="ot">&lt;-</span> <span class="fu">dagitty</span>(</span>
<span id="cb551-2"><a href="the-haunted-dag-the-causal-terror.html#cb551-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;dag{</span></span>
<span id="cb551-3"><a href="the-haunted-dag-the-causal-terror.html#cb551-3" aria-hidden="true" tabindex="-1"></a><span class="st">  area -&gt; avgfood -&gt; weight &lt;- groupsize ;</span></span>
<span id="cb551-4"><a href="the-haunted-dag-the-causal-terror.html#cb551-4" aria-hidden="true" tabindex="-1"></a><span class="st">  avgfood -&gt; groupsize</span></span>
<span id="cb551-5"><a href="the-haunted-dag-the-causal-terror.html#cb551-5" aria-hidden="true" tabindex="-1"></a><span class="st">  }&quot;</span></span>
<span id="cb551-6"><a href="the-haunted-dag-the-causal-terror.html#cb551-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb551-7"><a href="the-haunted-dag-the-causal-terror.html#cb551-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb551-8"><a href="the-haunted-dag-the-causal-terror.html#cb551-8" aria-hidden="true" tabindex="-1"></a><span class="fu">adjustmentSets</span>(dag_fox, <span class="at">exposure =</span> <span class="st">&quot;area&quot;</span>, <span class="at">outcome =</span><span class="st">&quot;weight&quot;</span>)</span></code></pre></div>
<pre><code>##  {}</code></pre>
<div class="sourceCode" id="cb553"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb553-1"><a href="the-haunted-dag-the-causal-terror.html#cb553-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(foxes)</span>
<span id="cb553-2"><a href="the-haunted-dag-the-causal-terror.html#cb553-2" aria-hidden="true" tabindex="-1"></a>dat3 <span class="ot">&lt;-</span> foxes <span class="sc">%&gt;%</span> </span>
<span id="cb553-3"><a href="the-haunted-dag-the-causal-terror.html#cb553-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb553-4"><a href="the-haunted-dag-the-causal-terror.html#cb553-4" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(area, avgfood, weight, groupsize) <span class="sc">%&gt;%</span> </span>
<span id="cb553-5"><a href="the-haunted-dag-the-causal-terror.html#cb553-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">everything</span>(),standardize))</span>
<span id="cb553-6"><a href="the-haunted-dag-the-causal-terror.html#cb553-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb553-7"><a href="the-haunted-dag-the-causal-terror.html#cb553-7" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(dat3)</span></code></pre></div>
<pre><code>## # A tibble: 6 × 4
##   area       avgfood    weight     groupsize 
##   &lt;dw_trnsf&gt; &lt;dw_trnsf&gt; &lt;dw_trnsf&gt; &lt;dw_trnsf&gt;
## 1 -2.239596  -1.924829   0.4141347 -1.524089 
## 2 -2.239596  -1.924829  -1.4270464 -1.524089 
## 3 -1.205508  -1.118035   0.6759540 -1.524089 
## 4 -1.205508  -1.118035   1.3009421 -1.524089 
## 5 -1.130106  -1.319734   1.1151348 -1.524089 
## 6 -1.130106  -1.319734  -1.0807692 -1.524089</code></pre>
<div class="sourceCode" id="cb555"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb555-1"><a href="the-haunted-dag-the-causal-terror.html#cb555-1" aria-hidden="true" tabindex="-1"></a><span class="fu">pairs</span>(dat3)</span></code></pre></div>
<p><img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-256-1.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb556"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb556-1"><a href="the-haunted-dag-the-causal-terror.html#cb556-1" aria-hidden="true" tabindex="-1"></a>b6H3 <span class="ot">&lt;-</span> </span>
<span id="cb556-2"><a href="the-haunted-dag-the-causal-terror.html#cb556-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">brm</span>(<span class="at">data =</span> dat3,</span>
<span id="cb556-3"><a href="the-haunted-dag-the-causal-terror.html#cb556-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> gaussian,</span>
<span id="cb556-4"><a href="the-haunted-dag-the-causal-terror.html#cb556-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">formula =</span> weight <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> area,</span>
<span id="cb556-5"><a href="the-haunted-dag-the-causal-terror.html#cb556-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">0.2</span>),<span class="at">class=</span>Intercept),</span>
<span id="cb556-6"><a href="the-haunted-dag-the-causal-terror.html#cb556-6" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">0.5</span>), <span class="at">class =</span> b,),</span>
<span id="cb556-7"><a href="the-haunted-dag-the-causal-terror.html#cb556-7" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>), <span class="at">class =</span> sigma)),</span>
<span id="cb556-8"><a href="the-haunted-dag-the-causal-terror.html#cb556-8" aria-hidden="true" tabindex="-1"></a>                <span class="at">iter =</span> <span class="dv">4000</span>, <span class="at">warmup =</span> <span class="dv">2000</span>, <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>, <span class="at">seed =</span> <span class="dv">1234</span>,</span>
<span id="cb556-9"><a href="the-haunted-dag-the-causal-terror.html#cb556-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">backend =</span> <span class="st">&quot;cmdstanr&quot;</span>,</span>
<span id="cb556-10"><a href="the-haunted-dag-the-causal-terror.html#cb556-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">file =</span> <span class="st">&quot;output/Chapter6/b6H3&quot;</span>)</span></code></pre></div>
<p><br /></p>
<p>areaはほとんど影響していなかった。</p>
<div class="sourceCode" id="cb557"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb557-1"><a href="the-haunted-dag-the-causal-terror.html#cb557-1" aria-hidden="true" tabindex="-1"></a><span class="fu">posterior_samples</span>(b6H3) <span class="sc">%&gt;%</span> </span>
<span id="cb557-2"><a href="the-haunted-dag-the-causal-terror.html#cb557-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb557-3"><a href="the-haunted-dag-the-causal-terror.html#cb557-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>lp__) <span class="sc">%&gt;%</span> </span>
<span id="cb557-4"><a href="the-haunted-dag-the-causal-terror.html#cb557-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">everything</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb557-5"><a href="the-haunted-dag-the-causal-terror.html#cb557-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">name =</span> <span class="fu">factor</span>(name, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&quot;b_Intercept&quot;</span>, <span class="st">&quot;b_area&quot;</span>, <span class="st">&quot;sigma&quot;</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb557-6"><a href="the-haunted-dag-the-causal-terror.html#cb557-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> value, <span class="at">y =</span> <span class="fu">fct_rev</span>(name))) <span class="sc">+</span></span>
<span id="cb557-7"><a href="the-haunted-dag-the-causal-terror.html#cb557-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_halfeye</span>(<span class="at">.width =</span> <span class="fu">c</span>(<span class="fl">0.67</span>, <span class="fl">0.89</span>, <span class="fl">0.97</span>)) <span class="sc">+</span></span>
<span id="cb557-8"><a href="the-haunted-dag-the-causal-terror.html#cb557-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Parameter Estimate&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Parameter&quot;</span>)</span></code></pre></div>
<p><img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-257-1.png" width="672" style="display: block; margin: auto;" />
<br /></p>
</div>
<div id="h4-4" class="section level3 hasAnchor" number="6.5.6">
<h3><span class="header-section-number">6.5.6</span> 6H4<a href="the-haunted-dag-the-causal-terror.html#h4-4" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<blockquote>
<p>Now infer the causal impact of adding food to a territory. Would this make foxes heavier? Which covariates do you need to adjust for to estimate the total causal influence of food?</p>
</blockquote>
<p>続いて、えさの量が体重に与える影響を考える。<br />
えさの量が体重に与える影響を評価するために他の変数を加える必要はない。</p>
<div class="sourceCode" id="cb558"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb558-1"><a href="the-haunted-dag-the-causal-terror.html#cb558-1" aria-hidden="true" tabindex="-1"></a><span class="fu">adjustmentSets</span>(dag_fox, <span class="at">exposure =</span> <span class="st">&quot;avgfood&quot;</span>, <span class="at">outcome =</span><span class="st">&quot;weight&quot;</span>)</span></code></pre></div>
<pre><code>##  {}</code></pre>
<p>えさの量も影響せず。</p>
<div class="sourceCode" id="cb560"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb560-1"><a href="the-haunted-dag-the-causal-terror.html#cb560-1" aria-hidden="true" tabindex="-1"></a>b6H4 <span class="ot">&lt;-</span> </span>
<span id="cb560-2"><a href="the-haunted-dag-the-causal-terror.html#cb560-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">brm</span>(<span class="at">data =</span> dat3,</span>
<span id="cb560-3"><a href="the-haunted-dag-the-causal-terror.html#cb560-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> gaussian,</span>
<span id="cb560-4"><a href="the-haunted-dag-the-causal-terror.html#cb560-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">formula =</span> weight <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> avgfood,</span>
<span id="cb560-5"><a href="the-haunted-dag-the-causal-terror.html#cb560-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">0.2</span>),<span class="at">class=</span>Intercept),</span>
<span id="cb560-6"><a href="the-haunted-dag-the-causal-terror.html#cb560-6" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">0.5</span>), <span class="at">class =</span> b,),</span>
<span id="cb560-7"><a href="the-haunted-dag-the-causal-terror.html#cb560-7" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>), <span class="at">class =</span> sigma)),</span>
<span id="cb560-8"><a href="the-haunted-dag-the-causal-terror.html#cb560-8" aria-hidden="true" tabindex="-1"></a>                <span class="at">iter =</span> <span class="dv">4000</span>, <span class="at">warmup =</span> <span class="dv">2000</span>, <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>, <span class="at">seed =</span> <span class="dv">1234</span>,</span>
<span id="cb560-9"><a href="the-haunted-dag-the-causal-terror.html#cb560-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">backend =</span> <span class="st">&quot;cmdstanr&quot;</span>,</span>
<span id="cb560-10"><a href="the-haunted-dag-the-causal-terror.html#cb560-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">file =</span> <span class="st">&quot;output/Chapter6/b6H4&quot;</span>)</span>
<span id="cb560-11"><a href="the-haunted-dag-the-causal-terror.html#cb560-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb560-12"><a href="the-haunted-dag-the-causal-terror.html#cb560-12" aria-hidden="true" tabindex="-1"></a><span class="fu">posterior_samples</span>(b6H4) <span class="sc">%&gt;%</span> </span>
<span id="cb560-13"><a href="the-haunted-dag-the-causal-terror.html#cb560-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb560-14"><a href="the-haunted-dag-the-causal-terror.html#cb560-14" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>lp__) <span class="sc">%&gt;%</span> </span>
<span id="cb560-15"><a href="the-haunted-dag-the-causal-terror.html#cb560-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">everything</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb560-16"><a href="the-haunted-dag-the-causal-terror.html#cb560-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">name =</span> <span class="fu">factor</span>(name, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&quot;b_Intercept&quot;</span>, <span class="st">&quot;b_avgfood&quot;</span>, <span class="st">&quot;sigma&quot;</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb560-17"><a href="the-haunted-dag-the-causal-terror.html#cb560-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> value, <span class="at">y =</span> <span class="fu">fct_rev</span>(name))) <span class="sc">+</span></span>
<span id="cb560-18"><a href="the-haunted-dag-the-causal-terror.html#cb560-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_halfeye</span>(<span class="at">.width =</span> <span class="fu">c</span>(<span class="fl">0.67</span>, <span class="fl">0.89</span>, <span class="fl">0.97</span>)) <span class="sc">+</span></span>
<span id="cb560-19"><a href="the-haunted-dag-the-causal-terror.html#cb560-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Parameter Estimate&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Parameter&quot;</span>)</span></code></pre></div>
<p><img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-259-1.png" width="672" style="display: block; margin: auto;" />
<br /></p>
</div>
<div id="h5-2" class="section level3 hasAnchor" number="6.5.7">
<h3><span class="header-section-number">6.5.7</span> 6H5<a href="the-haunted-dag-the-causal-terror.html#h5-2" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<blockquote>
<p>Now infer the causal impact of group size. Which covariates do you need to adjust for? Looking at the posterior distribution of the resulting model, what do you think explains these data? That is, can you explain the estimates for all three problems? How do they go together?</p>
</blockquote>
<p>最後にgroupsizeの影響を見る。その際には、avgfoodも説明変数に入れる必要がある。<br />
その結果、groupsizeはavgfoodを固定したときに負の影響を与えていることが分かった。また、avgfoodはgroupsizeを固定したときに正の影響を与えることが分かった。<br />
ただし、avgfoodがweightに与える全体的な影響は前問で見たように0である。これは、avgfoodが増えればgroupsizeも増えてしまうからである。</p>
<div class="sourceCode" id="cb561"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb561-1"><a href="the-haunted-dag-the-causal-terror.html#cb561-1" aria-hidden="true" tabindex="-1"></a>b6H5 <span class="ot">&lt;-</span> </span>
<span id="cb561-2"><a href="the-haunted-dag-the-causal-terror.html#cb561-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">brm</span>(<span class="at">data =</span> dat3,</span>
<span id="cb561-3"><a href="the-haunted-dag-the-causal-terror.html#cb561-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> gaussian,</span>
<span id="cb561-4"><a href="the-haunted-dag-the-causal-terror.html#cb561-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">formula =</span> weight <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> avgfood <span class="sc">+</span> groupsize,</span>
<span id="cb561-5"><a href="the-haunted-dag-the-causal-terror.html#cb561-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">0.2</span>),<span class="at">class=</span>Intercept),</span>
<span id="cb561-6"><a href="the-haunted-dag-the-causal-terror.html#cb561-6" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">0.5</span>), <span class="at">class =</span> b,),</span>
<span id="cb561-7"><a href="the-haunted-dag-the-causal-terror.html#cb561-7" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>), <span class="at">class =</span> sigma)),</span>
<span id="cb561-8"><a href="the-haunted-dag-the-causal-terror.html#cb561-8" aria-hidden="true" tabindex="-1"></a>                <span class="at">iter =</span> <span class="dv">4000</span>, <span class="at">warmup =</span> <span class="dv">2000</span>, <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>, <span class="at">seed =</span> <span class="dv">1234</span>,</span>
<span id="cb561-9"><a href="the-haunted-dag-the-causal-terror.html#cb561-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">file =</span> <span class="st">&quot;output/Chapter6/b6H5&quot;</span>)</span>
<span id="cb561-10"><a href="the-haunted-dag-the-causal-terror.html#cb561-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb561-11"><a href="the-haunted-dag-the-causal-terror.html#cb561-11" aria-hidden="true" tabindex="-1"></a><span class="fu">posterior_samples</span>(b6H5) <span class="sc">%&gt;%</span> </span>
<span id="cb561-12"><a href="the-haunted-dag-the-causal-terror.html#cb561-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb561-13"><a href="the-haunted-dag-the-causal-terror.html#cb561-13" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>lp__) <span class="sc">%&gt;%</span> </span>
<span id="cb561-14"><a href="the-haunted-dag-the-causal-terror.html#cb561-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">everything</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb561-15"><a href="the-haunted-dag-the-causal-terror.html#cb561-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">name =</span> <span class="fu">factor</span>(name, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&quot;b_Intercept&quot;</span>, <span class="st">&quot;b_avgfood&quot;</span>,<span class="st">&quot;b_groupsize&quot;</span>, <span class="st">&quot;sigma&quot;</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb561-16"><a href="the-haunted-dag-the-causal-terror.html#cb561-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> value, <span class="at">y =</span> <span class="fu">fct_rev</span>(name))) <span class="sc">+</span></span>
<span id="cb561-17"><a href="the-haunted-dag-the-causal-terror.html#cb561-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_halfeye</span>(<span class="at">.width =</span> <span class="fu">c</span>(<span class="fl">0.67</span>, <span class="fl">0.89</span>, <span class="fl">0.97</span>)) <span class="sc">+</span></span>
<span id="cb561-18"><a href="the-haunted-dag-the-causal-terror.html#cb561-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Parameter Estimate&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Parameter&quot;</span>)</span></code></pre></div>
<p><img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-260-1.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb562"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb562-1"><a href="the-haunted-dag-the-causal-terror.html#cb562-1" aria-hidden="true" tabindex="-1"></a><span class="fu">posterior_summary</span>(b6H5) <span class="sc">%&gt;%</span> </span>
<span id="cb562-2"><a href="the-haunted-dag-the-causal-terror.html#cb562-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">round</span>(<span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb562-3"><a href="the-haunted-dag-the-causal-terror.html#cb562-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb562-4"><a href="the-haunted-dag-the-causal-terror.html#cb562-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>(<span class="at">var =</span> <span class="st">&quot;parameter&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb562-5"><a href="the-haunted-dag-the-causal-terror.html#cb562-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>()</span></code></pre></div>
<pre><code>## # A tibble: 6 × 5
##   parameter   Estimate Est.Error    Q2.5   Q97.5
##   &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;
## 1 b_Intercept     0         0.08   -0.16    0.16
## 2 b_avgfood       0.47      0.18    0.1     0.82
## 3 b_groupsize    -0.56      0.18   -0.91   -0.2 
## 4 sigma           0.96      0.07    0.85    1.1 
## 5 lprior         -2.01      0.74   -3.75   -0.92
## 6 lp__         -162.        1.41 -166.   -160.</code></pre>
</div>
</div>
<div id="おまけ-ランダム効果を入れてみる" class="section level2 hasAnchor" number="6.6">
<h2><span class="header-section-number">6.6</span> おまけ　ランダム効果を入れてみる<a href="the-haunted-dag-the-causal-terror.html#おまけ-ランダム効果を入れてみる" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="sourceCode" id="cb564"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb564-1"><a href="the-haunted-dag-the-causal-terror.html#cb564-1" aria-hidden="true" tabindex="-1"></a>dat3 <span class="ot">&lt;-</span> foxes <span class="sc">%&gt;%</span> </span>
<span id="cb564-2"><a href="the-haunted-dag-the-causal-terror.html#cb564-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span>  </span>
<span id="cb564-3"><a href="the-haunted-dag-the-causal-terror.html#cb564-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="dv">2</span><span class="sc">:</span><span class="dv">5</span>,standardize))</span>
<span id="cb564-4"><a href="the-haunted-dag-the-causal-terror.html#cb564-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb564-5"><a href="the-haunted-dag-the-causal-terror.html#cb564-5" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(dat3)</span></code></pre></div>
<pre><code>## # A tibble: 6 × 5
##   group avgfood    groupsize  area       weight    
##   &lt;int&gt; &lt;dw_trnsf&gt; &lt;dw_trnsf&gt; &lt;dw_trnsf&gt; &lt;dw_trnsf&gt;
## 1     1 -1.924829  -1.524089  -2.239596   0.4141347
## 2     1 -1.924829  -1.524089  -2.239596  -1.4270464
## 3     2 -1.118035  -1.524089  -1.205508   0.6759540
## 4     2 -1.118035  -1.524089  -1.205508   1.3009421
## 5     3 -1.319734  -1.524089  -1.130106   1.1151348
## 6     3 -1.319734  -1.524089  -1.130106  -1.0807692</code></pre>
<div class="sourceCode" id="cb566"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb566-1"><a href="the-haunted-dag-the-causal-terror.html#cb566-1" aria-hidden="true" tabindex="-1"></a>b6H5_2 <span class="ot">&lt;-</span> </span>
<span id="cb566-2"><a href="the-haunted-dag-the-causal-terror.html#cb566-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">brm</span>(<span class="at">data =</span> dat3,</span>
<span id="cb566-3"><a href="the-haunted-dag-the-causal-terror.html#cb566-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> gaussian,</span>
<span id="cb566-4"><a href="the-haunted-dag-the-causal-terror.html#cb566-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">formula =</span> weight <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> avgfood <span class="sc">+</span> groupsize <span class="sc">+</span> (<span class="dv">1</span><span class="sc">|</span>group),</span>
<span id="cb566-5"><a href="the-haunted-dag-the-causal-terror.html#cb566-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">0.2</span>),<span class="at">class=</span>Intercept),</span>
<span id="cb566-6"><a href="the-haunted-dag-the-causal-terror.html#cb566-6" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">0.5</span>), <span class="at">class =</span> b,),</span>
<span id="cb566-7"><a href="the-haunted-dag-the-causal-terror.html#cb566-7" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>), <span class="at">class =</span> sigma)),</span>
<span id="cb566-8"><a href="the-haunted-dag-the-causal-terror.html#cb566-8" aria-hidden="true" tabindex="-1"></a>                <span class="at">iter =</span> <span class="dv">4000</span>, <span class="at">warmup =</span> <span class="dv">2000</span>, <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>, <span class="at">seed =</span> <span class="dv">1234</span>,</span>
<span id="cb566-9"><a href="the-haunted-dag-the-causal-terror.html#cb566-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">backend =</span> <span class="st">&quot;cmdstanr&quot;</span>,</span>
<span id="cb566-10"><a href="the-haunted-dag-the-causal-terror.html#cb566-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">file =</span> <span class="st">&quot;output/Chapter6/b6H5_2&quot;</span>)</span>
<span id="cb566-11"><a href="the-haunted-dag-the-causal-terror.html#cb566-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb566-12"><a href="the-haunted-dag-the-causal-terror.html#cb566-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb566-13"><a href="the-haunted-dag-the-causal-terror.html#cb566-13" aria-hidden="true" tabindex="-1"></a><span class="fu">posterior_summary</span>(b6H5_2) <span class="sc">%&gt;%</span> </span>
<span id="cb566-14"><a href="the-haunted-dag-the-causal-terror.html#cb566-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">round</span>(<span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb566-15"><a href="the-haunted-dag-the-causal-terror.html#cb566-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb566-16"><a href="the-haunted-dag-the-causal-terror.html#cb566-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>(<span class="at">var =</span> <span class="st">&quot;parameter&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb566-17"><a href="the-haunted-dag-the-causal-terror.html#cb566-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>()</span></code></pre></div>
<pre><code>## # A tibble: 37 × 5
##    parameter            Estimate Est.Error  Q2.5 Q97.5
##    &lt;chr&gt;                   &lt;dbl&gt;     &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
##  1 b_Intercept              0         0.09 -0.17  0.18
##  2 b_avgfood                0.46      0.2   0.07  0.84
##  3 b_groupsize             -0.55      0.2  -0.93 -0.16
##  4 sd_group__Intercept      0.18      0.12  0.01  0.44
##  5 sigma                    0.95      0.07  0.83  1.09
##  6 r_group[1,Intercept]    -0.04      0.2  -0.5   0.35
##  7 r_group[2,Intercept]     0.06      0.2  -0.29  0.53
##  8 r_group[3,Intercept]    -0.02      0.2  -0.48  0.38
##  9 r_group[4,Intercept]    -0.02      0.19 -0.46  0.38
## 10 r_group[5,Intercept]     0.08      0.2  -0.27  0.59
## # … with 27 more rows</code></pre>
<p><br /></p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="the-many-variables-the-spurious-waffles.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="ulysses-compass.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
