<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>11 God Spiked the Integers | Statistical Rethinking Second Edition</title>
  <meta name="description" content="11 God Spiked the Integers | Statistical Rethinking Second Edition" />
  <meta name="generator" content="bookdown 0.31 and GitBook 2.6.7" />

  <meta property="og:title" content="11 God Spiked the Integers | Statistical Rethinking Second Edition" />
  <meta property="og:type" content="book" />
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="11 God Spiked the Integers | Statistical Rethinking Second Edition" />
  
  
  

<meta name="author" content="Tsubasa Yamaguchi" />


<meta name="date" content="2023-02-01" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="big-entropy-and-the-generalized-linear-model.html"/>
<link rel="next" href="monsters-and-mixtures.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<script src="libs/htmlwidgets-1.6.1/htmlwidgets.js"></script>
<link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet" />
<script src="libs/datatables-binding-0.27/datatables.js"></script>
<link href="libs/dt-core-1.12.1/css/jquery.dataTables.min.css" rel="stylesheet" />
<link href="libs/dt-core-1.12.1/css/jquery.dataTables.extra.css" rel="stylesheet" />
<script src="libs/dt-core-1.12.1/js/jquery.dataTables.min.js"></script>
<link href="libs/crosstalk-1.2.0/css/crosstalk.min.css" rel="stylesheet" />
<script src="libs/crosstalk-1.2.0/js/crosstalk.min.js"></script>
<link href="libs/tabwid-1.1.2/tabwid.css" rel="stylesheet" />
<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="custom_style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>本稿の目的</a></li>
<li class="chapter" data-level="" data-path="パッケージの読み込み.html"><a href="パッケージの読み込み.html"><i class="fa fa-check"></i>パッケージの読み込み</a></li>
<li class="chapter" data-level="1" data-path="the-golem-of-prague.html"><a href="the-golem-of-prague.html"><i class="fa fa-check"></i><b>1</b> The Golem of Prague 　</a></li>
<li class="chapter" data-level="2" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html"><i class="fa fa-check"></i><b>2</b> Small Worlds and Large Worlds</a>
<ul>
<li class="chapter" data-level="2.1" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#byesian-updating"><i class="fa fa-check"></i><b>2.1</b> Byesian Updating</a></li>
<li class="chapter" data-level="2.2" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#making-th-model"><i class="fa fa-check"></i><b>2.2</b> Making th model</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#grid-approximation"><i class="fa fa-check"></i><b>2.2.1</b> Grid approximation</a></li>
<li class="chapter" data-level="2.2.2" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#quadratic-approximation"><i class="fa fa-check"></i><b>2.2.2</b> Quadratic approximation</a></li>
<li class="chapter" data-level="2.2.3" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#mcmc"><i class="fa fa-check"></i><b>2.2.3</b> MCMC</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#practice"><i class="fa fa-check"></i><b>2.3</b> Practice</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#m1"><i class="fa fa-check"></i><b>2.3.1</b> 2M1</a></li>
<li class="chapter" data-level="2.3.2" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#m2"><i class="fa fa-check"></i><b>2.3.2</b> 2M2</a></li>
<li class="chapter" data-level="2.3.3" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#m3"><i class="fa fa-check"></i><b>2.3.3</b> 2M3</a></li>
<li class="chapter" data-level="2.3.4" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#m4"><i class="fa fa-check"></i><b>2.3.4</b> 2M4</a></li>
<li class="chapter" data-level="2.3.5" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#m5"><i class="fa fa-check"></i><b>2.3.5</b> 2M5</a></li>
<li class="chapter" data-level="2.3.6" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#m7"><i class="fa fa-check"></i><b>2.3.6</b> 2M7</a></li>
<li class="chapter" data-level="2.3.7" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#h1"><i class="fa fa-check"></i><b>2.3.7</b> 2H1</a></li>
<li class="chapter" data-level="2.3.8" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#h2"><i class="fa fa-check"></i><b>2.3.8</b> 2H2</a></li>
<li class="chapter" data-level="2.3.9" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#h3"><i class="fa fa-check"></i><b>2.3.9</b> 2H3</a></li>
<li class="chapter" data-level="2.3.10" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#h4"><i class="fa fa-check"></i><b>2.3.10</b> 2H4</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html"><i class="fa fa-check"></i><b>3</b> Sampling the Imaginary</a>
<ul>
<li class="chapter" data-level="3.1" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#sampling-from-a-grid-aproximate-posterior"><i class="fa fa-check"></i><b>3.1</b> Sampling from a grid-aproximate posterior</a></li>
<li class="chapter" data-level="3.2" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#sampling-to-summarize"><i class="fa fa-check"></i><b>3.2</b> Sampling to summarize</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#intervals-of-defined-mass"><i class="fa fa-check"></i><b>3.2.1</b> Intervals of defined mass</a></li>
<li class="chapter" data-level="3.2.2" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#highly-skewed-example"><i class="fa fa-check"></i><b>3.2.2</b> highly skewed example</a></li>
<li class="chapter" data-level="3.2.3" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#point-estimate"><i class="fa fa-check"></i><b>3.2.3</b> Point estimate　　</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#sampling-to-simulate-prediction"><i class="fa fa-check"></i><b>3.3</b> Sampling to simulate prediction</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#model-checking"><i class="fa fa-check"></i><b>3.3.1</b> Model checking</a></li>
<li class="chapter" data-level="3.3.2" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#practice-with-brms"><i class="fa fa-check"></i><b>3.3.2</b> Practice with brms</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#practice-1"><i class="fa fa-check"></i><b>3.4</b> Practice</a>
<ul>
<li class="chapter" data-level="3.4.1" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#e"><i class="fa fa-check"></i><b>3.4.1</b> 3E</a></li>
<li class="chapter" data-level="3.4.2" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#m"><i class="fa fa-check"></i><b>3.4.2</b> 3M</a></li>
<li class="chapter" data-level="3.4.3" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#h"><i class="fa fa-check"></i><b>3.4.3</b> 3H</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="geocentric-model.html"><a href="geocentric-model.html"><i class="fa fa-check"></i><b>4</b> Geocentric Model</a>
<ul>
<li class="chapter" data-level="4.1" data-path="geocentric-model.html"><a href="geocentric-model.html#why-normal-distributions-are-normal"><i class="fa fa-check"></i><b>4.1</b> Why normal distributions are normal</a></li>
<li class="chapter" data-level="4.2" data-path="geocentric-model.html"><a href="geocentric-model.html#normal-by-multiplication"><i class="fa fa-check"></i><b>4.2</b> Normal by multiplication</a></li>
<li class="chapter" data-level="4.3" data-path="geocentric-model.html"><a href="geocentric-model.html#gaussian-model-of-height"><i class="fa fa-check"></i><b>4.3</b> Gaussian model of height</a></li>
<li class="chapter" data-level="4.4" data-path="geocentric-model.html"><a href="geocentric-model.html#grid-approximationで事後分布を描く"><i class="fa fa-check"></i><b>4.4</b> Grid approximationで事後分布を描く</a>
<ul>
<li class="chapter" data-level="4.4.1" data-path="geocentric-model.html"><a href="geocentric-model.html#事後分布からサンプリングする"><i class="fa fa-check"></i><b>4.4.1</b> 事後分布からサンプリングする</a></li>
<li class="chapter" data-level="4.4.2" data-path="geocentric-model.html"><a href="geocentric-model.html#rethinking"><i class="fa fa-check"></i><b>4.4.2</b> rethinking</a></li>
<li class="chapter" data-level="4.4.3" data-path="geocentric-model.html"><a href="geocentric-model.html#finding-posterior-with-brms"><i class="fa fa-check"></i><b>4.4.3</b> Finding posterior with brms</a></li>
<li class="chapter" data-level="4.4.4" data-path="geocentric-model.html"><a href="geocentric-model.html#事後分布からのサンプリング"><i class="fa fa-check"></i><b>4.4.4</b> 事後分布からのサンプリング</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="geocentric-model.html"><a href="geocentric-model.html#linear-prediction"><i class="fa fa-check"></i><b>4.5</b> Linear prediction</a>
<ul>
<li class="chapter" data-level="4.5.1" data-path="geocentric-model.html"><a href="geocentric-model.html#finding-the-posterior-distribution"><i class="fa fa-check"></i><b>4.5.1</b> Finding the posterior distribution</a></li>
<li class="chapter" data-level="4.5.2" data-path="geocentric-model.html"><a href="geocentric-model.html#plotting-posterior-inference-agaist-the-data"><i class="fa fa-check"></i><b>4.5.2</b> Plotting posterior inference agaist the data</a></li>
<li class="chapter" data-level="4.5.3" data-path="geocentric-model.html"><a href="geocentric-model.html#plotting-regression-intervals-and-contours"><i class="fa fa-check"></i><b>4.5.3</b> Plotting regression intervals and contours</a></li>
<li class="chapter" data-level="4.5.4" data-path="geocentric-model.html"><a href="geocentric-model.html#prediction-intervals"><i class="fa fa-check"></i><b>4.5.4</b> Prediction intervals</a></li>
</ul></li>
<li class="chapter" data-level="4.6" data-path="geocentric-model.html"><a href="geocentric-model.html#curves-from-lines"><i class="fa fa-check"></i><b>4.6</b> Curves from lines</a>
<ul>
<li class="chapter" data-level="4.6.1" data-path="geocentric-model.html"><a href="geocentric-model.html#polynomial-regression"><i class="fa fa-check"></i><b>4.6.1</b> Polynomial regression</a></li>
<li class="chapter" data-level="4.6.2" data-path="geocentric-model.html"><a href="geocentric-model.html#overthinking"><i class="fa fa-check"></i><b>4.6.2</b> overthinking</a></li>
<li class="chapter" data-level="4.6.3" data-path="geocentric-model.html"><a href="geocentric-model.html#splines"><i class="fa fa-check"></i><b>4.6.3</b> Splines</a></li>
</ul></li>
<li class="chapter" data-level="4.7" data-path="geocentric-model.html"><a href="geocentric-model.html#practice-2"><i class="fa fa-check"></i><b>4.7</b> Practice</a>
<ul>
<li class="chapter" data-level="4.7.1" data-path="geocentric-model.html"><a href="geocentric-model.html#m1-2"><i class="fa fa-check"></i><b>4.7.1</b> 4M1</a></li>
<li class="chapter" data-level="4.7.2" data-path="geocentric-model.html"><a href="geocentric-model.html#m2-2"><i class="fa fa-check"></i><b>4.7.2</b> 4M2</a></li>
<li class="chapter" data-level="4.7.3" data-path="geocentric-model.html"><a href="geocentric-model.html#m4-2"><i class="fa fa-check"></i><b>4.7.3</b> 4M4</a></li>
<li class="chapter" data-level="4.7.4" data-path="geocentric-model.html"><a href="geocentric-model.html#m5-2"><i class="fa fa-check"></i><b>4.7.4</b> 4M5</a></li>
<li class="chapter" data-level="4.7.5" data-path="geocentric-model.html"><a href="geocentric-model.html#m6-1"><i class="fa fa-check"></i><b>4.7.5</b> 4M6</a></li>
<li class="chapter" data-level="4.7.6" data-path="geocentric-model.html"><a href="geocentric-model.html#m7-1"><i class="fa fa-check"></i><b>4.7.6</b> 4M7</a></li>
<li class="chapter" data-level="4.7.7" data-path="geocentric-model.html"><a href="geocentric-model.html#m8"><i class="fa fa-check"></i><b>4.7.7</b> 4M8</a></li>
<li class="chapter" data-level="4.7.8" data-path="geocentric-model.html"><a href="geocentric-model.html#h1-2"><i class="fa fa-check"></i><b>4.7.8</b> 4H1</a></li>
<li class="chapter" data-level="4.7.9" data-path="geocentric-model.html"><a href="geocentric-model.html#h2-2"><i class="fa fa-check"></i><b>4.7.9</b> 4H2</a></li>
<li class="chapter" data-level="4.7.10" data-path="geocentric-model.html"><a href="geocentric-model.html#h3-2"><i class="fa fa-check"></i><b>4.7.10</b> 4H3</a></li>
<li class="chapter" data-level="4.7.11" data-path="geocentric-model.html"><a href="geocentric-model.html#h4-2"><i class="fa fa-check"></i><b>4.7.11</b> 4H4</a></li>
<li class="chapter" data-level="4.7.12" data-path="geocentric-model.html"><a href="geocentric-model.html#h5-1"><i class="fa fa-check"></i><b>4.7.12</b> 4H5</a></li>
<li class="chapter" data-level="4.7.13" data-path="geocentric-model.html"><a href="geocentric-model.html#h6"><i class="fa fa-check"></i><b>4.7.13</b> 4H6</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html"><i class="fa fa-check"></i><b>5</b> The many variables &amp; the spurious waffles</a>
<ul>
<li class="chapter" data-level="5.1" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#spurious-association"><i class="fa fa-check"></i><b>5.1</b> Spurious association</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#グラフを用いて因果モデルを考える"><i class="fa fa-check"></i><b>5.1.1</b> グラフを用いて因果モデルを考える</a></li>
<li class="chapter" data-level="5.1.2" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#predictor-residual-plots"><i class="fa fa-check"></i><b>5.1.2</b> Predictor residual plots</a></li>
<li class="chapter" data-level="5.1.3" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#posterior-prediction-plots"><i class="fa fa-check"></i><b>5.1.3</b> Posterior prediction plots</a></li>
<li class="chapter" data-level="5.1.4" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#counterfactual-plot"><i class="fa fa-check"></i><b>5.1.4</b> Counterfactual plot</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#masked-relationship"><i class="fa fa-check"></i><b>5.2</b> Masked relationship</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#k-nモデル"><i class="fa fa-check"></i><b>5.2.1</b> K ~ Nモデル</a></li>
<li class="chapter" data-level="5.2.2" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#k-mモデル"><i class="fa fa-check"></i><b>5.2.2</b> K ~ Mモデル</a></li>
<li class="chapter" data-level="5.2.3" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#k-n-mモデル"><i class="fa fa-check"></i><b>5.2.3</b> K ~ N + Mモデル</a></li>
<li class="chapter" data-level="5.2.4" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#counterfactual-plot-を描く"><i class="fa fa-check"></i><b>5.2.4</b> Counterfactual plot を描く</a></li>
<li class="chapter" data-level="5.2.5" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#overthinking-1"><i class="fa fa-check"></i><b>5.2.5</b> Overthinking</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#categorical-variables"><i class="fa fa-check"></i><b>5.3</b> Categorical variables</a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#two-categories"><i class="fa fa-check"></i><b>5.3.1</b> Two categories</a></li>
<li class="chapter" data-level="5.3.2" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#many-categories"><i class="fa fa-check"></i><b>5.3.2</b> Many Categories</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#practice-3"><i class="fa fa-check"></i><b>5.4</b> Practice</a>
<ul>
<li class="chapter" data-level="5.4.1" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#m1-3"><i class="fa fa-check"></i><b>5.4.1</b> 5M1</a></li>
<li class="chapter" data-level="5.4.2" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#m2-3"><i class="fa fa-check"></i><b>5.4.2</b> 5M2</a></li>
<li class="chapter" data-level="5.4.3" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#m4-3"><i class="fa fa-check"></i><b>5.4.3</b> 5M4</a></li>
<li class="chapter" data-level="5.4.4" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#h1-3"><i class="fa fa-check"></i><b>5.4.4</b> 5H1</a></li>
<li class="chapter" data-level="5.4.5" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#h2-3"><i class="fa fa-check"></i><b>5.4.5</b> 5H2</a></li>
<li class="chapter" data-level="5.4.6" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#h3-3"><i class="fa fa-check"></i><b>5.4.6</b> 5H3</a></li>
<li class="chapter" data-level="5.4.7" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#h4-3"><i class="fa fa-check"></i><b>5.4.7</b> 5H4</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html"><i class="fa fa-check"></i><b>6</b> The Haunted DAG &amp; the Causal Terror</a>
<ul>
<li class="chapter" data-level="6.1" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#multicollinearity"><i class="fa fa-check"></i><b>6.1</b> Multicollinearity</a>
<ul>
<li class="chapter" data-level="6.1.1" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#multicollinear-milk"><i class="fa fa-check"></i><b>6.1.1</b> Multicollinear milk</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#post-treatment-bias"><i class="fa fa-check"></i><b>6.2</b> Post-treatment bias</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#blocked-by-consequence"><i class="fa fa-check"></i><b>6.2.1</b> Blocked by consequence</a></li>
<li class="chapter" data-level="6.2.2" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#fungus-and-d-separation"><i class="fa fa-check"></i><b>6.2.2</b> Fungus and d-separation</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#collider-bias"><i class="fa fa-check"></i><b>6.3</b> Collider bias</a>
<ul>
<li class="chapter" data-level="6.3.1" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#collider-of-false-sorrow"><i class="fa fa-check"></i><b>6.3.1</b> Collider of false sorrow</a></li>
<li class="chapter" data-level="6.3.2" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#the-haunted-dag"><i class="fa fa-check"></i><b>6.3.2</b> The haunted DAG</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#confronting-confoundings"><i class="fa fa-check"></i><b>6.4</b> Confronting confoundings</a>
<ul>
<li class="chapter" data-level="6.4.1" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#two-roads"><i class="fa fa-check"></i><b>6.4.1</b> Two roads</a></li>
<li class="chapter" data-level="6.4.2" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#backdoor-waffles"><i class="fa fa-check"></i><b>6.4.2</b> Backdoor Waffles</a></li>
</ul></li>
<li class="chapter" data-level="6.5" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#practice-4"><i class="fa fa-check"></i><b>6.5</b> Practice</a>
<ul>
<li class="chapter" data-level="6.5.1" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#m1-4"><i class="fa fa-check"></i><b>6.5.1</b> 6M1</a></li>
<li class="chapter" data-level="6.5.2" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#m2-4"><i class="fa fa-check"></i><b>6.5.2</b> 6M2</a></li>
<li class="chapter" data-level="6.5.3" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#h1-4"><i class="fa fa-check"></i><b>6.5.3</b> 6H1</a></li>
<li class="chapter" data-level="6.5.4" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#h2-4"><i class="fa fa-check"></i><b>6.5.4</b> 6H2</a></li>
<li class="chapter" data-level="6.5.5" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#h3-4"><i class="fa fa-check"></i><b>6.5.5</b> 6H3</a></li>
<li class="chapter" data-level="6.5.6" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#h4-4"><i class="fa fa-check"></i><b>6.5.6</b> 6H4</a></li>
<li class="chapter" data-level="6.5.7" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#h5-2"><i class="fa fa-check"></i><b>6.5.7</b> 6H5</a></li>
</ul></li>
<li class="chapter" data-level="6.6" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#おまけ-ランダム効果を入れてみる"><i class="fa fa-check"></i><b>6.6</b> おまけ　ランダム効果を入れてみる</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="ulysses-compass.html"><a href="ulysses-compass.html"><i class="fa fa-check"></i><b>7</b> Ulysses’ Compass</a>
<ul>
<li class="chapter" data-level="7.1" data-path="ulysses-compass.html"><a href="ulysses-compass.html#the-problems-with-parameters"><i class="fa fa-check"></i><b>7.1</b> The problems with parameters</a>
<ul>
<li class="chapter" data-level="7.1.1" data-path="ulysses-compass.html"><a href="ulysses-compass.html#more-parameters-always-improve-fit"><i class="fa fa-check"></i><b>7.1.1</b> More parameters always improve fit</a></li>
<li class="chapter" data-level="7.1.2" data-path="ulysses-compass.html"><a href="ulysses-compass.html#too-few-parameters-hurts-too"><i class="fa fa-check"></i><b>7.1.2</b> Too few parameters hurts too</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="ulysses-compass.html"><a href="ulysses-compass.html#entropy-and-accuracy"><i class="fa fa-check"></i><b>7.2</b> Entropy and accuracy</a>
<ul>
<li class="chapter" data-level="7.2.1" data-path="ulysses-compass.html"><a href="ulysses-compass.html#information-and-uncertainty"><i class="fa fa-check"></i><b>7.2.1</b> Information and uncertainty</a></li>
<li class="chapter" data-level="7.2.2" data-path="ulysses-compass.html"><a href="ulysses-compass.html#from-entropy-to-acculacy"><i class="fa fa-check"></i><b>7.2.2</b> From entropy to acculacy</a></li>
<li class="chapter" data-level="7.2.3" data-path="ulysses-compass.html"><a href="ulysses-compass.html#estimating-divergence"><i class="fa fa-check"></i><b>7.2.3</b> Estimating divergence</a></li>
<li class="chapter" data-level="7.2.4" data-path="ulysses-compass.html"><a href="ulysses-compass.html#scoring-the-right-data"><i class="fa fa-check"></i><b>7.2.4</b> Scoring the right data</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="ulysses-compass.html"><a href="ulysses-compass.html#golem-taming-regularization"><i class="fa fa-check"></i><b>7.3</b> Golem taming: regularization</a></li>
<li class="chapter" data-level="7.4" data-path="ulysses-compass.html"><a href="ulysses-compass.html#predicting-predictive-accuracy"><i class="fa fa-check"></i><b>7.4</b> Predicting predictive accuracy</a>
<ul>
<li class="chapter" data-level="7.4.1" data-path="ulysses-compass.html"><a href="ulysses-compass.html#cross-validation"><i class="fa fa-check"></i><b>7.4.1</b> Cross validation</a></li>
<li class="chapter" data-level="7.4.2" data-path="ulysses-compass.html"><a href="ulysses-compass.html#information-criteria"><i class="fa fa-check"></i><b>7.4.2</b> Information criteria</a></li>
<li class="chapter" data-level="7.4.3" data-path="ulysses-compass.html"><a href="ulysses-compass.html#overthinking-waic-calculation"><i class="fa fa-check"></i><b>7.4.3</b> overthinking: WAIC calculation</a></li>
<li class="chapter" data-level="7.4.4" data-path="ulysses-compass.html"><a href="ulysses-compass.html#comparing-cv-psis-and-waic"><i class="fa fa-check"></i><b>7.4.4</b> Comparing CV, PSIS, and WAIC</a></li>
</ul></li>
<li class="chapter" data-level="7.5" data-path="ulysses-compass.html"><a href="ulysses-compass.html#model-comparison"><i class="fa fa-check"></i><b>7.5</b> Model comparison</a>
<ul>
<li class="chapter" data-level="7.5.1" data-path="ulysses-compass.html"><a href="ulysses-compass.html#model-mis-selection"><i class="fa fa-check"></i><b>7.5.1</b> Model mis-selection</a></li>
<li class="chapter" data-level="7.5.2" data-path="ulysses-compass.html"><a href="ulysses-compass.html#outlier-and-other-illusions"><i class="fa fa-check"></i><b>7.5.2</b> Outlier and other illusions</a></li>
</ul></li>
<li class="chapter" data-level="7.6" data-path="ulysses-compass.html"><a href="ulysses-compass.html#practice-5"><i class="fa fa-check"></i><b>7.6</b> Practice</a>
<ul>
<li class="chapter" data-level="7.6.1" data-path="ulysses-compass.html"><a href="ulysses-compass.html#e2"><i class="fa fa-check"></i><b>7.6.1</b> 7E2</a></li>
<li class="chapter" data-level="7.6.2" data-path="ulysses-compass.html"><a href="ulysses-compass.html#e3"><i class="fa fa-check"></i><b>7.6.2</b> 7E3</a></li>
<li class="chapter" data-level="7.6.3" data-path="ulysses-compass.html"><a href="ulysses-compass.html#e4"><i class="fa fa-check"></i><b>7.6.3</b> 7E4</a></li>
<li class="chapter" data-level="7.6.4" data-path="ulysses-compass.html"><a href="ulysses-compass.html#m4-4"><i class="fa fa-check"></i><b>7.6.4</b> 7M4</a></li>
<li class="chapter" data-level="7.6.5" data-path="ulysses-compass.html"><a href="ulysses-compass.html#h1-5"><i class="fa fa-check"></i><b>7.6.5</b> 7H1</a></li>
<li class="chapter" data-level="7.6.6" data-path="ulysses-compass.html"><a href="ulysses-compass.html#h2-5"><i class="fa fa-check"></i><b>7.6.6</b> 7H2</a></li>
<li class="chapter" data-level="7.6.7" data-path="ulysses-compass.html"><a href="ulysses-compass.html#h3-5"><i class="fa fa-check"></i><b>7.6.7</b> 7H3</a></li>
<li class="chapter" data-level="7.6.8" data-path="ulysses-compass.html"><a href="ulysses-compass.html#h4-5"><i class="fa fa-check"></i><b>7.6.8</b> 7H4</a></li>
<li class="chapter" data-level="7.6.9" data-path="ulysses-compass.html"><a href="ulysses-compass.html#h5-3"><i class="fa fa-check"></i><b>7.6.9</b> 7H5</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="conditional-manatees.html"><a href="conditional-manatees.html"><i class="fa fa-check"></i><b>8</b> Conditional Manatees</a>
<ul>
<li class="chapter" data-level="8.1" data-path="conditional-manatees.html"><a href="conditional-manatees.html#building-an-interaction"><i class="fa fa-check"></i><b>8.1</b> Building an interaction</a>
<ul>
<li class="chapter" data-level="8.1.1" data-path="conditional-manatees.html"><a href="conditional-manatees.html#making-a-rugged-model"><i class="fa fa-check"></i><b>8.1.1</b> Making a rugged model</a></li>
<li class="chapter" data-level="8.1.2" data-path="conditional-manatees.html"><a href="conditional-manatees.html#adding-an-indicator-variable-isnt-enough"><i class="fa fa-check"></i><b>8.1.2</b> Adding an indicator variable isn’t enough</a></li>
<li class="chapter" data-level="8.1.3" data-path="conditional-manatees.html"><a href="conditional-manatees.html#adding-interaction-does-work"><i class="fa fa-check"></i><b>8.1.3</b> Adding interaction does work</a></li>
<li class="chapter" data-level="8.1.4" data-path="conditional-manatees.html"><a href="conditional-manatees.html#plotting-the-interaction"><i class="fa fa-check"></i><b>8.1.4</b> Plotting the interaction</a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="conditional-manatees.html"><a href="conditional-manatees.html#symmetry-of-interaction"><i class="fa fa-check"></i><b>8.2</b> Symmetry of interaction</a></li>
<li class="chapter" data-level="8.3" data-path="conditional-manatees.html"><a href="conditional-manatees.html#continuous-interaction"><i class="fa fa-check"></i><b>8.3</b> Continuous interaction</a>
<ul>
<li class="chapter" data-level="8.3.1" data-path="conditional-manatees.html"><a href="conditional-manatees.html#a-winter-flower"><i class="fa fa-check"></i><b>8.3.1</b> A winter flower</a></li>
<li class="chapter" data-level="8.3.2" data-path="conditional-manatees.html"><a href="conditional-manatees.html#the-models"><i class="fa fa-check"></i><b>8.3.2</b> The models</a></li>
<li class="chapter" data-level="8.3.3" data-path="conditional-manatees.html"><a href="conditional-manatees.html#plotting-posterior-predictions"><i class="fa fa-check"></i><b>8.3.3</b> Plotting posterior predictions</a></li>
<li class="chapter" data-level="8.3.4" data-path="conditional-manatees.html"><a href="conditional-manatees.html#plotting-prior-predictions"><i class="fa fa-check"></i><b>8.3.4</b> Plotting prior predictions</a></li>
</ul></li>
<li class="chapter" data-level="8.4" data-path="conditional-manatees.html"><a href="conditional-manatees.html#practice-6"><i class="fa fa-check"></i><b>8.4</b> Practice</a>
<ul>
<li class="chapter" data-level="8.4.1" data-path="conditional-manatees.html"><a href="conditional-manatees.html#m4-5"><i class="fa fa-check"></i><b>8.4.1</b> 8M4</a></li>
<li class="chapter" data-level="8.4.2" data-path="conditional-manatees.html"><a href="conditional-manatees.html#h1-6"><i class="fa fa-check"></i><b>8.4.2</b> 8H1</a></li>
<li class="chapter" data-level="8.4.3" data-path="conditional-manatees.html"><a href="conditional-manatees.html#h2-6"><i class="fa fa-check"></i><b>8.4.3</b> 8H2</a></li>
<li class="chapter" data-level="8.4.4" data-path="conditional-manatees.html"><a href="conditional-manatees.html#h3-6"><i class="fa fa-check"></i><b>8.4.4</b> 8H3</a></li>
<li class="chapter" data-level="8.4.5" data-path="conditional-manatees.html"><a href="conditional-manatees.html#h4-6"><i class="fa fa-check"></i><b>8.4.5</b> 8H4</a></li>
<li class="chapter" data-level="8.4.6" data-path="conditional-manatees.html"><a href="conditional-manatees.html#h5-4"><i class="fa fa-check"></i><b>8.4.6</b> 8H5</a></li>
<li class="chapter" data-level="8.4.7" data-path="conditional-manatees.html"><a href="conditional-manatees.html#h6-1"><i class="fa fa-check"></i><b>8.4.7</b> 8H6</a></li>
<li class="chapter" data-level="8.4.8" data-path="conditional-manatees.html"><a href="conditional-manatees.html#h7"><i class="fa fa-check"></i><b>8.4.8</b> 8H7</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="9" data-path="marcov-chain-monte-carlo.html"><a href="marcov-chain-monte-carlo.html"><i class="fa fa-check"></i><b>9</b> Marcov Chain Monte Carlo</a>
<ul>
<li class="chapter" data-level="9.1" data-path="marcov-chain-monte-carlo.html"><a href="marcov-chain-monte-carlo.html#good-king-marcov-and-his-island-kingdom"><i class="fa fa-check"></i><b>9.1</b> Good King Marcov and his island kingdom</a></li>
<li class="chapter" data-level="9.2" data-path="marcov-chain-monte-carlo.html"><a href="marcov-chain-monte-carlo.html#metropolis-algorythm"><i class="fa fa-check"></i><b>9.2</b> Metropolis algorythm</a>
<ul>
<li class="chapter" data-level="9.2.1" data-path="marcov-chain-monte-carlo.html"><a href="marcov-chain-monte-carlo.html#gibbs-sampling"><i class="fa fa-check"></i><b>9.2.1</b> Gibbs sampling</a></li>
<li class="chapter" data-level="9.2.2" data-path="marcov-chain-monte-carlo.html"><a href="marcov-chain-monte-carlo.html#high-dimentional-problem"><i class="fa fa-check"></i><b>9.2.2</b> High-dimentional problem</a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="marcov-chain-monte-carlo.html"><a href="marcov-chain-monte-carlo.html#hamiltonian-monte-carlo"><i class="fa fa-check"></i><b>9.3</b> Hamiltonian Monte Carlo</a>
<ul>
<li class="chapter" data-level="9.3.1" data-path="marcov-chain-monte-carlo.html"><a href="marcov-chain-monte-carlo.html#another-probable"><i class="fa fa-check"></i><b>9.3.1</b> Another probable</a></li>
<li class="chapter" data-level="9.3.2" data-path="marcov-chain-monte-carlo.html"><a href="marcov-chain-monte-carlo.html#limitations"><i class="fa fa-check"></i><b>9.3.2</b> Limitations</a></li>
</ul></li>
<li class="chapter" data-level="9.4" data-path="marcov-chain-monte-carlo.html"><a href="marcov-chain-monte-carlo.html#easy-hmc-ulam-brm"><i class="fa fa-check"></i><b>9.4</b> Easy HMC: <del>ulam</del> <code>brm()</code></a>
<ul>
<li class="chapter" data-level="9.4.1" data-path="marcov-chain-monte-carlo.html"><a href="marcov-chain-monte-carlo.html#preparation"><i class="fa fa-check"></i><b>9.4.1</b> Preparation</a></li>
<li class="chapter" data-level="9.4.2" data-path="marcov-chain-monte-carlo.html"><a href="marcov-chain-monte-carlo.html#sampling-from-posterior"><i class="fa fa-check"></i><b>9.4.2</b> Sampling from posterior</a></li>
<li class="chapter" data-level="9.4.3" data-path="marcov-chain-monte-carlo.html"><a href="marcov-chain-monte-carlo.html#sampling-again-in-parallel"><i class="fa fa-check"></i><b>9.4.3</b> Sampling again in parallel</a></li>
<li class="chapter" data-level="9.4.4" data-path="marcov-chain-monte-carlo.html"><a href="marcov-chain-monte-carlo.html#visualization"><i class="fa fa-check"></i><b>9.4.4</b> Visualization</a></li>
<li class="chapter" data-level="9.4.5" data-path="marcov-chain-monte-carlo.html"><a href="marcov-chain-monte-carlo.html#checking-the-chain"><i class="fa fa-check"></i><b>9.4.5</b> Checking the chain</a></li>
</ul></li>
<li class="chapter" data-level="9.5" data-path="marcov-chain-monte-carlo.html"><a href="marcov-chain-monte-carlo.html#care-and-feeding-of-your-marcov-chain"><i class="fa fa-check"></i><b>9.5</b> Care and feeding of your Marcov chain</a>
<ul>
<li class="chapter" data-level="9.5.1" data-path="marcov-chain-monte-carlo.html"><a href="marcov-chain-monte-carlo.html#how-many-samples-do-you-need"><i class="fa fa-check"></i><b>9.5.1</b> How many samples do you need</a></li>
<li class="chapter" data-level="9.5.2" data-path="marcov-chain-monte-carlo.html"><a href="marcov-chain-monte-carlo.html#how-many-chains-do-we-need"><i class="fa fa-check"></i><b>9.5.2</b> How many chains do we need</a></li>
<li class="chapter" data-level="9.5.3" data-path="marcov-chain-monte-carlo.html"><a href="marcov-chain-monte-carlo.html#taming-and-wild-chain"><i class="fa fa-check"></i><b>9.5.3</b> Taming and wild chain</a></li>
<li class="chapter" data-level="9.5.4" data-path="marcov-chain-monte-carlo.html"><a href="marcov-chain-monte-carlo.html#non-identifiable-parameters"><i class="fa fa-check"></i><b>9.5.4</b> Non-identifiable parameters</a></li>
</ul></li>
<li class="chapter" data-level="9.6" data-path="marcov-chain-monte-carlo.html"><a href="marcov-chain-monte-carlo.html#practice-7"><i class="fa fa-check"></i><b>9.6</b> Practice</a>
<ul>
<li class="chapter" data-level="9.6.1" data-path="marcov-chain-monte-carlo.html"><a href="marcov-chain-monte-carlo.html#m1-5"><i class="fa fa-check"></i><b>9.6.1</b> 9M1</a></li>
<li class="chapter" data-level="9.6.2" data-path="marcov-chain-monte-carlo.html"><a href="marcov-chain-monte-carlo.html#m2-5"><i class="fa fa-check"></i><b>9.6.2</b> 9M2</a></li>
<li class="chapter" data-level="9.6.3" data-path="marcov-chain-monte-carlo.html"><a href="marcov-chain-monte-carlo.html#m3-2"><i class="fa fa-check"></i><b>9.6.3</b> 9M3</a></li>
<li class="chapter" data-level="9.6.4" data-path="marcov-chain-monte-carlo.html"><a href="marcov-chain-monte-carlo.html#h1-7"><i class="fa fa-check"></i><b>9.6.4</b> 9H1</a></li>
<li class="chapter" data-level="9.6.5" data-path="marcov-chain-monte-carlo.html"><a href="marcov-chain-monte-carlo.html#h2-7"><i class="fa fa-check"></i><b>9.6.5</b> 9H2</a></li>
<li class="chapter" data-level="9.6.6" data-path="marcov-chain-monte-carlo.html"><a href="marcov-chain-monte-carlo.html#h3-7"><i class="fa fa-check"></i><b>9.6.6</b> 9H3</a></li>
<li class="chapter" data-level="9.6.7" data-path="marcov-chain-monte-carlo.html"><a href="marcov-chain-monte-carlo.html#h4-7"><i class="fa fa-check"></i><b>9.6.7</b> 9H4</a></li>
<li class="chapter" data-level="9.6.8" data-path="marcov-chain-monte-carlo.html"><a href="marcov-chain-monte-carlo.html#h5-5"><i class="fa fa-check"></i><b>9.6.8</b> 9H5</a></li>
<li class="chapter" data-level="9.6.9" data-path="marcov-chain-monte-carlo.html"><a href="marcov-chain-monte-carlo.html#h6-2"><i class="fa fa-check"></i><b>9.6.9</b> 9H6</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="10" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html"><i class="fa fa-check"></i><b>10</b> Big Entropy and the Generalized Linear Model</a>
<ul>
<li class="chapter" data-level="10.1" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html#maximum-entropy"><i class="fa fa-check"></i><b>10.1</b> Maximum entropy</a>
<ul>
<li class="chapter" data-level="10.1.1" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html#gaussian"><i class="fa fa-check"></i><b>10.1.1</b> Gaussian</a></li>
<li class="chapter" data-level="10.1.2" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html#binomial"><i class="fa fa-check"></i><b>10.1.2</b> Binomial</a></li>
</ul></li>
<li class="chapter" data-level="10.2" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html#generalized-linear-models"><i class="fa fa-check"></i><b>10.2</b> Generalized linear models</a>
<ul>
<li class="chapter" data-level="10.2.1" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html#meet-the-family"><i class="fa fa-check"></i><b>10.2.1</b> Meet the family</a></li>
<li class="chapter" data-level="10.2.2" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html#linking-linear-models-to-distributions"><i class="fa fa-check"></i><b>10.2.2</b> Linking linear models to distributions</a></li>
<li class="chapter" data-level="10.2.3" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html#overthinking-2"><i class="fa fa-check"></i><b>10.2.3</b> Overthinking</a></li>
<li class="chapter" data-level="10.2.4" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html#omitted-variable-bias-again"><i class="fa fa-check"></i><b>10.2.4</b> Omitted variable bias again</a></li>
<li class="chapter" data-level="10.2.5" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html#absolute-and-relative-differences"><i class="fa fa-check"></i><b>10.2.5</b> Absolute and relative differences</a></li>
<li class="chapter" data-level="10.2.6" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html#glms-and-information-criteria"><i class="fa fa-check"></i><b>10.2.6</b> GLMs and information criteria</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="11" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html"><i class="fa fa-check"></i><b>11</b> God Spiked the Integers</a>
<ul>
<li class="chapter" data-level="11.1" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#binomial-regression"><i class="fa fa-check"></i><b>11.1</b> Binomial regression</a>
<ul>
<li class="chapter" data-level="11.1.1" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#logistic-regression"><i class="fa fa-check"></i><b>11.1.1</b> Logistic regression</a></li>
<li class="chapter" data-level="11.1.2" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#relative-shark-and-absolute-deer"><i class="fa fa-check"></i><b>11.1.2</b> Relative shark and absolute deer</a></li>
<li class="chapter" data-level="11.1.3" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#aggregated-binomial-chimpanzees-again-condensed"><i class="fa fa-check"></i><b>11.1.3</b> Aggregated binomial: Chimpanzees again, condensed</a></li>
</ul></li>
<li class="chapter" data-level="11.2" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#aggregated-binomial-graduate-school-admittions."><i class="fa fa-check"></i><b>11.2</b> Aggregated binomial: Graduate school admittions.</a></li>
<li class="chapter" data-level="11.3" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#poisson-regression"><i class="fa fa-check"></i><b>11.3</b> Poisson regression</a>
<ul>
<li class="chapter" data-level="11.3.1" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#oceanic-tool-complexity"><i class="fa fa-check"></i><b>11.3.1</b> Oceanic tool complexity</a></li>
<li class="chapter" data-level="11.3.2" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#negative-binomial-gamma-poisson-models."><i class="fa fa-check"></i><b>11.3.2</b> Negative binomial (Gamma-Poisson) models.</a></li>
<li class="chapter" data-level="11.3.3" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#example-exposure-and-the-offset"><i class="fa fa-check"></i><b>11.3.3</b> Example: Exposure and the offset</a></li>
</ul></li>
<li class="chapter" data-level="11.4" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#multinomial-and-categorical-models"><i class="fa fa-check"></i><b>11.4</b> Multinomial and categorical models</a>
<ul>
<li class="chapter" data-level="11.4.1" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#predictors-matched-to-outcomes"><i class="fa fa-check"></i><b>11.4.1</b> Predictors matched to outcomes</a></li>
<li class="chapter" data-level="11.4.2" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#predictor-matched-to-observations"><i class="fa fa-check"></i><b>11.4.2</b> Predictor matched to observations</a></li>
<li class="chapter" data-level="11.4.3" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#multinomial-in-disguise-as-poisson"><i class="fa fa-check"></i><b>11.4.3</b> Multinomial in disguise as Poisson</a></li>
</ul></li>
<li class="chapter" data-level="11.5" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#practice-8"><i class="fa fa-check"></i><b>11.5</b> Practice</a>
<ul>
<li class="chapter" data-level="11.5.1" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#e1"><i class="fa fa-check"></i><b>11.5.1</b> 11E1</a></li>
<li class="chapter" data-level="11.5.2" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#e2-1"><i class="fa fa-check"></i><b>11.5.2</b> 11E2</a></li>
<li class="chapter" data-level="11.5.3" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#e3-1"><i class="fa fa-check"></i><b>11.5.3</b> 11E3</a></li>
<li class="chapter" data-level="11.5.4" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#e4-1"><i class="fa fa-check"></i><b>11.5.4</b> 11E4</a></li>
<li class="chapter" data-level="11.5.5" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#m7-2"><i class="fa fa-check"></i><b>11.5.5</b> 11M7</a></li>
<li class="chapter" data-level="11.5.6" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#m8-1"><i class="fa fa-check"></i><b>11.5.6</b> 11M8</a></li>
<li class="chapter" data-level="11.5.7" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#h1-8"><i class="fa fa-check"></i><b>11.5.7</b> 11H1</a></li>
<li class="chapter" data-level="11.5.8" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#h2-8"><i class="fa fa-check"></i><b>11.5.8</b> 11H2</a></li>
<li class="chapter" data-level="11.5.9" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#h3-8"><i class="fa fa-check"></i><b>11.5.9</b> 11H3</a></li>
<li class="chapter" data-level="11.5.10" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#h4-8"><i class="fa fa-check"></i><b>11.5.10</b> 11H4</a></li>
<li class="chapter" data-level="11.5.11" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#h5-6"><i class="fa fa-check"></i><b>11.5.11</b> 11H5</a></li>
<li class="chapter" data-level="11.5.12" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#h6-3"><i class="fa fa-check"></i><b>11.5.12</b> 11H6</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="12" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html"><i class="fa fa-check"></i><b>12</b> Monsters and Mixtures</a>
<ul>
<li class="chapter" data-level="12.1" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#over-dispersed-counts"><i class="fa fa-check"></i><b>12.1</b> Over-dispersed counts</a>
<ul>
<li class="chapter" data-level="12.1.1" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#beta-binomial."><i class="fa fa-check"></i><b>12.1.1</b> Beta binomial.</a></li>
<li class="chapter" data-level="12.1.2" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#negative-binomial-or-gamma-poisson."><i class="fa fa-check"></i><b>12.1.2</b> Negative binomial or gamma-Poisson.</a></li>
<li class="chapter" data-level="12.1.3" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#over-dispersion-entropy-and-information-criteria."><i class="fa fa-check"></i><b>12.1.3</b> Over-dispersion, entropy, and information criteria.</a></li>
</ul></li>
<li class="chapter" data-level="12.2" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#zero-inflated-outcomes"><i class="fa fa-check"></i><b>12.2</b> Zero-inflated outcomes</a>
<ul>
<li class="chapter" data-level="12.2.1" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#example-zero-inflated-poisson."><i class="fa fa-check"></i><b>12.2.1</b> Example: Zero-inflated Poisson.</a></li>
</ul></li>
<li class="chapter" data-level="12.3" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#ordered-categorical-outcomes"><i class="fa fa-check"></i><b>12.3</b> Ordered categorical outcomes</a>
<ul>
<li class="chapter" data-level="12.3.1" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#example-moral-intuition."><i class="fa fa-check"></i><b>12.3.1</b> Example: Moral intuition.</a></li>
<li class="chapter" data-level="12.3.2" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#adding-predictor-variables."><i class="fa fa-check"></i><b>12.3.2</b> Adding predictor variables.</a></li>
</ul></li>
<li class="chapter" data-level="12.4" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#ordered-categorical-predictors"><i class="fa fa-check"></i><b>12.4</b> Ordered categorical predictors</a></li>
<li class="chapter" data-level="12.5" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#practice-9"><i class="fa fa-check"></i><b>12.5</b> Practice</a>
<ul>
<li class="chapter" data-level="12.5.1" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#m1-6"><i class="fa fa-check"></i><b>12.5.1</b> 12M1</a></li>
<li class="chapter" data-level="12.5.2" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#m2-6"><i class="fa fa-check"></i><b>12.5.2</b> 12M2</a></li>
<li class="chapter" data-level="12.5.3" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#m3-3"><i class="fa fa-check"></i><b>12.5.3</b> 12M3</a></li>
<li class="chapter" data-level="12.5.4" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#h1-9"><i class="fa fa-check"></i><b>12.5.4</b> 12H1</a></li>
<li class="chapter" data-level="12.5.5" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#h2-9"><i class="fa fa-check"></i><b>12.5.5</b> 12H2</a></li>
<li class="chapter" data-level="12.5.6" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#h3-9"><i class="fa fa-check"></i><b>12.5.6</b> 12H3</a></li>
<li class="chapter" data-level="12.5.7" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#h4-9"><i class="fa fa-check"></i><b>12.5.7</b> 12H4</a></li>
<li class="chapter" data-level="12.5.8" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#h5-7"><i class="fa fa-check"></i><b>12.5.8</b> 12H5</a></li>
<li class="chapter" data-level="12.5.9" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#h6-4"><i class="fa fa-check"></i><b>12.5.9</b> 12H6</a></li>
<li class="chapter" data-level="12.5.10" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#h7-1"><i class="fa fa-check"></i><b>12.5.10</b> 12H7</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="13" data-path="models-with-memory.html"><a href="models-with-memory.html"><i class="fa fa-check"></i><b>13</b> Models with Memory</a>
<ul>
<li class="chapter" data-level="13.1" data-path="models-with-memory.html"><a href="models-with-memory.html#multilevel-tadpoles"><i class="fa fa-check"></i><b>13.1</b> Multilevel tadpoles</a></li>
<li class="chapter" data-level="13.2" data-path="models-with-memory.html"><a href="models-with-memory.html#varying-effects-and-the-underfittingoverfitting-trade-off"><i class="fa fa-check"></i><b>13.2</b> Varying effects and the underfitting/overfitting trade-off 　</a>
<ul>
<li class="chapter" data-level="13.2.1" data-path="models-with-memory.html"><a href="models-with-memory.html#the-model"><i class="fa fa-check"></i><b>13.2.1</b> The model</a></li>
<li class="chapter" data-level="13.2.2" data-path="models-with-memory.html"><a href="models-with-memory.html#simulate-survivors"><i class="fa fa-check"></i><b>13.2.2</b> Simulate survivors</a></li>
</ul></li>
<li class="chapter" data-level="13.3" data-path="models-with-memory.html"><a href="models-with-memory.html#more-than-one-type-of-cluster"><i class="fa fa-check"></i><b>13.3</b> More than one type of cluster</a>
<ul>
<li class="chapter" data-level="13.3.1" data-path="models-with-memory.html"><a href="models-with-memory.html#even-more-clusters"><i class="fa fa-check"></i><b>13.3.1</b> Even more clusters</a></li>
</ul></li>
<li class="chapter" data-level="13.4" data-path="models-with-memory.html"><a href="models-with-memory.html#divergent-transitions-and-non-centered-priors"><i class="fa fa-check"></i><b>13.4</b> Divergent transitions and non-centered priors</a>
<ul>
<li class="chapter" data-level="13.4.1" data-path="models-with-memory.html"><a href="models-with-memory.html#the-devils-funnel"><i class="fa fa-check"></i><b>13.4.1</b> The Devil’s Funnel</a></li>
<li class="chapter" data-level="13.4.2" data-path="models-with-memory.html"><a href="models-with-memory.html#non-centered-chimpanzees"><i class="fa fa-check"></i><b>13.4.2</b> Non-centered chimpanzees</a></li>
</ul></li>
<li class="chapter" data-level="13.5" data-path="models-with-memory.html"><a href="models-with-memory.html#multilevel-posterior-predictions"><i class="fa fa-check"></i><b>13.5</b> Multilevel posterior predictions</a>
<ul>
<li class="chapter" data-level="13.5.1" data-path="models-with-memory.html"><a href="models-with-memory.html#posterior-prediction-for-same-clusters"><i class="fa fa-check"></i><b>13.5.1</b> Posterior prediction for same clusters</a></li>
<li class="chapter" data-level="13.5.2" data-path="models-with-memory.html"><a href="models-with-memory.html#posterior-prediction-for-new-clusters"><i class="fa fa-check"></i><b>13.5.2</b> Posterior prediction for new clusters</a></li>
</ul></li>
<li class="chapter" data-level="13.6" data-path="models-with-memory.html"><a href="models-with-memory.html#post-stratification"><i class="fa fa-check"></i><b>13.6</b> Post stratification</a>
<ul>
<li class="chapter" data-level="13.6.1" data-path="models-with-memory.html"><a href="models-with-memory.html#meet-the-data"><i class="fa fa-check"></i><b>13.6.1</b> Meet the data</a></li>
<li class="chapter" data-level="13.6.2" data-path="models-with-memory.html"><a href="models-with-memory.html#settle-the-mr-part-of-mrp."><i class="fa fa-check"></i><b>13.6.2</b> Settle the MR part of MRP.</a></li>
<li class="chapter" data-level="13.6.3" data-path="models-with-memory.html"><a href="models-with-memory.html#post-stratify-to-put-the-p-in-mrp."><i class="fa fa-check"></i><b>13.6.3</b> Post-stratify to put the P in MRP.</a></li>
</ul></li>
<li class="chapter" data-level="13.7" data-path="models-with-memory.html"><a href="models-with-memory.html#practice-10"><i class="fa fa-check"></i><b>13.7</b> Practice</a>
<ul>
<li class="chapter" data-level="13.7.1" data-path="models-with-memory.html"><a href="models-with-memory.html#m1-7"><i class="fa fa-check"></i><b>13.7.1</b> 13M1</a></li>
<li class="chapter" data-level="13.7.2" data-path="models-with-memory.html"><a href="models-with-memory.html#m2-7"><i class="fa fa-check"></i><b>13.7.2</b> 13M2</a></li>
<li class="chapter" data-level="13.7.3" data-path="models-with-memory.html"><a href="models-with-memory.html#m3-4"><i class="fa fa-check"></i><b>13.7.3</b> 13M3</a></li>
<li class="chapter" data-level="13.7.4" data-path="models-with-memory.html"><a href="models-with-memory.html#m4-6"><i class="fa fa-check"></i><b>13.7.4</b> 13M4</a></li>
<li class="chapter" data-level="13.7.5" data-path="models-with-memory.html"><a href="models-with-memory.html#m5-3"><i class="fa fa-check"></i><b>13.7.5</b> 13M5</a></li>
<li class="chapter" data-level="13.7.6" data-path="models-with-memory.html"><a href="models-with-memory.html#m6-2"><i class="fa fa-check"></i><b>13.7.6</b> 13M6</a></li>
<li class="chapter" data-level="13.7.7" data-path="models-with-memory.html"><a href="models-with-memory.html#h1-10"><i class="fa fa-check"></i><b>13.7.7</b> 13H1</a></li>
<li class="chapter" data-level="13.7.8" data-path="models-with-memory.html"><a href="models-with-memory.html#h2-10"><i class="fa fa-check"></i><b>13.7.8</b> 13H2</a></li>
<li class="chapter" data-level="13.7.9" data-path="models-with-memory.html"><a href="models-with-memory.html#h3-10"><i class="fa fa-check"></i><b>13.7.9</b> 13H3</a></li>
<li class="chapter" data-level="13.7.10" data-path="models-with-memory.html"><a href="models-with-memory.html#h4-10"><i class="fa fa-check"></i><b>13.7.10</b> 13H4</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="14" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html"><i class="fa fa-check"></i><b>14</b> Adventures in Covariance</a>
<ul>
<li class="chapter" data-level="14.1" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#varying-slopes-by-construction"><i class="fa fa-check"></i><b>14.1</b> Varying slopes by construction</a>
<ul>
<li class="chapter" data-level="14.1.1" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#simulate-and-population"><i class="fa fa-check"></i><b>14.1.1</b> Simulate and population</a></li>
<li class="chapter" data-level="14.1.2" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#simulate-observation"><i class="fa fa-check"></i><b>14.1.2</b> Simulate observation</a></li>
<li class="chapter" data-level="14.1.3" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#the-varying-slope-model"><i class="fa fa-check"></i><b>14.1.3</b> The varying slope model</a></li>
</ul></li>
<li class="chapter" data-level="14.2" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#advanced-varing-slopes"><i class="fa fa-check"></i><b>14.2</b> Advanced varing slopes</a></li>
<li class="chapter" data-level="14.3" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#instruments-and-causal-designs"><i class="fa fa-check"></i><b>14.3</b> Instruments and causal designs</a>
<ul>
<li class="chapter" data-level="14.3.1" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#instrumental-variables"><i class="fa fa-check"></i><b>14.3.1</b> Instrumental variables</a></li>
<li class="chapter" data-level="14.3.2" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#other-designs"><i class="fa fa-check"></i><b>14.3.2</b> Other designs</a></li>
</ul></li>
<li class="chapter" data-level="14.4" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#social-relations-as-correlated-varying-effects"><i class="fa fa-check"></i><b>14.4</b> Social relations as correlated varying effects</a></li>
<li class="chapter" data-level="14.5" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#continuous-categories-and-the-gaussian-process"><i class="fa fa-check"></i><b>14.5</b> Continuous categories and the Gaussian process</a>
<ul>
<li class="chapter" data-level="14.5.1" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#example-spatial-autocorrelation-in-oceanic-tools"><i class="fa fa-check"></i><b>14.5.1</b> Example: Spatial autocorrelation in Oceanic tools</a></li>
<li class="chapter" data-level="14.5.2" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#example-phylogenetic-distance"><i class="fa fa-check"></i><b>14.5.2</b> Example: Phylogenetic distance</a></li>
</ul></li>
<li class="chapter" data-level="14.6" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#practice-11"><i class="fa fa-check"></i><b>14.6</b> Practice</a>
<ul>
<li class="chapter" data-level="14.6.1" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#m1-8"><i class="fa fa-check"></i><b>14.6.1</b> 14M1</a></li>
<li class="chapter" data-level="14.6.2" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#m2-8"><i class="fa fa-check"></i><b>14.6.2</b> 14M2</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="実行環境.html"><a href="実行環境.html"><i class="fa fa-check"></i>実行環境</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Statistical Rethinking Second Edition</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="god-spiked-the-integers" class="section level1 hasAnchor" number="11">
<h1><span class="header-section-number">11</span> God Spiked the Integers<a href="god-spiked-the-integers.html#god-spiked-the-integers" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div id="binomial-regression" class="section level2 hasAnchor" number="11.1">
<h2><span class="header-section-number">11.1</span> Binomial regression<a href="god-spiked-the-integers.html#binomial-regression" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>二項分布のGLMはデータの表現によって2通りある(モデル自体は全く同じ)。</p>
<ol style="list-style-type: decimal">
<li><p>Logistic regression<br />
応答変数を0と1で表現する場合。</p></li>
<li><p>Aggregated binomial regression<br />
同じ共変量についての試行をまとめる場合。この場合0からnまでの値をとる。</p></li>
</ol>
<div id="logistic-regression" class="section level3 hasAnchor" number="11.1.1">
<h3><span class="header-section-number">11.1.1</span> Logistic regression<a href="god-spiked-the-integers.html#logistic-regression" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><span class="citation">Silk et al. (<a href="#ref-Silk2005" role="doc-biblioref">2005</a>)</span> のチンパンジーを対象とした向社会的選択課題を例に見ていく。チンパンジーは相手がいるときにのみ向社会的な選択をするのかを調べるため、<em>condition</em>(相手の有無)と<em>option</em>(左右どちらが高社会的選択か)の交互作用を見ていく。</p>
<div class="sourceCode" id="cb872"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb872-1"><a href="god-spiked-the-integers.html#cb872-1" aria-hidden="true" tabindex="-1"></a><span class="co"># データ読み込み</span></span>
<span id="cb872-2"><a href="god-spiked-the-integers.html#cb872-2" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;chimpanzees&quot;</span>)</span>
<span id="cb872-3"><a href="god-spiked-the-integers.html#cb872-3" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> chimpanzees</span>
<span id="cb872-4"><a href="god-spiked-the-integers.html#cb872-4" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(d)</span></code></pre></div>
<pre><code>##   actor recipient condition block trial prosoc_left chose_prosoc pulled_left
## 1     1        NA         0     1     2           0            1           0
## 2     1        NA         0     1     4           0            0           1
## 3     1        NA         0     1     6           1            0           0
## 4     1        NA         0     1     8           0            1           0
## 5     1        NA         0     1    10           1            1           1
## 6     1        NA         0     1    12           1            1           1</code></pre>
<div class="sourceCode" id="cb874"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb874-1"><a href="god-spiked-the-integers.html#cb874-1" aria-hidden="true" tabindex="-1"></a>d <span class="sc">%&gt;%</span> </span>
<span id="cb874-2"><a href="god-spiked-the-integers.html#cb874-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(prosoc_left, condition) <span class="sc">%&gt;%</span> </span>
<span id="cb874-3"><a href="god-spiked-the-integers.html#cb874-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">description =</span> </span>
<span id="cb874-4"><a href="god-spiked-the-integers.html#cb874-4" aria-hidden="true" tabindex="-1"></a>           <span class="fu">c</span>(<span class="st">&quot;Two food items on right and no partner&quot;</span>,</span>
<span id="cb874-5"><a href="god-spiked-the-integers.html#cb874-5" aria-hidden="true" tabindex="-1"></a>              <span class="st">&quot;Two food items on left and no partner&quot;</span>,</span>
<span id="cb874-6"><a href="god-spiked-the-integers.html#cb874-6" aria-hidden="true" tabindex="-1"></a>              <span class="st">&quot;Two food items on right and partner present&quot;</span>,</span>
<span id="cb874-7"><a href="god-spiked-the-integers.html#cb874-7" aria-hidden="true" tabindex="-1"></a>              <span class="st">&quot;Two food items on left and partner present&quot;</span>))<span class="sc">%&gt;%</span> </span>
<span id="cb874-8"><a href="god-spiked-the-integers.html#cb874-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="at">caption =</span> <span class="st">&quot;4つの実験条件&quot;</span>,</span>
<span id="cb874-9"><a href="god-spiked-the-integers.html#cb874-9" aria-hidden="true" tabindex="-1"></a>        <span class="at">booktabs =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb874-10"><a href="god-spiked-the-integers.html#cb874-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">latex_options =</span> <span class="st">&quot;striped&quot;</span>)</span></code></pre></div>
<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:unnamed-chunk-435">表11.1: </span>4つの実験条件
</caption>
<thead>
<tr>
<th style="text-align:right;">
condition
</th>
<th style="text-align:right;">
prosoc_left
</th>
<th style="text-align:left;">
description
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:left;">
Two food items on right and no partner
</td>
</tr>
<tr>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
Two food items on left and no partner
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:left;">
Two food items on right and partner present
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
Two food items on left and partner present
</td>
</tr>
</tbody>
</table>
<p><br /></p>
<p>パッと見た限りでは、相手がいるときといないときで向社会的な選択をする割合に大きな違いはなさそう。</p>
<div class="sourceCode" id="cb875"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb875-1"><a href="god-spiked-the-integers.html#cb875-1" aria-hidden="true" tabindex="-1"></a>d <span class="sc">%&gt;%</span> </span>
<span id="cb875-2"><a href="god-spiked-the-integers.html#cb875-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(condition, prosoc_left) <span class="sc">%&gt;%</span> </span>
<span id="cb875-3"><a href="god-spiked-the-integers.html#cb875-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">prop =</span> <span class="fu">mean</span>(pulled_left),</span>
<span id="cb875-4"><a href="god-spiked-the-integers.html#cb875-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">se =</span> <span class="fu">sd</span>(pulled_left)<span class="sc">/</span><span class="fu">n</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb875-5"><a href="god-spiked-the-integers.html#cb875-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">condition =</span> <span class="fu">ifelse</span>(condition <span class="sc">==</span><span class="st">&quot;0&quot;</span>,<span class="st">&quot;no partner&quot;</span>,<span class="st">&quot;partner&quot;</span>),</span>
<span id="cb875-6"><a href="god-spiked-the-integers.html#cb875-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">prosoc_left =</span> <span class="fu">ifelse</span>(prosoc_left<span class="sc">==</span><span class="st">&quot;0&quot;</span>,<span class="st">&quot;right&quot;</span>,<span class="st">&quot;left&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb875-7"><a href="god-spiked-the-integers.html#cb875-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>prosoc_left, <span class="at">y =</span> prop))<span class="sc">+</span></span>
<span id="cb875-8"><a href="god-spiked-the-integers.html#cb875-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="fu">aes</span>(<span class="at">fill =</span> condition),</span>
<span id="cb875-9"><a href="god-spiked-the-integers.html#cb875-9" aria-hidden="true" tabindex="-1"></a>           <span class="at">position=</span><span class="fu">position_dodge</span>(<span class="fl">0.95</span>))<span class="sc">+</span></span>
<span id="cb875-10"><a href="god-spiked-the-integers.html#cb875-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> prop<span class="sc">-</span>se,<span class="at">ymax=</span>prop<span class="sc">+</span>se, </span>
<span id="cb875-11"><a href="god-spiked-the-integers.html#cb875-11" aria-hidden="true" tabindex="-1"></a>                    <span class="at">fill =</span> condition),</span>
<span id="cb875-12"><a href="god-spiked-the-integers.html#cb875-12" aria-hidden="true" tabindex="-1"></a>                <span class="at">position=</span><span class="fu">position_dodge</span>(<span class="fl">0.95</span>),</span>
<span id="cb875-13"><a href="god-spiked-the-integers.html#cb875-13" aria-hidden="true" tabindex="-1"></a>                <span class="at">width =</span> <span class="fl">0.2</span>)<span class="sc">+</span></span>
<span id="cb875-14"><a href="god-spiked-the-integers.html#cb875-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">aspect.ratio=</span><span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb875-15"><a href="god-spiked-the-integers.html#cb875-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">fill=</span><span class="st">&quot;condition&quot;</span>,<span class="at">x =</span> <span class="st">&quot;which was prosocial&quot;</span>,</span>
<span id="cb875-16"><a href="god-spiked-the-integers.html#cb875-16" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;proportion of choosing left&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:unnamed-chunk-436"></span>
<img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-436-1.png" alt="実験データの図示" width="672" />
<p class="caption">
図11.1: 実験データの図示
</p>
</div>
<p>これまで同様、ダミー変数は使わずindicator variableを用いる。</p>
<div class="sourceCode" id="cb876"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb876-1"><a href="god-spiked-the-integers.html#cb876-1" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span></span>
<span id="cb876-2"><a href="god-spiked-the-integers.html#cb876-2" aria-hidden="true" tabindex="-1"></a>  d <span class="sc">%&gt;%</span> </span>
<span id="cb876-3"><a href="god-spiked-the-integers.html#cb876-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">treatment =</span> <span class="fu">factor</span>(<span class="dv">1</span><span class="sc">+</span>prosoc_left<span class="sc">+</span><span class="dv">2</span><span class="sc">*</span>condition)) <span class="sc">%&gt;%</span> </span>
<span id="cb876-4"><a href="god-spiked-the-integers.html#cb876-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">labels =</span> <span class="fu">factor</span>(treatment,</span>
<span id="cb876-5"><a href="god-spiked-the-integers.html#cb876-5" aria-hidden="true" tabindex="-1"></a>                         <span class="at">levels =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>,</span>
<span id="cb876-6"><a href="god-spiked-the-integers.html#cb876-6" aria-hidden="true" tabindex="-1"></a>                         <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;r/n&quot;</span>, <span class="st">&quot;l/n&quot;</span>, <span class="st">&quot;r/p&quot;</span>, <span class="st">&quot;l/p&quot;</span>)))</span>
<span id="cb876-7"><a href="god-spiked-the-integers.html#cb876-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb876-8"><a href="god-spiked-the-integers.html#cb876-8" aria-hidden="true" tabindex="-1"></a>d <span class="sc">%&gt;%</span> </span>
<span id="cb876-9"><a href="god-spiked-the-integers.html#cb876-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(condition,prosoc_left, treatment) <span class="sc">%&gt;%</span> </span>
<span id="cb876-10"><a href="god-spiked-the-integers.html#cb876-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="at">caption =</span> <span class="st">&quot;各実験条件のサンプル数&quot;</span>,</span>
<span id="cb876-11"><a href="god-spiked-the-integers.html#cb876-11" aria-hidden="true" tabindex="-1"></a>        <span class="at">booktabs =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span>  </span>
<span id="cb876-12"><a href="god-spiked-the-integers.html#cb876-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">latex_options =</span> <span class="st">&quot;striped&quot;</span>)</span></code></pre></div>
<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:unnamed-chunk-437">表11.2: </span>各実験条件のサンプル数
</caption>
<thead>
<tr>
<th style="text-align:right;">
condition
</th>
<th style="text-align:right;">
prosoc_left
</th>
<th style="text-align:left;">
treatment
</th>
<th style="text-align:right;">
n
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:right;">
126
</td>
</tr>
<tr>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
2
</td>
<td style="text-align:right;">
126
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:left;">
3
</td>
<td style="text-align:right;">
126
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
4
</td>
<td style="text-align:right;">
126
</td>
</tr>
</tbody>
</table>
<p><br /></p>
<p>今回のモデル式は以下の通り。<br />
<br /></p>
<p><span class="math display">\[
\begin{aligned}
  L_{i} &amp;\sim Binomial(1,p_{i})\\  
  logit(p_{i}) &amp;= \alpha_{ACTOR[i]} + \beta_{TREATMENT_{i}}\\
  \alpha_{j} &amp;\sim to \  be \ determined\\
  \beta_{k} &amp;\sim to \ be \ determined
\end{aligned}
\]</span>
<br /></p>
<p>事前分布はどのようにするのが適切だろうか。まずは、切片だけしかないモデルを考えて試してみる。</p>
<p><span class="math display">\[
\begin{aligned}
  L_{i} &amp;\sim Binomial(1,p_{i})\\  
  logit(p_{i}) &amp;= \alpha\\
  \alpha &amp;\sim Normal(0,10)
\end{aligned}
\]</span>
<br /></p>
<div class="sourceCode" id="cb877"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb877-1"><a href="god-spiked-the-integers.html#cb877-1" aria-hidden="true" tabindex="-1"></a>b11<span class="fl">.1</span> <span class="ot">&lt;-</span></span>
<span id="cb877-2"><a href="god-spiked-the-integers.html#cb877-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">brm</span>(<span class="at">data =</span> d, </span>
<span id="cb877-3"><a href="god-spiked-the-integers.html#cb877-3" aria-hidden="true" tabindex="-1"></a>      <span class="do">## family = &quot;bernoulli&quot;でも可</span></span>
<span id="cb877-4"><a href="god-spiked-the-integers.html#cb877-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> binomial,</span>
<span id="cb877-5"><a href="god-spiked-the-integers.html#cb877-5" aria-hidden="true" tabindex="-1"></a>      pulled_left <span class="sc">|</span> <span class="fu">trials</span>(<span class="dv">1</span>) <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb877-6"><a href="god-spiked-the-integers.html#cb877-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">10</span>), <span class="at">class =</span> Intercept),</span>
<span id="cb877-7"><a href="god-spiked-the-integers.html#cb877-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">seed =</span> <span class="dv">11</span>,</span>
<span id="cb877-8"><a href="god-spiked-the-integers.html#cb877-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">sample_prior =</span> <span class="cn">TRUE</span>,</span>
<span id="cb877-9"><a href="god-spiked-the-integers.html#cb877-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">file =</span> <span class="st">&quot;output/Chapter11/b11.1&quot;</span>)</span></code></pre></div>
<p>標準偏差が10のとき、事前分布は0と1の近くに集中していることが分かる。これは、奇妙なことである。</p>
<p>今度は、標準偏差が1.5の場合を考える。今度は、うまく全体に広がっていることが分かる。</p>
<div class="sourceCode" id="cb878"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb878-1"><a href="god-spiked-the-integers.html#cb878-1" aria-hidden="true" tabindex="-1"></a>b11<span class="fl">.1</span>b <span class="ot">&lt;-</span> <span class="fu">brm</span>(<span class="at">data =</span> d, </span>
<span id="cb878-2"><a href="god-spiked-the-integers.html#cb878-2" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> binomial,</span>
<span id="cb878-3"><a href="god-spiked-the-integers.html#cb878-3" aria-hidden="true" tabindex="-1"></a>      pulled_left <span class="sc">|</span> <span class="fu">trials</span>(<span class="dv">1</span>) <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb878-4"><a href="god-spiked-the-integers.html#cb878-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">1.5</span>), <span class="at">class =</span> Intercept),</span>
<span id="cb878-5"><a href="god-spiked-the-integers.html#cb878-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">seed =</span> <span class="dv">11</span>,</span>
<span id="cb878-6"><a href="god-spiked-the-integers.html#cb878-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">sample_prior =</span> <span class="cn">TRUE</span>,</span>
<span id="cb878-7"><a href="god-spiked-the-integers.html#cb878-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">file =</span> <span class="st">&quot;output/Chapter11/b11.1b&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb879"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb879-1"><a href="god-spiked-the-integers.html#cb879-1" aria-hidden="true" tabindex="-1"></a><span class="fu">bind_rows</span>(<span class="fu">prior_samples</span>(b11<span class="fl">.1</span>),</span>
<span id="cb879-2"><a href="god-spiked-the-integers.html#cb879-2" aria-hidden="true" tabindex="-1"></a>          <span class="fu">prior_samples</span>(b11<span class="fl">.1</span>b)) <span class="sc">%&gt;%</span> </span>
<span id="cb879-3"><a href="god-spiked-the-integers.html#cb879-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">p =</span> <span class="fu">inv_logit_scaled</span>(Intercept),</span>
<span id="cb879-4"><a href="god-spiked-the-integers.html#cb879-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">w =</span> <span class="fu">factor</span>(<span class="fu">rep</span>(<span class="fu">c</span>(<span class="dv">10</span>, <span class="fl">1.5</span>), <span class="at">each =</span> <span class="fu">n</span>() <span class="sc">/</span> <span class="dv">2</span>),</span>
<span id="cb879-5"><a href="god-spiked-the-integers.html#cb879-5" aria-hidden="true" tabindex="-1"></a>                    <span class="at">levels =</span> <span class="fu">c</span>(<span class="dv">10</span>, <span class="fl">1.5</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb879-6"><a href="god-spiked-the-integers.html#cb879-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>p, <span class="at">fill =</span>w))<span class="sc">+</span></span>
<span id="cb879-7"><a href="god-spiked-the-integers.html#cb879-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">alpha=</span><span class="dv">3</span><span class="sc">/</span><span class="dv">4</span>, <span class="at">adjust =</span><span class="fl">0.1</span>, <span class="at">size=</span><span class="dv">0</span>,</span>
<span id="cb879-8"><a href="god-spiked-the-integers.html#cb879-8" aria-hidden="true" tabindex="-1"></a>               <span class="at">color =</span> <span class="cn">NA</span>)<span class="sc">+</span></span>
<span id="cb879-9"><a href="god-spiked-the-integers.html#cb879-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="fu">expression</span>(<span class="fu">italic</span>(w)),</span>
<span id="cb879-10"><a href="god-spiked-the-integers.html#cb879-10" aria-hidden="true" tabindex="-1"></a>                    <span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;grey&quot;</span>, <span class="st">&quot;lightblue&quot;</span>))<span class="sc">+</span></span>
<span id="cb879-11"><a href="god-spiked-the-integers.html#cb879-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="fu">expression</span>(alpha<span class="sc">%~%</span><span class="fu">Normal</span>(<span class="dv">0</span><span class="sc">*</span><span class="st">&quot;, &quot;</span><span class="sc">*</span><span class="fu">italic</span>(w))))</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:unnamed-chunk-441"></span>
<img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-441-1.png" alt="標準偏差による切片の事前分布からのサンプリングの違い" width="672" />
<p class="caption">
図11.2: 標準偏差による切片の事前分布からのサンプリングの違い
</p>
</div>
<p>それでは、標準偏差1.5でモデルを回してみる。まず、<em>treatment</em>のみを説明変数に入れるモデルを考える。説明変数の係数の事前分布としては、ひとまず平均0、標準偏差10と0.5の正規分布を考える。なお、brmsの事前分布の指定は単に事後分布を得るだけであればよりシンプルにかけるが、すべての条件について事前分布からのサンプルを得たければ、下記のように書く必要がある。</p>
<blockquote>
<p>If all you want to do is fit the models, you wouldn’t have to add a separate prior() statement for each level of treatment. You could have just included a single line, prior(normal(0, 0.5), nlpar = b), that did not include a coef argument. The problem with this approach is we’d only get one column for treatment when using the prior_samples() function to retrieve the prior samples. To get separate columns for the prior samples of each of the levels of treatment, you need to take the verbose approach, above.</p>
</blockquote>
<div class="sourceCode" id="cb880"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb880-1"><a href="god-spiked-the-integers.html#cb880-1" aria-hidden="true" tabindex="-1"></a><span class="co"># w = 10</span></span>
<span id="cb880-2"><a href="god-spiked-the-integers.html#cb880-2" aria-hidden="true" tabindex="-1"></a>b11<span class="fl">.2</span> <span class="ot">&lt;-</span> <span class="fu">brm</span>(<span class="at">data =</span> d, </span>
<span id="cb880-3"><a href="god-spiked-the-integers.html#cb880-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> binomial,</span>
<span id="cb880-4"><a href="god-spiked-the-integers.html#cb880-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">bf</span>(pulled_left <span class="sc">|</span> <span class="fu">trials</span>(<span class="dv">1</span>) <span class="sc">~</span> a　<span class="sc">+</span> b,</span>
<span id="cb880-5"><a href="god-spiked-the-integers.html#cb880-5" aria-hidden="true" tabindex="-1"></a>         a <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb880-6"><a href="god-spiked-the-integers.html#cb880-6" aria-hidden="true" tabindex="-1"></a>         b <span class="sc">~</span> <span class="dv">0</span><span class="sc">+</span> treatment,</span>
<span id="cb880-7"><a href="god-spiked-the-integers.html#cb880-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">nl =</span> <span class="cn">TRUE</span>),</span>
<span id="cb880-8"><a href="god-spiked-the-integers.html#cb880-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">prior=</span><span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">1.5</span>), <span class="at">nlpar =</span> a),</span>
<span id="cb880-9"><a href="god-spiked-the-integers.html#cb880-9" aria-hidden="true" tabindex="-1"></a>              <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">10</span>), <span class="at">nlpar =</span> b, </span>
<span id="cb880-10"><a href="god-spiked-the-integers.html#cb880-10" aria-hidden="true" tabindex="-1"></a>                    <span class="at">coef =</span> <span class="st">&quot;treatment1&quot;</span>),</span>
<span id="cb880-11"><a href="god-spiked-the-integers.html#cb880-11" aria-hidden="true" tabindex="-1"></a>              <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">10</span>), <span class="at">nlpar =</span> b, </span>
<span id="cb880-12"><a href="god-spiked-the-integers.html#cb880-12" aria-hidden="true" tabindex="-1"></a>                    <span class="at">coef =</span> <span class="st">&quot;treatment2&quot;</span>),</span>
<span id="cb880-13"><a href="god-spiked-the-integers.html#cb880-13" aria-hidden="true" tabindex="-1"></a>              <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">10</span>), <span class="at">nlpar =</span> b, </span>
<span id="cb880-14"><a href="god-spiked-the-integers.html#cb880-14" aria-hidden="true" tabindex="-1"></a>                    <span class="at">coef =</span> <span class="st">&quot;treatment3&quot;</span>),</span>
<span id="cb880-15"><a href="god-spiked-the-integers.html#cb880-15" aria-hidden="true" tabindex="-1"></a>              <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">10</span>), <span class="at">nlpar =</span> b, </span>
<span id="cb880-16"><a href="god-spiked-the-integers.html#cb880-16" aria-hidden="true" tabindex="-1"></a>                    <span class="at">coef =</span> <span class="st">&quot;treatment4&quot;</span>)),</span>
<span id="cb880-17"><a href="god-spiked-the-integers.html#cb880-17" aria-hidden="true" tabindex="-1"></a>      <span class="at">seed =</span> <span class="dv">11</span>,</span>
<span id="cb880-18"><a href="god-spiked-the-integers.html#cb880-18" aria-hidden="true" tabindex="-1"></a>      <span class="at">sample_prior =</span> <span class="cn">TRUE</span>,</span>
<span id="cb880-19"><a href="god-spiked-the-integers.html#cb880-19" aria-hidden="true" tabindex="-1"></a>      <span class="at">file =</span> <span class="st">&quot;output/Chapter11/b11.2&quot;</span>)</span>
<span id="cb880-20"><a href="god-spiked-the-integers.html#cb880-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb880-21"><a href="god-spiked-the-integers.html#cb880-21" aria-hidden="true" tabindex="-1"></a><span class="co"># w = 0.5</span></span>
<span id="cb880-22"><a href="god-spiked-the-integers.html#cb880-22" aria-hidden="true" tabindex="-1"></a>b11<span class="fl">.3</span> <span class="ot">&lt;-</span> <span class="fu">brm</span>(<span class="at">data =</span> d, </span>
<span id="cb880-23"><a href="god-spiked-the-integers.html#cb880-23" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> binomial,</span>
<span id="cb880-24"><a href="god-spiked-the-integers.html#cb880-24" aria-hidden="true" tabindex="-1"></a>      <span class="fu">bf</span>(pulled_left <span class="sc">|</span> <span class="fu">trials</span>(<span class="dv">1</span>) <span class="sc">~</span> a　<span class="sc">+</span> b,</span>
<span id="cb880-25"><a href="god-spiked-the-integers.html#cb880-25" aria-hidden="true" tabindex="-1"></a>         a <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb880-26"><a href="god-spiked-the-integers.html#cb880-26" aria-hidden="true" tabindex="-1"></a>         b <span class="sc">~</span> <span class="dv">0</span><span class="sc">+</span>treatment,</span>
<span id="cb880-27"><a href="god-spiked-the-integers.html#cb880-27" aria-hidden="true" tabindex="-1"></a>         <span class="at">nl =</span> <span class="cn">TRUE</span>),</span>
<span id="cb880-28"><a href="god-spiked-the-integers.html#cb880-28" aria-hidden="true" tabindex="-1"></a>      <span class="at">prior=</span><span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">1.5</span>), <span class="at">nlpar =</span> a),</span>
<span id="cb880-29"><a href="god-spiked-the-integers.html#cb880-29" aria-hidden="true" tabindex="-1"></a>              <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">0.5</span>), <span class="at">nlpar =</span> b, </span>
<span id="cb880-30"><a href="god-spiked-the-integers.html#cb880-30" aria-hidden="true" tabindex="-1"></a>                    <span class="at">coef =</span> <span class="st">&quot;treatment1&quot;</span>),</span>
<span id="cb880-31"><a href="god-spiked-the-integers.html#cb880-31" aria-hidden="true" tabindex="-1"></a>              <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">0.5</span>), <span class="at">nlpar =</span> b, </span>
<span id="cb880-32"><a href="god-spiked-the-integers.html#cb880-32" aria-hidden="true" tabindex="-1"></a>                    <span class="at">coef =</span> <span class="st">&quot;treatment2&quot;</span>),</span>
<span id="cb880-33"><a href="god-spiked-the-integers.html#cb880-33" aria-hidden="true" tabindex="-1"></a>              <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">0.5</span>), <span class="at">nlpar =</span> b, </span>
<span id="cb880-34"><a href="god-spiked-the-integers.html#cb880-34" aria-hidden="true" tabindex="-1"></a>                    <span class="at">coef =</span> <span class="st">&quot;treatment3&quot;</span>),</span>
<span id="cb880-35"><a href="god-spiked-the-integers.html#cb880-35" aria-hidden="true" tabindex="-1"></a>              <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">0.5</span>), <span class="at">nlpar =</span> b, </span>
<span id="cb880-36"><a href="god-spiked-the-integers.html#cb880-36" aria-hidden="true" tabindex="-1"></a>                    <span class="at">coef =</span> <span class="st">&quot;treatment4&quot;</span>)),</span>
<span id="cb880-37"><a href="god-spiked-the-integers.html#cb880-37" aria-hidden="true" tabindex="-1"></a>      <span class="at">seed =</span> <span class="dv">11</span>,</span>
<span id="cb880-38"><a href="god-spiked-the-integers.html#cb880-38" aria-hidden="true" tabindex="-1"></a>      <span class="at">sample_prior =</span> <span class="cn">TRUE</span>,</span>
<span id="cb880-39"><a href="god-spiked-the-integers.html#cb880-39" aria-hidden="true" tabindex="-1"></a>      <span class="at">file =</span> <span class="st">&quot;output/Chapter11/b11.3&quot;</span>)</span></code></pre></div>
<p><em>treatment</em>が1と2のときの違いを可視化してみる。標準偏差が10のときは、やはり0と1のところに集中していて考えられにくい。一方、0.5の場合はうまく低い値に集まっている。</p>
<div class="sourceCode" id="cb881"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb881-1"><a href="god-spiked-the-integers.html#cb881-1" aria-hidden="true" tabindex="-1"></a>prior <span class="ot">&lt;-</span> </span>
<span id="cb881-2"><a href="god-spiked-the-integers.html#cb881-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(<span class="fu">prior_samples</span>(b11<span class="fl">.2</span>),</span>
<span id="cb881-3"><a href="god-spiked-the-integers.html#cb881-3" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior_samples</span>(b11<span class="fl">.3</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb881-4"><a href="god-spiked-the-integers.html#cb881-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">w=</span> <span class="fu">factor</span>(<span class="fu">rep</span>(<span class="fu">c</span>(<span class="dv">10</span>, <span class="fl">0.5</span>), <span class="at">each =</span> <span class="fu">n</span>() <span class="sc">/</span> <span class="dv">2</span>),</span>
<span id="cb881-5"><a href="god-spiked-the-integers.html#cb881-5" aria-hidden="true" tabindex="-1"></a>                     <span class="at">levels =</span> <span class="fu">c</span>(<span class="dv">10</span>, <span class="fl">0.5</span>)),</span>
<span id="cb881-6"><a href="god-spiked-the-integers.html#cb881-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">p1 =</span> <span class="fu">inv_logit_scaled</span>(b_a <span class="sc">+</span> b_b_treatment1),</span>
<span id="cb881-7"><a href="god-spiked-the-integers.html#cb881-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">p2 =</span> <span class="fu">inv_logit_scaled</span>(b_a <span class="sc">+</span> b_b_treatment2)) <span class="sc">%&gt;%</span> </span>
<span id="cb881-8"><a href="god-spiked-the-integers.html#cb881-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">diff =</span> <span class="fu">abs</span>(p1 <span class="sc">-</span> p2)) </span>
<span id="cb881-9"><a href="god-spiked-the-integers.html#cb881-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb881-10"><a href="god-spiked-the-integers.html#cb881-10" aria-hidden="true" tabindex="-1"></a>prior <span class="sc">%&gt;%</span> </span>
<span id="cb881-11"><a href="god-spiked-the-integers.html#cb881-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>diff, <span class="at">fill =</span> w))<span class="sc">+</span></span>
<span id="cb881-12"><a href="god-spiked-the-integers.html#cb881-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">size=</span><span class="dv">0</span>, <span class="at">alpha=</span><span class="dv">3</span><span class="sc">/</span><span class="dv">4</span>, <span class="at">adjust =</span> <span class="fl">0.1</span>,</span>
<span id="cb881-13"><a href="god-spiked-the-integers.html#cb881-13" aria-hidden="true" tabindex="-1"></a>                 <span class="at">color=</span><span class="cn">NA</span>)<span class="sc">+</span></span>
<span id="cb881-14"><a href="god-spiked-the-integers.html#cb881-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="fu">expression</span>(<span class="fu">italic</span>(w)), </span>
<span id="cb881-15"><a href="god-spiked-the-integers.html#cb881-15" aria-hidden="true" tabindex="-1"></a>                    <span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;lightsalmon4&quot;</span>,<span class="st">&quot;orange&quot;</span>))<span class="sc">+</span></span>
<span id="cb881-16"><a href="god-spiked-the-integers.html#cb881-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="fu">expression</span>(alpha<span class="sc">%~%</span><span class="fu">Normal</span>(<span class="dv">0</span><span class="sc">*</span><span class="st">&quot;, &quot;</span><span class="sc">*</span><span class="fu">italic</span>(w))),</span>
<span id="cb881-17"><a href="god-spiked-the-integers.html#cb881-17" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">&quot;prior diff between treatments&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:unnamed-chunk-443"></span>
<img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-443-1.png" alt="標準偏差による事前分布からのサンプリングの違い" width="672" />
<p class="caption">
図11.3: 標準偏差による事前分布からのサンプリングの違い
</p>
</div>
<div class="sourceCode" id="cb882"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb882-1"><a href="god-spiked-the-integers.html#cb882-1" aria-hidden="true" tabindex="-1"></a><span class="co">#平均</span></span>
<span id="cb882-2"><a href="god-spiked-the-integers.html#cb882-2" aria-hidden="true" tabindex="-1"></a>prior <span class="sc">%&gt;%</span> </span>
<span id="cb882-3"><a href="god-spiked-the-integers.html#cb882-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(w) <span class="sc">%&gt;%</span> </span>
<span id="cb882-4"><a href="god-spiked-the-integers.html#cb882-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean =</span> <span class="fu">mean</span>(diff)) <span class="sc">%&gt;%</span> </span>
<span id="cb882-5"><a href="god-spiked-the-integers.html#cb882-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">mean =</span> <span class="fu">round</span>(mean,<span class="dv">2</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb882-6"><a href="god-spiked-the-integers.html#cb882-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="at">caption =</span> <span class="st">&quot;標準偏差が10と0.5のときのtreatment1と2の違いの平均&quot;</span>,</span>
<span id="cb882-7"><a href="god-spiked-the-integers.html#cb882-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">booktabs =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span>  </span>
<span id="cb882-8"><a href="god-spiked-the-integers.html#cb882-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">latex_options =</span> <span class="st">&quot;striped&quot;</span>)</span></code></pre></div>
<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:unnamed-chunk-444">表11.3: </span>標準偏差が10と0.5のときのtreatment1と2の違いの平均
</caption>
<thead>
<tr>
<th style="text-align:left;">
w
</th>
<th style="text-align:right;">
mean
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
10
</td>
<td style="text-align:right;">
0.48
</td>
</tr>
<tr>
<td style="text-align:left;">
0.5
</td>
<td style="text-align:right;">
0.10
</td>
</tr>
</tbody>
</table>
<p><br /></p>
<p>ちなみに、モデルによるtreatment1~4の平均は以下の通り。</p>
<div class="sourceCode" id="cb883"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb883-1"><a href="god-spiked-the-integers.html#cb883-1" aria-hidden="true" tabindex="-1"></a><span class="fu">posterior_samples</span>(b11<span class="fl">.3</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb883-2"><a href="god-spiked-the-integers.html#cb883-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(b_b_treatment1<span class="sc">:</span>b_b_treatment4) <span class="sc">%&gt;%</span> </span>
<span id="cb883-3"><a href="god-spiked-the-integers.html#cb883-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">treatment =</span> <span class="fu">str_remove</span>(name, <span class="st">&quot;b_b_treatment&quot;</span>),</span>
<span id="cb883-4"><a href="god-spiked-the-integers.html#cb883-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">mean=</span> <span class="fu">inv_logit_scaled</span>(b_a_Intercept <span class="sc">+</span> value)) <span class="sc">%&gt;%</span></span>
<span id="cb883-5"><a href="god-spiked-the-integers.html#cb883-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(treatment) <span class="sc">%&gt;%</span> </span>
<span id="cb883-6"><a href="god-spiked-the-integers.html#cb883-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mean_qi</span>(mean) <span class="sc">%&gt;%</span> </span>
<span id="cb883-7"><a href="god-spiked-the-integers.html#cb883-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="at">digits =</span><span class="dv">2</span>, <span class="at">caption =</span> <span class="st">&quot;モデルb11.3の結果&quot;</span>,</span>
<span id="cb883-8"><a href="god-spiked-the-integers.html#cb883-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">booktabs =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span>  </span>
<span id="cb883-9"><a href="god-spiked-the-integers.html#cb883-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">latex_options =</span> <span class="st">&quot;striped&quot;</span>)</span></code></pre></div>
<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:unnamed-chunk-445">表11.4: </span>モデルb11.3の結果
</caption>
<thead>
<tr>
<th style="text-align:left;">
treatment
</th>
<th style="text-align:right;">
mean
</th>
<th style="text-align:right;">
.lower
</th>
<th style="text-align:right;">
.upper
</th>
<th style="text-align:right;">
.width
</th>
<th style="text-align:left;">
.point
</th>
<th style="text-align:left;">
.interval
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
1
</td>
<td style="text-align:right;">
0.55
</td>
<td style="text-align:right;">
0.47
</td>
<td style="text-align:right;">
0.63
</td>
<td style="text-align:right;">
0.95
</td>
<td style="text-align:left;">
mean
</td>
<td style="text-align:left;">
qi
</td>
</tr>
<tr>
<td style="text-align:left;">
2
</td>
<td style="text-align:right;">
0.65
</td>
<td style="text-align:right;">
0.57
</td>
<td style="text-align:right;">
0.73
</td>
<td style="text-align:right;">
0.95
</td>
<td style="text-align:left;">
mean
</td>
<td style="text-align:left;">
qi
</td>
</tr>
<tr>
<td style="text-align:left;">
3
</td>
<td style="text-align:right;">
0.49
</td>
<td style="text-align:right;">
0.41
</td>
<td style="text-align:right;">
0.57
</td>
<td style="text-align:right;">
0.95
</td>
<td style="text-align:left;">
mean
</td>
<td style="text-align:left;">
qi
</td>
</tr>
<tr>
<td style="text-align:left;">
4
</td>
<td style="text-align:right;">
0.63
</td>
<td style="text-align:right;">
0.55
</td>
<td style="text-align:right;">
0.71
</td>
<td style="text-align:right;">
0.95
</td>
<td style="text-align:left;">
mean
</td>
<td style="text-align:left;">
qi
</td>
</tr>
</tbody>
</table>
<p>個体名も含めたモデルを回す。</p>
<div class="sourceCode" id="cb884"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb884-1"><a href="god-spiked-the-integers.html#cb884-1" aria-hidden="true" tabindex="-1"></a>d <span class="sc">%&gt;%</span> </span>
<span id="cb884-2"><a href="god-spiked-the-integers.html#cb884-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">actor =</span> <span class="fu">factor</span>(actor))<span class="ot">-&gt;</span>d</span>
<span id="cb884-3"><a href="god-spiked-the-integers.html#cb884-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb884-4"><a href="god-spiked-the-integers.html#cb884-4" aria-hidden="true" tabindex="-1"></a>b11<span class="fl">.4</span> <span class="ot">&lt;-</span> <span class="fu">brm</span>(<span class="at">data =</span> d, </span>
<span id="cb884-5"><a href="god-spiked-the-integers.html#cb884-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> binomial,</span>
<span id="cb884-6"><a href="god-spiked-the-integers.html#cb884-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">bf</span>(pulled_left <span class="sc">|</span> <span class="fu">trials</span>(<span class="dv">1</span>) <span class="sc">~</span> a　<span class="sc">+</span> b ,</span>
<span id="cb884-7"><a href="god-spiked-the-integers.html#cb884-7" aria-hidden="true" tabindex="-1"></a>         a <span class="sc">~</span> <span class="dv">0</span><span class="sc">+</span> actor,</span>
<span id="cb884-8"><a href="god-spiked-the-integers.html#cb884-8" aria-hidden="true" tabindex="-1"></a>         b <span class="sc">~</span> <span class="dv">0</span><span class="sc">+</span> treatment,</span>
<span id="cb884-9"><a href="god-spiked-the-integers.html#cb884-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">nl =</span> <span class="cn">TRUE</span>),</span>
<span id="cb884-10"><a href="god-spiked-the-integers.html#cb884-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">prior=</span><span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">1.5</span>), <span class="at">nlpar =</span> a),</span>
<span id="cb884-11"><a href="god-spiked-the-integers.html#cb884-11" aria-hidden="true" tabindex="-1"></a>              <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">0.5</span>), <span class="at">nlpar =</span> b)),</span>
<span id="cb884-12"><a href="god-spiked-the-integers.html#cb884-12" aria-hidden="true" tabindex="-1"></a>      <span class="at">seed =</span> <span class="dv">11</span>,</span>
<span id="cb884-13"><a href="god-spiked-the-integers.html#cb884-13" aria-hidden="true" tabindex="-1"></a>      <span class="at">sample_prior =</span> <span class="cn">TRUE</span>,</span>
<span id="cb884-14"><a href="god-spiked-the-integers.html#cb884-14" aria-hidden="true" tabindex="-1"></a>      <span class="at">file =</span> <span class="st">&quot;output/Chapter11/b11.4&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb885"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb885-1"><a href="god-spiked-the-integers.html#cb885-1" aria-hidden="true" tabindex="-1"></a><span class="fu">posterior_summary</span>(b11<span class="fl">.4</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb885-2"><a href="god-spiked-the-integers.html#cb885-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb885-3"><a href="god-spiked-the-integers.html#cb885-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>(<span class="at">var=</span><span class="st">&quot;parameters&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb885-4"><a href="god-spiked-the-integers.html#cb885-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(parameters <span class="sc">!=</span><span class="st">&quot;lp__&quot;</span>, parameters <span class="sc">!=</span><span class="st">&quot;prior_b_a&quot;</span>,</span>
<span id="cb885-5"><a href="god-spiked-the-integers.html#cb885-5" aria-hidden="true" tabindex="-1"></a>         parameters <span class="sc">!=</span><span class="st">&quot;prior_b_b&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb885-6"><a href="god-spiked-the-integers.html#cb885-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="at">digits=</span><span class="dv">2</span>, <span class="at">caption =</span> <span class="st">&quot;モデルb11.4の結果&quot;</span>,</span>
<span id="cb885-7"><a href="god-spiked-the-integers.html#cb885-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">booktabs =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb885-8"><a href="god-spiked-the-integers.html#cb885-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">latex_options =</span> <span class="st">&quot;striped&quot;</span>)</span></code></pre></div>
<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:unnamed-chunk-447">表11.5: </span>モデルb11.4の結果
</caption>
<thead>
<tr>
<th style="text-align:left;">
parameters
</th>
<th style="text-align:right;">
Estimate
</th>
<th style="text-align:right;">
Est.Error
</th>
<th style="text-align:right;">
Q2.5
</th>
<th style="text-align:right;">
Q97.5
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
b_a_actor1
</td>
<td style="text-align:right;">
-0.46
</td>
<td style="text-align:right;">
0.32
</td>
<td style="text-align:right;">
-1.09
</td>
<td style="text-align:right;">
0.16
</td>
</tr>
<tr>
<td style="text-align:left;">
b_a_actor2
</td>
<td style="text-align:right;">
3.89
</td>
<td style="text-align:right;">
0.74
</td>
<td style="text-align:right;">
2.60
</td>
<td style="text-align:right;">
5.46
</td>
</tr>
<tr>
<td style="text-align:left;">
b_a_actor3
</td>
<td style="text-align:right;">
-0.76
</td>
<td style="text-align:right;">
0.33
</td>
<td style="text-align:right;">
-1.42
</td>
<td style="text-align:right;">
-0.11
</td>
</tr>
<tr>
<td style="text-align:left;">
b_a_actor4
</td>
<td style="text-align:right;">
-0.76
</td>
<td style="text-align:right;">
0.33
</td>
<td style="text-align:right;">
-1.39
</td>
<td style="text-align:right;">
-0.12
</td>
</tr>
<tr>
<td style="text-align:left;">
b_a_actor5
</td>
<td style="text-align:right;">
-0.47
</td>
<td style="text-align:right;">
0.33
</td>
<td style="text-align:right;">
-1.10
</td>
<td style="text-align:right;">
0.19
</td>
</tr>
<tr>
<td style="text-align:left;">
b_a_actor6
</td>
<td style="text-align:right;">
0.47
</td>
<td style="text-align:right;">
0.33
</td>
<td style="text-align:right;">
-0.17
</td>
<td style="text-align:right;">
1.09
</td>
</tr>
<tr>
<td style="text-align:left;">
b_a_actor7
</td>
<td style="text-align:right;">
1.94
</td>
<td style="text-align:right;">
0.43
</td>
<td style="text-align:right;">
1.15
</td>
<td style="text-align:right;">
2.80
</td>
</tr>
<tr>
<td style="text-align:left;">
b_b_treatment1
</td>
<td style="text-align:right;">
-0.03
</td>
<td style="text-align:right;">
0.28
</td>
<td style="text-align:right;">
-0.56
</td>
<td style="text-align:right;">
0.52
</td>
</tr>
<tr>
<td style="text-align:left;">
b_b_treatment2
</td>
<td style="text-align:right;">
0.49
</td>
<td style="text-align:right;">
0.29
</td>
<td style="text-align:right;">
-0.07
</td>
<td style="text-align:right;">
1.05
</td>
</tr>
<tr>
<td style="text-align:left;">
b_b_treatment3
</td>
<td style="text-align:right;">
-0.37
</td>
<td style="text-align:right;">
0.29
</td>
<td style="text-align:right;">
-0.94
</td>
<td style="text-align:right;">
0.18
</td>
</tr>
<tr>
<td style="text-align:left;">
b_b_treatment4
</td>
<td style="text-align:right;">
0.38
</td>
<td style="text-align:right;">
0.28
</td>
<td style="text-align:right;">
-0.17
</td>
<td style="text-align:right;">
0.94
</td>
</tr>
<tr>
<td style="text-align:left;">
lprior
</td>
<td style="text-align:right;">
-16.75
</td>
<td style="text-align:right;">
1.65
</td>
<td style="text-align:right;">
-20.48
</td>
<td style="text-align:right;">
-14.05
</td>
</tr>
</tbody>
</table>
<p><br /></p>
<p>まずは、各個体の左を引く確率をtreatmentの効果を考えずに見てみる。個体ごとの左右の選好にかなり違いがあることが分かる。特に個体2はほとんど左しか選択していない。</p>
<div class="sourceCode" id="cb886"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb886-1"><a href="god-spiked-the-integers.html#cb886-1" aria-hidden="true" tabindex="-1"></a><span class="fu">posterior_samples</span>(b11<span class="fl">.4</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb886-2"><a href="god-spiked-the-integers.html#cb886-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">contains</span>(<span class="st">&quot;actor&quot;</span>))<span class="sc">%&gt;%</span> </span>
<span id="cb886-3"><a href="god-spiked-the-integers.html#cb886-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">probability =</span> <span class="fu">inv_logit_scaled</span>(value),</span>
<span id="cb886-4"><a href="god-spiked-the-integers.html#cb886-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">actor =</span> <span class="fu">factor</span>(<span class="fu">str_remove</span>(name, <span class="st">&quot;b_a_actor&quot;</span>),</span>
<span id="cb886-5"><a href="god-spiked-the-integers.html#cb886-5" aria-hidden="true" tabindex="-1"></a>                        <span class="at">levels =</span> <span class="dv">7</span><span class="sc">:</span><span class="dv">1</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb886-6"><a href="god-spiked-the-integers.html#cb886-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>probability, <span class="at">y =</span> actor))<span class="sc">+</span></span>
<span id="cb886-7"><a href="god-spiked-the-integers.html#cb886-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept=</span><span class="fl">0.5</span>, <span class="at">linetype=</span><span class="dv">3</span>)<span class="sc">+</span></span>
<span id="cb886-8"><a href="god-spiked-the-integers.html#cb886-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_pointinterval</span>(<span class="at">.width =</span> .<span class="dv">95</span>, <span class="at">size =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb886-9"><a href="god-spiked-the-integers.html#cb886-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">limits =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb886-10"><a href="god-spiked-the-integers.html#cb886-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb886-11"><a href="god-spiked-the-integers.html#cb886-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="fu">expression</span>(alpha))<span class="sc">+</span></span>
<span id="cb886-12"><a href="god-spiked-the-integers.html#cb886-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.ticks.y =</span> <span class="fu">element_blank</span>())</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:unnamed-chunk-448"></span>
<img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-448-1.png" alt="モデルによって推定された各個体が左を選択する確率。エラーバーは95%信用区間を表す。" width="672" />
<p class="caption">
図11.4: モデルによって推定された各個体が左を選択する確率。エラーバーは95%信用区間を表す。
</p>
</div>
<p>次は、個体のばらつきの影響を除いたうえで、各treatmentにおける選択確率についてみてみる。</p>
<div class="sourceCode" id="cb887"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb887-1"><a href="god-spiked-the-integers.html#cb887-1" aria-hidden="true" tabindex="-1"></a>tx <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;R/N&quot;</span>, <span class="st">&quot;L/N&quot;</span>, <span class="st">&quot;R/P&quot;</span>, <span class="st">&quot;L/P&quot;</span>)</span>
<span id="cb887-2"><a href="god-spiked-the-integers.html#cb887-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb887-3"><a href="god-spiked-the-integers.html#cb887-3" aria-hidden="true" tabindex="-1"></a><span class="fu">posterior_samples</span>(b11<span class="fl">.4</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb887-4"><a href="god-spiked-the-integers.html#cb887-4" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="fu">contains</span>(<span class="st">&quot;treatment&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb887-5"><a href="god-spiked-the-integers.html#cb887-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_names</span>(<span class="st">&quot;R/N&quot;</span>,<span class="st">&quot;L/N&quot;</span>,<span class="st">&quot;R/P&quot;</span>,<span class="st">&quot;L/P&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb887-6"><a href="god-spiked-the-integers.html#cb887-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">everything</span>())<span class="sc">%&gt;%</span> </span>
<span id="cb887-7"><a href="god-spiked-the-integers.html#cb887-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">probability =</span> <span class="fu">inv_logit_scaled</span>(value),</span>
<span id="cb887-8"><a href="god-spiked-the-integers.html#cb887-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">treatment =</span> <span class="fu">factor</span>(name, <span class="at">levels =</span> tx)) <span class="sc">%&gt;%</span> </span>
<span id="cb887-9"><a href="god-spiked-the-integers.html#cb887-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">treatment =</span> <span class="fu">fct_rev</span>(treatment)) <span class="sc">%&gt;%</span> </span>
<span id="cb887-10"><a href="god-spiked-the-integers.html#cb887-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>probability, <span class="at">y =</span> treatment))<span class="sc">+</span></span>
<span id="cb887-11"><a href="god-spiked-the-integers.html#cb887-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept=</span><span class="fl">0.5</span>, <span class="at">linetype=</span><span class="dv">3</span>)<span class="sc">+</span></span>
<span id="cb887-12"><a href="god-spiked-the-integers.html#cb887-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_pointinterval</span>(<span class="at">.width =</span> .<span class="dv">95</span>, <span class="at">linewidth =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb887-13"><a href="god-spiked-the-integers.html#cb887-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">limits =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb887-14"><a href="god-spiked-the-integers.html#cb887-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb887-15"><a href="god-spiked-the-integers.html#cb887-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="fu">expression</span>(beta))<span class="sc">+</span></span>
<span id="cb887-16"><a href="god-spiked-the-integers.html#cb887-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.ticks.y =</span> <span class="fu">element_blank</span>())</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:unnamed-chunk-449"></span>
<img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-449-1.png" alt="モデルによって推定された各条件で左が選択される確率。エラーバーは95%信用区間を表す。" width="672" />
<p class="caption">
図11.5: モデルによって推定された各条件で左が選択される確率。エラーバーは95%信用区間を表す。
</p>
</div>
<p>最後に、treatment1と3、treatment2と4の差を見ることで、相手がいるときといないときで向社会的選択をする割合に違いがみられたか調べる。<br />
db13は、右側が向社会的選択のときに、相手がいないときよりいるときに左側を選択することがどれだけ多くなるかを示している(ただし、係数の大小を比較しているだけということに注意)。わずかに左を選択することが多くなっているが、そこまで大きな効果はない。<br />
db14は逆に左側が向社会的選択のときに、相手がいないときよりいるときに左側を選択することがどれだけ多くなるかを示している。今度は、むしろいないときの方がわずかだが向社会的選択をしていたことを示している。</p>
<div class="sourceCode" id="cb888"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb888-1"><a href="god-spiked-the-integers.html#cb888-1" aria-hidden="true" tabindex="-1"></a><span class="fu">posterior_samples</span>(b11<span class="fl">.4</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb888-2"><a href="god-spiked-the-integers.html#cb888-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">db13 =</span> b_b_treatment1 <span class="sc">-</span> b_b_treatment3,</span>
<span id="cb888-3"><a href="god-spiked-the-integers.html#cb888-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">db24 =</span> b_b_treatment2 <span class="sc">-</span> b_b_treatment4) <span class="sc">%&gt;%</span> </span>
<span id="cb888-4"><a href="god-spiked-the-integers.html#cb888-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(db13<span class="sc">:</span>db24) <span class="sc">%&gt;%</span> </span>
<span id="cb888-5"><a href="god-spiked-the-integers.html#cb888-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">diffs =</span> <span class="fu">factor</span>(name, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&quot;db24&quot;</span>, <span class="st">&quot;db13&quot;</span>)))<span class="sc">%&gt;%</span></span>
<span id="cb888-6"><a href="god-spiked-the-integers.html#cb888-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> value, <span class="at">y =</span> diffs)) <span class="sc">+</span></span>
<span id="cb888-7"><a href="god-spiked-the-integers.html#cb888-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">linetype=</span><span class="dv">3</span>)<span class="sc">+</span></span>
<span id="cb888-8"><a href="god-spiked-the-integers.html#cb888-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_pointinterval</span>(<span class="at">.width =</span> .<span class="dv">95</span>, <span class="at">linewidth =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb888-9"><a href="god-spiked-the-integers.html#cb888-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="fl">0.5</span>,<span class="dv">1</span>,<span class="fl">0.5</span>))<span class="sc">+</span></span>
<span id="cb888-10"><a href="god-spiked-the-integers.html#cb888-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb888-11"><a href="god-spiked-the-integers.html#cb888-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;difference&quot;</span>)<span class="sc">+</span></span>
<span id="cb888-12"><a href="god-spiked-the-integers.html#cb888-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.ticks.y =</span> <span class="fu">element_blank</span>())</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:unnamed-chunk-450"></span>
<img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-450-1.png" alt="相手がいないときと相手がいるときの係数の推定値の差。上は右側が向社会的選択の場合、下は左側が向社会的選択の場合を示している。" width="672" />
<p class="caption">
図11.6: 相手がいないときと相手がいるときの係数の推定値の差。上は右側が向社会的選択の場合、下は左側が向社会的選択の場合を示している。
</p>
</div>
<p>最後に、実際のデータとモデルによる予測結果を図示する。</p>
<div class="sourceCode" id="cb889"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb889-1"><a href="god-spiked-the-integers.html#cb889-1" aria-hidden="true" tabindex="-1"></a>nd <span class="ot">&lt;-</span> </span>
<span id="cb889-2"><a href="god-spiked-the-integers.html#cb889-2" aria-hidden="true" tabindex="-1"></a>  d <span class="sc">%&gt;%</span> </span>
<span id="cb889-3"><a href="god-spiked-the-integers.html#cb889-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(actor, treatment, labels, condition, prosoc_left)</span>
<span id="cb889-4"><a href="god-spiked-the-integers.html#cb889-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb889-5"><a href="god-spiked-the-integers.html#cb889-5" aria-hidden="true" tabindex="-1"></a>d <span class="sc">%&gt;%</span> </span>
<span id="cb889-6"><a href="god-spiked-the-integers.html#cb889-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(actor, labels) <span class="sc">%&gt;%</span> </span>
<span id="cb889-7"><a href="god-spiked-the-integers.html#cb889-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">prop =</span> <span class="fu">mean</span>(pulled_left)) <span class="sc">%&gt;%</span> </span>
<span id="cb889-8"><a href="god-spiked-the-integers.html#cb889-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(nd, <span class="at">by=</span><span class="fu">c</span>(<span class="st">&quot;actor&quot;</span>,<span class="st">&quot;labels&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb889-9"><a href="god-spiked-the-integers.html#cb889-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">condition =</span> <span class="fu">factor</span>(condition)) <span class="sc">%&gt;%</span> </span>
<span id="cb889-10"><a href="god-spiked-the-integers.html#cb889-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>labels, <span class="at">y =</span>prop ))<span class="sc">+</span></span>
<span id="cb889-11"><a href="god-spiked-the-integers.html#cb889-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept=</span><span class="fl">0.5</span>, <span class="at">linetype=</span><span class="dv">3</span>)<span class="sc">+</span></span>
<span id="cb889-12"><a href="god-spiked-the-integers.html#cb889-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">group=</span>prosoc_left),<span class="at">size=</span><span class="dv">1</span><span class="sc">/</span><span class="dv">4</span>,<span class="at">color=</span><span class="st">&quot;navy&quot;</span>)<span class="sc">+</span></span>
<span id="cb889-13"><a href="god-spiked-the-integers.html#cb889-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">shape=</span>condition),</span>
<span id="cb889-14"><a href="god-spiked-the-integers.html#cb889-14" aria-hidden="true" tabindex="-1"></a>             <span class="at">size=</span><span class="fl">2.5</span>, <span class="at">show.legend=</span><span class="cn">FALSE</span>, <span class="at">color=</span><span class="st">&quot;navy&quot;</span>)<span class="sc">+</span></span>
<span id="cb889-15"><a href="god-spiked-the-integers.html#cb889-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_shape_manual</span>(<span class="at">values=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">16</span>))<span class="sc">+</span></span>
<span id="cb889-16"><a href="god-spiked-the-integers.html#cb889-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">&quot;observed proportions&quot;</span>) <span class="ot">-&gt;</span> p1</span>
<span id="cb889-17"><a href="god-spiked-the-integers.html#cb889-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb889-18"><a href="god-spiked-the-integers.html#cb889-18" aria-hidden="true" tabindex="-1"></a><span class="fu">fitted</span>(b11<span class="fl">.4</span>, <span class="at">newdata =</span> nd) <span class="sc">%&gt;%</span> </span>
<span id="cb889-19"><a href="god-spiked-the-integers.html#cb889-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb889-20"><a href="god-spiked-the-integers.html#cb889-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(nd) <span class="sc">%&gt;%</span></span>
<span id="cb889-21"><a href="god-spiked-the-integers.html#cb889-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">condition =</span> <span class="fu">factor</span>(condition)) <span class="sc">%&gt;%</span> </span>
<span id="cb889-22"><a href="god-spiked-the-integers.html#cb889-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>labels, <span class="at">y =</span>Estimate))<span class="sc">+</span></span>
<span id="cb889-23"><a href="god-spiked-the-integers.html#cb889-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept=</span><span class="fl">0.5</span>, <span class="at">linetype=</span><span class="dv">3</span>)<span class="sc">+</span></span>
<span id="cb889-24"><a href="god-spiked-the-integers.html#cb889-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">group=</span>prosoc_left),<span class="at">size=</span><span class="dv">1</span><span class="sc">/</span><span class="dv">4</span>,<span class="at">color=</span><span class="st">&quot;black&quot;</span>)<span class="sc">+</span></span>
<span id="cb889-25"><a href="god-spiked-the-integers.html#cb889-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_pointrange</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> Q2<span class="fl">.5</span>, <span class="at">ymax =</span> Q97<span class="fl">.5</span>,</span>
<span id="cb889-26"><a href="god-spiked-the-integers.html#cb889-26" aria-hidden="true" tabindex="-1"></a>                      <span class="at">shape=</span>condition),</span>
<span id="cb889-27"><a href="god-spiked-the-integers.html#cb889-27" aria-hidden="true" tabindex="-1"></a>             <span class="at">fatten=</span><span class="dv">2</span>, <span class="at">show.legend=</span><span class="cn">FALSE</span>, <span class="at">color=</span><span class="st">&quot;black&quot;</span>)<span class="sc">+</span></span>
<span id="cb889-28"><a href="god-spiked-the-integers.html#cb889-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_shape_manual</span>(<span class="at">values=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">16</span>))<span class="sc">+</span></span>
<span id="cb889-29"><a href="god-spiked-the-integers.html#cb889-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">&quot;posterior predictions&quot;</span>) <span class="ot">-&gt;</span>p2</span>
<span id="cb889-30"><a href="god-spiked-the-integers.html#cb889-30" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb889-31"><a href="god-spiked-the-integers.html#cb889-31" aria-hidden="true" tabindex="-1"></a>(p1<span class="sc">/</span>p2)<span class="sc">&amp;</span></span>
<span id="cb889-32"><a href="god-spiked-the-integers.html#cb889-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="st">&quot;proportion left lever&quot;</span>, </span>
<span id="cb889-33"><a href="god-spiked-the-integers.html#cb889-33" aria-hidden="true" tabindex="-1"></a>                     <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>, .<span class="dv">5</span>, <span class="dv">1</span>), <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>))<span class="sc">&amp;</span></span>
<span id="cb889-34"><a href="god-spiked-the-integers.html#cb889-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="cn">NULL</span>) <span class="sc">&amp;</span></span>
<span id="cb889-35"><a href="god-spiked-the-integers.html#cb889-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> actor, <span class="at">nrow =</span> <span class="dv">1</span>, <span class="at">labeller =</span> label_both)<span class="sc">&amp;</span></span>
<span id="cb889-36"><a href="god-spiked-the-integers.html#cb889-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.ticks.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb889-37"><a href="god-spiked-the-integers.html#cb889-37" aria-hidden="true" tabindex="-1"></a>        <span class="at">strip.background =</span> <span class="fu">element_blank</span>()) </span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:unnamed-chunk-451"></span>
<img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-451-1.png" alt="実際のデータとモデルによる予測結果。白抜きは相手がいない条件を、塗りつぶしは相手がいる条件を表す。下図のエラーバーは95%信用区間を表す。" width="672" />
<p class="caption">
図11.7: 実際のデータとモデルによる予測結果。白抜きは相手がいない条件を、塗りつぶしは相手がいる条件を表す。下図のエラーバーは95%信用区間を表す。
</p>
</div>
<p>なお、モデルは相手の有無と向社会的選択の場所(左右)を別々の変数としてモデリングすることもできる。</p>
<div class="sourceCode" id="cb890"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb890-1"><a href="god-spiked-the-integers.html#cb890-1" aria-hidden="true" tabindex="-1"></a>d <span class="sc">%&gt;%</span> </span>
<span id="cb890-2"><a href="god-spiked-the-integers.html#cb890-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">side =</span> <span class="fu">factor</span>(prosoc_left <span class="sc">+</span><span class="dv">1</span>),</span>
<span id="cb890-3"><a href="god-spiked-the-integers.html#cb890-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">cond =</span> <span class="fu">factor</span>(condition<span class="sc">+</span><span class="dv">1</span>),</span>
<span id="cb890-4"><a href="god-spiked-the-integers.html#cb890-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">actor=</span><span class="fu">factor</span>(actor)) <span class="ot">-&gt;</span> d</span>
<span id="cb890-5"><a href="god-spiked-the-integers.html#cb890-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb890-6"><a href="god-spiked-the-integers.html#cb890-6" aria-hidden="true" tabindex="-1"></a>b11<span class="fl">.5</span> <span class="ot">&lt;-</span> </span>
<span id="cb890-7"><a href="god-spiked-the-integers.html#cb890-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">brm</span>(<span class="at">data =</span> d, </span>
<span id="cb890-8"><a href="god-spiked-the-integers.html#cb890-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> binomial,</span>
<span id="cb890-9"><a href="god-spiked-the-integers.html#cb890-9" aria-hidden="true" tabindex="-1"></a>      <span class="fu">bf</span>(pulled_left <span class="sc">|</span> <span class="fu">trials</span>(<span class="dv">1</span>) <span class="sc">~</span> a <span class="sc">+</span> bs <span class="sc">+</span> bc,</span>
<span id="cb890-10"><a href="god-spiked-the-integers.html#cb890-10" aria-hidden="true" tabindex="-1"></a>         a <span class="sc">~</span> <span class="dv">0</span> <span class="sc">+</span> actor, </span>
<span id="cb890-11"><a href="god-spiked-the-integers.html#cb890-11" aria-hidden="true" tabindex="-1"></a>         bs <span class="sc">~</span> <span class="dv">0</span> <span class="sc">+</span> side, </span>
<span id="cb890-12"><a href="god-spiked-the-integers.html#cb890-12" aria-hidden="true" tabindex="-1"></a>         bc <span class="sc">~</span> <span class="dv">0</span> <span class="sc">+</span> cond,</span>
<span id="cb890-13"><a href="god-spiked-the-integers.html#cb890-13" aria-hidden="true" tabindex="-1"></a>         <span class="at">nl =</span> <span class="cn">TRUE</span>),</span>
<span id="cb890-14"><a href="god-spiked-the-integers.html#cb890-14" aria-hidden="true" tabindex="-1"></a>      <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">1.5</span>), <span class="at">nlpar =</span> a),</span>
<span id="cb890-15"><a href="god-spiked-the-integers.html#cb890-15" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">0.5</span>), <span class="at">nlpar =</span> bs),</span>
<span id="cb890-16"><a href="god-spiked-the-integers.html#cb890-16" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">0.5</span>), <span class="at">nlpar =</span> bc)),</span>
<span id="cb890-17"><a href="god-spiked-the-integers.html#cb890-17" aria-hidden="true" tabindex="-1"></a>      <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>, <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb890-18"><a href="god-spiked-the-integers.html#cb890-18" aria-hidden="true" tabindex="-1"></a>      <span class="at">seed =</span> <span class="dv">11</span>,</span>
<span id="cb890-19"><a href="god-spiked-the-integers.html#cb890-19" aria-hidden="true" tabindex="-1"></a>      <span class="at">backend =</span> <span class="st">&quot;cmdstanr&quot;</span>,</span>
<span id="cb890-20"><a href="god-spiked-the-integers.html#cb890-20" aria-hidden="true" tabindex="-1"></a>      <span class="at">file =</span> <span class="st">&quot;output/Chapter11/b11.5&quot;</span>)</span></code></pre></div>
<p>比較すると、ほとんど変わらないことがある。すなわち、交互作用は予測をほとんど向上させていないことが分かる。</p>
<div class="sourceCode" id="cb891"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb891-1"><a href="god-spiked-the-integers.html#cb891-1" aria-hidden="true" tabindex="-1"></a>b11<span class="fl">.4</span> <span class="ot">&lt;-</span> <span class="fu">add_criterion</span>(b11<span class="fl">.4</span>, <span class="fu">c</span>(<span class="st">&quot;waic&quot;</span>,<span class="st">&quot;loo&quot;</span>))</span>
<span id="cb891-2"><a href="god-spiked-the-integers.html#cb891-2" aria-hidden="true" tabindex="-1"></a>b11<span class="fl">.5</span> <span class="ot">&lt;-</span> <span class="fu">add_criterion</span>(b11<span class="fl">.5</span>, <span class="fu">c</span>(<span class="st">&quot;waic&quot;</span>,<span class="st">&quot;loo&quot;</span>))</span>
<span id="cb891-3"><a href="god-spiked-the-integers.html#cb891-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb891-4"><a href="god-spiked-the-integers.html#cb891-4" aria-hidden="true" tabindex="-1"></a><span class="fu">loo_compare</span>(b11<span class="fl">.4</span>, b11<span class="fl">.5</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb891-5"><a href="god-spiked-the-integers.html#cb891-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="at">simplify=</span>F)</span></code></pre></div>
<pre><code>##       elpd_diff se_diff elpd_loo se_elpd_loo p_loo  se_p_loo looic  se_looic
## b11.5    0.0       0.0  -265.5      9.6         7.9    0.4    531.0   19.2  
## b11.4   -0.6       0.6  -266.1      9.5         8.5    0.4    532.2   18.9</code></pre>
<p>ちなみに図示してもほとんど違いがないことが分かる。</p>
<div class="sourceCode" id="cb893"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb893-1"><a href="god-spiked-the-integers.html#cb893-1" aria-hidden="true" tabindex="-1"></a>nd <span class="ot">&lt;-</span> </span>
<span id="cb893-2"><a href="god-spiked-the-integers.html#cb893-2" aria-hidden="true" tabindex="-1"></a>  d <span class="sc">%&gt;%</span> </span>
<span id="cb893-3"><a href="god-spiked-the-integers.html#cb893-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">distinct</span>(actor, treatment, labels, cond, side)</span>
<span id="cb893-4"><a href="god-spiked-the-integers.html#cb893-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb893-5"><a href="god-spiked-the-integers.html#cb893-5" aria-hidden="true" tabindex="-1"></a><span class="fu">fitted</span>(b11<span class="fl">.5</span>, <span class="at">newdata =</span> nd) <span class="sc">%&gt;%</span> </span>
<span id="cb893-6"><a href="god-spiked-the-integers.html#cb893-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb893-7"><a href="god-spiked-the-integers.html#cb893-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(nd) <span class="sc">%&gt;%</span></span>
<span id="cb893-8"><a href="god-spiked-the-integers.html#cb893-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">condition =</span> <span class="fu">factor</span>(cond)) <span class="sc">%&gt;%</span> </span>
<span id="cb893-9"><a href="god-spiked-the-integers.html#cb893-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>labels, <span class="at">y =</span>Estimate))<span class="sc">+</span></span>
<span id="cb893-10"><a href="god-spiked-the-integers.html#cb893-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept=</span><span class="fl">0.5</span>, <span class="at">linetype=</span><span class="dv">3</span>)<span class="sc">+</span></span>
<span id="cb893-11"><a href="god-spiked-the-integers.html#cb893-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">group=</span>side),<span class="at">size=</span><span class="dv">1</span><span class="sc">/</span><span class="dv">4</span>,<span class="at">color=</span><span class="st">&quot;black&quot;</span>)<span class="sc">+</span></span>
<span id="cb893-12"><a href="god-spiked-the-integers.html#cb893-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_pointrange</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> Q2<span class="fl">.5</span>, <span class="at">ymax =</span> Q97<span class="fl">.5</span>,</span>
<span id="cb893-13"><a href="god-spiked-the-integers.html#cb893-13" aria-hidden="true" tabindex="-1"></a>                      <span class="at">shape=</span>condition),</span>
<span id="cb893-14"><a href="god-spiked-the-integers.html#cb893-14" aria-hidden="true" tabindex="-1"></a>             <span class="at">fatten=</span><span class="dv">2</span>, <span class="at">show.legend=</span><span class="cn">FALSE</span>, <span class="at">color=</span><span class="st">&quot;black&quot;</span>)<span class="sc">+</span></span>
<span id="cb893-15"><a href="god-spiked-the-integers.html#cb893-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_shape_manual</span>(<span class="at">values=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">16</span>))<span class="sc">+</span></span>
<span id="cb893-16"><a href="god-spiked-the-integers.html#cb893-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>()<span class="sc">+</span></span>
<span id="cb893-17"><a href="god-spiked-the-integers.html#cb893-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>actor, <span class="at">nrow=</span><span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb893-18"><a href="god-spiked-the-integers.html#cb893-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="st">&quot;proportion left lever&quot;</span>,</span>
<span id="cb893-19"><a href="god-spiked-the-integers.html#cb893-19" aria-hidden="true" tabindex="-1"></a><span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>, .<span class="dv">5</span>, <span class="dv">1</span>), <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>))<span class="sc">+</span></span>
<span id="cb893-20"><a href="god-spiked-the-integers.html#cb893-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="cn">NULL</span>)<span class="sc">+</span></span>
<span id="cb893-21"><a href="god-spiked-the-integers.html#cb893-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.ticks.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb893-22"><a href="god-spiked-the-integers.html#cb893-22" aria-hidden="true" tabindex="-1"></a>        <span class="at">strip.background =</span> <span class="fu">element_blank</span>())</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:unnamed-chunk-454"></span>
<img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-454-1.png" alt="交互作用がないモデルでの予測値。白抜きは相手がいない条件を、塗りつぶしは相手がいる条件を表す。下図のエラーバーは95%信用区間を表す。" width="672" />
<p class="caption">
図11.8: 交互作用がないモデルでの予測値。白抜きは相手がいない条件を、塗りつぶしは相手がいる条件を表す。下図のエラーバーは95%信用区間を表す。
</p>
</div>
<div id="overthinking-3" class="section level4 hasAnchor" number="11.1.1.1">
<h4><span class="header-section-number">11.1.1.1</span> overthinking<a href="god-spiked-the-integers.html#overthinking-3" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p><code>brms()</code>パッケージでは、<code>log_lik()</code>を実行すれば対数尤度を得ることができる。</p>
</div>
</div>
<div id="relative-shark-and-absolute-deer" class="section level3 hasAnchor" number="11.1.2">
<h3><span class="header-section-number">11.1.2</span> Relative shark and absolute deer<a href="god-spiked-the-integers.html#relative-shark-and-absolute-deer" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>先ほどは説明変数が左を選択する確率にどのような影響を与えるかという<strong>absolute effect</strong>に着目した。一方で、<strong>relative effect</strong>(相対的な影響)に着目することもできる。例えば、比例オッズ(proportional odds)を見ることで、相対的な効果について論じることができる。<br />
先ほどの例でいえば、treatmentが2から4に変わったときの比例オッズ比は、0.93。</p>
<div class="sourceCode" id="cb894"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb894-1"><a href="god-spiked-the-integers.html#cb894-1" aria-hidden="true" tabindex="-1"></a><span class="fu">posterior_samples</span>(b11<span class="fl">.4</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb894-2"><a href="god-spiked-the-integers.html#cb894-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">proportional_odds =</span><span class="fu">exp</span>(b_b_treatment4 <span class="sc">-</span> b_b_treatment2)) <span class="sc">%&gt;%</span> </span>
<span id="cb894-3"><a href="god-spiked-the-integers.html#cb894-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mean_qi</span>(proportional_odds) <span class="sc">%&gt;%</span> </span>
<span id="cb894-4"><a href="god-spiked-the-integers.html#cb894-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="at">caption =</span> <span class="st">&quot;treatmentが2から4に変わったときの比例オッズ比&quot;</span>,</span>
<span id="cb894-5"><a href="god-spiked-the-integers.html#cb894-5" aria-hidden="true" tabindex="-1"></a>        <span class="at">booktabs=</span><span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb894-6"><a href="god-spiked-the-integers.html#cb894-6" aria-hidden="true" tabindex="-1"></a>   <span class="fu">kable_styling</span>(<span class="at">latex_options =</span> <span class="st">&quot;striped&quot;</span>)</span></code></pre></div>
<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:unnamed-chunk-455">表11.6: </span>treatmentが2から4に変わったときの比例オッズ比
</caption>
<thead>
<tr>
<th style="text-align:right;">
proportional_odds
</th>
<th style="text-align:right;">
.lower
</th>
<th style="text-align:right;">
.upper
</th>
<th style="text-align:right;">
.width
</th>
<th style="text-align:left;">
.point
</th>
<th style="text-align:left;">
.interval
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
0.9288517
</td>
<td style="text-align:right;">
0.5182757
</td>
<td style="text-align:right;">
1.521362
</td>
<td style="text-align:right;">
0.95
</td>
<td style="text-align:left;">
mean
</td>
<td style="text-align:left;">
qi
</td>
</tr>
</tbody>
</table>
<p>これは、オッズが8%減少することに相当する。ただし、比例オッズが大きい(小さい)かによって結果に大きな影響を及ぼすとは限らない点は注意が必要である。例えば、10000人に1人の割合でかかる病気になるオッズが5倍になったとしても、4人増えるだけなので大きな効果があるとは言えない。
一方で、因果推論をする場合には相対的な効果が重要な場合もある。例えば、サメとシカを比べると実際はシカの方がヒトが死亡する確率を上昇させている(絶対的な効果)。しかし、海にいるときで条件づけるならば、サメはシカよりもはるかに危険である(相対的な効果)。目的によってこれらを使い分ける必要がある。</p>
</div>
<div id="aggregated-binomial-chimpanzees-again-condensed" class="section level3 hasAnchor" number="11.1.3">
<h3><span class="header-section-number">11.1.3</span> Aggregated binomial: Chimpanzees again, condensed<a href="god-spiked-the-integers.html#aggregated-binomial-chimpanzees-again-condensed" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>先ほどのデータは、引く順番を気にしなければ、各説明変数の組み合わせごとに何回左のレバーを引いたかというデータに変換することもできる。</p>
<div class="sourceCode" id="cb895"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb895-1"><a href="god-spiked-the-integers.html#cb895-1" aria-hidden="true" tabindex="-1"></a>d <span class="sc">%&gt;%</span> </span>
<span id="cb895-2"><a href="god-spiked-the-integers.html#cb895-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(actor, treatment, side, cond) <span class="sc">%&gt;%</span> </span>
<span id="cb895-3"><a href="god-spiked-the-integers.html#cb895-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">sum =</span> <span class="fu">sum</span>(pulled_left),</span>
<span id="cb895-4"><a href="god-spiked-the-integers.html#cb895-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">trial =</span> <span class="fu">n</span>()) <span class="ot">-&gt;</span> d2</span></code></pre></div>
<div class="sourceCode" id="cb896"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb896-1"><a href="god-spiked-the-integers.html#cb896-1" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(d2, <span class="at">caption =</span> <span class="st">&quot;各個体が各treatmentで引いた合計回数&quot;</span>,</span>
<span id="cb896-2"><a href="god-spiked-the-integers.html#cb896-2" aria-hidden="true" tabindex="-1"></a>      <span class="at">booktabs=</span><span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb896-3"><a href="god-spiked-the-integers.html#cb896-3" aria-hidden="true" tabindex="-1"></a>   <span class="fu">kable_styling</span>(<span class="at">latex_options =</span> <span class="st">&quot;striped&quot;</span>)</span></code></pre></div>
<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:unnamed-chunk-457">表11.7: </span>各個体が各treatmentで引いた合計回数
</caption>
<thead>
<tr>
<th style="text-align:left;">
actor
</th>
<th style="text-align:left;">
treatment
</th>
<th style="text-align:left;">
side
</th>
<th style="text-align:left;">
cond
</th>
<th style="text-align:right;">
sum
</th>
<th style="text-align:right;">
trial
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
18
</td>
</tr>
<tr>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
2
</td>
<td style="text-align:left;">
2
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:right;">
9
</td>
<td style="text-align:right;">
18
</td>
</tr>
<tr>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
3
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
2
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
18
</td>
</tr>
<tr>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
4
</td>
<td style="text-align:left;">
2
</td>
<td style="text-align:left;">
2
</td>
<td style="text-align:right;">
10
</td>
<td style="text-align:right;">
18
</td>
</tr>
<tr>
<td style="text-align:left;">
2
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:right;">
18
</td>
<td style="text-align:right;">
18
</td>
</tr>
<tr>
<td style="text-align:left;">
2
</td>
<td style="text-align:left;">
2
</td>
<td style="text-align:left;">
2
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:right;">
18
</td>
<td style="text-align:right;">
18
</td>
</tr>
<tr>
<td style="text-align:left;">
2
</td>
<td style="text-align:left;">
3
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
2
</td>
<td style="text-align:right;">
18
</td>
<td style="text-align:right;">
18
</td>
</tr>
<tr>
<td style="text-align:left;">
2
</td>
<td style="text-align:left;">
4
</td>
<td style="text-align:left;">
2
</td>
<td style="text-align:left;">
2
</td>
<td style="text-align:right;">
18
</td>
<td style="text-align:right;">
18
</td>
</tr>
<tr>
<td style="text-align:left;">
3
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
18
</td>
</tr>
<tr>
<td style="text-align:left;">
3
</td>
<td style="text-align:left;">
2
</td>
<td style="text-align:left;">
2
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:right;">
11
</td>
<td style="text-align:right;">
18
</td>
</tr>
<tr>
<td style="text-align:left;">
3
</td>
<td style="text-align:left;">
3
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
2
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
18
</td>
</tr>
<tr>
<td style="text-align:left;">
3
</td>
<td style="text-align:left;">
4
</td>
<td style="text-align:left;">
2
</td>
<td style="text-align:left;">
2
</td>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
18
</td>
</tr>
<tr>
<td style="text-align:left;">
4
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
18
</td>
</tr>
<tr>
<td style="text-align:left;">
4
</td>
<td style="text-align:left;">
2
</td>
<td style="text-align:left;">
2
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:right;">
9
</td>
<td style="text-align:right;">
18
</td>
</tr>
<tr>
<td style="text-align:left;">
4
</td>
<td style="text-align:left;">
3
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
2
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
18
</td>
</tr>
<tr>
<td style="text-align:left;">
4
</td>
<td style="text-align:left;">
4
</td>
<td style="text-align:left;">
2
</td>
<td style="text-align:left;">
2
</td>
<td style="text-align:right;">
8
</td>
<td style="text-align:right;">
18
</td>
</tr>
<tr>
<td style="text-align:left;">
5
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
18
</td>
</tr>
<tr>
<td style="text-align:left;">
5
</td>
<td style="text-align:left;">
2
</td>
<td style="text-align:left;">
2
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:right;">
10
</td>
<td style="text-align:right;">
18
</td>
</tr>
<tr>
<td style="text-align:left;">
5
</td>
<td style="text-align:left;">
3
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
2
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
18
</td>
</tr>
<tr>
<td style="text-align:left;">
5
</td>
<td style="text-align:left;">
4
</td>
<td style="text-align:left;">
2
</td>
<td style="text-align:left;">
2
</td>
<td style="text-align:right;">
9
</td>
<td style="text-align:right;">
18
</td>
</tr>
<tr>
<td style="text-align:left;">
6
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:right;">
14
</td>
<td style="text-align:right;">
18
</td>
</tr>
<tr>
<td style="text-align:left;">
6
</td>
<td style="text-align:left;">
2
</td>
<td style="text-align:left;">
2
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:right;">
11
</td>
<td style="text-align:right;">
18
</td>
</tr>
<tr>
<td style="text-align:left;">
6
</td>
<td style="text-align:left;">
3
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
2
</td>
<td style="text-align:right;">
10
</td>
<td style="text-align:right;">
18
</td>
</tr>
<tr>
<td style="text-align:left;">
6
</td>
<td style="text-align:left;">
4
</td>
<td style="text-align:left;">
2
</td>
<td style="text-align:left;">
2
</td>
<td style="text-align:right;">
11
</td>
<td style="text-align:right;">
18
</td>
</tr>
<tr>
<td style="text-align:left;">
7
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:right;">
14
</td>
<td style="text-align:right;">
18
</td>
</tr>
<tr>
<td style="text-align:left;">
7
</td>
<td style="text-align:left;">
2
</td>
<td style="text-align:left;">
2
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:right;">
15
</td>
<td style="text-align:right;">
18
</td>
</tr>
<tr>
<td style="text-align:left;">
7
</td>
<td style="text-align:left;">
3
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
2
</td>
<td style="text-align:right;">
17
</td>
<td style="text-align:right;">
18
</td>
</tr>
<tr>
<td style="text-align:left;">
7
</td>
<td style="text-align:left;">
4
</td>
<td style="text-align:left;">
2
</td>
<td style="text-align:left;">
2
</td>
<td style="text-align:right;">
18
</td>
<td style="text-align:right;">
18
</td>
</tr>
</tbody>
</table>
<p><code>b11.4</code>は以下のように書き換えることができる。</p>
<div class="sourceCode" id="cb897"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb897-1"><a href="god-spiked-the-integers.html#cb897-1" aria-hidden="true" tabindex="-1"></a>b11<span class="fl">.6</span> <span class="ot">&lt;-</span> <span class="fu">brm</span>(<span class="at">data =</span> d2, </span>
<span id="cb897-2"><a href="god-spiked-the-integers.html#cb897-2" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> binomial,</span>
<span id="cb897-3"><a href="god-spiked-the-integers.html#cb897-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">bf</span>(sum <span class="sc">|</span> <span class="fu">trials</span>(trial) <span class="sc">~</span> a　<span class="sc">+</span> b ,</span>
<span id="cb897-4"><a href="god-spiked-the-integers.html#cb897-4" aria-hidden="true" tabindex="-1"></a>         a <span class="sc">~</span> <span class="dv">0</span><span class="sc">+</span> actor,</span>
<span id="cb897-5"><a href="god-spiked-the-integers.html#cb897-5" aria-hidden="true" tabindex="-1"></a>         b <span class="sc">~</span> <span class="dv">0</span><span class="sc">+</span> treatment,</span>
<span id="cb897-6"><a href="god-spiked-the-integers.html#cb897-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">nl =</span> <span class="cn">TRUE</span>),</span>
<span id="cb897-7"><a href="god-spiked-the-integers.html#cb897-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">prior=</span><span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">1.5</span>), <span class="at">nlpar =</span> a),</span>
<span id="cb897-8"><a href="god-spiked-the-integers.html#cb897-8" aria-hidden="true" tabindex="-1"></a>              <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">0.5</span>), <span class="at">nlpar =</span> b)),</span>
<span id="cb897-9"><a href="god-spiked-the-integers.html#cb897-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">seed =</span> <span class="dv">11</span>,</span>
<span id="cb897-10"><a href="god-spiked-the-integers.html#cb897-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">sample_prior =</span> <span class="cn">TRUE</span>,</span>
<span id="cb897-11"><a href="god-spiked-the-integers.html#cb897-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">backend =</span> <span class="st">&quot;cmdstanr&quot;</span>,</span>
<span id="cb897-12"><a href="god-spiked-the-integers.html#cb897-12" aria-hidden="true" tabindex="-1"></a>      <span class="at">file =</span> <span class="st">&quot;output/Chapter11/b11.6&quot;</span>)</span></code></pre></div>
<p>推定結果はほとんど変わらないことが分かる。</p>
<div class="sourceCode" id="cb898"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb898-1"><a href="god-spiked-the-integers.html#cb898-1" aria-hidden="true" tabindex="-1"></a>text <span class="ot">&lt;-</span></span>
<span id="cb898-2"><a href="god-spiked-the-integers.html#cb898-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="at">value =</span> <span class="fu">c</span>(<span class="fl">1.4</span>, <span class="fl">2.6</span>),</span>
<span id="cb898-3"><a href="god-spiked-the-integers.html#cb898-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">name  =</span> <span class="st">&quot;b_a_actor7&quot;</span>,</span>
<span id="cb898-4"><a href="god-spiked-the-integers.html#cb898-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">fit   =</span> <span class="fu">c</span>(<span class="st">&quot;b11.6&quot;</span>, <span class="st">&quot;b11.4&quot;</span>))</span>
<span id="cb898-5"><a href="god-spiked-the-integers.html#cb898-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb898-6"><a href="god-spiked-the-integers.html#cb898-6" aria-hidden="true" tabindex="-1"></a><span class="fu">bind_rows</span>(<span class="fu">posterior_samples</span>(b11<span class="fl">.4</span>),</span>
<span id="cb898-7"><a href="god-spiked-the-integers.html#cb898-7" aria-hidden="true" tabindex="-1"></a>          <span class="fu">posterior_samples</span>(b11<span class="fl">.6</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb898-8"><a href="god-spiked-the-integers.html#cb898-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">fit =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">&quot;b11.4&quot;</span>, <span class="st">&quot;b11.6&quot;</span>), <span class="at">each =</span> <span class="fu">n</span>() <span class="sc">/</span> <span class="dv">2</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb898-9"><a href="god-spiked-the-integers.html#cb898-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(b_a_actor1<span class="sc">:</span>b_b_treatment4) <span class="sc">%&gt;%</span> </span>
<span id="cb898-10"><a href="god-spiked-the-integers.html#cb898-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> value, <span class="at">y =</span> name, <span class="at">color =</span> fit)) <span class="sc">+</span></span>
<span id="cb898-11"><a href="god-spiked-the-integers.html#cb898-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_pointinterval</span>(<span class="at">.width =</span> .<span class="dv">95</span>, <span class="at">size =</span> <span class="dv">2</span><span class="sc">/</span><span class="dv">3</span>,</span>
<span id="cb898-12"><a href="god-spiked-the-integers.html#cb898-12" aria-hidden="true" tabindex="-1"></a>                  <span class="at">position =</span> <span class="fu">position_dodge</span>(<span class="at">width =</span> <span class="fl">0.5</span>)) <span class="sc">+</span></span>
<span id="cb898-13"><a href="god-spiked-the-integers.html#cb898-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;orange2&quot;</span>,<span class="st">&quot;deepskyblue4&quot;</span>)) <span class="sc">+</span></span>
<span id="cb898-14"><a href="god-spiked-the-integers.html#cb898-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">data =</span> text,</span>
<span id="cb898-15"><a href="god-spiked-the-integers.html#cb898-15" aria-hidden="true" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">label =</span> fit), </span>
<span id="cb898-16"><a href="god-spiked-the-integers.html#cb898-16" aria-hidden="true" tabindex="-1"></a>            <span class="at">position =</span> <span class="fu">position_dodge</span>(<span class="at">width =</span> <span class="fl">2.25</span>)) <span class="sc">+</span></span>
<span id="cb898-17"><a href="god-spiked-the-integers.html#cb898-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;posterior (log-odds scale)&quot;</span>,</span>
<span id="cb898-18"><a href="god-spiked-the-integers.html#cb898-18" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb898-19"><a href="god-spiked-the-integers.html#cb898-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.ticks.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb898-20"><a href="god-spiked-the-integers.html#cb898-20" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:unnamed-chunk-459"></span>
<img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-459-1.png" alt="b11.4とb11.6の比較" width="672" />
<p class="caption">
図11.9: b11.4とb11.6の比較
</p>
</div>
<p>データ数が違うので、PSISやWAICを比べることはできない。</p>
<div class="sourceCode" id="cb899"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb899-1"><a href="god-spiked-the-integers.html#cb899-1" aria-hidden="true" tabindex="-1"></a>b11<span class="fl">.6</span> <span class="ot">&lt;-</span> <span class="fu">add_criterion</span>(b11<span class="fl">.6</span>, <span class="fu">c</span>(<span class="st">&quot;waic&quot;</span>,<span class="st">&quot;loo&quot;</span>))</span></code></pre></div>
<div class="sourceCode" id="cb900"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb900-1"><a href="god-spiked-the-integers.html#cb900-1" aria-hidden="true" tabindex="-1"></a><span class="fu">loo_compare</span>(b11<span class="fl">.4</span>, b11<span class="fl">.6</span>)</span></code></pre></div>
<p>また、今回のモデルでは<span class="math inline">\(pareto-k\)</span>についてエラーメッセージが出ている。これは<code>b11.6</code>ではよりデータを集約しているため、LOOCVのときにより多くのデータ(今回は18個)を一度に抜いているようなものだからである。これにより、一部のデータがより影響力を持つようになってしまう。よって、PSISを計算するならば0/1のデータについてモデリングする方が望ましい。</p>
</div>
</div>
<div id="aggregated-binomial-graduate-school-admittions." class="section level2 hasAnchor" number="11.2">
<h2><span class="header-section-number">11.2</span> Aggregated binomial: Graduate school admittions.<a href="god-spiked-the-integers.html#aggregated-binomial-graduate-school-admittions." class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>先ほどは毎回同じ試行回数(18)だったが、そうでない場合もある。以下では、UCバークレーの6つの研究科の入試における合否データを用いる。</p>
<div class="sourceCode" id="cb901"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb901-1"><a href="god-spiked-the-integers.html#cb901-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(UCBadmit)</span>
<span id="cb901-2"><a href="god-spiked-the-integers.html#cb901-2" aria-hidden="true" tabindex="-1"></a>d3 <span class="ot">&lt;-</span> UCBadmit</span>
<span id="cb901-3"><a href="god-spiked-the-integers.html#cb901-3" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(d3)</span></code></pre></div>
<pre><code>## &#39;data.frame&#39;:    12 obs. of  5 variables:
##  $ dept            : Factor w/ 6 levels &quot;A&quot;,&quot;B&quot;,&quot;C&quot;,&quot;D&quot;,..: 1 1 2 2 3 3 4 4 5 5 ...
##  $ applicant.gender: Factor w/ 2 levels &quot;female&quot;,&quot;male&quot;: 2 1 2 1 2 1 2 1 2 1 ...
##  $ admit           : int  512 89 353 17 120 202 138 131 53 94 ...
##  $ reject          : int  313 19 207 8 205 391 279 244 138 299 ...
##  $ applications    : int  825 108 560 25 325 593 417 375 191 393 ...</code></pre>
<p>性別によって合格率に差があるかを見たい。<br />
<br /></p>
<p><span class="math display">\[
\begin{aligned}
  A_{i} &amp;\sim Binomial(N_{i}, p_{i})\\
  logit(p_{i}) &amp;= \alpha_{GID{i}}\\
  \alpha_{j} &amp;\sim Normal(0,1.5)
\end{aligned}
\]</span>
<br /></p>
<p>モデルを回す。</p>
<div class="sourceCode" id="cb903"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb903-1"><a href="god-spiked-the-integers.html#cb903-1" aria-hidden="true" tabindex="-1"></a>d3 <span class="sc">%&gt;%</span> </span>
<span id="cb903-2"><a href="god-spiked-the-integers.html#cb903-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">gid =</span> <span class="fu">factor</span>(applicant.gender, <span class="at">levels=</span><span class="fu">c</span>(<span class="st">&quot;male&quot;</span>,<span class="st">&quot;female&quot;</span>)),</span>
<span id="cb903-3"><a href="god-spiked-the-integers.html#cb903-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">case =</span> <span class="fu">factor</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">n</span>())) <span class="ot">-&gt;</span> d3</span>
<span id="cb903-4"><a href="god-spiked-the-integers.html#cb903-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb903-5"><a href="god-spiked-the-integers.html#cb903-5" aria-hidden="true" tabindex="-1"></a>b11<span class="fl">.7</span> <span class="ot">&lt;-</span> <span class="fu">brm</span>(<span class="at">data =</span> d3, </span>
<span id="cb903-6"><a href="god-spiked-the-integers.html#cb903-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> binomial,</span>
<span id="cb903-7"><a href="god-spiked-the-integers.html#cb903-7" aria-hidden="true" tabindex="-1"></a>      admit <span class="sc">|</span> <span class="fu">trials</span>(applications) <span class="sc">~</span> <span class="dv">0</span> <span class="sc">+</span> gid,</span>
<span id="cb903-8"><a href="god-spiked-the-integers.html#cb903-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">prior=</span> <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">1.5</span>), <span class="at">class =</span> b),</span>
<span id="cb903-9"><a href="god-spiked-the-integers.html#cb903-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">seed =</span> <span class="dv">11</span>,</span>
<span id="cb903-10"><a href="god-spiked-the-integers.html#cb903-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">backend =</span> <span class="st">&quot;cmdstanr&quot;</span>,</span>
<span id="cb903-11"><a href="god-spiked-the-integers.html#cb903-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">file =</span> <span class="st">&quot;output/Chapter11/b11.7&quot;</span>)</span></code></pre></div>
<p>男の方が合格率が高い。</p>
<div class="sourceCode" id="cb904"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb904-1"><a href="god-spiked-the-integers.html#cb904-1" aria-hidden="true" tabindex="-1"></a><span class="fu">posterior_summary</span>(b11<span class="fl">.7</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb904-2"><a href="god-spiked-the-integers.html#cb904-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb904-3"><a href="god-spiked-the-integers.html#cb904-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>(<span class="at">var =</span> <span class="st">&quot;parameters&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb904-4"><a href="god-spiked-the-integers.html#cb904-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(parameters <span class="sc">!=</span><span class="st">&quot;lp__&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb904-5"><a href="god-spiked-the-integers.html#cb904-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="at">digits =</span><span class="dv">2</span>, <span class="at">caption =</span> <span class="st">&quot;モデルb11.7の結果&quot;</span>,</span>
<span id="cb904-6"><a href="god-spiked-the-integers.html#cb904-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">booktabs =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb904-7"><a href="god-spiked-the-integers.html#cb904-7" aria-hidden="true" tabindex="-1"></a>   <span class="fu">kable_styling</span>(<span class="at">latex_options =</span> <span class="st">&quot;striped&quot;</span>)</span></code></pre></div>
<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:unnamed-chunk-464">表11.8: </span>モデルb11.7の結果
</caption>
<thead>
<tr>
<th style="text-align:left;">
parameters
</th>
<th style="text-align:right;">
Estimate
</th>
<th style="text-align:right;">
Est.Error
</th>
<th style="text-align:right;">
Q2.5
</th>
<th style="text-align:right;">
Q97.5
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
b_gidmale
</td>
<td style="text-align:right;">
-0.22
</td>
<td style="text-align:right;">
0.04
</td>
<td style="text-align:right;">
-0.30
</td>
<td style="text-align:right;">
-0.14
</td>
</tr>
<tr>
<td style="text-align:left;">
b_gidfemale
</td>
<td style="text-align:right;">
-0.83
</td>
<td style="text-align:right;">
0.05
</td>
<td style="text-align:right;">
-0.93
</td>
<td style="text-align:right;">
-0.73
</td>
</tr>
<tr>
<td style="text-align:left;">
lprior
</td>
<td style="text-align:right;">
-2.81
</td>
<td style="text-align:right;">
0.02
</td>
<td style="text-align:right;">
-2.85
</td>
<td style="text-align:right;">
-2.78
</td>
</tr>
</tbody>
</table>
<p>対数オッズと確率の差の事後分布をみてみると、やはりどちらも男の方が高い。</p>
<div class="sourceCode" id="cb905"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb905-1"><a href="god-spiked-the-integers.html#cb905-1" aria-hidden="true" tabindex="-1"></a><span class="fu">posterior_samples</span>(b11<span class="fl">.7</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb905-2"><a href="god-spiked-the-integers.html#cb905-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>lp__) <span class="sc">%&gt;%</span> </span>
<span id="cb905-3"><a href="god-spiked-the-integers.html#cb905-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">diff_a =</span> b_gidmale <span class="sc">-</span> b_gidfemale,</span>
<span id="cb905-4"><a href="god-spiked-the-integers.html#cb905-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">diff_p =</span> <span class="fu">inv_logit_scaled</span>(b_gidmale)<span class="sc">-</span></span>
<span id="cb905-5"><a href="god-spiked-the-integers.html#cb905-5" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">inv_logit_scaled</span>(b_gidfemale)) <span class="sc">%&gt;%</span> </span>
<span id="cb905-6"><a href="god-spiked-the-integers.html#cb905-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">contains</span>(<span class="st">&quot;diff&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb905-7"><a href="god-spiked-the-integers.html#cb905-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(name) <span class="sc">%&gt;%</span> </span>
<span id="cb905-8"><a href="god-spiked-the-integers.html#cb905-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mean_qi</span>(value, <span class="at">.width=</span>.<span class="dv">89</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb905-9"><a href="god-spiked-the-integers.html#cb905-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="at">digits =</span><span class="dv">2</span>, <span class="at">caption =</span> <span class="st">&quot;男女における対数オッズと確率の差&quot;</span>,</span>
<span id="cb905-10"><a href="god-spiked-the-integers.html#cb905-10" aria-hidden="true" tabindex="-1"></a>        <span class="at">booktabs =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb905-11"><a href="god-spiked-the-integers.html#cb905-11" aria-hidden="true" tabindex="-1"></a>   <span class="fu">kable_styling</span>(<span class="at">latex_options =</span> <span class="st">&quot;striped&quot;</span>)</span></code></pre></div>
<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:unnamed-chunk-465">表11.9: </span>男女における対数オッズと確率の差
</caption>
<thead>
<tr>
<th style="text-align:left;">
name
</th>
<th style="text-align:right;">
value
</th>
<th style="text-align:right;">
.lower
</th>
<th style="text-align:right;">
.upper
</th>
<th style="text-align:right;">
.width
</th>
<th style="text-align:left;">
.point
</th>
<th style="text-align:left;">
.interval
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
diff_a
</td>
<td style="text-align:right;">
0.61
</td>
<td style="text-align:right;">
0.51
</td>
<td style="text-align:right;">
0.72
</td>
<td style="text-align:right;">
0.89
</td>
<td style="text-align:left;">
mean
</td>
<td style="text-align:left;">
qi
</td>
</tr>
<tr>
<td style="text-align:left;">
diff_p
</td>
<td style="text-align:right;">
0.14
</td>
<td style="text-align:right;">
0.12
</td>
<td style="text-align:right;">
0.16
</td>
<td style="text-align:right;">
0.89
</td>
<td style="text-align:left;">
mean
</td>
<td style="text-align:left;">
qi
</td>
</tr>
</tbody>
</table>
<p>モデルの結果を図示する。実際には2つの研究科でのみ男性の合格率が高くなく、モデルの推定結果はデータとかなりずれていることが分かる。</p>
<div class="sourceCode" id="cb906"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb906-1"><a href="god-spiked-the-integers.html#cb906-1" aria-hidden="true" tabindex="-1"></a>nd <span class="ot">&lt;-</span> <span class="fu">crossing</span>(<span class="at">dept =</span> <span class="fu">c</span>(<span class="st">&quot;A&quot;</span>,<span class="st">&quot;B&quot;</span>,<span class="st">&quot;C&quot;</span>,<span class="st">&quot;D&quot;</span>,<span class="st">&quot;E&quot;</span>,<span class="st">&quot;F&quot;</span>),</span>
<span id="cb906-2"><a href="god-spiked-the-integers.html#cb906-2" aria-hidden="true" tabindex="-1"></a>               <span class="at">gid =</span> <span class="fu">factor</span>(<span class="fu">c</span>(<span class="st">&quot;male&quot;</span>,<span class="st">&quot;female&quot;</span>), <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&quot;male&quot;</span>,<span class="st">&quot;female&quot;</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb906-3"><a href="god-spiked-the-integers.html#cb906-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">applications =</span> d3<span class="sc">$</span>applications)</span>
<span id="cb906-4"><a href="god-spiked-the-integers.html#cb906-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb906-5"><a href="god-spiked-the-integers.html#cb906-5" aria-hidden="true" tabindex="-1"></a><span class="fu">fitted</span>(b11<span class="fl">.7</span>, <span class="at">newdata =</span> nd) <span class="sc">%&gt;%</span> </span>
<span id="cb906-6"><a href="god-spiked-the-integers.html#cb906-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb906-7"><a href="god-spiked-the-integers.html#cb906-7" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>Est.Error) <span class="sc">%&gt;%</span> </span>
<span id="cb906-8"><a href="god-spiked-the-integers.html#cb906-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_names</span>(<span class="st">&quot;ci_mean&quot;</span>, <span class="st">&quot;ci_l&quot;</span>,<span class="st">&quot;ci_u&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb906-9"><a href="god-spiked-the-integers.html#cb906-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(nd) <span class="sc">%&gt;%</span> </span>
<span id="cb906-10"><a href="god-spiked-the-integers.html#cb906-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">case =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">n</span>()) <span class="ot">-&gt;</span> fit11<span class="fl">.7</span></span>
<span id="cb906-11"><a href="god-spiked-the-integers.html#cb906-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb906-12"><a href="god-spiked-the-integers.html#cb906-12" aria-hidden="true" tabindex="-1"></a>text <span class="ot">&lt;-</span></span>
<span id="cb906-13"><a href="god-spiked-the-integers.html#cb906-13" aria-hidden="true" tabindex="-1"></a>  d3 <span class="sc">%&gt;%</span></span>
<span id="cb906-14"><a href="god-spiked-the-integers.html#cb906-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(dept) <span class="sc">%&gt;%</span></span>
<span id="cb906-15"><a href="god-spiked-the-integers.html#cb906-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">case  =</span> <span class="fu">mean</span>(<span class="fu">as.numeric</span>(case)),</span>
<span id="cb906-16"><a href="god-spiked-the-integers.html#cb906-16" aria-hidden="true" tabindex="-1"></a>            <span class="at">admit =</span> <span class="fu">mean</span>(admit <span class="sc">/</span> applications) <span class="sc">+</span> .<span class="dv">05</span>)</span>
<span id="cb906-17"><a href="god-spiked-the-integers.html#cb906-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb906-18"><a href="god-spiked-the-integers.html#cb906-18" aria-hidden="true" tabindex="-1"></a><span class="co">#plot</span></span>
<span id="cb906-19"><a href="god-spiked-the-integers.html#cb906-19" aria-hidden="true" tabindex="-1"></a>d3 <span class="sc">%&gt;%</span> </span>
<span id="cb906-20"><a href="god-spiked-the-integers.html#cb906-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>case))<span class="sc">+</span></span>
<span id="cb906-21"><a href="god-spiked-the-integers.html#cb906-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> admit<span class="sc">/</span>applications), <span class="at">color =</span> <span class="st">&quot;navy&quot;</span>,</span>
<span id="cb906-22"><a href="god-spiked-the-integers.html#cb906-22" aria-hidden="true" tabindex="-1"></a>             <span class="at">shape=</span><span class="dv">16</span>)<span class="sc">+</span></span>
<span id="cb906-23"><a href="god-spiked-the-integers.html#cb906-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> admit<span class="sc">/</span>applications,<span class="at">group=</span>dept),</span>
<span id="cb906-24"><a href="god-spiked-the-integers.html#cb906-24" aria-hidden="true" tabindex="-1"></a>            <span class="at">color =</span> <span class="st">&quot;navy&quot;</span>, <span class="at">size=</span><span class="fl">0.7</span>)<span class="sc">+</span></span>
<span id="cb906-25"><a href="god-spiked-the-integers.html#cb906-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">data =</span> text,</span>
<span id="cb906-26"><a href="god-spiked-the-integers.html#cb906-26" aria-hidden="true" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">y =</span> admit, <span class="at">label =</span> dept))<span class="sc">+</span></span>
<span id="cb906-27"><a href="god-spiked-the-integers.html#cb906-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_pointinterval</span>(<span class="at">data =</span> fit11<span class="fl">.7</span>,</span>
<span id="cb906-28"><a href="god-spiked-the-integers.html#cb906-28" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">aes</span>(<span class="at">y =</span> ci_mean<span class="sc">/</span>applications, </span>
<span id="cb906-29"><a href="god-spiked-the-integers.html#cb906-29" aria-hidden="true" tabindex="-1"></a>                         <span class="at">ymin =</span> ci_l<span class="sc">/</span>applications,</span>
<span id="cb906-30"><a href="god-spiked-the-integers.html#cb906-30" aria-hidden="true" tabindex="-1"></a>                         <span class="at">ymax =</span> ci_u<span class="sc">/</span>applications),</span>
<span id="cb906-31"><a href="god-spiked-the-integers.html#cb906-31" aria-hidden="true" tabindex="-1"></a>                     <span class="at">shape =</span> <span class="dv">1</span>, <span class="at">size=</span><span class="dv">4</span>)<span class="sc">+</span></span>
<span id="cb906-32"><a href="god-spiked-the-integers.html#cb906-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="st">&quot;Proportion admitted&quot;</span>, <span class="at">limits =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb906-33"><a href="god-spiked-the-integers.html#cb906-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Posterior validation check&quot;</span>) <span class="sc">+</span></span>
<span id="cb906-34"><a href="god-spiked-the-integers.html#cb906-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.ticks.x =</span> <span class="fu">element_blank</span>())</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:unnamed-chunk-466"></span>
<img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-466-1.png" alt="実測値とモデルb11.7による予測値。青が実測値、黒がモデルによる予測値を表す。" width="672" />
<p class="caption">
図11.10: 実測値とモデルb11.7による予測値。青が実測値、黒がモデルによる予測値を表す。
</p>
</div>
<p>これは、研究科ごとに合格率に大きな違いがあり、女性は合格率の低い研究科に応募する割合が多いからである。</p>
<div class="sourceCode" id="cb907"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb907-1"><a href="god-spiked-the-integers.html#cb907-1" aria-hidden="true" tabindex="-1"></a>d3 <span class="sc">%&gt;%</span> </span>
<span id="cb907-2"><a href="god-spiked-the-integers.html#cb907-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(dept) <span class="sc">%&gt;%</span> </span>
<span id="cb907-3"><a href="god-spiked-the-integers.html#cb907-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prop =</span> applications<span class="sc">/</span><span class="fu">sum</span>(applications)) <span class="sc">%&gt;%</span> </span>
<span id="cb907-4"><a href="god-spiked-the-integers.html#cb907-4" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(dept, gid, prop) <span class="sc">%&gt;%</span> </span>
<span id="cb907-5"><a href="god-spiked-the-integers.html#cb907-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> dept, </span>
<span id="cb907-6"><a href="god-spiked-the-integers.html#cb907-6" aria-hidden="true" tabindex="-1"></a>              <span class="at">values_from =</span> prop) <span class="sc">%&gt;%</span> </span>
<span id="cb907-7"><a href="god-spiked-the-integers.html#cb907-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="at">digits=</span><span class="dv">2</span>, <span class="at">caption=</span><span class="st">&quot;研究科ごとの応募者の男女比&quot;</span>,</span>
<span id="cb907-8"><a href="god-spiked-the-integers.html#cb907-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">booktabs =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb907-9"><a href="god-spiked-the-integers.html#cb907-9" aria-hidden="true" tabindex="-1"></a>   <span class="fu">kable_styling</span>(<span class="at">latex_options =</span> <span class="st">&quot;striped&quot;</span>)</span></code></pre></div>
<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:unnamed-chunk-467">表11.10: </span>研究科ごとの応募者の男女比
</caption>
<thead>
<tr>
<th style="text-align:left;">
gid
</th>
<th style="text-align:right;">
A
</th>
<th style="text-align:right;">
B
</th>
<th style="text-align:right;">
C
</th>
<th style="text-align:right;">
D
</th>
<th style="text-align:right;">
E
</th>
<th style="text-align:right;">
F
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
male
</td>
<td style="text-align:right;">
0.88
</td>
<td style="text-align:right;">
0.96
</td>
<td style="text-align:right;">
0.35
</td>
<td style="text-align:right;">
0.53
</td>
<td style="text-align:right;">
0.33
</td>
<td style="text-align:right;">
0.52
</td>
</tr>
<tr>
<td style="text-align:left;">
female
</td>
<td style="text-align:right;">
0.12
</td>
<td style="text-align:right;">
0.04
</td>
<td style="text-align:right;">
0.65
</td>
<td style="text-align:right;">
0.47
</td>
<td style="text-align:right;">
0.67
</td>
<td style="text-align:right;">
0.48
</td>
</tr>
</tbody>
</table>
<p><br /></p>
<p>そこで今度は、研究科による合格率の違いを考慮に入れたモデルを考える。</p>
<p><span class="math display">\[
\begin{aligned}
  A_{i} &amp;\sim Binomial(N_{i}, p_{i})\\
  logit(p_{i}) &amp;= \alpha_{GID{i}} + \delta_{DEPT_{i}}\\
  \alpha_{j} &amp;\sim Normal(0,1.5)\\
  \delta_{j} &amp;\sim Normal(0,1.5)
\end{aligned}
\]</span>
<br /></p>
<div class="sourceCode" id="cb908"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb908-1"><a href="god-spiked-the-integers.html#cb908-1" aria-hidden="true" tabindex="-1"></a>b11<span class="fl">.8</span> <span class="ot">&lt;-</span> <span class="fu">brm</span>(<span class="at">data =</span> d3, </span>
<span id="cb908-2"><a href="god-spiked-the-integers.html#cb908-2" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> binomial,</span>
<span id="cb908-3"><a href="god-spiked-the-integers.html#cb908-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">bf</span>(admit <span class="sc">|</span> <span class="fu">trials</span>(applications) <span class="sc">~</span> <span class="dv">0</span> <span class="sc">+</span> a <span class="sc">+</span> d,</span>
<span id="cb908-4"><a href="god-spiked-the-integers.html#cb908-4" aria-hidden="true" tabindex="-1"></a>         a <span class="sc">~</span> <span class="dv">0</span> <span class="sc">+</span> gid,</span>
<span id="cb908-5"><a href="god-spiked-the-integers.html#cb908-5" aria-hidden="true" tabindex="-1"></a>         d <span class="sc">~</span> <span class="dv">0</span> <span class="sc">+</span> dept,</span>
<span id="cb908-6"><a href="god-spiked-the-integers.html#cb908-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">nl =</span> <span class="cn">TRUE</span>),</span>
<span id="cb908-7"><a href="god-spiked-the-integers.html#cb908-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">prior=</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">1.5</span>), <span class="at">nlpar =</span> a),</span>
<span id="cb908-8"><a href="god-spiked-the-integers.html#cb908-8" aria-hidden="true" tabindex="-1"></a>               <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">1.5</span>), <span class="at">nlpar =</span> d)),</span>
<span id="cb908-9"><a href="god-spiked-the-integers.html#cb908-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">seed =</span> <span class="dv">11</span>,<span class="at">iter =</span> <span class="dv">4000</span>, <span class="at">warmup=</span><span class="dv">1000</span>,</span>
<span id="cb908-10"><a href="god-spiked-the-integers.html#cb908-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">backend =</span> <span class="st">&quot;cmdstanr&quot;</span>,</span>
<span id="cb908-11"><a href="god-spiked-the-integers.html#cb908-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">file =</span> <span class="st">&quot;output/Chapter11/b11.8&quot;</span>)</span></code></pre></div>
<p>結果を見てみると、男女で違いはないことが分かる。むしろ女性の方が少し合格率は高い。</p>
<div class="sourceCode" id="cb909"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb909-1"><a href="god-spiked-the-integers.html#cb909-1" aria-hidden="true" tabindex="-1"></a><span class="fu">posterior_summary</span>(b11<span class="fl">.8</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb909-2"><a href="god-spiked-the-integers.html#cb909-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb909-3"><a href="god-spiked-the-integers.html#cb909-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>(<span class="at">var =</span> <span class="st">&quot;parameters&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb909-4"><a href="god-spiked-the-integers.html#cb909-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(parameters<span class="sc">!=</span><span class="st">&quot;lp__&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb909-5"><a href="god-spiked-the-integers.html#cb909-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="at">digits=</span><span class="dv">2</span>, <span class="at">caption=</span><span class="st">&quot;モデルb11.8の結果&quot;</span>,</span>
<span id="cb909-6"><a href="god-spiked-the-integers.html#cb909-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">booktabs =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb909-7"><a href="god-spiked-the-integers.html#cb909-7" aria-hidden="true" tabindex="-1"></a>   <span class="fu">kable_styling</span>(<span class="at">latex_options =</span> <span class="st">&quot;striped&quot;</span>)</span></code></pre></div>
<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:unnamed-chunk-469">表11.11: </span>モデルb11.8の結果
</caption>
<thead>
<tr>
<th style="text-align:left;">
parameters
</th>
<th style="text-align:right;">
Estimate
</th>
<th style="text-align:right;">
Est.Error
</th>
<th style="text-align:right;">
Q2.5
</th>
<th style="text-align:right;">
Q97.5
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
b_a_gidmale
</td>
<td style="text-align:right;">
-0.54
</td>
<td style="text-align:right;">
0.51
</td>
<td style="text-align:right;">
-1.57
</td>
<td style="text-align:right;">
0.46
</td>
</tr>
<tr>
<td style="text-align:left;">
b_a_gidfemale
</td>
<td style="text-align:right;">
-0.44
</td>
<td style="text-align:right;">
0.52
</td>
<td style="text-align:right;">
-1.48
</td>
<td style="text-align:right;">
0.56
</td>
</tr>
<tr>
<td style="text-align:left;">
b_d_deptA
</td>
<td style="text-align:right;">
1.12
</td>
<td style="text-align:right;">
0.52
</td>
<td style="text-align:right;">
0.12
</td>
<td style="text-align:right;">
2.16
</td>
</tr>
<tr>
<td style="text-align:left;">
b_d_deptB
</td>
<td style="text-align:right;">
1.08
</td>
<td style="text-align:right;">
0.52
</td>
<td style="text-align:right;">
0.08
</td>
<td style="text-align:right;">
2.12
</td>
</tr>
<tr>
<td style="text-align:left;">
b_d_deptC
</td>
<td style="text-align:right;">
-0.14
</td>
<td style="text-align:right;">
0.52
</td>
<td style="text-align:right;">
-1.14
</td>
<td style="text-align:right;">
0.89
</td>
</tr>
<tr>
<td style="text-align:left;">
b_d_deptD
</td>
<td style="text-align:right;">
-0.17
</td>
<td style="text-align:right;">
0.52
</td>
<td style="text-align:right;">
-1.17
</td>
<td style="text-align:right;">
0.87
</td>
</tr>
<tr>
<td style="text-align:left;">
b_d_deptE
</td>
<td style="text-align:right;">
-0.61
</td>
<td style="text-align:right;">
0.52
</td>
<td style="text-align:right;">
-1.63
</td>
<td style="text-align:right;">
0.43
</td>
</tr>
<tr>
<td style="text-align:left;">
b_d_deptF
</td>
<td style="text-align:right;">
-2.17
</td>
<td style="text-align:right;">
0.53
</td>
<td style="text-align:right;">
-3.20
</td>
<td style="text-align:right;">
-1.10
</td>
</tr>
<tr>
<td style="text-align:left;">
lprior
</td>
<td style="text-align:right;">
-12.86
</td>
<td style="text-align:right;">
0.68
</td>
<td style="text-align:right;">
-14.67
</td>
<td style="text-align:right;">
-12.19
</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb910"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb910-1"><a href="god-spiked-the-integers.html#cb910-1" aria-hidden="true" tabindex="-1"></a><span class="fu">posterior_samples</span>(b11<span class="fl">.8</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb910-2"><a href="god-spiked-the-integers.html#cb910-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">diff_a =</span> b_a_gidmale <span class="sc">-</span> b_a_gidfemale,</span>
<span id="cb910-3"><a href="god-spiked-the-integers.html#cb910-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">diff_p =</span> <span class="fu">inv_logit_scaled</span>(b_a_gidmale) <span class="sc">-</span></span>
<span id="cb910-4"><a href="god-spiked-the-integers.html#cb910-4" aria-hidden="true" tabindex="-1"></a>           <span class="fu">inv_logit_scaled</span>(b_a_gidfemale)) <span class="sc">%&gt;%</span> </span>
<span id="cb910-5"><a href="god-spiked-the-integers.html#cb910-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">contains</span>(<span class="st">&quot;diff&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb910-6"><a href="god-spiked-the-integers.html#cb910-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(name) <span class="sc">%&gt;%</span> </span>
<span id="cb910-7"><a href="god-spiked-the-integers.html#cb910-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mean_qi</span>(value, <span class="at">.width=</span>.<span class="dv">89</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb910-8"><a href="god-spiked-the-integers.html#cb910-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="at">booktabs =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb910-9"><a href="god-spiked-the-integers.html#cb910-9" aria-hidden="true" tabindex="-1"></a>   <span class="fu">kable_styling</span>(<span class="at">latex_options =</span> <span class="st">&quot;striped&quot;</span>)</span></code></pre></div>
<table class="table" style="margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;">
name
</th>
<th style="text-align:right;">
value
</th>
<th style="text-align:right;">
.lower
</th>
<th style="text-align:right;">
.upper
</th>
<th style="text-align:right;">
.width
</th>
<th style="text-align:left;">
.point
</th>
<th style="text-align:left;">
.interval
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
diff_a
</td>
<td style="text-align:right;">
-0.0975503
</td>
<td style="text-align:right;">
-0.2277221
</td>
<td style="text-align:right;">
0.0324701
</td>
<td style="text-align:right;">
0.89
</td>
<td style="text-align:left;">
mean
</td>
<td style="text-align:left;">
qi
</td>
</tr>
<tr>
<td style="text-align:left;">
diff_p
</td>
<td style="text-align:right;">
-0.0218389
</td>
<td style="text-align:right;">
-0.0520788
</td>
<td style="text-align:right;">
0.0071217
</td>
<td style="text-align:right;">
0.89
</td>
<td style="text-align:left;">
mean
</td>
<td style="text-align:left;">
qi
</td>
</tr>
</tbody>
</table>
<p>おそらく、因果関係をグラフィカルモデルで表すと以下のようになる。</p>
<div class="sourceCode" id="cb911"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb911-1"><a href="god-spiked-the-integers.html#cb911-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggdag)</span>
<span id="cb911-2"><a href="god-spiked-the-integers.html#cb911-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb911-3"><a href="god-spiked-the-integers.html#cb911-3" aria-hidden="true" tabindex="-1"></a>dag_coords <span class="ot">&lt;-</span></span>
<span id="cb911-4"><a href="god-spiked-the-integers.html#cb911-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="at">name =</span> <span class="fu">c</span>(<span class="st">&quot;G&quot;</span>, <span class="st">&quot;D&quot;</span>, <span class="st">&quot;A&quot;</span>),</span>
<span id="cb911-5"><a href="god-spiked-the-integers.html#cb911-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">x    =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>),</span>
<span id="cb911-6"><a href="god-spiked-the-integers.html#cb911-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">y    =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">1</span>))</span>
<span id="cb911-7"><a href="god-spiked-the-integers.html#cb911-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb911-8"><a href="god-spiked-the-integers.html#cb911-8" aria-hidden="true" tabindex="-1"></a><span class="fu">dagify</span>(D <span class="sc">~</span> G,</span>
<span id="cb911-9"><a href="god-spiked-the-integers.html#cb911-9" aria-hidden="true" tabindex="-1"></a>       A <span class="sc">~</span> D <span class="sc">+</span> G,</span>
<span id="cb911-10"><a href="god-spiked-the-integers.html#cb911-10" aria-hidden="true" tabindex="-1"></a>       <span class="at">coords =</span> dag_coords) <span class="sc">%&gt;%</span></span>
<span id="cb911-11"><a href="god-spiked-the-integers.html#cb911-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb911-12"><a href="god-spiked-the-integers.html#cb911-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">xend =</span> xend, <span class="at">yend =</span> yend)) <span class="sc">+</span></span>
<span id="cb911-13"><a href="god-spiked-the-integers.html#cb911-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_dag_text</span>(<span class="at">color =</span> <span class="st">&quot;black&quot;</span>) <span class="sc">+</span></span>
<span id="cb911-14"><a href="god-spiked-the-integers.html#cb911-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_dag_edges</span>(<span class="at">edge_color =</span> <span class="st">&quot;black&quot;</span>) <span class="sc">+</span> </span>
<span id="cb911-15"><a href="god-spiked-the-integers.html#cb911-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="cn">NULL</span>, <span class="at">breaks =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb911-16"><a href="god-spiked-the-integers.html#cb911-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="cn">NULL</span>, <span class="at">breaks =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb911-17"><a href="god-spiked-the-integers.html#cb911-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:unnamed-chunk-470"></span>
<img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-470-1.png" alt="性別と研究科による合格率の違いについての因果関係。Gは性別、Dは研究科、Aは合格率を表す。" width="672" />
<p class="caption">
図11.11: 性別と研究科による合格率の違いについての因果関係。Gは性別、Dは研究科、Aは合格率を表す。
</p>
</div>
<p>今度は実測値とモデルの予測値はよくあっていることが分かる。</p>
<div class="sourceCode" id="cb912"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb912-1"><a href="god-spiked-the-integers.html#cb912-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fitted</span>(b11<span class="fl">.8</span>, <span class="at">newdata =</span> nd) <span class="sc">%&gt;%</span> </span>
<span id="cb912-2"><a href="god-spiked-the-integers.html#cb912-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb912-3"><a href="god-spiked-the-integers.html#cb912-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>Est.Error) <span class="sc">%&gt;%</span> </span>
<span id="cb912-4"><a href="god-spiked-the-integers.html#cb912-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_names</span>(<span class="st">&quot;ci_mean&quot;</span>, <span class="st">&quot;ci_l&quot;</span>,<span class="st">&quot;ci_u&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb912-5"><a href="god-spiked-the-integers.html#cb912-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(nd) <span class="sc">%&gt;%</span> </span>
<span id="cb912-6"><a href="god-spiked-the-integers.html#cb912-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">case =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">n</span>()) <span class="ot">-&gt;</span> fit11<span class="fl">.8</span></span>
<span id="cb912-7"><a href="god-spiked-the-integers.html#cb912-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb912-8"><a href="god-spiked-the-integers.html#cb912-8" aria-hidden="true" tabindex="-1"></a><span class="co">#plot</span></span>
<span id="cb912-9"><a href="god-spiked-the-integers.html#cb912-9" aria-hidden="true" tabindex="-1"></a>d3 <span class="sc">%&gt;%</span> </span>
<span id="cb912-10"><a href="god-spiked-the-integers.html#cb912-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>case))<span class="sc">+</span></span>
<span id="cb912-11"><a href="god-spiked-the-integers.html#cb912-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> admit<span class="sc">/</span>applications), <span class="at">color =</span> <span class="st">&quot;navy&quot;</span>,</span>
<span id="cb912-12"><a href="god-spiked-the-integers.html#cb912-12" aria-hidden="true" tabindex="-1"></a>             <span class="at">shape=</span><span class="dv">16</span>)<span class="sc">+</span></span>
<span id="cb912-13"><a href="god-spiked-the-integers.html#cb912-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> admit<span class="sc">/</span>applications,<span class="at">group=</span>dept),</span>
<span id="cb912-14"><a href="god-spiked-the-integers.html#cb912-14" aria-hidden="true" tabindex="-1"></a>            <span class="at">color =</span> <span class="st">&quot;navy&quot;</span>, <span class="at">size=</span><span class="fl">0.7</span>)<span class="sc">+</span></span>
<span id="cb912-15"><a href="god-spiked-the-integers.html#cb912-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">data =</span> text,</span>
<span id="cb912-16"><a href="god-spiked-the-integers.html#cb912-16" aria-hidden="true" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">y =</span> admit, <span class="at">label =</span> dept))<span class="sc">+</span></span>
<span id="cb912-17"><a href="god-spiked-the-integers.html#cb912-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_pointinterval</span>(<span class="at">data =</span> fit11<span class="fl">.8</span>,</span>
<span id="cb912-18"><a href="god-spiked-the-integers.html#cb912-18" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">aes</span>(<span class="at">y =</span> ci_mean<span class="sc">/</span>applications, </span>
<span id="cb912-19"><a href="god-spiked-the-integers.html#cb912-19" aria-hidden="true" tabindex="-1"></a>                         <span class="at">ymin =</span> ci_l<span class="sc">/</span>applications,</span>
<span id="cb912-20"><a href="god-spiked-the-integers.html#cb912-20" aria-hidden="true" tabindex="-1"></a>                         <span class="at">ymax =</span> ci_u<span class="sc">/</span>applications),</span>
<span id="cb912-21"><a href="god-spiked-the-integers.html#cb912-21" aria-hidden="true" tabindex="-1"></a>                     <span class="at">color =</span> <span class="st">&quot;lightblue&quot;</span>,</span>
<span id="cb912-22"><a href="god-spiked-the-integers.html#cb912-22" aria-hidden="true" tabindex="-1"></a>                     <span class="at">shape =</span> <span class="dv">1</span>, <span class="at">size=</span><span class="dv">5</span>, <span class="at">alpha =</span> <span class="dv">2</span><span class="sc">/</span><span class="dv">3</span>)<span class="sc">+</span></span>
<span id="cb912-23"><a href="god-spiked-the-integers.html#cb912-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="st">&quot;Proportion admitted&quot;</span>, <span class="at">limits =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb912-24"><a href="god-spiked-the-integers.html#cb912-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Posterior validation check&quot;</span>) <span class="sc">+</span></span>
<span id="cb912-25"><a href="god-spiked-the-integers.html#cb912-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.ticks.x =</span> <span class="fu">element_blank</span>())</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:unnamed-chunk-471"></span>
<img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-471-1.png" alt="実測値とモデルによる予測値。青が実測値、水色がモデルによる予測値を表す。" width="672" />
<p class="caption">
図11.12: 実測値とモデルによる予測値。青が実測値、水色がモデルによる予測値を表す。
</p>
</div>
<p>しかし、これで性別が合格率に与える効果を正確に評価できたかは分からない。未観測の要因が関わっている可能性があるからである。例えば、もし共通の要因が研究科の選択と合格率の両方に影響を与えているとき（cf. 図<a href="god-spiked-the-integers.html#fig:causal2">11.13</a>）、研究科で条件づけてしまうと性別と合格率の間に因果関係ではないパスが生じてしまう。</p>
<div class="sourceCode" id="cb913"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb913-1"><a href="god-spiked-the-integers.html#cb913-1" aria-hidden="true" tabindex="-1"></a>dag_coords <span class="ot">&lt;-</span></span>
<span id="cb913-2"><a href="god-spiked-the-integers.html#cb913-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="at">name =</span> <span class="fu">c</span>(<span class="st">&quot;G&quot;</span>, <span class="st">&quot;D&quot;</span>, <span class="st">&quot;A&quot;</span>, <span class="st">&quot;U&quot;</span>),</span>
<span id="cb913-3"><a href="god-spiked-the-integers.html#cb913-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">x    =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">3</span>),</span>
<span id="cb913-4"><a href="god-spiked-the-integers.html#cb913-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">y    =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">2</span>))</span>
<span id="cb913-5"><a href="god-spiked-the-integers.html#cb913-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb913-6"><a href="god-spiked-the-integers.html#cb913-6" aria-hidden="true" tabindex="-1"></a><span class="fu">dagify</span>(D <span class="sc">~</span> G <span class="sc">+</span> U,</span>
<span id="cb913-7"><a href="god-spiked-the-integers.html#cb913-7" aria-hidden="true" tabindex="-1"></a>       A <span class="sc">~</span> D <span class="sc">+</span> G <span class="sc">+</span> U,</span>
<span id="cb913-8"><a href="god-spiked-the-integers.html#cb913-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">coords =</span> dag_coords) <span class="sc">%&gt;%</span></span>
<span id="cb913-9"><a href="god-spiked-the-integers.html#cb913-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb913-10"><a href="god-spiked-the-integers.html#cb913-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">xend =</span> xend, <span class="at">yend =</span> yend)) <span class="sc">+</span></span>
<span id="cb913-11"><a href="god-spiked-the-integers.html#cb913-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">x =</span> <span class="dv">3</span>, <span class="at">y =</span> <span class="dv">2</span>, </span>
<span id="cb913-12"><a href="god-spiked-the-integers.html#cb913-12" aria-hidden="true" tabindex="-1"></a>             <span class="at">size =</span> <span class="dv">5</span>, <span class="at">color =</span> <span class="st">&quot;orange&quot;</span>) <span class="sc">+</span></span>
<span id="cb913-13"><a href="god-spiked-the-integers.html#cb913-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_dag_text</span>(<span class="at">color =</span> <span class="st">&quot;black&quot;</span>) <span class="sc">+</span></span>
<span id="cb913-14"><a href="god-spiked-the-integers.html#cb913-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_dag_edges</span>(<span class="at">edge_color =</span> <span class="st">&quot;black&quot;</span>) <span class="sc">+</span> </span>
<span id="cb913-15"><a href="god-spiked-the-integers.html#cb913-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="cn">NULL</span>, <span class="at">breaks =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb913-16"><a href="god-spiked-the-integers.html#cb913-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="cn">NULL</span>, <span class="at">breaks =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb913-17"><a href="god-spiked-the-integers.html#cb913-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:causal2"></span>
<img src="Rethinking_Bookdown_files/figure-html/causal2-1.png" alt="性別と研究科による合格率の違いについての因果関係。Gは性別、Dは研究科、Aは合格率を表す。" width="672" />
<p class="caption">
図11.13: 性別と研究科による合格率の違いについての因果関係。Gは性別、Dは研究科、Aは合格率を表す。
</p>
</div>
<p>’b11.8’はover-parametalizedである(どちらかの性別をベースラインにしても同じ推定結果は得られる)。しかし、この方法は一方の性だけに事前分布が適用されることを防ぐことができるという利点がある。一方でパラメータ間の相関は強くなるので、それに注意が必要である。</p>
</div>
<div id="poisson-regression" class="section level2 hasAnchor" number="11.3">
<h2><span class="header-section-number">11.3</span> Poisson regression<a href="god-spiked-the-integers.html#poisson-regression" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>二項分布はnが大きく、pが小さいときに平均と分散が同じ値に収束する。例えば<span class="math inline">\(n=100000\)</span>、<span class="math inline">\(p=0.001\)</span>とときを考える。</p>
<div class="sourceCode" id="cb914"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb914-1"><a href="god-spiked-the-integers.html#cb914-1" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="fl">1e5</span></span>
<span id="cb914-2"><a href="god-spiked-the-integers.html#cb914-2" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fl">1e-3</span></span>
<span id="cb914-3"><a href="god-spiked-the-integers.html#cb914-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb914-4"><a href="god-spiked-the-integers.html#cb914-4" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(n,<span class="dv">1000</span>,p)</span>
<span id="cb914-5"><a href="god-spiked-the-integers.html#cb914-5" aria-hidden="true" tabindex="-1"></a><span class="fu">c</span>(<span class="fu">mean</span>(y),<span class="fu">var</span>(y))</span></code></pre></div>
<pre><code>## [1] 1.001700 1.003667</code></pre>
<p>このようなとき、二項分布は<strong>ポワソン分布</strong>に近づくことが知られており、試行回数Nが未知であったり大きいと考えられるときに有用である。ポワソン回帰では、通常log関数がリンク関数に用いられる。</p>
<div id="oceanic-tool-complexity" class="section level3 hasAnchor" number="11.3.1">
<h3><span class="header-section-number">11.3.1</span> Oceanic tool complexity<a href="god-spiked-the-integers.html#oceanic-tool-complexity" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>オセアニアにおける道具の地域差を調べる。理論的には、人口の多い地域の方が複雑な道具が開発されていると予想される。また集団間の交流が盛んなほど人口が多く、技術的進化が起こりやすいと予想される。<span class="citation">Kline and Boyd (<a href="#ref-Kline2010" role="doc-biblioref">2010</a>)</span> のデータを分析していく。</p>
<div class="sourceCode" id="cb916"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb916-1"><a href="god-spiked-the-integers.html#cb916-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(Kline)</span>
<span id="cb916-2"><a href="god-spiked-the-integers.html#cb916-2" aria-hidden="true" tabindex="-1"></a>d4 <span class="ot">&lt;-</span> Kline</span>
<span id="cb916-3"><a href="god-spiked-the-integers.html#cb916-3" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(d4, <span class="at">caption =</span> <span class="st">&quot;オセアニアにおける道具数の地域差&quot;</span>,</span>
<span id="cb916-4"><a href="god-spiked-the-integers.html#cb916-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">booktabs =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb916-5"><a href="god-spiked-the-integers.html#cb916-5" aria-hidden="true" tabindex="-1"></a>   <span class="fu">kable_styling</span>(<span class="at">latex_options =</span> <span class="st">&quot;striped&quot;</span>)</span></code></pre></div>
<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:unnamed-chunk-473">表11.12: </span>オセアニアにおける道具数の地域差
</caption>
<thead>
<tr>
<th style="text-align:left;">
culture
</th>
<th style="text-align:right;">
population
</th>
<th style="text-align:left;">
contact
</th>
<th style="text-align:right;">
total_tools
</th>
<th style="text-align:right;">
mean_TU
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Malekula
</td>
<td style="text-align:right;">
1100
</td>
<td style="text-align:left;">
low
</td>
<td style="text-align:right;">
13
</td>
<td style="text-align:right;">
3.2
</td>
</tr>
<tr>
<td style="text-align:left;">
Tikopia
</td>
<td style="text-align:right;">
1500
</td>
<td style="text-align:left;">
low
</td>
<td style="text-align:right;">
22
</td>
<td style="text-align:right;">
4.7
</td>
</tr>
<tr>
<td style="text-align:left;">
Santa Cruz
</td>
<td style="text-align:right;">
3600
</td>
<td style="text-align:left;">
low
</td>
<td style="text-align:right;">
24
</td>
<td style="text-align:right;">
4.0
</td>
</tr>
<tr>
<td style="text-align:left;">
Yap
</td>
<td style="text-align:right;">
4791
</td>
<td style="text-align:left;">
high
</td>
<td style="text-align:right;">
43
</td>
<td style="text-align:right;">
5.0
</td>
</tr>
<tr>
<td style="text-align:left;">
Lau Fiji
</td>
<td style="text-align:right;">
7400
</td>
<td style="text-align:left;">
high
</td>
<td style="text-align:right;">
33
</td>
<td style="text-align:right;">
5.0
</td>
</tr>
<tr>
<td style="text-align:left;">
Trobriand
</td>
<td style="text-align:right;">
8000
</td>
<td style="text-align:left;">
high
</td>
<td style="text-align:right;">
19
</td>
<td style="text-align:right;">
4.0
</td>
</tr>
<tr>
<td style="text-align:left;">
Chuuk
</td>
<td style="text-align:right;">
9200
</td>
<td style="text-align:left;">
high
</td>
<td style="text-align:right;">
40
</td>
<td style="text-align:right;">
3.8
</td>
</tr>
<tr>
<td style="text-align:left;">
Manus
</td>
<td style="text-align:right;">
13000
</td>
<td style="text-align:left;">
low
</td>
<td style="text-align:right;">
28
</td>
<td style="text-align:right;">
6.6
</td>
</tr>
<tr>
<td style="text-align:left;">
Tonga
</td>
<td style="text-align:right;">
17500
</td>
<td style="text-align:left;">
high
</td>
<td style="text-align:right;">
55
</td>
<td style="text-align:right;">
5.4
</td>
</tr>
<tr>
<td style="text-align:left;">
Hawaii
</td>
<td style="text-align:right;">
275000
</td>
<td style="text-align:left;">
low
</td>
<td style="text-align:right;">
71
</td>
<td style="text-align:right;">
6.6
</td>
</tr>
</tbody>
</table>
<p><br /></p>
<div class="sourceCode" id="cb917"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb917-1"><a href="god-spiked-the-integers.html#cb917-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 変数変換  </span></span>
<span id="cb917-2"><a href="god-spiked-the-integers.html#cb917-2" aria-hidden="true" tabindex="-1"></a>d4 <span class="sc">%&gt;%</span> </span>
<span id="cb917-3"><a href="god-spiked-the-integers.html#cb917-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">P =</span> <span class="fu">standardize</span>(<span class="fu">log</span>(population)),</span>
<span id="cb917-4"><a href="god-spiked-the-integers.html#cb917-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">cid =</span> contact) <span class="ot">-&gt;</span> d4</span></code></pre></div>
<p>考えるのは人口と他地域との交流の交互作用を考えた以下のモデルである。<br />
<br /></p>
<p><span class="math display">\[
\begin{aligned}
  T_{i} &amp;\sim Poisson(\lambda_{i})\\
  log \lambda_{i} &amp;= \alpha_{CID_{[i]}} + \beta_{CID_{[i]}} logP_{i}\\  
  \alpha_{j} &amp;\sim to\ be\ determined\\
  \beta_{j} &amp;\sim to\ be\ determined\\
\end{aligned}
\]</span>
<br /></p>
<p>どのような事前分布が適切だろうか。まず、切片のみのモデルを考え、切片の事前分布を平均0、標準偏差10の正規分布と平均3、あるいは標準偏差0.5の正規分布とする。<br />
<span class="math inline">\(Normal(0,10)\)</span>のとき、事前分布は0に集まっており、右に裾が長いことが分かる。これは明らかに不適当である。一方、<span class="math inline">\(Normal(3,0.5)\)</span>はある程度広い範囲に広がっていることが分かる。</p>
<div class="sourceCode" id="cb918"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb918-1"><a href="god-spiked-the-integers.html#cb918-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">x       =</span> <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">22</span>),</span>
<span id="cb918-2"><a href="god-spiked-the-integers.html#cb918-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">y       =</span> <span class="fu">c</span>(<span class="fl">0.055</span>, <span class="fl">0.04</span>),</span>
<span id="cb918-3"><a href="god-spiked-the-integers.html#cb918-3" aria-hidden="true" tabindex="-1"></a>       <span class="at">meanlog =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">3</span>),</span>
<span id="cb918-4"><a href="god-spiked-the-integers.html#cb918-4" aria-hidden="true" tabindex="-1"></a>       <span class="at">sdlog   =</span> <span class="fu">c</span>(<span class="dv">10</span>, <span class="fl">0.5</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb918-5"><a href="god-spiked-the-integers.html#cb918-5" aria-hidden="true" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">expand</span>(<span class="fu">nesting</span>(x, y, meanlog, sdlog),</span>
<span id="cb918-6"><a href="god-spiked-the-integers.html#cb918-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">number =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">0</span>, <span class="at">to =</span> <span class="dv">100</span>, <span class="at">length.out =</span> <span class="dv">200</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb918-7"><a href="god-spiked-the-integers.html#cb918-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">density =</span> <span class="fu">dlnorm</span>(number, meanlog, sdlog),</span>
<span id="cb918-8"><a href="god-spiked-the-integers.html#cb918-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">group   =</span> <span class="fu">str_c</span>(<span class="st">&quot;alpha%~%Normal(&quot;</span>, meanlog, <span class="st">&quot;, &quot;</span>, sdlog, <span class="st">&quot;)&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb918-9"><a href="god-spiked-the-integers.html#cb918-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb918-10"><a href="god-spiked-the-integers.html#cb918-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">fill =</span> group, <span class="at">color =</span> group)) <span class="sc">+</span></span>
<span id="cb918-11"><a href="god-spiked-the-integers.html#cb918-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_area</span>(<span class="fu">aes</span>(<span class="at">x =</span> number, <span class="at">y =</span> density),</span>
<span id="cb918-12"><a href="god-spiked-the-integers.html#cb918-12" aria-hidden="true" tabindex="-1"></a>            <span class="at">alpha =</span> <span class="dv">3</span><span class="sc">/</span><span class="dv">4</span>, <span class="at">size =</span> <span class="dv">0</span>, <span class="at">position =</span> <span class="st">&quot;identity&quot;</span>) <span class="sc">+</span></span>
<span id="cb918-13"><a href="god-spiked-the-integers.html#cb918-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">data =</span> . <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(group) <span class="sc">%&gt;%</span> <span class="fu">slice</span>(<span class="dv">1</span>),</span>
<span id="cb918-14"><a href="god-spiked-the-integers.html#cb918-14" aria-hidden="true" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">label =</span> group),</span>
<span id="cb918-15"><a href="god-spiked-the-integers.html#cb918-15" aria-hidden="true" tabindex="-1"></a>            <span class="at">parse =</span> <span class="cn">TRUE</span>,  <span class="at">hjust =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb918-16"><a href="god-spiked-the-integers.html#cb918-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;grey&quot;</span>, <span class="st">&quot;orange&quot;</span>)) <span class="sc">+</span></span>
<span id="cb918-17"><a href="god-spiked-the-integers.html#cb918-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;grey&quot;</span>, <span class="st">&quot;orange&quot;</span>)) <span class="sc">+</span></span>
<span id="cb918-18"><a href="god-spiked-the-integers.html#cb918-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="cn">NULL</span>, <span class="at">breaks =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb918-19"><a href="god-spiked-the-integers.html#cb918-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;mean number of tools&quot;</span>) <span class="sc">+</span></span>
<span id="cb918-20"><a href="god-spiked-the-integers.html#cb918-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:unnamed-chunk-475"></span>
<img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-475-1.png" alt="切片の事前分布の比較。" width="672" />
<p class="caption">
図11.14: 切片の事前分布の比較。
</p>
</div>
<p>それでは、<span class="math inline">\(\beta\)</span>の事前分布はどうすればよいだろうか。<span class="math inline">\(Normal(0,10\)</span>と<span class="math inline">\(Normal(0,0.2)\)</span>の場合を考える。<span class="math inline">\(Normal(0,10)\)</span>のときには<span class="math inline">\(log(P)\)</span>が0付近のときに道具数が極端に大きくなっていることが分かり、明らかに不適切。一方で<span class="math inline">\(Normal(0,0.2)\)</span>のときはうまく様々な傾きを表現できている。　</p>
<div class="sourceCode" id="cb919"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb919-1"><a href="god-spiked-the-integers.html#cb919-1" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb919-2"><a href="god-spiked-the-integers.html#cb919-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb919-3"><a href="god-spiked-the-integers.html#cb919-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb919-4"><a href="god-spiked-the-integers.html#cb919-4" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">i =</span> <span class="dv">1</span><span class="sc">:</span>n,</span>
<span id="cb919-5"><a href="god-spiked-the-integers.html#cb919-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">a =</span> <span class="fu">rnorm</span>(n, <span class="at">mean =</span> <span class="dv">3</span>, <span class="at">sd =</span> <span class="fl">0.5</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb919-6"><a href="god-spiked-the-integers.html#cb919-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="st">`</span><span class="at">beta%~%Normal(0*&#39;, &#39;*10)</span><span class="st">`</span>  <span class="ot">=</span> <span class="fu">rnorm</span>(n, <span class="at">mean =</span> <span class="dv">0</span> , <span class="at">sd =</span> <span class="dv">10</span>),</span>
<span id="cb919-7"><a href="god-spiked-the-integers.html#cb919-7" aria-hidden="true" tabindex="-1"></a>         <span class="st">`</span><span class="at">beta%~%Normal(0*&#39;, &#39;*0.2)</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">rnorm</span>(n, <span class="at">mean =</span> <span class="dv">0</span> , <span class="at">sd =</span> <span class="fl">0.2</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb919-8"><a href="god-spiked-the-integers.html#cb919-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">contains</span>(<span class="st">&quot;beta&quot;</span>),</span>
<span id="cb919-9"><a href="god-spiked-the-integers.html#cb919-9" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">&quot;b&quot;</span>,</span>
<span id="cb919-10"><a href="god-spiked-the-integers.html#cb919-10" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">&quot;prior&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb919-11"><a href="god-spiked-the-integers.html#cb919-11" aria-hidden="true" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">expand</span>(<span class="fu">nesting</span>(i, a, b, prior),</span>
<span id="cb919-12"><a href="god-spiked-the-integers.html#cb919-12" aria-hidden="true" tabindex="-1"></a>         <span class="at">x =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="sc">-</span><span class="dv">2</span>, <span class="at">to =</span> <span class="dv">2</span>, <span class="at">length.out =</span> <span class="dv">100</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb919-13"><a href="god-spiked-the-integers.html#cb919-13" aria-hidden="true" tabindex="-1"></a>　<span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> <span class="fu">exp</span>(a <span class="sc">+</span> b <span class="sc">*</span> x), <span class="at">group =</span> i)) <span class="sc">+</span></span>
<span id="cb919-14"><a href="god-spiked-the-integers.html#cb919-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">size =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">4</span>, <span class="at">alpha =</span> <span class="dv">2</span><span class="sc">/</span><span class="dv">3</span>,</span>
<span id="cb919-15"><a href="god-spiked-the-integers.html#cb919-15" aria-hidden="true" tabindex="-1"></a>            <span class="at">color =</span> <span class="st">&quot;black&quot;</span>) <span class="sc">+</span></span>
<span id="cb919-16"><a href="god-spiked-the-integers.html#cb919-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;log population (std)&quot;</span>,</span>
<span id="cb919-17"><a href="god-spiked-the-integers.html#cb919-17" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;total tools&quot;</span>) <span class="sc">+</span></span>
<span id="cb919-18"><a href="god-spiked-the-integers.html#cb919-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">100</span>)) <span class="sc">+</span></span>
<span id="cb919-19"><a href="god-spiked-the-integers.html#cb919-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> prior, <span class="at">labeller =</span> label_parsed)<span class="sc">+</span></span>
<span id="cb919-20"><a href="god-spiked-the-integers.html#cb919-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">strip.background =</span> <span class="fu">element_blank</span>())</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:unnamed-chunk-476"></span>
<img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-476-1.png" alt="異なる標準偏差を持つbetaの事前予測分布。" width="672" />
<p class="caption">
図11.15: 異なる標準偏差を持つbetaの事前予測分布。
</p>
</div>
<p><span class="math inline">\(Normal(0,0.2)\)</span>を標準化する前のスケールとさらにlogを外したときのスケールで見てみる。一部極端な曲線はあるものの、概ねいい感じの範囲に収まっているといえる。</p>
<div class="sourceCode" id="cb920"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb920-1"><a href="god-spiked-the-integers.html#cb920-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">11</span>)</span>
<span id="cb920-2"><a href="god-spiked-the-integers.html#cb920-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb920-3"><a href="god-spiked-the-integers.html#cb920-3" aria-hidden="true" tabindex="-1"></a>prior <span class="ot">&lt;-</span></span>
<span id="cb920-4"><a href="god-spiked-the-integers.html#cb920-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="at">i =</span> <span class="dv">1</span><span class="sc">:</span>n,</span>
<span id="cb920-5"><a href="god-spiked-the-integers.html#cb920-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">a =</span> <span class="fu">rnorm</span>(n, <span class="at">mean =</span> <span class="dv">3</span>, <span class="at">sd =</span> <span class="fl">0.5</span>),</span>
<span id="cb920-6"><a href="god-spiked-the-integers.html#cb920-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">b =</span> <span class="fu">rnorm</span>(n, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="fl">0.2</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb920-7"><a href="god-spiked-the-integers.html#cb920-7" aria-hidden="true" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">expand</span>(<span class="fu">nesting</span>(i, a, b),</span>
<span id="cb920-8"><a href="god-spiked-the-integers.html#cb920-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">x =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="fu">log</span>(<span class="dv">100</span>), <span class="at">to =</span> <span class="fu">log</span>(<span class="dv">200000</span>), <span class="at">length.out =</span> <span class="dv">100</span>))</span>
<span id="cb920-9"><a href="god-spiked-the-integers.html#cb920-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb920-10"><a href="god-spiked-the-integers.html#cb920-10" aria-hidden="true" tabindex="-1"></a><span class="co"># left</span></span>
<span id="cb920-11"><a href="god-spiked-the-integers.html#cb920-11" aria-hidden="true" tabindex="-1"></a>p3 <span class="ot">&lt;-</span></span>
<span id="cb920-12"><a href="god-spiked-the-integers.html#cb920-12" aria-hidden="true" tabindex="-1"></a>  prior <span class="sc">%&gt;%</span> </span>
<span id="cb920-13"><a href="god-spiked-the-integers.html#cb920-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> <span class="fu">exp</span>(a <span class="sc">+</span> b <span class="sc">*</span> x), <span class="at">group =</span> i)) <span class="sc">+</span></span>
<span id="cb920-14"><a href="god-spiked-the-integers.html#cb920-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">size =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">4</span>, <span class="at">alpha =</span> <span class="dv">2</span><span class="sc">/</span><span class="dv">3</span>,</span>
<span id="cb920-15"><a href="god-spiked-the-integers.html#cb920-15" aria-hidden="true" tabindex="-1"></a>            <span class="at">color =</span> <span class="st">&quot;black&quot;</span>)<span class="sc">+</span></span>
<span id="cb920-16"><a href="god-spiked-the-integers.html#cb920-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="fu">expression</span>(beta<span class="sc">%~%</span><span class="fu">Normal</span>(<span class="dv">0</span><span class="sc">*</span><span class="st">&#39;, &#39;</span><span class="sc">*</span><span class="fl">0.2</span>)),</span>
<span id="cb920-17"><a href="god-spiked-the-integers.html#cb920-17" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">&quot;log population&quot;</span>,</span>
<span id="cb920-18"><a href="god-spiked-the-integers.html#cb920-18" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;total tools&quot;</span>) <span class="sc">+</span></span>
<span id="cb920-19"><a href="god-spiked-the-integers.html#cb920-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="fu">log</span>(<span class="dv">100</span>), <span class="fu">log</span>(<span class="dv">200000</span>)),</span>
<span id="cb920-20"><a href="god-spiked-the-integers.html#cb920-20" aria-hidden="true" tabindex="-1"></a>                  <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">500</span>))</span>
<span id="cb920-21"><a href="god-spiked-the-integers.html#cb920-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb920-22"><a href="god-spiked-the-integers.html#cb920-22" aria-hidden="true" tabindex="-1"></a>p4 <span class="ot">&lt;-</span></span>
<span id="cb920-23"><a href="god-spiked-the-integers.html#cb920-23" aria-hidden="true" tabindex="-1"></a>  prior <span class="sc">%&gt;%</span> </span>
<span id="cb920-24"><a href="god-spiked-the-integers.html#cb920-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">exp</span>(x), <span class="at">y =</span> <span class="fu">exp</span>(a <span class="sc">+</span> b <span class="sc">*</span> x), <span class="at">group =</span> i)) <span class="sc">+</span></span>
<span id="cb920-25"><a href="god-spiked-the-integers.html#cb920-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">size =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">4</span>, <span class="at">alpha =</span> <span class="dv">2</span><span class="sc">/</span><span class="dv">3</span>,</span>
<span id="cb920-26"><a href="god-spiked-the-integers.html#cb920-26" aria-hidden="true" tabindex="-1"></a>            <span class="at">color =</span> <span class="st">&quot;black&quot;</span>) <span class="sc">+</span></span>
<span id="cb920-27"><a href="god-spiked-the-integers.html#cb920-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="fu">expression</span>(beta<span class="sc">%~%</span><span class="fu">Normal</span>(<span class="dv">0</span><span class="sc">*</span><span class="st">&#39;, &#39;</span><span class="sc">*</span><span class="fl">0.2</span>)),</span>
<span id="cb920-28"><a href="god-spiked-the-integers.html#cb920-28" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">&quot;population&quot;</span>,</span>
<span id="cb920-29"><a href="god-spiked-the-integers.html#cb920-29" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;total tools&quot;</span>) <span class="sc">+</span></span>
<span id="cb920-30"><a href="god-spiked-the-integers.html#cb920-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">100</span>, <span class="dv">200000</span>),</span>
<span id="cb920-31"><a href="god-spiked-the-integers.html#cb920-31" aria-hidden="true" tabindex="-1"></a>                  <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">500</span>))</span>
<span id="cb920-32"><a href="god-spiked-the-integers.html#cb920-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb920-33"><a href="god-spiked-the-integers.html#cb920-33" aria-hidden="true" tabindex="-1"></a>p3<span class="sc">|</span>p4</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:unnamed-chunk-477"></span>
<img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-477-1.png" alt="人口をもとのスケールに戻すと..." width="672" />
<p class="caption">
図11.16: 人口をもとのスケールに戻すと…
</p>
</div>
<p>それでは、<span class="math inline">\(\alpha \sim Normal(3,0.5)\)</span>、<span class="math inline">\(\beta \sim Normal(0,0.2)\)</span>でモデルを回す。切片だけのモデルも一緒に回す。</p>
<div class="sourceCode" id="cb921"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb921-1"><a href="god-spiked-the-integers.html#cb921-1" aria-hidden="true" tabindex="-1"></a>b11<span class="fl">.9</span> <span class="ot">&lt;-</span> <span class="fu">brm</span>(</span>
<span id="cb921-2"><a href="god-spiked-the-integers.html#cb921-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> d4,</span>
<span id="cb921-3"><a href="god-spiked-the-integers.html#cb921-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> poisson,</span>
<span id="cb921-4"><a href="god-spiked-the-integers.html#cb921-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">formula =</span> total_tools <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb921-5"><a href="god-spiked-the-integers.html#cb921-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">prior =</span> <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">3</span>, <span class="fl">0.5</span>), <span class="at">class=</span>Intercept),</span>
<span id="cb921-6"><a href="god-spiked-the-integers.html#cb921-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed=</span><span class="dv">8</span>,</span>
<span id="cb921-7"><a href="god-spiked-the-integers.html#cb921-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">backend =</span> <span class="st">&quot;cmdstanr&quot;</span>,</span>
<span id="cb921-8"><a href="god-spiked-the-integers.html#cb921-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">file =</span> <span class="st">&quot;output/Chapter11/b11.9&quot;</span></span>
<span id="cb921-9"><a href="god-spiked-the-integers.html#cb921-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb921-10"><a href="god-spiked-the-integers.html#cb921-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb921-11"><a href="god-spiked-the-integers.html#cb921-11" aria-hidden="true" tabindex="-1"></a>b11<span class="fl">.10</span> <span class="ot">&lt;-</span> <span class="fu">brm</span>(</span>
<span id="cb921-12"><a href="god-spiked-the-integers.html#cb921-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> d4,</span>
<span id="cb921-13"><a href="god-spiked-the-integers.html#cb921-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> poisson,</span>
<span id="cb921-14"><a href="god-spiked-the-integers.html#cb921-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">formula =</span> <span class="fu">bf</span>(total_tools <span class="sc">~</span> <span class="dv">0</span> <span class="sc">+</span> a <span class="sc">+</span> b <span class="sc">*</span> P, </span>
<span id="cb921-15"><a href="god-spiked-the-integers.html#cb921-15" aria-hidden="true" tabindex="-1"></a>         a <span class="sc">~</span> <span class="dv">0</span> <span class="sc">+</span> cid, </span>
<span id="cb921-16"><a href="god-spiked-the-integers.html#cb921-16" aria-hidden="true" tabindex="-1"></a>         b <span class="sc">~</span> <span class="dv">0</span> <span class="sc">+</span> cid,</span>
<span id="cb921-17"><a href="god-spiked-the-integers.html#cb921-17" aria-hidden="true" tabindex="-1"></a>         <span class="at">nl =</span> <span class="cn">TRUE</span>),</span>
<span id="cb921-18"><a href="god-spiked-the-integers.html#cb921-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">3</span>, <span class="fl">0.5</span>), <span class="at">nlpar=</span>a),</span>
<span id="cb921-19"><a href="god-spiked-the-integers.html#cb921-19" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">0.2</span>), <span class="at">nlpar=</span>b)),</span>
<span id="cb921-20"><a href="god-spiked-the-integers.html#cb921-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed=</span><span class="dv">8</span>,</span>
<span id="cb921-21"><a href="god-spiked-the-integers.html#cb921-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">backend =</span> <span class="st">&quot;cmdstanr&quot;</span>,</span>
<span id="cb921-22"><a href="god-spiked-the-integers.html#cb921-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">file =</span> <span class="st">&quot;output/Chapter11/b11.10&quot;</span></span>
<span id="cb921-23"><a href="god-spiked-the-integers.html#cb921-23" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p>両モデルを比較してみる。どちらも<em>pareto-k</em>の警告が出ていることに注意。当然ながら<code>b11.10</code>のほうがPSISが小さい。</p>
<div class="sourceCode" id="cb922"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb922-1"><a href="god-spiked-the-integers.html#cb922-1" aria-hidden="true" tabindex="-1"></a>b11<span class="fl">.9</span> <span class="ot">&lt;-</span> <span class="fu">add_criterion</span>(b11<span class="fl">.9</span>, <span class="st">&quot;loo&quot;</span>)</span>
<span id="cb922-2"><a href="god-spiked-the-integers.html#cb922-2" aria-hidden="true" tabindex="-1"></a>b11<span class="fl">.10</span> <span class="ot">&lt;-</span> <span class="fu">add_criterion</span>(b11<span class="fl">.10</span>, <span class="st">&quot;loo&quot;</span>)</span>
<span id="cb922-3"><a href="god-spiked-the-integers.html#cb922-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb922-4"><a href="god-spiked-the-integers.html#cb922-4" aria-hidden="true" tabindex="-1"></a><span class="fu">loo_compare</span>(b11<span class="fl">.9</span>, b11<span class="fl">.10</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb922-5"><a href="god-spiked-the-integers.html#cb922-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="at">simplify =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<pre><code>##        elpd_diff se_diff elpd_loo se_elpd_loo p_loo se_p_loo looic se_looic
## b11.10   0.0       0.0   -42.4      6.6         6.7   2.6     84.8  13.1   
## b11.9  -28.7      17.1   -71.1     17.2         8.6   3.9    142.3  34.4</code></pre>
<p>モデル<code>b11.10</code>では1点で<em>pareto-k</em>が0.7以上になっているようだ。</p>
<div class="sourceCode" id="cb924"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb924-1"><a href="god-spiked-the-integers.html#cb924-1" aria-hidden="true" tabindex="-1"></a><span class="fu">loo</span>(b11<span class="fl">.10</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb924-2"><a href="god-spiked-the-integers.html#cb924-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pareto_k_table</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb924-3"><a href="god-spiked-the-integers.html#cb924-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="at">caption =</span> <span class="st">&quot;モデルb11.10のpareto-k診断結果&quot;</span>,</span>
<span id="cb924-4"><a href="god-spiked-the-integers.html#cb924-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">booktabs =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb924-5"><a href="god-spiked-the-integers.html#cb924-5" aria-hidden="true" tabindex="-1"></a>   <span class="fu">kable_styling</span>(<span class="at">latex_options =</span> <span class="st">&quot;striped&quot;</span>)</span></code></pre></div>
<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:unnamed-chunk-480">表11.13: </span>モデルb11.10のpareto-k診断結果
</caption>
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
Count
</th>
<th style="text-align:right;">
Proportion
</th>
<th style="text-align:right;">
Min. n_eff
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
(-Inf, 0.5]
</td>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
0.6
</td>
<td style="text-align:right;">
1335.03581
</td>
</tr>
<tr>
<td style="text-align:left;">
(0.5, 0.7]
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
0.3
</td>
<td style="text-align:right;">
163.06339
</td>
</tr>
<tr>
<td style="text-align:left;">
(0.7, 1]
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.1
</td>
<td style="text-align:right;">
52.69866
</td>
</tr>
<tr>
<td style="text-align:left;">
(1, Inf)
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.0
</td>
<td style="text-align:right;">
NA
</td>
</tr>
</tbody>
</table>
<p><br /></p>
<p>もっと詳しく見てみると、ハワイが大きな影響を与えていることが分かる。</p>
<div class="sourceCode" id="cb925"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb925-1"><a href="god-spiked-the-integers.html#cb925-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">culture =</span> d4<span class="sc">$</span>culture,</span>
<span id="cb925-2"><a href="god-spiked-the-integers.html#cb925-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">k       =</span> b11<span class="fl">.10</span><span class="sc">$</span>criteria<span class="sc">$</span>loo<span class="sc">$</span>diagnostics<span class="sc">$</span>pareto_k) <span class="sc">%&gt;%</span> </span>
<span id="cb925-3"><a href="god-spiked-the-integers.html#cb925-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(k)) <span class="sc">%&gt;%</span> </span>
<span id="cb925-4"><a href="god-spiked-the-integers.html#cb925-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_if</span>(is.double, round, <span class="at">digits =</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb925-5"><a href="god-spiked-the-integers.html#cb925-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="at">caption =</span> <span class="st">&quot;それぞれの地域のpareto-k&quot;</span>,</span>
<span id="cb925-6"><a href="god-spiked-the-integers.html#cb925-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">booktabs =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb925-7"><a href="god-spiked-the-integers.html#cb925-7" aria-hidden="true" tabindex="-1"></a>   <span class="fu">kable_styling</span>(<span class="at">latex_options =</span> <span class="st">&quot;striped&quot;</span>)</span></code></pre></div>
<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:unnamed-chunk-481">表11.14: </span>それぞれの地域のpareto-k
</caption>
<thead>
<tr>
<th style="text-align:left;">
culture
</th>
<th style="text-align:right;">
k
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Tonga
</td>
<td style="text-align:right;">
0.77
</td>
</tr>
<tr>
<td style="text-align:left;">
Hawaii
</td>
<td style="text-align:right;">
0.70
</td>
</tr>
<tr>
<td style="text-align:left;">
Yap
</td>
<td style="text-align:right;">
0.61
</td>
</tr>
<tr>
<td style="text-align:left;">
Trobriand
</td>
<td style="text-align:right;">
0.55
</td>
</tr>
<tr>
<td style="text-align:left;">
Malekula
</td>
<td style="text-align:right;">
0.49
</td>
</tr>
<tr>
<td style="text-align:left;">
Tikopia
</td>
<td style="text-align:right;">
0.37
</td>
</tr>
<tr>
<td style="text-align:left;">
Lau Fiji
</td>
<td style="text-align:right;">
0.31
</td>
</tr>
<tr>
<td style="text-align:left;">
Chuuk
</td>
<td style="text-align:right;">
0.27
</td>
</tr>
<tr>
<td style="text-align:left;">
Santa Cruz
</td>
<td style="text-align:right;">
0.26
</td>
</tr>
<tr>
<td style="text-align:left;">
Manus
</td>
<td style="text-align:right;">
0.16
</td>
</tr>
</tbody>
</table>
<p><br /></p>
<p>それでは、<em>pareto-k</em>の値と共に結果を図示する。</p>
<div class="sourceCode" id="cb926"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb926-1"><a href="god-spiked-the-integers.html#cb926-1" aria-hidden="true" tabindex="-1"></a>cultures <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Hawaii&quot;</span>, <span class="st">&quot;Tonga&quot;</span>, <span class="st">&quot;Trobriand&quot;</span>, <span class="st">&quot;Yap&quot;</span>)</span>
<span id="cb926-2"><a href="god-spiked-the-integers.html#cb926-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb926-3"><a href="god-spiked-the-integers.html#cb926-3" aria-hidden="true" tabindex="-1"></a>nd <span class="ot">&lt;-</span> <span class="fu">crossing</span>(<span class="at">cid =</span> <span class="fu">c</span>(<span class="st">&quot;low&quot;</span>,<span class="st">&quot;high&quot;</span>),</span>
<span id="cb926-4"><a href="god-spiked-the-integers.html#cb926-4" aria-hidden="true" tabindex="-1"></a>               <span class="at">P =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="fl">1.5</span>, <span class="fl">2.5</span>, <span class="at">length.out=</span><span class="dv">100</span>))</span>
<span id="cb926-5"><a href="god-spiked-the-integers.html#cb926-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb926-6"><a href="god-spiked-the-integers.html#cb926-6" aria-hidden="true" tabindex="-1"></a>fit11<span class="fl">.10</span> <span class="ot">&lt;-</span> <span class="fu">fitted</span>(b11<span class="fl">.10</span>, <span class="at">newdata =</span> nd) <span class="sc">%&gt;%</span> </span>
<span id="cb926-7"><a href="god-spiked-the-integers.html#cb926-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb926-8"><a href="god-spiked-the-integers.html#cb926-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(nd)</span>
<span id="cb926-9"><a href="god-spiked-the-integers.html#cb926-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb926-10"><a href="god-spiked-the-integers.html#cb926-10" aria-hidden="true" tabindex="-1"></a><span class="do">## 標準化したスケール</span></span>
<span id="cb926-11"><a href="god-spiked-the-integers.html#cb926-11" aria-hidden="true" tabindex="-1"></a>p5 <span class="ot">&lt;-</span> </span>
<span id="cb926-12"><a href="god-spiked-the-integers.html#cb926-12" aria-hidden="true" tabindex="-1"></a>  fit11<span class="fl">.10</span> <span class="sc">%&gt;%</span> </span>
<span id="cb926-13"><a href="god-spiked-the-integers.html#cb926-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> P, <span class="at">group =</span> cid))<span class="sc">+</span></span>
<span id="cb926-14"><a href="god-spiked-the-integers.html#cb926-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="fu">aes</span>(<span class="at">y =</span> Estimate, <span class="at">ymin =</span> Q2<span class="fl">.5</span>,</span>
<span id="cb926-15"><a href="god-spiked-the-integers.html#cb926-15" aria-hidden="true" tabindex="-1"></a>                  <span class="at">ymax =</span> Q97<span class="fl">.5</span>,</span>
<span id="cb926-16"><a href="god-spiked-the-integers.html#cb926-16" aria-hidden="true" tabindex="-1"></a>                  <span class="at">linetype =</span> cid,</span>
<span id="cb926-17"><a href="god-spiked-the-integers.html#cb926-17" aria-hidden="true" tabindex="-1"></a>                  <span class="at">fill =</span> cid,</span>
<span id="cb926-18"><a href="god-spiked-the-integers.html#cb926-18" aria-hidden="true" tabindex="-1"></a>                  <span class="at">color =</span> cid),</span>
<span id="cb926-19"><a href="god-spiked-the-integers.html#cb926-19" aria-hidden="true" tabindex="-1"></a>              <span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>,</span>
<span id="cb926-20"><a href="god-spiked-the-integers.html#cb926-20" aria-hidden="true" tabindex="-1"></a>              <span class="at">size=</span><span class="fl">1.5</span>, <span class="at">alpha=</span><span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>)<span class="sc">+</span></span>
<span id="cb926-21"><a href="god-spiked-the-integers.html#cb926-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> <span class="fu">bind_cols</span>(d4, b11<span class="fl">.10</span><span class="sc">$</span>criteria<span class="sc">$</span>loo<span class="sc">$</span>diagnostics),</span>
<span id="cb926-22"><a href="god-spiked-the-integers.html#cb926-22" aria-hidden="true" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">y =</span> total_tools, <span class="at">size =</span> pareto_k,</span>
<span id="cb926-23"><a href="god-spiked-the-integers.html#cb926-23" aria-hidden="true" tabindex="-1"></a>                 <span class="at">color =</span> cid),<span class="at">stroke =</span> <span class="fl">1.5</span>)<span class="sc">+</span></span>
<span id="cb926-24"><a href="god-spiked-the-integers.html#cb926-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_shape_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="dv">16</span>,<span class="dv">1</span>))<span class="sc">+</span></span>
<span id="cb926-25"><a href="god-spiked-the-integers.html#cb926-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;lightblue3&quot;</span>,<span class="st">&quot;orange3&quot;</span>))<span class="sc">+</span></span>
<span id="cb926-26"><a href="god-spiked-the-integers.html#cb926-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;lightblue&quot;</span>, <span class="st">&quot;orange&quot;</span>))<span class="sc">+</span></span>
<span id="cb926-27"><a href="god-spiked-the-integers.html#cb926-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text_repel</span>(<span class="at">data =</span> <span class="fu">bind_cols</span>(d4, b11<span class="fl">.10</span><span class="sc">$</span>criteria<span class="sc">$</span>loo<span class="sc">$</span>diagnostics) <span class="sc">%&gt;%</span> </span>
<span id="cb926-28"><a href="god-spiked-the-integers.html#cb926-28" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">filter</span>(culture <span class="sc">%in%</span> cultures) <span class="sc">%&gt;%</span> </span>
<span id="cb926-29"><a href="god-spiked-the-integers.html#cb926-29" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">mutate</span>(<span class="at">label =</span> <span class="fu">str_c</span>(culture, <span class="st">&quot; (&quot;</span>, <span class="fu">round</span>(pareto_k,<span class="dv">2</span>), <span class="st">&quot;)&quot;</span>)),</span>
<span id="cb926-30"><a href="god-spiked-the-integers.html#cb926-30" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">aes</span>(<span class="at">y =</span> total_tools, <span class="at">label =</span> label),</span>
<span id="cb926-31"><a href="god-spiked-the-integers.html#cb926-31" aria-hidden="true" tabindex="-1"></a>                  <span class="at">size=</span><span class="dv">3</span>, <span class="at">seed=</span><span class="dv">11</span>,<span class="at">color=</span><span class="st">&quot;black&quot;</span>)<span class="sc">+</span></span>
<span id="cb926-32"><a href="god-spiked-the-integers.html#cb926-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;log population (std)&quot;</span>,</span>
<span id="cb926-33"><a href="god-spiked-the-integers.html#cb926-33" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;total tools&quot;</span>) <span class="sc">+</span></span>
<span id="cb926-34"><a href="god-spiked-the-integers.html#cb926-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">range</span>(b11<span class="fl">.10</span><span class="sc">$</span>data<span class="sc">$</span>P),</span>
<span id="cb926-35"><a href="god-spiked-the-integers.html#cb926-35" aria-hidden="true" tabindex="-1"></a>                  <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">80</span>))<span class="sc">+</span></span>
<span id="cb926-36"><a href="god-spiked-the-integers.html#cb926-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>,</span>
<span id="cb926-37"><a href="god-spiked-the-integers.html#cb926-37" aria-hidden="true" tabindex="-1"></a>        <span class="at">aspect.ratio=</span><span class="dv">1</span>,</span>
<span id="cb926-38"><a href="god-spiked-the-integers.html#cb926-38" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">family =</span><span class="st">&quot;Japan1GothicBBB&quot;</span>))</span>
<span id="cb926-39"><a href="god-spiked-the-integers.html#cb926-39" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb926-40"><a href="god-spiked-the-integers.html#cb926-40" aria-hidden="true" tabindex="-1"></a><span class="do">## もともとのスケールに戻す。  </span></span>
<span id="cb926-41"><a href="god-spiked-the-integers.html#cb926-41" aria-hidden="true" tabindex="-1"></a>p6 <span class="ot">&lt;-</span> fit11<span class="fl">.10</span> <span class="sc">%&gt;%</span> </span>
<span id="cb926-42"><a href="god-spiked-the-integers.html#cb926-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">population =</span> <span class="fu">exp</span>(P<span class="sc">*</span><span class="fu">sd</span>(<span class="fu">log</span>(d4<span class="sc">$</span>population))<span class="sc">+</span><span class="fu">mean</span>(<span class="fu">log</span>(d4<span class="sc">$</span>population)))) <span class="sc">%&gt;%</span> </span>
<span id="cb926-43"><a href="god-spiked-the-integers.html#cb926-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> population, <span class="at">group =</span> cid))<span class="sc">+</span></span>
<span id="cb926-44"><a href="god-spiked-the-integers.html#cb926-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="fu">aes</span>(<span class="at">y =</span> Estimate, <span class="at">ymin =</span> Q2<span class="fl">.5</span>,</span>
<span id="cb926-45"><a href="god-spiked-the-integers.html#cb926-45" aria-hidden="true" tabindex="-1"></a>                  <span class="at">ymax =</span> Q97<span class="fl">.5</span>,</span>
<span id="cb926-46"><a href="god-spiked-the-integers.html#cb926-46" aria-hidden="true" tabindex="-1"></a>                  <span class="at">linetype =</span> cid,</span>
<span id="cb926-47"><a href="god-spiked-the-integers.html#cb926-47" aria-hidden="true" tabindex="-1"></a>                  <span class="at">fill =</span> cid,</span>
<span id="cb926-48"><a href="god-spiked-the-integers.html#cb926-48" aria-hidden="true" tabindex="-1"></a>                  <span class="at">color =</span> cid),</span>
<span id="cb926-49"><a href="god-spiked-the-integers.html#cb926-49" aria-hidden="true" tabindex="-1"></a>              <span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>,</span>
<span id="cb926-50"><a href="god-spiked-the-integers.html#cb926-50" aria-hidden="true" tabindex="-1"></a>              <span class="at">size=</span><span class="fl">1.5</span>, <span class="at">alpha=</span><span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>)<span class="sc">+</span></span>
<span id="cb926-51"><a href="god-spiked-the-integers.html#cb926-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> <span class="fu">bind_cols</span>(d4, b11<span class="fl">.10</span><span class="sc">$</span>criteria<span class="sc">$</span>loo<span class="sc">$</span>diagnostics),</span>
<span id="cb926-52"><a href="god-spiked-the-integers.html#cb926-52" aria-hidden="true" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">y =</span> total_tools, <span class="at">size =</span> pareto_k,</span>
<span id="cb926-53"><a href="god-spiked-the-integers.html#cb926-53" aria-hidden="true" tabindex="-1"></a>                 <span class="at">color =</span> cid),<span class="at">stroke =</span> <span class="fl">1.5</span>,<span class="at">alpha=</span><span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>)<span class="sc">+</span></span>
<span id="cb926-54"><a href="god-spiked-the-integers.html#cb926-54" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_shape_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="dv">16</span>,<span class="dv">1</span>))<span class="sc">+</span></span>
<span id="cb926-55"><a href="god-spiked-the-integers.html#cb926-55" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;lightblue3&quot;</span>,<span class="st">&quot;orange3&quot;</span>))<span class="sc">+</span></span>
<span id="cb926-56"><a href="god-spiked-the-integers.html#cb926-56" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;lightblue&quot;</span>, <span class="st">&quot;orange&quot;</span>))<span class="sc">+</span></span>
<span id="cb926-57"><a href="god-spiked-the-integers.html#cb926-57" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">250000</span>,<span class="at">by=</span><span class="dv">50000</span>))<span class="sc">+</span></span>
<span id="cb926-58"><a href="god-spiked-the-integers.html#cb926-58" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">270000</span>),</span>
<span id="cb926-59"><a href="god-spiked-the-integers.html#cb926-59" aria-hidden="true" tabindex="-1"></a>                  <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">80</span>))<span class="sc">+</span></span>
<span id="cb926-60"><a href="god-spiked-the-integers.html#cb926-60" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>,</span>
<span id="cb926-61"><a href="god-spiked-the-integers.html#cb926-61" aria-hidden="true" tabindex="-1"></a>        <span class="at">aspect.ratio=</span><span class="dv">1</span>,</span>
<span id="cb926-62"><a href="god-spiked-the-integers.html#cb926-62" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">family =</span><span class="st">&quot;Japan1GothicBBB&quot;</span>))</span>
<span id="cb926-63"><a href="god-spiked-the-integers.html#cb926-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb926-64"><a href="god-spiked-the-integers.html#cb926-64" aria-hidden="true" tabindex="-1"></a>p5<span class="sc">+</span>p6</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:unnamed-chunk-482"></span>
<img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-482-1.png" alt="オセアニア諸国の道具数に関するモデルb11.10の事後分布を用いた予測。水色は周辺諸国との交流頻度が高かった国を、オレンジは低かった国を表す。また、点の大きさはpareto-kの値を表す。" width="672" />
<p class="caption">
図11.17: オセアニア諸国の道具数に関するモデルb11.10の事後分布を用いた予測。水色は周辺諸国との交流頻度が高かった国を、オレンジは低かった国を表す。また、点の大きさはpareto-kの値を表す。
</p>
</div>
<p>このモデルの予測値に従うと、他国との接触が多かった国は人口が多くなると、接触が少なかった国よりも道具数が少ないことになる。しかし、これはおかしな現象である。これが生じるのは、モデルが切片を自由なパラメータとしたからである。本来ならば人口が0ならば道具数も0でなければいけないが、<code>b11.10</code>はそのような制約を設けていない。<br />
<br /></p>
<p>それでは、改良したモデルを考えてみよう。人口が増えるほど道具数も増えるが、その変化量は徐々に減っていくと考える。また、道具の数が多いほど新たに発明される道具の数も減ると考えられる。そこで、単位時間当たりの道具数の変化を以下のように定義する。なお、<span class="math inline">\(P\)</span>は人口を、<span class="math inline">\(T\)</span>は道具数を表す。</p>
<p><br /></p>
<p><span class="math display">\[
\Delta T = \alpha P^B - \gamma T
\]</span>
<br /></p>
<p><span class="math inline">\(\Delta T\)</span>が0になるとき、<span class="math inline">\(T = \frac{\alpha P^\beta}{\gamma}\)</span>であることを利用し、以下のモデルを考える。
ここで、<span class="math inline">\(\alpha\)</span>と<span class="math inline">\(\beta\)</span>はCIDによって変化すると考える。
また、事後分布が正に限定されるよう、<span class="math inline">\(\alpha\)</span>については指数をとった。
<br /></p>
<p><span class="math display">\[
\begin{aligned}
  T_{i} &amp;\sim Poisson(\lambda_{i})\\
  \lambda_{i} &amp;= exp(\alpha) P_{i}^\beta/\gamma
\end{aligned}
\]</span>
<br /></p>
<p><code>brms</code>で実装する。</p>
<div class="sourceCode" id="cb927"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb927-1"><a href="god-spiked-the-integers.html#cb927-1" aria-hidden="true" tabindex="-1"></a>b11<span class="fl">.11</span> <span class="ot">&lt;-</span></span>
<span id="cb927-2"><a href="god-spiked-the-integers.html#cb927-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">brm</span>(<span class="at">data =</span> d4, </span>
<span id="cb927-3"><a href="god-spiked-the-integers.html#cb927-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> <span class="fu">poisson</span>(<span class="at">link =</span> <span class="st">&quot;identity&quot;</span>),</span>
<span id="cb927-4"><a href="god-spiked-the-integers.html#cb927-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">bf</span>(total_tools <span class="sc">~</span> <span class="fu">exp</span>(a) <span class="sc">*</span> population<span class="sc">^</span>b <span class="sc">/</span> g,</span>
<span id="cb927-5"><a href="god-spiked-the-integers.html#cb927-5" aria-hidden="true" tabindex="-1"></a>         a <span class="sc">+</span> b <span class="sc">~</span> <span class="dv">0</span> <span class="sc">+</span> cid,</span>
<span id="cb927-6"><a href="god-spiked-the-integers.html#cb927-6" aria-hidden="true" tabindex="-1"></a>         g <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb927-7"><a href="god-spiked-the-integers.html#cb927-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">nl =</span> <span class="cn">TRUE</span>),</span>
<span id="cb927-8"><a href="god-spiked-the-integers.html#cb927-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">1</span>, <span class="dv">1</span>), <span class="at">nlpar =</span> a),</span>
<span id="cb927-9"><a href="god-spiked-the-integers.html#cb927-9" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>), <span class="at">nlpar =</span> b, <span class="at">lb =</span> <span class="dv">0</span>),</span>
<span id="cb927-10"><a href="god-spiked-the-integers.html#cb927-10" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>), <span class="at">nlpar =</span> g, <span class="at">lb =</span> <span class="dv">0</span>)),</span>
<span id="cb927-11"><a href="god-spiked-the-integers.html#cb927-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>, <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb927-12"><a href="god-spiked-the-integers.html#cb927-12" aria-hidden="true" tabindex="-1"></a>      <span class="at">seed =</span> <span class="dv">11</span>,</span>
<span id="cb927-13"><a href="god-spiked-the-integers.html#cb927-13" aria-hidden="true" tabindex="-1"></a>      <span class="at">control =</span> <span class="fu">list</span>(<span class="at">adapt_delta =</span> .<span class="dv">95</span>),</span>
<span id="cb927-14"><a href="god-spiked-the-integers.html#cb927-14" aria-hidden="true" tabindex="-1"></a>      <span class="at">backend =</span> <span class="st">&quot;cmdstanr&quot;</span>,</span>
<span id="cb927-15"><a href="god-spiked-the-integers.html#cb927-15" aria-hidden="true" tabindex="-1"></a>      <span class="at">file =</span> <span class="st">&quot;output/Chapter11/b11.11&quot;</span>) </span></code></pre></div>
<p>結果とPSISを確認する。先ほどのモデルと大きくは変わらないがより妥当なモデルになっている。</p>
<div class="sourceCode" id="cb928"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb928-1"><a href="god-spiked-the-integers.html#cb928-1" aria-hidden="true" tabindex="-1"></a>b11<span class="fl">.11</span> <span class="ot">&lt;-</span> <span class="fu">add_criterion</span>(b11<span class="fl">.11</span>, <span class="at">criterion =</span> <span class="st">&quot;loo&quot;</span>, <span class="at">moment_match =</span> T)</span>
<span id="cb928-2"><a href="god-spiked-the-integers.html#cb928-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb928-3"><a href="god-spiked-the-integers.html#cb928-3" aria-hidden="true" tabindex="-1"></a><span class="fu">loo_compare</span>(b11<span class="fl">.10</span>, b11<span class="fl">.11</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb928-4"><a href="god-spiked-the-integers.html#cb928-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="at">simplify =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<pre><code>##        elpd_diff se_diff elpd_loo se_elpd_loo p_loo se_p_loo looic se_looic
## b11.11   0.0       0.0   -40.7      6.0         5.3   1.9     81.3  11.9   
## b11.10  -1.7       2.8   -42.4      6.6         6.7   2.6     84.8  13.1</code></pre>
<p>最後に結果を図示する。今度は(0,0)を通っていることに加えて、逆転は生じていない。</p>
<div class="sourceCode" id="cb930"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb930-1"><a href="god-spiked-the-integers.html#cb930-1" aria-hidden="true" tabindex="-1"></a>text <span class="ot">&lt;-</span></span>
<span id="cb930-2"><a href="god-spiked-the-integers.html#cb930-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(d4, cid) <span class="sc">%&gt;%</span> </span>
<span id="cb930-3"><a href="god-spiked-the-integers.html#cb930-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">population  =</span> <span class="fu">c</span>(<span class="dv">210000</span>, <span class="dv">72500</span>),</span>
<span id="cb930-4"><a href="god-spiked-the-integers.html#cb930-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">total_tools =</span> <span class="fu">c</span>(<span class="dv">59</span>, <span class="dv">68</span>),</span>
<span id="cb930-5"><a href="god-spiked-the-integers.html#cb930-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">label       =</span> <span class="fu">str_c</span>(cid, <span class="st">&quot; contact&quot;</span>))</span>
<span id="cb930-6"><a href="god-spiked-the-integers.html#cb930-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb930-7"><a href="god-spiked-the-integers.html#cb930-7" aria-hidden="true" tabindex="-1"></a><span class="co"># redifine the new data</span></span>
<span id="cb930-8"><a href="god-spiked-the-integers.html#cb930-8" aria-hidden="true" tabindex="-1"></a>nd <span class="ot">&lt;-</span></span>
<span id="cb930-9"><a href="god-spiked-the-integers.html#cb930-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(d4, cid) <span class="sc">%&gt;%</span> </span>
<span id="cb930-10"><a href="god-spiked-the-integers.html#cb930-10" aria-hidden="true" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">expand</span>(cid, </span>
<span id="cb930-11"><a href="god-spiked-the-integers.html#cb930-11" aria-hidden="true" tabindex="-1"></a>         <span class="at">population =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">0</span>, <span class="at">to =</span> <span class="dv">300000</span>, <span class="at">length.out =</span> <span class="dv">100</span>))</span>
<span id="cb930-12"><a href="god-spiked-the-integers.html#cb930-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb930-13"><a href="god-spiked-the-integers.html#cb930-13" aria-hidden="true" tabindex="-1"></a><span class="co"># compute the poster predictions for lambda</span></span>
<span id="cb930-14"><a href="god-spiked-the-integers.html#cb930-14" aria-hidden="true" tabindex="-1"></a><span class="fu">fitted</span>(b11<span class="fl">.11</span>,</span>
<span id="cb930-15"><a href="god-spiked-the-integers.html#cb930-15" aria-hidden="true" tabindex="-1"></a>       <span class="at">newdata =</span> nd,</span>
<span id="cb930-16"><a href="god-spiked-the-integers.html#cb930-16" aria-hidden="true" tabindex="-1"></a>       <span class="at">probs =</span> <span class="fu">c</span>(.<span class="dv">055</span>, .<span class="dv">945</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb930-17"><a href="god-spiked-the-integers.html#cb930-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb930-18"><a href="god-spiked-the-integers.html#cb930-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(nd) <span class="sc">%&gt;%</span></span>
<span id="cb930-19"><a href="god-spiked-the-integers.html#cb930-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> population, <span class="at">group =</span> cid))<span class="sc">+</span></span>
<span id="cb930-20"><a href="god-spiked-the-integers.html#cb930-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="fu">aes</span>(<span class="at">y =</span> Estimate, <span class="at">ymin =</span> Q5<span class="fl">.5</span>,</span>
<span id="cb930-21"><a href="god-spiked-the-integers.html#cb930-21" aria-hidden="true" tabindex="-1"></a>                  <span class="at">ymax =</span> Q94<span class="fl">.5</span>,</span>
<span id="cb930-22"><a href="god-spiked-the-integers.html#cb930-22" aria-hidden="true" tabindex="-1"></a>                  <span class="at">linetype =</span> cid,</span>
<span id="cb930-23"><a href="god-spiked-the-integers.html#cb930-23" aria-hidden="true" tabindex="-1"></a>                  <span class="at">fill =</span> cid,</span>
<span id="cb930-24"><a href="god-spiked-the-integers.html#cb930-24" aria-hidden="true" tabindex="-1"></a>                  <span class="at">color =</span> cid),</span>
<span id="cb930-25"><a href="god-spiked-the-integers.html#cb930-25" aria-hidden="true" tabindex="-1"></a>              <span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>,</span>
<span id="cb930-26"><a href="god-spiked-the-integers.html#cb930-26" aria-hidden="true" tabindex="-1"></a>              <span class="at">size=</span><span class="fl">1.5</span>, <span class="at">alpha=</span><span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>)<span class="sc">+</span></span>
<span id="cb930-27"><a href="god-spiked-the-integers.html#cb930-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> <span class="fu">bind_cols</span>(d4, b11<span class="fl">.11</span><span class="sc">$</span>criteria<span class="sc">$</span>loo<span class="sc">$</span>diagnostics),</span>
<span id="cb930-28"><a href="god-spiked-the-integers.html#cb930-28" aria-hidden="true" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">y =</span> total_tools, <span class="at">size =</span> pareto_k,</span>
<span id="cb930-29"><a href="god-spiked-the-integers.html#cb930-29" aria-hidden="true" tabindex="-1"></a>                 <span class="at">color =</span> cid),<span class="at">stroke =</span> <span class="fl">1.5</span>,</span>
<span id="cb930-30"><a href="god-spiked-the-integers.html#cb930-30" aria-hidden="true" tabindex="-1"></a>             <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>)<span class="sc">+</span></span>
<span id="cb930-31"><a href="god-spiked-the-integers.html#cb930-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_shape_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="dv">16</span>,<span class="dv">1</span>))<span class="sc">+</span></span>
<span id="cb930-32"><a href="god-spiked-the-integers.html#cb930-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;lightblue3&quot;</span>,<span class="st">&quot;orange3&quot;</span>))<span class="sc">+</span></span>
<span id="cb930-33"><a href="god-spiked-the-integers.html#cb930-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;lightblue&quot;</span>, <span class="st">&quot;orange&quot;</span>))<span class="sc">+</span></span>
<span id="cb930-34"><a href="god-spiked-the-integers.html#cb930-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">250000</span>,<span class="at">by=</span><span class="dv">50000</span>))<span class="sc">+</span></span>
<span id="cb930-35"><a href="god-spiked-the-integers.html#cb930-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">250000</span>),</span>
<span id="cb930-36"><a href="god-spiked-the-integers.html#cb930-36" aria-hidden="true" tabindex="-1"></a>                  <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">80</span>))<span class="sc">+</span></span>
<span id="cb930-37"><a href="god-spiked-the-integers.html#cb930-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>,</span>
<span id="cb930-38"><a href="god-spiked-the-integers.html#cb930-38" aria-hidden="true" tabindex="-1"></a>        <span class="at">aspect.ratio=</span><span class="dv">1</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:unnamed-chunk-485"></span>
<img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-485-1.png" alt="オセアニア諸国の道具数に関するモデルb11.11の事後分布を用いた予測。水色は周辺諸国との交流頻度が高かった国を、オレンジは低かった国を表す。また、点の大きさはpareto-kの値を表す。" width="672" />
<p class="caption">
図11.18: オセアニア諸国の道具数に関するモデルb11.11の事後分布を用いた予測。水色は周辺諸国との交流頻度が高かった国を、オレンジは低かった国を表す。また、点の大きさはpareto-kの値を表す。
</p>
</div>
</div>
<div id="negative-binomial-gamma-poisson-models." class="section level3 hasAnchor" number="11.3.2">
<h3><span class="header-section-number">11.3.2</span> Negative binomial (Gamma-Poisson) models.<a href="god-spiked-the-integers.html#negative-binomial-gamma-poisson-models." class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>ポワソン回帰では、ときどき過分散が生じることがありうる。このとき、負の二項分布(またはガンマポワソン分布)を用いるとうまくいくことがある。負の二項分布は異なるポワソン分布を混合したものである。</p>
</div>
<div id="example-exposure-and-the-offset" class="section level3 hasAnchor" number="11.3.3">
<h3><span class="header-section-number">11.3.3</span> Example: Exposure and the offset<a href="god-spiked-the-integers.html#example-exposure-and-the-offset" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>オフセット項を用いることで割合データを扱うことができる。<br />
例として、<span class="math inline">\(\lambda\)</span>がある事象の回数<span class="math inline">\(\mu\)</span>を時間または距離<span class="math inline">\(\tau\)</span>で割った値だとする。
<br /></p>
<p><span class="math display">\[
\begin{aligned}
  y_{i} &amp;\sim Poisoon(\lambda_{i})\\
  log \lambda_{i} &amp;= log \frac{\mu_{i}}{\tau_{i}}= \alpha + \beta x_{i}
\end{aligned}
\]</span>
<br /></p>
<p>このとき、以下のように書くことができる。
<br /></p>
<p><span class="math display">\[
\begin{aligned}
  y_{i} &amp;\sim Poisoon(\mu_{i})\\
  log \mu_{i} &amp;= log \tau_{i} + \alpha + \beta x_{i}
\end{aligned}
\]</span>
<br /></p>
<p>もちろん<span class="math inline">\(log\tau_{i}\)</span>にパラメータを書けることもできる。
教科書のシミュレーションデータに対してこのモデルを回してみる。2つの修道院があり、それぞれ何かの製品を作っているのだが、修道院Aでは1日当たりの製造個数を記録している一方で、修道院Bでは1週間当たりの製造個数しか記録していない。このとき、オフセット項を用いることでそれぞれの修道院の製造効率に違いがあるかを検討する。</p>
<div class="sourceCode" id="cb931"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb931-1"><a href="god-spiked-the-integers.html#cb931-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">11</span>)</span>
<span id="cb931-2"><a href="god-spiked-the-integers.html#cb931-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb931-3"><a href="god-spiked-the-integers.html#cb931-3" aria-hidden="true" tabindex="-1"></a><span class="do">## 修道院A架空データ</span></span>
<span id="cb931-4"><a href="god-spiked-the-integers.html#cb931-4" aria-hidden="true" tabindex="-1"></a>num_days <span class="ot">&lt;-</span> <span class="dv">70</span></span>
<span id="cb931-5"><a href="god-spiked-the-integers.html#cb931-5" aria-hidden="true" tabindex="-1"></a>y        <span class="ot">&lt;-</span> <span class="fu">rpois</span>(num_days, <span class="at">lambda =</span> <span class="fl">1.5</span>)</span>
<span id="cb931-6"><a href="god-spiked-the-integers.html#cb931-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb931-7"><a href="god-spiked-the-integers.html#cb931-7" aria-hidden="true" tabindex="-1"></a><span class="do">##修道院B架空データ</span></span>
<span id="cb931-8"><a href="god-spiked-the-integers.html#cb931-8" aria-hidden="true" tabindex="-1"></a>num_weeks <span class="ot">&lt;-</span> <span class="dv">10</span></span>
<span id="cb931-9"><a href="god-spiked-the-integers.html#cb931-9" aria-hidden="true" tabindex="-1"></a>y_new     <span class="ot">&lt;-</span> <span class="fu">rpois</span>(num_weeks, <span class="at">lambda =</span> <span class="fl">0.5</span> <span class="sc">*</span> <span class="dv">7</span>)</span>
<span id="cb931-10"><a href="god-spiked-the-integers.html#cb931-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb931-11"><a href="god-spiked-the-integers.html#cb931-11" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb931-12"><a href="god-spiked-the-integers.html#cb931-12" aria-hidden="true" tabindex="-1"></a>  d5 <span class="ot">&lt;-</span> </span>
<span id="cb931-13"><a href="god-spiked-the-integers.html#cb931-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="at">y  =</span> <span class="fu">c</span>(y, y_new), </span>
<span id="cb931-14"><a href="god-spiked-the-integers.html#cb931-14" aria-hidden="true" tabindex="-1"></a>         <span class="at">days=</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">7</span>), <span class="at">times =</span> <span class="fu">c</span>(num_days, num_weeks)),</span>
<span id="cb931-15"><a href="god-spiked-the-integers.html#cb931-15" aria-hidden="true" tabindex="-1"></a>         <span class="at">monastery =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">&quot;A&quot;</span>,<span class="st">&quot;B&quot;</span>), </span>
<span id="cb931-16"><a href="god-spiked-the-integers.html#cb931-16" aria-hidden="true" tabindex="-1"></a>                         <span class="at">times =</span> <span class="fu">c</span>(num_days, num_weeks)))<span class="sc">%&gt;%</span></span>
<span id="cb931-17"><a href="god-spiked-the-integers.html#cb931-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">log_days =</span> <span class="fu">log</span>(days))</span>
<span id="cb931-18"><a href="god-spiked-the-integers.html#cb931-18" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<pre><code>## # A tibble: 80 × 4
##        y  days monastery log_days
##    &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;        &lt;dbl&gt;
##  1     1     1 A                0
##  2     0     1 A                0
##  3     1     1 A                0
##  4     0     1 A                0
##  5     0     1 A                0
##  6     4     1 A                0
##  7     0     1 A                0
##  8     1     1 A                0
##  9     3     1 A                0
## 10     0     1 A                0
## # … with 70 more rows</code></pre>
<p>モデルを回してみる。</p>
<div class="sourceCode" id="cb933"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb933-1"><a href="god-spiked-the-integers.html#cb933-1" aria-hidden="true" tabindex="-1"></a>b11<span class="fl">.12</span> <span class="ot">&lt;-</span></span>
<span id="cb933-2"><a href="god-spiked-the-integers.html#cb933-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">brm</span>(<span class="at">data =</span> d5, </span>
<span id="cb933-3"><a href="god-spiked-the-integers.html#cb933-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> poisson,</span>
<span id="cb933-4"><a href="god-spiked-the-integers.html#cb933-4" aria-hidden="true" tabindex="-1"></a>      y <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> <span class="fu">offset</span>(log_days) <span class="sc">+</span> monastery,</span>
<span id="cb933-5"><a href="god-spiked-the-integers.html#cb933-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">class =</span> Intercept),</span>
<span id="cb933-6"><a href="god-spiked-the-integers.html#cb933-6" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">class =</span> b)),</span>
<span id="cb933-7"><a href="god-spiked-the-integers.html#cb933-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>, <span class="at">cores =</span> <span class="dv">4</span>, <span class="at">chains =</span> <span class="dv">4</span>,</span>
<span id="cb933-8"><a href="god-spiked-the-integers.html#cb933-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">seed =</span> <span class="dv">11</span>,</span>
<span id="cb933-9"><a href="god-spiked-the-integers.html#cb933-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">backend =</span> <span class="st">&quot;cmdstanr&quot;</span>,</span>
<span id="cb933-10"><a href="god-spiked-the-integers.html#cb933-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">file =</span> <span class="st">&quot;output/Chapter11/b11.12&quot;</span>)</span></code></pre></div>
<p>それぞれ修道院Aと修道院Bの製造速度を比較すると…。
真の<span class="math inline">\(\lambda\)</span>(1.5と0.5)とは違っているものの、推定はできた。</p>
<div class="sourceCode" id="cb934"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb934-1"><a href="god-spiked-the-integers.html#cb934-1" aria-hidden="true" tabindex="-1"></a><span class="fu">posterior_samples</span>(b11<span class="fl">.12</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb934-2"><a href="god-spiked-the-integers.html#cb934-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">lambda_A =</span> <span class="fu">exp</span>(b_Intercept),</span>
<span id="cb934-3"><a href="god-spiked-the-integers.html#cb934-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">lambda_B =</span> <span class="fu">exp</span>(b_Intercept <span class="sc">+</span> b_monasteryB)) <span class="sc">%&gt;%</span> </span>
<span id="cb934-4"><a href="god-spiked-the-integers.html#cb934-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">contains</span>(<span class="st">&quot;lambda&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb934-5"><a href="god-spiked-the-integers.html#cb934-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(name) <span class="sc">%&gt;%</span> </span>
<span id="cb934-6"><a href="god-spiked-the-integers.html#cb934-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mean_qi</span>(value) <span class="sc">%&gt;%</span> </span>
<span id="cb934-7"><a href="god-spiked-the-integers.html#cb934-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="at">digits=</span><span class="dv">2</span>,<span class="at">booktabs =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb934-8"><a href="god-spiked-the-integers.html#cb934-8" aria-hidden="true" tabindex="-1"></a>   <span class="fu">kable_styling</span>(<span class="at">latex_options =</span> <span class="st">&quot;striped&quot;</span>)</span></code></pre></div>
<table class="table" style="margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;">
name
</th>
<th style="text-align:right;">
value
</th>
<th style="text-align:right;">
.lower
</th>
<th style="text-align:right;">
.upper
</th>
<th style="text-align:right;">
.width
</th>
<th style="text-align:left;">
.point
</th>
<th style="text-align:left;">
.interval
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
lambda_A
</td>
<td style="text-align:right;">
1.08
</td>
<td style="text-align:right;">
0.84
</td>
<td style="text-align:right;">
1.32
</td>
<td style="text-align:right;">
0.95
</td>
<td style="text-align:left;">
mean
</td>
<td style="text-align:left;">
qi
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda_B
</td>
<td style="text-align:right;">
0.47
</td>
<td style="text-align:right;">
0.32
</td>
<td style="text-align:right;">
0.64
</td>
<td style="text-align:right;">
0.95
</td>
<td style="text-align:left;">
mean
</td>
<td style="text-align:left;">
qi
</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="multinomial-and-categorical-models" class="section level2 hasAnchor" number="11.4">
<h2><span class="header-section-number">11.4</span> Multinomial and categorical models<a href="god-spiked-the-integers.html#multinomial-and-categorical-models" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>3つ以上の事象が起きうるとき、最大エントロピー分布は<strong>多項分布</strong>になる。多項分布のリンク関数には<strong>ソフトマックス関数</strong>(長さKのベクトルを各要素が(0,1)の範囲をとり、合計1で長さKのベクトルに変換する関数)を使用することが多い。ソフトマックス関数は以下の式の通り。なお、<span class="math inline">\(s_{1} \ldots s_{K}\)</span>は各事象に対応する長さ<span class="math inline">\(k\)</span>のベクトル<span class="math inline">\(scores\)</span>を表す。<br />
ある事象Kが生じる確率は、
<br /></p>
<p><span class="math display">\[
Pr(k|s_{1},s_{2},s_{3},\ldots, s_{K}) = \frac{exp(s_{k})}{\sum_{i=1}^K exp(s_{i})}
\]</span>
<br /></p>
<p>多項回帰では、K種類の事象があるとき、K-1個の線形モデルを作成する。それぞれのモデルで用いる説明変数やパラメータは必ずしも同じでなくてよい。<br />
多項ロジスティック回帰には大きく分けて二つの場合がある。</p>
<div id="predictors-matched-to-outcomes" class="section level3 hasAnchor" number="11.4.1">
<h3><span class="header-section-number">11.4.1</span> Predictors matched to outcomes<a href="god-spiked-the-integers.html#predictors-matched-to-outcomes" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>若者が職業を選択する際に期待される収入が影響しているかを調べたい。このとき、それぞれのモデルで共通のパラメータ<span class="math inline">\(\beta_{INCOME}\)</span>が用いられるが、それぞれのモデルで異なる説明変数の値(ここでは収入)がパラメータにかけられる。<br />
ここでは、3つの職業の選択に関するシミュレーションデータを用いる。ここでは、収入に0.5をかけた値をscoreとし、scoreの値をsoftmax関数に与えることによって各カテゴリーの職業が選ばれる確率が得られるものとする。職業ごとに収入は決まっている。</p>
<div class="sourceCode" id="cb935"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb935-1"><a href="god-spiked-the-integers.html#cb935-1" aria-hidden="true" tabindex="-1"></a>n      <span class="ot">&lt;-</span> <span class="dv">500</span>           <span class="co"># number of individuals</span></span>
<span id="cb935-2"><a href="god-spiked-the-integers.html#cb935-2" aria-hidden="true" tabindex="-1"></a>income <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">5</span>)    <span class="co"># expected income of each career</span></span>
<span id="cb935-3"><a href="god-spiked-the-integers.html#cb935-3" aria-hidden="true" tabindex="-1"></a>score  <span class="ot">&lt;-</span> <span class="fl">0.5</span> <span class="sc">*</span> income  <span class="co"># scores for each career, based on income</span></span>
<span id="cb935-4"><a href="god-spiked-the-integers.html#cb935-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb935-5"><a href="god-spiked-the-integers.html#cb935-5" aria-hidden="true" tabindex="-1"></a><span class="co"># next line converts scores to probabilities</span></span>
<span id="cb935-6"><a href="god-spiked-the-integers.html#cb935-6" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">softmax</span>(score[<span class="dv">1</span>], score[<span class="dv">2</span>], score[<span class="dv">3</span>])</span>
<span id="cb935-7"><a href="god-spiked-the-integers.html#cb935-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb935-8"><a href="god-spiked-the-integers.html#cb935-8" aria-hidden="true" tabindex="-1"></a><span class="co"># now simulate choice</span></span>
<span id="cb935-9"><a href="god-spiked-the-integers.html#cb935-9" aria-hidden="true" tabindex="-1"></a><span class="co"># outcome career holds event type values, not counts</span></span>
<span id="cb935-10"><a href="god-spiked-the-integers.html#cb935-10" aria-hidden="true" tabindex="-1"></a>career <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">NA</span>, n)  <span class="co"># empty vector of choices for each individual</span></span>
<span id="cb935-11"><a href="god-spiked-the-integers.html#cb935-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb935-12"><a href="god-spiked-the-integers.html#cb935-12" aria-hidden="true" tabindex="-1"></a><span class="co"># sample chosen career for each individual</span></span>
<span id="cb935-13"><a href="god-spiked-the-integers.html#cb935-13" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">34302</span>)</span>
<span id="cb935-14"><a href="god-spiked-the-integers.html#cb935-14" aria-hidden="true" tabindex="-1"></a><span class="co"># sample chosen career for each individual</span></span>
<span id="cb935-15"><a href="god-spiked-the-integers.html#cb935-15" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n) career[i] <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, <span class="at">size =</span> <span class="dv">1</span>, <span class="at">prob =</span> p)</span></code></pre></div>
<p>シミュレーションによって各職業が選ばれた回数は図<a href="god-spiked-the-integers.html#fig:d6">11.19</a>の通り。</p>
<div class="sourceCode" id="cb936"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb936-1"><a href="god-spiked-the-integers.html#cb936-1" aria-hidden="true" tabindex="-1"></a>d6 <span class="ot">&lt;-</span> </span>
<span id="cb936-2"><a href="god-spiked-the-integers.html#cb936-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="at">career =</span> career) <span class="sc">%&gt;%</span> </span>
<span id="cb936-3"><a href="god-spiked-the-integers.html#cb936-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">career_income =</span> <span class="fu">ifelse</span>(career <span class="sc">==</span><span class="dv">3</span>,<span class="dv">5</span>,career))</span>
<span id="cb936-4"><a href="god-spiked-the-integers.html#cb936-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb936-5"><a href="god-spiked-the-integers.html#cb936-5" aria-hidden="true" tabindex="-1"></a>d6 <span class="sc">%&gt;%</span> </span>
<span id="cb936-6"><a href="god-spiked-the-integers.html#cb936-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>career))<span class="sc">+</span></span>
<span id="cb936-7"><a href="god-spiked-the-integers.html#cb936-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">size=</span><span class="dv">0</span>, <span class="at">fill=</span><span class="st">&quot;orange2&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:d6"></span>
<img src="Rethinking_Bookdown_files/figure-html/d6-1.png" alt="シミュレーションデータで各職業が選ばれた回" width="672" />
<p class="caption">
図11.19: シミュレーションデータで各職業が選ばれた回
</p>
</div>
<p>それでは、モデリングを行う。まずは切片だけのモデルを交わしてみる。<code>brms</code>では、<code>refcat</code>で基準とするカテゴリーを指定する（しなければ最初のカテゴリーが0になる）。</p>
<div class="sourceCode" id="cb937"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb937-1"><a href="god-spiked-the-integers.html#cb937-1" aria-hidden="true" tabindex="-1"></a>b11<span class="fl">.13</span>io <span class="ot">&lt;-</span> <span class="fu">brm</span>(<span class="at">data =</span> d6, </span>
<span id="cb937-2"><a href="god-spiked-the-integers.html#cb937-2" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> <span class="fu">categorical</span>(<span class="at">link =</span> logit, <span class="at">refcat =</span> <span class="dv">3</span>),</span>
<span id="cb937-3"><a href="god-spiked-the-integers.html#cb937-3" aria-hidden="true" tabindex="-1"></a>      career <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb937-4"><a href="god-spiked-the-integers.html#cb937-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">1</span>), </span>
<span id="cb937-5"><a href="god-spiked-the-integers.html#cb937-5" aria-hidden="true" tabindex="-1"></a>                      <span class="at">class =</span> Intercept, <span class="at">dpar =</span> mu1),</span>
<span id="cb937-6"><a href="god-spiked-the-integers.html#cb937-6" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">1</span>), </span>
<span id="cb937-7"><a href="god-spiked-the-integers.html#cb937-7" aria-hidden="true" tabindex="-1"></a>                      <span class="at">class =</span> Intercept, <span class="at">dpar =</span> mu2)),</span>
<span id="cb937-8"><a href="god-spiked-the-integers.html#cb937-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>, <span class="at">cores =</span> <span class="dv">4</span>, <span class="at">chains =</span> <span class="dv">4</span>,</span>
<span id="cb937-9"><a href="god-spiked-the-integers.html#cb937-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">seed =</span> <span class="dv">11</span>,</span>
<span id="cb937-10"><a href="god-spiked-the-integers.html#cb937-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">backend =</span> <span class="st">&quot;cmdstanr&quot;</span>,</span>
<span id="cb937-11"><a href="god-spiked-the-integers.html#cb937-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">file =</span> <span class="st">&quot;output/Chapter11/b11.13io&quot;</span>)</span></code></pre></div>
<p>基準にした3以外のカテゴリーのパラメータが結果として出力される(‘mu1’,‘mu2’)。</p>
<div class="sourceCode" id="cb938"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb938-1"><a href="god-spiked-the-integers.html#cb938-1" aria-hidden="true" tabindex="-1"></a><span class="fu">posterior_summary</span>(b11<span class="fl">.13</span>io) <span class="sc">%&gt;%</span> </span>
<span id="cb938-2"><a href="god-spiked-the-integers.html#cb938-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb938-3"><a href="god-spiked-the-integers.html#cb938-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>(<span class="at">var =</span> <span class="st">&quot;parameter&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb938-4"><a href="god-spiked-the-integers.html#cb938-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(parameter <span class="sc">!=</span> <span class="st">&quot;lp__&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb938-5"><a href="god-spiked-the-integers.html#cb938-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="at">digits=</span><span class="dv">2</span>, <span class="at">caption =</span> <span class="st">&quot;b11.13ioの結果&quot;</span>,</span>
<span id="cb938-6"><a href="god-spiked-the-integers.html#cb938-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">booktabs =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb938-7"><a href="god-spiked-the-integers.html#cb938-7" aria-hidden="true" tabindex="-1"></a>   <span class="fu">kable_styling</span>(<span class="at">latex_options =</span> <span class="st">&quot;striped&quot;</span>)</span></code></pre></div>
<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:unnamed-chunk-491">表11.15: </span>b11.13ioの結果
</caption>
<thead>
<tr>
<th style="text-align:left;">
parameter
</th>
<th style="text-align:right;">
Estimate
</th>
<th style="text-align:right;">
Est.Error
</th>
<th style="text-align:right;">
Q2.5
</th>
<th style="text-align:right;">
Q97.5
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
b_mu1_Intercept
</td>
<td style="text-align:right;">
-2.01
</td>
<td style="text-align:right;">
0.15
</td>
<td style="text-align:right;">
-2.32
</td>
<td style="text-align:right;">
-1.73
</td>
</tr>
<tr>
<td style="text-align:left;">
b_mu2_Intercept
</td>
<td style="text-align:right;">
-1.53
</td>
<td style="text-align:right;">
0.12
</td>
<td style="text-align:right;">
-1.78
</td>
<td style="text-align:right;">
-1.29
</td>
</tr>
<tr>
<td style="text-align:left;">
lprior
</td>
<td style="text-align:right;">
-5.05
</td>
<td style="text-align:right;">
0.38
</td>
<td style="text-align:right;">
-5.82
</td>
<td style="text-align:right;">
-4.36
</td>
</tr>
</tbody>
</table>
<p>’mu1’と’mu2’はそれぞれ-2と-1.5だが、これは3つめのカテゴリーのscoreを0にしたときの、1つめと2つめのカテゴリーのscoreの値に一致する。つまり、モデルの推定結果の’mu1’と’mu2’はscoreの値を返している。</p>
<div class="sourceCode" id="cb939"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb939-1"><a href="god-spiked-the-integers.html#cb939-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">income =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">5</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb939-2"><a href="god-spiked-the-integers.html#cb939-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">score =</span> <span class="fl">0.5</span> <span class="sc">*</span> income) <span class="sc">%&gt;%</span> </span>
<span id="cb939-3"><a href="god-spiked-the-integers.html#cb939-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">rescaled_score =</span> score <span class="sc">-</span> <span class="fl">2.5</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb939-4"><a href="god-spiked-the-integers.html#cb939-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="at">caption =</span> <span class="st">&quot;元データのscore&quot;</span>,</span>
<span id="cb939-5"><a href="god-spiked-the-integers.html#cb939-5" aria-hidden="true" tabindex="-1"></a>        <span class="at">booktabs =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb939-6"><a href="god-spiked-the-integers.html#cb939-6" aria-hidden="true" tabindex="-1"></a>   <span class="fu">kable_styling</span>(<span class="at">latex_options =</span> <span class="st">&quot;striped&quot;</span>)</span></code></pre></div>
<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:unnamed-chunk-492">表11.16: </span>元データのscore
</caption>
<thead>
<tr>
<th style="text-align:right;">
income
</th>
<th style="text-align:right;">
score
</th>
<th style="text-align:right;">
rescaled_score
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.5
</td>
<td style="text-align:right;">
-2.0
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
1.0
</td>
<td style="text-align:right;">
-1.5
</td>
</tr>
<tr>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
2.5
</td>
<td style="text-align:right;">
0.0
</td>
</tr>
</tbody>
</table>
<p><br /></p>
<p>実際の確率はこれらをsoftmax関数に入れれば得られるので、モデルによって推定された確率は以下のように求められる。</p>
<div class="sourceCode" id="cb940"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb940-1"><a href="god-spiked-the-integers.html#cb940-1" aria-hidden="true" tabindex="-1"></a><span class="fu">posterior_samples</span>(b11<span class="fl">.13</span>io) <span class="sc">%&gt;%</span> </span>
<span id="cb940-2"><a href="god-spiked-the-integers.html#cb940-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">b_mu3_Intercept =</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb940-3"><a href="god-spiked-the-integers.html#cb940-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">p1 =</span> <span class="fu">exp</span>(b_mu1_Intercept) <span class="sc">/</span> (<span class="fu">exp</span>(b_mu1_Intercept) <span class="sc">+</span> <span class="fu">exp</span>(b_mu2_Intercept) <span class="sc">+</span> <span class="fu">exp</span>(b_mu3_Intercept)),</span>
<span id="cb940-4"><a href="god-spiked-the-integers.html#cb940-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">p2 =</span> <span class="fu">exp</span>(b_mu2_Intercept) <span class="sc">/</span> (<span class="fu">exp</span>(b_mu1_Intercept) <span class="sc">+</span> <span class="fu">exp</span>(b_mu2_Intercept) <span class="sc">+</span> <span class="fu">exp</span>(b_mu3_Intercept)),</span>
<span id="cb940-5"><a href="god-spiked-the-integers.html#cb940-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">p3 =</span> <span class="fu">exp</span>(b_mu3_Intercept) <span class="sc">/</span> (<span class="fu">exp</span>(b_mu1_Intercept) <span class="sc">+</span> <span class="fu">exp</span>(b_mu2_Intercept) <span class="sc">+</span> <span class="fu">exp</span>(b_mu3_Intercept))) <span class="sc">%&gt;%</span> </span>
<span id="cb940-6"><a href="god-spiked-the-integers.html#cb940-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(p1<span class="sc">:</span>p3) <span class="sc">%&gt;%</span> </span>
<span id="cb940-7"><a href="god-spiked-the-integers.html#cb940-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(name) <span class="sc">%&gt;%</span> </span>
<span id="cb940-8"><a href="god-spiked-the-integers.html#cb940-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mean_qi</span>(value) <span class="sc">%&gt;%</span> </span>
<span id="cb940-9"><a href="god-spiked-the-integers.html#cb940-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_if</span>(is.double, round, <span class="at">digits =</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb940-10"><a href="god-spiked-the-integers.html#cb940-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="at">caption =</span> <span class="st">&quot;モデルb11.13ioによって推定された各職業が選ばれる確率&quot;</span>,</span>
<span id="cb940-11"><a href="god-spiked-the-integers.html#cb940-11" aria-hidden="true" tabindex="-1"></a>        <span class="at">booktabs =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb940-12"><a href="god-spiked-the-integers.html#cb940-12" aria-hidden="true" tabindex="-1"></a>   <span class="fu">kable_styling</span>(<span class="at">latex_options =</span> <span class="st">&quot;striped&quot;</span>)</span></code></pre></div>
<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:unnamed-chunk-493">表11.17: </span>モデルb11.13ioによって推定された各職業が選ばれる確率
</caption>
<thead>
<tr>
<th style="text-align:left;">
name
</th>
<th style="text-align:right;">
value
</th>
<th style="text-align:right;">
.lower
</th>
<th style="text-align:right;">
.upper
</th>
<th style="text-align:right;">
.width
</th>
<th style="text-align:left;">
.point
</th>
<th style="text-align:left;">
.interval
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
p1
</td>
<td style="text-align:right;">
0.10
</td>
<td style="text-align:right;">
0.08
</td>
<td style="text-align:right;">
0.13
</td>
<td style="text-align:right;">
0.95
</td>
<td style="text-align:left;">
mean
</td>
<td style="text-align:left;">
qi
</td>
</tr>
<tr>
<td style="text-align:left;">
p2
</td>
<td style="text-align:right;">
0.16
</td>
<td style="text-align:right;">
0.13
</td>
<td style="text-align:right;">
0.19
</td>
<td style="text-align:right;">
0.95
</td>
<td style="text-align:left;">
mean
</td>
<td style="text-align:left;">
qi
</td>
</tr>
<tr>
<td style="text-align:left;">
p3
</td>
<td style="text-align:right;">
0.74
</td>
<td style="text-align:right;">
0.70
</td>
<td style="text-align:right;">
0.78
</td>
<td style="text-align:right;">
0.95
</td>
<td style="text-align:left;">
mean
</td>
<td style="text-align:left;">
qi
</td>
</tr>
</tbody>
</table>
<p>これは、シミュレーションに使用した真の値とよく一致している。</p>
<div class="sourceCode" id="cb941"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb941-1"><a href="god-spiked-the-integers.html#cb941-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">income =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">5</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb941-2"><a href="god-spiked-the-integers.html#cb941-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">score =</span><span class="fl">0.5</span><span class="sc">*</span>income) <span class="sc">%&gt;%</span> </span>
<span id="cb941-3"><a href="god-spiked-the-integers.html#cb941-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">p =</span> <span class="fu">exp</span>(score)<span class="sc">/</span><span class="fu">sum</span>(<span class="fu">exp</span>(score)))</span></code></pre></div>
<pre><code>## # A tibble: 3 × 3
##   income score      p
##    &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;
## 1      1   0.5 0.0996
## 2      2   1   0.164 
## 3      5   2.5 0.736</code></pre>
<p><br /></p>
<p>それでは、収入を説明変数に入れたモデルを回してみる。収入にかかる係数を職業ごとに変えるか、パラメータの範囲に制限を設けるかによって4種類のモデルが考えられる。</p>
<div class="sourceCode" id="cb943"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb943-1"><a href="god-spiked-the-integers.html#cb943-1" aria-hidden="true" tabindex="-1"></a><span class="fu">crossing</span>(<span class="at">b  =</span> <span class="fu">factor</span>(<span class="fu">c</span>(<span class="st">&quot;b1 &amp; b2&quot;</span>, <span class="st">&quot;b&quot;</span>), <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&quot;b1 &amp; b2&quot;</span>, <span class="st">&quot;b&quot;</span>)),</span>
<span id="cb943-2"><a href="god-spiked-the-integers.html#cb943-2" aria-hidden="true" tabindex="-1"></a>         <span class="at">lb =</span> <span class="fu">factor</span>(<span class="fu">c</span>(<span class="st">&quot;NA&quot;</span>, <span class="dv">0</span>), <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&quot;NA&quot;</span>, <span class="dv">0</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb943-3"><a href="god-spiked-the-integers.html#cb943-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">fit =</span> <span class="fu">str_c</span>(<span class="st">&quot;b11.13&quot;</span>, letters[<span class="dv">1</span><span class="sc">:</span><span class="fu">n</span>()])) <span class="sc">%&gt;%</span> </span>
<span id="cb943-4"><a href="god-spiked-the-integers.html#cb943-4" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(fit, <span class="fu">everything</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb943-5"><a href="god-spiked-the-integers.html#cb943-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="at">booktabs =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb943-6"><a href="god-spiked-the-integers.html#cb943-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">latex_options =</span> <span class="st">&quot;stripe&quot;</span>)</span></code></pre></div>
<table class="table" style="margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;">
fit
</th>
<th style="text-align:left;">
b
</th>
<th style="text-align:left;">
lb
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
b11.13a
</td>
<td style="text-align:left;">
b1 &amp; b2
</td>
<td style="text-align:left;">
NA
</td>
</tr>
<tr>
<td style="text-align:left;">
b11.13b
</td>
<td style="text-align:left;">
b1 &amp; b2
</td>
<td style="text-align:left;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
b11.13c
</td>
<td style="text-align:left;">
b
</td>
<td style="text-align:left;">
NA
</td>
</tr>
<tr>
<td style="text-align:left;">
b11.13d
</td>
<td style="text-align:left;">
b
</td>
<td style="text-align:left;">
0
</td>
</tr>
</tbody>
</table>
<p>それでは、4つモデルを回す。</p>
<div class="sourceCode" id="cb944"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb944-1"><a href="god-spiked-the-integers.html#cb944-1" aria-hidden="true" tabindex="-1"></a>b11<span class="fl">.13</span>a <span class="ot">&lt;-</span></span>
<span id="cb944-2"><a href="god-spiked-the-integers.html#cb944-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">brm</span>(<span class="at">data =</span> d6, </span>
<span id="cb944-3"><a href="god-spiked-the-integers.html#cb944-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> <span class="fu">categorical</span>(<span class="at">link =</span> logit, <span class="at">refcat =</span> <span class="dv">3</span>),</span>
<span id="cb944-4"><a href="god-spiked-the-integers.html#cb944-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">bf</span>(career <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb944-5"><a href="god-spiked-the-integers.html#cb944-5" aria-hidden="true" tabindex="-1"></a>         <span class="fu">nlf</span>(mu1 <span class="sc">~</span> a1 <span class="sc">+</span> b1 <span class="sc">*</span> <span class="dv">1</span>),</span>
<span id="cb944-6"><a href="god-spiked-the-integers.html#cb944-6" aria-hidden="true" tabindex="-1"></a>         <span class="fu">nlf</span>(mu2 <span class="sc">~</span> a2 <span class="sc">+</span> b2 <span class="sc">*</span> <span class="dv">2</span>),</span>
<span id="cb944-7"><a href="god-spiked-the-integers.html#cb944-7" aria-hidden="true" tabindex="-1"></a>         a1 <span class="sc">+</span> a2 <span class="sc">+</span> b1 <span class="sc">+</span> b2 <span class="sc">~</span> <span class="dv">1</span>),</span>
<span id="cb944-8"><a href="god-spiked-the-integers.html#cb944-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">class =</span> b, <span class="at">nlpar =</span> a1),</span>
<span id="cb944-9"><a href="god-spiked-the-integers.html#cb944-9" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">class =</span> b, <span class="at">nlpar =</span> a2),</span>
<span id="cb944-10"><a href="god-spiked-the-integers.html#cb944-10" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">0.5</span>), <span class="at">class =</span> b, </span>
<span id="cb944-11"><a href="god-spiked-the-integers.html#cb944-11" aria-hidden="true" tabindex="-1"></a>                      <span class="at">nlpar =</span> b1),</span>
<span id="cb944-12"><a href="god-spiked-the-integers.html#cb944-12" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">0.5</span>), <span class="at">class =</span> b,</span>
<span id="cb944-13"><a href="god-spiked-the-integers.html#cb944-13" aria-hidden="true" tabindex="-1"></a>                      <span class="at">nlpar =</span> b2)),</span>
<span id="cb944-14"><a href="god-spiked-the-integers.html#cb944-14" aria-hidden="true" tabindex="-1"></a>      <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>, <span class="at">cores =</span> <span class="dv">4</span>, <span class="at">chains =</span> <span class="dv">4</span>,</span>
<span id="cb944-15"><a href="god-spiked-the-integers.html#cb944-15" aria-hidden="true" tabindex="-1"></a>      <span class="at">seed =</span> <span class="dv">11</span>,</span>
<span id="cb944-16"><a href="god-spiked-the-integers.html#cb944-16" aria-hidden="true" tabindex="-1"></a>      <span class="at">backend =</span> <span class="st">&quot;cmdstanr&quot;</span>,</span>
<span id="cb944-17"><a href="god-spiked-the-integers.html#cb944-17" aria-hidden="true" tabindex="-1"></a>      <span class="at">file =</span> <span class="st">&quot;output/Chapter11/b11.13a&quot;</span>)</span>
<span id="cb944-18"><a href="god-spiked-the-integers.html#cb944-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb944-19"><a href="god-spiked-the-integers.html#cb944-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb944-20"><a href="god-spiked-the-integers.html#cb944-20" aria-hidden="true" tabindex="-1"></a>b11<span class="fl">.13</span>b <span class="ot">&lt;-</span></span>
<span id="cb944-21"><a href="god-spiked-the-integers.html#cb944-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">brm</span>(<span class="at">data =</span> d6, </span>
<span id="cb944-22"><a href="god-spiked-the-integers.html#cb944-22" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> <span class="fu">categorical</span>(<span class="at">link =</span> logit, <span class="at">refcat =</span> <span class="dv">3</span>),</span>
<span id="cb944-23"><a href="god-spiked-the-integers.html#cb944-23" aria-hidden="true" tabindex="-1"></a>      <span class="fu">bf</span>(career <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb944-24"><a href="god-spiked-the-integers.html#cb944-24" aria-hidden="true" tabindex="-1"></a>         <span class="fu">nlf</span>(mu1 <span class="sc">~</span> a1 <span class="sc">+</span> b1 <span class="sc">*</span> <span class="dv">1</span>),</span>
<span id="cb944-25"><a href="god-spiked-the-integers.html#cb944-25" aria-hidden="true" tabindex="-1"></a>         <span class="fu">nlf</span>(mu2 <span class="sc">~</span> a2 <span class="sc">+</span> b2 <span class="sc">*</span> <span class="dv">2</span>),</span>
<span id="cb944-26"><a href="god-spiked-the-integers.html#cb944-26" aria-hidden="true" tabindex="-1"></a>         a1 <span class="sc">+</span> a2 <span class="sc">+</span> b1 <span class="sc">+</span> b2 <span class="sc">~</span> <span class="dv">1</span>),</span>
<span id="cb944-27"><a href="god-spiked-the-integers.html#cb944-27" aria-hidden="true" tabindex="-1"></a>      <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">class =</span> b, <span class="at">nlpar =</span> a1),</span>
<span id="cb944-28"><a href="god-spiked-the-integers.html#cb944-28" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">class =</span> b, <span class="at">nlpar =</span> a2),</span>
<span id="cb944-29"><a href="god-spiked-the-integers.html#cb944-29" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">0.5</span>), <span class="at">class =</span> b, </span>
<span id="cb944-30"><a href="god-spiked-the-integers.html#cb944-30" aria-hidden="true" tabindex="-1"></a>                      <span class="at">nlpar =</span> b1, <span class="at">lb =</span> <span class="dv">0</span>),</span>
<span id="cb944-31"><a href="god-spiked-the-integers.html#cb944-31" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">0.5</span>), <span class="at">class =</span> b,</span>
<span id="cb944-32"><a href="god-spiked-the-integers.html#cb944-32" aria-hidden="true" tabindex="-1"></a>                      <span class="at">nlpar =</span> b2, <span class="at">lb =</span> <span class="dv">0</span>)),</span>
<span id="cb944-33"><a href="god-spiked-the-integers.html#cb944-33" aria-hidden="true" tabindex="-1"></a>      <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>, <span class="at">cores =</span> <span class="dv">4</span>, <span class="at">chains =</span> <span class="dv">4</span>,</span>
<span id="cb944-34"><a href="god-spiked-the-integers.html#cb944-34" aria-hidden="true" tabindex="-1"></a>      <span class="at">seed =</span> <span class="dv">11</span>,</span>
<span id="cb944-35"><a href="god-spiked-the-integers.html#cb944-35" aria-hidden="true" tabindex="-1"></a>      <span class="at">control =</span> <span class="fu">list</span>(<span class="at">adapt_delta =</span> .<span class="dv">99</span>),</span>
<span id="cb944-36"><a href="god-spiked-the-integers.html#cb944-36" aria-hidden="true" tabindex="-1"></a>      <span class="at">backend =</span> <span class="st">&quot;cmdstanr&quot;</span>,</span>
<span id="cb944-37"><a href="god-spiked-the-integers.html#cb944-37" aria-hidden="true" tabindex="-1"></a>      <span class="at">file =</span> <span class="st">&quot;output/Chapter11/b11.13b&quot;</span>)</span>
<span id="cb944-38"><a href="god-spiked-the-integers.html#cb944-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb944-39"><a href="god-spiked-the-integers.html#cb944-39" aria-hidden="true" tabindex="-1"></a>b11<span class="fl">.13</span>c <span class="ot">&lt;-</span></span>
<span id="cb944-40"><a href="god-spiked-the-integers.html#cb944-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">brm</span>(<span class="at">data =</span> d6, </span>
<span id="cb944-41"><a href="god-spiked-the-integers.html#cb944-41" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> <span class="fu">categorical</span>(<span class="at">link =</span> logit, <span class="at">refcat =</span> <span class="dv">3</span>),</span>
<span id="cb944-42"><a href="god-spiked-the-integers.html#cb944-42" aria-hidden="true" tabindex="-1"></a>      <span class="fu">bf</span>(career <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb944-43"><a href="god-spiked-the-integers.html#cb944-43" aria-hidden="true" tabindex="-1"></a>         <span class="fu">nlf</span>(mu1 <span class="sc">~</span> a1 <span class="sc">+</span> b <span class="sc">*</span> <span class="dv">1</span>),</span>
<span id="cb944-44"><a href="god-spiked-the-integers.html#cb944-44" aria-hidden="true" tabindex="-1"></a>         <span class="fu">nlf</span>(mu2 <span class="sc">~</span> a2 <span class="sc">+</span> b <span class="sc">*</span> <span class="dv">2</span>),</span>
<span id="cb944-45"><a href="god-spiked-the-integers.html#cb944-45" aria-hidden="true" tabindex="-1"></a>         a1 <span class="sc">+</span> a2 <span class="sc">+</span> b <span class="sc">~</span> <span class="dv">1</span>),</span>
<span id="cb944-46"><a href="god-spiked-the-integers.html#cb944-46" aria-hidden="true" tabindex="-1"></a>      <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">class =</span> b, <span class="at">nlpar =</span> a1),</span>
<span id="cb944-47"><a href="god-spiked-the-integers.html#cb944-47" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">class =</span> b, <span class="at">nlpar =</span> a2),</span>
<span id="cb944-48"><a href="god-spiked-the-integers.html#cb944-48" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">0.5</span>), <span class="at">class =</span> b, <span class="at">nlpar =</span> b)),</span>
<span id="cb944-49"><a href="god-spiked-the-integers.html#cb944-49" aria-hidden="true" tabindex="-1"></a>      <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>, <span class="at">cores =</span> <span class="dv">4</span>, <span class="at">chains =</span> <span class="dv">4</span>,</span>
<span id="cb944-50"><a href="god-spiked-the-integers.html#cb944-50" aria-hidden="true" tabindex="-1"></a>      <span class="at">seed =</span> <span class="dv">11</span>,</span>
<span id="cb944-51"><a href="god-spiked-the-integers.html#cb944-51" aria-hidden="true" tabindex="-1"></a>      <span class="at">backend =</span> <span class="st">&quot;cmdstanr&quot;</span>,</span>
<span id="cb944-52"><a href="god-spiked-the-integers.html#cb944-52" aria-hidden="true" tabindex="-1"></a>      <span class="at">file =</span> <span class="st">&quot;output/Chapter11/b11.13c&quot;</span>)</span>
<span id="cb944-53"><a href="god-spiked-the-integers.html#cb944-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb944-54"><a href="god-spiked-the-integers.html#cb944-54" aria-hidden="true" tabindex="-1"></a>b11<span class="fl">.13</span>d <span class="ot">&lt;-</span></span>
<span id="cb944-55"><a href="god-spiked-the-integers.html#cb944-55" aria-hidden="true" tabindex="-1"></a>  <span class="fu">brm</span>(<span class="at">data =</span> d6, </span>
<span id="cb944-56"><a href="god-spiked-the-integers.html#cb944-56" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> <span class="fu">categorical</span>(<span class="at">link =</span> logit, <span class="at">refcat =</span> <span class="dv">3</span>),</span>
<span id="cb944-57"><a href="god-spiked-the-integers.html#cb944-57" aria-hidden="true" tabindex="-1"></a>      <span class="fu">bf</span>(career <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb944-58"><a href="god-spiked-the-integers.html#cb944-58" aria-hidden="true" tabindex="-1"></a>         <span class="fu">nlf</span>(mu1 <span class="sc">~</span> a1 <span class="sc">+</span> b <span class="sc">*</span> <span class="dv">1</span>),</span>
<span id="cb944-59"><a href="god-spiked-the-integers.html#cb944-59" aria-hidden="true" tabindex="-1"></a>         <span class="fu">nlf</span>(mu2 <span class="sc">~</span> a2 <span class="sc">+</span> b <span class="sc">*</span> <span class="dv">2</span>),</span>
<span id="cb944-60"><a href="god-spiked-the-integers.html#cb944-60" aria-hidden="true" tabindex="-1"></a>         a1 <span class="sc">+</span> a2 <span class="sc">+</span> b <span class="sc">~</span> <span class="dv">1</span>),</span>
<span id="cb944-61"><a href="god-spiked-the-integers.html#cb944-61" aria-hidden="true" tabindex="-1"></a>      <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">class =</span> b, <span class="at">nlpar =</span> a1),</span>
<span id="cb944-62"><a href="god-spiked-the-integers.html#cb944-62" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">class =</span> b, <span class="at">nlpar =</span> a2),</span>
<span id="cb944-63"><a href="god-spiked-the-integers.html#cb944-63" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">0.5</span>), <span class="at">class =</span> b, <span class="at">nlpar =</span> b, <span class="at">lb =</span> <span class="dv">0</span>)),</span>
<span id="cb944-64"><a href="god-spiked-the-integers.html#cb944-64" aria-hidden="true" tabindex="-1"></a>      <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>, <span class="at">cores =</span> <span class="dv">4</span>, <span class="at">chains =</span> <span class="dv">4</span>,</span>
<span id="cb944-65"><a href="god-spiked-the-integers.html#cb944-65" aria-hidden="true" tabindex="-1"></a>      <span class="at">seed =</span> <span class="dv">11</span>,</span>
<span id="cb944-66"><a href="god-spiked-the-integers.html#cb944-66" aria-hidden="true" tabindex="-1"></a>      <span class="at">control =</span> <span class="fu">list</span>(<span class="at">adapt_delta =</span> .<span class="dv">99</span>),</span>
<span id="cb944-67"><a href="god-spiked-the-integers.html#cb944-67" aria-hidden="true" tabindex="-1"></a>      <span class="at">backend =</span> <span class="st">&quot;cmdstanr&quot;</span>,</span>
<span id="cb944-68"><a href="god-spiked-the-integers.html#cb944-68" aria-hidden="true" tabindex="-1"></a>      <span class="at">file =</span> <span class="st">&quot;output/Chapter11/b11.13d&quot;</span>)</span></code></pre></div>
<p>全てのモデルの推定結果を示す。結果はそれぞれ異なり、どれも教科書とは違う結果…。</p>
<div class="sourceCode" id="cb945"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb945-1"><a href="god-spiked-the-integers.html#cb945-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">fit =</span> <span class="fu">str_c</span>(<span class="st">&quot;b11.13&quot;</span>, letters[<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>])) <span class="sc">%&gt;%</span> </span>
<span id="cb945-2"><a href="god-spiked-the-integers.html#cb945-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">fixef =</span> purrr<span class="sc">::</span><span class="fu">map</span>(fit, <span class="sc">~</span><span class="fu">get</span>(.) <span class="sc">%&gt;%</span> </span>
<span id="cb945-3"><a href="god-spiked-the-integers.html#cb945-3" aria-hidden="true" tabindex="-1"></a>                              <span class="fu">fixef</span>() <span class="sc">%&gt;%</span></span>
<span id="cb945-4"><a href="god-spiked-the-integers.html#cb945-4" aria-hidden="true" tabindex="-1"></a>                              <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> <span class="fu">rownames_to_column</span>(<span class="st">&quot;parameter&quot;</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb945-5"><a href="god-spiked-the-integers.html#cb945-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(fixef) <span class="sc">%&gt;%</span> </span>
<span id="cb945-6"><a href="god-spiked-the-integers.html#cb945-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">parameter =</span> <span class="fu">str_remove</span>(parameter, <span class="st">&quot;_Intercept&quot;</span>),</span>
<span id="cb945-7"><a href="god-spiked-the-integers.html#cb945-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">fit=</span> <span class="fu">factor</span>(fit, <span class="at">levels =</span> <span class="fu">str_c</span>(<span class="st">&quot;b11.13&quot;</span>, letters[<span class="dv">4</span><span class="sc">:</span><span class="dv">1</span>]))) <span class="sc">%&gt;%</span> </span>
<span id="cb945-8"><a href="god-spiked-the-integers.html#cb945-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb945-9"><a href="god-spiked-the-integers.html#cb945-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Estimate, <span class="at">xmin =</span> Q2<span class="fl">.5</span>, <span class="at">xmax =</span> Q97<span class="fl">.5</span>, <span class="at">y =</span> fit)) <span class="sc">+</span></span>
<span id="cb945-10"><a href="god-spiked-the-integers.html#cb945-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">color =</span><span class="st">&quot;black&quot;</span>, <span class="at">linetype=</span><span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb945-11"><a href="god-spiked-the-integers.html#cb945-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_pointrange</span>(<span class="at">fatten =</span> <span class="dv">3</span><span class="sc">/</span><span class="dv">2</span>, <span class="at">color =</span><span class="st">&quot;navy&quot;</span>) <span class="sc">+</span></span>
<span id="cb945-12"><a href="god-spiked-the-integers.html#cb945-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb945-13"><a href="god-spiked-the-integers.html#cb945-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.ticks.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb945-14"><a href="god-spiked-the-integers.html#cb945-14" aria-hidden="true" tabindex="-1"></a>        <span class="at">strip.background =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb945-15"><a href="god-spiked-the-integers.html#cb945-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> parameter, <span class="at">nrow =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb945-16"><a href="god-spiked-the-integers.html#cb945-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">aspect.ratio=</span><span class="fl">0.8</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:unnamed-chunk-497"></span>
<img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-497-1.png" alt="モデル11.13a~dの推定結果。" width="672" />
<p class="caption">
図11.20: モデル11.13a~dの推定結果。
</p>
</div>
<p>モデル比較をすると、ほとんど差はないことが分かる。</p>
<div class="sourceCode" id="cb946"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb946-1"><a href="god-spiked-the-integers.html#cb946-1" aria-hidden="true" tabindex="-1"></a>b11<span class="fl">.13</span>a <span class="ot">&lt;-</span> <span class="fu">add_criterion</span>(b11<span class="fl">.13</span>a, <span class="st">&quot;loo&quot;</span>)</span>
<span id="cb946-2"><a href="god-spiked-the-integers.html#cb946-2" aria-hidden="true" tabindex="-1"></a>b11<span class="fl">.13</span>b <span class="ot">&lt;-</span> <span class="fu">add_criterion</span>(b11<span class="fl">.13</span>b, <span class="st">&quot;loo&quot;</span>)</span>
<span id="cb946-3"><a href="god-spiked-the-integers.html#cb946-3" aria-hidden="true" tabindex="-1"></a>b11<span class="fl">.13</span>c <span class="ot">&lt;-</span> <span class="fu">add_criterion</span>(b11<span class="fl">.13</span>c, <span class="st">&quot;loo&quot;</span>)</span>
<span id="cb946-4"><a href="god-spiked-the-integers.html#cb946-4" aria-hidden="true" tabindex="-1"></a>b11<span class="fl">.13</span>d <span class="ot">&lt;-</span> <span class="fu">add_criterion</span>(b11<span class="fl">.13</span>d, <span class="st">&quot;loo&quot;</span>)</span>
<span id="cb946-5"><a href="god-spiked-the-integers.html#cb946-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb946-6"><a href="god-spiked-the-integers.html#cb946-6" aria-hidden="true" tabindex="-1"></a><span class="fu">loo_compare</span>(b11<span class="fl">.13</span>a, b11<span class="fl">.13</span>b, b11<span class="fl">.13</span>c, b11<span class="fl">.13</span>d, <span class="at">criterion =</span> <span class="st">&quot;loo&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb946-7"><a href="god-spiked-the-integers.html#cb946-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="at">simplify =</span> F) <span class="sc">%&gt;%</span> </span>
<span id="cb946-8"><a href="god-spiked-the-integers.html#cb946-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="at">caption =</span> <span class="st">&quot;b11.13a ~ b11.13dのモデル比較&quot;</span>,</span>
<span id="cb946-9"><a href="god-spiked-the-integers.html#cb946-9" aria-hidden="true" tabindex="-1"></a>        <span class="at">booktabs =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb946-10"><a href="god-spiked-the-integers.html#cb946-10" aria-hidden="true" tabindex="-1"></a>   <span class="fu">kable_styling</span>(<span class="at">latex_options =</span> <span class="st">&quot;striped&quot;</span>)</span></code></pre></div>
<pre><code>##         elpd_diff se_diff elpd_loo se_elpd_loo p_loo  se_p_loo looic  se_looic
## b11.13c    0.0       0.0  -369.5     17.1         1.9    0.1    739.0   34.2  
## b11.13d    0.0       0.2  -369.6     16.9         1.9    0.1    739.1   33.8  
## b11.13a    0.0       0.1  -369.6     17.1         2.0    0.1    739.1   34.1  
## b11.13b   -0.1       0.2  -369.6     16.9         2.0    0.1    739.2   33.8</code></pre>
<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:unnamed-chunk-498">表11.18: </span>b11.13a ~ b11.13dのモデル比較
</caption>
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
elpd_diff
</th>
<th style="text-align:right;">
se_diff
</th>
<th style="text-align:right;">
elpd_loo
</th>
<th style="text-align:right;">
se_elpd_loo
</th>
<th style="text-align:right;">
p_loo
</th>
<th style="text-align:right;">
se_p_loo
</th>
<th style="text-align:right;">
looic
</th>
<th style="text-align:right;">
se_looic
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
b11.13c
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
-369.5104
</td>
<td style="text-align:right;">
17.10985
</td>
<td style="text-align:right;">
1.935502
</td>
<td style="text-align:right;">
0.1311694
</td>
<td style="text-align:right;">
739.0208
</td>
<td style="text-align:right;">
34.21970
</td>
</tr>
<tr>
<td style="text-align:left;">
b11.13d
</td>
<td style="text-align:right;">
-0.0435284
</td>
<td style="text-align:right;">
0.2212151
</td>
<td style="text-align:right;">
-369.5539
</td>
<td style="text-align:right;">
16.90255
</td>
<td style="text-align:right;">
1.922417
</td>
<td style="text-align:right;">
0.1286941
</td>
<td style="text-align:right;">
739.1079
</td>
<td style="text-align:right;">
33.80509
</td>
</tr>
<tr>
<td style="text-align:left;">
b11.13a
</td>
<td style="text-align:right;">
-0.0456842
</td>
<td style="text-align:right;">
0.0542677
</td>
<td style="text-align:right;">
-369.5561
</td>
<td style="text-align:right;">
17.05629
</td>
<td style="text-align:right;">
1.970180
</td>
<td style="text-align:right;">
0.1312604
</td>
<td style="text-align:right;">
739.1122
</td>
<td style="text-align:right;">
34.11259
</td>
</tr>
<tr>
<td style="text-align:left;">
b11.13b
</td>
<td style="text-align:right;">
-0.0984991
</td>
<td style="text-align:right;">
0.2155251
</td>
<td style="text-align:right;">
-369.6089
</td>
<td style="text-align:right;">
16.89454
</td>
<td style="text-align:right;">
1.969123
</td>
<td style="text-align:right;">
0.1318588
</td>
<td style="text-align:right;">
739.2178
</td>
<td style="text-align:right;">
33.78908
</td>
</tr>
</tbody>
</table>
<p>切片だけのモデルもPSISに違いはない。</p>
<div class="sourceCode" id="cb948"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb948-1"><a href="god-spiked-the-integers.html#cb948-1" aria-hidden="true" tabindex="-1"></a>b11<span class="fl">.13</span>io <span class="ot">&lt;-</span> <span class="fu">add_criterion</span>(b11<span class="fl">.13</span>io, <span class="st">&quot;loo&quot;</span>)</span>
<span id="cb948-2"><a href="god-spiked-the-integers.html#cb948-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb948-3"><a href="god-spiked-the-integers.html#cb948-3" aria-hidden="true" tabindex="-1"></a><span class="fu">loo_compare</span>(b11<span class="fl">.13</span>io, b11<span class="fl">.13</span>a, b11<span class="fl">.13</span>b, b11<span class="fl">.13</span>c, b11<span class="fl">.13</span>d, <span class="at">criterion =</span> <span class="st">&quot;loo&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb948-4"><a href="god-spiked-the-integers.html#cb948-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="at">simplify =</span> F) <span class="sc">%&gt;%</span> </span>
<span id="cb948-5"><a href="god-spiked-the-integers.html#cb948-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="at">caption =</span> <span class="st">&quot;b11.13a ~ b11.13dと切片のみモデルの比較&quot;</span>,</span>
<span id="cb948-6"><a href="god-spiked-the-integers.html#cb948-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">booktabs =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb948-7"><a href="god-spiked-the-integers.html#cb948-7" aria-hidden="true" tabindex="-1"></a>   <span class="fu">kable_styling</span>(<span class="at">latex_options =</span> <span class="st">&quot;striped&quot;</span>)</span></code></pre></div>
<pre><code>##          elpd_diff se_diff elpd_loo se_elpd_loo p_loo  se_p_loo looic  se_looic
## b11.13c     0.0       0.0  -369.5     17.1         1.9    0.1    739.0   34.2  
## b11.13d     0.0       0.2  -369.6     16.9         1.9    0.1    739.1   33.8  
## b11.13a     0.0       0.1  -369.6     17.1         2.0    0.1    739.1   34.1  
## b11.13io   -0.1       0.2  -369.6     16.9         2.0    0.1    739.2   33.9  
## b11.13b    -0.1       0.2  -369.6     16.9         2.0    0.1    739.2   33.8</code></pre>
<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:unnamed-chunk-499">表11.19: </span>b11.13a ~ b11.13dと切片のみモデルの比較
</caption>
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
elpd_diff
</th>
<th style="text-align:right;">
se_diff
</th>
<th style="text-align:right;">
elpd_loo
</th>
<th style="text-align:right;">
se_elpd_loo
</th>
<th style="text-align:right;">
p_loo
</th>
<th style="text-align:right;">
se_p_loo
</th>
<th style="text-align:right;">
looic
</th>
<th style="text-align:right;">
se_looic
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
b11.13c
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
-369.5104
</td>
<td style="text-align:right;">
17.10985
</td>
<td style="text-align:right;">
1.935502
</td>
<td style="text-align:right;">
0.1311694
</td>
<td style="text-align:right;">
739.0208
</td>
<td style="text-align:right;">
34.21970
</td>
</tr>
<tr>
<td style="text-align:left;">
b11.13d
</td>
<td style="text-align:right;">
-0.0435284
</td>
<td style="text-align:right;">
0.2212151
</td>
<td style="text-align:right;">
-369.5539
</td>
<td style="text-align:right;">
16.90255
</td>
<td style="text-align:right;">
1.922417
</td>
<td style="text-align:right;">
0.1286941
</td>
<td style="text-align:right;">
739.1079
</td>
<td style="text-align:right;">
33.80509
</td>
</tr>
<tr>
<td style="text-align:left;">
b11.13a
</td>
<td style="text-align:right;">
-0.0456842
</td>
<td style="text-align:right;">
0.0542677
</td>
<td style="text-align:right;">
-369.5561
</td>
<td style="text-align:right;">
17.05629
</td>
<td style="text-align:right;">
1.970180
</td>
<td style="text-align:right;">
0.1312604
</td>
<td style="text-align:right;">
739.1122
</td>
<td style="text-align:right;">
34.11259
</td>
</tr>
<tr>
<td style="text-align:left;">
b11.13io
</td>
<td style="text-align:right;">
-0.0830380
</td>
<td style="text-align:right;">
0.1724640
</td>
<td style="text-align:right;">
-369.5935
</td>
<td style="text-align:right;">
16.94163
</td>
<td style="text-align:right;">
1.974698
</td>
<td style="text-align:right;">
0.1304070
</td>
<td style="text-align:right;">
739.1869
</td>
<td style="text-align:right;">
33.88327
</td>
</tr>
<tr>
<td style="text-align:left;">
b11.13b
</td>
<td style="text-align:right;">
-0.0984991
</td>
<td style="text-align:right;">
0.2155251
</td>
<td style="text-align:right;">
-369.6089
</td>
<td style="text-align:right;">
16.89454
</td>
<td style="text-align:right;">
1.969123
</td>
<td style="text-align:right;">
0.1318588
</td>
<td style="text-align:right;">
739.2178
</td>
<td style="text-align:right;">
33.78908
</td>
</tr>
</tbody>
</table>
<p>モデルb11.13dの結果から、職業2の収入が2倍になった時に選択確率を調べる。5%程度上昇することが示唆された。</p>
<div class="sourceCode" id="cb950"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb950-1"><a href="god-spiked-the-integers.html#cb950-1" aria-hidden="true" tabindex="-1"></a><span class="fu">posterior_samples</span>(b11<span class="fl">.13</span>d) <span class="sc">%&gt;%</span> </span>
<span id="cb950-2"><a href="god-spiked-the-integers.html#cb950-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">transmute</span>(<span class="at">s1=</span> b_a1_Intercept <span class="sc">+</span> b_b_Intercept <span class="sc">*</span> income[<span class="dv">1</span>],</span>
<span id="cb950-3"><a href="god-spiked-the-integers.html#cb950-3" aria-hidden="true" tabindex="-1"></a>            <span class="at">s2_orig =</span> </span>
<span id="cb950-4"><a href="god-spiked-the-integers.html#cb950-4" aria-hidden="true" tabindex="-1"></a>              b_a2_Intercept<span class="sc">+</span>b_b_Intercept<span class="sc">*</span>income[<span class="dv">2</span>],</span>
<span id="cb950-5"><a href="god-spiked-the-integers.html#cb950-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">s2_new  =</span> </span>
<span id="cb950-6"><a href="god-spiked-the-integers.html#cb950-6" aria-hidden="true" tabindex="-1"></a>              b_a2_Intercept <span class="sc">+</span> b_b_Intercept <span class="sc">*</span> income[<span class="dv">2</span>]<span class="sc">*</span><span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb950-7"><a href="god-spiked-the-integers.html#cb950-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">p_orig =</span> purrr<span class="sc">::</span><span class="fu">map2_dbl</span>(s1, s2_orig, <span class="sc">~</span><span class="fu">softmax</span>(.x, .y, <span class="dv">0</span>)[<span class="dv">2</span>]),</span>
<span id="cb950-8"><a href="god-spiked-the-integers.html#cb950-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">p_new  =</span> purrr<span class="sc">::</span><span class="fu">map2_dbl</span>(s1, s2_new, <span class="sc">~</span><span class="fu">softmax</span>(.x, .y, <span class="dv">0</span>)[<span class="dv">2</span>])) <span class="sc">%&gt;%</span> </span>
<span id="cb950-9"><a href="god-spiked-the-integers.html#cb950-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">p_diff =</span> p_new <span class="sc">-</span> p_orig) <span class="sc">%&gt;%</span> </span>
<span id="cb950-10"><a href="god-spiked-the-integers.html#cb950-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mean_qi</span>(p_diff) <span class="sc">%&gt;%</span> </span>
<span id="cb950-11"><a href="god-spiked-the-integers.html#cb950-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_if</span>(is.double, round, <span class="at">digits =</span> <span class="dv">2</span>)</span></code></pre></div>
<pre><code>## # A tibble: 1 × 6
##   p_diff .lower .upper .width .point .interval
##    &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;    
## 1   0.04      0   0.17   0.95 mean   qi</code></pre>
</div>
<div id="predictor-matched-to-observations" class="section level3 hasAnchor" number="11.4.2">
<h3><span class="header-section-number">11.4.2</span> Predictor matched to observations<a href="god-spiked-the-integers.html#predictor-matched-to-observations" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>以下の過程でscore1~3が生成されるデータをシミュレーションする。家庭の収入によって職業選択に影響がでると考える。今度は</p>
<p><span class="math display">\[
\begin{aligned}
  s_{1} &amp;= 0.5 -2 × family \ income\\
  s_{2} &amp;= 1.0 +0 × family\ income\\
  s_{3} &amp;= 1.5 +2 × family\ income\\
\end{aligned}
\]</span>
<br /></p>
<div class="sourceCode" id="cb952"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb952-1"><a href="god-spiked-the-integers.html#cb952-1" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">500</span></span>
<span id="cb952-2"><a href="god-spiked-the-integers.html#cb952-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">11</span>)</span>
<span id="cb952-3"><a href="god-spiked-the-integers.html#cb952-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb952-4"><a href="god-spiked-the-integers.html#cb952-4" aria-hidden="true" tabindex="-1"></a>family_income <span class="ot">&lt;-</span> <span class="fu">runif</span>(n)</span>
<span id="cb952-5"><a href="god-spiked-the-integers.html#cb952-5" aria-hidden="true" tabindex="-1"></a>b      <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">2</span>, <span class="dv">0</span>, <span class="dv">2</span>)</span>
<span id="cb952-6"><a href="god-spiked-the-integers.html#cb952-6" aria-hidden="true" tabindex="-1"></a>career <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">NA</span>, n)  </span>
<span id="cb952-7"><a href="god-spiked-the-integers.html#cb952-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb952-8"><a href="god-spiked-the-integers.html#cb952-8" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n) {</span>
<span id="cb952-9"><a href="god-spiked-the-integers.html#cb952-9" aria-hidden="true" tabindex="-1"></a>    score     <span class="ot">&lt;-</span> <span class="fl">0.5</span> <span class="sc">*</span> (<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>) <span class="sc">+</span> b <span class="sc">*</span> family_income[i]</span>
<span id="cb952-10"><a href="god-spiked-the-integers.html#cb952-10" aria-hidden="true" tabindex="-1"></a>    p         <span class="ot">&lt;-</span> <span class="fu">softmax</span>(score[<span class="dv">1</span>], score[<span class="dv">2</span>], score[<span class="dv">3</span>])</span>
<span id="cb952-11"><a href="god-spiked-the-integers.html#cb952-11" aria-hidden="true" tabindex="-1"></a>    career[i] <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, <span class="at">size =</span> <span class="dv">1</span>, <span class="at">prob =</span> p)</span>
<span id="cb952-12"><a href="god-spiked-the-integers.html#cb952-12" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>得られたシミュレーションの結果を可視化する。</p>
<div class="sourceCode" id="cb953"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb953-1"><a href="god-spiked-the-integers.html#cb953-1" aria-hidden="true" tabindex="-1"></a>d7 <span class="ot">&lt;-</span> </span>
<span id="cb953-2"><a href="god-spiked-the-integers.html#cb953-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="at">career =</span> career) <span class="sc">%&gt;%</span> </span>
<span id="cb953-3"><a href="god-spiked-the-integers.html#cb953-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">family_income =</span> family_income)</span>
<span id="cb953-4"><a href="god-spiked-the-integers.html#cb953-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb953-5"><a href="god-spiked-the-integers.html#cb953-5" aria-hidden="true" tabindex="-1"></a>d7 <span class="sc">%&gt;%</span> </span>
<span id="cb953-6"><a href="god-spiked-the-integers.html#cb953-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">career =</span> <span class="fu">as.factor</span>(career)) <span class="sc">%&gt;%</span> </span>
<span id="cb953-7"><a href="god-spiked-the-integers.html#cb953-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>family_income, <span class="at">fill=</span>career))<span class="sc">+</span></span>
<span id="cb953-8"><a href="god-spiked-the-integers.html#cb953-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">alpha=</span><span class="dv">3</span><span class="sc">/</span><span class="dv">4</span>, <span class="at">color=</span><span class="cn">NA</span>)<span class="sc">+</span></span>
<span id="cb953-9"><a href="god-spiked-the-integers.html#cb953-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span><span class="fu">c</span>(<span class="st">&quot;grey4&quot;</span>,<span class="st">&quot;lightblue&quot;</span>,<span class="st">&quot;orange&quot;</span>))<span class="sc">+</span></span>
<span id="cb953-10"><a href="god-spiked-the-integers.html#cb953-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position=</span><span class="st">&quot;none&quot;</span>,</span>
<span id="cb953-11"><a href="god-spiked-the-integers.html#cb953-11" aria-hidden="true" tabindex="-1"></a>        <span class="at">aspect.ratio=</span><span class="dv">1</span>)<span class="ot">-&gt;</span>p7</span>
<span id="cb953-12"><a href="god-spiked-the-integers.html#cb953-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb953-13"><a href="god-spiked-the-integers.html#cb953-13" aria-hidden="true" tabindex="-1"></a>d7 <span class="sc">%&gt;%</span> </span>
<span id="cb953-14"><a href="god-spiked-the-integers.html#cb953-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">career =</span> <span class="fu">as.factor</span>(career)) <span class="sc">%&gt;%</span></span>
<span id="cb953-15"><a href="god-spiked-the-integers.html#cb953-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">fi =</span> santoku<span class="sc">::</span><span class="fu">chop_width</span>(family_income, <span class="at">width =</span> .<span class="dv">1</span>, <span class="at">start =</span> <span class="dv">0</span>, <span class="at">labels =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb953-16"><a href="god-spiked-the-integers.html#cb953-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(fi, career) <span class="sc">%&gt;%</span> </span>
<span id="cb953-17"><a href="god-spiked-the-integers.html#cb953-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(fi) <span class="sc">%&gt;%</span> </span>
<span id="cb953-18"><a href="god-spiked-the-integers.html#cb953-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">proportion =</span> n <span class="sc">/</span> <span class="fu">sum</span>(n)) <span class="sc">%&gt;%</span> </span>
<span id="cb953-19"><a href="god-spiked-the-integers.html#cb953-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">f =</span> <span class="fu">as.double</span>(fi)) <span class="sc">%&gt;%</span> </span>
<span id="cb953-20"><a href="god-spiked-the-integers.html#cb953-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> (f <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">/</span> <span class="dv">9</span>, <span class="at">y =</span> proportion, </span>
<span id="cb953-21"><a href="god-spiked-the-integers.html#cb953-21" aria-hidden="true" tabindex="-1"></a>             <span class="at">fill =</span> career)) <span class="sc">+</span></span>
<span id="cb953-22"><a href="god-spiked-the-integers.html#cb953-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_area</span>() <span class="sc">+</span></span>
<span id="cb953-23"><a href="god-spiked-the-integers.html#cb953-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span><span class="fu">c</span>(<span class="st">&quot;grey4&quot;</span>,<span class="st">&quot;lightblue&quot;</span>,<span class="st">&quot;orange&quot;</span>))<span class="sc">+</span></span>
<span id="cb953-24"><a href="god-spiked-the-integers.html#cb953-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position=</span><span class="st">&quot;none&quot;</span>,</span>
<span id="cb953-25"><a href="god-spiked-the-integers.html#cb953-25" aria-hidden="true" tabindex="-1"></a>        <span class="at">aspect.ratio=</span><span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb953-26"><a href="god-spiked-the-integers.html#cb953-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;family_income, descritized&quot;</span>) <span class="ot">-&gt;</span>p8</span></code></pre></div>
<div class="sourceCode" id="cb954"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb954-1"><a href="god-spiked-the-integers.html#cb954-1" aria-hidden="true" tabindex="-1"></a>p7<span class="sc">+</span>p8</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:unnamed-chunk-503"></span>
<img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-503-1.png" alt="シミュレーションによって得られた収入ごとに選択される職業。\label{sim_prop}" width="672" />
<p class="caption">
図11.21: シミュレーションによって得られた収入ごとに選択される職業。
</p>
</div>
<p>それでは、モデルを回してみる。</p>
<div class="sourceCode" id="cb955"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb955-1"><a href="god-spiked-the-integers.html#cb955-1" aria-hidden="true" tabindex="-1"></a>b11<span class="fl">.14</span> <span class="ot">&lt;-</span> </span>
<span id="cb955-2"><a href="god-spiked-the-integers.html#cb955-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">brm</span>(<span class="at">data =</span> d7,</span>
<span id="cb955-3"><a href="god-spiked-the-integers.html#cb955-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> <span class="fu">categorical</span>(<span class="at">link =</span> <span class="st">&quot;logit&quot;</span>, <span class="at">refcat =</span><span class="dv">3</span>),</span>
<span id="cb955-4"><a href="god-spiked-the-integers.html#cb955-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">bf</span>(career <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb955-5"><a href="god-spiked-the-integers.html#cb955-5" aria-hidden="true" tabindex="-1"></a>         <span class="fu">nlf</span>(mu1 <span class="sc">~</span> a1 <span class="sc">+</span> b1<span class="sc">*</span>family_income),</span>
<span id="cb955-6"><a href="god-spiked-the-integers.html#cb955-6" aria-hidden="true" tabindex="-1"></a>         <span class="fu">nlf</span>(mu2 <span class="sc">~</span> a2 <span class="sc">+</span> b2<span class="sc">*</span>family_income),</span>
<span id="cb955-7"><a href="god-spiked-the-integers.html#cb955-7" aria-hidden="true" tabindex="-1"></a>         a1 <span class="sc">+</span> a2 <span class="sc">+</span> b1 <span class="sc">+</span> b2 <span class="sc">~</span><span class="dv">1</span>),</span>
<span id="cb955-8"><a href="god-spiked-the-integers.html#cb955-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">1.5</span>),<span class="at">class =</span> b,<span class="at">nlpar =</span> a1),</span>
<span id="cb955-9"><a href="god-spiked-the-integers.html#cb955-9" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">1.5</span>), <span class="at">class=</span> b, <span class="at">nlpar =</span> a2),</span>
<span id="cb955-10"><a href="god-spiked-the-integers.html#cb955-10" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">class =</span> b, <span class="at">nlpar =</span> b1),</span>
<span id="cb955-11"><a href="god-spiked-the-integers.html#cb955-11" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">class =</span> b, <span class="at">nlpar =</span> b2)),</span>
<span id="cb955-12"><a href="god-spiked-the-integers.html#cb955-12" aria-hidden="true" tabindex="-1"></a>      <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>, <span class="at">cores =</span> <span class="dv">4</span>, <span class="at">chains =</span> <span class="dv">4</span>,</span>
<span id="cb955-13"><a href="god-spiked-the-integers.html#cb955-13" aria-hidden="true" tabindex="-1"></a>      <span class="at">seed =</span> <span class="dv">11</span>,</span>
<span id="cb955-14"><a href="god-spiked-the-integers.html#cb955-14" aria-hidden="true" tabindex="-1"></a>      <span class="at">backend =</span> <span class="st">&quot;cmdstanr&quot;</span>,</span>
<span id="cb955-15"><a href="god-spiked-the-integers.html#cb955-15" aria-hidden="true" tabindex="-1"></a>      <span class="at">file =</span> <span class="st">&quot;output/Chapter11/b11.14&quot;</span>)</span></code></pre></div>
<p>モデルの推定結果は以下の通り。</p>
<div class="sourceCode" id="cb956"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb956-1"><a href="god-spiked-the-integers.html#cb956-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fixef</span>(b11<span class="fl">.14</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb956-2"><a href="god-spiked-the-integers.html#cb956-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="at">digits=</span><span class="dv">2</span>, <span class="at">caption =</span> <span class="st">&quot;モデルb11.14の結果。家庭の収入によってそれぞれの職業を選択する確率。&quot;</span>,</span>
<span id="cb956-3"><a href="god-spiked-the-integers.html#cb956-3" aria-hidden="true" tabindex="-1"></a>        <span class="at">booktabs =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb956-4"><a href="god-spiked-the-integers.html#cb956-4" aria-hidden="true" tabindex="-1"></a>   <span class="fu">kable_styling</span>(<span class="at">latex_options =</span> <span class="st">&quot;striped&quot;</span>)</span></code></pre></div>
<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:unnamed-chunk-505">表11.20: </span>モデルb11.14の結果。家庭の収入によってそれぞれの職業を選択する確率。
</caption>
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
Estimate
</th>
<th style="text-align:right;">
Est.Error
</th>
<th style="text-align:right;">
Q2.5
</th>
<th style="text-align:right;">
Q97.5
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
a1_Intercept
</td>
<td style="text-align:right;">
-1.28
</td>
<td style="text-align:right;">
0.26
</td>
<td style="text-align:right;">
-1.81
</td>
<td style="text-align:right;">
-0.78
</td>
</tr>
<tr>
<td style="text-align:left;">
a2_Intercept
</td>
<td style="text-align:right;">
-1.01
</td>
<td style="text-align:right;">
0.22
</td>
<td style="text-align:right;">
-1.45
</td>
<td style="text-align:right;">
-0.60
</td>
</tr>
<tr>
<td style="text-align:left;">
b1_Intercept
</td>
<td style="text-align:right;">
-2.52
</td>
<td style="text-align:right;">
0.57
</td>
<td style="text-align:right;">
-3.61
</td>
<td style="text-align:right;">
-1.39
</td>
</tr>
<tr>
<td style="text-align:left;">
b2_Intercept
</td>
<td style="text-align:right;">
-1.22
</td>
<td style="text-align:right;">
0.42
</td>
<td style="text-align:right;">
-2.03
</td>
<td style="text-align:right;">
-0.40
</td>
</tr>
</tbody>
</table>
<p>モデル結果を可視化する。</p>
<div class="sourceCode" id="cb957"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb957-1"><a href="god-spiked-the-integers.html#cb957-1" aria-hidden="true" tabindex="-1"></a>nd <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">family_income =</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="at">length.out=</span><span class="dv">100</span>))</span>
<span id="cb957-2"><a href="god-spiked-the-integers.html#cb957-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb957-3"><a href="god-spiked-the-integers.html#cb957-3" aria-hidden="true" tabindex="-1"></a>fit11<span class="fl">.14</span> <span class="ot">&lt;-</span> <span class="fu">fitted</span>(b11<span class="fl">.14</span>,<span class="at">newdata=</span>nd)</span>
<span id="cb957-4"><a href="god-spiked-the-integers.html#cb957-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb957-5"><a href="god-spiked-the-integers.html#cb957-5" aria-hidden="true" tabindex="-1"></a><span class="fu">rbind</span>(fit11<span class="fl">.14</span>[,,<span class="dv">1</span>],</span>
<span id="cb957-6"><a href="god-spiked-the-integers.html#cb957-6" aria-hidden="true" tabindex="-1"></a>      fit11<span class="fl">.14</span>[,,<span class="dv">2</span>],</span>
<span id="cb957-7"><a href="god-spiked-the-integers.html#cb957-7" aria-hidden="true" tabindex="-1"></a>      fit11<span class="fl">.14</span>[,,<span class="dv">3</span>]) <span class="sc">%&gt;%</span> </span>
<span id="cb957-8"><a href="god-spiked-the-integers.html#cb957-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb957-9"><a href="god-spiked-the-integers.html#cb957-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(nd <span class="sc">%&gt;%</span> </span>
<span id="cb957-10"><a href="god-spiked-the-integers.html#cb957-10" aria-hidden="true" tabindex="-1"></a>              tidyr<span class="sc">::</span><span class="fu">expand</span>(<span class="at">career =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, family_income)) <span class="sc">%&gt;%</span> </span>
<span id="cb957-11"><a href="god-spiked-the-integers.html#cb957-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">career =</span> <span class="fu">str_c</span>(<span class="st">&quot;career: &quot;</span>, career)) <span class="sc">%&gt;%</span> </span>
<span id="cb957-12"><a href="god-spiked-the-integers.html#cb957-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> family_income, <span class="at">y =</span> Estimate,</span>
<span id="cb957-13"><a href="god-spiked-the-integers.html#cb957-13" aria-hidden="true" tabindex="-1"></a>             <span class="at">ymin =</span> Q2<span class="fl">.5</span>, <span class="at">ymax =</span> Q97<span class="fl">.5</span>))<span class="sc">+</span></span>
<span id="cb957-14"><a href="god-spiked-the-integers.html#cb957-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="fu">aes</span>(<span class="at">fill=</span>career, <span class="at">color =</span> career),</span>
<span id="cb957-15"><a href="god-spiked-the-integers.html#cb957-15" aria-hidden="true" tabindex="-1"></a>              <span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>)<span class="sc">+</span></span>
<span id="cb957-16"><a href="god-spiked-the-integers.html#cb957-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span><span class="fu">c</span>(<span class="st">&quot;grey4&quot;</span>,<span class="st">&quot;lightblue&quot;</span>,<span class="st">&quot;orange&quot;</span>))<span class="sc">+</span></span>
<span id="cb957-17"><a href="god-spiked-the-integers.html#cb957-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span><span class="fu">c</span>(<span class="st">&quot;grey4&quot;</span>,<span class="st">&quot;lightblue&quot;</span>,<span class="st">&quot;orange&quot;</span>))<span class="sc">+</span></span>
<span id="cb957-18"><a href="god-spiked-the-integers.html#cb957-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="at">by=</span><span class="fl">0.5</span>))<span class="sc">+</span></span>
<span id="cb957-19"><a href="god-spiked-the-integers.html#cb957-19" aria-hidden="true" tabindex="-1"></a>   <span class="fu">scale_y_continuous</span>(<span class="st">&quot;probability&quot;</span>, <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>),</span>
<span id="cb957-20"><a href="god-spiked-the-integers.html#cb957-20" aria-hidden="true" tabindex="-1"></a>                     <span class="at">breaks =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">3</span> <span class="sc">/</span> <span class="dv">3</span>, <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;0&quot;</span>, <span class="st">&quot;.33&quot;</span>, <span class="st">&quot;.67&quot;</span>, <span class="st">&quot;1&quot;</span>))<span class="sc">+</span></span>
<span id="cb957-21"><a href="god-spiked-the-integers.html#cb957-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">aspect.ratio=</span><span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb957-22"><a href="god-spiked-the-integers.html#cb957-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>career)<span class="sc">+</span></span>
<span id="cb957-23"><a href="god-spiked-the-integers.html#cb957-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">strip.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb957-24"><a href="god-spiked-the-integers.html#cb957-24" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="dv">0</span>),</span>
<span id="cb957-25"><a href="god-spiked-the-integers.html#cb957-25" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:unnamed-chunk-506"></span>
<img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-506-1.png" alt="モデルb11.14の推定結果。家庭の収入によって各職業を選ぶ確率。" width="672" />
<p class="caption">
図11.22: モデルb11.14の推定結果。家庭の収入によって各職業を選ぶ確率。
</p>
</div>
<p>全体に占める割合についてもグラフを書いてみる。
元データ（図<a href="god-spiked-the-integers.html#fig:sim-prop">11.23</a>の右）と似ているので、うまく推定できてそう。</p>
<div class="sourceCode" id="cb958"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb958-1"><a href="god-spiked-the-integers.html#cb958-1" aria-hidden="true" tabindex="-1"></a>text <span class="ot">&lt;-</span></span>
<span id="cb958-2"><a href="god-spiked-the-integers.html#cb958-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="at">family_income =</span> <span class="fu">c</span>(.<span class="dv">45</span>, .<span class="dv">3</span>, .<span class="dv">15</span>),</span>
<span id="cb958-3"><a href="god-spiked-the-integers.html#cb958-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">proportion    =</span> <span class="fu">c</span>(.<span class="dv">65</span>, .<span class="dv">8</span>, .<span class="dv">95</span>),</span>
<span id="cb958-4"><a href="god-spiked-the-integers.html#cb958-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">label         =</span> <span class="fu">str_c</span>(<span class="st">&quot;career: &quot;</span>, <span class="dv">3</span><span class="sc">:</span><span class="dv">1</span>),</span>
<span id="cb958-5"><a href="god-spiked-the-integers.html#cb958-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">color         =</span> <span class="fu">c</span>(<span class="st">&quot;a&quot;</span>, <span class="st">&quot;a&quot;</span>, <span class="st">&quot;b&quot;</span>))</span>
<span id="cb958-6"><a href="god-spiked-the-integers.html#cb958-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb958-7"><a href="god-spiked-the-integers.html#cb958-7" aria-hidden="true" tabindex="-1"></a><span class="fu">rbind</span>(fit11<span class="fl">.14</span>[, , <span class="dv">1</span>],</span>
<span id="cb958-8"><a href="god-spiked-the-integers.html#cb958-8" aria-hidden="true" tabindex="-1"></a>      fit11<span class="fl">.14</span>[, , <span class="dv">2</span>],</span>
<span id="cb958-9"><a href="god-spiked-the-integers.html#cb958-9" aria-hidden="true" tabindex="-1"></a>      fit11<span class="fl">.14</span>[, , <span class="dv">3</span>]) <span class="sc">%&gt;%</span> </span>
<span id="cb958-10"><a href="god-spiked-the-integers.html#cb958-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb958-11"><a href="god-spiked-the-integers.html#cb958-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(nd <span class="sc">%&gt;%</span> tidyr<span class="sc">::</span><span class="fu">expand</span>(<span class="at">career =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, family_income)) <span class="sc">%&gt;%</span> </span>
<span id="cb958-12"><a href="god-spiked-the-integers.html#cb958-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(family_income) <span class="sc">%&gt;%</span> </span>
<span id="cb958-13"><a href="god-spiked-the-integers.html#cb958-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">proportion =</span> Estimate <span class="sc">/</span> <span class="fu">sum</span>(Estimate),</span>
<span id="cb958-14"><a href="god-spiked-the-integers.html#cb958-14" aria-hidden="true" tabindex="-1"></a>         <span class="at">career     =</span> <span class="fu">factor</span>(career)) <span class="sc">%&gt;%</span> </span>
<span id="cb958-15"><a href="god-spiked-the-integers.html#cb958-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> family_income, <span class="at">y =</span> proportion)) <span class="sc">+</span></span>
<span id="cb958-16"><a href="god-spiked-the-integers.html#cb958-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_area</span>(<span class="fu">aes</span>(<span class="at">fill =</span> career)) <span class="sc">+</span></span>
<span id="cb958-17"><a href="god-spiked-the-integers.html#cb958-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">data =</span> text,</span>
<span id="cb958-18"><a href="god-spiked-the-integers.html#cb958-18" aria-hidden="true" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">label =</span> label, <span class="at">color =</span> color),<span class="at">size =</span> <span class="fl">4.25</span>) <span class="sc">+</span></span>
<span id="cb958-19"><a href="god-spiked-the-integers.html#cb958-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span><span class="fu">c</span>(<span class="st">&quot;grey4&quot;</span>,<span class="st">&quot;lightblue&quot;</span>,<span class="st">&quot;orange&quot;</span>)) <span class="sc">+</span></span>
<span id="cb958-20"><a href="god-spiked-the-integers.html#cb958-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;grey4&quot;</span>,<span class="st">&quot;lightblue&quot;</span>,<span class="st">&quot;orange&quot;</span>)) <span class="sc">+</span></span>
<span id="cb958-21"><a href="god-spiked-the-integers.html#cb958-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>,</span>
<span id="cb958-22"><a href="god-spiked-the-integers.html#cb958-22" aria-hidden="true" tabindex="-1"></a>        <span class="at">aspect.ratio=</span><span class="dv">1</span>) </span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:sim-prop"></span>
<img src="Rethinking_Bookdown_files/figure-html/sim-prop-1.png" alt="モデルb11.14の推定結果。収入ごとに各職業を選択する割合。" width="672" />
<p class="caption">
図11.23: モデルb11.14の推定結果。収入ごとに各職業を選択する割合。
</p>
</div>
</div>
<div id="multinomial-in-disguise-as-poisson" class="section level3 hasAnchor" number="11.4.3">
<h3><span class="header-section-number">11.4.3</span> Multinomial in disguise as Poisson<a href="god-spiked-the-integers.html#multinomial-in-disguise-as-poisson" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>多項分布をポワソン分布に変換することもできる。ロジスティック回帰の章で用いたUCバークレーの例をポワソン分布で回帰してみよう。合格者数と不合格者数がそれぞれポワソン分布から得られると考える。’brm’で’mvbind’は多変量が応答変数になるときに用いることができるオプションである。二項分布でもモデリングして比較する。</p>
<div class="sourceCode" id="cb959"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb959-1"><a href="god-spiked-the-integers.html#cb959-1" aria-hidden="true" tabindex="-1"></a>b11.binom <span class="ot">&lt;-</span></span>
<span id="cb959-2"><a href="god-spiked-the-integers.html#cb959-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">brm</span>(<span class="at">data =</span> d3, </span>
<span id="cb959-3"><a href="god-spiked-the-integers.html#cb959-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> binomial,</span>
<span id="cb959-4"><a href="god-spiked-the-integers.html#cb959-4" aria-hidden="true" tabindex="-1"></a>      admit <span class="sc">|</span> <span class="fu">trials</span>(applications) <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb959-5"><a href="god-spiked-the-integers.html#cb959-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">1.5</span>), <span class="at">class =</span> Intercept),</span>
<span id="cb959-6"><a href="god-spiked-the-integers.html#cb959-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>, <span class="at">cores =</span> <span class="dv">3</span>, <span class="at">chains =</span> <span class="dv">3</span>,</span>
<span id="cb959-7"><a href="god-spiked-the-integers.html#cb959-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">seed =</span> <span class="dv">11</span>,</span>
<span id="cb959-8"><a href="god-spiked-the-integers.html#cb959-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">backend =</span> <span class="st">&quot;cmdstanr&quot;</span>,</span>
<span id="cb959-9"><a href="god-spiked-the-integers.html#cb959-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">file =</span> <span class="st">&quot;output/Chapter11/b11.binom&quot;</span>)</span>
<span id="cb959-10"><a href="god-spiked-the-integers.html#cb959-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb959-11"><a href="god-spiked-the-integers.html#cb959-11" aria-hidden="true" tabindex="-1"></a>b11.pois <span class="ot">&lt;-</span> </span>
<span id="cb959-12"><a href="god-spiked-the-integers.html#cb959-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">brm</span>(<span class="at">data =</span> d3 <span class="sc">%&gt;%</span></span>
<span id="cb959-13"><a href="god-spiked-the-integers.html#cb959-13" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="at">rej =</span> reject),  </span>
<span id="cb959-14"><a href="god-spiked-the-integers.html#cb959-14" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> poisson,</span>
<span id="cb959-15"><a href="god-spiked-the-integers.html#cb959-15" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mvbind</span>(admit, rej) <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb959-16"><a href="god-spiked-the-integers.html#cb959-16" aria-hidden="true" tabindex="-1"></a>      <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">1.5</span>), <span class="at">class =</span> Intercept),</span>
<span id="cb959-17"><a href="god-spiked-the-integers.html#cb959-17" aria-hidden="true" tabindex="-1"></a>      <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>, <span class="at">cores =</span> <span class="dv">3</span>, <span class="at">chains =</span> <span class="dv">3</span>,</span>
<span id="cb959-18"><a href="god-spiked-the-integers.html#cb959-18" aria-hidden="true" tabindex="-1"></a>      <span class="at">seed =</span> <span class="dv">11</span>,</span>
<span id="cb959-19"><a href="god-spiked-the-integers.html#cb959-19" aria-hidden="true" tabindex="-1"></a>      <span class="at">backend =</span> <span class="st">&quot;cmdstanr&quot;</span>,</span>
<span id="cb959-20"><a href="god-spiked-the-integers.html#cb959-20" aria-hidden="true" tabindex="-1"></a>      <span class="at">file =</span> <span class="st">&quot;output/Chapter11/b11.pois&quot;</span>)</span></code></pre></div>
<p>モデルから推定された合格者数と不合格者数。</p>
<div class="sourceCode" id="cb960"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb960-1"><a href="god-spiked-the-integers.html#cb960-1" aria-hidden="true" tabindex="-1"></a>post <span class="ot">&lt;-</span> <span class="fu">posterior_samples</span>(b11.pois)</span>
<span id="cb960-2"><a href="god-spiked-the-integers.html#cb960-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb960-3"><a href="god-spiked-the-integers.html#cb960-3" aria-hidden="true" tabindex="-1"></a>post <span class="sc">%&gt;%</span></span>
<span id="cb960-4"><a href="god-spiked-the-integers.html#cb960-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">admit  =</span> <span class="fu">exp</span>(b_admit_Intercept), </span>
<span id="cb960-5"><a href="god-spiked-the-integers.html#cb960-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">reject =</span> <span class="fu">exp</span>(b_rej_Intercept)) <span class="sc">%&gt;%</span> </span>
<span id="cb960-6"><a href="god-spiked-the-integers.html#cb960-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(admit<span class="sc">:</span>reject) <span class="sc">%&gt;%</span> </span>
<span id="cb960-7"><a href="god-spiked-the-integers.html#cb960-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> value, <span class="at">y =</span> name, <span class="at">fill =</span> name)) <span class="sc">+</span></span>
<span id="cb960-8"><a href="god-spiked-the-integers.html#cb960-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_halfeye</span>(<span class="at">point_interval =</span> median_qi, <span class="at">.width =</span> .<span class="dv">95</span>) <span class="sc">+</span></span>
<span id="cb960-9"><a href="god-spiked-the-integers.html#cb960-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;lightblue&quot;</span>,<span class="st">&quot;orange&quot;</span>)) <span class="sc">+</span></span>
<span id="cb960-10"><a href="god-spiked-the-integers.html#cb960-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot; Mean admit/reject rates across departments&quot;</span>,</span>
<span id="cb960-11"><a href="god-spiked-the-integers.html#cb960-11" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">&quot;# applications&quot;</span>,</span>
<span id="cb960-12"><a href="god-spiked-the-integers.html#cb960-12" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb960-13"><a href="god-spiked-the-integers.html#cb960-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.ticks.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb960-14"><a href="god-spiked-the-integers.html#cb960-14" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:unnamed-chunk-508"></span>
<img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-508-1.png" alt="b11.poisから推定された同格者数とふ不合格者数" width="672" />
<p class="caption">
図11.24: b11.poisから推定された同格者数とふ不合格者数
</p>
</div>
<p>それぞれのモデルの結果から、合格する確率の事後平均を求める。 ほとんど一致することが分かる。</p>
<div class="sourceCode" id="cb961"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb961-1"><a href="god-spiked-the-integers.html#cb961-1" aria-hidden="true" tabindex="-1"></a><span class="do">## 二項分布  </span></span>
<span id="cb961-2"><a href="god-spiked-the-integers.html#cb961-2" aria-hidden="true" tabindex="-1"></a><span class="fu">fixef</span>(b11.binom)[,<span class="dv">1</span>] <span class="sc">%&gt;%</span> </span>
<span id="cb961-3"><a href="god-spiked-the-integers.html#cb961-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inv_logit_scaled</span>()</span></code></pre></div>
<pre><code>## [1] 0.3880132</code></pre>
<div class="sourceCode" id="cb963"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb963-1"><a href="god-spiked-the-integers.html#cb963-1" aria-hidden="true" tabindex="-1"></a><span class="do">## ポワソン分布  </span></span>
<span id="cb963-2"><a href="god-spiked-the-integers.html#cb963-2" aria-hidden="true" tabindex="-1"></a><span class="fu">fixef</span>(b11.pois) <span class="sc">%&gt;%</span> </span>
<span id="cb963-3"><a href="god-spiked-the-integers.html#cb963-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.numeric</span>() <span class="ot">-&gt;</span>k</span>
<span id="cb963-4"><a href="god-spiked-the-integers.html#cb963-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb963-5"><a href="god-spiked-the-integers.html#cb963-5" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(k[<span class="dv">1</span>])<span class="sc">/</span>(<span class="fu">exp</span>(k[<span class="dv">1</span>])<span class="sc">+</span><span class="fu">exp</span>(k[<span class="dv">2</span>]))</span></code></pre></div>
<pre><code>## [1] 0.3879595</code></pre>
<p>合格確率の事後分布もほとんど同じになる。このことからも、カテゴリカル回帰（ロジスティック回帰）はポワソン回帰でも可能であることが分かった。</p>
<div class="sourceCode" id="cb965"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb965-1"><a href="god-spiked-the-integers.html#cb965-1" aria-hidden="true" tabindex="-1"></a><span class="fu">bind_cols</span>(</span>
<span id="cb965-2"><a href="god-spiked-the-integers.html#cb965-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">posterior_samples</span>(b11.pois) <span class="sc">%&gt;%</span> </span>
<span id="cb965-3"><a href="god-spiked-the-integers.html#cb965-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="st">`</span><span class="at">the Poisson</span><span class="st">`</span>  <span class="ot">=</span> <span class="fu">exp</span>(b_admit_Intercept) <span class="sc">/</span> (<span class="fu">exp</span>(b_admit_Intercept) <span class="sc">+</span> <span class="fu">exp</span>(b_rej_Intercept))),</span>
<span id="cb965-4"><a href="god-spiked-the-integers.html#cb965-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">posterior_samples</span>(b11.binom) <span class="sc">%&gt;%</span> </span>
<span id="cb965-5"><a href="god-spiked-the-integers.html#cb965-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="st">`</span><span class="at">the binomial</span><span class="st">`</span><span class="ot">=</span><span class="fu">inv_logit_scaled</span>(b_Intercept))</span>
<span id="cb965-6"><a href="god-spiked-the-integers.html#cb965-6" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb965-7"><a href="god-spiked-the-integers.html#cb965-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">starts_with</span>(<span class="st">&quot;the&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb965-8"><a href="god-spiked-the-integers.html#cb965-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> value, <span class="at">y =</span> name, <span class="at">fill =</span> name)) <span class="sc">+</span></span>
<span id="cb965-9"><a href="god-spiked-the-integers.html#cb965-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_halfeye</span>(<span class="at">point_interval =</span> median_qi,</span>
<span id="cb965-10"><a href="god-spiked-the-integers.html#cb965-10" aria-hidden="true" tabindex="-1"></a>               <span class="at">.width =</span><span class="fu">c</span>(.<span class="dv">95</span>, .<span class="dv">5</span>)) <span class="sc">+</span></span>
<span id="cb965-11"><a href="god-spiked-the-integers.html#cb965-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;lightblue&quot;</span>,<span class="st">&quot;orange&quot;</span>)) <span class="sc">+</span></span>
<span id="cb965-12"><a href="god-spiked-the-integers.html#cb965-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Two models, same marginal posterior&quot;</span>,</span>
<span id="cb965-13"><a href="god-spiked-the-integers.html#cb965-13" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">&quot;admissions probability&quot;</span>,</span>
<span id="cb965-14"><a href="god-spiked-the-integers.html#cb965-14" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb965-15"><a href="god-spiked-the-integers.html#cb965-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="fl">1.5</span>, <span class="fl">2.25</span>)) <span class="sc">+</span></span>
<span id="cb965-16"><a href="god-spiked-the-integers.html#cb965-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="dv">0</span>),</span>
<span id="cb965-17"><a href="god-spiked-the-integers.html#cb965-17" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.ticks.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb965-18"><a href="god-spiked-the-integers.html#cb965-18" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>,</span>
<span id="cb965-19"><a href="god-spiked-the-integers.html#cb965-19" aria-hidden="true" tabindex="-1"></a>        <span class="at">aspect.ratio=</span><span class="dv">1</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:unnamed-chunk-510"></span>
<img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-510-1.png" alt="b11.binomとb11.poisによる合格確率の事後分布。" width="672" />
<p class="caption">
図11.25: b11.binomとb11.poisによる合格確率の事後分布。
</p>
</div>
</div>
</div>
<div id="practice-8" class="section level2 hasAnchor" number="11.5">
<h2><span class="header-section-number">11.5</span> Practice<a href="god-spiked-the-integers.html#practice-8" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="e1" class="section level3 hasAnchor" number="11.5.1">
<h3><span class="header-section-number">11.5.1</span> 11E1<a href="god-spiked-the-integers.html#e1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<blockquote>
<p>11E1. If an event has probability 0.35, what are the log-odds of this event?</p>
</blockquote>
<div class="sourceCode" id="cb966"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb966-1"><a href="god-spiked-the-integers.html#cb966-1" aria-hidden="true" tabindex="-1"></a><span class="fu">log</span>(<span class="fl">0.35</span> <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">-</span> <span class="fl">0.35</span>))</span></code></pre></div>
<pre><code>## [1] -0.6190392</code></pre>
</div>
<div id="e2-1" class="section level3 hasAnchor" number="11.5.2">
<h3><span class="header-section-number">11.5.2</span> 11E2<a href="god-spiked-the-integers.html#e2-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<blockquote>
<p>If an event has log-odds 3.2, what is the probability of this event?</p>
</blockquote>
<div class="sourceCode" id="cb968"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb968-1"><a href="god-spiked-the-integers.html#cb968-1" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(<span class="fl">3.2</span>) <span class="sc">/</span> (<span class="fu">exp</span>(<span class="fl">3.2</span>) <span class="sc">+</span> <span class="dv">1</span>)</span></code></pre></div>
<pre><code>## [1] 0.9608343</code></pre>
</div>
<div id="e3-1" class="section level3 hasAnchor" number="11.5.3">
<h3><span class="header-section-number">11.5.3</span> 11E3<a href="god-spiked-the-integers.html#e3-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<blockquote>
<p>Suppose that a coefficient in a logistic regression has value 1.7. What does this imply about the proportional change in odds of the outcome?</p>
</blockquote>
<div class="sourceCode" id="cb970"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb970-1"><a href="god-spiked-the-integers.html#cb970-1" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(<span class="fl">1.7</span>)</span></code></pre></div>
<pre><code>## [1] 5.473947</code></pre>
</div>
<div id="e4-1" class="section level3 hasAnchor" number="11.5.4">
<h3><span class="header-section-number">11.5.4</span> 11E4<a href="god-spiked-the-integers.html#e4-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<blockquote>
<p>Why do Poisson regressions sometimes require the use of an offset? Provide an example.</p>
</blockquote>
<p>観察ごとに観察時間が異なる場合に必要になる(e.g., 頻度データなど)。</p>
</div>
<div id="m7-2" class="section level3 hasAnchor" number="11.5.5">
<h3><span class="header-section-number">11.5.5</span> 11M7<a href="god-spiked-the-integers.html#m7-2" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<blockquote>
<p>Use quap to construct a quadratic approximate posterior distribution for the chimpanzee model that includes a unique intercept for each action, m11.4 (page 330). Compare the quadratic approximation to the posterior distribution produced instead from MCMC. Can you explain both the differences and the similarities between the approximate and the MCMC distributions? Relax the prior on the actor intercepts to Normal(0,10). Re-estimate the posterior using both ulam and quap. Do the difference increase or decrease? Why?</p>
</blockquote>
<p>二次近似によるモデルの結果と比較する。</p>
<div class="sourceCode" id="cb972"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb972-1"><a href="god-spiked-the-integers.html#cb972-1" aria-hidden="true" tabindex="-1"></a>m11<span class="fl">.4</span>quap <span class="ot">&lt;-</span> <span class="fu">quap</span>(</span>
<span id="cb972-2"><a href="god-spiked-the-integers.html#cb972-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">alist</span>(</span>
<span id="cb972-3"><a href="god-spiked-the-integers.html#cb972-3" aria-hidden="true" tabindex="-1"></a>    pulled_left <span class="sc">~</span> <span class="fu">dbinom</span>(<span class="dv">1</span>, p),</span>
<span id="cb972-4"><a href="god-spiked-the-integers.html#cb972-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">logit</span>(p) <span class="ot">&lt;-</span> a[actor] <span class="sc">+</span> b[treatment],</span>
<span id="cb972-5"><a href="god-spiked-the-integers.html#cb972-5" aria-hidden="true" tabindex="-1"></a>    a[actor] <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, <span class="fl">1.5</span>),</span>
<span id="cb972-6"><a href="god-spiked-the-integers.html#cb972-6" aria-hidden="true" tabindex="-1"></a>    b[treatment] <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, <span class="fl">0.5</span>)</span>
<span id="cb972-7"><a href="god-spiked-the-integers.html#cb972-7" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb972-8"><a href="god-spiked-the-integers.html#cb972-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> d</span>
<span id="cb972-9"><a href="god-spiked-the-integers.html#cb972-9" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p>大きな違いはないことが分かる。</p>
<div class="sourceCode" id="cb973"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb973-1"><a href="god-spiked-the-integers.html#cb973-1" aria-hidden="true" tabindex="-1"></a><span class="fu">precis</span>(m11<span class="fl">.4</span>quap, <span class="at">depth=</span><span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb973-2"><a href="god-spiked-the-integers.html#cb973-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb973-3"><a href="god-spiked-the-integers.html#cb973-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>(<span class="at">var =</span> <span class="st">&quot;parameter&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb973-4"><a href="god-spiked-the-integers.html#cb973-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="at">digits =</span><span class="dv">2</span>, <span class="at">caption =</span> <span class="st">&quot;二次近似による推定結果&quot;</span>,</span>
<span id="cb973-5"><a href="god-spiked-the-integers.html#cb973-5" aria-hidden="true" tabindex="-1"></a>        <span class="at">booktabs =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb973-6"><a href="god-spiked-the-integers.html#cb973-6" aria-hidden="true" tabindex="-1"></a>   <span class="fu">kable_styling</span>(<span class="at">latex_options =</span> <span class="st">&quot;striped&quot;</span>)</span></code></pre></div>
<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:unnamed-chunk-515">表11.21: </span>二次近似による推定結果
</caption>
<thead>
<tr>
<th style="text-align:left;">
parameter
</th>
<th style="text-align:right;">
mean
</th>
<th style="text-align:right;">
sd
</th>
<th style="text-align:right;">
X5.5.
</th>
<th style="text-align:right;">
X94.5.
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
a[1]
</td>
<td style="text-align:right;">
-0.44
</td>
<td style="text-align:right;">
0.33
</td>
<td style="text-align:right;">
-0.96
</td>
<td style="text-align:right;">
0.08
</td>
</tr>
<tr>
<td style="text-align:left;">
a[2]
</td>
<td style="text-align:right;">
3.71
</td>
<td style="text-align:right;">
0.72
</td>
<td style="text-align:right;">
2.55
</td>
<td style="text-align:right;">
4.86
</td>
</tr>
<tr>
<td style="text-align:left;">
a[3]
</td>
<td style="text-align:right;">
-0.73
</td>
<td style="text-align:right;">
0.33
</td>
<td style="text-align:right;">
-1.26
</td>
<td style="text-align:right;">
-0.20
</td>
</tr>
<tr>
<td style="text-align:left;">
a[4]
</td>
<td style="text-align:right;">
-0.73
</td>
<td style="text-align:right;">
0.33
</td>
<td style="text-align:right;">
-1.26
</td>
<td style="text-align:right;">
-0.20
</td>
</tr>
<tr>
<td style="text-align:left;">
a[5]
</td>
<td style="text-align:right;">
-0.44
</td>
<td style="text-align:right;">
0.33
</td>
<td style="text-align:right;">
-0.96
</td>
<td style="text-align:right;">
0.08
</td>
</tr>
<tr>
<td style="text-align:left;">
a[6]
</td>
<td style="text-align:right;">
0.47
</td>
<td style="text-align:right;">
0.33
</td>
<td style="text-align:right;">
-0.06
</td>
<td style="text-align:right;">
1.00
</td>
</tr>
<tr>
<td style="text-align:left;">
a[7]
</td>
<td style="text-align:right;">
1.91
</td>
<td style="text-align:right;">
0.41
</td>
<td style="text-align:right;">
1.24
</td>
<td style="text-align:right;">
2.57
</td>
</tr>
<tr>
<td style="text-align:left;">
b[1]
</td>
<td style="text-align:right;">
-0.04
</td>
<td style="text-align:right;">
0.28
</td>
<td style="text-align:right;">
-0.49
</td>
<td style="text-align:right;">
0.41
</td>
</tr>
<tr>
<td style="text-align:left;">
b[2]
</td>
<td style="text-align:right;">
0.47
</td>
<td style="text-align:right;">
0.28
</td>
<td style="text-align:right;">
0.02
</td>
<td style="text-align:right;">
0.93
</td>
</tr>
<tr>
<td style="text-align:left;">
b[3]
</td>
<td style="text-align:right;">
-0.38
</td>
<td style="text-align:right;">
0.29
</td>
<td style="text-align:right;">
-0.83
</td>
<td style="text-align:right;">
0.08
</td>
</tr>
<tr>
<td style="text-align:left;">
b[4]
</td>
<td style="text-align:right;">
0.36
</td>
<td style="text-align:right;">
0.28
</td>
<td style="text-align:right;">
-0.09
</td>
<td style="text-align:right;">
0.82
</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb974"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb974-1"><a href="god-spiked-the-integers.html#cb974-1" aria-hidden="true" tabindex="-1"></a><span class="fu">posterior_summary</span>(b11<span class="fl">.4</span>, <span class="at">probs =</span> <span class="fu">c</span>(<span class="fl">0.045</span>, <span class="fl">0.955</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb974-2"><a href="god-spiked-the-integers.html#cb974-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb974-3"><a href="god-spiked-the-integers.html#cb974-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>(<span class="at">var =</span> <span class="st">&quot;parameter&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb974-4"><a href="god-spiked-the-integers.html#cb974-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">str_detect</span>(parameter,<span class="fu">c</span>(<span class="st">&quot;prior&quot;</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb974-5"><a href="god-spiked-the-integers.html#cb974-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(parameter<span class="sc">!=</span> <span class="st">&quot;lp__&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb974-6"><a href="god-spiked-the-integers.html#cb974-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="at">digits =</span><span class="dv">2</span> , <span class="at">caption =</span> <span class="st">&quot;MCMCによる推定結果&quot;</span>,</span>
<span id="cb974-7"><a href="god-spiked-the-integers.html#cb974-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">booktabs =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb974-8"><a href="god-spiked-the-integers.html#cb974-8" aria-hidden="true" tabindex="-1"></a>   <span class="fu">kable_styling</span>(<span class="at">latex_options =</span> <span class="st">&quot;striped&quot;</span>)</span></code></pre></div>
<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:unnamed-chunk-516">表11.22: </span>MCMCによる推定結果
</caption>
<thead>
<tr>
<th style="text-align:left;">
parameter
</th>
<th style="text-align:right;">
Estimate
</th>
<th style="text-align:right;">
Est.Error
</th>
<th style="text-align:right;">
Q4.5
</th>
<th style="text-align:right;">
Q95.5
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
b_a_actor1
</td>
<td style="text-align:right;">
-0.46
</td>
<td style="text-align:right;">
0.32
</td>
<td style="text-align:right;">
-1.01
</td>
<td style="text-align:right;">
0.07
</td>
</tr>
<tr>
<td style="text-align:left;">
b_a_actor2
</td>
<td style="text-align:right;">
3.89
</td>
<td style="text-align:right;">
0.74
</td>
<td style="text-align:right;">
2.73
</td>
<td style="text-align:right;">
5.26
</td>
</tr>
<tr>
<td style="text-align:left;">
b_a_actor3
</td>
<td style="text-align:right;">
-0.76
</td>
<td style="text-align:right;">
0.33
</td>
<td style="text-align:right;">
-1.33
</td>
<td style="text-align:right;">
-0.19
</td>
</tr>
<tr>
<td style="text-align:left;">
b_a_actor4
</td>
<td style="text-align:right;">
-0.76
</td>
<td style="text-align:right;">
0.33
</td>
<td style="text-align:right;">
-1.30
</td>
<td style="text-align:right;">
-0.20
</td>
</tr>
<tr>
<td style="text-align:left;">
b_a_actor5
</td>
<td style="text-align:right;">
-0.47
</td>
<td style="text-align:right;">
0.33
</td>
<td style="text-align:right;">
-1.02
</td>
<td style="text-align:right;">
0.09
</td>
</tr>
<tr>
<td style="text-align:left;">
b_a_actor6
</td>
<td style="text-align:right;">
0.47
</td>
<td style="text-align:right;">
0.33
</td>
<td style="text-align:right;">
-0.08
</td>
<td style="text-align:right;">
1.01
</td>
</tr>
<tr>
<td style="text-align:left;">
b_a_actor7
</td>
<td style="text-align:right;">
1.94
</td>
<td style="text-align:right;">
0.43
</td>
<td style="text-align:right;">
1.25
</td>
<td style="text-align:right;">
2.69
</td>
</tr>
<tr>
<td style="text-align:left;">
b_b_treatment1
</td>
<td style="text-align:right;">
-0.03
</td>
<td style="text-align:right;">
0.28
</td>
<td style="text-align:right;">
-0.49
</td>
<td style="text-align:right;">
0.44
</td>
</tr>
<tr>
<td style="text-align:left;">
b_b_treatment2
</td>
<td style="text-align:right;">
0.49
</td>
<td style="text-align:right;">
0.29
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;">
0.98
</td>
</tr>
<tr>
<td style="text-align:left;">
b_b_treatment3
</td>
<td style="text-align:right;">
-0.37
</td>
<td style="text-align:right;">
0.29
</td>
<td style="text-align:right;">
-0.86
</td>
<td style="text-align:right;">
0.11
</td>
</tr>
<tr>
<td style="text-align:left;">
b_b_treatment4
</td>
<td style="text-align:right;">
0.38
</td>
<td style="text-align:right;">
0.28
</td>
<td style="text-align:right;">
-0.10
</td>
<td style="text-align:right;">
0.86
</td>
</tr>
</tbody>
</table>
<p>続いて、切片の事前分布が<span class="math inline">\(Normal(0,10)\)</span>のときを考える。</p>
<div class="sourceCode" id="cb975"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb975-1"><a href="god-spiked-the-integers.html#cb975-1" aria-hidden="true" tabindex="-1"></a><span class="co"># quap</span></span>
<span id="cb975-2"><a href="god-spiked-the-integers.html#cb975-2" aria-hidden="true" tabindex="-1"></a>m11<span class="fl">.4</span>quap_2 <span class="ot">&lt;-</span> <span class="fu">quap</span>(</span>
<span id="cb975-3"><a href="god-spiked-the-integers.html#cb975-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">alist</span>(</span>
<span id="cb975-4"><a href="god-spiked-the-integers.html#cb975-4" aria-hidden="true" tabindex="-1"></a>    pulled_left <span class="sc">~</span> <span class="fu">dbinom</span>(<span class="dv">1</span>, p),</span>
<span id="cb975-5"><a href="god-spiked-the-integers.html#cb975-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">logit</span>(p) <span class="ot">&lt;-</span> a[actor] <span class="sc">+</span> b[treatment],</span>
<span id="cb975-6"><a href="god-spiked-the-integers.html#cb975-6" aria-hidden="true" tabindex="-1"></a>    a[actor] <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, <span class="dv">10</span>),</span>
<span id="cb975-7"><a href="god-spiked-the-integers.html#cb975-7" aria-hidden="true" tabindex="-1"></a>    b[treatment] <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, <span class="fl">0.5</span>)</span>
<span id="cb975-8"><a href="god-spiked-the-integers.html#cb975-8" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb975-9"><a href="god-spiked-the-integers.html#cb975-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> d</span>
<span id="cb975-10"><a href="god-spiked-the-integers.html#cb975-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb975-11"><a href="god-spiked-the-integers.html#cb975-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb975-12"><a href="god-spiked-the-integers.html#cb975-12" aria-hidden="true" tabindex="-1"></a><span class="do">## MCMC  </span></span>
<span id="cb975-13"><a href="god-spiked-the-integers.html#cb975-13" aria-hidden="true" tabindex="-1"></a>b11<span class="fl">.4</span>_2 <span class="ot">&lt;-</span> <span class="fu">brm</span>(<span class="at">data =</span> d, </span>
<span id="cb975-14"><a href="god-spiked-the-integers.html#cb975-14" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> binomial,</span>
<span id="cb975-15"><a href="god-spiked-the-integers.html#cb975-15" aria-hidden="true" tabindex="-1"></a>      <span class="fu">bf</span>(pulled_left <span class="sc">|</span> <span class="fu">trials</span>(<span class="dv">1</span>) <span class="sc">~</span> a　<span class="sc">+</span> b ,</span>
<span id="cb975-16"><a href="god-spiked-the-integers.html#cb975-16" aria-hidden="true" tabindex="-1"></a>         a <span class="sc">~</span> <span class="dv">0</span><span class="sc">+</span> actor,</span>
<span id="cb975-17"><a href="god-spiked-the-integers.html#cb975-17" aria-hidden="true" tabindex="-1"></a>         b <span class="sc">~</span> <span class="dv">0</span><span class="sc">+</span> treatment,</span>
<span id="cb975-18"><a href="god-spiked-the-integers.html#cb975-18" aria-hidden="true" tabindex="-1"></a>         <span class="at">nl =</span> <span class="cn">TRUE</span>),</span>
<span id="cb975-19"><a href="god-spiked-the-integers.html#cb975-19" aria-hidden="true" tabindex="-1"></a>      <span class="at">prior=</span><span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">10</span>), <span class="at">nlpar =</span> a),</span>
<span id="cb975-20"><a href="god-spiked-the-integers.html#cb975-20" aria-hidden="true" tabindex="-1"></a>              <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">0.5</span>), <span class="at">nlpar =</span> b)),</span>
<span id="cb975-21"><a href="god-spiked-the-integers.html#cb975-21" aria-hidden="true" tabindex="-1"></a>      <span class="at">seed =</span> <span class="dv">11</span>,</span>
<span id="cb975-22"><a href="god-spiked-the-integers.html#cb975-22" aria-hidden="true" tabindex="-1"></a>      <span class="at">sample_prior =</span> <span class="cn">TRUE</span>,</span>
<span id="cb975-23"><a href="god-spiked-the-integers.html#cb975-23" aria-hidden="true" tabindex="-1"></a>      <span class="at">backend =</span> <span class="st">&quot;cmdstanr&quot;</span>,</span>
<span id="cb975-24"><a href="god-spiked-the-integers.html#cb975-24" aria-hidden="true" tabindex="-1"></a>      <span class="at">file =</span> <span class="st">&quot;output/Chapter11/b11.4_2&quot;</span>)</span></code></pre></div>
<p>個体2の推定結果が大きく異なるが、それ以外はあまり変わらない。</p>
<div class="sourceCode" id="cb976"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb976-1"><a href="god-spiked-the-integers.html#cb976-1" aria-hidden="true" tabindex="-1"></a><span class="fu">precis</span>(m11<span class="fl">.4</span>quap_2, <span class="at">depth=</span><span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb976-2"><a href="god-spiked-the-integers.html#cb976-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb976-3"><a href="god-spiked-the-integers.html#cb976-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>(<span class="at">var =</span> <span class="st">&quot;parameter&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb976-4"><a href="god-spiked-the-integers.html#cb976-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="at">digits =</span><span class="dv">2</span>, <span class="at">caption =</span> <span class="st">&quot;二次近似による推定結果(Normal(0,10))&quot;</span>,</span>
<span id="cb976-5"><a href="god-spiked-the-integers.html#cb976-5" aria-hidden="true" tabindex="-1"></a>        <span class="at">booktabs =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb976-6"><a href="god-spiked-the-integers.html#cb976-6" aria-hidden="true" tabindex="-1"></a>   <span class="fu">kable_styling</span>(<span class="at">latex_options =</span> <span class="st">&quot;striped&quot;</span>)</span></code></pre></div>
<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:unnamed-chunk-518">表11.23: </span>二次近似による推定結果(Normal(0,10))
</caption>
<thead>
<tr>
<th style="text-align:left;">
parameter
</th>
<th style="text-align:right;">
mean
</th>
<th style="text-align:right;">
sd
</th>
<th style="text-align:right;">
X5.5.
</th>
<th style="text-align:right;">
X94.5.
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
a[1]
</td>
<td style="text-align:right;">
-0.35
</td>
<td style="text-align:right;">
0.35
</td>
<td style="text-align:right;">
-0.91
</td>
<td style="text-align:right;">
0.20
</td>
</tr>
<tr>
<td style="text-align:left;">
a[2]
</td>
<td style="text-align:right;">
6.99
</td>
<td style="text-align:right;">
3.55
</td>
<td style="text-align:right;">
1.33
</td>
<td style="text-align:right;">
12.66
</td>
</tr>
<tr>
<td style="text-align:left;">
a[3]
</td>
<td style="text-align:right;">
-0.65
</td>
<td style="text-align:right;">
0.35
</td>
<td style="text-align:right;">
-1.22
</td>
<td style="text-align:right;">
-0.09
</td>
</tr>
<tr>
<td style="text-align:left;">
a[4]
</td>
<td style="text-align:right;">
-0.65
</td>
<td style="text-align:right;">
0.35
</td>
<td style="text-align:right;">
-1.22
</td>
<td style="text-align:right;">
-0.09
</td>
</tr>
<tr>
<td style="text-align:left;">
a[5]
</td>
<td style="text-align:right;">
-0.35
</td>
<td style="text-align:right;">
0.35
</td>
<td style="text-align:right;">
-0.91
</td>
<td style="text-align:right;">
0.20
</td>
</tr>
<tr>
<td style="text-align:left;">
a[6]
</td>
<td style="text-align:right;">
0.58
</td>
<td style="text-align:right;">
0.35
</td>
<td style="text-align:right;">
0.02
</td>
<td style="text-align:right;">
1.14
</td>
</tr>
<tr>
<td style="text-align:left;">
a[7]
</td>
<td style="text-align:right;">
2.12
</td>
<td style="text-align:right;">
0.45
</td>
<td style="text-align:right;">
1.40
</td>
<td style="text-align:right;">
2.84
</td>
</tr>
<tr>
<td style="text-align:left;">
b[1]
</td>
<td style="text-align:right;">
-0.14
</td>
<td style="text-align:right;">
0.30
</td>
<td style="text-align:right;">
-0.62
</td>
<td style="text-align:right;">
0.34
</td>
</tr>
<tr>
<td style="text-align:left;">
b[2]
</td>
<td style="text-align:right;">
0.38
</td>
<td style="text-align:right;">
0.30
</td>
<td style="text-align:right;">
-0.10
</td>
<td style="text-align:right;">
0.86
</td>
</tr>
<tr>
<td style="text-align:left;">
b[3]
</td>
<td style="text-align:right;">
-0.49
</td>
<td style="text-align:right;">
0.30
</td>
<td style="text-align:right;">
-0.97
</td>
<td style="text-align:right;">
-0.01
</td>
</tr>
<tr>
<td style="text-align:left;">
b[4]
</td>
<td style="text-align:right;">
0.27
</td>
<td style="text-align:right;">
0.30
</td>
<td style="text-align:right;">
-0.21
</td>
<td style="text-align:right;">
0.75
</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb977"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb977-1"><a href="god-spiked-the-integers.html#cb977-1" aria-hidden="true" tabindex="-1"></a><span class="fu">posterior_summary</span>(b11<span class="fl">.4</span>_2, <span class="at">probs =</span> <span class="fu">c</span>(<span class="fl">0.045</span>, <span class="fl">0.955</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb977-2"><a href="god-spiked-the-integers.html#cb977-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb977-3"><a href="god-spiked-the-integers.html#cb977-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>(<span class="at">var =</span> <span class="st">&quot;parameter&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb977-4"><a href="god-spiked-the-integers.html#cb977-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">str_detect</span>(parameter,<span class="fu">c</span>(<span class="st">&quot;prior&quot;</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb977-5"><a href="god-spiked-the-integers.html#cb977-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(parameter<span class="sc">!=</span> <span class="st">&quot;lp__&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb977-6"><a href="god-spiked-the-integers.html#cb977-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="at">digits =</span><span class="dv">2</span> , <span class="at">caption =</span> <span class="st">&quot;MCMCによる推定結果(Normal(1,10))&quot;</span>,</span>
<span id="cb977-7"><a href="god-spiked-the-integers.html#cb977-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">booktabs =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb977-8"><a href="god-spiked-the-integers.html#cb977-8" aria-hidden="true" tabindex="-1"></a>   <span class="fu">kable_styling</span>(<span class="at">latex_options =</span> <span class="st">&quot;striped&quot;</span>)</span></code></pre></div>
<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:unnamed-chunk-519">表11.24: </span>MCMCによる推定結果(Normal(1,10))
</caption>
<thead>
<tr>
<th style="text-align:left;">
parameter
</th>
<th style="text-align:right;">
Estimate
</th>
<th style="text-align:right;">
Est.Error
</th>
<th style="text-align:right;">
Q4.5
</th>
<th style="text-align:right;">
Q95.5
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
b_a_actor1
</td>
<td style="text-align:right;">
-0.39
</td>
<td style="text-align:right;">
0.34
</td>
<td style="text-align:right;">
-0.97
</td>
<td style="text-align:right;">
0.19
</td>
</tr>
<tr>
<td style="text-align:left;">
b_a_actor2
</td>
<td style="text-align:right;">
11.10
</td>
<td style="text-align:right;">
5.36
</td>
<td style="text-align:right;">
4.65
</td>
<td style="text-align:right;">
21.87
</td>
</tr>
<tr>
<td style="text-align:left;">
b_a_actor3
</td>
<td style="text-align:right;">
-0.69
</td>
<td style="text-align:right;">
0.35
</td>
<td style="text-align:right;">
-1.29
</td>
<td style="text-align:right;">
-0.11
</td>
</tr>
<tr>
<td style="text-align:left;">
b_a_actor4
</td>
<td style="text-align:right;">
-0.70
</td>
<td style="text-align:right;">
0.35
</td>
<td style="text-align:right;">
-1.30
</td>
<td style="text-align:right;">
-0.09
</td>
</tr>
<tr>
<td style="text-align:left;">
b_a_actor5
</td>
<td style="text-align:right;">
-0.39
</td>
<td style="text-align:right;">
0.35
</td>
<td style="text-align:right;">
-1.01
</td>
<td style="text-align:right;">
0.20
</td>
</tr>
<tr>
<td style="text-align:left;">
b_a_actor6
</td>
<td style="text-align:right;">
0.56
</td>
<td style="text-align:right;">
0.36
</td>
<td style="text-align:right;">
-0.06
</td>
<td style="text-align:right;">
1.16
</td>
</tr>
<tr>
<td style="text-align:left;">
b_a_actor7
</td>
<td style="text-align:right;">
2.15
</td>
<td style="text-align:right;">
0.46
</td>
<td style="text-align:right;">
1.41
</td>
<td style="text-align:right;">
2.97
</td>
</tr>
<tr>
<td style="text-align:left;">
b_b_treatment1
</td>
<td style="text-align:right;">
-0.12
</td>
<td style="text-align:right;">
0.30
</td>
<td style="text-align:right;">
-0.64
</td>
<td style="text-align:right;">
0.39
</td>
</tr>
<tr>
<td style="text-align:left;">
b_b_treatment2
</td>
<td style="text-align:right;">
0.42
</td>
<td style="text-align:right;">
0.30
</td>
<td style="text-align:right;">
-0.11
</td>
<td style="text-align:right;">
0.92
</td>
</tr>
<tr>
<td style="text-align:left;">
b_b_treatment3
</td>
<td style="text-align:right;">
-0.47
</td>
<td style="text-align:right;">
0.30
</td>
<td style="text-align:right;">
-0.99
</td>
<td style="text-align:right;">
0.03
</td>
</tr>
<tr>
<td style="text-align:left;">
b_b_treatment4
</td>
<td style="text-align:right;">
0.30
</td>
<td style="text-align:right;">
0.30
</td>
<td style="text-align:right;">
-0.21
</td>
<td style="text-align:right;">
0.81
</td>
</tr>
</tbody>
</table>
</div>
<div id="m8-1" class="section level3 hasAnchor" number="11.5.6">
<h3><span class="header-section-number">11.5.6</span> 11M8<a href="god-spiked-the-integers.html#m8-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<blockquote>
<p>Revisit the data(Kline) islands example. This time drop Hawaii from the sample and refit the models. What changes do you observe?</p>
</blockquote>
<div class="sourceCode" id="cb978"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb978-1"><a href="god-spiked-the-integers.html#cb978-1" aria-hidden="true" tabindex="-1"></a>d4 <span class="sc">%&gt;%</span> </span>
<span id="cb978-2"><a href="god-spiked-the-integers.html#cb978-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(culture <span class="sc">!=</span> <span class="st">&quot;Hawaii&quot;</span>) <span class="ot">-&gt;</span> d4_2</span>
<span id="cb978-3"><a href="god-spiked-the-integers.html#cb978-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb978-4"><a href="god-spiked-the-integers.html#cb978-4" aria-hidden="true" tabindex="-1"></a>b11<span class="fl">.10</span>_2 <span class="ot">&lt;-</span> <span class="fu">brm</span>(</span>
<span id="cb978-5"><a href="god-spiked-the-integers.html#cb978-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> d4_2,</span>
<span id="cb978-6"><a href="god-spiked-the-integers.html#cb978-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> poisson,</span>
<span id="cb978-7"><a href="god-spiked-the-integers.html#cb978-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">formula =</span> <span class="fu">bf</span>(total_tools <span class="sc">~</span> <span class="dv">0</span> <span class="sc">+</span> a <span class="sc">+</span> b <span class="sc">*</span> P, </span>
<span id="cb978-8"><a href="god-spiked-the-integers.html#cb978-8" aria-hidden="true" tabindex="-1"></a>         a <span class="sc">~</span> <span class="dv">0</span> <span class="sc">+</span> cid, </span>
<span id="cb978-9"><a href="god-spiked-the-integers.html#cb978-9" aria-hidden="true" tabindex="-1"></a>         b <span class="sc">~</span> <span class="dv">0</span> <span class="sc">+</span> cid,</span>
<span id="cb978-10"><a href="god-spiked-the-integers.html#cb978-10" aria-hidden="true" tabindex="-1"></a>         <span class="at">nl =</span> <span class="cn">TRUE</span>),</span>
<span id="cb978-11"><a href="god-spiked-the-integers.html#cb978-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">3</span>, <span class="fl">0.5</span>), <span class="at">nlpar=</span>a),</span>
<span id="cb978-12"><a href="god-spiked-the-integers.html#cb978-12" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">0.2</span>), <span class="at">nlpar=</span>b)),</span>
<span id="cb978-13"><a href="god-spiked-the-integers.html#cb978-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed=</span><span class="dv">8</span>,</span>
<span id="cb978-14"><a href="god-spiked-the-integers.html#cb978-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">backend =</span> <span class="st">&quot;cmdstanr&quot;</span>,</span>
<span id="cb978-15"><a href="god-spiked-the-integers.html#cb978-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">file =</span> <span class="st">&quot;output/Chapter11/b11.10_2&quot;</span></span>
<span id="cb978-16"><a href="god-spiked-the-integers.html#cb978-16" aria-hidden="true" tabindex="-1"></a>)　　</span></code></pre></div>
<p>ハワイを除いたとき、contactが低い国の傾きが半分程度になっていることが分かる。</p>
<div class="sourceCode" id="cb979"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb979-1"><a href="god-spiked-the-integers.html#cb979-1" aria-hidden="true" tabindex="-1"></a><span class="fu">posterior_summary</span>(b11<span class="fl">.10</span>, <span class="at">probs =</span> <span class="fu">c</span>(<span class="fl">0.045</span>, <span class="fl">0.955</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb979-2"><a href="god-spiked-the-integers.html#cb979-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb979-3"><a href="god-spiked-the-integers.html#cb979-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>(<span class="at">var =</span> <span class="st">&quot;parameter&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb979-4"><a href="god-spiked-the-integers.html#cb979-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">str_detect</span>(parameter,<span class="fu">c</span>(<span class="st">&quot;prior&quot;</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb979-5"><a href="god-spiked-the-integers.html#cb979-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(parameter<span class="sc">!=</span> <span class="st">&quot;lp__&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb979-6"><a href="god-spiked-the-integers.html#cb979-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="at">digits =</span><span class="dv">2</span> , <span class="at">caption =</span> <span class="st">&quot;ハワイありの推定結果&quot;</span>,</span>
<span id="cb979-7"><a href="god-spiked-the-integers.html#cb979-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">booktabs =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb979-8"><a href="god-spiked-the-integers.html#cb979-8" aria-hidden="true" tabindex="-1"></a>   <span class="fu">kable_styling</span>(<span class="at">latex_options =</span> <span class="st">&quot;striped&quot;</span>)</span></code></pre></div>
<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:unnamed-chunk-521">表11.25: </span>ハワイありの推定結果
</caption>
<thead>
<tr>
<th style="text-align:left;">
parameter
</th>
<th style="text-align:right;">
Estimate
</th>
<th style="text-align:right;">
Est.Error
</th>
<th style="text-align:right;">
Q4.5
</th>
<th style="text-align:right;">
Q95.5
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
b_a_cidhigh
</td>
<td style="text-align:right;">
3.61
</td>
<td style="text-align:right;">
0.07
</td>
<td style="text-align:right;">
3.48
</td>
<td style="text-align:right;">
3.73
</td>
</tr>
<tr>
<td style="text-align:left;">
b_a_cidlow
</td>
<td style="text-align:right;">
3.32
</td>
<td style="text-align:right;">
0.09
</td>
<td style="text-align:right;">
3.16
</td>
<td style="text-align:right;">
3.47
</td>
</tr>
<tr>
<td style="text-align:left;">
b_b_cidhigh
</td>
<td style="text-align:right;">
0.20
</td>
<td style="text-align:right;">
0.16
</td>
<td style="text-align:right;">
-0.08
</td>
<td style="text-align:right;">
0.46
</td>
</tr>
<tr>
<td style="text-align:left;">
b_b_cidlow
</td>
<td style="text-align:right;">
0.38
</td>
<td style="text-align:right;">
0.05
</td>
<td style="text-align:right;">
0.29
</td>
<td style="text-align:right;">
0.47
</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb980"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb980-1"><a href="god-spiked-the-integers.html#cb980-1" aria-hidden="true" tabindex="-1"></a><span class="fu">posterior_summary</span>(b11<span class="fl">.10</span>_2, <span class="at">probs =</span> <span class="fu">c</span>(<span class="fl">0.045</span>, <span class="fl">0.955</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb980-2"><a href="god-spiked-the-integers.html#cb980-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb980-3"><a href="god-spiked-the-integers.html#cb980-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>(<span class="at">var =</span> <span class="st">&quot;parameter&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb980-4"><a href="god-spiked-the-integers.html#cb980-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">str_detect</span>(parameter,<span class="fu">c</span>(<span class="st">&quot;prior&quot;</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb980-5"><a href="god-spiked-the-integers.html#cb980-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(parameter<span class="sc">!=</span> <span class="st">&quot;lp__&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb980-6"><a href="god-spiked-the-integers.html#cb980-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="at">digits =</span><span class="dv">2</span> , <span class="at">caption =</span> <span class="st">&quot;ハワイなしの推定結果&quot;</span>,</span>
<span id="cb980-7"><a href="god-spiked-the-integers.html#cb980-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">booktabs =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb980-8"><a href="god-spiked-the-integers.html#cb980-8" aria-hidden="true" tabindex="-1"></a>   <span class="fu">kable_styling</span>(<span class="at">latex_options =</span> <span class="st">&quot;striped&quot;</span>)</span></code></pre></div>
<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:unnamed-chunk-522">表11.26: </span>ハワイなしの推定結果
</caption>
<thead>
<tr>
<th style="text-align:left;">
parameter
</th>
<th style="text-align:right;">
Estimate
</th>
<th style="text-align:right;">
Est.Error
</th>
<th style="text-align:right;">
Q4.5
</th>
<th style="text-align:right;">
Q95.5
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
b_a_cidhigh
</td>
<td style="text-align:right;">
3.61
</td>
<td style="text-align:right;">
0.07
</td>
<td style="text-align:right;">
3.48
</td>
<td style="text-align:right;">
3.74
</td>
</tr>
<tr>
<td style="text-align:left;">
b_a_cidlow
</td>
<td style="text-align:right;">
3.18
</td>
<td style="text-align:right;">
0.13
</td>
<td style="text-align:right;">
2.95
</td>
<td style="text-align:right;">
3.40
</td>
</tr>
<tr>
<td style="text-align:left;">
b_b_cidhigh
</td>
<td style="text-align:right;">
0.19
</td>
<td style="text-align:right;">
0.16
</td>
<td style="text-align:right;">
-0.07
</td>
<td style="text-align:right;">
0.47
</td>
</tr>
<tr>
<td style="text-align:left;">
b_b_cidlow
</td>
<td style="text-align:right;">
0.19
</td>
<td style="text-align:right;">
0.13
</td>
<td style="text-align:right;">
-0.03
</td>
<td style="text-align:right;">
0.41
</td>
</tr>
</tbody>
</table>
<p>推定結果を図示してみても、違いは明らか。</p>
<div class="sourceCode" id="cb981"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb981-1"><a href="god-spiked-the-integers.html#cb981-1" aria-hidden="true" tabindex="-1"></a>nd <span class="ot">&lt;-</span> <span class="fu">crossing</span>(<span class="at">cid =</span> <span class="fu">c</span>(<span class="st">&quot;low&quot;</span>,<span class="st">&quot;high&quot;</span>),</span>
<span id="cb981-2"><a href="god-spiked-the-integers.html#cb981-2" aria-hidden="true" tabindex="-1"></a>               <span class="at">P =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="fl">1.5</span>, <span class="fl">2.5</span>, <span class="at">length.out=</span><span class="dv">100</span>))</span>
<span id="cb981-3"><a href="god-spiked-the-integers.html#cb981-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb981-4"><a href="god-spiked-the-integers.html#cb981-4" aria-hidden="true" tabindex="-1"></a>fit11<span class="fl">.10</span>_2 <span class="ot">&lt;-</span> <span class="fu">fitted</span>(b11<span class="fl">.10</span>_2, <span class="at">newdata =</span> nd) <span class="sc">%&gt;%</span> </span>
<span id="cb981-5"><a href="god-spiked-the-integers.html#cb981-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb981-6"><a href="god-spiked-the-integers.html#cb981-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(nd)</span>
<span id="cb981-7"><a href="god-spiked-the-integers.html#cb981-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb981-8"><a href="god-spiked-the-integers.html#cb981-8" aria-hidden="true" tabindex="-1"></a>b11<span class="fl">.10</span>_2 <span class="ot">&lt;-</span> <span class="fu">add_criterion</span>(b11<span class="fl">.10</span>_2,<span class="st">&quot;loo&quot;</span>)</span>
<span id="cb981-9"><a href="god-spiked-the-integers.html#cb981-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb981-10"><a href="god-spiked-the-integers.html#cb981-10" aria-hidden="true" tabindex="-1"></a>fit11<span class="fl">.10</span>_2 <span class="sc">%&gt;%</span> </span>
<span id="cb981-11"><a href="god-spiked-the-integers.html#cb981-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">population =</span> <span class="fu">exp</span>(P<span class="sc">*</span><span class="fu">sd</span>(<span class="fu">log</span>(d4<span class="sc">$</span>population))<span class="sc">+</span><span class="fu">mean</span>(<span class="fu">log</span>(d4<span class="sc">$</span>population)))) <span class="sc">%&gt;%</span> </span>
<span id="cb981-12"><a href="god-spiked-the-integers.html#cb981-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> population, <span class="at">group =</span> cid))<span class="sc">+</span></span>
<span id="cb981-13"><a href="god-spiked-the-integers.html#cb981-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="fu">aes</span>(<span class="at">y =</span> Estimate, <span class="at">ymin =</span> Q2<span class="fl">.5</span>,</span>
<span id="cb981-14"><a href="god-spiked-the-integers.html#cb981-14" aria-hidden="true" tabindex="-1"></a>                  <span class="at">ymax =</span> Q97<span class="fl">.5</span>,</span>
<span id="cb981-15"><a href="god-spiked-the-integers.html#cb981-15" aria-hidden="true" tabindex="-1"></a>                  <span class="at">linetype =</span> cid,</span>
<span id="cb981-16"><a href="god-spiked-the-integers.html#cb981-16" aria-hidden="true" tabindex="-1"></a>                  <span class="at">fill =</span> cid,</span>
<span id="cb981-17"><a href="god-spiked-the-integers.html#cb981-17" aria-hidden="true" tabindex="-1"></a>                  <span class="at">color =</span> cid),</span>
<span id="cb981-18"><a href="god-spiked-the-integers.html#cb981-18" aria-hidden="true" tabindex="-1"></a>              <span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>,</span>
<span id="cb981-19"><a href="god-spiked-the-integers.html#cb981-19" aria-hidden="true" tabindex="-1"></a>              <span class="at">size=</span><span class="fl">1.5</span>, <span class="at">alpha=</span><span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>)<span class="sc">+</span></span>
<span id="cb981-20"><a href="god-spiked-the-integers.html#cb981-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> <span class="fu">bind_cols</span>(d4_2, b11<span class="fl">.10</span>_2<span class="sc">$</span>criteria<span class="sc">$</span>loo<span class="sc">$</span>diagnostics),</span>
<span id="cb981-21"><a href="god-spiked-the-integers.html#cb981-21" aria-hidden="true" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">y =</span> total_tools, <span class="at">size =</span> pareto_k,</span>
<span id="cb981-22"><a href="god-spiked-the-integers.html#cb981-22" aria-hidden="true" tabindex="-1"></a>                 <span class="at">color =</span> cid),<span class="at">stroke =</span> <span class="fl">1.5</span>, <span class="at">alpha=</span><span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>)<span class="sc">+</span></span>
<span id="cb981-23"><a href="god-spiked-the-integers.html#cb981-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_shape_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="dv">16</span>,<span class="dv">1</span>))<span class="sc">+</span></span>
<span id="cb981-24"><a href="god-spiked-the-integers.html#cb981-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;lightblue3&quot;</span>,<span class="st">&quot;orange3&quot;</span>))<span class="sc">+</span></span>
<span id="cb981-25"><a href="god-spiked-the-integers.html#cb981-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;lightblue&quot;</span>, <span class="st">&quot;orange&quot;</span>))<span class="sc">+</span></span>
<span id="cb981-26"><a href="god-spiked-the-integers.html#cb981-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">250000</span>,<span class="at">by=</span><span class="dv">50000</span>))<span class="sc">+</span></span>
<span id="cb981-27"><a href="god-spiked-the-integers.html#cb981-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">250000</span>),</span>
<span id="cb981-28"><a href="god-spiked-the-integers.html#cb981-28" aria-hidden="true" tabindex="-1"></a>                  <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">80</span>))<span class="sc">+</span></span>
<span id="cb981-29"><a href="god-spiked-the-integers.html#cb981-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>,</span>
<span id="cb981-30"><a href="god-spiked-the-integers.html#cb981-30" aria-hidden="true" tabindex="-1"></a>        <span class="at">aspect.ratio=</span><span class="dv">1</span>,</span>
<span id="cb981-31"><a href="god-spiked-the-integers.html#cb981-31" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">family =</span><span class="st">&quot;Japan1GothicBBB&quot;</span>))<span class="sc">+</span></span>
<span id="cb981-32"><a href="god-spiked-the-integers.html#cb981-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;ハワイを除いたモデル&quot;</span>) <span class="ot">-&gt;</span>p9</span>
<span id="cb981-33"><a href="god-spiked-the-integers.html#cb981-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb981-34"><a href="god-spiked-the-integers.html#cb981-34" aria-hidden="true" tabindex="-1"></a>p6 <span class="sc">+</span></span>
<span id="cb981-35"><a href="god-spiked-the-integers.html#cb981-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title=</span><span class="st">&quot;ハワイを含めたモデル&quot;</span>)<span class="sc">+</span></span>
<span id="cb981-36"><a href="god-spiked-the-integers.html#cb981-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span><span class="fu">element_text</span>(<span class="at">family =</span><span class="st">&quot;Japan1GothicBBB&quot;</span>))<span class="ot">-&gt;</span> p6</span>
<span id="cb981-37"><a href="god-spiked-the-integers.html#cb981-37" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb981-38"><a href="god-spiked-the-integers.html#cb981-38" aria-hidden="true" tabindex="-1"></a>p6 <span class="sc">+</span> p9</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:unnamed-chunk-523"></span>
<img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-523-1.png" alt="ハワイがある場合と除いた場合のモデルの推定結果" width="672" />
<p class="caption">
図11.26: ハワイがある場合と除いた場合のモデルの推定結果
</p>
</div>
</div>
<div id="h1-8" class="section level3 hasAnchor" number="11.5.7">
<h3><span class="header-section-number">11.5.7</span> 11H1<a href="god-spiked-the-integers.html#h1-8" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<blockquote>
<p>Use WAIC or PSIS to compare the chimpanzee model that includes a unique intercept for each actor, m11.4 (page 330), to the simpler models fit in the same section. Interpret the results.</p>
</blockquote>
<p><code>b11.1</code>~<code>b11\2</code>までのモデルを比較する。</p>
<div class="sourceCode" id="cb982"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb982-1"><a href="god-spiked-the-integers.html#cb982-1" aria-hidden="true" tabindex="-1"></a>b11<span class="fl">.1</span> <span class="ot">&lt;-</span> <span class="fu">add_criterion</span>(b11<span class="fl">.1</span>, <span class="at">criterion =</span> <span class="st">&quot;loo&quot;</span>)</span>
<span id="cb982-2"><a href="god-spiked-the-integers.html#cb982-2" aria-hidden="true" tabindex="-1"></a>b11<span class="fl">.2</span> <span class="ot">&lt;-</span> <span class="fu">add_criterion</span>(b11<span class="fl">.2</span>, <span class="at">criterion =</span> <span class="st">&quot;loo&quot;</span>)</span>
<span id="cb982-3"><a href="god-spiked-the-integers.html#cb982-3" aria-hidden="true" tabindex="-1"></a>b11<span class="fl">.3</span> <span class="ot">&lt;-</span> <span class="fu">add_criterion</span>(b11<span class="fl">.3</span>, <span class="at">criterion =</span> <span class="st">&quot;loo&quot;</span>)</span>
<span id="cb982-4"><a href="god-spiked-the-integers.html#cb982-4" aria-hidden="true" tabindex="-1"></a>b11<span class="fl">.4</span> <span class="ot">&lt;-</span> <span class="fu">add_criterion</span>(b11<span class="fl">.4</span>, <span class="at">criterion =</span> <span class="st">&quot;loo&quot;</span>)</span>
<span id="cb982-5"><a href="god-spiked-the-integers.html#cb982-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb982-6"><a href="god-spiked-the-integers.html#cb982-6" aria-hidden="true" tabindex="-1"></a><span class="fu">loo_compare</span>(b11<span class="fl">.1</span>, b11<span class="fl">.2</span>, b11<span class="fl">.3</span>, b11<span class="fl">.4</span>)</span></code></pre></div>
<pre><code>##       elpd_diff se_diff
## b11.4   0.0       0.0  
## b11.3 -75.1       9.2  
## b11.2 -75.6       9.2  
## b11.1 -77.9       9.5</code></pre>
</div>
<div id="h2-8" class="section level3 hasAnchor" number="11.5.8">
<h3><span class="header-section-number">11.5.8</span> 11H2<a href="god-spiked-the-integers.html#h2-8" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<blockquote>
<p>The data contained in library(MASS); <code>data(eagles)</code> are records of salmon pirating attempts by Bald Eagles in Washington State. See ? <code>eagles</code> for details. While one eagle feeds, sometime another will swoop in and try to steal the salmon from it. Call the feeding eagle the “victim” and the thief the “pirate.” Use the available data to build a binomial GLM of successful pirating attempts.</p>
</blockquote>
<div id="a-4" class="section level4 hasAnchor" number="11.5.8.1">
<h4><span class="header-section-number">11.5.8.1</span> a<a href="god-spiked-the-integers.html#a-4" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<blockquote>
<p>Consider the following model:</p>
</blockquote>
<blockquote>
<p>where y is the number of successful attempts, n is the total number of attempts, P is a dummy variable indicating whether or not the pirate had large body size, V is a dummy variable indicating whether or not the victim had large body size, and finally A is a dummy variable indicating whether or not the pirate was an adult. Fit the model above to the eagles data, using both quap and ulam. Is the quadratic approximation okay?</p>
</blockquote>
<p>鷲が他の個体から餌を横取りできる確率をモデリングする。なお、Pは盗む個体(pirates)の身体が大きいか否か、Vはとられる個体(victim)の身体が大きいか否か、Aはpiratesがオトナか否かを表す。 <br /></p>
<p><span class="math display">\[  
\begin{aligned}
y_{i} &amp;\sim Binomial(n_{i}, p_{i})\\
logit(p_{i}) &amp;= \alpha + \beta_{P}P_{i} + \beta_{V}V_{i} +
\beta_{A}A_{i}\\
\alpha &amp;\sim Normal(0,1.5)\\
\beta_{j} &amp;\sim Normal(0,0.5)\\
\end{aligned}
\]</span>
<br /></p>
<div class="sourceCode" id="cb984"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb984-1"><a href="god-spiked-the-integers.html#cb984-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(MASS)</span>
<span id="cb984-2"><a href="god-spiked-the-integers.html#cb984-2" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;eagles&quot;</span>)</span>
<span id="cb984-3"><a href="god-spiked-the-integers.html#cb984-3" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> eagles</span>
<span id="cb984-4"><a href="god-spiked-the-integers.html#cb984-4" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(dat, <span class="at">caption =</span> <span class="st">&quot;データ&#39;eagle&#39;&quot;</span>,</span>
<span id="cb984-5"><a href="god-spiked-the-integers.html#cb984-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">booktabs =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb984-6"><a href="god-spiked-the-integers.html#cb984-6" aria-hidden="true" tabindex="-1"></a>   <span class="fu">kable_styling</span>(<span class="at">latex_options =</span> <span class="st">&quot;striped&quot;</span>)</span></code></pre></div>
<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:unnamed-chunk-525">表11.27: </span>データ’eagle’
</caption>
<thead>
<tr>
<th style="text-align:right;">
y
</th>
<th style="text-align:right;">
n
</th>
<th style="text-align:left;">
P
</th>
<th style="text-align:left;">
A
</th>
<th style="text-align:left;">
V
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
17
</td>
<td style="text-align:right;">
24
</td>
<td style="text-align:left;">
L
</td>
<td style="text-align:left;">
A
</td>
<td style="text-align:left;">
L
</td>
</tr>
<tr>
<td style="text-align:right;">
29
</td>
<td style="text-align:right;">
29
</td>
<td style="text-align:left;">
L
</td>
<td style="text-align:left;">
A
</td>
<td style="text-align:left;">
S
</td>
</tr>
<tr>
<td style="text-align:right;">
17
</td>
<td style="text-align:right;">
27
</td>
<td style="text-align:left;">
L
</td>
<td style="text-align:left;">
I
</td>
<td style="text-align:left;">
L
</td>
</tr>
<tr>
<td style="text-align:right;">
20
</td>
<td style="text-align:right;">
20
</td>
<td style="text-align:left;">
L
</td>
<td style="text-align:left;">
I
</td>
<td style="text-align:left;">
S
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
12
</td>
<td style="text-align:left;">
S
</td>
<td style="text-align:left;">
A
</td>
<td style="text-align:left;">
L
</td>
</tr>
<tr>
<td style="text-align:right;">
15
</td>
<td style="text-align:right;">
16
</td>
<td style="text-align:left;">
S
</td>
<td style="text-align:left;">
A
</td>
<td style="text-align:left;">
S
</td>
</tr>
<tr>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
28
</td>
<td style="text-align:left;">
S
</td>
<td style="text-align:left;">
I
</td>
<td style="text-align:left;">
L
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:left;">
S
</td>
<td style="text-align:left;">
I
</td>
<td style="text-align:left;">
S
</td>
</tr>
</tbody>
</table>
<p>それでは、モデリングしてみる。</p>
<div class="sourceCode" id="cb985"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb985-1"><a href="god-spiked-the-integers.html#cb985-1" aria-hidden="true" tabindex="-1"></a>b11H2 <span class="ot">&lt;-</span> </span>
<span id="cb985-2"><a href="god-spiked-the-integers.html#cb985-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">brm</span>(<span class="at">data =</span> dat,</span>
<span id="cb985-3"><a href="god-spiked-the-integers.html#cb985-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> binomial,</span>
<span id="cb985-4"><a href="god-spiked-the-integers.html#cb985-4" aria-hidden="true" tabindex="-1"></a>      y<span class="sc">|</span><span class="fu">trials</span>(n) <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> P <span class="sc">+</span> A <span class="sc">+</span> V,</span>
<span id="cb985-5"><a href="god-spiked-the-integers.html#cb985-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>,<span class="fl">1.5</span>), <span class="at">class =</span> Intercept),</span>
<span id="cb985-6"><a href="god-spiked-the-integers.html#cb985-6" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>,<span class="fl">0.5</span>), <span class="at">class=</span>b)),</span>
<span id="cb985-7"><a href="god-spiked-the-integers.html#cb985-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">backend =</span> <span class="st">&quot;cmdstanr&quot;</span>,</span>
<span id="cb985-8"><a href="god-spiked-the-integers.html#cb985-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">file =</span> <span class="st">&quot;output/Chapter11/b11H2&quot;</span>)  </span></code></pre></div>
<p>推定結果は以下の通り。</p>
<div class="sourceCode" id="cb986"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb986-1"><a href="god-spiked-the-integers.html#cb986-1" aria-hidden="true" tabindex="-1"></a><span class="fu">posterior_summary</span>(b11H2, <span class="at">probs =</span> <span class="fu">c</span>(<span class="fl">0.045</span>, <span class="fl">0.955</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb986-2"><a href="god-spiked-the-integers.html#cb986-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb986-3"><a href="god-spiked-the-integers.html#cb986-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>(<span class="at">var =</span> <span class="st">&quot;parameter&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb986-4"><a href="god-spiked-the-integers.html#cb986-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">str_detect</span>(parameter,<span class="fu">c</span>(<span class="st">&quot;prior&quot;</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb986-5"><a href="god-spiked-the-integers.html#cb986-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(parameter<span class="sc">!=</span> <span class="st">&quot;lp__&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb986-6"><a href="god-spiked-the-integers.html#cb986-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="at">digits =</span><span class="dv">2</span> , <span class="at">caption =</span> <span class="st">&quot;b11H2の推定結果&quot;</span>,</span>
<span id="cb986-7"><a href="god-spiked-the-integers.html#cb986-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">booktabs =</span> T) <span class="sc">%&gt;%</span> </span>
<span id="cb986-8"><a href="god-spiked-the-integers.html#cb986-8" aria-hidden="true" tabindex="-1"></a>   <span class="fu">kable_styling</span>(<span class="at">latex_options =</span> <span class="st">&quot;striped&quot;</span>)</span></code></pre></div>
<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:unnamed-chunk-527">表11.28: </span>b11H2の推定結果
</caption>
<thead>
<tr>
<th style="text-align:left;">
parameter
</th>
<th style="text-align:right;">
Estimate
</th>
<th style="text-align:right;">
Est.Error
</th>
<th style="text-align:right;">
Q4.5
</th>
<th style="text-align:right;">
Q95.5
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
b_Intercept
</td>
<td style="text-align:right;">
0.89
</td>
<td style="text-align:right;">
0.31
</td>
<td style="text-align:right;">
0.38
</td>
<td style="text-align:right;">
1.43
</td>
</tr>
<tr>
<td style="text-align:left;">
b_PS
</td>
<td style="text-align:right;">
-1.64
</td>
<td style="text-align:right;">
0.32
</td>
<td style="text-align:right;">
-2.17
</td>
<td style="text-align:right;">
-1.10
</td>
</tr>
<tr>
<td style="text-align:left;">
b_AI
</td>
<td style="text-align:right;">
-0.65
</td>
<td style="text-align:right;">
0.32
</td>
<td style="text-align:right;">
-1.19
</td>
<td style="text-align:right;">
-0.10
</td>
</tr>
<tr>
<td style="text-align:left;">
b_VS
</td>
<td style="text-align:right;">
1.71
</td>
<td style="text-align:right;">
0.32
</td>
<td style="text-align:right;">
1.17
</td>
<td style="text-align:right;">
2.26
</td>
</tr>
</tbody>
</table>
</div>
<div id="b-4" class="section level4 hasAnchor" number="11.5.8.2">
<h4><span class="header-section-number">11.5.8.2</span> b<a href="god-spiked-the-integers.html#b-4" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<blockquote>
<p>Now interpret the estimates. If the quadratic approximation turned out okay, then it’s okay to use the quap estimates. Otherwise stick to ulam estimates. Then plot the posterior predictions. Compute and display both (1) the predicted probability of success and its 89% interval for each row (i) in the data, as well as (2) the predicted success count and its 89% interval. What different information does each type of posterior prediction provide?</p>
</blockquote>
<div class="sourceCode" id="cb987"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb987-1"><a href="god-spiked-the-integers.html#cb987-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 回数スケール</span></span>
<span id="cb987-2"><a href="god-spiked-the-integers.html#cb987-2" aria-hidden="true" tabindex="-1"></a><span class="fu">fitted</span>(b11H2) <span class="sc">%&gt;%</span> </span>
<span id="cb987-3"><a href="god-spiked-the-integers.html#cb987-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb987-4"><a href="god-spiked-the-integers.html#cb987-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(dat) <span class="sc">%&gt;%</span> </span>
<span id="cb987-5"><a href="god-spiked-the-integers.html#cb987-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">cond =</span> <span class="fu">c</span>(<span class="st">&quot;L,L,A&quot;</span>,<span class="st">&quot;L,S,A&quot;</span>,<span class="st">&quot;L,L,I&quot;</span>,<span class="st">&quot;L,S,I&quot;</span>,<span class="st">&quot;S,L,A&quot;</span>,<span class="st">&quot;S,S,A&quot;</span>,<span class="st">&quot;S,L,I&quot;</span>,<span class="st">&quot;S,S,I&quot;</span>)) <span class="ot">-&gt;</span> fit11H2</span>
<span id="cb987-6"><a href="god-spiked-the-integers.html#cb987-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb987-7"><a href="god-spiked-the-integers.html#cb987-7" aria-hidden="true" tabindex="-1"></a>dat <span class="sc">%&gt;%</span> </span>
<span id="cb987-8"><a href="god-spiked-the-integers.html#cb987-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">cond =</span> <span class="fu">c</span>(<span class="st">&quot;L,L,A&quot;</span>,<span class="st">&quot;L,S,A&quot;</span>,<span class="st">&quot;L,L,I&quot;</span>,<span class="st">&quot;L,S,I&quot;</span>,<span class="st">&quot;S,L,A&quot;</span>,<span class="st">&quot;S,S,A&quot;</span>,<span class="st">&quot;S,L,I&quot;</span>,<span class="st">&quot;S,S,I&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb987-9"><a href="god-spiked-the-integers.html#cb987-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>cond))<span class="sc">+</span></span>
<span id="cb987-10"><a href="god-spiked-the-integers.html#cb987-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y=</span>y),<span class="at">size=</span><span class="dv">4</span>,<span class="at">color =</span> <span class="st">&quot;navy&quot;</span>,</span>
<span id="cb987-11"><a href="god-spiked-the-integers.html#cb987-11" aria-hidden="true" tabindex="-1"></a>             <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>)<span class="sc">+</span></span>
<span id="cb987-12"><a href="god-spiked-the-integers.html#cb987-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_pointinterval</span>(<span class="at">data =</span> fit11H2,</span>
<span id="cb987-13"><a href="god-spiked-the-integers.html#cb987-13" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">aes</span>(<span class="at">y=</span>Estimate, <span class="at">ymin=</span>Q2<span class="fl">.5</span>, <span class="at">ymax=</span>Q97<span class="fl">.5</span>),</span>
<span id="cb987-14"><a href="god-spiked-the-integers.html#cb987-14" aria-hidden="true" tabindex="-1"></a>                     <span class="at">shape =</span> <span class="dv">1</span>,<span class="at">point_size=</span><span class="dv">3</span>)<span class="sc">+</span></span>
<span id="cb987-15"><a href="god-spiked-the-integers.html#cb987-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">aspect.ratio=</span><span class="fl">0.7</span>,</span>
<span id="cb987-16"><a href="god-spiked-the-integers.html#cb987-16" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">family =</span><span class="st">&quot;Japan1GothicBBB&quot;</span>),</span>
<span id="cb987-17"><a href="god-spiked-the-integers.html#cb987-17" aria-hidden="true" tabindex="-1"></a>        <span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">10</span>))<span class="sc">+</span></span>
<span id="cb987-18"><a href="god-spiked-the-integers.html#cb987-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y=</span><span class="st">&quot;成功数&quot;</span>)  <span class="ot">-&gt;</span> p11</span>
<span id="cb987-19"><a href="god-spiked-the-integers.html#cb987-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb987-20"><a href="god-spiked-the-integers.html#cb987-20" aria-hidden="true" tabindex="-1"></a><span class="do">## 成功確率  </span></span>
<span id="cb987-21"><a href="god-spiked-the-integers.html#cb987-21" aria-hidden="true" tabindex="-1"></a><span class="fu">fitted</span>(b11H2, <span class="at">scale =</span> <span class="st">&quot;linear&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb987-22"><a href="god-spiked-the-integers.html#cb987-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb987-23"><a href="god-spiked-the-integers.html#cb987-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(dat) <span class="sc">%&gt;%</span> </span>
<span id="cb987-24"><a href="god-spiked-the-integers.html#cb987-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">cond =</span> <span class="fu">c</span>(<span class="st">&quot;L,L,A&quot;</span>,<span class="st">&quot;L,S,A&quot;</span>,<span class="st">&quot;L,L,I&quot;</span>,<span class="st">&quot;L,S,I&quot;</span>,<span class="st">&quot;S,L,A&quot;</span>,<span class="st">&quot;S,S,A&quot;</span>,<span class="st">&quot;S,L,I&quot;</span>,<span class="st">&quot;S,S,I&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb987-25"><a href="god-spiked-the-integers.html#cb987-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prob_est =</span> <span class="fu">inv_logit_scaled</span>(Estimate),</span>
<span id="cb987-26"><a href="god-spiked-the-integers.html#cb987-26" aria-hidden="true" tabindex="-1"></a>         <span class="at">lb =</span> <span class="fu">inv_logit_scaled</span>(Q2<span class="fl">.5</span>),</span>
<span id="cb987-27"><a href="god-spiked-the-integers.html#cb987-27" aria-hidden="true" tabindex="-1"></a>         <span class="at">ub =</span> <span class="fu">inv_logit_scaled</span>(Q97<span class="fl">.5</span>)) <span class="ot">-&gt;</span> fit11H2_2</span>
<span id="cb987-28"><a href="god-spiked-the-integers.html#cb987-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb987-29"><a href="god-spiked-the-integers.html#cb987-29" aria-hidden="true" tabindex="-1"></a>fit11H2_2 <span class="sc">%&gt;%</span> </span>
<span id="cb987-30"><a href="god-spiked-the-integers.html#cb987-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prob =</span> y<span class="sc">/</span>n) <span class="sc">%&gt;%</span> </span>
<span id="cb987-31"><a href="god-spiked-the-integers.html#cb987-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>cond))<span class="sc">+</span></span>
<span id="cb987-32"><a href="god-spiked-the-integers.html#cb987-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y=</span>prob),<span class="at">size=</span><span class="dv">4</span>,<span class="at">color =</span> <span class="st">&quot;navy&quot;</span>,</span>
<span id="cb987-33"><a href="god-spiked-the-integers.html#cb987-33" aria-hidden="true" tabindex="-1"></a>             <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>)<span class="sc">+</span></span>
<span id="cb987-34"><a href="god-spiked-the-integers.html#cb987-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_pointinterval</span>(<span class="at">data =</span> fit11H2_2,</span>
<span id="cb987-35"><a href="god-spiked-the-integers.html#cb987-35" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">aes</span>(<span class="at">y=</span>prob_est, <span class="at">ymin=</span>lb, <span class="at">ymax=</span>ub),</span>
<span id="cb987-36"><a href="god-spiked-the-integers.html#cb987-36" aria-hidden="true" tabindex="-1"></a>                     <span class="at">shape =</span> <span class="dv">1</span>,<span class="at">point_size=</span><span class="dv">3</span>)<span class="sc">+</span></span>
<span id="cb987-37"><a href="god-spiked-the-integers.html#cb987-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y=</span><span class="st">&quot;成功確率&quot;</span>)<span class="sc">+</span></span>
<span id="cb987-38"><a href="god-spiked-the-integers.html#cb987-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">aspect.ratio=</span><span class="fl">0.7</span>,</span>
<span id="cb987-39"><a href="god-spiked-the-integers.html#cb987-39" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">family =</span><span class="st">&quot;Japan1GothicBBB&quot;</span>),</span>
<span id="cb987-40"><a href="god-spiked-the-integers.html#cb987-40" aria-hidden="true" tabindex="-1"></a>        <span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">10</span>))<span class="ot">-&gt;</span> p12 </span>
<span id="cb987-41"><a href="god-spiked-the-integers.html#cb987-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb987-42"><a href="god-spiked-the-integers.html#cb987-42" aria-hidden="true" tabindex="-1"></a>p11 <span class="sc">+</span> p12</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:unnamed-chunk-528"></span>
<img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-528-1.png" alt="モデルb11H2による推定結果。青丸は実測値、エラーバー付きの点はモデルによる予測値を表す。左は成功回数、右は成功確率を示す。" width="672" />
<p class="caption">
図11.27: モデルb11H2による推定結果。青丸は実測値、エラーバー付きの点はモデルによる予測値を表す。左は成功回数、右は成功確率を示す。
</p>
</div>
</div>
<div id="c-1" class="section level4 hasAnchor" number="11.5.8.3">
<h4><span class="header-section-number">11.5.8.3</span> c<a href="god-spiked-the-integers.html#c-1" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<blockquote>
<p>Now try to improve the model. Consider an interaction between the pirate’s size and age (immature or adult). Compare this model to the previous one, using WAIC. Interpret.</p>
</blockquote>
<p>piratesの大きさと年齢の交互作用を入れたモデルを作成する。</p>
<div class="sourceCode" id="cb988"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb988-1"><a href="god-spiked-the-integers.html#cb988-1" aria-hidden="true" tabindex="-1"></a>b11H2c <span class="ot">&lt;-</span> </span>
<span id="cb988-2"><a href="god-spiked-the-integers.html#cb988-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">brm</span>(<span class="at">data =</span> dat,</span>
<span id="cb988-3"><a href="god-spiked-the-integers.html#cb988-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> binomial,</span>
<span id="cb988-4"><a href="god-spiked-the-integers.html#cb988-4" aria-hidden="true" tabindex="-1"></a>      y<span class="sc">|</span><span class="fu">trials</span>(n) <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> P <span class="sc">+</span> A <span class="sc">+</span> V <span class="sc">+</span> P<span class="sc">:</span>A, </span>
<span id="cb988-5"><a href="god-spiked-the-integers.html#cb988-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>,<span class="fl">1.5</span>), <span class="at">class =</span> Intercept),</span>
<span id="cb988-6"><a href="god-spiked-the-integers.html#cb988-6" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>,<span class="fl">0.5</span>), <span class="at">class=</span>b)),</span>
<span id="cb988-7"><a href="god-spiked-the-integers.html#cb988-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">backend =</span> <span class="st">&quot;cmdstanr&quot;</span>,</span>
<span id="cb988-8"><a href="god-spiked-the-integers.html#cb988-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">file =</span> <span class="st">&quot;output/Chapter11/b11H2c&quot;</span>) </span></code></pre></div>
<p>先ほどのモデルと比較すると、交互作用モデルの方がよい。</p>
<div class="sourceCode" id="cb989"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb989-1"><a href="god-spiked-the-integers.html#cb989-1" aria-hidden="true" tabindex="-1"></a>b11H2 <span class="ot">&lt;-</span> <span class="fu">add_criterion</span>(b11H2, <span class="st">&quot;loo&quot;</span>)</span>
<span id="cb989-2"><a href="god-spiked-the-integers.html#cb989-2" aria-hidden="true" tabindex="-1"></a>b11H2c <span class="ot">&lt;-</span> <span class="fu">add_criterion</span>(b11H2c,<span class="st">&quot;loo&quot;</span>)</span>
<span id="cb989-3"><a href="god-spiked-the-integers.html#cb989-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb989-4"><a href="god-spiked-the-integers.html#cb989-4" aria-hidden="true" tabindex="-1"></a><span class="fu">loo_compare</span>(b11H2,b11H2c)</span></code></pre></div>
<pre><code>##        elpd_diff se_diff
## b11H2c  0.0       0.0   
## b11H2  -3.3       3.5</code></pre>
<p>交互作用を入れたモデルの方がより実データにマッチしている。</p>
<div class="sourceCode" id="cb991"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb991-1"><a href="god-spiked-the-integers.html#cb991-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 回数スケール</span></span>
<span id="cb991-2"><a href="god-spiked-the-integers.html#cb991-2" aria-hidden="true" tabindex="-1"></a><span class="fu">fitted</span>(b11H2c) <span class="sc">%&gt;%</span> </span>
<span id="cb991-3"><a href="god-spiked-the-integers.html#cb991-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb991-4"><a href="god-spiked-the-integers.html#cb991-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(dat) <span class="sc">%&gt;%</span> </span>
<span id="cb991-5"><a href="god-spiked-the-integers.html#cb991-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">cond =</span> <span class="fu">c</span>(<span class="st">&quot;L,L,A&quot;</span>,<span class="st">&quot;L,S,A&quot;</span>,<span class="st">&quot;L,L,I&quot;</span>,<span class="st">&quot;L,S,I&quot;</span>,<span class="st">&quot;S,L,A&quot;</span>,<span class="st">&quot;S,S,A&quot;</span>,<span class="st">&quot;S,L,I&quot;</span>,<span class="st">&quot;S,S,I&quot;</span>)) <span class="ot">-&gt;</span> fit11H2c</span>
<span id="cb991-6"><a href="god-spiked-the-integers.html#cb991-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb991-7"><a href="god-spiked-the-integers.html#cb991-7" aria-hidden="true" tabindex="-1"></a>dat <span class="sc">%&gt;%</span> </span>
<span id="cb991-8"><a href="god-spiked-the-integers.html#cb991-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">cond =</span> <span class="fu">c</span>(<span class="st">&quot;L,L,A&quot;</span>,<span class="st">&quot;L,S,A&quot;</span>,<span class="st">&quot;L,L,I&quot;</span>,<span class="st">&quot;L,S,I&quot;</span>,<span class="st">&quot;S,L,A&quot;</span>,<span class="st">&quot;S,S,A&quot;</span>,<span class="st">&quot;S,L,I&quot;</span>,<span class="st">&quot;S,S,I&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb991-9"><a href="god-spiked-the-integers.html#cb991-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>cond))<span class="sc">+</span></span>
<span id="cb991-10"><a href="god-spiked-the-integers.html#cb991-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y=</span>y),<span class="at">size=</span><span class="dv">4</span>,<span class="at">color =</span> <span class="st">&quot;navy&quot;</span>,</span>
<span id="cb991-11"><a href="god-spiked-the-integers.html#cb991-11" aria-hidden="true" tabindex="-1"></a>             <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>)<span class="sc">+</span></span>
<span id="cb991-12"><a href="god-spiked-the-integers.html#cb991-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_pointinterval</span>(<span class="at">data =</span> fit11H2c,</span>
<span id="cb991-13"><a href="god-spiked-the-integers.html#cb991-13" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">aes</span>(<span class="at">y=</span>Estimate, <span class="at">ymin=</span>Q2<span class="fl">.5</span>, <span class="at">ymax=</span>Q97<span class="fl">.5</span>),</span>
<span id="cb991-14"><a href="god-spiked-the-integers.html#cb991-14" aria-hidden="true" tabindex="-1"></a>                     <span class="at">shape =</span> <span class="dv">1</span>,<span class="at">point_size=</span><span class="dv">3</span>)<span class="sc">+</span></span>
<span id="cb991-15"><a href="god-spiked-the-integers.html#cb991-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y=</span><span class="st">&quot;成功数&quot;</span>)<span class="sc">+</span></span>
<span id="cb991-16"><a href="god-spiked-the-integers.html#cb991-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">aspect.ratio=</span><span class="fl">0.7</span>,</span>
<span id="cb991-17"><a href="god-spiked-the-integers.html#cb991-17" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">family =</span><span class="st">&quot;Japan1GothicBBB&quot;</span>),</span>
<span id="cb991-18"><a href="god-spiked-the-integers.html#cb991-18" aria-hidden="true" tabindex="-1"></a>        <span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>))  <span class="ot">-&gt;</span> p13</span>
<span id="cb991-19"><a href="god-spiked-the-integers.html#cb991-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb991-20"><a href="god-spiked-the-integers.html#cb991-20" aria-hidden="true" tabindex="-1"></a><span class="do">## 成功確率  </span></span>
<span id="cb991-21"><a href="god-spiked-the-integers.html#cb991-21" aria-hidden="true" tabindex="-1"></a><span class="fu">fitted</span>(b11H2c, <span class="at">scale =</span> <span class="st">&quot;linear&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb991-22"><a href="god-spiked-the-integers.html#cb991-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb991-23"><a href="god-spiked-the-integers.html#cb991-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(dat) <span class="sc">%&gt;%</span> </span>
<span id="cb991-24"><a href="god-spiked-the-integers.html#cb991-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">cond =</span> <span class="fu">c</span>(<span class="st">&quot;L,L,A&quot;</span>,<span class="st">&quot;L,S,A&quot;</span>,<span class="st">&quot;L,L,I&quot;</span>,<span class="st">&quot;L,S,I&quot;</span>,<span class="st">&quot;S,L,A&quot;</span>,<span class="st">&quot;S,S,A&quot;</span>,<span class="st">&quot;S,L,I&quot;</span>,<span class="st">&quot;S,S,I&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb991-25"><a href="god-spiked-the-integers.html#cb991-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prob_est =</span> <span class="fu">inv_logit_scaled</span>(Estimate),</span>
<span id="cb991-26"><a href="god-spiked-the-integers.html#cb991-26" aria-hidden="true" tabindex="-1"></a>         <span class="at">lb =</span> <span class="fu">inv_logit_scaled</span>(Q2<span class="fl">.5</span>),</span>
<span id="cb991-27"><a href="god-spiked-the-integers.html#cb991-27" aria-hidden="true" tabindex="-1"></a>         <span class="at">ub =</span> <span class="fu">inv_logit_scaled</span>(Q97<span class="fl">.5</span>)) <span class="ot">-&gt;</span> fit11H2_2c</span>
<span id="cb991-28"><a href="god-spiked-the-integers.html#cb991-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb991-29"><a href="god-spiked-the-integers.html#cb991-29" aria-hidden="true" tabindex="-1"></a>fit11H2_2c <span class="sc">%&gt;%</span> </span>
<span id="cb991-30"><a href="god-spiked-the-integers.html#cb991-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prob =</span> y<span class="sc">/</span>n) <span class="sc">%&gt;%</span> </span>
<span id="cb991-31"><a href="god-spiked-the-integers.html#cb991-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>cond))<span class="sc">+</span></span>
<span id="cb991-32"><a href="god-spiked-the-integers.html#cb991-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y=</span>prob),<span class="at">size=</span><span class="dv">4</span>,<span class="at">color =</span> <span class="st">&quot;navy&quot;</span>,</span>
<span id="cb991-33"><a href="god-spiked-the-integers.html#cb991-33" aria-hidden="true" tabindex="-1"></a>             <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>)<span class="sc">+</span></span>
<span id="cb991-34"><a href="god-spiked-the-integers.html#cb991-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_pointinterval</span>(<span class="at">data =</span> fit11H2_2c,</span>
<span id="cb991-35"><a href="god-spiked-the-integers.html#cb991-35" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">aes</span>(<span class="at">y=</span>prob_est, <span class="at">ymin=</span>lb, <span class="at">ymax=</span>ub),</span>
<span id="cb991-36"><a href="god-spiked-the-integers.html#cb991-36" aria-hidden="true" tabindex="-1"></a>                     <span class="at">shape =</span> <span class="dv">1</span>,<span class="at">point_size=</span><span class="dv">3</span>)<span class="sc">+</span></span>
<span id="cb991-37"><a href="god-spiked-the-integers.html#cb991-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y=</span><span class="st">&quot;成功確率&quot;</span>)<span class="sc">+</span></span>
<span id="cb991-38"><a href="god-spiked-the-integers.html#cb991-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">aspect.ratio=</span><span class="fl">0.7</span>,</span>
<span id="cb991-39"><a href="god-spiked-the-integers.html#cb991-39" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">family =</span><span class="st">&quot;Japan1GothicBBB&quot;</span>),</span>
<span id="cb991-40"><a href="god-spiked-the-integers.html#cb991-40" aria-hidden="true" tabindex="-1"></a>        <span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>))<span class="ot">-&gt;</span> p14 </span>
<span id="cb991-41"><a href="god-spiked-the-integers.html#cb991-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb991-42"><a href="god-spiked-the-integers.html#cb991-42" aria-hidden="true" tabindex="-1"></a>p13 <span class="sc">+</span> p14</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:unnamed-chunk-531"></span>
<img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-531-1.png" alt="モデルb11H2cによる推定結果。青丸は実測値、エラーバー付きの点はモデルによる予測値を表す。左は成功回数、右は成功確率を示す。" width="672" />
<p class="caption">
図11.28: モデルb11H2cによる推定結果。青丸は実測値、エラーバー付きの点はモデルによる予測値を表す。左は成功回数、右は成功確率を示す。
</p>
</div>
</div>
</div>
<div id="h3-8" class="section level3 hasAnchor" number="11.5.9">
<h3><span class="header-section-number">11.5.9</span> 11H3<a href="god-spiked-the-integers.html#h3-8" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<blockquote>
<p>The data contained in data(salamanders) are counts of salamanders (Plethodon elongatus) from 47 different 49-m2 plots in northern California. The column SALAMAN is the count in each plot, and the columns PCTCOVER and FORESTAGE are percent of ground cover and age of trees in the plot, respectively. You will model SALAMAN as a Poisson variable.</p>
</blockquote>
<div id="a-5" class="section level4 hasAnchor" number="11.5.9.1">
<h4><span class="header-section-number">11.5.9.1</span> a<a href="god-spiked-the-integers.html#a-5" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<blockquote>
<p>Model the relationship between density and percent cover, using a log-link (same as the example in the book and lecture). Use weakly informative priors of your choosing. Check the quadratic approximation again, by comparing quap to ulam. Then plot the expected counts and their 89% interval against percent cover. In which ways does the model do a good job? A bad job?</p>
</blockquote>
<p>サラマンダーの数(SALAMAN)と地面に覆われた割合?(PCTCOVER)の関係をポワソン回帰で調べる（表 <a href="god-spiked-the-integers.html#tab:salaman">11.29</a>）。ひとまず、事前分布は<span class="math inline">\(\alpha \sim Normal(0,1.5)\)</span>、<span class="math inline">\(\beta \sim Normal(0,0.5)\)</span>とする。</p>
<div class="sourceCode" id="cb992"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb992-1"><a href="god-spiked-the-integers.html#cb992-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;salamanders&quot;</span>)</span>
<span id="cb992-2"><a href="god-spiked-the-integers.html#cb992-2" aria-hidden="true" tabindex="-1"></a>dat2 <span class="ot">&lt;-</span> salamanders</span>
<span id="cb992-3"><a href="god-spiked-the-integers.html#cb992-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb992-4"><a href="god-spiked-the-integers.html#cb992-4" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(salamanders) <span class="sc">%&gt;%</span> </span>
<span id="cb992-5"><a href="god-spiked-the-integers.html#cb992-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="at">booktabs =</span> <span class="cn">TRUE</span>,</span>
<span id="cb992-6"><a href="god-spiked-the-integers.html#cb992-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">caption =</span> <span class="st">&quot;データsalamanderの中身&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb992-7"><a href="god-spiked-the-integers.html#cb992-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">latex_options =</span> <span class="st">&quot;stripe&quot;</span>)</span></code></pre></div>
<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:salaman">表11.29: </span>データsalamanderの中身
</caption>
<thead>
<tr>
<th style="text-align:right;">
SITE
</th>
<th style="text-align:right;">
SALAMAN
</th>
<th style="text-align:right;">
PCTCOVER
</th>
<th style="text-align:right;">
FORESTAGE
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
13
</td>
<td style="text-align:right;">
85
</td>
<td style="text-align:right;">
316
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
11
</td>
<td style="text-align:right;">
86
</td>
<td style="text-align:right;">
88
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
11
</td>
<td style="text-align:right;">
90
</td>
<td style="text-align:right;">
548
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
9
</td>
<td style="text-align:right;">
88
</td>
<td style="text-align:right;">
64
</td>
</tr>
<tr>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
8
</td>
<td style="text-align:right;">
89
</td>
<td style="text-align:right;">
43
</td>
</tr>
<tr>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
7
</td>
<td style="text-align:right;">
83
</td>
<td style="text-align:right;">
368
</td>
</tr>
</tbody>
</table>
<p>分析の結果、強い影響がみられた（表 <a href="god-spiked-the-integers.html#tab:fit11H3">11.30</a>）。</p>
<div class="sourceCode" id="cb993"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb993-1"><a href="god-spiked-the-integers.html#cb993-1" aria-hidden="true" tabindex="-1"></a>dat2 <span class="sc">%&gt;%</span> </span>
<span id="cb993-2"><a href="god-spiked-the-integers.html#cb993-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">P =</span> <span class="fu">standardize</span>(PCTCOVER)) <span class="ot">-&gt;</span> dat2</span>
<span id="cb993-3"><a href="god-spiked-the-integers.html#cb993-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb993-4"><a href="god-spiked-the-integers.html#cb993-4" aria-hidden="true" tabindex="-1"></a>fit11H3 <span class="ot">&lt;-</span> <span class="fu">brm</span>(</span>
<span id="cb993-5"><a href="god-spiked-the-integers.html#cb993-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> dat2,</span>
<span id="cb993-6"><a href="god-spiked-the-integers.html#cb993-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">family=</span>poisson,</span>
<span id="cb993-7"><a href="god-spiked-the-integers.html#cb993-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">formula =</span> SALAMAN <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> P,</span>
<span id="cb993-8"><a href="god-spiked-the-integers.html#cb993-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>,<span class="fl">1.5</span>), <span class="at">class =</span> Intercept),</span>
<span id="cb993-9"><a href="god-spiked-the-integers.html#cb993-9" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>,<span class="fl">0.5</span>), <span class="at">class =</span> b)),</span>
<span id="cb993-10"><a href="god-spiked-the-integers.html#cb993-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">sample_prior =</span> <span class="cn">TRUE</span>,</span>
<span id="cb993-11"><a href="god-spiked-the-integers.html#cb993-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">backend =</span> <span class="st">&quot;cmdstanr&quot;</span>,</span>
<span id="cb993-12"><a href="god-spiked-the-integers.html#cb993-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed=</span><span class="dv">4</span>, <span class="at">file =</span> <span class="st">&quot;output/Chapter11/fit11H3&quot;</span></span>
<span id="cb993-13"><a href="god-spiked-the-integers.html#cb993-13" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb993-14"><a href="god-spiked-the-integers.html#cb993-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb993-15"><a href="god-spiked-the-integers.html#cb993-15" aria-hidden="true" tabindex="-1"></a><span class="fu">fixef</span>(fit11H3, <span class="at">probs =</span> <span class="fu">c</span>(<span class="fl">0.025</span>,<span class="fl">0.975</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb993-16"><a href="god-spiked-the-integers.html#cb993-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb993-17"><a href="god-spiked-the-integers.html#cb993-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>(<span class="at">var =</span> <span class="st">&quot;parameter&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb993-18"><a href="god-spiked-the-integers.html#cb993-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="at">booktabs =</span> <span class="cn">TRUE</span>,</span>
<span id="cb993-19"><a href="god-spiked-the-integers.html#cb993-19" aria-hidden="true" tabindex="-1"></a>        <span class="at">caption =</span> <span class="st">&quot;fit11H3の結果。&quot;</span>,</span>
<span id="cb993-20"><a href="god-spiked-the-integers.html#cb993-20" aria-hidden="true" tabindex="-1"></a>        <span class="at">digits=</span><span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb993-21"><a href="god-spiked-the-integers.html#cb993-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">latex_options =</span> <span class="st">&quot;stripe&quot;</span>) </span></code></pre></div>
<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:fit11H3">表11.30: </span>fit11H3の結果。
</caption>
<thead>
<tr>
<th style="text-align:left;">
parameter
</th>
<th style="text-align:right;">
Estimate
</th>
<th style="text-align:right;">
Est.Error
</th>
<th style="text-align:right;">
Q2.5
</th>
<th style="text-align:right;">
Q97.5
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Intercept
</td>
<td style="text-align:right;">
0.49
</td>
<td style="text-align:right;">
0.14
</td>
<td style="text-align:right;">
0.23
</td>
<td style="text-align:right;">
0.75
</td>
</tr>
<tr>
<td style="text-align:left;">
P
</td>
<td style="text-align:right;">
1.05
</td>
<td style="text-align:right;">
0.16
</td>
<td style="text-align:right;">
0.74
</td>
<td style="text-align:right;">
1.37
</td>
</tr>
</tbody>
</table>
<p>モデル’fit11H3’の結果を図示すると、以下の通り(図 <a href="god-spiked-the-integers.html#fig:fig-fit11H3">11.29</a>)。</p>
<div class="sourceCode" id="cb994"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb994-1"><a href="god-spiked-the-integers.html#cb994-1" aria-hidden="true" tabindex="-1"></a>nd <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">P =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">2</span>,<span class="dv">1</span>,<span class="at">length.out=</span><span class="dv">100</span>))</span>
<span id="cb994-2"><a href="god-spiked-the-integers.html#cb994-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb994-3"><a href="god-spiked-the-integers.html#cb994-3" aria-hidden="true" tabindex="-1"></a><span class="fu">fitted</span>(fit11H3, <span class="at">newdata =</span> nd, <span class="at">probs =</span> <span class="fu">c</span>(<span class="fl">0.055</span>, <span class="fl">0.945</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb994-4"><a href="god-spiked-the-integers.html#cb994-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb994-5"><a href="god-spiked-the-integers.html#cb994-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(nd) <span class="ot">-&gt;</span> fitH3</span>
<span id="cb994-6"><a href="god-spiked-the-integers.html#cb994-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb994-7"><a href="god-spiked-the-integers.html#cb994-7" aria-hidden="true" tabindex="-1"></a>dat2 <span class="sc">%&gt;%</span> </span>
<span id="cb994-8"><a href="god-spiked-the-integers.html#cb994-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> P))<span class="sc">+</span></span>
<span id="cb994-9"><a href="god-spiked-the-integers.html#cb994-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> SALAMAN), <span class="at">color =</span> <span class="st">&quot;navy&quot;</span>,</span>
<span id="cb994-10"><a href="god-spiked-the-integers.html#cb994-10" aria-hidden="true" tabindex="-1"></a>             <span class="at">size =</span> <span class="dv">4</span>, <span class="at">alpha =</span><span class="dv">2</span><span class="sc">/</span><span class="dv">3</span>,</span>
<span id="cb994-11"><a href="god-spiked-the-integers.html#cb994-11" aria-hidden="true" tabindex="-1"></a>             <span class="at">shape =</span> <span class="dv">16</span>)<span class="sc">+</span></span>
<span id="cb994-12"><a href="god-spiked-the-integers.html#cb994-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">data =</span> fitH3,</span>
<span id="cb994-13"><a href="god-spiked-the-integers.html#cb994-13" aria-hidden="true" tabindex="-1"></a>              <span class="fu">aes</span>(<span class="at">y =</span> Estimate, <span class="at">ymin =</span> Q5<span class="fl">.5</span>,</span>
<span id="cb994-14"><a href="god-spiked-the-integers.html#cb994-14" aria-hidden="true" tabindex="-1"></a>                  <span class="at">ymax =</span> Q94<span class="fl">.5</span>),</span>
<span id="cb994-15"><a href="god-spiked-the-integers.html#cb994-15" aria-hidden="true" tabindex="-1"></a>              <span class="at">color =</span> <span class="st">&quot;black&quot;</span>,<span class="at">fill=</span><span class="st">&quot;grey&quot;</span>,</span>
<span id="cb994-16"><a href="god-spiked-the-integers.html#cb994-16" aria-hidden="true" tabindex="-1"></a>              <span class="at">alpha =</span> <span class="dv">2</span><span class="sc">/</span><span class="dv">3</span>,</span>
<span id="cb994-17"><a href="god-spiked-the-integers.html#cb994-17" aria-hidden="true" tabindex="-1"></a>              <span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>)<span class="sc">+</span></span>
<span id="cb994-18"><a href="god-spiked-the-integers.html#cb994-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">aspect.ratio=</span><span class="dv">1</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fig-fit11H3"></span>
<img src="Rethinking_Bookdown_files/figure-html/fig-fit11H3-1.png" alt="fit11H3による推定結果" width="672" />
<p class="caption">
図11.29: fit11H3による推定結果
</p>
</div>
</div>
<div id="b-5" class="section level4 hasAnchor" number="11.5.9.2">
<h4><span class="header-section-number">11.5.9.2</span> b<a href="god-spiked-the-integers.html#b-5" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<blockquote>
<p>Can you improve the model by using the other predictor, FORESTAGE? Try any models you think useful. Can you explain why FORESTAGE helps or does not help with prediction?</p>
</blockquote>
<p>FORESTAGE(樹齢？)も入れたモデルを考える。初めに、交互作用がないモデルを立てる。結果は以下の通り。樹齢はほとんど影響を与えていないよう（表<a href="god-spiked-the-integers.html#tab:fit11H3-2">11.31</a>）。</p>
<div class="sourceCode" id="cb995"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb995-1"><a href="god-spiked-the-integers.html#cb995-1" aria-hidden="true" tabindex="-1"></a>dat2 <span class="ot">&lt;-</span> dat2 <span class="sc">%&gt;%</span> </span>
<span id="cb995-2"><a href="god-spiked-the-integers.html#cb995-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">F =</span> <span class="fu">standardize</span>(FORESTAGE))</span>
<span id="cb995-3"><a href="god-spiked-the-integers.html#cb995-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb995-4"><a href="god-spiked-the-integers.html#cb995-4" aria-hidden="true" tabindex="-1"></a>fit11H3_2  <span class="ot">&lt;-</span> <span class="fu">brm</span>(</span>
<span id="cb995-5"><a href="god-spiked-the-integers.html#cb995-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> dat2,</span>
<span id="cb995-6"><a href="god-spiked-the-integers.html#cb995-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">family=</span>poisson,</span>
<span id="cb995-7"><a href="god-spiked-the-integers.html#cb995-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">formula =</span> SALAMAN <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> P <span class="sc">+</span> F,</span>
<span id="cb995-8"><a href="god-spiked-the-integers.html#cb995-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>,<span class="fl">1.5</span>), <span class="at">class =</span> Intercept),</span>
<span id="cb995-9"><a href="god-spiked-the-integers.html#cb995-9" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>,<span class="fl">0.5</span>), <span class="at">class =</span> b)),</span>
<span id="cb995-10"><a href="god-spiked-the-integers.html#cb995-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">sample_prior =</span> <span class="cn">TRUE</span>,</span>
<span id="cb995-11"><a href="god-spiked-the-integers.html#cb995-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">backend =</span> <span class="st">&quot;cmdstanr&quot;</span>,</span>
<span id="cb995-12"><a href="god-spiked-the-integers.html#cb995-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed=</span><span class="dv">4</span>, <span class="at">file =</span> <span class="st">&quot;output/Chapter11/fit11H3_2&quot;</span></span>
<span id="cb995-13"><a href="god-spiked-the-integers.html#cb995-13" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<div class="sourceCode" id="cb996"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb996-1"><a href="god-spiked-the-integers.html#cb996-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fixef</span>(fit11H3_2, <span class="at">probs =</span> <span class="fu">c</span>(<span class="fl">0.025</span>,<span class="fl">0.975</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb996-2"><a href="god-spiked-the-integers.html#cb996-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb996-3"><a href="god-spiked-the-integers.html#cb996-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>(<span class="at">var =</span> <span class="st">&quot;parameter&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb996-4"><a href="god-spiked-the-integers.html#cb996-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="at">booktabs =</span> <span class="cn">TRUE</span>,</span>
<span id="cb996-5"><a href="god-spiked-the-integers.html#cb996-5" aria-hidden="true" tabindex="-1"></a>        <span class="at">digits =</span><span class="dv">2</span>,</span>
<span id="cb996-6"><a href="god-spiked-the-integers.html#cb996-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">caption =</span> <span class="st">&quot;fit11H3_2の結果&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb996-7"><a href="god-spiked-the-integers.html#cb996-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">latex_options =</span> <span class="st">&quot;stripe&quot;</span>) </span></code></pre></div>
<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:fit11H3-2">表11.31: </span>fit11H3_2の結果
</caption>
<thead>
<tr>
<th style="text-align:left;">
parameter
</th>
<th style="text-align:right;">
Estimate
</th>
<th style="text-align:right;">
Est.Error
</th>
<th style="text-align:right;">
Q2.5
</th>
<th style="text-align:right;">
Q97.5
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Intercept
</td>
<td style="text-align:right;">
0.49
</td>
<td style="text-align:right;">
0.14
</td>
<td style="text-align:right;">
0.19
</td>
<td style="text-align:right;">
0.76
</td>
</tr>
<tr>
<td style="text-align:left;">
P
</td>
<td style="text-align:right;">
1.03
</td>
<td style="text-align:right;">
0.17
</td>
<td style="text-align:right;">
0.71
</td>
<td style="text-align:right;">
1.39
</td>
</tr>
<tr>
<td style="text-align:left;">
F
</td>
<td style="text-align:right;">
0.02
</td>
<td style="text-align:right;">
0.09
</td>
<td style="text-align:right;">
-0.16
</td>
<td style="text-align:right;">
0.20
</td>
</tr>
</tbody>
</table>
<p>結果を図示しても、ほとんど効果はないよう(図<a href="god-spiked-the-integers.html#fig:11H3-2">11.30</a>)。</p>
<div class="sourceCode" id="cb997"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb997-1"><a href="god-spiked-the-integers.html#cb997-1" aria-hidden="true" tabindex="-1"></a>nd <span class="ot">&lt;-</span> <span class="fu">crossing</span>(<span class="at">P =</span> <span class="dv">0</span>, <span class="at">F =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">1</span>,<span class="dv">3</span>,<span class="at">length.out=</span><span class="dv">100</span>))</span>
<span id="cb997-2"><a href="god-spiked-the-integers.html#cb997-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb997-3"><a href="god-spiked-the-integers.html#cb997-3" aria-hidden="true" tabindex="-1"></a><span class="fu">fitted</span>(fit11H3_2, nd, <span class="at">probs =</span> <span class="fu">c</span>(<span class="fl">0.055</span>, <span class="fl">0.945</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb997-4"><a href="god-spiked-the-integers.html#cb997-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb997-5"><a href="god-spiked-the-integers.html#cb997-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(nd) <span class="ot">-&gt;</span> fitH3_2</span>
<span id="cb997-6"><a href="god-spiked-the-integers.html#cb997-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb997-7"><a href="god-spiked-the-integers.html#cb997-7" aria-hidden="true" tabindex="-1"></a>dat2 <span class="sc">%&gt;%</span> </span>
<span id="cb997-8"><a href="god-spiked-the-integers.html#cb997-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> F))<span class="sc">+</span></span>
<span id="cb997-9"><a href="god-spiked-the-integers.html#cb997-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> SALAMAN), <span class="at">color =</span> <span class="st">&quot;navy&quot;</span>,</span>
<span id="cb997-10"><a href="god-spiked-the-integers.html#cb997-10" aria-hidden="true" tabindex="-1"></a>             <span class="at">size =</span> <span class="dv">4</span>, <span class="at">alpha =</span><span class="dv">2</span><span class="sc">/</span><span class="dv">3</span>,</span>
<span id="cb997-11"><a href="god-spiked-the-integers.html#cb997-11" aria-hidden="true" tabindex="-1"></a>             <span class="at">shape =</span> <span class="dv">16</span>)<span class="sc">+</span></span>
<span id="cb997-12"><a href="god-spiked-the-integers.html#cb997-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">data =</span> fitH3_2,</span>
<span id="cb997-13"><a href="god-spiked-the-integers.html#cb997-13" aria-hidden="true" tabindex="-1"></a>              <span class="fu">aes</span>(<span class="at">y =</span> Estimate, <span class="at">ymin =</span> Q5<span class="fl">.5</span>,</span>
<span id="cb997-14"><a href="god-spiked-the-integers.html#cb997-14" aria-hidden="true" tabindex="-1"></a>                  <span class="at">ymax =</span> Q94<span class="fl">.5</span>),</span>
<span id="cb997-15"><a href="god-spiked-the-integers.html#cb997-15" aria-hidden="true" tabindex="-1"></a>              <span class="at">color =</span> <span class="st">&quot;black&quot;</span>,<span class="at">fill=</span><span class="st">&quot;grey&quot;</span>,</span>
<span id="cb997-16"><a href="god-spiked-the-integers.html#cb997-16" aria-hidden="true" tabindex="-1"></a>              <span class="at">alpha =</span> <span class="dv">2</span><span class="sc">/</span><span class="dv">3</span>,</span>
<span id="cb997-17"><a href="god-spiked-the-integers.html#cb997-17" aria-hidden="true" tabindex="-1"></a>              <span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>)<span class="sc">+</span></span>
<span id="cb997-18"><a href="god-spiked-the-integers.html#cb997-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">aspect.ratio=</span><span class="dv">1</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:11H3-2"></span>
<img src="Rethinking_Bookdown_files/figure-html/11H3-2-1.png" alt="fit11H4_2の推定結果" width="672" />
<p class="caption">
図11.30: fit11H4_2の推定結果
</p>
</div>
<p>一応、交互作用のあるモデルも考える。</p>
<div class="sourceCode" id="cb998"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb998-1"><a href="god-spiked-the-integers.html#cb998-1" aria-hidden="true" tabindex="-1"></a>fit11H3_3  <span class="ot">&lt;-</span> <span class="fu">brm</span>(</span>
<span id="cb998-2"><a href="god-spiked-the-integers.html#cb998-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> dat2,</span>
<span id="cb998-3"><a href="god-spiked-the-integers.html#cb998-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">family=</span>poisson,</span>
<span id="cb998-4"><a href="god-spiked-the-integers.html#cb998-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">formula =</span> SALAMAN <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> P <span class="sc">+</span> F <span class="sc">+</span> P<span class="sc">:</span>F,</span>
<span id="cb998-5"><a href="god-spiked-the-integers.html#cb998-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>,<span class="fl">1.5</span>), <span class="at">class =</span> Intercept),</span>
<span id="cb998-6"><a href="god-spiked-the-integers.html#cb998-6" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>,<span class="fl">0.5</span>), <span class="at">class =</span> b)),</span>
<span id="cb998-7"><a href="god-spiked-the-integers.html#cb998-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">sample_prior =</span> <span class="cn">TRUE</span>,</span>
<span id="cb998-8"><a href="god-spiked-the-integers.html#cb998-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">backend =</span> <span class="st">&quot;cmdstanr&quot;</span>,</span>
<span id="cb998-9"><a href="god-spiked-the-integers.html#cb998-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed=</span><span class="dv">4</span>, <span class="at">file =</span> <span class="st">&quot;output/Chapter11/fit11H3_3&quot;</span></span>
<span id="cb998-10"><a href="god-spiked-the-integers.html#cb998-10" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p>結果はほとんど変わらないよう。</p>
<div class="sourceCode" id="cb999"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb999-1"><a href="god-spiked-the-integers.html#cb999-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fixef</span>(fit11H3_3, <span class="at">probs =</span> <span class="fu">c</span>(<span class="fl">0.025</span>,<span class="fl">0.975</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb999-2"><a href="god-spiked-the-integers.html#cb999-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb999-3"><a href="god-spiked-the-integers.html#cb999-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>(<span class="at">var =</span> <span class="st">&quot;parameter&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb999-4"><a href="god-spiked-the-integers.html#cb999-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="at">booktabs =</span> <span class="cn">TRUE</span>,</span>
<span id="cb999-5"><a href="god-spiked-the-integers.html#cb999-5" aria-hidden="true" tabindex="-1"></a>        <span class="at">digits=</span><span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb999-6"><a href="god-spiked-the-integers.html#cb999-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">latex_options =</span> <span class="st">&quot;stripe&quot;</span>) </span></code></pre></div>
<table class="table" style="margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;">
parameter
</th>
<th style="text-align:right;">
Estimate
</th>
<th style="text-align:right;">
Est.Error
</th>
<th style="text-align:right;">
Q2.5
</th>
<th style="text-align:right;">
Q97.5
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Intercept
</td>
<td style="text-align:right;">
0.58
</td>
<td style="text-align:right;">
0.20
</td>
<td style="text-align:right;">
0.18
</td>
<td style="text-align:right;">
0.96
</td>
</tr>
<tr>
<td style="text-align:left;">
P
</td>
<td style="text-align:right;">
0.92
</td>
<td style="text-align:right;">
0.24
</td>
<td style="text-align:right;">
0.44
</td>
<td style="text-align:right;">
1.41
</td>
</tr>
<tr>
<td style="text-align:left;">
F
</td>
<td style="text-align:right;">
0.15
</td>
<td style="text-align:right;">
0.24
</td>
<td style="text-align:right;">
-0.31
</td>
<td style="text-align:right;">
0.64
</td>
</tr>
<tr>
<td style="text-align:left;">
P:F
</td>
<td style="text-align:right;">
-0.17
</td>
<td style="text-align:right;">
0.29
</td>
<td style="text-align:right;">
-0.76
</td>
<td style="text-align:right;">
0.38
</td>
</tr>
</tbody>
</table>
<p>結果は以下の通り(図<a href="god-spiked-the-integers.html#fig:ok">11.31</a>)。</p>
<div class="sourceCode" id="cb1000"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1000-1"><a href="god-spiked-the-integers.html#cb1000-1" aria-hidden="true" tabindex="-1"></a><span class="co"># F = 0</span></span>
<span id="cb1000-2"><a href="god-spiked-the-integers.html#cb1000-2" aria-hidden="true" tabindex="-1"></a>nd_1 <span class="ot">&lt;-</span> <span class="fu">crossing</span>(<span class="at">P =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">2</span>,<span class="dv">1</span>,<span class="at">length.out=</span><span class="dv">50</span>), <span class="at">F =</span> <span class="sc">-</span><span class="fl">0.5</span>)</span>
<span id="cb1000-3"><a href="god-spiked-the-integers.html#cb1000-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1000-4"><a href="god-spiked-the-integers.html#cb1000-4" aria-hidden="true" tabindex="-1"></a><span class="fu">fitted</span>(fit11H3_3, nd_1, <span class="at">probs =</span> <span class="fu">c</span>(<span class="fl">0.055</span>, <span class="fl">0.945</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1000-5"><a href="god-spiked-the-integers.html#cb1000-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1000-6"><a href="god-spiked-the-integers.html#cb1000-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(nd_1)<span class="ot">-&gt;</span> fitH3_3</span>
<span id="cb1000-7"><a href="god-spiked-the-integers.html#cb1000-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1000-8"><a href="god-spiked-the-integers.html#cb1000-8" aria-hidden="true" tabindex="-1"></a>dat2 <span class="sc">%&gt;%</span> </span>
<span id="cb1000-9"><a href="god-spiked-the-integers.html#cb1000-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(F<span class="sc">&gt;-</span><span class="dv">1</span>, F <span class="sc">&lt;</span><span class="dv">0</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1000-10"><a href="god-spiked-the-integers.html#cb1000-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> P, <span class="at">group=</span><span class="dv">1</span>))<span class="sc">+</span></span>
<span id="cb1000-11"><a href="god-spiked-the-integers.html#cb1000-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> SALAMAN), <span class="at">color =</span> <span class="st">&quot;navy&quot;</span>,</span>
<span id="cb1000-12"><a href="god-spiked-the-integers.html#cb1000-12" aria-hidden="true" tabindex="-1"></a>             <span class="at">size =</span> <span class="dv">4</span>, <span class="at">alpha =</span><span class="dv">2</span><span class="sc">/</span><span class="dv">3</span>,</span>
<span id="cb1000-13"><a href="god-spiked-the-integers.html#cb1000-13" aria-hidden="true" tabindex="-1"></a>             <span class="at">shape =</span> <span class="dv">16</span>)<span class="sc">+</span></span>
<span id="cb1000-14"><a href="god-spiked-the-integers.html#cb1000-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">data =</span> fitH3_3,</span>
<span id="cb1000-15"><a href="god-spiked-the-integers.html#cb1000-15" aria-hidden="true" tabindex="-1"></a>              <span class="fu">aes</span>(<span class="at">y =</span> Estimate, <span class="at">ymin =</span> Q5<span class="fl">.5</span>,</span>
<span id="cb1000-16"><a href="god-spiked-the-integers.html#cb1000-16" aria-hidden="true" tabindex="-1"></a>                  <span class="at">ymax =</span> Q94<span class="fl">.5</span>),</span>
<span id="cb1000-17"><a href="god-spiked-the-integers.html#cb1000-17" aria-hidden="true" tabindex="-1"></a>              <span class="at">color =</span> <span class="st">&quot;black&quot;</span>,<span class="at">fill=</span><span class="st">&quot;grey&quot;</span>,</span>
<span id="cb1000-18"><a href="god-spiked-the-integers.html#cb1000-18" aria-hidden="true" tabindex="-1"></a>              <span class="at">alpha =</span> <span class="dv">2</span><span class="sc">/</span><span class="dv">3</span>,</span>
<span id="cb1000-19"><a href="god-spiked-the-integers.html#cb1000-19" aria-hidden="true" tabindex="-1"></a>              <span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>)<span class="sc">+</span></span>
<span id="cb1000-20"><a href="god-spiked-the-integers.html#cb1000-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">aspect.ratio=</span><span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb1000-21"><a href="god-spiked-the-integers.html#cb1000-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">&quot;A: F = -0.5 (-1&lt;F&lt;0)&quot;</span>) <span class="ot">-&gt;</span> p17</span>
<span id="cb1000-22"><a href="god-spiked-the-integers.html#cb1000-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1000-23"><a href="god-spiked-the-integers.html#cb1000-23" aria-hidden="true" tabindex="-1"></a><span class="co"># F = 1</span></span>
<span id="cb1000-24"><a href="god-spiked-the-integers.html#cb1000-24" aria-hidden="true" tabindex="-1"></a>nd_2 <span class="ot">&lt;-</span> <span class="fu">crossing</span>(<span class="at">P =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">2</span>,<span class="dv">1</span>,<span class="at">length.out=</span><span class="dv">50</span>), <span class="at">F =</span> <span class="fl">0.5</span>)</span>
<span id="cb1000-25"><a href="god-spiked-the-integers.html#cb1000-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1000-26"><a href="god-spiked-the-integers.html#cb1000-26" aria-hidden="true" tabindex="-1"></a><span class="fu">fitted</span>(fit11H3_3, nd_2, <span class="at">probs =</span> <span class="fu">c</span>(<span class="fl">0.055</span>, <span class="fl">0.945</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1000-27"><a href="god-spiked-the-integers.html#cb1000-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1000-28"><a href="god-spiked-the-integers.html#cb1000-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(nd_1)<span class="ot">-&gt;</span> fitH3_3_2</span>
<span id="cb1000-29"><a href="god-spiked-the-integers.html#cb1000-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1000-30"><a href="god-spiked-the-integers.html#cb1000-30" aria-hidden="true" tabindex="-1"></a>dat2 <span class="sc">%&gt;%</span> </span>
<span id="cb1000-31"><a href="god-spiked-the-integers.html#cb1000-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(F<span class="sc">&gt;</span><span class="dv">0</span>, F<span class="sc">&lt;</span><span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1000-32"><a href="god-spiked-the-integers.html#cb1000-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> P, <span class="at">group=</span><span class="dv">1</span>))<span class="sc">+</span></span>
<span id="cb1000-33"><a href="god-spiked-the-integers.html#cb1000-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> SALAMAN), <span class="at">color =</span> <span class="st">&quot;navy&quot;</span>,</span>
<span id="cb1000-34"><a href="god-spiked-the-integers.html#cb1000-34" aria-hidden="true" tabindex="-1"></a>             <span class="at">size =</span> <span class="dv">4</span>, <span class="at">alpha =</span><span class="dv">2</span><span class="sc">/</span><span class="dv">3</span>,</span>
<span id="cb1000-35"><a href="god-spiked-the-integers.html#cb1000-35" aria-hidden="true" tabindex="-1"></a>             <span class="at">shape =</span> <span class="dv">16</span>)<span class="sc">+</span></span>
<span id="cb1000-36"><a href="god-spiked-the-integers.html#cb1000-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">data =</span> fitH3_3_2,</span>
<span id="cb1000-37"><a href="god-spiked-the-integers.html#cb1000-37" aria-hidden="true" tabindex="-1"></a>              <span class="fu">aes</span>(<span class="at">y =</span> Estimate, <span class="at">ymin =</span> Q5<span class="fl">.5</span>,</span>
<span id="cb1000-38"><a href="god-spiked-the-integers.html#cb1000-38" aria-hidden="true" tabindex="-1"></a>                  <span class="at">ymax =</span> Q94<span class="fl">.5</span>),</span>
<span id="cb1000-39"><a href="god-spiked-the-integers.html#cb1000-39" aria-hidden="true" tabindex="-1"></a>              <span class="at">color =</span> <span class="st">&quot;black&quot;</span>,<span class="at">fill=</span><span class="st">&quot;grey&quot;</span>,</span>
<span id="cb1000-40"><a href="god-spiked-the-integers.html#cb1000-40" aria-hidden="true" tabindex="-1"></a>              <span class="at">alpha =</span> <span class="dv">2</span><span class="sc">/</span><span class="dv">3</span>,</span>
<span id="cb1000-41"><a href="god-spiked-the-integers.html#cb1000-41" aria-hidden="true" tabindex="-1"></a>              <span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>)<span class="sc">+</span></span>
<span id="cb1000-42"><a href="god-spiked-the-integers.html#cb1000-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">aspect.ratio=</span><span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb1000-43"><a href="god-spiked-the-integers.html#cb1000-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">&quot;B: F = 0.5(0&lt;F&lt;1)&quot;</span>) <span class="ot">-&gt;</span> p18</span>
<span id="cb1000-44"><a href="god-spiked-the-integers.html#cb1000-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1000-45"><a href="god-spiked-the-integers.html#cb1000-45" aria-hidden="true" tabindex="-1"></a><span class="co"># F = 2</span></span>
<span id="cb1000-46"><a href="god-spiked-the-integers.html#cb1000-46" aria-hidden="true" tabindex="-1"></a>nd_3 <span class="ot">&lt;-</span> <span class="fu">crossing</span>(<span class="at">P =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">2</span>,<span class="dv">1</span>,<span class="at">length.out=</span><span class="dv">50</span>), <span class="at">F =</span> <span class="fl">1.5</span>)</span>
<span id="cb1000-47"><a href="god-spiked-the-integers.html#cb1000-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1000-48"><a href="god-spiked-the-integers.html#cb1000-48" aria-hidden="true" tabindex="-1"></a><span class="fu">fitted</span>(fit11H3_3, nd_3, <span class="at">probs =</span> <span class="fu">c</span>(<span class="fl">0.055</span>, <span class="fl">0.945</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1000-49"><a href="god-spiked-the-integers.html#cb1000-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1000-50"><a href="god-spiked-the-integers.html#cb1000-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(nd_1)<span class="ot">-&gt;</span> fitH3_3_3</span>
<span id="cb1000-51"><a href="god-spiked-the-integers.html#cb1000-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1000-52"><a href="god-spiked-the-integers.html#cb1000-52" aria-hidden="true" tabindex="-1"></a>dat2 <span class="sc">%&gt;%</span> </span>
<span id="cb1000-53"><a href="god-spiked-the-integers.html#cb1000-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(F<span class="sc">&gt;</span><span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1000-54"><a href="god-spiked-the-integers.html#cb1000-54" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> P, <span class="at">group=</span><span class="dv">1</span>))<span class="sc">+</span></span>
<span id="cb1000-55"><a href="god-spiked-the-integers.html#cb1000-55" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> SALAMAN), <span class="at">color =</span> <span class="st">&quot;navy&quot;</span>,</span>
<span id="cb1000-56"><a href="god-spiked-the-integers.html#cb1000-56" aria-hidden="true" tabindex="-1"></a>             <span class="at">size =</span> <span class="dv">4</span>, <span class="at">alpha =</span><span class="dv">2</span><span class="sc">/</span><span class="dv">3</span>,</span>
<span id="cb1000-57"><a href="god-spiked-the-integers.html#cb1000-57" aria-hidden="true" tabindex="-1"></a>             <span class="at">shape =</span> <span class="dv">16</span>)<span class="sc">+</span></span>
<span id="cb1000-58"><a href="god-spiked-the-integers.html#cb1000-58" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">data =</span> fitH3_3_3,</span>
<span id="cb1000-59"><a href="god-spiked-the-integers.html#cb1000-59" aria-hidden="true" tabindex="-1"></a>              <span class="fu">aes</span>(<span class="at">y =</span> Estimate, <span class="at">ymin =</span> Q5<span class="fl">.5</span>,</span>
<span id="cb1000-60"><a href="god-spiked-the-integers.html#cb1000-60" aria-hidden="true" tabindex="-1"></a>                  <span class="at">ymax =</span> Q94<span class="fl">.5</span>),</span>
<span id="cb1000-61"><a href="god-spiked-the-integers.html#cb1000-61" aria-hidden="true" tabindex="-1"></a>              <span class="at">color =</span> <span class="st">&quot;black&quot;</span>,<span class="at">fill=</span><span class="st">&quot;grey&quot;</span>,</span>
<span id="cb1000-62"><a href="god-spiked-the-integers.html#cb1000-62" aria-hidden="true" tabindex="-1"></a>              <span class="at">alpha =</span> <span class="dv">2</span><span class="sc">/</span><span class="dv">3</span>,</span>
<span id="cb1000-63"><a href="god-spiked-the-integers.html#cb1000-63" aria-hidden="true" tabindex="-1"></a>              <span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>)<span class="sc">+</span></span>
<span id="cb1000-64"><a href="god-spiked-the-integers.html#cb1000-64" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">aspect.ratio=</span><span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb1000-65"><a href="god-spiked-the-integers.html#cb1000-65" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">&quot;C: F = 1.5(F&gt;1)&quot;</span>) <span class="ot">-&gt;</span> p19</span>
<span id="cb1000-66"><a href="god-spiked-the-integers.html#cb1000-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1000-67"><a href="god-spiked-the-integers.html#cb1000-67" aria-hidden="true" tabindex="-1"></a>p17 <span class="sc">+</span> p18 <span class="sc">+</span> p19</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:ok"></span>
<img src="Rethinking_Bookdown_files/figure-html/ok-1.png" alt="fit11H3_3の推定結果を図示したもの。AはFが-1&lt;F&lt;0のデータを示し、F=-0.5の結果を示したもの。BはFが0&lt;F&lt;1のデータを示し、F=0.5の結果を示したもの。CはFが1&lt;Fのデータを示し、F=1.5の結果を示したもの。" width="672" />
<p class="caption">
図11.31: fit11H3_3の推定結果を図示したもの。AはFが-1&lt;F&lt;0のデータを示し、F=-0.5の結果を示したもの。BはFが0&lt;F&lt;1のデータを示し、F=0.5の結果を示したもの。CはFが1&lt;Fのデータを示し、F=1.5の結果を示したもの。
</p>
</div>
</div>
</div>
<div id="h4-8" class="section level3 hasAnchor" number="11.5.10">
<h3><span class="header-section-number">11.5.10</span> 11H4<a href="god-spiked-the-integers.html#h4-8" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<blockquote>
<p>he data in data(NWOGrants) are outcomes for scientific funding applications for the Netherlands Organization for Scientific Research (NWO) from 2010–2012 (see van der Lee &amp; Ellemers, 2015, for data and context). These data have a very similar structure to the UCBAdmit data discussed in the chapter. I want you to consider a similar question: What are the total and direct causal effects of gender on grant awards? Consider a mediation path (a pipe) through discipline. Draw the corresponding DAG and then use one or more binomial GLMs to answer the question. What is your causal interpretation? If NWO’s goal is to equalize rates of funding between men and women, what type of intervention would be most effective?</p>
</blockquote>
<p>オランダ科学協会における研究費の応募結果をしてしたデータセットを用いる<span class="citation">(<a href="#ref-Van2015" role="doc-biblioref">Van der Lee and Ellemers 2015</a>)</span>。分野(discipline)と性別(gender)ごとに応募数(applications)と採用数(awards)が収められている(表 <a href="god-spiked-the-integers.html#tab:NWOGrants">11.32</a>。年齢と分野が採用率にどのように影響するかを確認する。</p>
<div class="sourceCode" id="cb1001"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1001-1"><a href="god-spiked-the-integers.html#cb1001-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(NWOGrants)</span>
<span id="cb1001-2"><a href="god-spiked-the-integers.html#cb1001-2" aria-hidden="true" tabindex="-1"></a>dat3 <span class="ot">&lt;-</span> NWOGrants</span>
<span id="cb1001-3"><a href="god-spiked-the-integers.html#cb1001-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(dat3) <span class="sc">%&gt;%</span> </span>
<span id="cb1001-4"><a href="god-spiked-the-integers.html#cb1001-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="at">booktabs=</span><span class="cn">TRUE</span>,</span>
<span id="cb1001-5"><a href="god-spiked-the-integers.html#cb1001-5" aria-hidden="true" tabindex="-1"></a>        <span class="at">caption =</span> <span class="st">&quot;NWOGrantsデータの中身&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb1001-6"><a href="god-spiked-the-integers.html#cb1001-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">latex_options =</span> <span class="st">&quot;stripe&quot;</span>)</span></code></pre></div>
<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:NWOGrants">表11.32: </span>NWOGrantsデータの中身
</caption>
<thead>
<tr>
<th style="text-align:left;">
discipline
</th>
<th style="text-align:left;">
gender
</th>
<th style="text-align:right;">
applications
</th>
<th style="text-align:right;">
awards
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Chemical sciences
</td>
<td style="text-align:left;">
m
</td>
<td style="text-align:right;">
83
</td>
<td style="text-align:right;">
22
</td>
</tr>
<tr>
<td style="text-align:left;">
Chemical sciences
</td>
<td style="text-align:left;">
f
</td>
<td style="text-align:right;">
39
</td>
<td style="text-align:right;">
10
</td>
</tr>
<tr>
<td style="text-align:left;">
Physical sciences
</td>
<td style="text-align:left;">
m
</td>
<td style="text-align:right;">
135
</td>
<td style="text-align:right;">
26
</td>
</tr>
<tr>
<td style="text-align:left;">
Physical sciences
</td>
<td style="text-align:left;">
f
</td>
<td style="text-align:right;">
39
</td>
<td style="text-align:right;">
9
</td>
</tr>
<tr>
<td style="text-align:left;">
Physics
</td>
<td style="text-align:left;">
m
</td>
<td style="text-align:right;">
67
</td>
<td style="text-align:right;">
18
</td>
</tr>
<tr>
<td style="text-align:left;">
Physics
</td>
<td style="text-align:left;">
f
</td>
<td style="text-align:right;">
9
</td>
<td style="text-align:right;">
2
</td>
</tr>
</tbody>
</table>
<p>設問で想定されているDAGは以下のようになる(gender: D, discipline: D, awards: A)。</p>
<div class="sourceCode" id="cb1002"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1002-1"><a href="god-spiked-the-integers.html#cb1002-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dagify</span>(A <span class="sc">~</span> G <span class="sc">+</span> D,</span>
<span id="cb1002-2"><a href="god-spiked-the-integers.html#cb1002-2" aria-hidden="true" tabindex="-1"></a>       D <span class="sc">~</span> G) <span class="sc">%&gt;%</span> </span>
<span id="cb1002-3"><a href="god-spiked-the-integers.html#cb1002-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggdag</span>()<span class="sc">+</span></span>
<span id="cb1002-4"><a href="god-spiked-the-integers.html#cb1002-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_dag</span>()</span></code></pre></div>
<p><img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-535-1.png" width="384" style="display: block; margin: auto;" /></p>
<p>まず、性別だけを入れたときのGLMを行う。これは、分野(<code>D</code>)を介した影響も含む総合効果の推定にあたる。分野を考慮しなければ、性別間で大きな違いはない。</p>
<div class="sourceCode" id="cb1003"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1003-1"><a href="god-spiked-the-integers.html#cb1003-1" aria-hidden="true" tabindex="-1"></a>fit11H4_1 <span class="ot">&lt;-</span></span>
<span id="cb1003-2"><a href="god-spiked-the-integers.html#cb1003-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">brm</span>(<span class="at">data =</span> dat3,</span>
<span id="cb1003-3"><a href="god-spiked-the-integers.html#cb1003-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> binomial,</span>
<span id="cb1003-4"><a href="god-spiked-the-integers.html#cb1003-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">formula =</span> awards<span class="sc">|</span><span class="fu">trials</span>(applications) <span class="sc">~</span> <span class="dv">0</span> <span class="sc">+</span> gender,</span>
<span id="cb1003-5"><a href="god-spiked-the-integers.html#cb1003-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>,<span class="fl">1.5</span>), <span class="at">class=</span>b)),</span>
<span id="cb1003-6"><a href="god-spiked-the-integers.html#cb1003-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">backend =</span> <span class="st">&quot;cmdstanr&quot;</span>,</span>
<span id="cb1003-7"><a href="god-spiked-the-integers.html#cb1003-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">seed=</span><span class="dv">11</span>, <span class="at">file =</span> <span class="st">&quot;output/Chapter11/fit11H4_1&quot;</span>)</span>
<span id="cb1003-8"><a href="god-spiked-the-integers.html#cb1003-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1003-9"><a href="god-spiked-the-integers.html#cb1003-9" aria-hidden="true" tabindex="-1"></a><span class="fu">fixef</span>(fit11H4_1) <span class="sc">%&gt;%</span> </span>
<span id="cb1003-10"><a href="god-spiked-the-integers.html#cb1003-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1003-11"><a href="god-spiked-the-integers.html#cb1003-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>(<span class="at">var =</span> <span class="st">&quot;parameter&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1003-12"><a href="god-spiked-the-integers.html#cb1003-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="at">booktabs =</span> T,</span>
<span id="cb1003-13"><a href="god-spiked-the-integers.html#cb1003-13" aria-hidden="true" tabindex="-1"></a>        <span class="at">digits=</span><span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1003-14"><a href="god-spiked-the-integers.html#cb1003-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">latex_options =</span> <span class="st">&quot;stripe&quot;</span>) </span></code></pre></div>
<table class="table" style="margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;">
parameter
</th>
<th style="text-align:right;">
Estimate
</th>
<th style="text-align:right;">
Est.Error
</th>
<th style="text-align:right;">
Q2.5
</th>
<th style="text-align:right;">
Q97.5
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
genderf
</td>
<td style="text-align:right;">
-1.74
</td>
<td style="text-align:right;">
0.08
</td>
<td style="text-align:right;">
-1.90
</td>
<td style="text-align:right;">
-1.58
</td>
</tr>
<tr>
<td style="text-align:left;">
genderm
</td>
<td style="text-align:right;">
-1.53
</td>
<td style="text-align:right;">
0.06
</td>
<td style="text-align:right;">
-1.66
</td>
<td style="text-align:right;">
-1.41
</td>
</tr>
</tbody>
</table>
<p>結果を図示する(図<a href="god-spiked-the-integers.html#fig:11H4-1">11.32</a>)。実際のデータには全くマッチしていない。それぞれの性別が採用される期待値は、女性は0.15、男性は0.18である。</p>
<div class="sourceCode" id="cb1004"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1004-1"><a href="god-spiked-the-integers.html#cb1004-1" aria-hidden="true" tabindex="-1"></a>cond <span class="ot">&lt;-</span>  <span class="fu">c</span>(<span class="st">&quot;che M&quot;</span>,<span class="st">&quot;che F&quot;</span>,<span class="st">&quot;phcl M&quot;</span>,<span class="st">&quot;phcl F&quot;</span>,</span>
<span id="cb1004-2"><a href="god-spiked-the-integers.html#cb1004-2" aria-hidden="true" tabindex="-1"></a>                  <span class="st">&quot;phcs M&quot;</span>,<span class="st">&quot;phcs F&quot;</span>,<span class="st">&quot;hum M&quot;</span>,<span class="st">&quot;hum F&quot;</span>,</span>
<span id="cb1004-3"><a href="god-spiked-the-integers.html#cb1004-3" aria-hidden="true" tabindex="-1"></a>                  <span class="st">&quot;tech M&quot;</span>, <span class="st">&quot;tech F&quot;</span>, <span class="st">&quot;inter M&quot;</span>, <span class="st">&quot;inter F&quot;</span>,</span>
<span id="cb1004-4"><a href="god-spiked-the-integers.html#cb1004-4" aria-hidden="true" tabindex="-1"></a>           <span class="st">&quot;earth M&quot;</span>, <span class="st">&quot;earth F&quot;</span>, <span class="st">&quot;social M&quot;</span>, <span class="st">&quot;social F&quot;</span>,</span>
<span id="cb1004-5"><a href="god-spiked-the-integers.html#cb1004-5" aria-hidden="true" tabindex="-1"></a>           <span class="st">&quot;med M&quot;</span>, <span class="st">&quot;med F&quot;</span>)</span>
<span id="cb1004-6"><a href="god-spiked-the-integers.html#cb1004-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1004-7"><a href="god-spiked-the-integers.html#cb1004-7" aria-hidden="true" tabindex="-1"></a><span class="fu">fitted</span>(fit11H4_1, <span class="at">probs =</span> <span class="fu">c</span>(<span class="fl">0.055</span>, <span class="fl">0.945</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1004-8"><a href="god-spiked-the-integers.html#cb1004-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1004-9"><a href="god-spiked-the-integers.html#cb1004-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(dat3) <span class="sc">%&gt;%</span> </span>
<span id="cb1004-10"><a href="god-spiked-the-integers.html#cb1004-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">n =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">n</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb1004-11"><a href="god-spiked-the-integers.html#cb1004-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">cond =</span> cond) <span class="sc">%&gt;%</span> </span>
<span id="cb1004-12"><a href="god-spiked-the-integers.html#cb1004-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prop =</span> awards<span class="sc">/</span>applications,</span>
<span id="cb1004-13"><a href="god-spiked-the-integers.html#cb1004-13" aria-hidden="true" tabindex="-1"></a>         <span class="at">prop_est =</span> Estimate<span class="sc">/</span>applications,</span>
<span id="cb1004-14"><a href="god-spiked-the-integers.html#cb1004-14" aria-hidden="true" tabindex="-1"></a>         <span class="at">ub =</span> Q5<span class="fl">.5</span><span class="sc">/</span>applications,</span>
<span id="cb1004-15"><a href="god-spiked-the-integers.html#cb1004-15" aria-hidden="true" tabindex="-1"></a>         <span class="at">lb =</span> Q94<span class="fl">.5</span><span class="sc">/</span>applications) <span class="sc">%&gt;%</span> </span>
<span id="cb1004-16"><a href="god-spiked-the-integers.html#cb1004-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>cond))<span class="sc">+</span></span>
<span id="cb1004-17"><a href="god-spiked-the-integers.html#cb1004-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> prop),</span>
<span id="cb1004-18"><a href="god-spiked-the-integers.html#cb1004-18" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> <span class="st">&quot;navy&quot;</span>,</span>
<span id="cb1004-19"><a href="god-spiked-the-integers.html#cb1004-19" aria-hidden="true" tabindex="-1"></a>             <span class="at">size=</span><span class="dv">4</span>)<span class="sc">+</span></span>
<span id="cb1004-20"><a href="god-spiked-the-integers.html#cb1004-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_pointinterval</span>(<span class="fu">aes</span>(<span class="at">y =</span> prop_est,</span>
<span id="cb1004-21"><a href="god-spiked-the-integers.html#cb1004-21" aria-hidden="true" tabindex="-1"></a>                         <span class="at">ymin =</span> lb,</span>
<span id="cb1004-22"><a href="god-spiked-the-integers.html#cb1004-22" aria-hidden="true" tabindex="-1"></a>                         <span class="at">ymax =</span> ub),</span>
<span id="cb1004-23"><a href="god-spiked-the-integers.html#cb1004-23" aria-hidden="true" tabindex="-1"></a>                     <span class="at">shape =</span><span class="dv">1</span>, <span class="at">point_size=</span><span class="dv">3</span>)<span class="sc">+</span></span>
<span id="cb1004-24"><a href="god-spiked-the-integers.html#cb1004-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">&quot;採用率&quot;</span>,</span>
<span id="cb1004-25"><a href="god-spiked-the-integers.html#cb1004-25" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="cn">NULL</span>)<span class="sc">+</span></span>
<span id="cb1004-26"><a href="god-spiked-the-integers.html#cb1004-26" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">family =</span><span class="st">&quot;Yu Mincho&quot;</span>),</span>
<span id="cb1004-27"><a href="god-spiked-the-integers.html#cb1004-27" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">family =</span><span class="st">&quot;Yu Mincho&quot;</span>),</span>
<span id="cb1004-28"><a href="god-spiked-the-integers.html#cb1004-28" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>))</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:11H4-1"></span>
<img src="Rethinking_Bookdown_files/figure-html/11H4-1-1.png" alt="性別だけ考慮したモデルfit11H4_1の結果" width="672" />
<p class="caption">
図11.32: 性別だけ考慮したモデルfit11H4_1の結果
</p>
</div>
<p><br/></p>
<p>続いて、分野も説明変数に入れたモデルを考える。分析結果は以下の通り。やはり性別はそこまで影響していない。</p>
<div class="sourceCode" id="cb1005"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1005-1"><a href="god-spiked-the-integers.html#cb1005-1" aria-hidden="true" tabindex="-1"></a>fit11H4_2 <span class="ot">&lt;-</span></span>
<span id="cb1005-2"><a href="god-spiked-the-integers.html#cb1005-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">brm</span>(<span class="at">data =</span> dat3,</span>
<span id="cb1005-3"><a href="god-spiked-the-integers.html#cb1005-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> binomial,</span>
<span id="cb1005-4"><a href="god-spiked-the-integers.html#cb1005-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">formula =</span> awards<span class="sc">|</span><span class="fu">trials</span>(applications) <span class="sc">~</span> <span class="dv">0</span> <span class="sc">+</span> gender <span class="sc">+</span> discipline,</span>
<span id="cb1005-5"><a href="god-spiked-the-integers.html#cb1005-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>,<span class="fl">1.5</span>), <span class="at">class=</span>b)),</span>
<span id="cb1005-6"><a href="god-spiked-the-integers.html#cb1005-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">backend =</span> <span class="st">&quot;cmdstanr&quot;</span>,</span>
<span id="cb1005-7"><a href="god-spiked-the-integers.html#cb1005-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">seed=</span><span class="dv">11</span>, <span class="at">file =</span> <span class="st">&quot;output/Chapter11/fit11H4_2&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb1006"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1006-1"><a href="god-spiked-the-integers.html#cb1006-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fixef</span>(fit11H4_2) <span class="sc">%&gt;%</span> </span>
<span id="cb1006-2"><a href="god-spiked-the-integers.html#cb1006-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1006-3"><a href="god-spiked-the-integers.html#cb1006-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>(<span class="at">var =</span> <span class="st">&quot;parameter&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1006-4"><a href="god-spiked-the-integers.html#cb1006-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="at">booktabs =</span> T,</span>
<span id="cb1006-5"><a href="god-spiked-the-integers.html#cb1006-5" aria-hidden="true" tabindex="-1"></a>        <span class="at">digits=</span><span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1006-6"><a href="god-spiked-the-integers.html#cb1006-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">latex_options =</span> <span class="st">&quot;stripe&quot;</span>) </span></code></pre></div>
<table class="table" style="margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;">
parameter
</th>
<th style="text-align:right;">
Estimate
</th>
<th style="text-align:right;">
Est.Error
</th>
<th style="text-align:right;">
Q2.5
</th>
<th style="text-align:right;">
Q97.5
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
genderf
</td>
<td style="text-align:right;">
-1.15
</td>
<td style="text-align:right;">
0.20
</td>
<td style="text-align:right;">
-1.54
</td>
<td style="text-align:right;">
-0.77
</td>
</tr>
<tr>
<td style="text-align:left;">
genderm
</td>
<td style="text-align:right;">
-1.01
</td>
<td style="text-align:right;">
0.19
</td>
<td style="text-align:right;">
-1.39
</td>
<td style="text-align:right;">
-0.65
</td>
</tr>
<tr>
<td style="text-align:left;">
disciplineEarthDlifesciences
</td>
<td style="text-align:right;">
-0.33
</td>
<td style="text-align:right;">
0.24
</td>
<td style="text-align:right;">
-0.79
</td>
<td style="text-align:right;">
0.14
</td>
</tr>
<tr>
<td style="text-align:left;">
disciplineHumanities
</td>
<td style="text-align:right;">
-0.56
</td>
<td style="text-align:right;">
0.23
</td>
<td style="text-align:right;">
-1.01
</td>
<td style="text-align:right;">
-0.12
</td>
</tr>
<tr>
<td style="text-align:left;">
disciplineInterdisciplinary
</td>
<td style="text-align:right;">
-0.60
</td>
<td style="text-align:right;">
0.27
</td>
<td style="text-align:right;">
-1.14
</td>
<td style="text-align:right;">
-0.07
</td>
</tr>
<tr>
<td style="text-align:left;">
disciplineMedicalsciences
</td>
<td style="text-align:right;">
-0.66
</td>
<td style="text-align:right;">
0.23
</td>
<td style="text-align:right;">
-1.10
</td>
<td style="text-align:right;">
-0.22
</td>
</tr>
<tr>
<td style="text-align:left;">
disciplinePhysicalsciences
</td>
<td style="text-align:right;">
-0.34
</td>
<td style="text-align:right;">
0.27
</td>
<td style="text-align:right;">
-0.86
</td>
<td style="text-align:right;">
0.19
</td>
</tr>
<tr>
<td style="text-align:left;">
disciplinePhysics
</td>
<td style="text-align:right;">
-0.02
</td>
<td style="text-align:right;">
0.32
</td>
<td style="text-align:right;">
-0.67
</td>
<td style="text-align:right;">
0.58
</td>
</tr>
<tr>
<td style="text-align:left;">
disciplineSocialsciences
</td>
<td style="text-align:right;">
-0.79
</td>
<td style="text-align:right;">
0.21
</td>
<td style="text-align:right;">
-1.20
</td>
<td style="text-align:right;">
-0.38
</td>
</tr>
<tr>
<td style="text-align:left;">
disciplineTechnicalsciences
</td>
<td style="text-align:right;">
-0.54
</td>
<td style="text-align:right;">
0.25
</td>
<td style="text-align:right;">
-1.02
</td>
<td style="text-align:right;">
-0.05
</td>
</tr>
</tbody>
</table>
<p>結果を図示すると以下の通り(図<a href="god-spiked-the-integers.html#fig:fig11H4-2">11.33</a>)。データへの当てはまりは良くなったが、分野によっては男女の採用率は逆転している。</p>
<div class="sourceCode" id="cb1007"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1007-1"><a href="god-spiked-the-integers.html#cb1007-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fitted</span>(fit11H4_2, <span class="at">probs =</span> <span class="fu">c</span>(<span class="fl">0.055</span>, <span class="fl">0.945</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1007-2"><a href="god-spiked-the-integers.html#cb1007-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1007-3"><a href="god-spiked-the-integers.html#cb1007-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(dat3) <span class="sc">%&gt;%</span> </span>
<span id="cb1007-4"><a href="god-spiked-the-integers.html#cb1007-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">n =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">n</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb1007-5"><a href="god-spiked-the-integers.html#cb1007-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">cond =</span> cond) <span class="sc">%&gt;%</span> </span>
<span id="cb1007-6"><a href="god-spiked-the-integers.html#cb1007-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prop =</span> awards<span class="sc">/</span>applications,</span>
<span id="cb1007-7"><a href="god-spiked-the-integers.html#cb1007-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">prop_est =</span> Estimate<span class="sc">/</span>applications,</span>
<span id="cb1007-8"><a href="god-spiked-the-integers.html#cb1007-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">ub =</span> Q5<span class="fl">.5</span><span class="sc">/</span>applications,</span>
<span id="cb1007-9"><a href="god-spiked-the-integers.html#cb1007-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">lb =</span> Q94<span class="fl">.5</span><span class="sc">/</span>applications) <span class="sc">%&gt;%</span> </span>
<span id="cb1007-10"><a href="god-spiked-the-integers.html#cb1007-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>cond))<span class="sc">+</span></span>
<span id="cb1007-11"><a href="god-spiked-the-integers.html#cb1007-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> prop),</span>
<span id="cb1007-12"><a href="god-spiked-the-integers.html#cb1007-12" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> <span class="st">&quot;navy&quot;</span>,</span>
<span id="cb1007-13"><a href="god-spiked-the-integers.html#cb1007-13" aria-hidden="true" tabindex="-1"></a>             <span class="at">size=</span><span class="dv">4</span>)<span class="sc">+</span></span>
<span id="cb1007-14"><a href="god-spiked-the-integers.html#cb1007-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_pointinterval</span>(<span class="fu">aes</span>(<span class="at">y =</span> prop_est,</span>
<span id="cb1007-15"><a href="god-spiked-the-integers.html#cb1007-15" aria-hidden="true" tabindex="-1"></a>                         <span class="at">ymin =</span> lb,</span>
<span id="cb1007-16"><a href="god-spiked-the-integers.html#cb1007-16" aria-hidden="true" tabindex="-1"></a>                         <span class="at">ymax =</span> ub),</span>
<span id="cb1007-17"><a href="god-spiked-the-integers.html#cb1007-17" aria-hidden="true" tabindex="-1"></a>                     <span class="at">shape =</span><span class="dv">1</span>, <span class="at">point_size=</span><span class="dv">5</span>)<span class="sc">+</span></span>
<span id="cb1007-18"><a href="god-spiked-the-integers.html#cb1007-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">&quot;採用率&quot;</span>,</span>
<span id="cb1007-19"><a href="god-spiked-the-integers.html#cb1007-19" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="cn">NULL</span>)<span class="sc">+</span></span>
<span id="cb1007-20"><a href="god-spiked-the-integers.html#cb1007-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">family =</span><span class="st">&quot;Yu Mincho&quot;</span>),</span>
<span id="cb1007-21"><a href="god-spiked-the-integers.html#cb1007-21" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">family =</span><span class="st">&quot;Yu Mincho&quot;</span>),</span>
<span id="cb1007-22"><a href="god-spiked-the-integers.html#cb1007-22" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>))</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fig11H4-2"></span>
<img src="Rethinking_Bookdown_files/figure-html/fig11H4-2-1.png" alt="性別と分野を考慮したモデルfit11H4_2の結果" width="672" />
<p class="caption">
図11.33: 性別と分野を考慮したモデルfit11H4_2の結果
</p>
</div>
<p><br /></p>
<p>最後に交互作用を考えたモデルを回す。結果は以下の通り。</p>
<div class="sourceCode" id="cb1008"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1008-1"><a href="god-spiked-the-integers.html#cb1008-1" aria-hidden="true" tabindex="-1"></a>fit11H4_3 <span class="ot">&lt;-</span></span>
<span id="cb1008-2"><a href="god-spiked-the-integers.html#cb1008-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">brm</span>(<span class="at">data =</span> dat3,</span>
<span id="cb1008-3"><a href="god-spiked-the-integers.html#cb1008-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> binomial,</span>
<span id="cb1008-4"><a href="god-spiked-the-integers.html#cb1008-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">formula =</span> awards<span class="sc">|</span><span class="fu">trials</span>(applications) <span class="sc">~</span> <span class="dv">0</span> <span class="sc">+</span> gender<span class="sc">*</span>discipline,</span>
<span id="cb1008-5"><a href="god-spiked-the-integers.html#cb1008-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>,<span class="fl">1.5</span>), <span class="at">class=</span>b)),</span>
<span id="cb1008-6"><a href="god-spiked-the-integers.html#cb1008-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">backend =</span> <span class="st">&quot;cmdstanr&quot;</span>,</span>
<span id="cb1008-7"><a href="god-spiked-the-integers.html#cb1008-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">seed=</span><span class="dv">11</span>, <span class="at">file =</span> <span class="st">&quot;output/Chapter11/fit11H4_3&quot;</span>)</span>
<span id="cb1008-8"><a href="god-spiked-the-integers.html#cb1008-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1008-9"><a href="god-spiked-the-integers.html#cb1008-9" aria-hidden="true" tabindex="-1"></a><span class="fu">fixef</span>(fit11H4_3) <span class="sc">%&gt;%</span> </span>
<span id="cb1008-10"><a href="god-spiked-the-integers.html#cb1008-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1008-11"><a href="god-spiked-the-integers.html#cb1008-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>(<span class="at">var =</span> <span class="st">&quot;parameter&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1008-12"><a href="god-spiked-the-integers.html#cb1008-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="at">booktabs =</span> T,</span>
<span id="cb1008-13"><a href="god-spiked-the-integers.html#cb1008-13" aria-hidden="true" tabindex="-1"></a>        <span class="at">digits=</span><span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1008-14"><a href="god-spiked-the-integers.html#cb1008-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">latex_options =</span> <span class="st">&quot;stripe&quot;</span>) </span></code></pre></div>
<table class="table" style="margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;">
parameter
</th>
<th style="text-align:right;">
Estimate
</th>
<th style="text-align:right;">
Est.Error
</th>
<th style="text-align:right;">
Q2.5
</th>
<th style="text-align:right;">
Q97.5
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
genderf
</td>
<td style="text-align:right;">
-1.16
</td>
<td style="text-align:right;">
0.28
</td>
<td style="text-align:right;">
-1.71
</td>
<td style="text-align:right;">
-0.63
</td>
</tr>
<tr>
<td style="text-align:left;">
genderm
</td>
<td style="text-align:right;">
-1.02
</td>
<td style="text-align:right;">
0.23
</td>
<td style="text-align:right;">
-1.49
</td>
<td style="text-align:right;">
-0.58
</td>
</tr>
<tr>
<td style="text-align:left;">
disciplineEarthDlifesciences
</td>
<td style="text-align:right;">
-0.62
</td>
<td style="text-align:right;">
0.36
</td>
<td style="text-align:right;">
-1.33
</td>
<td style="text-align:right;">
0.11
</td>
</tr>
<tr>
<td style="text-align:left;">
disciplineHumanities
</td>
<td style="text-align:right;">
-0.29
</td>
<td style="text-align:right;">
0.34
</td>
<td style="text-align:right;">
-0.93
</td>
<td style="text-align:right;">
0.37
</td>
</tr>
<tr>
<td style="text-align:left;">
disciplineInterdisciplinary
</td>
<td style="text-align:right;">
-0.16
</td>
<td style="text-align:right;">
0.38
</td>
<td style="text-align:right;">
-0.92
</td>
<td style="text-align:right;">
0.59
</td>
</tr>
<tr>
<td style="text-align:left;">
disciplineMedicalsciences
</td>
<td style="text-align:right;">
-0.91
</td>
<td style="text-align:right;">
0.33
</td>
<td style="text-align:right;">
-1.54
</td>
<td style="text-align:right;">
-0.26
</td>
</tr>
<tr>
<td style="text-align:left;">
disciplinePhysicalsciences
</td>
<td style="text-align:right;">
-0.09
</td>
<td style="text-align:right;">
0.44
</td>
<td style="text-align:right;">
-0.97
</td>
<td style="text-align:right;">
0.74
</td>
</tr>
<tr>
<td style="text-align:left;">
disciplinePhysics
</td>
<td style="text-align:right;">
-0.12
</td>
<td style="text-align:right;">
0.67
</td>
<td style="text-align:right;">
-1.48
</td>
<td style="text-align:right;">
1.18
</td>
</tr>
<tr>
<td style="text-align:left;">
disciplineSocialsciences
</td>
<td style="text-align:right;">
-0.88
</td>
<td style="text-align:right;">
0.31
</td>
<td style="text-align:right;">
-1.48
</td>
<td style="text-align:right;">
-0.26
</td>
</tr>
<tr>
<td style="text-align:left;">
disciplineTechnicalsciences
</td>
<td style="text-align:right;">
-0.21
</td>
<td style="text-align:right;">
0.39
</td>
<td style="text-align:right;">
-0.96
</td>
<td style="text-align:right;">
0.55
</td>
</tr>
<tr>
<td style="text-align:left;">
genderm:disciplineEarthDlifesciences
</td>
<td style="text-align:right;">
0.49
</td>
<td style="text-align:right;">
0.44
</td>
<td style="text-align:right;">
-0.37
</td>
<td style="text-align:right;">
1.35
</td>
</tr>
<tr>
<td style="text-align:left;">
genderm:disciplineHumanities
</td>
<td style="text-align:right;">
-0.48
</td>
<td style="text-align:right;">
0.42
</td>
<td style="text-align:right;">
-1.29
</td>
<td style="text-align:right;">
0.32
</td>
</tr>
<tr>
<td style="text-align:left;">
genderm:disciplineInterdisciplinary
</td>
<td style="text-align:right;">
-0.86
</td>
<td style="text-align:right;">
0.50
</td>
<td style="text-align:right;">
-1.86
</td>
<td style="text-align:right;">
0.09
</td>
</tr>
<tr>
<td style="text-align:left;">
genderm:disciplineMedicalsciences
</td>
<td style="text-align:right;">
0.45
</td>
<td style="text-align:right;">
0.40
</td>
<td style="text-align:right;">
-0.34
</td>
<td style="text-align:right;">
1.23
</td>
</tr>
<tr>
<td style="text-align:left;">
genderm:disciplinePhysicalsciences
</td>
<td style="text-align:right;">
-0.34
</td>
<td style="text-align:right;">
0.51
</td>
<td style="text-align:right;">
-1.29
</td>
<td style="text-align:right;">
0.65
</td>
</tr>
<tr>
<td style="text-align:left;">
genderm:disciplinePhysics
</td>
<td style="text-align:right;">
0.11
</td>
<td style="text-align:right;">
0.71
</td>
<td style="text-align:right;">
-1.23
</td>
<td style="text-align:right;">
1.59
</td>
</tr>
<tr>
<td style="text-align:left;">
genderm:disciplineSocialsciences
</td>
<td style="text-align:right;">
0.18
</td>
<td style="text-align:right;">
0.37
</td>
<td style="text-align:right;">
-0.55
</td>
<td style="text-align:right;">
0.93
</td>
</tr>
<tr>
<td style="text-align:left;">
genderm:disciplineTechnicalsciences
</td>
<td style="text-align:right;">
-0.45
</td>
<td style="text-align:right;">
0.46
</td>
<td style="text-align:right;">
-1.36
</td>
<td style="text-align:right;">
0.44
</td>
</tr>
</tbody>
</table>
<p>結果を図示すると以下の通り(図<a href="god-spiked-the-integers.html#fig:11H4-3">11.34</a>)。やはり分野によって男女のどちらかが有利なのかは一致しない。</p>
<div class="sourceCode" id="cb1009"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1009-1"><a href="god-spiked-the-integers.html#cb1009-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fitted</span>(fit11H4_3, <span class="at">probs =</span> <span class="fu">c</span>(<span class="fl">0.055</span>, <span class="fl">0.945</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1009-2"><a href="god-spiked-the-integers.html#cb1009-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1009-3"><a href="god-spiked-the-integers.html#cb1009-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(dat3) <span class="sc">%&gt;%</span> </span>
<span id="cb1009-4"><a href="god-spiked-the-integers.html#cb1009-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">n =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">n</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb1009-5"><a href="god-spiked-the-integers.html#cb1009-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">cond =</span> cond) <span class="sc">%&gt;%</span> </span>
<span id="cb1009-6"><a href="god-spiked-the-integers.html#cb1009-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prop =</span> awards<span class="sc">/</span>applications,</span>
<span id="cb1009-7"><a href="god-spiked-the-integers.html#cb1009-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">prop_est =</span> Estimate<span class="sc">/</span>applications,</span>
<span id="cb1009-8"><a href="god-spiked-the-integers.html#cb1009-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">ub =</span> Q5<span class="fl">.5</span><span class="sc">/</span>applications,</span>
<span id="cb1009-9"><a href="god-spiked-the-integers.html#cb1009-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">lb =</span> Q94<span class="fl">.5</span><span class="sc">/</span>applications) <span class="sc">%&gt;%</span> </span>
<span id="cb1009-10"><a href="god-spiked-the-integers.html#cb1009-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>cond))<span class="sc">+</span></span>
<span id="cb1009-11"><a href="god-spiked-the-integers.html#cb1009-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> prop),</span>
<span id="cb1009-12"><a href="god-spiked-the-integers.html#cb1009-12" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> <span class="st">&quot;navy&quot;</span>,</span>
<span id="cb1009-13"><a href="god-spiked-the-integers.html#cb1009-13" aria-hidden="true" tabindex="-1"></a>             <span class="at">size=</span><span class="dv">4</span>)<span class="sc">+</span></span>
<span id="cb1009-14"><a href="god-spiked-the-integers.html#cb1009-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_pointinterval</span>(<span class="fu">aes</span>(<span class="at">y =</span> prop_est,</span>
<span id="cb1009-15"><a href="god-spiked-the-integers.html#cb1009-15" aria-hidden="true" tabindex="-1"></a>                         <span class="at">ymin =</span> lb,</span>
<span id="cb1009-16"><a href="god-spiked-the-integers.html#cb1009-16" aria-hidden="true" tabindex="-1"></a>                         <span class="at">ymax =</span> ub),</span>
<span id="cb1009-17"><a href="god-spiked-the-integers.html#cb1009-17" aria-hidden="true" tabindex="-1"></a>                     <span class="at">shape =</span><span class="dv">1</span>, <span class="at">point_size=</span><span class="dv">5</span>)<span class="sc">+</span></span>
<span id="cb1009-18"><a href="god-spiked-the-integers.html#cb1009-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">&quot;採用率&quot;</span>,</span>
<span id="cb1009-19"><a href="god-spiked-the-integers.html#cb1009-19" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="cn">NULL</span>)<span class="sc">+</span></span>
<span id="cb1009-20"><a href="god-spiked-the-integers.html#cb1009-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">family =</span><span class="st">&quot;Yu Mincho&quot;</span>),</span>
<span id="cb1009-21"><a href="god-spiked-the-integers.html#cb1009-21" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">family =</span><span class="st">&quot;Yu Mincho&quot;</span>),</span>
<span id="cb1009-22"><a href="god-spiked-the-integers.html#cb1009-22" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>))</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:11H4-3"></span>
<img src="Rethinking_Bookdown_files/figure-html/11H4-3-1.png" alt="交互作用を考慮したモデルfit11H4_3の結果" width="672" />
<p class="caption">
図11.34: 交互作用を考慮したモデルfit11H4_3の結果
</p>
</div>
<p>以上の結果を総合すると、性別よりも分野が大きく影響していると考えられる。</p>
</div>
<div id="h5-6" class="section level3 hasAnchor" number="11.5.11">
<h3><span class="header-section-number">11.5.11</span> 11H5<a href="god-spiked-the-integers.html#h5-6" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<blockquote>
<p>Suppose that the NWO Grants sample has an unobserved confound that influences both choice of discipline and the probability of an award. One example of such a confound could be the career stage of each applicant. Suppose that in some disciplines, junior scholars apply for most of the grants. In other disciplines, scholars from all career stages compete. As a result, career stage influences discipline as well as the probability of being awarded a grant. Add these influences to your DAG from the previous problem. What happens now when you condition on discipline? Does it provide an un-confounded estimate of the direct path from gender to an award? Why or why not? Justify your answer with the backdoor criterion. If you have trouble thinking this though, try simulating fake data, assuming your DAG is true. Then analyze it using the model from the previous problem. What do you conclude? Is it possible for gender to have a real direct causal influence but for a regression conditioning on both gender and discipline to suggest zero influence?</p>
</blockquote>
<p>このとき、DAGは以下のようになる(<span class="math inline">\(S\)</span>を未観測のcareer stageとする)。<br />
このとき<code>D</code>は合流点になるので、これを説明変数に加えると新たに<span class="math inline">\(G \rightarrow D \leftarrow S \rightarrow A\)</span>というバックドアパスが生じてしまう。よって、このDAGでGからAへの直接因果効果を正確に推定することはできない。</p>
<div class="sourceCode" id="cb1010"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1010-1"><a href="god-spiked-the-integers.html#cb1010-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dagify</span>(A <span class="sc">~</span> G <span class="sc">+</span> D <span class="sc">+</span> S,</span>
<span id="cb1010-2"><a href="god-spiked-the-integers.html#cb1010-2" aria-hidden="true" tabindex="-1"></a>       D <span class="sc">~</span> G,</span>
<span id="cb1010-3"><a href="god-spiked-the-integers.html#cb1010-3" aria-hidden="true" tabindex="-1"></a>       D <span class="sc">~</span> S) <span class="sc">%&gt;%</span> </span>
<span id="cb1010-4"><a href="god-spiked-the-integers.html#cb1010-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggdag</span>()<span class="sc">+</span></span>
<span id="cb1010-5"><a href="god-spiked-the-integers.html#cb1010-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_dag</span>()</span></code></pre></div>
<p><img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-540-1.png" width="384" style="display: block; margin: auto;" /></p>
<p>これはシミュレーションからも明らかになる。たとえ性別の影響が0であるという仮定の下でデータをシミュレートしても、Dで条件づけるとGの影響がある(係数が正になる)と推定されてしまう。</p>
<div class="sourceCode" id="cb1011"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1011-1"><a href="god-spiked-the-integers.html#cb1011-1" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">1000</span></span>
<span id="cb1011-2"><a href="god-spiked-the-integers.html#cb1011-2" aria-hidden="true" tabindex="-1"></a>g <span class="ot">&lt;-</span> <span class="fu">rbernoulli</span>(n, <span class="at">p =</span> <span class="fl">0.5</span>)</span>
<span id="cb1011-3"><a href="god-spiked-the-integers.html#cb1011-3" aria-hidden="true" tabindex="-1"></a>s <span class="ot">&lt;-</span> <span class="fu">rbernoulli</span>(n, <span class="at">p =</span> <span class="fl">0.5</span>)</span>
<span id="cb1011-4"><a href="god-spiked-the-integers.html#cb1011-4" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">rbernoulli</span>(n, <span class="at">p =</span> <span class="fu">inv_logit_scaled</span>(<span class="dv">2</span> <span class="sc">*</span> g <span class="sc">-</span> s))</span>
<span id="cb1011-5"><a href="god-spiked-the-integers.html#cb1011-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1011-6"><a href="god-spiked-the-integers.html#cb1011-6" aria-hidden="true" tabindex="-1"></a><span class="do">## 性別の影響は0であるというシミュレーションを行う  </span></span>
<span id="cb1011-7"><a href="god-spiked-the-integers.html#cb1011-7" aria-hidden="true" tabindex="-1"></a>a <span class="ot">&lt;-</span> <span class="fu">rbernoulli</span>(n, <span class="at">p =</span> <span class="fu">inv_logit_scaled</span>(<span class="dv">0</span> <span class="sc">*</span> g <span class="sc">+</span> d <span class="sc">+</span> s <span class="sc">-</span> <span class="dv">2</span>))</span>
<span id="cb1011-8"><a href="god-spiked-the-integers.html#cb1011-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1011-9"><a href="god-spiked-the-integers.html#cb1011-9" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> <span class="fu">tibble</span>(g, d, a) <span class="sc">%&gt;%</span> </span>
<span id="cb1011-10"><a href="god-spiked-the-integers.html#cb1011-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">everything</span>(), as.integer),</span>
<span id="cb1011-11"><a href="god-spiked-the-integers.html#cb1011-11" aria-hidden="true" tabindex="-1"></a>         <span class="fu">across</span>(<span class="fu">everything</span>(), as.factor))</span>
<span id="cb1011-12"><a href="god-spiked-the-integers.html#cb1011-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1011-13"><a href="god-spiked-the-integers.html#cb1011-13" aria-hidden="true" tabindex="-1"></a>b11H5 <span class="ot">&lt;-</span> <span class="fu">brm</span>(a <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> d <span class="sc">+</span> g, <span class="at">data =</span> dat, <span class="at">family =</span> bernoulli,</span>
<span id="cb1011-14"><a href="god-spiked-the-integers.html#cb1011-14" aria-hidden="true" tabindex="-1"></a>           <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">class =</span> Intercept),</span>
<span id="cb1011-15"><a href="god-spiked-the-integers.html#cb1011-15" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">class =</span> b)),</span>
<span id="cb1011-16"><a href="god-spiked-the-integers.html#cb1011-16" aria-hidden="true" tabindex="-1"></a>           <span class="at">iter =</span> <span class="dv">4000</span>, <span class="at">warmup =</span> <span class="dv">2000</span>, <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb1011-17"><a href="god-spiked-the-integers.html#cb1011-17" aria-hidden="true" tabindex="-1"></a>           <span class="at">backend =</span> <span class="st">&quot;cmdstanr&quot;</span>,</span>
<span id="cb1011-18"><a href="god-spiked-the-integers.html#cb1011-18" aria-hidden="true" tabindex="-1"></a>           <span class="at">file =</span> <span class="st">&quot;output/Chapter11/b11H5&quot;</span>)</span>
<span id="cb1011-19"><a href="god-spiked-the-integers.html#cb1011-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1011-20"><a href="god-spiked-the-integers.html#cb1011-20" aria-hidden="true" tabindex="-1"></a><span class="fu">as_draws_df</span>(b11H5, <span class="at">variable =</span> <span class="st">&quot;b_g1&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1011-21"><a href="god-spiked-the-integers.html#cb1011-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mean_hdi</span>(b_g1, <span class="at">.width =</span> <span class="fl">0.89</span>)</span></code></pre></div>
<pre><code>## # A tibble: 1 × 6
##    b_g1 .lower .upper .width .point .interval
##   &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;    
## 1 0.127 -0.132  0.372   0.89 mean   hdi</code></pre>
</div>
<div id="h6-3" class="section level3 hasAnchor" number="11.5.12">
<h3><span class="header-section-number">11.5.12</span> 11H6<a href="god-spiked-the-integers.html#h6-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<blockquote>
<p>The data in data(Primates301) are 301 primate species and associated measures. In this problem, you will consider how brain size is associated with social learning. There are three parts.</p>
</blockquote>
<p>301種の霊長類で、脳サイズが社会学習とどのように関連しているかを考える（表<a href="god-spiked-the-integers.html#tab:dat4">11.33</a>）。データは <span class="citation">Street et al. (<a href="#ref-Street2017" role="doc-biblioref">2017</a>)</span> を用いている。</p>
<div class="sourceCode" id="cb1013"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1013-1"><a href="god-spiked-the-integers.html#cb1013-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;Primates301&quot;</span>)</span>
<span id="cb1013-2"><a href="god-spiked-the-integers.html#cb1013-2" aria-hidden="true" tabindex="-1"></a>dat4 <span class="ot">&lt;-</span> Primates301  </span>
<span id="cb1013-3"><a href="god-spiked-the-integers.html#cb1013-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1013-4"><a href="god-spiked-the-integers.html#cb1013-4" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(Primates301) <span class="sc">%&gt;%</span> </span>
<span id="cb1013-5"><a href="god-spiked-the-integers.html#cb1013-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1013-6"><a href="god-spiked-the-integers.html#cb1013-6" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(social_learning,brain, research_effort) <span class="sc">%&gt;%</span> </span>
<span id="cb1013-7"><a href="god-spiked-the-integers.html#cb1013-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="at">digits=</span><span class="dv">2</span>,</span>
<span id="cb1013-8"><a href="god-spiked-the-integers.html#cb1013-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">booktabs =</span> T,</span>
<span id="cb1013-9"><a href="god-spiked-the-integers.html#cb1013-9" aria-hidden="true" tabindex="-1"></a>        <span class="at">caption =</span> <span class="st">&quot;data&#39;Primates301&#39;の内容&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1013-10"><a href="god-spiked-the-integers.html#cb1013-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">latex_options =</span> <span class="st">&quot;stripe&quot;</span>)</span></code></pre></div>
<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:dat4">表11.33: </span>data’Primates301’の内容
</caption>
<thead>
<tr>
<th style="text-align:right;">
social_learning
</th>
<th style="text-align:right;">
brain
</th>
<th style="text-align:right;">
research_effort
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
58.02
</td>
<td style="text-align:right;">
6
</td>
</tr>
<tr>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
6
</td>
</tr>
<tr>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
52.84
</td>
<td style="text-align:right;">
15
</td>
</tr>
<tr>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
52.63
</td>
<td style="text-align:right;">
45
</td>
</tr>
<tr>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
51.70
</td>
<td style="text-align:right;">
37
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
49.88
</td>
<td style="text-align:right;">
79
</td>
</tr>
</tbody>
</table>
<div id="a-6" class="section level4 hasAnchor" number="11.5.12.1">
<h4><span class="header-section-number">11.5.12.1</span> a<a href="god-spiked-the-integers.html#a-6" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<blockquote>
<p>Model the number of observations of social_learning for each species as a function of the log brain size. Use a Poisson distribution for the social_learning outcome variable. Interpret the resulting posterior.</p>
</blockquote>
<p>社会学習と脳容量(logをとる)の関係をモデリングする。</p>
<div class="sourceCode" id="cb1014"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1014-1"><a href="god-spiked-the-integers.html#cb1014-1" aria-hidden="true" tabindex="-1"></a>dat4_2 <span class="ot">&lt;-</span> dat4 <span class="sc">%&gt;%</span> </span>
<span id="cb1014-2"><a href="god-spiked-the-integers.html#cb1014-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">B =</span> <span class="fu">log</span>(brain)) <span class="sc">%&gt;%</span></span>
<span id="cb1014-3"><a href="god-spiked-the-integers.html#cb1014-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(social_learning, B)</span>
<span id="cb1014-4"><a href="god-spiked-the-integers.html#cb1014-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1014-5"><a href="god-spiked-the-integers.html#cb1014-5" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dat4_2 <span class="sc">%&gt;%</span> <span class="fu">na.omit</span>(), <span class="fu">aes</span>(<span class="at">x=</span>B, <span class="at">y=</span>social_learning))<span class="sc">+</span></span>
<span id="cb1014-6"><a href="god-spiked-the-integers.html#cb1014-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()<span class="sc">+</span></span>
<span id="cb1014-7"><a href="god-spiked-the-integers.html#cb1014-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;log(brain size)&quot;</span>)<span class="sc">+</span></span>
<span id="cb1014-8"><a href="god-spiked-the-integers.html#cb1014-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">aspect.ratio=</span><span class="dv">1</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:unnamed-chunk-542"></span>
<img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-542-1.png" alt="log(脳サイズ)と社会学習の関連" width="672" />
<p class="caption">
図11.35: log(脳サイズ)と社会学習の関連
</p>
</div>
<p>結果は以下の通り。脳容量が影響を与えていることが分かる。</p>
<div class="sourceCode" id="cb1015"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1015-1"><a href="god-spiked-the-integers.html#cb1015-1" aria-hidden="true" tabindex="-1"></a>fit11H6_a <span class="ot">&lt;-</span> </span>
<span id="cb1015-2"><a href="god-spiked-the-integers.html#cb1015-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">brm</span>(<span class="at">data =</span> dat4_2,</span>
<span id="cb1015-3"><a href="god-spiked-the-integers.html#cb1015-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> poisson,</span>
<span id="cb1015-4"><a href="god-spiked-the-integers.html#cb1015-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">formula =</span> social_learning <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> B,</span>
<span id="cb1015-5"><a href="god-spiked-the-integers.html#cb1015-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>,<span class="fl">1.5</span>), <span class="at">class =</span> Intercept),</span>
<span id="cb1015-6"><a href="god-spiked-the-integers.html#cb1015-6" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>,<span class="fl">0.5</span>), <span class="at">class =</span> b)),</span>
<span id="cb1015-7"><a href="god-spiked-the-integers.html#cb1015-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">seed =</span> <span class="dv">4</span>, <span class="at">file =</span> <span class="st">&quot;output/Chapter11/fit11H6_a&quot;</span>)</span>
<span id="cb1015-8"><a href="god-spiked-the-integers.html#cb1015-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1015-9"><a href="god-spiked-the-integers.html#cb1015-9" aria-hidden="true" tabindex="-1"></a><span class="fu">fixef</span>(fit11H6_a) <span class="sc">%&gt;%</span> </span>
<span id="cb1015-10"><a href="god-spiked-the-integers.html#cb1015-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1015-11"><a href="god-spiked-the-integers.html#cb1015-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>(<span class="at">var =</span> <span class="st">&quot;parameter&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1015-12"><a href="god-spiked-the-integers.html#cb1015-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="at">booktabs =</span> T,</span>
<span id="cb1015-13"><a href="god-spiked-the-integers.html#cb1015-13" aria-hidden="true" tabindex="-1"></a>        <span class="at">digits=</span><span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1015-14"><a href="god-spiked-the-integers.html#cb1015-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">latex_options =</span> <span class="st">&quot;stripe&quot;</span>) </span></code></pre></div>
<table class="table" style="margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;">
parameter
</th>
<th style="text-align:right;">
Estimate
</th>
<th style="text-align:right;">
Est.Error
</th>
<th style="text-align:right;">
Q2.5
</th>
<th style="text-align:right;">
Q97.5
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Intercept
</td>
<td style="text-align:right;">
-9.51
</td>
<td style="text-align:right;">
0.33
</td>
<td style="text-align:right;">
-10.18
</td>
<td style="text-align:right;">
-8.87
</td>
</tr>
<tr>
<td style="text-align:left;">
B
</td>
<td style="text-align:right;">
2.29
</td>
<td style="text-align:right;">
0.06
</td>
<td style="text-align:right;">
2.17
</td>
<td style="text-align:right;">
2.41
</td>
</tr>
</tbody>
</table>
<p>結果を図示する（図<a href="god-spiked-the-integers.html#fig:11H6-a">11.36</a>）。データとよく合っている。</p>
<div class="sourceCode" id="cb1016"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1016-1"><a href="god-spiked-the-integers.html#cb1016-1" aria-hidden="true" tabindex="-1"></a>nd <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">B =</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="fl">6.5</span>, <span class="at">length.out=</span><span class="dv">50</span>))</span>
<span id="cb1016-2"><a href="god-spiked-the-integers.html#cb1016-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1016-3"><a href="god-spiked-the-integers.html#cb1016-3" aria-hidden="true" tabindex="-1"></a><span class="fu">fitted</span>(fit11H6_a, nd) <span class="sc">%&gt;%</span></span>
<span id="cb1016-4"><a href="god-spiked-the-integers.html#cb1016-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1016-5"><a href="god-spiked-the-integers.html#cb1016-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(nd) <span class="ot">-&gt;</span> h6a</span>
<span id="cb1016-6"><a href="god-spiked-the-integers.html#cb1016-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1016-7"><a href="god-spiked-the-integers.html#cb1016-7" aria-hidden="true" tabindex="-1"></a>dat4_2 <span class="sc">%&gt;%</span> </span>
<span id="cb1016-8"><a href="god-spiked-the-integers.html#cb1016-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>B))<span class="sc">+</span></span>
<span id="cb1016-9"><a href="god-spiked-the-integers.html#cb1016-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> social_learning),</span>
<span id="cb1016-10"><a href="god-spiked-the-integers.html#cb1016-10" aria-hidden="true" tabindex="-1"></a>             <span class="at">size=</span> <span class="dv">3</span>,</span>
<span id="cb1016-11"><a href="god-spiked-the-integers.html#cb1016-11" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> <span class="st">&quot;navy&quot;</span>)<span class="sc">+</span></span>
<span id="cb1016-12"><a href="god-spiked-the-integers.html#cb1016-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">data =</span> h6a,</span>
<span id="cb1016-13"><a href="god-spiked-the-integers.html#cb1016-13" aria-hidden="true" tabindex="-1"></a>              <span class="fu">aes</span>(<span class="at">y=</span>Estimate,</span>
<span id="cb1016-14"><a href="god-spiked-the-integers.html#cb1016-14" aria-hidden="true" tabindex="-1"></a>                  <span class="at">ymin =</span> Q2<span class="fl">.5</span>,</span>
<span id="cb1016-15"><a href="god-spiked-the-integers.html#cb1016-15" aria-hidden="true" tabindex="-1"></a>                  <span class="at">ymax =</span> Q97<span class="fl">.5</span>),</span>
<span id="cb1016-16"><a href="god-spiked-the-integers.html#cb1016-16" aria-hidden="true" tabindex="-1"></a>              <span class="at">alpha =</span> <span class="dv">2</span><span class="sc">/</span><span class="dv">3</span>,</span>
<span id="cb1016-17"><a href="god-spiked-the-integers.html#cb1016-17" aria-hidden="true" tabindex="-1"></a>              <span class="at">color =</span> <span class="st">&quot;black&quot;</span>,</span>
<span id="cb1016-18"><a href="god-spiked-the-integers.html#cb1016-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>)<span class="sc">+</span></span>
<span id="cb1016-19"><a href="god-spiked-the-integers.html#cb1016-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">aspect.ratio=</span><span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb1016-20"><a href="god-spiked-the-integers.html#cb1016-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;log(brain size)&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:11H6-a"></span>
<img src="Rethinking_Bookdown_files/figure-html/11H6-a-1.png" alt="fit11H6_aの推定結果" width="672" />
<p class="caption">
図11.36: fit11H6_aの推定結果
</p>
</div>
</div>
<div id="b-6" class="section level4 hasAnchor" number="11.5.12.2">
<h4><span class="header-section-number">11.5.12.2</span> b<a href="god-spiked-the-integers.html#b-6" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<blockquote>
<p>Some species are studied much more than others. So the number of reported instances of <code>social_learning</code> could be a product of research effort. Use the <code>research_effort</code> variable, specifically its logarithm, as an additional predictor variable. Interpret the coefficient for log <code>research_effort</code>. How does this model differ from the previous one?</p>
</blockquote>
<p>研究努力(research_effort)が影響している可能性もあるため、それも対数変換して説明変数に加える。分析の結果、脳容量の効果はあるものの、小さくなった。また、研究努力がかなり影響していることが分かった。</p>
<div class="sourceCode" id="cb1017"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1017-1"><a href="god-spiked-the-integers.html#cb1017-1" aria-hidden="true" tabindex="-1"></a>dat4_3 <span class="ot">&lt;-</span> dat4 <span class="sc">%&gt;%</span> </span>
<span id="cb1017-2"><a href="god-spiked-the-integers.html#cb1017-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">R =</span> <span class="fu">log</span>(research_effort),</span>
<span id="cb1017-3"><a href="god-spiked-the-integers.html#cb1017-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">B =</span> <span class="fu">log</span>(brain)) <span class="sc">%&gt;%</span> </span>
<span id="cb1017-4"><a href="god-spiked-the-integers.html#cb1017-4" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(social_learning, B, R)  </span>
<span id="cb1017-5"><a href="god-spiked-the-integers.html#cb1017-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1017-6"><a href="god-spiked-the-integers.html#cb1017-6" aria-hidden="true" tabindex="-1"></a>fit11H6_b <span class="ot">&lt;-</span> </span>
<span id="cb1017-7"><a href="god-spiked-the-integers.html#cb1017-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">brm</span>(<span class="at">data =</span> dat4_3,</span>
<span id="cb1017-8"><a href="god-spiked-the-integers.html#cb1017-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> poisson,</span>
<span id="cb1017-9"><a href="god-spiked-the-integers.html#cb1017-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">formula =</span> social_learning <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> B <span class="sc">+</span>R,</span>
<span id="cb1017-10"><a href="god-spiked-the-integers.html#cb1017-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>,<span class="fl">1.5</span>), <span class="at">class =</span> Intercept),</span>
<span id="cb1017-11"><a href="god-spiked-the-integers.html#cb1017-11" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>,<span class="fl">0.5</span>), <span class="at">class =</span> b)),</span>
<span id="cb1017-12"><a href="god-spiked-the-integers.html#cb1017-12" aria-hidden="true" tabindex="-1"></a>      <span class="at">seed =</span> <span class="dv">4</span>, <span class="at">file =</span> <span class="st">&quot;output/Chapter11/fit11H6_b&quot;</span>)</span>
<span id="cb1017-13"><a href="god-spiked-the-integers.html#cb1017-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1017-14"><a href="god-spiked-the-integers.html#cb1017-14" aria-hidden="true" tabindex="-1"></a><span class="fu">fixef</span>(fit11H6_b) <span class="sc">%&gt;%</span> </span>
<span id="cb1017-15"><a href="god-spiked-the-integers.html#cb1017-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1017-16"><a href="god-spiked-the-integers.html#cb1017-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>(<span class="at">var =</span> <span class="st">&quot;parameter&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1017-17"><a href="god-spiked-the-integers.html#cb1017-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="at">booktabs =</span> T,</span>
<span id="cb1017-18"><a href="god-spiked-the-integers.html#cb1017-18" aria-hidden="true" tabindex="-1"></a>        <span class="at">digits=</span><span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1017-19"><a href="god-spiked-the-integers.html#cb1017-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">latex_options =</span> <span class="st">&quot;stripe&quot;</span>) </span></code></pre></div>
<table class="table" style="margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;">
parameter
</th>
<th style="text-align:right;">
Estimate
</th>
<th style="text-align:right;">
Est.Error
</th>
<th style="text-align:right;">
Q2.5
</th>
<th style="text-align:right;">
Q97.5
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Intercept
</td>
<td style="text-align:right;">
-7.72
</td>
<td style="text-align:right;">
0.30
</td>
<td style="text-align:right;">
-8.32
</td>
<td style="text-align:right;">
-7.14
</td>
</tr>
<tr>
<td style="text-align:left;">
B
</td>
<td style="text-align:right;">
0.32
</td>
<td style="text-align:right;">
0.07
</td>
<td style="text-align:right;">
0.19
</td>
<td style="text-align:right;">
0.46
</td>
</tr>
<tr>
<td style="text-align:left;">
R
</td>
<td style="text-align:right;">
1.65
</td>
<td style="text-align:right;">
0.07
</td>
<td style="text-align:right;">
1.51
</td>
<td style="text-align:right;">
1.79
</td>
</tr>
</tbody>
</table>
<p>結果を図示すると以下の通り（図<a href="god-spiked-the-integers.html#fig:11H6-b">11.37</a>）。</p>
<div class="sourceCode" id="cb1018"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1018-1"><a href="god-spiked-the-integers.html#cb1018-1" aria-hidden="true" tabindex="-1"></a><span class="do">## 脳容量</span></span>
<span id="cb1018-2"><a href="god-spiked-the-integers.html#cb1018-2" aria-hidden="true" tabindex="-1"></a>nd_1 <span class="ot">&lt;-</span> <span class="fu">crossing</span>(<span class="at">R =</span> <span class="fu">mean</span>(dat4_3<span class="sc">$</span>B, <span class="at">na.rm =</span>T),</span>
<span id="cb1018-3"><a href="god-spiked-the-integers.html#cb1018-3" aria-hidden="true" tabindex="-1"></a>               <span class="at">B =</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="fl">6.5</span>, <span class="at">length.out=</span><span class="dv">50</span>))</span>
<span id="cb1018-4"><a href="god-spiked-the-integers.html#cb1018-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1018-5"><a href="god-spiked-the-integers.html#cb1018-5" aria-hidden="true" tabindex="-1"></a><span class="fu">fitted</span>(fit11H6_b, nd_1) <span class="sc">%&gt;%</span></span>
<span id="cb1018-6"><a href="god-spiked-the-integers.html#cb1018-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1018-7"><a href="god-spiked-the-integers.html#cb1018-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(nd_1) <span class="ot">-&gt;</span> h6b_1</span>
<span id="cb1018-8"><a href="god-spiked-the-integers.html#cb1018-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1018-9"><a href="god-spiked-the-integers.html#cb1018-9" aria-hidden="true" tabindex="-1"></a>dat4_3 <span class="sc">%&gt;%</span> </span>
<span id="cb1018-10"><a href="god-spiked-the-integers.html#cb1018-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>B))<span class="sc">+</span></span>
<span id="cb1018-11"><a href="god-spiked-the-integers.html#cb1018-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> social_learning),</span>
<span id="cb1018-12"><a href="god-spiked-the-integers.html#cb1018-12" aria-hidden="true" tabindex="-1"></a>             <span class="at">size=</span> <span class="dv">3</span>,</span>
<span id="cb1018-13"><a href="god-spiked-the-integers.html#cb1018-13" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> <span class="st">&quot;navy&quot;</span>)<span class="sc">+</span></span>
<span id="cb1018-14"><a href="god-spiked-the-integers.html#cb1018-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">data =</span> h6b_1,</span>
<span id="cb1018-15"><a href="god-spiked-the-integers.html#cb1018-15" aria-hidden="true" tabindex="-1"></a>              <span class="fu">aes</span>(<span class="at">y=</span>Estimate,</span>
<span id="cb1018-16"><a href="god-spiked-the-integers.html#cb1018-16" aria-hidden="true" tabindex="-1"></a>                  <span class="at">ymin =</span> Q2<span class="fl">.5</span>,</span>
<span id="cb1018-17"><a href="god-spiked-the-integers.html#cb1018-17" aria-hidden="true" tabindex="-1"></a>                  <span class="at">ymax =</span> Q97<span class="fl">.5</span>),</span>
<span id="cb1018-18"><a href="god-spiked-the-integers.html#cb1018-18" aria-hidden="true" tabindex="-1"></a>              <span class="at">alpha =</span> <span class="dv">2</span><span class="sc">/</span><span class="dv">3</span>,</span>
<span id="cb1018-19"><a href="god-spiked-the-integers.html#cb1018-19" aria-hidden="true" tabindex="-1"></a>              <span class="at">color =</span> <span class="st">&quot;black&quot;</span>,</span>
<span id="cb1018-20"><a href="god-spiked-the-integers.html#cb1018-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>)<span class="sc">+</span></span>
<span id="cb1018-21"><a href="god-spiked-the-integers.html#cb1018-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">aspect.ratio=</span><span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb1018-22"><a href="god-spiked-the-integers.html#cb1018-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;log(brain size)&quot;</span>)<span class="sc">+</span></span>
<span id="cb1018-23"><a href="god-spiked-the-integers.html#cb1018-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">50</span>)) <span class="ot">-&gt;</span>p20</span>
<span id="cb1018-24"><a href="god-spiked-the-integers.html#cb1018-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1018-25"><a href="god-spiked-the-integers.html#cb1018-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1018-26"><a href="god-spiked-the-integers.html#cb1018-26" aria-hidden="true" tabindex="-1"></a><span class="do">## 研究努力</span></span>
<span id="cb1018-27"><a href="god-spiked-the-integers.html#cb1018-27" aria-hidden="true" tabindex="-1"></a>nd <span class="ot">&lt;-</span> <span class="fu">crossing</span>(<span class="at">B =</span> <span class="fu">mean</span>(dat4_3<span class="sc">$</span>B, <span class="at">na.rm =</span>T),</span>
<span id="cb1018-28"><a href="god-spiked-the-integers.html#cb1018-28" aria-hidden="true" tabindex="-1"></a>               <span class="at">R =</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="fl">6.5</span>, <span class="at">length.out=</span><span class="dv">50</span>))</span>
<span id="cb1018-29"><a href="god-spiked-the-integers.html#cb1018-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1018-30"><a href="god-spiked-the-integers.html#cb1018-30" aria-hidden="true" tabindex="-1"></a><span class="fu">fitted</span>(fit11H6_b, nd) <span class="sc">%&gt;%</span></span>
<span id="cb1018-31"><a href="god-spiked-the-integers.html#cb1018-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1018-32"><a href="god-spiked-the-integers.html#cb1018-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(nd) <span class="ot">-&gt;</span> h6b_2</span>
<span id="cb1018-33"><a href="god-spiked-the-integers.html#cb1018-33" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1018-34"><a href="god-spiked-the-integers.html#cb1018-34" aria-hidden="true" tabindex="-1"></a>dat4_3 <span class="sc">%&gt;%</span> </span>
<span id="cb1018-35"><a href="god-spiked-the-integers.html#cb1018-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>R))<span class="sc">+</span></span>
<span id="cb1018-36"><a href="god-spiked-the-integers.html#cb1018-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> social_learning),</span>
<span id="cb1018-37"><a href="god-spiked-the-integers.html#cb1018-37" aria-hidden="true" tabindex="-1"></a>             <span class="at">size=</span> <span class="dv">3</span>,</span>
<span id="cb1018-38"><a href="god-spiked-the-integers.html#cb1018-38" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> <span class="st">&quot;navy&quot;</span>)<span class="sc">+</span></span>
<span id="cb1018-39"><a href="god-spiked-the-integers.html#cb1018-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">data =</span> h6b_2,</span>
<span id="cb1018-40"><a href="god-spiked-the-integers.html#cb1018-40" aria-hidden="true" tabindex="-1"></a>              <span class="fu">aes</span>(<span class="at">y=</span>Estimate,</span>
<span id="cb1018-41"><a href="god-spiked-the-integers.html#cb1018-41" aria-hidden="true" tabindex="-1"></a>                  <span class="at">ymin =</span> Q2<span class="fl">.5</span>,</span>
<span id="cb1018-42"><a href="god-spiked-the-integers.html#cb1018-42" aria-hidden="true" tabindex="-1"></a>                  <span class="at">ymax =</span> Q97<span class="fl">.5</span>),</span>
<span id="cb1018-43"><a href="god-spiked-the-integers.html#cb1018-43" aria-hidden="true" tabindex="-1"></a>              <span class="at">alpha =</span> <span class="dv">2</span><span class="sc">/</span><span class="dv">3</span>,</span>
<span id="cb1018-44"><a href="god-spiked-the-integers.html#cb1018-44" aria-hidden="true" tabindex="-1"></a>              <span class="at">color =</span> <span class="st">&quot;black&quot;</span>,</span>
<span id="cb1018-45"><a href="god-spiked-the-integers.html#cb1018-45" aria-hidden="true" tabindex="-1"></a>    <span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>)<span class="sc">+</span></span>
<span id="cb1018-46"><a href="god-spiked-the-integers.html#cb1018-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">aspect.ratio=</span><span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb1018-47"><a href="god-spiked-the-integers.html#cb1018-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;log(research effort)&quot;</span>) <span class="ot">-&gt;</span> p21</span>
<span id="cb1018-48"><a href="god-spiked-the-integers.html#cb1018-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1018-49"><a href="god-spiked-the-integers.html#cb1018-49" aria-hidden="true" tabindex="-1"></a>p20<span class="sc">+</span>p21</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:11H6-b"></span>
<img src="Rethinking_Bookdown_files/figure-html/11H6-b-1.png" alt="fit11H6_aの推定結果" width="672" />
<p class="caption">
図11.37: fit11H6_aの推定結果
</p>
</div>

</div>
</div>
</div>
</div>
<h3>References</h3>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-Kline2010" class="csl-entry">
Kline MA, Boyd R (2010) Population size predicts technological complexity in oceania. Proc Biol Sci 277:2559–2564
</div>
<div id="ref-Silk2005" class="csl-entry">
Silk JB, Brosnan SF, Vonk J, et al (2005) Chimpanzees are indifferent to the welfare of unrelated group members. Nature 437:1357–1359
</div>
<div id="ref-Street2017" class="csl-entry">
Street SE, Navarrete AF, Reader SM, Laland KN (2017) Coevolution of cultural intelligence, extended life history, sociality, and brain size in primates. Proc Natl Acad Sci U S A 114:7908–7914
</div>
<div id="ref-Van2015" class="csl-entry">
Van der Lee R, Ellemers N (2015) Gender contributes to personal research funding success in the netherlands. Proceedings of the National Academy of Sciences 112:12349–12353
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="big-entropy-and-the-generalized-linear-model.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="monsters-and-mixtures.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
