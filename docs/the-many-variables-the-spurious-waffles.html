<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>5 The many variables &amp; the spurious waffles | Statistical Rethinking Second Edition</title>
  <meta name="description" content="5 The many variables &amp; the spurious waffles | Statistical Rethinking Second Edition" />
  <meta name="generator" content="bookdown 0.31 and GitBook 2.6.7" />

  <meta property="og:title" content="5 The many variables &amp; the spurious waffles | Statistical Rethinking Second Edition" />
  <meta property="og:type" content="book" />
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="5 The many variables &amp; the spurious waffles | Statistical Rethinking Second Edition" />
  
  
  

<meta name="author" content="Tsubasa Yamaguchi" />


<meta name="date" content="2023-02-01" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="geocentric-model.html"/>
<link rel="next" href="the-haunted-dag-the-causal-terror.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<script src="libs/htmlwidgets-1.6.1/htmlwidgets.js"></script>
<link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet" />
<script src="libs/datatables-binding-0.27/datatables.js"></script>
<link href="libs/dt-core-1.12.1/css/jquery.dataTables.min.css" rel="stylesheet" />
<link href="libs/dt-core-1.12.1/css/jquery.dataTables.extra.css" rel="stylesheet" />
<script src="libs/dt-core-1.12.1/js/jquery.dataTables.min.js"></script>
<link href="libs/crosstalk-1.2.0/css/crosstalk.min.css" rel="stylesheet" />
<script src="libs/crosstalk-1.2.0/js/crosstalk.min.js"></script>
<link href="libs/tabwid-1.1.2/tabwid.css" rel="stylesheet" />
<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="custom_style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>本稿の目的</a></li>
<li class="chapter" data-level="" data-path="パッケージの読み込み.html"><a href="パッケージの読み込み.html"><i class="fa fa-check"></i>パッケージの読み込み</a></li>
<li class="chapter" data-level="1" data-path="the-golem-of-prague.html"><a href="the-golem-of-prague.html"><i class="fa fa-check"></i><b>1</b> The Golem of Prague 　</a></li>
<li class="chapter" data-level="2" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html"><i class="fa fa-check"></i><b>2</b> Small Worlds and Large Worlds</a>
<ul>
<li class="chapter" data-level="2.1" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#byesian-updating"><i class="fa fa-check"></i><b>2.1</b> Byesian Updating</a></li>
<li class="chapter" data-level="2.2" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#making-th-model"><i class="fa fa-check"></i><b>2.2</b> Making th model</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#grid-approximation"><i class="fa fa-check"></i><b>2.2.1</b> Grid approximation</a></li>
<li class="chapter" data-level="2.2.2" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#quadratic-approximation"><i class="fa fa-check"></i><b>2.2.2</b> Quadratic approximation</a></li>
<li class="chapter" data-level="2.2.3" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#mcmc"><i class="fa fa-check"></i><b>2.2.3</b> MCMC</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#practice"><i class="fa fa-check"></i><b>2.3</b> Practice</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#m1"><i class="fa fa-check"></i><b>2.3.1</b> 2M1</a></li>
<li class="chapter" data-level="2.3.2" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#m2"><i class="fa fa-check"></i><b>2.3.2</b> 2M2</a></li>
<li class="chapter" data-level="2.3.3" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#m3"><i class="fa fa-check"></i><b>2.3.3</b> 2M3</a></li>
<li class="chapter" data-level="2.3.4" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#m4"><i class="fa fa-check"></i><b>2.3.4</b> 2M4</a></li>
<li class="chapter" data-level="2.3.5" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#m5"><i class="fa fa-check"></i><b>2.3.5</b> 2M5</a></li>
<li class="chapter" data-level="2.3.6" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#m7"><i class="fa fa-check"></i><b>2.3.6</b> 2M7</a></li>
<li class="chapter" data-level="2.3.7" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#h1"><i class="fa fa-check"></i><b>2.3.7</b> 2H1</a></li>
<li class="chapter" data-level="2.3.8" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#h2"><i class="fa fa-check"></i><b>2.3.8</b> 2H2</a></li>
<li class="chapter" data-level="2.3.9" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#h3"><i class="fa fa-check"></i><b>2.3.9</b> 2H3</a></li>
<li class="chapter" data-level="2.3.10" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#h4"><i class="fa fa-check"></i><b>2.3.10</b> 2H4</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html"><i class="fa fa-check"></i><b>3</b> Sampling the Imaginary</a>
<ul>
<li class="chapter" data-level="3.1" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#sampling-from-a-grid-aproximate-posterior"><i class="fa fa-check"></i><b>3.1</b> Sampling from a grid-aproximate posterior</a></li>
<li class="chapter" data-level="3.2" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#sampling-to-summarize"><i class="fa fa-check"></i><b>3.2</b> Sampling to summarize</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#intervals-of-defined-mass"><i class="fa fa-check"></i><b>3.2.1</b> Intervals of defined mass</a></li>
<li class="chapter" data-level="3.2.2" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#highly-skewed-example"><i class="fa fa-check"></i><b>3.2.2</b> highly skewed example</a></li>
<li class="chapter" data-level="3.2.3" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#point-estimate"><i class="fa fa-check"></i><b>3.2.3</b> Point estimate　　</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#sampling-to-simulate-prediction"><i class="fa fa-check"></i><b>3.3</b> Sampling to simulate prediction</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#model-checking"><i class="fa fa-check"></i><b>3.3.1</b> Model checking</a></li>
<li class="chapter" data-level="3.3.2" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#practice-with-brms"><i class="fa fa-check"></i><b>3.3.2</b> Practice with brms</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#practice-1"><i class="fa fa-check"></i><b>3.4</b> Practice</a>
<ul>
<li class="chapter" data-level="3.4.1" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#e"><i class="fa fa-check"></i><b>3.4.1</b> 3E</a></li>
<li class="chapter" data-level="3.4.2" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#m"><i class="fa fa-check"></i><b>3.4.2</b> 3M</a></li>
<li class="chapter" data-level="3.4.3" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#h"><i class="fa fa-check"></i><b>3.4.3</b> 3H</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="geocentric-model.html"><a href="geocentric-model.html"><i class="fa fa-check"></i><b>4</b> Geocentric Model</a>
<ul>
<li class="chapter" data-level="4.1" data-path="geocentric-model.html"><a href="geocentric-model.html#why-normal-distributions-are-normal"><i class="fa fa-check"></i><b>4.1</b> Why normal distributions are normal</a></li>
<li class="chapter" data-level="4.2" data-path="geocentric-model.html"><a href="geocentric-model.html#normal-by-multiplication"><i class="fa fa-check"></i><b>4.2</b> Normal by multiplication</a></li>
<li class="chapter" data-level="4.3" data-path="geocentric-model.html"><a href="geocentric-model.html#gaussian-model-of-height"><i class="fa fa-check"></i><b>4.3</b> Gaussian model of height</a></li>
<li class="chapter" data-level="4.4" data-path="geocentric-model.html"><a href="geocentric-model.html#grid-approximationで事後分布を描く"><i class="fa fa-check"></i><b>4.4</b> Grid approximationで事後分布を描く</a>
<ul>
<li class="chapter" data-level="4.4.1" data-path="geocentric-model.html"><a href="geocentric-model.html#事後分布からサンプリングする"><i class="fa fa-check"></i><b>4.4.1</b> 事後分布からサンプリングする</a></li>
<li class="chapter" data-level="4.4.2" data-path="geocentric-model.html"><a href="geocentric-model.html#rethinking"><i class="fa fa-check"></i><b>4.4.2</b> rethinking</a></li>
<li class="chapter" data-level="4.4.3" data-path="geocentric-model.html"><a href="geocentric-model.html#finding-posterior-with-brms"><i class="fa fa-check"></i><b>4.4.3</b> Finding posterior with brms</a></li>
<li class="chapter" data-level="4.4.4" data-path="geocentric-model.html"><a href="geocentric-model.html#事後分布からのサンプリング"><i class="fa fa-check"></i><b>4.4.4</b> 事後分布からのサンプリング</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="geocentric-model.html"><a href="geocentric-model.html#linear-prediction"><i class="fa fa-check"></i><b>4.5</b> Linear prediction</a>
<ul>
<li class="chapter" data-level="4.5.1" data-path="geocentric-model.html"><a href="geocentric-model.html#finding-the-posterior-distribution"><i class="fa fa-check"></i><b>4.5.1</b> Finding the posterior distribution</a></li>
<li class="chapter" data-level="4.5.2" data-path="geocentric-model.html"><a href="geocentric-model.html#plotting-posterior-inference-agaist-the-data"><i class="fa fa-check"></i><b>4.5.2</b> Plotting posterior inference agaist the data</a></li>
<li class="chapter" data-level="4.5.3" data-path="geocentric-model.html"><a href="geocentric-model.html#plotting-regression-intervals-and-contours"><i class="fa fa-check"></i><b>4.5.3</b> Plotting regression intervals and contours</a></li>
<li class="chapter" data-level="4.5.4" data-path="geocentric-model.html"><a href="geocentric-model.html#prediction-intervals"><i class="fa fa-check"></i><b>4.5.4</b> Prediction intervals</a></li>
</ul></li>
<li class="chapter" data-level="4.6" data-path="geocentric-model.html"><a href="geocentric-model.html#curves-from-lines"><i class="fa fa-check"></i><b>4.6</b> Curves from lines</a>
<ul>
<li class="chapter" data-level="4.6.1" data-path="geocentric-model.html"><a href="geocentric-model.html#polynomial-regression"><i class="fa fa-check"></i><b>4.6.1</b> Polynomial regression</a></li>
<li class="chapter" data-level="4.6.2" data-path="geocentric-model.html"><a href="geocentric-model.html#overthinking"><i class="fa fa-check"></i><b>4.6.2</b> overthinking</a></li>
<li class="chapter" data-level="4.6.3" data-path="geocentric-model.html"><a href="geocentric-model.html#splines"><i class="fa fa-check"></i><b>4.6.3</b> Splines</a></li>
</ul></li>
<li class="chapter" data-level="4.7" data-path="geocentric-model.html"><a href="geocentric-model.html#practice-2"><i class="fa fa-check"></i><b>4.7</b> Practice</a>
<ul>
<li class="chapter" data-level="4.7.1" data-path="geocentric-model.html"><a href="geocentric-model.html#m1-2"><i class="fa fa-check"></i><b>4.7.1</b> 4M1</a></li>
<li class="chapter" data-level="4.7.2" data-path="geocentric-model.html"><a href="geocentric-model.html#m2-2"><i class="fa fa-check"></i><b>4.7.2</b> 4M2</a></li>
<li class="chapter" data-level="4.7.3" data-path="geocentric-model.html"><a href="geocentric-model.html#m4-2"><i class="fa fa-check"></i><b>4.7.3</b> 4M4</a></li>
<li class="chapter" data-level="4.7.4" data-path="geocentric-model.html"><a href="geocentric-model.html#m5-2"><i class="fa fa-check"></i><b>4.7.4</b> 4M5</a></li>
<li class="chapter" data-level="4.7.5" data-path="geocentric-model.html"><a href="geocentric-model.html#m6-1"><i class="fa fa-check"></i><b>4.7.5</b> 4M6</a></li>
<li class="chapter" data-level="4.7.6" data-path="geocentric-model.html"><a href="geocentric-model.html#m7-1"><i class="fa fa-check"></i><b>4.7.6</b> 4M7</a></li>
<li class="chapter" data-level="4.7.7" data-path="geocentric-model.html"><a href="geocentric-model.html#m8"><i class="fa fa-check"></i><b>4.7.7</b> 4M8</a></li>
<li class="chapter" data-level="4.7.8" data-path="geocentric-model.html"><a href="geocentric-model.html#h1-2"><i class="fa fa-check"></i><b>4.7.8</b> 4H1</a></li>
<li class="chapter" data-level="4.7.9" data-path="geocentric-model.html"><a href="geocentric-model.html#h2-2"><i class="fa fa-check"></i><b>4.7.9</b> 4H2</a></li>
<li class="chapter" data-level="4.7.10" data-path="geocentric-model.html"><a href="geocentric-model.html#h3-2"><i class="fa fa-check"></i><b>4.7.10</b> 4H3</a></li>
<li class="chapter" data-level="4.7.11" data-path="geocentric-model.html"><a href="geocentric-model.html#h4-2"><i class="fa fa-check"></i><b>4.7.11</b> 4H4</a></li>
<li class="chapter" data-level="4.7.12" data-path="geocentric-model.html"><a href="geocentric-model.html#h5-1"><i class="fa fa-check"></i><b>4.7.12</b> 4H5</a></li>
<li class="chapter" data-level="4.7.13" data-path="geocentric-model.html"><a href="geocentric-model.html#h6"><i class="fa fa-check"></i><b>4.7.13</b> 4H6</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html"><i class="fa fa-check"></i><b>5</b> The many variables &amp; the spurious waffles</a>
<ul>
<li class="chapter" data-level="5.1" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#spurious-association"><i class="fa fa-check"></i><b>5.1</b> Spurious association</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#グラフを用いて因果モデルを考える"><i class="fa fa-check"></i><b>5.1.1</b> グラフを用いて因果モデルを考える</a></li>
<li class="chapter" data-level="5.1.2" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#predictor-residual-plots"><i class="fa fa-check"></i><b>5.1.2</b> Predictor residual plots</a></li>
<li class="chapter" data-level="5.1.3" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#posterior-prediction-plots"><i class="fa fa-check"></i><b>5.1.3</b> Posterior prediction plots</a></li>
<li class="chapter" data-level="5.1.4" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#counterfactual-plot"><i class="fa fa-check"></i><b>5.1.4</b> Counterfactual plot</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#masked-relationship"><i class="fa fa-check"></i><b>5.2</b> Masked relationship</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#k-nモデル"><i class="fa fa-check"></i><b>5.2.1</b> K ~ Nモデル</a></li>
<li class="chapter" data-level="5.2.2" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#k-mモデル"><i class="fa fa-check"></i><b>5.2.2</b> K ~ Mモデル</a></li>
<li class="chapter" data-level="5.2.3" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#k-n-mモデル"><i class="fa fa-check"></i><b>5.2.3</b> K ~ N + Mモデル</a></li>
<li class="chapter" data-level="5.2.4" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#counterfactual-plot-を描く"><i class="fa fa-check"></i><b>5.2.4</b> Counterfactual plot を描く</a></li>
<li class="chapter" data-level="5.2.5" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#overthinking-1"><i class="fa fa-check"></i><b>5.2.5</b> Overthinking</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#categorical-variables"><i class="fa fa-check"></i><b>5.3</b> Categorical variables</a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#two-categories"><i class="fa fa-check"></i><b>5.3.1</b> Two categories</a></li>
<li class="chapter" data-level="5.3.2" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#many-categories"><i class="fa fa-check"></i><b>5.3.2</b> Many Categories</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#practice-3"><i class="fa fa-check"></i><b>5.4</b> Practice</a>
<ul>
<li class="chapter" data-level="5.4.1" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#m1-3"><i class="fa fa-check"></i><b>5.4.1</b> 5M1</a></li>
<li class="chapter" data-level="5.4.2" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#m2-3"><i class="fa fa-check"></i><b>5.4.2</b> 5M2</a></li>
<li class="chapter" data-level="5.4.3" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#m4-3"><i class="fa fa-check"></i><b>5.4.3</b> 5M4</a></li>
<li class="chapter" data-level="5.4.4" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#h1-3"><i class="fa fa-check"></i><b>5.4.4</b> 5H1</a></li>
<li class="chapter" data-level="5.4.5" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#h2-3"><i class="fa fa-check"></i><b>5.4.5</b> 5H2</a></li>
<li class="chapter" data-level="5.4.6" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#h3-3"><i class="fa fa-check"></i><b>5.4.6</b> 5H3</a></li>
<li class="chapter" data-level="5.4.7" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#h4-3"><i class="fa fa-check"></i><b>5.4.7</b> 5H4</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html"><i class="fa fa-check"></i><b>6</b> The Haunted DAG &amp; the Causal Terror</a>
<ul>
<li class="chapter" data-level="6.1" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#multicollinearity"><i class="fa fa-check"></i><b>6.1</b> Multicollinearity</a>
<ul>
<li class="chapter" data-level="6.1.1" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#multicollinear-milk"><i class="fa fa-check"></i><b>6.1.1</b> Multicollinear milk</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#post-treatment-bias"><i class="fa fa-check"></i><b>6.2</b> Post-treatment bias</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#blocked-by-consequence"><i class="fa fa-check"></i><b>6.2.1</b> Blocked by consequence</a></li>
<li class="chapter" data-level="6.2.2" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#fungus-and-d-separation"><i class="fa fa-check"></i><b>6.2.2</b> Fungus and d-separation</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#collider-bias"><i class="fa fa-check"></i><b>6.3</b> Collider bias</a>
<ul>
<li class="chapter" data-level="6.3.1" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#collider-of-false-sorrow"><i class="fa fa-check"></i><b>6.3.1</b> Collider of false sorrow</a></li>
<li class="chapter" data-level="6.3.2" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#the-haunted-dag"><i class="fa fa-check"></i><b>6.3.2</b> The haunted DAG</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#confronting-confoundings"><i class="fa fa-check"></i><b>6.4</b> Confronting confoundings</a>
<ul>
<li class="chapter" data-level="6.4.1" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#two-roads"><i class="fa fa-check"></i><b>6.4.1</b> Two roads</a></li>
<li class="chapter" data-level="6.4.2" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#backdoor-waffles"><i class="fa fa-check"></i><b>6.4.2</b> Backdoor Waffles</a></li>
</ul></li>
<li class="chapter" data-level="6.5" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#practice-4"><i class="fa fa-check"></i><b>6.5</b> Practice</a>
<ul>
<li class="chapter" data-level="6.5.1" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#m1-4"><i class="fa fa-check"></i><b>6.5.1</b> 6M1</a></li>
<li class="chapter" data-level="6.5.2" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#m2-4"><i class="fa fa-check"></i><b>6.5.2</b> 6M2</a></li>
<li class="chapter" data-level="6.5.3" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#h1-4"><i class="fa fa-check"></i><b>6.5.3</b> 6H1</a></li>
<li class="chapter" data-level="6.5.4" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#h2-4"><i class="fa fa-check"></i><b>6.5.4</b> 6H2</a></li>
<li class="chapter" data-level="6.5.5" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#h3-4"><i class="fa fa-check"></i><b>6.5.5</b> 6H3</a></li>
<li class="chapter" data-level="6.5.6" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#h4-4"><i class="fa fa-check"></i><b>6.5.6</b> 6H4</a></li>
<li class="chapter" data-level="6.5.7" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#h5-2"><i class="fa fa-check"></i><b>6.5.7</b> 6H5</a></li>
</ul></li>
<li class="chapter" data-level="6.6" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#おまけ-ランダム効果を入れてみる"><i class="fa fa-check"></i><b>6.6</b> おまけ　ランダム効果を入れてみる</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="ulysses-compass.html"><a href="ulysses-compass.html"><i class="fa fa-check"></i><b>7</b> Ulysses’ Compass</a>
<ul>
<li class="chapter" data-level="7.1" data-path="ulysses-compass.html"><a href="ulysses-compass.html#the-problems-with-parameters"><i class="fa fa-check"></i><b>7.1</b> The problems with parameters</a>
<ul>
<li class="chapter" data-level="7.1.1" data-path="ulysses-compass.html"><a href="ulysses-compass.html#more-parameters-always-improve-fit"><i class="fa fa-check"></i><b>7.1.1</b> More parameters always improve fit</a></li>
<li class="chapter" data-level="7.1.2" data-path="ulysses-compass.html"><a href="ulysses-compass.html#too-few-parameters-hurts-too"><i class="fa fa-check"></i><b>7.1.2</b> Too few parameters hurts too</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="ulysses-compass.html"><a href="ulysses-compass.html#entropy-and-accuracy"><i class="fa fa-check"></i><b>7.2</b> Entropy and accuracy</a>
<ul>
<li class="chapter" data-level="7.2.1" data-path="ulysses-compass.html"><a href="ulysses-compass.html#information-and-uncertainty"><i class="fa fa-check"></i><b>7.2.1</b> Information and uncertainty</a></li>
<li class="chapter" data-level="7.2.2" data-path="ulysses-compass.html"><a href="ulysses-compass.html#from-entropy-to-acculacy"><i class="fa fa-check"></i><b>7.2.2</b> From entropy to acculacy</a></li>
<li class="chapter" data-level="7.2.3" data-path="ulysses-compass.html"><a href="ulysses-compass.html#estimating-divergence"><i class="fa fa-check"></i><b>7.2.3</b> Estimating divergence</a></li>
<li class="chapter" data-level="7.2.4" data-path="ulysses-compass.html"><a href="ulysses-compass.html#scoring-the-right-data"><i class="fa fa-check"></i><b>7.2.4</b> Scoring the right data</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="ulysses-compass.html"><a href="ulysses-compass.html#golem-taming-regularization"><i class="fa fa-check"></i><b>7.3</b> Golem taming: regularization</a></li>
<li class="chapter" data-level="7.4" data-path="ulysses-compass.html"><a href="ulysses-compass.html#predicting-predictive-accuracy"><i class="fa fa-check"></i><b>7.4</b> Predicting predictive accuracy</a>
<ul>
<li class="chapter" data-level="7.4.1" data-path="ulysses-compass.html"><a href="ulysses-compass.html#cross-validation"><i class="fa fa-check"></i><b>7.4.1</b> Cross validation</a></li>
<li class="chapter" data-level="7.4.2" data-path="ulysses-compass.html"><a href="ulysses-compass.html#information-criteria"><i class="fa fa-check"></i><b>7.4.2</b> Information criteria</a></li>
<li class="chapter" data-level="7.4.3" data-path="ulysses-compass.html"><a href="ulysses-compass.html#overthinking-waic-calculation"><i class="fa fa-check"></i><b>7.4.3</b> overthinking: WAIC calculation</a></li>
<li class="chapter" data-level="7.4.4" data-path="ulysses-compass.html"><a href="ulysses-compass.html#comparing-cv-psis-and-waic"><i class="fa fa-check"></i><b>7.4.4</b> Comparing CV, PSIS, and WAIC</a></li>
</ul></li>
<li class="chapter" data-level="7.5" data-path="ulysses-compass.html"><a href="ulysses-compass.html#model-comparison"><i class="fa fa-check"></i><b>7.5</b> Model comparison</a>
<ul>
<li class="chapter" data-level="7.5.1" data-path="ulysses-compass.html"><a href="ulysses-compass.html#model-mis-selection"><i class="fa fa-check"></i><b>7.5.1</b> Model mis-selection</a></li>
<li class="chapter" data-level="7.5.2" data-path="ulysses-compass.html"><a href="ulysses-compass.html#outlier-and-other-illusions"><i class="fa fa-check"></i><b>7.5.2</b> Outlier and other illusions</a></li>
</ul></li>
<li class="chapter" data-level="7.6" data-path="ulysses-compass.html"><a href="ulysses-compass.html#practice-5"><i class="fa fa-check"></i><b>7.6</b> Practice</a>
<ul>
<li class="chapter" data-level="7.6.1" data-path="ulysses-compass.html"><a href="ulysses-compass.html#e2"><i class="fa fa-check"></i><b>7.6.1</b> 7E2</a></li>
<li class="chapter" data-level="7.6.2" data-path="ulysses-compass.html"><a href="ulysses-compass.html#e3"><i class="fa fa-check"></i><b>7.6.2</b> 7E3</a></li>
<li class="chapter" data-level="7.6.3" data-path="ulysses-compass.html"><a href="ulysses-compass.html#e4"><i class="fa fa-check"></i><b>7.6.3</b> 7E4</a></li>
<li class="chapter" data-level="7.6.4" data-path="ulysses-compass.html"><a href="ulysses-compass.html#m4-4"><i class="fa fa-check"></i><b>7.6.4</b> 7M4</a></li>
<li class="chapter" data-level="7.6.5" data-path="ulysses-compass.html"><a href="ulysses-compass.html#h1-5"><i class="fa fa-check"></i><b>7.6.5</b> 7H1</a></li>
<li class="chapter" data-level="7.6.6" data-path="ulysses-compass.html"><a href="ulysses-compass.html#h2-5"><i class="fa fa-check"></i><b>7.6.6</b> 7H2</a></li>
<li class="chapter" data-level="7.6.7" data-path="ulysses-compass.html"><a href="ulysses-compass.html#h3-5"><i class="fa fa-check"></i><b>7.6.7</b> 7H3</a></li>
<li class="chapter" data-level="7.6.8" data-path="ulysses-compass.html"><a href="ulysses-compass.html#h4-5"><i class="fa fa-check"></i><b>7.6.8</b> 7H4</a></li>
<li class="chapter" data-level="7.6.9" data-path="ulysses-compass.html"><a href="ulysses-compass.html#h5-3"><i class="fa fa-check"></i><b>7.6.9</b> 7H5</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="conditional-manatees.html"><a href="conditional-manatees.html"><i class="fa fa-check"></i><b>8</b> Conditional Manatees</a>
<ul>
<li class="chapter" data-level="8.1" data-path="conditional-manatees.html"><a href="conditional-manatees.html#building-an-interaction"><i class="fa fa-check"></i><b>8.1</b> Building an interaction</a>
<ul>
<li class="chapter" data-level="8.1.1" data-path="conditional-manatees.html"><a href="conditional-manatees.html#making-a-rugged-model"><i class="fa fa-check"></i><b>8.1.1</b> Making a rugged model</a></li>
<li class="chapter" data-level="8.1.2" data-path="conditional-manatees.html"><a href="conditional-manatees.html#adding-an-indicator-variable-isnt-enough"><i class="fa fa-check"></i><b>8.1.2</b> Adding an indicator variable isn’t enough</a></li>
<li class="chapter" data-level="8.1.3" data-path="conditional-manatees.html"><a href="conditional-manatees.html#adding-interaction-does-work"><i class="fa fa-check"></i><b>8.1.3</b> Adding interaction does work</a></li>
<li class="chapter" data-level="8.1.4" data-path="conditional-manatees.html"><a href="conditional-manatees.html#plotting-the-interaction"><i class="fa fa-check"></i><b>8.1.4</b> Plotting the interaction</a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="conditional-manatees.html"><a href="conditional-manatees.html#symmetry-of-interaction"><i class="fa fa-check"></i><b>8.2</b> Symmetry of interaction</a></li>
<li class="chapter" data-level="8.3" data-path="conditional-manatees.html"><a href="conditional-manatees.html#continuous-interaction"><i class="fa fa-check"></i><b>8.3</b> Continuous interaction</a>
<ul>
<li class="chapter" data-level="8.3.1" data-path="conditional-manatees.html"><a href="conditional-manatees.html#a-winter-flower"><i class="fa fa-check"></i><b>8.3.1</b> A winter flower</a></li>
<li class="chapter" data-level="8.3.2" data-path="conditional-manatees.html"><a href="conditional-manatees.html#the-models"><i class="fa fa-check"></i><b>8.3.2</b> The models</a></li>
<li class="chapter" data-level="8.3.3" data-path="conditional-manatees.html"><a href="conditional-manatees.html#plotting-posterior-predictions"><i class="fa fa-check"></i><b>8.3.3</b> Plotting posterior predictions</a></li>
<li class="chapter" data-level="8.3.4" data-path="conditional-manatees.html"><a href="conditional-manatees.html#plotting-prior-predictions"><i class="fa fa-check"></i><b>8.3.4</b> Plotting prior predictions</a></li>
</ul></li>
<li class="chapter" data-level="8.4" data-path="conditional-manatees.html"><a href="conditional-manatees.html#practice-6"><i class="fa fa-check"></i><b>8.4</b> Practice</a>
<ul>
<li class="chapter" data-level="8.4.1" data-path="conditional-manatees.html"><a href="conditional-manatees.html#m4-5"><i class="fa fa-check"></i><b>8.4.1</b> 8M4</a></li>
<li class="chapter" data-level="8.4.2" data-path="conditional-manatees.html"><a href="conditional-manatees.html#h1-6"><i class="fa fa-check"></i><b>8.4.2</b> 8H1</a></li>
<li class="chapter" data-level="8.4.3" data-path="conditional-manatees.html"><a href="conditional-manatees.html#h2-6"><i class="fa fa-check"></i><b>8.4.3</b> 8H2</a></li>
<li class="chapter" data-level="8.4.4" data-path="conditional-manatees.html"><a href="conditional-manatees.html#h3-6"><i class="fa fa-check"></i><b>8.4.4</b> 8H3</a></li>
<li class="chapter" data-level="8.4.5" data-path="conditional-manatees.html"><a href="conditional-manatees.html#h4-6"><i class="fa fa-check"></i><b>8.4.5</b> 8H4</a></li>
<li class="chapter" data-level="8.4.6" data-path="conditional-manatees.html"><a href="conditional-manatees.html#h5-4"><i class="fa fa-check"></i><b>8.4.6</b> 8H5</a></li>
<li class="chapter" data-level="8.4.7" data-path="conditional-manatees.html"><a href="conditional-manatees.html#h6-1"><i class="fa fa-check"></i><b>8.4.7</b> 8H6</a></li>
<li class="chapter" data-level="8.4.8" data-path="conditional-manatees.html"><a href="conditional-manatees.html#h7"><i class="fa fa-check"></i><b>8.4.8</b> 8H7</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="9" data-path="marcov-chain-monte-carlo.html"><a href="marcov-chain-monte-carlo.html"><i class="fa fa-check"></i><b>9</b> Marcov Chain Monte Carlo</a>
<ul>
<li class="chapter" data-level="9.1" data-path="marcov-chain-monte-carlo.html"><a href="marcov-chain-monte-carlo.html#good-king-marcov-and-his-island-kingdom"><i class="fa fa-check"></i><b>9.1</b> Good King Marcov and his island kingdom</a></li>
<li class="chapter" data-level="9.2" data-path="marcov-chain-monte-carlo.html"><a href="marcov-chain-monte-carlo.html#metropolis-algorythm"><i class="fa fa-check"></i><b>9.2</b> Metropolis algorythm</a>
<ul>
<li class="chapter" data-level="9.2.1" data-path="marcov-chain-monte-carlo.html"><a href="marcov-chain-monte-carlo.html#gibbs-sampling"><i class="fa fa-check"></i><b>9.2.1</b> Gibbs sampling</a></li>
<li class="chapter" data-level="9.2.2" data-path="marcov-chain-monte-carlo.html"><a href="marcov-chain-monte-carlo.html#high-dimentional-problem"><i class="fa fa-check"></i><b>9.2.2</b> High-dimentional problem</a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="marcov-chain-monte-carlo.html"><a href="marcov-chain-monte-carlo.html#hamiltonian-monte-carlo"><i class="fa fa-check"></i><b>9.3</b> Hamiltonian Monte Carlo</a>
<ul>
<li class="chapter" data-level="9.3.1" data-path="marcov-chain-monte-carlo.html"><a href="marcov-chain-monte-carlo.html#another-probable"><i class="fa fa-check"></i><b>9.3.1</b> Another probable</a></li>
<li class="chapter" data-level="9.3.2" data-path="marcov-chain-monte-carlo.html"><a href="marcov-chain-monte-carlo.html#limitations"><i class="fa fa-check"></i><b>9.3.2</b> Limitations</a></li>
</ul></li>
<li class="chapter" data-level="9.4" data-path="marcov-chain-monte-carlo.html"><a href="marcov-chain-monte-carlo.html#easy-hmc-ulam-brm"><i class="fa fa-check"></i><b>9.4</b> Easy HMC: <del>ulam</del> <code>brm()</code></a>
<ul>
<li class="chapter" data-level="9.4.1" data-path="marcov-chain-monte-carlo.html"><a href="marcov-chain-monte-carlo.html#preparation"><i class="fa fa-check"></i><b>9.4.1</b> Preparation</a></li>
<li class="chapter" data-level="9.4.2" data-path="marcov-chain-monte-carlo.html"><a href="marcov-chain-monte-carlo.html#sampling-from-posterior"><i class="fa fa-check"></i><b>9.4.2</b> Sampling from posterior</a></li>
<li class="chapter" data-level="9.4.3" data-path="marcov-chain-monte-carlo.html"><a href="marcov-chain-monte-carlo.html#sampling-again-in-parallel"><i class="fa fa-check"></i><b>9.4.3</b> Sampling again in parallel</a></li>
<li class="chapter" data-level="9.4.4" data-path="marcov-chain-monte-carlo.html"><a href="marcov-chain-monte-carlo.html#visualization"><i class="fa fa-check"></i><b>9.4.4</b> Visualization</a></li>
<li class="chapter" data-level="9.4.5" data-path="marcov-chain-monte-carlo.html"><a href="marcov-chain-monte-carlo.html#checking-the-chain"><i class="fa fa-check"></i><b>9.4.5</b> Checking the chain</a></li>
</ul></li>
<li class="chapter" data-level="9.5" data-path="marcov-chain-monte-carlo.html"><a href="marcov-chain-monte-carlo.html#care-and-feeding-of-your-marcov-chain"><i class="fa fa-check"></i><b>9.5</b> Care and feeding of your Marcov chain</a>
<ul>
<li class="chapter" data-level="9.5.1" data-path="marcov-chain-monte-carlo.html"><a href="marcov-chain-monte-carlo.html#how-many-samples-do-you-need"><i class="fa fa-check"></i><b>9.5.1</b> How many samples do you need</a></li>
<li class="chapter" data-level="9.5.2" data-path="marcov-chain-monte-carlo.html"><a href="marcov-chain-monte-carlo.html#how-many-chains-do-we-need"><i class="fa fa-check"></i><b>9.5.2</b> How many chains do we need</a></li>
<li class="chapter" data-level="9.5.3" data-path="marcov-chain-monte-carlo.html"><a href="marcov-chain-monte-carlo.html#taming-and-wild-chain"><i class="fa fa-check"></i><b>9.5.3</b> Taming and wild chain</a></li>
<li class="chapter" data-level="9.5.4" data-path="marcov-chain-monte-carlo.html"><a href="marcov-chain-monte-carlo.html#non-identifiable-parameters"><i class="fa fa-check"></i><b>9.5.4</b> Non-identifiable parameters</a></li>
</ul></li>
<li class="chapter" data-level="9.6" data-path="marcov-chain-monte-carlo.html"><a href="marcov-chain-monte-carlo.html#practice-7"><i class="fa fa-check"></i><b>9.6</b> Practice</a>
<ul>
<li class="chapter" data-level="9.6.1" data-path="marcov-chain-monte-carlo.html"><a href="marcov-chain-monte-carlo.html#m1-5"><i class="fa fa-check"></i><b>9.6.1</b> 9M1</a></li>
<li class="chapter" data-level="9.6.2" data-path="marcov-chain-monte-carlo.html"><a href="marcov-chain-monte-carlo.html#m2-5"><i class="fa fa-check"></i><b>9.6.2</b> 9M2</a></li>
<li class="chapter" data-level="9.6.3" data-path="marcov-chain-monte-carlo.html"><a href="marcov-chain-monte-carlo.html#m3-2"><i class="fa fa-check"></i><b>9.6.3</b> 9M3</a></li>
<li class="chapter" data-level="9.6.4" data-path="marcov-chain-monte-carlo.html"><a href="marcov-chain-monte-carlo.html#h1-7"><i class="fa fa-check"></i><b>9.6.4</b> 9H1</a></li>
<li class="chapter" data-level="9.6.5" data-path="marcov-chain-monte-carlo.html"><a href="marcov-chain-monte-carlo.html#h2-7"><i class="fa fa-check"></i><b>9.6.5</b> 9H2</a></li>
<li class="chapter" data-level="9.6.6" data-path="marcov-chain-monte-carlo.html"><a href="marcov-chain-monte-carlo.html#h3-7"><i class="fa fa-check"></i><b>9.6.6</b> 9H3</a></li>
<li class="chapter" data-level="9.6.7" data-path="marcov-chain-monte-carlo.html"><a href="marcov-chain-monte-carlo.html#h4-7"><i class="fa fa-check"></i><b>9.6.7</b> 9H4</a></li>
<li class="chapter" data-level="9.6.8" data-path="marcov-chain-monte-carlo.html"><a href="marcov-chain-monte-carlo.html#h5-5"><i class="fa fa-check"></i><b>9.6.8</b> 9H5</a></li>
<li class="chapter" data-level="9.6.9" data-path="marcov-chain-monte-carlo.html"><a href="marcov-chain-monte-carlo.html#h6-2"><i class="fa fa-check"></i><b>9.6.9</b> 9H6</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="10" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html"><i class="fa fa-check"></i><b>10</b> Big Entropy and the Generalized Linear Model</a>
<ul>
<li class="chapter" data-level="10.1" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html#maximum-entropy"><i class="fa fa-check"></i><b>10.1</b> Maximum entropy</a>
<ul>
<li class="chapter" data-level="10.1.1" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html#gaussian"><i class="fa fa-check"></i><b>10.1.1</b> Gaussian</a></li>
<li class="chapter" data-level="10.1.2" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html#binomial"><i class="fa fa-check"></i><b>10.1.2</b> Binomial</a></li>
</ul></li>
<li class="chapter" data-level="10.2" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html#generalized-linear-models"><i class="fa fa-check"></i><b>10.2</b> Generalized linear models</a>
<ul>
<li class="chapter" data-level="10.2.1" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html#meet-the-family"><i class="fa fa-check"></i><b>10.2.1</b> Meet the family</a></li>
<li class="chapter" data-level="10.2.2" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html#linking-linear-models-to-distributions"><i class="fa fa-check"></i><b>10.2.2</b> Linking linear models to distributions</a></li>
<li class="chapter" data-level="10.2.3" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html#overthinking-2"><i class="fa fa-check"></i><b>10.2.3</b> Overthinking</a></li>
<li class="chapter" data-level="10.2.4" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html#omitted-variable-bias-again"><i class="fa fa-check"></i><b>10.2.4</b> Omitted variable bias again</a></li>
<li class="chapter" data-level="10.2.5" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html#absolute-and-relative-differences"><i class="fa fa-check"></i><b>10.2.5</b> Absolute and relative differences</a></li>
<li class="chapter" data-level="10.2.6" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html#glms-and-information-criteria"><i class="fa fa-check"></i><b>10.2.6</b> GLMs and information criteria</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="11" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html"><i class="fa fa-check"></i><b>11</b> God Spiked the Integers</a>
<ul>
<li class="chapter" data-level="11.1" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#binomial-regression"><i class="fa fa-check"></i><b>11.1</b> Binomial regression</a>
<ul>
<li class="chapter" data-level="11.1.1" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#logistic-regression"><i class="fa fa-check"></i><b>11.1.1</b> Logistic regression</a></li>
<li class="chapter" data-level="11.1.2" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#relative-shark-and-absolute-deer"><i class="fa fa-check"></i><b>11.1.2</b> Relative shark and absolute deer</a></li>
<li class="chapter" data-level="11.1.3" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#aggregated-binomial-chimpanzees-again-condensed"><i class="fa fa-check"></i><b>11.1.3</b> Aggregated binomial: Chimpanzees again, condensed</a></li>
</ul></li>
<li class="chapter" data-level="11.2" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#aggregated-binomial-graduate-school-admittions."><i class="fa fa-check"></i><b>11.2</b> Aggregated binomial: Graduate school admittions.</a></li>
<li class="chapter" data-level="11.3" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#poisson-regression"><i class="fa fa-check"></i><b>11.3</b> Poisson regression</a>
<ul>
<li class="chapter" data-level="11.3.1" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#oceanic-tool-complexity"><i class="fa fa-check"></i><b>11.3.1</b> Oceanic tool complexity</a></li>
<li class="chapter" data-level="11.3.2" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#negative-binomial-gamma-poisson-models."><i class="fa fa-check"></i><b>11.3.2</b> Negative binomial (Gamma-Poisson) models.</a></li>
<li class="chapter" data-level="11.3.3" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#example-exposure-and-the-offset"><i class="fa fa-check"></i><b>11.3.3</b> Example: Exposure and the offset</a></li>
</ul></li>
<li class="chapter" data-level="11.4" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#multinomial-and-categorical-models"><i class="fa fa-check"></i><b>11.4</b> Multinomial and categorical models</a>
<ul>
<li class="chapter" data-level="11.4.1" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#predictors-matched-to-outcomes"><i class="fa fa-check"></i><b>11.4.1</b> Predictors matched to outcomes</a></li>
<li class="chapter" data-level="11.4.2" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#predictor-matched-to-observations"><i class="fa fa-check"></i><b>11.4.2</b> Predictor matched to observations</a></li>
<li class="chapter" data-level="11.4.3" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#multinomial-in-disguise-as-poisson"><i class="fa fa-check"></i><b>11.4.3</b> Multinomial in disguise as Poisson</a></li>
</ul></li>
<li class="chapter" data-level="11.5" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#practice-8"><i class="fa fa-check"></i><b>11.5</b> Practice</a>
<ul>
<li class="chapter" data-level="11.5.1" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#e1"><i class="fa fa-check"></i><b>11.5.1</b> 11E1</a></li>
<li class="chapter" data-level="11.5.2" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#e2-1"><i class="fa fa-check"></i><b>11.5.2</b> 11E2</a></li>
<li class="chapter" data-level="11.5.3" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#e3-1"><i class="fa fa-check"></i><b>11.5.3</b> 11E3</a></li>
<li class="chapter" data-level="11.5.4" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#e4-1"><i class="fa fa-check"></i><b>11.5.4</b> 11E4</a></li>
<li class="chapter" data-level="11.5.5" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#m7-2"><i class="fa fa-check"></i><b>11.5.5</b> 11M7</a></li>
<li class="chapter" data-level="11.5.6" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#m8-1"><i class="fa fa-check"></i><b>11.5.6</b> 11M8</a></li>
<li class="chapter" data-level="11.5.7" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#h1-8"><i class="fa fa-check"></i><b>11.5.7</b> 11H1</a></li>
<li class="chapter" data-level="11.5.8" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#h2-8"><i class="fa fa-check"></i><b>11.5.8</b> 11H2</a></li>
<li class="chapter" data-level="11.5.9" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#h3-8"><i class="fa fa-check"></i><b>11.5.9</b> 11H3</a></li>
<li class="chapter" data-level="11.5.10" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#h4-8"><i class="fa fa-check"></i><b>11.5.10</b> 11H4</a></li>
<li class="chapter" data-level="11.5.11" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#h5-6"><i class="fa fa-check"></i><b>11.5.11</b> 11H5</a></li>
<li class="chapter" data-level="11.5.12" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#h6-3"><i class="fa fa-check"></i><b>11.5.12</b> 11H6</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="12" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html"><i class="fa fa-check"></i><b>12</b> Monsters and Mixtures</a>
<ul>
<li class="chapter" data-level="12.1" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#over-dispersed-counts"><i class="fa fa-check"></i><b>12.1</b> Over-dispersed counts</a>
<ul>
<li class="chapter" data-level="12.1.1" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#beta-binomial."><i class="fa fa-check"></i><b>12.1.1</b> Beta binomial.</a></li>
<li class="chapter" data-level="12.1.2" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#negative-binomial-or-gamma-poisson."><i class="fa fa-check"></i><b>12.1.2</b> Negative binomial or gamma-Poisson.</a></li>
<li class="chapter" data-level="12.1.3" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#over-dispersion-entropy-and-information-criteria."><i class="fa fa-check"></i><b>12.1.3</b> Over-dispersion, entropy, and information criteria.</a></li>
</ul></li>
<li class="chapter" data-level="12.2" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#zero-inflated-outcomes"><i class="fa fa-check"></i><b>12.2</b> Zero-inflated outcomes</a>
<ul>
<li class="chapter" data-level="12.2.1" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#example-zero-inflated-poisson."><i class="fa fa-check"></i><b>12.2.1</b> Example: Zero-inflated Poisson.</a></li>
</ul></li>
<li class="chapter" data-level="12.3" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#ordered-categorical-outcomes"><i class="fa fa-check"></i><b>12.3</b> Ordered categorical outcomes</a>
<ul>
<li class="chapter" data-level="12.3.1" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#example-moral-intuition."><i class="fa fa-check"></i><b>12.3.1</b> Example: Moral intuition.</a></li>
<li class="chapter" data-level="12.3.2" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#adding-predictor-variables."><i class="fa fa-check"></i><b>12.3.2</b> Adding predictor variables.</a></li>
</ul></li>
<li class="chapter" data-level="12.4" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#ordered-categorical-predictors"><i class="fa fa-check"></i><b>12.4</b> Ordered categorical predictors</a></li>
<li class="chapter" data-level="12.5" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#practice-9"><i class="fa fa-check"></i><b>12.5</b> Practice</a>
<ul>
<li class="chapter" data-level="12.5.1" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#m1-6"><i class="fa fa-check"></i><b>12.5.1</b> 12M1</a></li>
<li class="chapter" data-level="12.5.2" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#m2-6"><i class="fa fa-check"></i><b>12.5.2</b> 12M2</a></li>
<li class="chapter" data-level="12.5.3" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#m3-3"><i class="fa fa-check"></i><b>12.5.3</b> 12M3</a></li>
<li class="chapter" data-level="12.5.4" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#h1-9"><i class="fa fa-check"></i><b>12.5.4</b> 12H1</a></li>
<li class="chapter" data-level="12.5.5" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#h2-9"><i class="fa fa-check"></i><b>12.5.5</b> 12H2</a></li>
<li class="chapter" data-level="12.5.6" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#h3-9"><i class="fa fa-check"></i><b>12.5.6</b> 12H3</a></li>
<li class="chapter" data-level="12.5.7" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#h4-9"><i class="fa fa-check"></i><b>12.5.7</b> 12H4</a></li>
<li class="chapter" data-level="12.5.8" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#h5-7"><i class="fa fa-check"></i><b>12.5.8</b> 12H5</a></li>
<li class="chapter" data-level="12.5.9" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#h6-4"><i class="fa fa-check"></i><b>12.5.9</b> 12H6</a></li>
<li class="chapter" data-level="12.5.10" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#h7-1"><i class="fa fa-check"></i><b>12.5.10</b> 12H7</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="13" data-path="models-with-memory.html"><a href="models-with-memory.html"><i class="fa fa-check"></i><b>13</b> Models with Memory</a>
<ul>
<li class="chapter" data-level="13.1" data-path="models-with-memory.html"><a href="models-with-memory.html#multilevel-tadpoles"><i class="fa fa-check"></i><b>13.1</b> Multilevel tadpoles</a></li>
<li class="chapter" data-level="13.2" data-path="models-with-memory.html"><a href="models-with-memory.html#varying-effects-and-the-underfittingoverfitting-trade-off"><i class="fa fa-check"></i><b>13.2</b> Varying effects and the underfitting/overfitting trade-off 　</a>
<ul>
<li class="chapter" data-level="13.2.1" data-path="models-with-memory.html"><a href="models-with-memory.html#the-model"><i class="fa fa-check"></i><b>13.2.1</b> The model</a></li>
<li class="chapter" data-level="13.2.2" data-path="models-with-memory.html"><a href="models-with-memory.html#simulate-survivors"><i class="fa fa-check"></i><b>13.2.2</b> Simulate survivors</a></li>
</ul></li>
<li class="chapter" data-level="13.3" data-path="models-with-memory.html"><a href="models-with-memory.html#more-than-one-type-of-cluster"><i class="fa fa-check"></i><b>13.3</b> More than one type of cluster</a>
<ul>
<li class="chapter" data-level="13.3.1" data-path="models-with-memory.html"><a href="models-with-memory.html#even-more-clusters"><i class="fa fa-check"></i><b>13.3.1</b> Even more clusters</a></li>
</ul></li>
<li class="chapter" data-level="13.4" data-path="models-with-memory.html"><a href="models-with-memory.html#divergent-transitions-and-non-centered-priors"><i class="fa fa-check"></i><b>13.4</b> Divergent transitions and non-centered priors</a>
<ul>
<li class="chapter" data-level="13.4.1" data-path="models-with-memory.html"><a href="models-with-memory.html#the-devils-funnel"><i class="fa fa-check"></i><b>13.4.1</b> The Devil’s Funnel</a></li>
<li class="chapter" data-level="13.4.2" data-path="models-with-memory.html"><a href="models-with-memory.html#non-centered-chimpanzees"><i class="fa fa-check"></i><b>13.4.2</b> Non-centered chimpanzees</a></li>
</ul></li>
<li class="chapter" data-level="13.5" data-path="models-with-memory.html"><a href="models-with-memory.html#multilevel-posterior-predictions"><i class="fa fa-check"></i><b>13.5</b> Multilevel posterior predictions</a>
<ul>
<li class="chapter" data-level="13.5.1" data-path="models-with-memory.html"><a href="models-with-memory.html#posterior-prediction-for-same-clusters"><i class="fa fa-check"></i><b>13.5.1</b> Posterior prediction for same clusters</a></li>
<li class="chapter" data-level="13.5.2" data-path="models-with-memory.html"><a href="models-with-memory.html#posterior-prediction-for-new-clusters"><i class="fa fa-check"></i><b>13.5.2</b> Posterior prediction for new clusters</a></li>
</ul></li>
<li class="chapter" data-level="13.6" data-path="models-with-memory.html"><a href="models-with-memory.html#post-stratification"><i class="fa fa-check"></i><b>13.6</b> Post stratification</a>
<ul>
<li class="chapter" data-level="13.6.1" data-path="models-with-memory.html"><a href="models-with-memory.html#meet-the-data"><i class="fa fa-check"></i><b>13.6.1</b> Meet the data</a></li>
<li class="chapter" data-level="13.6.2" data-path="models-with-memory.html"><a href="models-with-memory.html#settle-the-mr-part-of-mrp."><i class="fa fa-check"></i><b>13.6.2</b> Settle the MR part of MRP.</a></li>
<li class="chapter" data-level="13.6.3" data-path="models-with-memory.html"><a href="models-with-memory.html#post-stratify-to-put-the-p-in-mrp."><i class="fa fa-check"></i><b>13.6.3</b> Post-stratify to put the P in MRP.</a></li>
</ul></li>
<li class="chapter" data-level="13.7" data-path="models-with-memory.html"><a href="models-with-memory.html#practice-10"><i class="fa fa-check"></i><b>13.7</b> Practice</a>
<ul>
<li class="chapter" data-level="13.7.1" data-path="models-with-memory.html"><a href="models-with-memory.html#m1-7"><i class="fa fa-check"></i><b>13.7.1</b> 13M1</a></li>
<li class="chapter" data-level="13.7.2" data-path="models-with-memory.html"><a href="models-with-memory.html#m2-7"><i class="fa fa-check"></i><b>13.7.2</b> 13M2</a></li>
<li class="chapter" data-level="13.7.3" data-path="models-with-memory.html"><a href="models-with-memory.html#m3-4"><i class="fa fa-check"></i><b>13.7.3</b> 13M3</a></li>
<li class="chapter" data-level="13.7.4" data-path="models-with-memory.html"><a href="models-with-memory.html#m4-6"><i class="fa fa-check"></i><b>13.7.4</b> 13M4</a></li>
<li class="chapter" data-level="13.7.5" data-path="models-with-memory.html"><a href="models-with-memory.html#m5-3"><i class="fa fa-check"></i><b>13.7.5</b> 13M5</a></li>
<li class="chapter" data-level="13.7.6" data-path="models-with-memory.html"><a href="models-with-memory.html#m6-2"><i class="fa fa-check"></i><b>13.7.6</b> 13M6</a></li>
<li class="chapter" data-level="13.7.7" data-path="models-with-memory.html"><a href="models-with-memory.html#h1-10"><i class="fa fa-check"></i><b>13.7.7</b> 13H1</a></li>
<li class="chapter" data-level="13.7.8" data-path="models-with-memory.html"><a href="models-with-memory.html#h2-10"><i class="fa fa-check"></i><b>13.7.8</b> 13H2</a></li>
<li class="chapter" data-level="13.7.9" data-path="models-with-memory.html"><a href="models-with-memory.html#h3-10"><i class="fa fa-check"></i><b>13.7.9</b> 13H3</a></li>
<li class="chapter" data-level="13.7.10" data-path="models-with-memory.html"><a href="models-with-memory.html#h4-10"><i class="fa fa-check"></i><b>13.7.10</b> 13H4</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="14" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html"><i class="fa fa-check"></i><b>14</b> Adventures in Covariance</a>
<ul>
<li class="chapter" data-level="14.1" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#varying-slopes-by-construction"><i class="fa fa-check"></i><b>14.1</b> Varying slopes by construction</a>
<ul>
<li class="chapter" data-level="14.1.1" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#simulate-and-population"><i class="fa fa-check"></i><b>14.1.1</b> Simulate and population</a></li>
<li class="chapter" data-level="14.1.2" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#simulate-observation"><i class="fa fa-check"></i><b>14.1.2</b> Simulate observation</a></li>
<li class="chapter" data-level="14.1.3" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#the-varying-slope-model"><i class="fa fa-check"></i><b>14.1.3</b> The varying slope model</a></li>
</ul></li>
<li class="chapter" data-level="14.2" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#advanced-varing-slopes"><i class="fa fa-check"></i><b>14.2</b> Advanced varing slopes</a></li>
<li class="chapter" data-level="14.3" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#instruments-and-causal-designs"><i class="fa fa-check"></i><b>14.3</b> Instruments and causal designs</a>
<ul>
<li class="chapter" data-level="14.3.1" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#instrumental-variables"><i class="fa fa-check"></i><b>14.3.1</b> Instrumental variables</a></li>
<li class="chapter" data-level="14.3.2" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#other-designs"><i class="fa fa-check"></i><b>14.3.2</b> Other designs</a></li>
</ul></li>
<li class="chapter" data-level="14.4" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#social-relations-as-correlated-varying-effects"><i class="fa fa-check"></i><b>14.4</b> Social relations as correlated varying effects</a></li>
<li class="chapter" data-level="14.5" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#continuous-categories-and-the-gaussian-process"><i class="fa fa-check"></i><b>14.5</b> Continuous categories and the Gaussian process</a>
<ul>
<li class="chapter" data-level="14.5.1" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#example-spatial-autocorrelation-in-oceanic-tools"><i class="fa fa-check"></i><b>14.5.1</b> Example: Spatial autocorrelation in Oceanic tools</a></li>
<li class="chapter" data-level="14.5.2" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#example-phylogenetic-distance"><i class="fa fa-check"></i><b>14.5.2</b> Example: Phylogenetic distance</a></li>
</ul></li>
<li class="chapter" data-level="14.6" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#practice-11"><i class="fa fa-check"></i><b>14.6</b> Practice</a>
<ul>
<li class="chapter" data-level="14.6.1" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#m1-8"><i class="fa fa-check"></i><b>14.6.1</b> 14M1</a></li>
<li class="chapter" data-level="14.6.2" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#m2-8"><i class="fa fa-check"></i><b>14.6.2</b> 14M2</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="実行環境.html"><a href="実行環境.html"><i class="fa fa-check"></i>実行環境</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Statistical Rethinking Second Edition</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="the-many-variables-the-spurious-waffles" class="section level1 hasAnchor" number="5">
<h1><span class="header-section-number">5</span> The many variables &amp; the spurious waffles<a href="the-many-variables-the-spurious-waffles.html#the-many-variables-the-spurious-waffles" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div id="spurious-association" class="section level2 hasAnchor" number="5.1">
<h2><span class="header-section-number">5.1</span> Spurious association<a href="the-many-variables-the-spurious-waffles.html#spurious-association" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>結婚率と離婚率の間の因果関係を推論する。<br />
結婚率と離婚率は正に相関するが、これは因果関係を表すだろうか？<br />
<br /></p>
<div class="sourceCode" id="cb279"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb279-1"><a href="the-many-variables-the-spurious-waffles.html#cb279-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(WaffleDivorce)</span>
<span id="cb279-2"><a href="the-many-variables-the-spurious-waffles.html#cb279-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb279-3"><a href="the-many-variables-the-spurious-waffles.html#cb279-3" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> WaffleDivorce</span>
<span id="cb279-4"><a href="the-many-variables-the-spurious-waffles.html#cb279-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb279-5"><a href="the-many-variables-the-spurious-waffles.html#cb279-5" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(d)</span></code></pre></div>
<pre><code>##     Location Loc Population MedianAgeMarriage Marriage Marriage.SE Divorce
## 1    Alabama  AL       4.78              25.3     20.2        1.27    12.7
## 2     Alaska  AK       0.71              25.2     26.0        2.93    12.5
## 3    Arizona  AZ       6.33              25.8     20.3        0.98    10.8
## 4   Arkansas  AR       2.92              24.3     26.4        1.70    13.5
## 5 California  CA      37.25              26.8     19.1        0.39     8.0
## 6   Colorado  CO       5.03              25.7     23.5        1.24    11.6
##   Divorce.SE WaffleHouses South Slaves1860 Population1860 PropSlaves1860
## 1       0.79          128     1     435080         964201           0.45
## 2       2.05            0     0          0              0           0.00
## 3       0.74           18     0          0              0           0.00
## 4       1.22           41     1     111115         435450           0.26
## 5       0.24            0     0          0         379994           0.00
## 6       0.94           11     0          0          34277           0.00</code></pre>
<p>ちなみにWaffleHouseの店舗数と離婚率の関係</p>
<div class="sourceCode" id="cb281"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb281-1"><a href="the-many-variables-the-spurious-waffles.html#cb281-1" aria-hidden="true" tabindex="-1"></a>d <span class="sc">%&gt;%</span> </span>
<span id="cb281-2"><a href="the-many-variables-the-spurious-waffles.html#cb281-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>WaffleHouses<span class="sc">/</span>Population, <span class="at">y =</span> Divorce))<span class="sc">+</span></span>
<span id="cb281-3"><a href="the-many-variables-the-spurious-waffles.html#cb281-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size=</span><span class="dv">2</span>,<span class="at">color =</span> <span class="st">&quot;navyblue&quot;</span>,<span class="at">shape=</span><span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb281-4"><a href="the-many-variables-the-spurious-waffles.html#cb281-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text_repel</span>(<span class="fu">aes</span>(<span class="at">label=</span>Loc),<span class="at">color=</span><span class="st">&quot;black&quot;</span>,<span class="at">size=</span><span class="dv">3</span>)<span class="sc">+</span></span>
<span id="cb281-5"><a href="the-many-variables-the-spurious-waffles.html#cb281-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">&quot;lm&quot;</span>,<span class="at">color=</span><span class="st">&quot;black&quot;</span>,<span class="at">size=</span><span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb281-6"><a href="the-many-variables-the-spurious-waffles.html#cb281-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb281-7"><a href="the-many-variables-the-spurious-waffles.html#cb281-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb281-8"><a href="the-many-variables-the-spurious-waffles.html#cb281-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">aspect.ratio =</span> <span class="fl">0.8</span>)</span></code></pre></div>
<p><img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-126-1.png" width="672" style="display: block; margin: auto;" />
<br /></p>
<p><strong>離婚率</strong>と<strong>結婚率</strong>、<strong>結婚年齢</strong>の関係を考える。</p>
<div class="sourceCode" id="cb282"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb282-1"><a href="the-many-variables-the-spurious-waffles.html#cb282-1" aria-hidden="true" tabindex="-1"></a>d <span class="sc">%&gt;%</span> </span>
<span id="cb282-2"><a href="the-many-variables-the-spurious-waffles.html#cb282-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>Marriage,<span class="at">y=</span>Divorce))<span class="sc">+</span></span>
<span id="cb282-3"><a href="the-many-variables-the-spurious-waffles.html#cb282-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size=</span><span class="dv">3</span>,<span class="at">shape=</span><span class="dv">1</span>,<span class="at">color=</span><span class="st">&quot;navyblue&quot;</span>)<span class="sc">+</span></span>
<span id="cb282-4"><a href="the-many-variables-the-spurious-waffles.html#cb282-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">&quot;lm&quot;</span>,<span class="at">color=</span><span class="st">&quot;black&quot;</span>,<span class="at">size=</span><span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb282-5"><a href="the-many-variables-the-spurious-waffles.html#cb282-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb282-6"><a href="the-many-variables-the-spurious-waffles.html#cb282-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb282-7"><a href="the-many-variables-the-spurious-waffles.html#cb282-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">aspect.ratio =</span> <span class="fl">0.8</span>)<span class="sc">+</span></span>
<span id="cb282-8"><a href="the-many-variables-the-spurious-waffles.html#cb282-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;Marriage rate&quot;</span>)<span class="sc">+</span></span>
<span id="cb282-9"><a href="the-many-variables-the-spurious-waffles.html#cb282-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Divorce rate&quot;</span>) <span class="ot">-&gt;</span> p1</span>
<span id="cb282-10"><a href="the-many-variables-the-spurious-waffles.html#cb282-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb282-11"><a href="the-many-variables-the-spurious-waffles.html#cb282-11" aria-hidden="true" tabindex="-1"></a>d <span class="sc">%&gt;%</span> </span>
<span id="cb282-12"><a href="the-many-variables-the-spurious-waffles.html#cb282-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>MedianAgeMarriage,<span class="at">y=</span>Divorce))<span class="sc">+</span></span>
<span id="cb282-13"><a href="the-many-variables-the-spurious-waffles.html#cb282-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size=</span><span class="dv">3</span>,<span class="at">shape=</span><span class="dv">1</span>,<span class="at">color=</span><span class="st">&quot;navyblue&quot;</span>)<span class="sc">+</span></span>
<span id="cb282-14"><a href="the-many-variables-the-spurious-waffles.html#cb282-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">&quot;lm&quot;</span>,<span class="at">color=</span><span class="st">&quot;black&quot;</span>,<span class="at">size=</span><span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb282-15"><a href="the-many-variables-the-spurious-waffles.html#cb282-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb282-16"><a href="the-many-variables-the-spurious-waffles.html#cb282-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb282-17"><a href="the-many-variables-the-spurious-waffles.html#cb282-17" aria-hidden="true" tabindex="-1"></a>        <span class="at">aspect.ratio =</span> <span class="fl">0.8</span>)<span class="sc">+</span></span>
<span id="cb282-18"><a href="the-many-variables-the-spurious-waffles.html#cb282-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;Median age marriage&quot;</span>)<span class="sc">+</span></span>
<span id="cb282-19"><a href="the-many-variables-the-spurious-waffles.html#cb282-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Divorce rate&quot;</span>) <span class="ot">-&gt;</span> p2</span>
<span id="cb282-20"><a href="the-many-variables-the-spurious-waffles.html#cb282-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb282-21"><a href="the-many-variables-the-spurious-waffles.html#cb282-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb282-22"><a href="the-many-variables-the-spurious-waffles.html#cb282-22" aria-hidden="true" tabindex="-1"></a>d <span class="sc">%&gt;%</span> </span>
<span id="cb282-23"><a href="the-many-variables-the-spurious-waffles.html#cb282-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>MedianAgeMarriage,<span class="at">y=</span>Marriage))<span class="sc">+</span></span>
<span id="cb282-24"><a href="the-many-variables-the-spurious-waffles.html#cb282-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size=</span><span class="dv">3</span>,<span class="at">shape=</span><span class="dv">1</span>,<span class="at">color=</span><span class="st">&quot;navyblue&quot;</span>)<span class="sc">+</span></span>
<span id="cb282-25"><a href="the-many-variables-the-spurious-waffles.html#cb282-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">&quot;lm&quot;</span>,<span class="at">color=</span><span class="st">&quot;black&quot;</span>,<span class="at">size=</span><span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb282-26"><a href="the-many-variables-the-spurious-waffles.html#cb282-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb282-27"><a href="the-many-variables-the-spurious-waffles.html#cb282-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb282-28"><a href="the-many-variables-the-spurious-waffles.html#cb282-28" aria-hidden="true" tabindex="-1"></a>        <span class="at">aspect.ratio =</span> <span class="fl">0.8</span>)<span class="sc">+</span></span>
<span id="cb282-29"><a href="the-many-variables-the-spurious-waffles.html#cb282-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;Median age marriage&quot;</span>)<span class="sc">+</span></span>
<span id="cb282-30"><a href="the-many-variables-the-spurious-waffles.html#cb282-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Marriage rate&quot;</span>) <span class="ot">-&gt;</span> p3</span>
<span id="cb282-31"><a href="the-many-variables-the-spurious-waffles.html#cb282-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb282-32"><a href="the-many-variables-the-spurious-waffles.html#cb282-32" aria-hidden="true" tabindex="-1"></a>p1<span class="sc">|</span>p2<span class="sc">|</span>p3</span></code></pre></div>
<p><img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-127-1.png" width="672" style="display: block; margin: auto;" />
<br /></p>
<p>データを標準化する。</p>
<div class="sourceCode" id="cb283"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb283-1"><a href="the-many-variables-the-spurious-waffles.html#cb283-1" aria-hidden="true" tabindex="-1"></a>d <span class="sc">%&gt;%</span> </span>
<span id="cb283-2"><a href="the-many-variables-the-spurious-waffles.html#cb283-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">D =</span> <span class="fu">standardize</span>(Divorce),</span>
<span id="cb283-3"><a href="the-many-variables-the-spurious-waffles.html#cb283-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">M =</span> <span class="fu">standardize</span>(Marriage),</span>
<span id="cb283-4"><a href="the-many-variables-the-spurious-waffles.html#cb283-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">A =</span> <span class="fu">standardize</span>(MedianAgeMarriage)) <span class="ot">-&gt;</span>d</span>
<span id="cb283-5"><a href="the-many-variables-the-spurious-waffles.html#cb283-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb283-6"><a href="the-many-variables-the-spurious-waffles.html#cb283-6" aria-hidden="true" tabindex="-1"></a><span class="co"># ちなみに</span></span>
<span id="cb283-7"><a href="the-many-variables-the-spurious-waffles.html#cb283-7" aria-hidden="true" tabindex="-1"></a><span class="fu">sd</span>(d<span class="sc">$</span>Divorce)</span></code></pre></div>
<pre><code>## [1] 1.820814</code></pre>
<div class="sourceCode" id="cb285"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb285-1"><a href="the-many-variables-the-spurious-waffles.html#cb285-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sd</span>(d<span class="sc">$</span>Marriage)</span></code></pre></div>
<pre><code>## [1] 3.797905</code></pre>
<div class="sourceCode" id="cb287"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb287-1"><a href="the-many-variables-the-spurious-waffles.html#cb287-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sd</span>(d<span class="sc">$</span>MedianAgeMarriage)</span></code></pre></div>
<pre><code>## [1] 1.24363</code></pre>
<p><br /></p>
<p>まずは、離婚率と結婚年齢の関係を考える。<br />
以下のモデルを考える。</p>
<p><span class="math inline">\(D_{i} \sim Normal(\mu_{i}, \sigma)\)</span><br />
<span class="math inline">\(\mu_{i} \sim \alpha + \beta_{A}A_{i}\)</span><br />
<span class="math inline">\(\alpha \sim Normal(0, 0.2)\)</span><br />
<span class="math inline">\(\beta_{A} \sim Normal(0, 0.05)\)</span><br />
<span class="math inline">\(\sigma \sim Exponential(1)\)</span></p>
<p><br /></p>
<p>モデルを書く。</p>
<div class="sourceCode" id="cb289"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb289-1"><a href="the-many-variables-the-spurious-waffles.html#cb289-1" aria-hidden="true" tabindex="-1"></a>b5<span class="fl">.1</span> <span class="ot">&lt;-</span> </span>
<span id="cb289-2"><a href="the-many-variables-the-spurious-waffles.html#cb289-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">brm</span>(<span class="at">data =</span> d,</span>
<span id="cb289-3"><a href="the-many-variables-the-spurious-waffles.html#cb289-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> gaussian,</span>
<span id="cb289-4"><a href="the-many-variables-the-spurious-waffles.html#cb289-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">formula =</span> D <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> A,</span>
<span id="cb289-5"><a href="the-many-variables-the-spurious-waffles.html#cb289-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>,<span class="fl">0.2</span>),<span class="at">class=</span>Intercept),</span>
<span id="cb289-6"><a href="the-many-variables-the-spurious-waffles.html#cb289-6" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>,<span class="fl">0.5</span>),<span class="at">class=</span>b),</span>
<span id="cb289-7"><a href="the-many-variables-the-spurious-waffles.html#cb289-7" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>),<span class="at">class=</span>sigma)),</span>
<span id="cb289-8"><a href="the-many-variables-the-spurious-waffles.html#cb289-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">seed =</span> <span class="dv">5</span>, <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>,</span>
<span id="cb289-9"><a href="the-many-variables-the-spurious-waffles.html#cb289-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">sample_prior =</span> T,</span>
<span id="cb289-10"><a href="the-many-variables-the-spurious-waffles.html#cb289-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">backend =</span> <span class="st">&quot;cmdstanr&quot;</span>,</span>
<span id="cb289-11"><a href="the-many-variables-the-spurious-waffles.html#cb289-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">file =</span> <span class="st">&quot;output/Chapter5/b5.1&quot;</span>)</span>
<span id="cb289-12"><a href="the-many-variables-the-spurious-waffles.html#cb289-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb289-13"><a href="the-many-variables-the-spurious-waffles.html#cb289-13" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(b5<span class="fl">.1</span>)</span></code></pre></div>
<pre><code>##  Family: gaussian 
##   Links: mu = identity; sigma = identity 
## Formula: D ~ 1 + A 
##    Data: d (Number of observations: 50) 
##   Draws: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
##          total post-warmup draws = 4000
## 
## Population-Level Effects: 
##           Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## Intercept    -0.00      0.10    -0.19     0.20 1.00     4144     3159
## A            -0.57      0.12    -0.80    -0.33 1.00     4041     3081
## 
## Family Specific Parameters: 
##       Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## sigma     0.82      0.08     0.68     1.00 1.00     3748     3033
## 
## Draws were sampled using sample(hmc). For each parameter, Bulk_ESS
## and Tail_ESS are effective sample size measures, and Rhat is the potential
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<p><br /></p>
<p>事前分布からのサンプリングを行う。</p>
<div class="sourceCode" id="cb291"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb291-1"><a href="the-many-variables-the-spurious-waffles.html#cb291-1" aria-hidden="true" tabindex="-1"></a>prior_51 <span class="ot">&lt;-</span> <span class="fu">prior_samples</span>(b5<span class="fl">.1</span>)</span>
<span id="cb291-2"><a href="the-many-variables-the-spurious-waffles.html#cb291-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(prior_51)</span></code></pre></div>
<pre><code>##   Intercept          b    sigma
## 1  0.149090 -0.1981440 2.554740
## 2 -0.303870 -0.0584441 1.322460
## 3 -0.127389 -0.1347680 0.711124
## 4  0.114389 -0.5152620 0.860517
## 5  0.127717 -0.1790560 0.729930
## 6  0.290030 -0.1961800 0.332693</code></pre>
<div class="sourceCode" id="cb293"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb293-1"><a href="the-many-variables-the-spurious-waffles.html#cb293-1" aria-hidden="true" tabindex="-1"></a>prior_51 <span class="sc">%&gt;%</span> </span>
<span id="cb293-2"><a href="the-many-variables-the-spurious-waffles.html#cb293-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb293-3"><a href="the-many-variables-the-spurious-waffles.html#cb293-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_sample</span>(<span class="at">n=</span><span class="dv">50</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb293-4"><a href="the-many-variables-the-spurious-waffles.html#cb293-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>(<span class="st">&quot;draw&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb293-5"><a href="the-many-variables-the-spurious-waffles.html#cb293-5" aria-hidden="true" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">expand</span>(<span class="fu">nesting</span>(draw,Intercept,b),</span>
<span id="cb293-6"><a href="the-many-variables-the-spurious-waffles.html#cb293-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">a=</span><span class="fu">c</span>(<span class="sc">-</span><span class="dv">2</span>,<span class="dv">2</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb293-7"><a href="the-many-variables-the-spurious-waffles.html#cb293-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">d =</span> Intercept <span class="sc">+</span> b<span class="sc">*</span>a) <span class="ot">-&gt;</span> prior_51</span>
<span id="cb293-8"><a href="the-many-variables-the-spurious-waffles.html#cb293-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb293-9"><a href="the-many-variables-the-spurious-waffles.html#cb293-9" aria-hidden="true" tabindex="-1"></a>prior_51 <span class="sc">%&gt;%</span> </span>
<span id="cb293-10"><a href="the-many-variables-the-spurious-waffles.html#cb293-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>a,<span class="at">y=</span>d,<span class="at">group=</span>draw))<span class="sc">+</span></span>
<span id="cb293-11"><a href="the-many-variables-the-spurious-waffles.html#cb293-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>)<span class="sc">+</span></span>
<span id="cb293-12"><a href="the-many-variables-the-spurious-waffles.html#cb293-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="st">&quot;Median age mariage (sd)&quot;</span>,</span>
<span id="cb293-13"><a href="the-many-variables-the-spurious-waffles.html#cb293-13" aria-hidden="true" tabindex="-1"></a>                     <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">2</span>,<span class="dv">2</span>,<span class="at">by=</span><span class="dv">1</span>))<span class="sc">+</span></span>
<span id="cb293-14"><a href="the-many-variables-the-spurious-waffles.html#cb293-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="st">&quot;Divorce rate(std)&quot;</span>,</span>
<span id="cb293-15"><a href="the-many-variables-the-spurious-waffles.html#cb293-15" aria-hidden="true" tabindex="-1"></a>                     <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">2</span>,<span class="dv">2</span>,<span class="at">by=</span><span class="dv">1</span>))<span class="sc">+</span><span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb293-16"><a href="the-many-variables-the-spurious-waffles.html#cb293-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb293-17"><a href="the-many-variables-the-spurious-waffles.html#cb293-17" aria-hidden="true" tabindex="-1"></a>        <span class="at">aspect.ratio =</span> <span class="dv">1</span>)</span></code></pre></div>
<p><img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-130-1.png" width="672" style="display: block; margin: auto;" />
<br /></p>
<p>各パラメータの事後分布は以下の通り。</p>
<div class="sourceCode" id="cb294"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb294-1"><a href="the-many-variables-the-spurious-waffles.html#cb294-1" aria-hidden="true" tabindex="-1"></a>post_51 <span class="ot">&lt;-</span> <span class="fu">posterior_samples</span>(b5<span class="fl">.1</span>)</span>
<span id="cb294-2"><a href="the-many-variables-the-spurious-waffles.html#cb294-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb294-3"><a href="the-many-variables-the-spurious-waffles.html#cb294-3" aria-hidden="true" tabindex="-1"></a><span class="fu">bind_rows</span>(<span class="fu">mean_qi</span>(post_51 <span class="sc">%&gt;%</span> <span class="fu">gather_variables</span>()),</span>
<span id="cb294-4"><a href="the-many-variables-the-spurious-waffles.html#cb294-4" aria-hidden="true" tabindex="-1"></a>          ggdist<span class="sc">::</span><span class="fu">median_hdi</span>(post_51 <span class="sc">%&gt;%</span> <span class="fu">gather_variables</span>())) <span class="sc">%&gt;%</span> </span>
<span id="cb294-5"><a href="the-many-variables-the-spurious-waffles.html#cb294-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>()</span></code></pre></div>
<pre><code>## # A tibble: 17 × 7
##    .variable           .value     .lower  .upper .width .point .interval
##    &lt;chr&gt;                &lt;dbl&gt;      &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;    
##  1 b_A              -0.566     -0.796     -0.333   0.95 mean   qi       
##  2 b_Intercept      -0.000206  -0.194      0.197   0.95 mean   qi       
##  3 lp__            -62.2      -65.5      -60.8     0.95 mean   qi       
##  4 lprior           -1.15      -1.91      -0.629   0.95 mean   qi       
##  5 prior_b           0.00271   -0.974      0.973   0.95 mean   qi       
##  6 prior_Intercept  -0.00110   -0.384      0.395   0.95 mean   qi       
##  7 prior_sigma       0.988      0.0287     3.64    0.95 mean   qi       
##  8 sigma             0.822      0.677      1.00    0.95 mean   qi       
##  9 b_A              -0.566     -0.800     -0.339   0.95 median hdi      
## 10 b_Intercept       0.00111   -0.195      0.196   0.95 median hdi      
## 11 lp__            -61.9      -64.9      -64.7     0.95 median hdi      
## 12 lp__            -61.9      -64.6      -60.7     0.95 median hdi      
## 13 lprior           -1.11      -1.81      -0.560   0.95 median hdi      
## 14 prior_b           0.00554   -0.982      0.944   0.95 median hdi      
## 15 prior_Intercept   0.00329   -0.411      0.365   0.95 median hdi      
## 16 prior_sigma       0.682      0.000585   2.94    0.95 median hdi      
## 17 sigma             0.816      0.675      0.998   0.95 median hdi</code></pre>
<p>事後分布からのサンプリングを行って回帰直線を描く。<br />
結婚年齢が高いほど、離婚率も高いように見える。</p>
<div class="sourceCode" id="cb296"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb296-1"><a href="the-many-variables-the-spurious-waffles.html#cb296-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 信頼区間と予測区間を作図</span></span>
<span id="cb296-2"><a href="the-many-variables-the-spurious-waffles.html#cb296-2" aria-hidden="true" tabindex="-1"></a>A_seq <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">A =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">3</span>,<span class="dv">3</span>,<span class="at">length.out=</span><span class="dv">100</span>)) </span>
<span id="cb296-3"><a href="the-many-variables-the-spurious-waffles.html#cb296-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb296-4"><a href="the-many-variables-the-spurious-waffles.html#cb296-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb296-5"><a href="the-many-variables-the-spurious-waffles.html#cb296-5" aria-hidden="true" tabindex="-1"></a>fit_51 <span class="ot">&lt;-</span> <span class="fu">fitted</span>(b5<span class="fl">.1</span>, <span class="at">newdata =</span> A_seq) <span class="sc">%&gt;%</span> </span>
<span id="cb296-6"><a href="the-many-variables-the-spurious-waffles.html#cb296-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb296-7"><a href="the-many-variables-the-spurious-waffles.html#cb296-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(A_seq)</span>
<span id="cb296-8"><a href="the-many-variables-the-spurious-waffles.html#cb296-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb296-9"><a href="the-many-variables-the-spurious-waffles.html#cb296-9" aria-hidden="true" tabindex="-1"></a>predict_51 <span class="ot">&lt;-</span> <span class="fu">predict</span>(b5<span class="fl">.1</span>, <span class="at">newdata =</span> A_seq) <span class="sc">%&gt;%</span> </span>
<span id="cb296-10"><a href="the-many-variables-the-spurious-waffles.html#cb296-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb296-11"><a href="the-many-variables-the-spurious-waffles.html#cb296-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(A_seq)</span>
<span id="cb296-12"><a href="the-many-variables-the-spurious-waffles.html#cb296-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb296-13"><a href="the-many-variables-the-spurious-waffles.html#cb296-13" aria-hidden="true" tabindex="-1"></a>d <span class="sc">%&gt;%</span> </span>
<span id="cb296-14"><a href="the-many-variables-the-spurious-waffles.html#cb296-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>A,<span class="at">y=</span>D))<span class="sc">+</span></span>
<span id="cb296-15"><a href="the-many-variables-the-spurious-waffles.html#cb296-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size=</span><span class="dv">3</span>,<span class="at">alpha=</span><span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>,<span class="at">shape=</span><span class="dv">1</span>,</span>
<span id="cb296-16"><a href="the-many-variables-the-spurious-waffles.html#cb296-16" aria-hidden="true" tabindex="-1"></a>             <span class="at">color=</span><span class="st">&quot;navyblue&quot;</span>)<span class="sc">+</span></span>
<span id="cb296-17"><a href="the-many-variables-the-spurious-waffles.html#cb296-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="at">data =</span> fit_51,<span class="fu">aes</span>(<span class="at">y =</span> Estimate,</span>
<span id="cb296-18"><a href="the-many-variables-the-spurious-waffles.html#cb296-18" aria-hidden="true" tabindex="-1"></a>                                <span class="at">ymin =</span> Q2<span class="fl">.5</span>,</span>
<span id="cb296-19"><a href="the-many-variables-the-spurious-waffles.html#cb296-19" aria-hidden="true" tabindex="-1"></a>                                <span class="at">ymax  =</span> Q97<span class="fl">.5</span>),</span>
<span id="cb296-20"><a href="the-many-variables-the-spurious-waffles.html#cb296-20" aria-hidden="true" tabindex="-1"></a>              <span class="at">fill =</span> <span class="st">&quot;black&quot;</span>, <span class="at">alpha =</span> <span class="dv">3</span><span class="sc">/</span><span class="dv">8</span>)<span class="sc">+</span></span>
<span id="cb296-21"><a href="the-many-variables-the-spurious-waffles.html#cb296-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="at">data =</span> predict_51,<span class="fu">aes</span>(<span class="at">y =</span> Estimate,</span>
<span id="cb296-22"><a href="the-many-variables-the-spurious-waffles.html#cb296-22" aria-hidden="true" tabindex="-1"></a>                                <span class="at">ymin =</span> Q2<span class="fl">.5</span>,</span>
<span id="cb296-23"><a href="the-many-variables-the-spurious-waffles.html#cb296-23" aria-hidden="true" tabindex="-1"></a>                                <span class="at">ymax  =</span> Q97<span class="fl">.5</span>),</span>
<span id="cb296-24"><a href="the-many-variables-the-spurious-waffles.html#cb296-24" aria-hidden="true" tabindex="-1"></a>              <span class="at">fill =</span> <span class="st">&quot;black&quot;</span>, <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">8</span>)<span class="sc">+</span></span>
<span id="cb296-25"><a href="the-many-variables-the-spurious-waffles.html#cb296-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> predict_51,<span class="fu">aes</span>(<span class="at">y =</span> Estimate,</span>
<span id="cb296-26"><a href="the-many-variables-the-spurious-waffles.html#cb296-26" aria-hidden="true" tabindex="-1"></a>                                <span class="at">x =</span> A))<span class="sc">+</span></span>
<span id="cb296-27"><a href="the-many-variables-the-spurious-waffles.html#cb296-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="st">&quot;Median age mariage (sd)&quot;</span>,</span>
<span id="cb296-28"><a href="the-many-variables-the-spurious-waffles.html#cb296-28" aria-hidden="true" tabindex="-1"></a>                     <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">3</span>,<span class="dv">3</span>,<span class="at">by=</span><span class="dv">1</span>))<span class="sc">+</span></span>
<span id="cb296-29"><a href="the-many-variables-the-spurious-waffles.html#cb296-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="st">&quot;Divorce rate(std)&quot;</span>,</span>
<span id="cb296-30"><a href="the-many-variables-the-spurious-waffles.html#cb296-30" aria-hidden="true" tabindex="-1"></a>                     <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">3</span>,<span class="dv">3</span>,<span class="at">by=</span><span class="dv">1</span>))<span class="sc">+</span><span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb296-31"><a href="the-many-variables-the-spurious-waffles.html#cb296-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb296-32"><a href="the-many-variables-the-spurious-waffles.html#cb296-32" aria-hidden="true" tabindex="-1"></a>        <span class="at">aspect.ratio =</span> <span class="dv">1</span>) <span class="ot">-&gt;</span>p1</span>
<span id="cb296-33"><a href="the-many-variables-the-spurious-waffles.html#cb296-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb296-34"><a href="the-many-variables-the-spurious-waffles.html#cb296-34" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(p1)</span></code></pre></div>
<p><img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-132-1.png" width="672" style="display: block; margin: auto;" />
<br /></p>
<p>結婚率と離婚率に関しても同様に分析。</p>
<p><span class="math inline">\(D_{i} \sim Normal(\mu_{i}, \sigma)\)</span><br />
<span class="math inline">\(\mu_{i} \sim \alpha + \beta_{M}M_{i}\)</span><br />
<span class="math inline">\(\alpha \sim Normal(0, 0.2)\)</span><br />
<span class="math inline">\(\beta_{M} \sim Normal(0, 0.05)\)</span><br />
<span class="math inline">\(\sigma \sim Exponential(1)\)</span></p>
<div class="sourceCode" id="cb297"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb297-1"><a href="the-many-variables-the-spurious-waffles.html#cb297-1" aria-hidden="true" tabindex="-1"></a>b5<span class="fl">.2</span> <span class="ot">&lt;-</span> </span>
<span id="cb297-2"><a href="the-many-variables-the-spurious-waffles.html#cb297-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">brm</span>(<span class="at">data =</span> d,</span>
<span id="cb297-3"><a href="the-many-variables-the-spurious-waffles.html#cb297-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> gaussian,</span>
<span id="cb297-4"><a href="the-many-variables-the-spurious-waffles.html#cb297-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">formula =</span> D <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> M,</span>
<span id="cb297-5"><a href="the-many-variables-the-spurious-waffles.html#cb297-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>,<span class="fl">0.2</span>),<span class="at">class=</span>Intercept),</span>
<span id="cb297-6"><a href="the-many-variables-the-spurious-waffles.html#cb297-6" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>,<span class="fl">0.5</span>),<span class="at">class=</span>b),</span>
<span id="cb297-7"><a href="the-many-variables-the-spurious-waffles.html#cb297-7" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>),<span class="at">class=</span>sigma)),</span>
<span id="cb297-8"><a href="the-many-variables-the-spurious-waffles.html#cb297-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">seed =</span> <span class="dv">5</span>, <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>,</span>
<span id="cb297-9"><a href="the-many-variables-the-spurious-waffles.html#cb297-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">sample_prior =</span> T,</span>
<span id="cb297-10"><a href="the-many-variables-the-spurious-waffles.html#cb297-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">backend =</span> <span class="st">&quot;cmdstanr&quot;</span>,</span>
<span id="cb297-11"><a href="the-many-variables-the-spurious-waffles.html#cb297-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">file =</span> <span class="st">&quot;output/Chapter5/b5.2&quot;</span>)</span>
<span id="cb297-12"><a href="the-many-variables-the-spurious-waffles.html#cb297-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb297-13"><a href="the-many-variables-the-spurious-waffles.html#cb297-13" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(b5<span class="fl">.2</span>)</span></code></pre></div>
<pre><code>##  Family: gaussian 
##   Links: mu = identity; sigma = identity 
## Formula: D ~ 1 + M 
##    Data: d (Number of observations: 50) 
##   Draws: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
##          total post-warmup draws = 4000
## 
## Population-Level Effects: 
##           Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## Intercept    -0.00      0.11    -0.23     0.23 1.00     4074     2793
## M             0.35      0.13     0.08     0.60 1.00     3732     2675
## 
## Family Specific Parameters: 
##       Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## sigma     0.95      0.10     0.78     1.16 1.00     3665     2913
## 
## Draws were sampled using sample(hmc). For each parameter, Bulk_ESS
## and Tail_ESS are effective sample size measures, and Rhat is the potential
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<p><br /></p>
<p>事後分布からのサンプリングを行って回帰直線を描く。<br />
結婚率が高いほど、離婚率も高いように見える。</p>
<div class="sourceCode" id="cb299"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb299-1"><a href="the-many-variables-the-spurious-waffles.html#cb299-1" aria-hidden="true" tabindex="-1"></a>post_52 <span class="ot">&lt;-</span> <span class="fu">posterior_samples</span>(b5<span class="fl">.2</span>)</span>
<span id="cb299-2"><a href="the-many-variables-the-spurious-waffles.html#cb299-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb299-3"><a href="the-many-variables-the-spurious-waffles.html#cb299-3" aria-hidden="true" tabindex="-1"></a><span class="fu">bind_rows</span>(<span class="fu">mean_qi</span>(post_52 <span class="sc">%&gt;%</span> <span class="fu">gather_variables</span>()),</span>
<span id="cb299-4"><a href="the-many-variables-the-spurious-waffles.html#cb299-4" aria-hidden="true" tabindex="-1"></a>          <span class="fu">median_hdi</span>(post_52 <span class="sc">%&gt;%</span> <span class="fu">gather_variables</span>())) <span class="sc">%&gt;%</span> </span>
<span id="cb299-5"><a href="the-many-variables-the-spurious-waffles.html#cb299-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>()</span></code></pre></div>
<pre><code>## # A tibble: 16 × 7
##    .variable            .value     .lower  .upper .width .point .interval
##    &lt;chr&gt;                 &lt;dbl&gt;      &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;    
##  1 b_Intercept      -0.0000870  -0.230      0.227   0.95 mean   qi       
##  2 b_M               0.348       0.0775     0.600   0.95 mean   qi       
##  3 lp__            -69.0       -72.3      -67.6     0.95 mean   qi       
##  4 lprior           -0.922      -1.74      -0.494   0.95 mean   qi       
##  5 prior_b          -0.0136     -0.971      0.966   0.95 mean   qi       
##  6 prior_Intercept   0.00628    -0.397      0.384   0.95 mean   qi       
##  7 prior_sigma       0.992       0.0237     3.79    0.95 mean   qi       
##  8 sigma             0.951       0.781      1.16    0.95 mean   qi       
##  9 b_Intercept      -0.000115   -0.217      0.233   0.95 median hdi      
## 10 b_M               0.349       0.101      0.623   0.95 median hdi      
## 11 lp__            -68.7       -71.6      -67.5     0.95 median hdi      
## 12 lprior           -0.851      -1.54      -0.427   0.95 median hdi      
## 13 prior_b          -0.0162     -0.947      0.982   0.95 median hdi      
## 14 prior_Intercept   0.0109     -0.372      0.401   0.95 median hdi      
## 15 prior_sigma       0.683       0.000108   2.96    0.95 median hdi      
## 16 sigma             0.942       0.770      1.15    0.95 median hdi</code></pre>
<div class="sourceCode" id="cb301"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb301-1"><a href="the-many-variables-the-spurious-waffles.html#cb301-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 信頼区間と予測区間を作図</span></span>
<span id="cb301-2"><a href="the-many-variables-the-spurious-waffles.html#cb301-2" aria-hidden="true" tabindex="-1"></a>M_seq <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">M =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">3</span>,<span class="dv">3</span>,<span class="at">length.out=</span><span class="dv">100</span>)) </span>
<span id="cb301-3"><a href="the-many-variables-the-spurious-waffles.html#cb301-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb301-4"><a href="the-many-variables-the-spurious-waffles.html#cb301-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb301-5"><a href="the-many-variables-the-spurious-waffles.html#cb301-5" aria-hidden="true" tabindex="-1"></a>fit_52 <span class="ot">&lt;-</span> <span class="fu">fitted</span>(b5<span class="fl">.2</span>, <span class="at">newdata =</span> M_seq) <span class="sc">%&gt;%</span> </span>
<span id="cb301-6"><a href="the-many-variables-the-spurious-waffles.html#cb301-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb301-7"><a href="the-many-variables-the-spurious-waffles.html#cb301-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(M_seq)</span>
<span id="cb301-8"><a href="the-many-variables-the-spurious-waffles.html#cb301-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb301-9"><a href="the-many-variables-the-spurious-waffles.html#cb301-9" aria-hidden="true" tabindex="-1"></a>predict_52 <span class="ot">&lt;-</span> <span class="fu">predict</span>(b5<span class="fl">.2</span>, <span class="at">newdata =</span> M_seq) <span class="sc">%&gt;%</span> </span>
<span id="cb301-10"><a href="the-many-variables-the-spurious-waffles.html#cb301-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb301-11"><a href="the-many-variables-the-spurious-waffles.html#cb301-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(M_seq)</span>
<span id="cb301-12"><a href="the-many-variables-the-spurious-waffles.html#cb301-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb301-13"><a href="the-many-variables-the-spurious-waffles.html#cb301-13" aria-hidden="true" tabindex="-1"></a>d <span class="sc">%&gt;%</span> </span>
<span id="cb301-14"><a href="the-many-variables-the-spurious-waffles.html#cb301-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>M,<span class="at">y=</span>D))<span class="sc">+</span></span>
<span id="cb301-15"><a href="the-many-variables-the-spurious-waffles.html#cb301-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size=</span><span class="dv">3</span>,<span class="at">alpha=</span><span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>,<span class="at">shape=</span><span class="dv">1</span>,</span>
<span id="cb301-16"><a href="the-many-variables-the-spurious-waffles.html#cb301-16" aria-hidden="true" tabindex="-1"></a>             <span class="at">color=</span><span class="st">&quot;navyblue&quot;</span>)<span class="sc">+</span></span>
<span id="cb301-17"><a href="the-many-variables-the-spurious-waffles.html#cb301-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="at">data =</span> fit_52,<span class="fu">aes</span>(<span class="at">y =</span> Estimate,</span>
<span id="cb301-18"><a href="the-many-variables-the-spurious-waffles.html#cb301-18" aria-hidden="true" tabindex="-1"></a>                                <span class="at">ymin =</span> Q2<span class="fl">.5</span>,</span>
<span id="cb301-19"><a href="the-many-variables-the-spurious-waffles.html#cb301-19" aria-hidden="true" tabindex="-1"></a>                                <span class="at">ymax  =</span> Q97<span class="fl">.5</span>),</span>
<span id="cb301-20"><a href="the-many-variables-the-spurious-waffles.html#cb301-20" aria-hidden="true" tabindex="-1"></a>              <span class="at">fill =</span> <span class="st">&quot;black&quot;</span>, <span class="at">alpha =</span> <span class="dv">3</span><span class="sc">/</span><span class="dv">8</span>)<span class="sc">+</span></span>
<span id="cb301-21"><a href="the-many-variables-the-spurious-waffles.html#cb301-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="at">data =</span> predict_52,<span class="fu">aes</span>(<span class="at">y =</span> Estimate,</span>
<span id="cb301-22"><a href="the-many-variables-the-spurious-waffles.html#cb301-22" aria-hidden="true" tabindex="-1"></a>                                <span class="at">ymin =</span> Q2<span class="fl">.5</span>,</span>
<span id="cb301-23"><a href="the-many-variables-the-spurious-waffles.html#cb301-23" aria-hidden="true" tabindex="-1"></a>                                <span class="at">ymax  =</span> Q97<span class="fl">.5</span>),</span>
<span id="cb301-24"><a href="the-many-variables-the-spurious-waffles.html#cb301-24" aria-hidden="true" tabindex="-1"></a>              <span class="at">fill =</span> <span class="st">&quot;black&quot;</span>, <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">8</span>)<span class="sc">+</span></span>
<span id="cb301-25"><a href="the-many-variables-the-spurious-waffles.html#cb301-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> predict_52,<span class="fu">aes</span>(<span class="at">y =</span> Estimate,</span>
<span id="cb301-26"><a href="the-many-variables-the-spurious-waffles.html#cb301-26" aria-hidden="true" tabindex="-1"></a>                                <span class="at">x =</span> M))<span class="sc">+</span></span>
<span id="cb301-27"><a href="the-many-variables-the-spurious-waffles.html#cb301-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="st">&quot;Mariage rate (sd)&quot;</span>,</span>
<span id="cb301-28"><a href="the-many-variables-the-spurious-waffles.html#cb301-28" aria-hidden="true" tabindex="-1"></a>                     <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">3</span>,<span class="dv">3</span>,<span class="at">by=</span><span class="dv">1</span>))<span class="sc">+</span></span>
<span id="cb301-29"><a href="the-many-variables-the-spurious-waffles.html#cb301-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="st">&quot;Divorce rate(std)&quot;</span>,</span>
<span id="cb301-30"><a href="the-many-variables-the-spurious-waffles.html#cb301-30" aria-hidden="true" tabindex="-1"></a>                     <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">3</span>,<span class="dv">3</span>,<span class="at">by=</span><span class="dv">1</span>))<span class="sc">+</span><span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb301-31"><a href="the-many-variables-the-spurious-waffles.html#cb301-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb301-32"><a href="the-many-variables-the-spurious-waffles.html#cb301-32" aria-hidden="true" tabindex="-1"></a>        <span class="at">aspect.ratio =</span> <span class="dv">1</span>) <span class="ot">-&gt;</span> p2</span>
<span id="cb301-33"><a href="the-many-variables-the-spurious-waffles.html#cb301-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb301-34"><a href="the-many-variables-the-spurious-waffles.html#cb301-34" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(p2)</span></code></pre></div>
<p><img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-134-1.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb302"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb302-1"><a href="the-many-variables-the-spurious-waffles.html#cb302-1" aria-hidden="true" tabindex="-1"></a>p1<span class="sc">|</span>p2</span></code></pre></div>
<p><img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-134-2.png" width="672" style="display: block; margin: auto;" />
<br /></p>
<p>これら両方は因果関係によるものだろうか？<br />
3つの変数の関係をグラフィカルモデルを用いて考える。<br />
<br /></p>
<div id="グラフを用いて因果モデルを考える" class="section level3 hasAnchor" number="5.1.1">
<h3><span class="header-section-number">5.1.1</span> グラフを用いて因果モデルを考える<a href="the-many-variables-the-spurious-waffles.html#グラフを用いて因果モデルを考える" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb303"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb303-1"><a href="the-many-variables-the-spurious-waffles.html#cb303-1" aria-hidden="true" tabindex="-1"></a>dag_coords <span class="ot">&lt;-</span></span>
<span id="cb303-2"><a href="the-many-variables-the-spurious-waffles.html#cb303-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="at">name =</span> <span class="fu">c</span>(<span class="st">&quot;A&quot;</span>, <span class="st">&quot;M&quot;</span>, <span class="st">&quot;D&quot;</span>),</span>
<span id="cb303-3"><a href="the-many-variables-the-spurious-waffles.html#cb303-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">x    =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">2</span>),</span>
<span id="cb303-4"><a href="the-many-variables-the-spurious-waffles.html#cb303-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">y    =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">1</span>))</span>
<span id="cb303-5"><a href="the-many-variables-the-spurious-waffles.html#cb303-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb303-6"><a href="the-many-variables-the-spurious-waffles.html#cb303-6" aria-hidden="true" tabindex="-1"></a>DAG5<span class="fl">.1</span> <span class="ot">&lt;-</span></span>
<span id="cb303-7"><a href="the-many-variables-the-spurious-waffles.html#cb303-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dagify</span>(M <span class="sc">~</span> A,</span>
<span id="cb303-8"><a href="the-many-variables-the-spurious-waffles.html#cb303-8" aria-hidden="true" tabindex="-1"></a>         D <span class="sc">~</span> A <span class="sc">+</span> M,</span>
<span id="cb303-9"><a href="the-many-variables-the-spurious-waffles.html#cb303-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">coords =</span> dag_coords) </span>
<span id="cb303-10"><a href="the-many-variables-the-spurious-waffles.html#cb303-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb303-11"><a href="the-many-variables-the-spurious-waffles.html#cb303-11" aria-hidden="true" tabindex="-1"></a>DAG5<span class="fl">.1</span> <span class="sc">%&gt;%</span> </span>
<span id="cb303-12"><a href="the-many-variables-the-spurious-waffles.html#cb303-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">xend =</span> xend, <span class="at">yend =</span> yend)) <span class="sc">+</span></span>
<span id="cb303-13"><a href="the-many-variables-the-spurious-waffles.html#cb303-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_dag_point</span>(<span class="at">color =</span> <span class="st">&quot;firebrick&quot;</span>, <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">4</span>, <span class="at">size =</span> <span class="dv">15</span>) <span class="sc">+</span></span>
<span id="cb303-14"><a href="the-many-variables-the-spurious-waffles.html#cb303-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_dag_text</span>(<span class="at">color =</span> <span class="st">&quot;firebrick&quot;</span>) <span class="sc">+</span></span>
<span id="cb303-15"><a href="the-many-variables-the-spurious-waffles.html#cb303-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_dag_edges</span>(<span class="at">edge_color =</span> <span class="st">&quot;firebrick&quot;</span>) <span class="sc">+</span></span>
<span id="cb303-16"><a href="the-many-variables-the-spurious-waffles.html#cb303-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="cn">NULL</span>, <span class="at">breaks =</span> <span class="cn">NULL</span>, <span class="at">expand =</span> <span class="fu">c</span>(.<span class="dv">1</span>, .<span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb303-17"><a href="the-many-variables-the-spurious-waffles.html#cb303-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="cn">NULL</span>, <span class="at">breaks =</span> <span class="cn">NULL</span>, <span class="at">expand =</span> <span class="fu">c</span>(.<span class="dv">1</span>, .<span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb303-18"><a href="the-many-variables-the-spurious-waffles.html#cb303-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb303-19"><a href="the-many-variables-the-spurious-waffles.html#cb303-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>()) <span class="ot">-&gt;</span>p4</span></code></pre></div>
<p><br /></p>
<p>2つの因果モデルを考える。</p>
<div class="sourceCode" id="cb304"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb304-1"><a href="the-many-variables-the-spurious-waffles.html#cb304-1" aria-hidden="true" tabindex="-1"></a>DAG5<span class="fl">.2</span> <span class="ot">&lt;-</span></span>
<span id="cb304-2"><a href="the-many-variables-the-spurious-waffles.html#cb304-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dagify</span>(M <span class="sc">~</span> A,</span>
<span id="cb304-3"><a href="the-many-variables-the-spurious-waffles.html#cb304-3" aria-hidden="true" tabindex="-1"></a>         D <span class="sc">~</span> A ,</span>
<span id="cb304-4"><a href="the-many-variables-the-spurious-waffles.html#cb304-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">coords =</span> dag_coords) </span>
<span id="cb304-5"><a href="the-many-variables-the-spurious-waffles.html#cb304-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb304-6"><a href="the-many-variables-the-spurious-waffles.html#cb304-6" aria-hidden="true" tabindex="-1"></a>DAG5<span class="fl">.2</span> <span class="sc">%&gt;%</span> </span>
<span id="cb304-7"><a href="the-many-variables-the-spurious-waffles.html#cb304-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">xend =</span> xend, <span class="at">yend =</span> yend)) <span class="sc">+</span></span>
<span id="cb304-8"><a href="the-many-variables-the-spurious-waffles.html#cb304-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_dag_point</span>(<span class="at">color =</span> <span class="st">&quot;firebrick&quot;</span>, <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">4</span>, <span class="at">size =</span> <span class="dv">15</span>) <span class="sc">+</span></span>
<span id="cb304-9"><a href="the-many-variables-the-spurious-waffles.html#cb304-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_dag_text</span>(<span class="at">color =</span> <span class="st">&quot;firebrick&quot;</span>) <span class="sc">+</span></span>
<span id="cb304-10"><a href="the-many-variables-the-spurious-waffles.html#cb304-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_dag_edges</span>(<span class="at">edge_color =</span> <span class="st">&quot;firebrick&quot;</span>) <span class="sc">+</span></span>
<span id="cb304-11"><a href="the-many-variables-the-spurious-waffles.html#cb304-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="cn">NULL</span>, <span class="at">breaks =</span> <span class="cn">NULL</span>, <span class="at">expand =</span> <span class="fu">c</span>(.<span class="dv">1</span>, .<span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb304-12"><a href="the-many-variables-the-spurious-waffles.html#cb304-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="cn">NULL</span>, <span class="at">breaks =</span> <span class="cn">NULL</span>, <span class="at">expand =</span> <span class="fu">c</span>(.<span class="dv">1</span>, .<span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb304-13"><a href="the-many-variables-the-spurious-waffles.html#cb304-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb304-14"><a href="the-many-variables-the-spurious-waffles.html#cb304-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>()) <span class="ot">-&gt;</span>p5</span>
<span id="cb304-15"><a href="the-many-variables-the-spurious-waffles.html#cb304-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb304-16"><a href="the-many-variables-the-spurious-waffles.html#cb304-16" aria-hidden="true" tabindex="-1"></a>p4<span class="sc">|</span>p5</span></code></pre></div>
<p><img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-136-1.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb305"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb305-1"><a href="the-many-variables-the-spurious-waffles.html#cb305-1" aria-hidden="true" tabindex="-1"></a>d <span class="sc">%&gt;%</span> </span>
<span id="cb305-2"><a href="the-many-variables-the-spurious-waffles.html#cb305-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(D<span class="sc">:</span>A) <span class="sc">%&gt;%</span> </span>
<span id="cb305-3"><a href="the-many-variables-the-spurious-waffles.html#cb305-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cor</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb305-4"><a href="the-many-variables-the-spurious-waffles.html#cb305-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">round</span>(<span class="at">digits=</span><span class="dv">3</span>)</span></code></pre></div>
<pre><code>##        D      M      A
## D  1.000  0.374 -0.597
## M  0.374  1.000 -0.721
## A -0.597 -0.721  1.000</code></pre>
<p><br /></p>
<p>dagittyパッケージを用いて、条件付き独立を調べる。</p>
<div class="sourceCode" id="cb307"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb307-1"><a href="the-many-variables-the-spurious-waffles.html#cb307-1" aria-hidden="true" tabindex="-1"></a><span class="co"># DAG1</span></span>
<span id="cb307-2"><a href="the-many-variables-the-spurious-waffles.html#cb307-2" aria-hidden="true" tabindex="-1"></a>DAG1 <span class="ot">&lt;-</span> <span class="fu">dagitty</span>(<span class="st">&#39;dag{ D &lt;- A -&gt; M -&gt; D}&#39;</span>)  </span>
<span id="cb307-3"><a href="the-many-variables-the-spurious-waffles.html#cb307-3" aria-hidden="true" tabindex="-1"></a><span class="fu">impliedConditionalIndependencies</span>(DAG1)</span>
<span id="cb307-4"><a href="the-many-variables-the-spurious-waffles.html#cb307-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb307-5"><a href="the-many-variables-the-spurious-waffles.html#cb307-5" aria-hidden="true" tabindex="-1"></a><span class="co"># DAG2</span></span>
<span id="cb307-6"><a href="the-many-variables-the-spurious-waffles.html#cb307-6" aria-hidden="true" tabindex="-1"></a>DAG2 <span class="ot">&lt;-</span> <span class="fu">dagitty</span>(<span class="st">&#39;dag{ D &lt;- A -&gt; M }&#39;</span>)</span>
<span id="cb307-7"><a href="the-many-variables-the-spurious-waffles.html#cb307-7" aria-hidden="true" tabindex="-1"></a><span class="fu">impliedConditionalIndependencies</span>(DAG2)</span></code></pre></div>
<pre><code>## D _||_ M | A</code></pre>
<p><br /></p>
<p>DAG1は<strong>どの変数で条件づけたとしても</strong>、それぞれの変数が従属であることを表している。<br />
一方で、DAG2は<strong>Aで条件付けすれば</strong>、MとDは独立であることを示している。<br />
このことを検証するため、以下のモデルを検討する。DAG2が正しければ、<span class="math inline">\(\beta_{M}\)</span>は0になるはずである。</p>
<p><br /></p>
<p><span class="math inline">\(D_{i} \sim Normal(\mu_{i}, \sigma)\)</span><br />
<span class="math inline">\(\mu_{i} \sim \alpha + \beta_{A}A_{i} + \beta_{M}M_{i}\)</span><br />
<span class="math inline">\(\alpha \sim Normal(0, 0.2)\)</span><br />
<span class="math inline">\(\beta_{A} \sim Normal(0, 0.05)\)</span><br />
<span class="math inline">\(\beta_{M} \sim Normal(0, 0.05)\)</span>
<span class="math inline">\(\sigma \sim Exponential(1)\)</span></p>
<p>モデリングする。</p>
<div class="sourceCode" id="cb309"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb309-1"><a href="the-many-variables-the-spurious-waffles.html#cb309-1" aria-hidden="true" tabindex="-1"></a>b5<span class="fl">.3</span> <span class="ot">&lt;-</span> </span>
<span id="cb309-2"><a href="the-many-variables-the-spurious-waffles.html#cb309-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">brm</span>(<span class="at">data =</span>d,</span>
<span id="cb309-3"><a href="the-many-variables-the-spurious-waffles.html#cb309-3" aria-hidden="true" tabindex="-1"></a>            <span class="at">family =</span> gaussian,</span>
<span id="cb309-4"><a href="the-many-variables-the-spurious-waffles.html#cb309-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">formula =</span> D <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> A <span class="sc">+</span> M,</span>
<span id="cb309-5"><a href="the-many-variables-the-spurious-waffles.html#cb309-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">prior=</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>,<span class="fl">0.2</span>),<span class="at">class=</span>Intercept),</span>
<span id="cb309-6"><a href="the-many-variables-the-spurious-waffles.html#cb309-6" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>,<span class="fl">0.5</span>),<span class="at">class=</span>b),</span>
<span id="cb309-7"><a href="the-many-variables-the-spurious-waffles.html#cb309-7" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>),<span class="at">class=</span>sigma)),</span>
<span id="cb309-8"><a href="the-many-variables-the-spurious-waffles.html#cb309-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">seed =</span> <span class="dv">5</span>, <span class="at">iter =</span> <span class="dv">4000</span>, <span class="at">warmup =</span> <span class="dv">3000</span>,</span>
<span id="cb309-9"><a href="the-many-variables-the-spurious-waffles.html#cb309-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">sample_prior =</span> T,</span>
<span id="cb309-10"><a href="the-many-variables-the-spurious-waffles.html#cb309-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">backend =</span> <span class="st">&quot;cmdstanr&quot;</span>,</span>
<span id="cb309-11"><a href="the-many-variables-the-spurious-waffles.html#cb309-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">file =</span> <span class="st">&quot;output/Chapter5/b5.3&quot;</span>)</span></code></pre></div>
<p><br /></p>
<p>結果を見てみると、<span class="math inline">\(\beta_{M}\)</span>はほとんど0に近く、DAG2と一致する。</p>
<div class="sourceCode" id="cb310"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb310-1"><a href="the-many-variables-the-spurious-waffles.html#cb310-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(b5<span class="fl">.3</span>)</span></code></pre></div>
<pre><code>##  Family: gaussian 
##   Links: mu = identity; sigma = identity 
## Formula: D ~ 1 + A + M 
##    Data: d (Number of observations: 50) 
##   Draws: 4 chains, each with iter = 4000; warmup = 3000; thin = 1;
##          total post-warmup draws = 4000
## 
## Population-Level Effects: 
##           Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## Intercept     0.00      0.10    -0.19     0.20 1.00     2839     2372
## A            -0.61      0.16    -0.93    -0.29 1.00     2912     2811
## M            -0.06      0.16    -0.38     0.25 1.00     2883     2865
## 
## Family Specific Parameters: 
##       Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## sigma     0.83      0.09     0.68     1.01 1.00     3662     3119
## 
## Draws were sampled using sample(hmc). For each parameter, Bulk_ESS
## and Tail_ESS are effective sample size measures, and Rhat is the potential
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<div class="sourceCode" id="cb312"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb312-1"><a href="the-many-variables-the-spurious-waffles.html#cb312-1" aria-hidden="true" tabindex="-1"></a>sample_b53 <span class="ot">&lt;-</span>b5<span class="fl">.3</span> <span class="sc">%&gt;%</span> </span>
<span id="cb312-2"><a href="the-many-variables-the-spurious-waffles.html#cb312-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">posterior_samples</span>()</span>
<span id="cb312-3"><a href="the-many-variables-the-spurious-waffles.html#cb312-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb312-4"><a href="the-many-variables-the-spurious-waffles.html#cb312-4" aria-hidden="true" tabindex="-1"></a><span class="fu">pairs</span>(b5<span class="fl">.3</span>)</span></code></pre></div>
<p><img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-139-1.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb313"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb313-1"><a href="the-many-variables-the-spurious-waffles.html#cb313-1" aria-hidden="true" tabindex="-1"></a><span class="fu">bind_rows</span>(<span class="fu">mean_qi</span>(sample_b53 <span class="sc">%&gt;%</span> <span class="fu">gather_variables</span>()),<span class="fu">median_hdi</span>(sample_b53 <span class="sc">%&gt;%</span> <span class="fu">gather_variables</span>())) <span class="sc">%&gt;%</span> </span>
<span id="cb313-2"><a href="the-many-variables-the-spurious-waffles.html#cb313-2" aria-hidden="true" tabindex="-1"></a><span class="fu">data.frame</span>()</span></code></pre></div>
<pre><code>##          .variable        .value        .lower      .upper .width .point
## 1              b_A  -0.608597286  -0.926476750  -0.2875174   0.95   mean
## 2      b_Intercept   0.002119988  -0.192420900   0.2036938   0.95   mean
## 3              b_M  -0.063691753  -0.379385975   0.2517328   0.95   mean
## 4             lp__ -62.858440000 -66.505325000 -61.0215975   0.95   mean
## 5           lprior  -1.567187314  -2.726402750  -0.8577874   0.95   mean
## 6          prior_b  -0.008235822  -0.982618525   0.9799550   0.95   mean
## 7  prior_Intercept  -0.002222847  -0.388412525   0.3990599   0.95   mean
## 8      prior_sigma   0.985647501   0.027099925   3.6812593   0.95   mean
## 9            sigma   0.826615921   0.675801775   1.0126380   0.95   mean
## 10             b_A  -0.611012500  -0.931720000  -0.2942620   0.95 median
## 11     b_Intercept  -0.000616276  -0.193018000   0.2014380   0.95 median
## 12             b_M  -0.062486200  -0.372572000   0.2577620   0.95 median
## 13            lp__ -62.541950000 -65.684100000 -60.8271000   0.95 median
## 14          lprior  -1.484605000  -2.528500000  -0.7534570   0.95 median
## 15         prior_b  -0.003533605  -0.982426000   0.9846340   0.95 median
## 16 prior_Intercept  -0.005888445  -0.396181000   0.3863340   0.95 median
## 17     prior_sigma   0.681631000   0.000231375   2.9564600   0.95 median
## 18           sigma   0.821471000   0.662940000   0.9932160   0.95 median
##    .interval
## 1         qi
## 2         qi
## 3         qi
## 4         qi
## 5         qi
## 6         qi
## 7         qi
## 8         qi
## 9         qi
## 10       hdi
## 11       hdi
## 12       hdi
## 13       hdi
## 14       hdi
## 15       hdi
## 16       hdi
## 17       hdi
## 18       hdi</code></pre>
<p><br ></p>
<p>b5.1~b5.3の結果を比較してみる。</p>
<div class="sourceCode" id="cb315"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb315-1"><a href="the-many-variables-the-spurious-waffles.html#cb315-1" aria-hidden="true" tabindex="-1"></a><span class="fu">bind_cols</span>(</span>
<span id="cb315-2"><a href="the-many-variables-the-spurious-waffles.html#cb315-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">posterior_samples</span>(b5<span class="fl">.1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb315-3"><a href="the-many-variables-the-spurious-waffles.html#cb315-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">transmute</span>(<span class="st">&quot;b5.1_beta[A]&quot;</span> <span class="ot">=</span> b_A),</span>
<span id="cb315-4"><a href="the-many-variables-the-spurious-waffles.html#cb315-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">posterior_samples</span>(b5<span class="fl">.2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb315-5"><a href="the-many-variables-the-spurious-waffles.html#cb315-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">transmute</span>(<span class="st">&quot;b5.2_beta[M]&quot;</span> <span class="ot">=</span> b_M),</span>
<span id="cb315-6"><a href="the-many-variables-the-spurious-waffles.html#cb315-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">posterior_samples</span>(b5<span class="fl">.3</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb315-7"><a href="the-many-variables-the-spurious-waffles.html#cb315-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">transmute</span>(<span class="st">&quot;b5.3_beta[M]&quot;</span> <span class="ot">=</span> b_M,</span>
<span id="cb315-8"><a href="the-many-variables-the-spurious-waffles.html#cb315-8" aria-hidden="true" tabindex="-1"></a>              <span class="st">&quot;b5.3_beta[A]&quot;</span> <span class="ot">=</span> b_A)</span>
<span id="cb315-9"><a href="the-many-variables-the-spurious-waffles.html#cb315-9" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb315-10"><a href="the-many-variables-the-spurious-waffles.html#cb315-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb315-11"><a href="the-many-variables-the-spurious-waffles.html#cb315-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(name) <span class="sc">%&gt;%</span> </span>
<span id="cb315-12"><a href="the-many-variables-the-spurious-waffles.html#cb315-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean =</span> <span class="fu">mean</span>(value),</span>
<span id="cb315-13"><a href="the-many-variables-the-spurious-waffles.html#cb315-13" aria-hidden="true" tabindex="-1"></a>            <span class="at">ll =</span> <span class="fu">quantile</span>(value, <span class="at">prob =</span> .<span class="dv">025</span>),</span>
<span id="cb315-14"><a href="the-many-variables-the-spurious-waffles.html#cb315-14" aria-hidden="true" tabindex="-1"></a>            <span class="at">ul =</span> <span class="fu">quantile</span>(value, <span class="at">prob =</span> .<span class="dv">975</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb315-15"><a href="the-many-variables-the-spurious-waffles.html#cb315-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(<span class="at">col =</span> name, <span class="at">into =</span> <span class="fu">c</span>(<span class="st">&quot;fit&quot;</span>,<span class="st">&quot;parameter&quot;</span>),</span>
<span id="cb315-16"><a href="the-many-variables-the-spurious-waffles.html#cb315-16" aria-hidden="true" tabindex="-1"></a>           <span class="at">sep =</span> <span class="st">&quot;_&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb315-17"><a href="the-many-variables-the-spurious-waffles.html#cb315-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> mean, <span class="at">xmin =</span> ll, <span class="at">xmax =</span> ul, <span class="at">y =</span> fit))<span class="sc">+</span></span>
<span id="cb315-18"><a href="the-many-variables-the-spurious-waffles.html#cb315-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">color =</span> <span class="st">&quot;firebrick&quot;</span>, <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">5</span>)<span class="sc">+</span></span>
<span id="cb315-19"><a href="the-many-variables-the-spurious-waffles.html#cb315-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_pointrange</span>(<span class="at">color =</span> <span class="st">&quot;firebrick&quot;</span>) <span class="sc">+</span></span>
<span id="cb315-20"><a href="the-many-variables-the-spurious-waffles.html#cb315-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;posterior&quot;</span>, <span class="at">y =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb315-21"><a href="the-many-variables-the-spurious-waffles.html#cb315-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb315-22"><a href="the-many-variables-the-spurious-waffles.html#cb315-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb315-23"><a href="the-many-variables-the-spurious-waffles.html#cb315-23" aria-hidden="true" tabindex="-1"></a>        <span class="at">strip.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">&quot;transparent&quot;</span>, <span class="at">color =</span> <span class="st">&quot;transparent&quot;</span>)) <span class="sc">+</span></span>
<span id="cb315-24"><a href="the-many-variables-the-spurious-waffles.html#cb315-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> parameter, <span class="at">ncol =</span> <span class="dv">1</span>, <span class="at">labeller =</span> label_parsed)</span></code></pre></div>
<p><img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-140-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>b5.3の結果を際釈するために、3つの図を描く。<br />
<br /></p>
</div>
<div id="predictor-residual-plots" class="section level3 hasAnchor" number="5.1.2">
<h3><span class="header-section-number">5.1.2</span> Predictor residual plots<a href="the-many-variables-the-spurious-waffles.html#predictor-residual-plots" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>まず、結婚率を結婚年齢で回帰したのち、予測値と実測値の間の残差を調べる。残差は結婚率の内、結婚年齢では説明できない部分である。</p>
<p>以下のモデルを考える。　　</p>
<p><span class="math inline">\(M_{i} \sim Normal(\mu_{i}, \sigma)\)</span><br />
<span class="math inline">\(\mu_{i} \sim \alpha + \beta A_{i}\)</span><br />
<span class="math inline">\(\alpha \sim Normal(0, 0.2)\)</span><br />
<span class="math inline">\(\beta \sim Normal(0, 0.05)\)</span><br />
<span class="math inline">\(\sigma \sim Exponential(1)\)</span><br />
<br /></p>
<div class="sourceCode" id="cb316"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb316-1"><a href="the-many-variables-the-spurious-waffles.html#cb316-1" aria-hidden="true" tabindex="-1"></a>b5<span class="fl">.4</span> <span class="ot">&lt;-</span> </span>
<span id="cb316-2"><a href="the-many-variables-the-spurious-waffles.html#cb316-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">brm</span>(<span class="at">data =</span> d,</span>
<span id="cb316-3"><a href="the-many-variables-the-spurious-waffles.html#cb316-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> gaussian,</span>
<span id="cb316-4"><a href="the-many-variables-the-spurious-waffles.html#cb316-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">formula =</span> M <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> A,</span>
<span id="cb316-5"><a href="the-many-variables-the-spurious-waffles.html#cb316-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>,<span class="fl">0.2</span>),<span class="at">class=</span>Intercept),</span>
<span id="cb316-6"><a href="the-many-variables-the-spurious-waffles.html#cb316-6" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>,<span class="fl">0.5</span>),<span class="at">class=</span>b),</span>
<span id="cb316-7"><a href="the-many-variables-the-spurious-waffles.html#cb316-7" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>),<span class="at">class=</span>sigma)),</span>
<span id="cb316-8"><a href="the-many-variables-the-spurious-waffles.html#cb316-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">seed =</span> <span class="dv">5</span>, <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>,</span>
<span id="cb316-9"><a href="the-many-variables-the-spurious-waffles.html#cb316-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">sample_prior =</span> T,</span>
<span id="cb316-10"><a href="the-many-variables-the-spurious-waffles.html#cb316-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">backend =</span> <span class="st">&quot;cmdstanr&quot;</span>,</span>
<span id="cb316-11"><a href="the-many-variables-the-spurious-waffles.html#cb316-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">file =</span> <span class="st">&quot;output/Chapter5/b5.4&quot;</span>)</span>
<span id="cb316-12"><a href="the-many-variables-the-spurious-waffles.html#cb316-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb316-13"><a href="the-many-variables-the-spurious-waffles.html#cb316-13" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(b5<span class="fl">.4</span>)  </span></code></pre></div>
<pre><code>##  Family: gaussian 
##   Links: mu = identity; sigma = identity 
## Formula: M ~ 1 + A 
##    Data: d (Number of observations: 50) 
##   Draws: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
##          total post-warmup draws = 4000
## 
## Population-Level Effects: 
##           Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## Intercept    -0.00      0.09    -0.18     0.18 1.00     3791     3108
## A            -0.69      0.10    -0.90    -0.49 1.00     3890     3151
## 
## Family Specific Parameters: 
##       Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## sigma     0.71      0.08     0.59     0.88 1.00     3813     2930
## 
## Draws were sampled using sample(hmc). For each parameter, Bulk_ESS
## and Tail_ESS are effective sample size measures, and Rhat is the potential
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<p>残差を視覚化してみる。</p>
<div class="sourceCode" id="cb318"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb318-1"><a href="the-many-variables-the-spurious-waffles.html#cb318-1" aria-hidden="true" tabindex="-1"></a>fit_b54 <span class="ot">&lt;-</span> <span class="fu">fitted</span>(b5<span class="fl">.4</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb318-2"><a href="the-many-variables-the-spurious-waffles.html#cb318-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb318-3"><a href="the-many-variables-the-spurious-waffles.html#cb318-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(d)</span>
<span id="cb318-4"><a href="the-many-variables-the-spurious-waffles.html#cb318-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb318-5"><a href="the-many-variables-the-spurious-waffles.html#cb318-5" aria-hidden="true" tabindex="-1"></a>fit_b54 <span class="sc">%&gt;%</span> </span>
<span id="cb318-6"><a href="the-many-variables-the-spurious-waffles.html#cb318-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>A,<span class="at">y=</span>M))<span class="sc">+</span></span>
<span id="cb318-7"><a href="the-many-variables-the-spurious-waffles.html#cb318-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size=</span><span class="dv">3</span>,<span class="at">shape=</span><span class="dv">1</span>,<span class="at">color=</span><span class="st">&quot;navyblue&quot;</span>)<span class="sc">+</span></span>
<span id="cb318-8"><a href="the-many-variables-the-spurious-waffles.html#cb318-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">xend =</span> A, <span class="at">yend =</span> Estimate),<span class="at">size=</span><span class="dv">1</span><span class="sc">/</span><span class="dv">4</span>)<span class="sc">+</span></span>
<span id="cb318-9"><a href="the-many-variables-the-spurious-waffles.html#cb318-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x=</span>A,<span class="at">y=</span>Estimate))<span class="sc">+</span></span>
<span id="cb318-10"><a href="the-many-variables-the-spurious-waffles.html#cb318-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text_repel</span>(<span class="at">data =</span> . <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Loc <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;WY&quot;</span>, <span class="st">&quot;ND&quot;</span>, <span class="st">&quot;ME&quot;</span>, <span class="st">&quot;HI&quot;</span>, <span class="st">&quot;DC&quot;</span>)),  </span>
<span id="cb318-11"><a href="the-many-variables-the-spurious-waffles.html#cb318-11" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">aes</span>(<span class="at">label =</span> Loc), </span>
<span id="cb318-12"><a href="the-many-variables-the-spurious-waffles.html#cb318-12" aria-hidden="true" tabindex="-1"></a>                  <span class="at">size =</span> <span class="dv">3</span>, <span class="at">seed =</span> <span class="dv">14</span>)<span class="sc">+</span></span>
<span id="cb318-13"><a href="the-many-variables-the-spurious-waffles.html#cb318-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Age at marriage (std)&quot;</span>,</span>
<span id="cb318-14"><a href="the-many-variables-the-spurious-waffles.html#cb318-14" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;Marriage rate (std)&quot;</span>)<span class="sc">+</span></span>
<span id="cb318-15"><a href="the-many-variables-the-spurious-waffles.html#cb318-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">range</span>(d<span class="sc">$</span>M))<span class="sc">+</span></span>
<span id="cb318-16"><a href="the-many-variables-the-spurious-waffles.html#cb318-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()<span class="sc">+</span></span>
<span id="cb318-17"><a href="the-many-variables-the-spurious-waffles.html#cb318-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb318-18"><a href="the-many-variables-the-spurious-waffles.html#cb318-18" aria-hidden="true" tabindex="-1"></a>        <span class="at">aspect.ratio =</span> .<span class="dv">95</span>) <span class="ot">-&gt;</span> p5</span>
<span id="cb318-19"><a href="the-many-variables-the-spurious-waffles.html#cb318-19" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb318-20"><a href="the-many-variables-the-spurious-waffles.html#cb318-20" aria-hidden="true" tabindex="-1"></a>p5</span></code></pre></div>
<p><img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-142-1.png" width="672" style="display: block; margin: auto;" />
<br /></p>
<p>残差と離婚率の関係を見てみる。<br />
ほぼ関連はないことが分かる。</p>
<div class="sourceCode" id="cb319"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb319-1"><a href="the-many-variables-the-spurious-waffles.html#cb319-1" aria-hidden="true" tabindex="-1"></a>red_b54 <span class="ot">&lt;-</span> <span class="fu">residuals</span>(b5<span class="fl">.4</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb319-2"><a href="the-many-variables-the-spurious-waffles.html#cb319-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb319-3"><a href="the-many-variables-the-spurious-waffles.html#cb319-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(d)</span>
<span id="cb319-4"><a href="the-many-variables-the-spurious-waffles.html#cb319-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb319-5"><a href="the-many-variables-the-spurious-waffles.html#cb319-5" aria-hidden="true" tabindex="-1"></a>p6 <span class="ot">&lt;-</span> </span>
<span id="cb319-6"><a href="the-many-variables-the-spurious-waffles.html#cb319-6" aria-hidden="true" tabindex="-1"></a>  red_b54 <span class="sc">%&gt;%</span> </span>
<span id="cb319-7"><a href="the-many-variables-the-spurious-waffles.html#cb319-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>Estimate,<span class="at">y=</span>D))<span class="sc">+</span></span>
<span id="cb319-8"><a href="the-many-variables-the-spurious-waffles.html#cb319-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">color=</span><span class="st">&quot;navyblue&quot;</span>,<span class="at">size=</span><span class="dv">3</span>,<span class="at">shape=</span><span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb319-9"><a href="the-many-variables-the-spurious-waffles.html#cb319-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>)<span class="sc">+</span></span>
<span id="cb319-10"><a href="the-many-variables-the-spurious-waffles.html#cb319-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">&quot;lm&quot;</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>,<span class="at">size=</span><span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>)<span class="sc">+</span></span>
<span id="cb319-11"><a href="the-many-variables-the-spurious-waffles.html#cb319-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()<span class="sc">+</span></span>
<span id="cb319-12"><a href="the-many-variables-the-spurious-waffles.html#cb319-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text_repel</span>(<span class="at">data =</span> . <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Loc <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;WY&quot;</span>, <span class="st">&quot;ND&quot;</span>, <span class="st">&quot;ME&quot;</span>, <span class="st">&quot;HI&quot;</span>, <span class="st">&quot;DC&quot;</span>)),  </span>
<span id="cb319-13"><a href="the-many-variables-the-spurious-waffles.html#cb319-13" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">aes</span>(<span class="at">label =</span> Loc), </span>
<span id="cb319-14"><a href="the-many-variables-the-spurious-waffles.html#cb319-14" aria-hidden="true" tabindex="-1"></a>                  <span class="at">size =</span> <span class="dv">3</span>, <span class="at">seed =</span> <span class="dv">14</span>)<span class="sc">+</span></span>
<span id="cb319-15"><a href="the-many-variables-the-spurious-waffles.html#cb319-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">aspect.ratio=</span><span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb319-16"><a href="the-many-variables-the-spurious-waffles.html#cb319-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Marriage rate residuals&quot;</span>,</span>
<span id="cb319-17"><a href="the-many-variables-the-spurious-waffles.html#cb319-17" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;Divorce rate (std)&quot;</span>)</span>
<span id="cb319-18"><a href="the-many-variables-the-spurious-waffles.html#cb319-18" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb319-19"><a href="the-many-variables-the-spurious-waffles.html#cb319-19" aria-hidden="true" tabindex="-1"></a>p6</span></code></pre></div>
<p><img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-143-1.png" width="672" style="display: block; margin: auto;" />
<br /></p>
<p>今度は、結婚年齢を結婚率で回帰して同様の作図をしてみる。</p>
<div class="sourceCode" id="cb320"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb320-1"><a href="the-many-variables-the-spurious-waffles.html#cb320-1" aria-hidden="true" tabindex="-1"></a>b5<span class="fl">.5</span> <span class="ot">&lt;-</span> </span>
<span id="cb320-2"><a href="the-many-variables-the-spurious-waffles.html#cb320-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">brm</span>(<span class="at">data =</span> d,</span>
<span id="cb320-3"><a href="the-many-variables-the-spurious-waffles.html#cb320-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> gaussian,</span>
<span id="cb320-4"><a href="the-many-variables-the-spurious-waffles.html#cb320-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">formula =</span> A <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> M,</span>
<span id="cb320-5"><a href="the-many-variables-the-spurious-waffles.html#cb320-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>,<span class="fl">0.2</span>),<span class="at">class=</span>Intercept),</span>
<span id="cb320-6"><a href="the-many-variables-the-spurious-waffles.html#cb320-6" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>,<span class="fl">0.5</span>),<span class="at">class=</span>b),</span>
<span id="cb320-7"><a href="the-many-variables-the-spurious-waffles.html#cb320-7" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>),<span class="at">class=</span>sigma)),</span>
<span id="cb320-8"><a href="the-many-variables-the-spurious-waffles.html#cb320-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">seed =</span> <span class="dv">5</span>, <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>,</span>
<span id="cb320-9"><a href="the-many-variables-the-spurious-waffles.html#cb320-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">sample_prior =</span> T,</span>
<span id="cb320-10"><a href="the-many-variables-the-spurious-waffles.html#cb320-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">backend =</span> <span class="st">&quot;cmdstanr&quot;</span>,</span>
<span id="cb320-11"><a href="the-many-variables-the-spurious-waffles.html#cb320-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">file =</span> <span class="st">&quot;output/Chapter5/b5.5&quot;</span>)</span>
<span id="cb320-12"><a href="the-many-variables-the-spurious-waffles.html#cb320-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb320-13"><a href="the-many-variables-the-spurious-waffles.html#cb320-13" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(b5<span class="fl">.5</span>)  </span></code></pre></div>
<pre><code>##  Family: gaussian 
##   Links: mu = identity; sigma = identity 
## Formula: A ~ 1 + M 
##    Data: d (Number of observations: 50) 
##   Draws: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
##          total post-warmup draws = 4000
## 
## Population-Level Effects: 
##           Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## Intercept    -0.00      0.09    -0.18     0.17 1.00     3599     3284
## M            -0.69      0.10    -0.89    -0.50 1.00     3710     3136
## 
## Family Specific Parameters: 
##       Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## sigma     0.71      0.08     0.58     0.88 1.00     3363     2794
## 
## Draws were sampled using sample(hmc). For each parameter, Bulk_ESS
## and Tail_ESS are effective sample size measures, and Rhat is the potential
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<p>残差を視覚化してみる。</p>
<div class="sourceCode" id="cb322"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb322-1"><a href="the-many-variables-the-spurious-waffles.html#cb322-1" aria-hidden="true" tabindex="-1"></a>fit_b55 <span class="ot">&lt;-</span> <span class="fu">fitted</span>(b5<span class="fl">.5</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb322-2"><a href="the-many-variables-the-spurious-waffles.html#cb322-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb322-3"><a href="the-many-variables-the-spurious-waffles.html#cb322-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(d)</span>
<span id="cb322-4"><a href="the-many-variables-the-spurious-waffles.html#cb322-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb322-5"><a href="the-many-variables-the-spurious-waffles.html#cb322-5" aria-hidden="true" tabindex="-1"></a>fit_b55 <span class="sc">%&gt;%</span> </span>
<span id="cb322-6"><a href="the-many-variables-the-spurious-waffles.html#cb322-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>M,<span class="at">y=</span>A))<span class="sc">+</span></span>
<span id="cb322-7"><a href="the-many-variables-the-spurious-waffles.html#cb322-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size=</span><span class="dv">3</span>,<span class="at">shape=</span><span class="dv">1</span>,<span class="at">color=</span><span class="st">&quot;navyblue&quot;</span>)<span class="sc">+</span></span>
<span id="cb322-8"><a href="the-many-variables-the-spurious-waffles.html#cb322-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">xend =</span> M, <span class="at">yend =</span> Estimate),<span class="at">size=</span><span class="dv">1</span><span class="sc">/</span><span class="dv">4</span>)<span class="sc">+</span></span>
<span id="cb322-9"><a href="the-many-variables-the-spurious-waffles.html#cb322-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x=</span>M,<span class="at">y=</span>Estimate))<span class="sc">+</span></span>
<span id="cb322-10"><a href="the-many-variables-the-spurious-waffles.html#cb322-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text_repel</span>(<span class="at">data =</span> . <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Loc <span class="sc">%in%</span> <span class="fu">c</span>( <span class="st">&quot;ND&quot;</span>,  <span class="st">&quot;HI&quot;</span>, <span class="st">&quot;DC&quot;</span>)),  </span>
<span id="cb322-11"><a href="the-many-variables-the-spurious-waffles.html#cb322-11" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">aes</span>(<span class="at">label =</span> Loc), </span>
<span id="cb322-12"><a href="the-many-variables-the-spurious-waffles.html#cb322-12" aria-hidden="true" tabindex="-1"></a>                  <span class="at">size =</span> <span class="dv">3</span>, <span class="at">seed =</span> <span class="dv">14</span>)<span class="sc">+</span></span>
<span id="cb322-13"><a href="the-many-variables-the-spurious-waffles.html#cb322-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">&quot;Age at marriage (std)&quot;</span>,</span>
<span id="cb322-14"><a href="the-many-variables-the-spurious-waffles.html#cb322-14" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">&quot;Marriage rate (std)&quot;</span>)<span class="sc">+</span></span>
<span id="cb322-15"><a href="the-many-variables-the-spurious-waffles.html#cb322-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">range</span>(d<span class="sc">$</span>M))<span class="sc">+</span></span>
<span id="cb322-16"><a href="the-many-variables-the-spurious-waffles.html#cb322-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()<span class="sc">+</span></span>
<span id="cb322-17"><a href="the-many-variables-the-spurious-waffles.html#cb322-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb322-18"><a href="the-many-variables-the-spurious-waffles.html#cb322-18" aria-hidden="true" tabindex="-1"></a>        <span class="at">aspect.ratio =</span> .<span class="dv">95</span>) <span class="ot">-&gt;</span> p7</span>
<span id="cb322-19"><a href="the-many-variables-the-spurious-waffles.html#cb322-19" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb322-20"><a href="the-many-variables-the-spurious-waffles.html#cb322-20" aria-hidden="true" tabindex="-1"></a>p7</span></code></pre></div>
<p><img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-145-1.png" width="672" style="display: block; margin: auto;" />
<br /></p>
<p>残差と離婚率の関係を見てみる。<br />
今度は、関連がみられることが分かる。</p>
<div class="sourceCode" id="cb323"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb323-1"><a href="the-many-variables-the-spurious-waffles.html#cb323-1" aria-hidden="true" tabindex="-1"></a>red_b55 <span class="ot">&lt;-</span> <span class="fu">residuals</span>(b5<span class="fl">.5</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb323-2"><a href="the-many-variables-the-spurious-waffles.html#cb323-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb323-3"><a href="the-many-variables-the-spurious-waffles.html#cb323-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(d)</span>
<span id="cb323-4"><a href="the-many-variables-the-spurious-waffles.html#cb323-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb323-5"><a href="the-many-variables-the-spurious-waffles.html#cb323-5" aria-hidden="true" tabindex="-1"></a>p8 <span class="ot">&lt;-</span> </span>
<span id="cb323-6"><a href="the-many-variables-the-spurious-waffles.html#cb323-6" aria-hidden="true" tabindex="-1"></a>  red_b55 <span class="sc">%&gt;%</span> </span>
<span id="cb323-7"><a href="the-many-variables-the-spurious-waffles.html#cb323-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>Estimate,<span class="at">y=</span>D))<span class="sc">+</span></span>
<span id="cb323-8"><a href="the-many-variables-the-spurious-waffles.html#cb323-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">color=</span><span class="st">&quot;navyblue&quot;</span>,<span class="at">size=</span><span class="dv">3</span>,<span class="at">shape=</span><span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb323-9"><a href="the-many-variables-the-spurious-waffles.html#cb323-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>)<span class="sc">+</span></span>
<span id="cb323-10"><a href="the-many-variables-the-spurious-waffles.html#cb323-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">&quot;lm&quot;</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>,<span class="at">size=</span><span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>)<span class="sc">+</span></span>
<span id="cb323-11"><a href="the-many-variables-the-spurious-waffles.html#cb323-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()<span class="sc">+</span></span>
<span id="cb323-12"><a href="the-many-variables-the-spurious-waffles.html#cb323-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text_repel</span>(<span class="at">data =</span> . <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Loc <span class="sc">%in%</span> <span class="fu">c</span>( <span class="st">&quot;ND&quot;</span>,  <span class="st">&quot;HI&quot;</span>, <span class="st">&quot;DC&quot;</span>)),  </span>
<span id="cb323-13"><a href="the-many-variables-the-spurious-waffles.html#cb323-13" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">aes</span>(<span class="at">label =</span> Loc), </span>
<span id="cb323-14"><a href="the-many-variables-the-spurious-waffles.html#cb323-14" aria-hidden="true" tabindex="-1"></a>                  <span class="at">size =</span> <span class="dv">3</span>, <span class="at">seed =</span> <span class="dv">14</span>)<span class="sc">+</span></span>
<span id="cb323-15"><a href="the-many-variables-the-spurious-waffles.html#cb323-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">aspect.ratio=</span><span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb323-16"><a href="the-many-variables-the-spurious-waffles.html#cb323-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Age at marriage residuals&quot;</span>,</span>
<span id="cb323-17"><a href="the-many-variables-the-spurious-waffles.html#cb323-17" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;Divorce rate (std)&quot;</span>)</span>
<span id="cb323-18"><a href="the-many-variables-the-spurious-waffles.html#cb323-18" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb323-19"><a href="the-many-variables-the-spurious-waffles.html#cb323-19" aria-hidden="true" tabindex="-1"></a>p8</span></code></pre></div>
<p><img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-146-1.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb324"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb324-1"><a href="the-many-variables-the-spurious-waffles.html#cb324-1" aria-hidden="true" tabindex="-1"></a>p5 <span class="sc">+</span> p6 <span class="sc">+</span> p7 <span class="sc">+</span> p8 <span class="sc">+</span> <span class="fu">plot_annotation</span>(<span class="at">title =</span> <span class="st">&quot;Understanding multiple regression through residuals&quot;</span>)</span></code></pre></div>
<p><img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-146-2.png" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="posterior-prediction-plots" class="section level3 hasAnchor" number="5.1.3">
<h3><span class="header-section-number">5.1.3</span> Posterior prediction plots<a href="the-many-variables-the-spurious-waffles.html#posterior-prediction-plots" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>モデルの予測値が実測値とどの程度一致しているのかを確認する。</p>
<div class="sourceCode" id="cb325"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb325-1"><a href="the-many-variables-the-spurious-waffles.html#cb325-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fitted</span>(b5<span class="fl">.3</span>, <span class="at">prob =</span> <span class="fu">c</span>(.<span class="dv">055</span>,.<span class="dv">945</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb325-2"><a href="the-many-variables-the-spurious-waffles.html#cb325-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb325-3"><a href="the-many-variables-the-spurious-waffles.html#cb325-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_all</span>(<span class="sc">~</span>.<span class="sc">*</span><span class="fu">sd</span>(d<span class="sc">$</span>Divorce) <span class="sc">+</span> <span class="fu">mean</span>(d<span class="sc">$</span>Divorce)) <span class="sc">%&gt;%</span> </span>
<span id="cb325-4"><a href="the-many-variables-the-spurious-waffles.html#cb325-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(d) <span class="sc">%&gt;%</span> </span>
<span id="cb325-5"><a href="the-many-variables-the-spurious-waffles.html#cb325-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>Divorce,<span class="at">y=</span>Estimate,<span class="at">ymin =</span> Q5<span class="fl">.5</span>, </span>
<span id="cb325-6"><a href="the-many-variables-the-spurious-waffles.html#cb325-6" aria-hidden="true" tabindex="-1"></a>             <span class="at">ymax =</span> Q94<span class="fl">.5</span>))<span class="sc">+</span></span>
<span id="cb325-7"><a href="the-many-variables-the-spurious-waffles.html#cb325-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">color=</span><span class="st">&quot;navyblue&quot;</span>,<span class="at">size=</span><span class="dv">2</span>)<span class="sc">+</span></span>
<span id="cb325-8"><a href="the-many-variables-the-spurious-waffles.html#cb325-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">linetype=</span><span class="dv">2</span>, <span class="at">size=</span><span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>, <span class="at">color=</span><span class="st">&quot;grey&quot;</span>)<span class="sc">+</span></span>
<span id="cb325-9"><a href="the-many-variables-the-spurious-waffles.html#cb325-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_linerange</span>(<span class="at">size=</span><span class="dv">1</span><span class="sc">/</span><span class="dv">4</span>, <span class="at">color =</span> <span class="st">&quot;navyblue&quot;</span>, <span class="at">alpha=</span><span class="dv">2</span><span class="sc">/</span><span class="dv">3</span>)<span class="sc">+</span></span>
<span id="cb325-10"><a href="the-many-variables-the-spurious-waffles.html#cb325-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">data =</span> . <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Loc <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;ID&quot;</span>, <span class="st">&quot;UT&quot;</span>, <span class="st">&quot;RI&quot;</span>, <span class="st">&quot;ME&quot;</span>)),</span>
<span id="cb325-11"><a href="the-many-variables-the-spurious-waffles.html#cb325-11" aria-hidden="true" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">label =</span> Loc),</span>
<span id="cb325-12"><a href="the-many-variables-the-spurious-waffles.html#cb325-12" aria-hidden="true" tabindex="-1"></a>            <span class="at">hjust=</span><span class="dv">1</span>,<span class="at">nudge_x=</span><span class="sc">-</span><span class="fl">0.25</span>)<span class="sc">+</span></span>
<span id="cb325-13"><a href="the-many-variables-the-spurious-waffles.html#cb325-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Observed divorce&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Predicted divorce&quot;</span>) <span class="sc">+</span></span>
<span id="cb325-14"><a href="the-many-variables-the-spurious-waffles.html#cb325-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb325-15"><a href="the-many-variables-the-spurious-waffles.html#cb325-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb325-16"><a href="the-many-variables-the-spurious-waffles.html#cb325-16" aria-hidden="true" tabindex="-1"></a>        <span class="at">aspect.ratio=</span><span class="dv">1</span>)</span></code></pre></div>
<p><img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-147-1.png" width="672" style="display: block; margin: auto;" />
<br /></p>
</div>
<div id="counterfactual-plot" class="section level3 hasAnchor" number="5.1.4">
<h3><span class="header-section-number">5.1.4</span> Counterfactual plot<a href="the-many-variables-the-spurious-waffles.html#counterfactual-plot" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>反事実を用いて因果関係を推論する。　　
ここで、もう一度DAG1を考える。</p>
<div class="sourceCode" id="cb326"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb326-1"><a href="the-many-variables-the-spurious-waffles.html#cb326-1" aria-hidden="true" tabindex="-1"></a>p4</span></code></pre></div>
<p><img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-148-1.png" width="672" style="display: block; margin: auto;" />
<br /></p>
<p>このDAGが正しいと仮定するときのモデルを考え、どのような予測が得られるかを調べる。<br />
b4.3と異なり、AがMに与える影響も同時にモデリングする。</p>
<div class="sourceCode" id="cb327"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb327-1"><a href="the-many-variables-the-spurious-waffles.html#cb327-1" aria-hidden="true" tabindex="-1"></a>D_model <span class="ot">&lt;-</span> <span class="fu">bf</span>(D <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> A <span class="sc">+</span> M)</span>
<span id="cb327-2"><a href="the-many-variables-the-spurious-waffles.html#cb327-2" aria-hidden="true" tabindex="-1"></a>M_model <span class="ot">&lt;-</span> <span class="fu">bf</span>(M <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> A)</span>
<span id="cb327-3"><a href="the-many-variables-the-spurious-waffles.html#cb327-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb327-4"><a href="the-many-variables-the-spurious-waffles.html#cb327-4" aria-hidden="true" tabindex="-1"></a>b5<span class="fl">.6</span> <span class="ot">&lt;-</span> </span>
<span id="cb327-5"><a href="the-many-variables-the-spurious-waffles.html#cb327-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">brm</span>(<span class="at">data =</span>d,</span>
<span id="cb327-6"><a href="the-many-variables-the-spurious-waffles.html#cb327-6" aria-hidden="true" tabindex="-1"></a>            <span class="at">family =</span> gaussian,</span>
<span id="cb327-7"><a href="the-many-variables-the-spurious-waffles.html#cb327-7" aria-hidden="true" tabindex="-1"></a>            D_model <span class="sc">+</span> M_model <span class="sc">+</span> <span class="fu">set_rescor</span>(<span class="cn">FALSE</span>),</span>
<span id="cb327-8"><a href="the-many-variables-the-spurious-waffles.html#cb327-8" aria-hidden="true" tabindex="-1"></a>            <span class="at">prior=</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>,<span class="fl">0.2</span>),<span class="at">class=</span>Intercept, <span class="at">resp =</span> D),</span>
<span id="cb327-9"><a href="the-many-variables-the-spurious-waffles.html#cb327-9" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>,<span class="fl">0.5</span>),<span class="at">class=</span>b, <span class="at">resp =</span>D),</span>
<span id="cb327-10"><a href="the-many-variables-the-spurious-waffles.html#cb327-10" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>),<span class="at">class=</span>sigma, <span class="at">resp=</span>D),</span>
<span id="cb327-11"><a href="the-many-variables-the-spurious-waffles.html#cb327-11" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>,<span class="fl">0.2</span>),<span class="at">class=</span>Intercept, <span class="at">resp =</span> M),</span>
<span id="cb327-12"><a href="the-many-variables-the-spurious-waffles.html#cb327-12" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>,<span class="fl">0.5</span>),<span class="at">class=</span>b, <span class="at">resp =</span>M),</span>
<span id="cb327-13"><a href="the-many-variables-the-spurious-waffles.html#cb327-13" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>),<span class="at">class=</span>sigma, <span class="at">resp=</span>M)</span>
<span id="cb327-14"><a href="the-many-variables-the-spurious-waffles.html#cb327-14" aria-hidden="true" tabindex="-1"></a>                ),</span>
<span id="cb327-15"><a href="the-many-variables-the-spurious-waffles.html#cb327-15" aria-hidden="true" tabindex="-1"></a>      <span class="at">seed =</span> <span class="dv">5</span>, <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>,</span>
<span id="cb327-16"><a href="the-many-variables-the-spurious-waffles.html#cb327-16" aria-hidden="true" tabindex="-1"></a>      <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">sample_prior =</span> T,</span>
<span id="cb327-17"><a href="the-many-variables-the-spurious-waffles.html#cb327-17" aria-hidden="true" tabindex="-1"></a>      <span class="at">backend =</span> <span class="st">&quot;cmdstanr&quot;</span>,</span>
<span id="cb327-18"><a href="the-many-variables-the-spurious-waffles.html#cb327-18" aria-hidden="true" tabindex="-1"></a>      <span class="at">file =</span> <span class="st">&quot;output/Chapter5/b5.6&quot;</span>)</span>
<span id="cb327-19"><a href="the-many-variables-the-spurious-waffles.html#cb327-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb327-20"><a href="the-many-variables-the-spurious-waffles.html#cb327-20" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(b5<span class="fl">.6</span>)</span></code></pre></div>
<pre><code>##  Family: MV(gaussian, gaussian) 
##   Links: mu = identity; sigma = identity
##          mu = identity; sigma = identity 
## Formula: D ~ 1 + A + M 
##          M ~ 1 + A 
##    Data: d (Number of observations: 50) 
##   Draws: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
##          total post-warmup draws = 4000
## 
## Population-Level Effects: 
##             Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## D_Intercept    -0.00      0.10    -0.20     0.20 1.00     5703     2991
## M_Intercept     0.00      0.09    -0.17     0.18 1.00     5779     3139
## D_A            -0.61      0.16    -0.91    -0.30 1.00     3444     2961
## D_M            -0.06      0.16    -0.36     0.26 1.00     3727     3155
## M_A            -0.69      0.10    -0.89    -0.49 1.00     6504     3009
## 
## Family Specific Parameters: 
##         Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## sigma_D     0.83      0.09     0.68     1.02 1.00     5850     3151
## sigma_M     0.71      0.07     0.59     0.87 1.00     5915     2910
## 
## Draws were sampled using sample(hmc). For each parameter, Bulk_ESS
## and Tail_ESS are effective sample size measures, and Rhat is the potential
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<div class="sourceCode" id="cb329"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb329-1"><a href="the-many-variables-the-spurious-waffles.html#cb329-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(b5<span class="fl">.4</span>)</span></code></pre></div>
<pre><code>##  Family: gaussian 
##   Links: mu = identity; sigma = identity 
## Formula: M ~ 1 + A 
##    Data: d (Number of observations: 50) 
##   Draws: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
##          total post-warmup draws = 4000
## 
## Population-Level Effects: 
##           Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## Intercept    -0.00      0.09    -0.18     0.18 1.00     3791     3108
## A            -0.69      0.10    -0.90    -0.49 1.00     3890     3151
## 
## Family Specific Parameters: 
##       Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## sigma     0.71      0.08     0.59     0.88 1.00     3813     2930
## 
## Draws were sampled using sample(hmc). For each parameter, Bulk_ESS
## and Tail_ESS are effective sample size measures, and Rhat is the potential
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<div class="sourceCode" id="cb331"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb331-1"><a href="the-many-variables-the-spurious-waffles.html#cb331-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fixef</span>(b5<span class="fl">.4</span>)</span></code></pre></div>
<pre><code>##               Estimate  Est.Error       Q2.5      Q97.5
## Intercept -0.000202642 0.09123806 -0.1760342  0.1760154
## A         -0.693199622 0.10280042 -0.8954283 -0.4863180</code></pre>
<div class="sourceCode" id="cb333"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb333-1"><a href="the-many-variables-the-spurious-waffles.html#cb333-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fixef</span>(b5<span class="fl">.6</span>)</span></code></pre></div>
<pre><code>##                  Estimate  Est.Error       Q2.5      Q97.5
## D_Intercept -0.0001033558 0.10238055 -0.2021818  0.2043600
## M_Intercept  0.0001592893 0.09000476 -0.1747437  0.1782738
## D_A         -0.6101763775 0.15730728 -0.9142536 -0.3032206
## D_M         -0.0621125614 0.15755733 -0.3596547  0.2574711
## M_A         -0.6914509155 0.09950295 -0.8864033 -0.4947843</code></pre>
<p><br /></p>
<p>Aの値を動かしたときにどうなるかをシミュレートする。</p>
<div class="sourceCode" id="cb335"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb335-1"><a href="the-many-variables-the-spurious-waffles.html#cb335-1" aria-hidden="true" tabindex="-1"></a>A_seq <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">A =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">2</span>,<span class="dv">2</span>,<span class="at">length.out=</span><span class="dv">50</span>),</span>
<span id="cb335-2"><a href="the-many-variables-the-spurious-waffles.html#cb335-2" aria-hidden="true" tabindex="-1"></a>                <span class="at">M =</span> <span class="dv">0</span>)</span>
<span id="cb335-3"><a href="the-many-variables-the-spurious-waffles.html#cb335-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb335-4"><a href="the-many-variables-the-spurious-waffles.html#cb335-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb335-5"><a href="the-many-variables-the-spurious-waffles.html#cb335-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Dについて</span></span>
<span id="cb335-6"><a href="the-many-variables-the-spurious-waffles.html#cb335-6" aria-hidden="true" tabindex="-1"></a>pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(b5<span class="fl">.6</span>, </span>
<span id="cb335-7"><a href="the-many-variables-the-spurious-waffles.html#cb335-7" aria-hidden="true" tabindex="-1"></a>             <span class="at">newdata =</span> A_seq) <span class="sc">%&gt;%</span> </span>
<span id="cb335-8"><a href="the-many-variables-the-spurious-waffles.html#cb335-8" aria-hidden="true" tabindex="-1"></a>          <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb335-9"><a href="the-many-variables-the-spurious-waffles.html#cb335-9" aria-hidden="true" tabindex="-1"></a>          <span class="fu">bind_cols</span>(A_seq)</span>
<span id="cb335-10"><a href="the-many-variables-the-spurious-waffles.html#cb335-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb335-11"><a href="the-many-variables-the-spurious-waffles.html#cb335-11" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> </span>
<span id="cb335-12"><a href="the-many-variables-the-spurious-waffles.html#cb335-12" aria-hidden="true" tabindex="-1"></a>  pred <span class="sc">%&gt;%</span></span>
<span id="cb335-13"><a href="the-many-variables-the-spurious-waffles.html#cb335-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>A,<span class="at">y =</span> Estimate.D,<span class="at">ymin =</span> Q2.<span class="fl">5.</span>D,<span class="at">ymax=</span>Q97.<span class="fl">5.</span>D))<span class="sc">+</span></span>
<span id="cb335-14"><a href="the-many-variables-the-spurious-waffles.html#cb335-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">size=</span><span class="fl">0.5</span>)<span class="sc">+</span></span>
<span id="cb335-15"><a href="the-many-variables-the-spurious-waffles.html#cb335-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="at">fill =</span> <span class="st">&quot;black&quot;</span>, <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">4</span>)<span class="sc">+</span></span>
<span id="cb335-16"><a href="the-many-variables-the-spurious-waffles.html#cb335-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">&quot;Total counterfactual effect of A on D&quot;</span>,</span>
<span id="cb335-17"><a href="the-many-variables-the-spurious-waffles.html#cb335-17" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">&quot;manipulated A&quot;</span>,</span>
<span id="cb335-18"><a href="the-many-variables-the-spurious-waffles.html#cb335-18" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;counterfactual D&quot;</span>) <span class="sc">+</span></span>
<span id="cb335-19"><a href="the-many-variables-the-spurious-waffles.html#cb335-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">2</span>, <span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb335-20"><a href="the-many-variables-the-spurious-waffles.html#cb335-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb335-21"><a href="the-many-variables-the-spurious-waffles.html#cb335-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb335-22"><a href="the-many-variables-the-spurious-waffles.html#cb335-22" aria-hidden="true" tabindex="-1"></a>        <span class="at">aspect.ratio=</span><span class="dv">1</span>) </span>
<span id="cb335-23"><a href="the-many-variables-the-spurious-waffles.html#cb335-23" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb335-24"><a href="the-many-variables-the-spurious-waffles.html#cb335-24" aria-hidden="true" tabindex="-1"></a>p1</span></code></pre></div>
<p><img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-150-1.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb336"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb336-1"><a href="the-many-variables-the-spurious-waffles.html#cb336-1" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> </span>
<span id="cb336-2"><a href="the-many-variables-the-spurious-waffles.html#cb336-2" aria-hidden="true" tabindex="-1"></a>  pred <span class="sc">%&gt;%</span></span>
<span id="cb336-3"><a href="the-many-variables-the-spurious-waffles.html#cb336-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>A,<span class="at">y =</span> Estimate.M,<span class="at">ymin =</span> Q2.<span class="fl">5.</span>M,<span class="at">ymax=</span>Q97.<span class="fl">5.</span>M))<span class="sc">+</span></span>
<span id="cb336-4"><a href="the-many-variables-the-spurious-waffles.html#cb336-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">size=</span><span class="fl">0.5</span>)<span class="sc">+</span></span>
<span id="cb336-5"><a href="the-many-variables-the-spurious-waffles.html#cb336-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="at">fill =</span> <span class="st">&quot;black&quot;</span>, <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">4</span>)<span class="sc">+</span></span>
<span id="cb336-6"><a href="the-many-variables-the-spurious-waffles.html#cb336-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">&quot;Total counterfactual effect of A on D&quot;</span>,</span>
<span id="cb336-7"><a href="the-many-variables-the-spurious-waffles.html#cb336-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">&quot;manipulated A&quot;</span>,</span>
<span id="cb336-8"><a href="the-many-variables-the-spurious-waffles.html#cb336-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;counterfactual M&quot;</span>) <span class="sc">+</span></span>
<span id="cb336-9"><a href="the-many-variables-the-spurious-waffles.html#cb336-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">2</span>, <span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb336-10"><a href="the-many-variables-the-spurious-waffles.html#cb336-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb336-11"><a href="the-many-variables-the-spurious-waffles.html#cb336-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb336-12"><a href="the-many-variables-the-spurious-waffles.html#cb336-12" aria-hidden="true" tabindex="-1"></a>        <span class="at">aspect.ratio=</span><span class="dv">1</span>) </span>
<span id="cb336-13"><a href="the-many-variables-the-spurious-waffles.html#cb336-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb336-14"><a href="the-many-variables-the-spurious-waffles.html#cb336-14" aria-hidden="true" tabindex="-1"></a>p1<span class="sc">+</span>p2<span class="sc">+</span> <span class="fu">plot_annotation</span>(<span class="at">title =</span> <span class="st">&quot;Counterfactual plots for the multivariate divorce model&quot;</span>)</span></code></pre></div>
<p><img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-150-2.png" width="672" style="display: block; margin: auto;" />
<br /></p>
<p>20歳から30歳に上がった時に期待値がどの程度変化するかもシミュレートできる。</p>
<div class="sourceCode" id="cb337"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb337-1"><a href="the-many-variables-the-spurious-waffles.html#cb337-1" aria-hidden="true" tabindex="-1"></a>A_seq_2 <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">A =</span> (<span class="fu">c</span>(<span class="dv">20</span>,<span class="dv">30</span>)<span class="sc">-</span><span class="fl">26.1</span>)<span class="sc">/</span><span class="fl">1.24</span>,</span>
<span id="cb337-2"><a href="the-many-variables-the-spurious-waffles.html#cb337-2" aria-hidden="true" tabindex="-1"></a>                  <span class="at">M =</span> <span class="dv">0</span>)</span>
<span id="cb337-3"><a href="the-many-variables-the-spurious-waffles.html#cb337-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-4"><a href="the-many-variables-the-spurious-waffles.html#cb337-4" aria-hidden="true" tabindex="-1"></a><span class="fu">predict</span>(b5<span class="fl">.6</span>, <span class="at">newdata =</span> A_seq_2, <span class="at">resp=</span><span class="st">&quot;D&quot;</span>,<span class="at">summary=</span>F) <span class="sc">%&gt;%</span> </span>
<span id="cb337-5"><a href="the-many-variables-the-spurious-waffles.html#cb337-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb337-6"><a href="the-many-variables-the-spurious-waffles.html#cb337-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_names</span>(<span class="st">&quot;a20&quot;</span>,<span class="st">&quot;a30&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb337-7"><a href="the-many-variables-the-spurious-waffles.html#cb337-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">diff =</span> a30 <span class="sc">-</span> a20) <span class="sc">%&gt;%</span> </span>
<span id="cb337-8"><a href="the-many-variables-the-spurious-waffles.html#cb337-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean =</span> <span class="fu">mean</span>(diff))</span></code></pre></div>
<pre><code>##        mean
## 1 -4.908852</code></pre>
<p>次に、Mを動かしたときにDがどのように変化するかを調べる。このとき、Mを操作するので、A-&gt;Mの因果は消えることになる。</p>
<div class="sourceCode" id="cb339"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb339-1"><a href="the-many-variables-the-spurious-waffles.html#cb339-1" aria-hidden="true" tabindex="-1"></a>DAG5<span class="fl">.3</span> <span class="ot">&lt;-</span></span>
<span id="cb339-2"><a href="the-many-variables-the-spurious-waffles.html#cb339-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dagify</span>(D <span class="sc">~</span> M,</span>
<span id="cb339-3"><a href="the-many-variables-the-spurious-waffles.html#cb339-3" aria-hidden="true" tabindex="-1"></a>         D <span class="sc">~</span> A ,</span>
<span id="cb339-4"><a href="the-many-variables-the-spurious-waffles.html#cb339-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">coords =</span> dag_coords) </span>
<span id="cb339-5"><a href="the-many-variables-the-spurious-waffles.html#cb339-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb339-6"><a href="the-many-variables-the-spurious-waffles.html#cb339-6" aria-hidden="true" tabindex="-1"></a>DAG5<span class="fl">.3</span> <span class="sc">%&gt;%</span> </span>
<span id="cb339-7"><a href="the-many-variables-the-spurious-waffles.html#cb339-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">xend =</span> xend, <span class="at">yend =</span> yend)) <span class="sc">+</span></span>
<span id="cb339-8"><a href="the-many-variables-the-spurious-waffles.html#cb339-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_dag_point</span>(<span class="at">color =</span> <span class="st">&quot;firebrick&quot;</span>, <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">4</span>, <span class="at">size =</span> <span class="dv">15</span>) <span class="sc">+</span></span>
<span id="cb339-9"><a href="the-many-variables-the-spurious-waffles.html#cb339-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_dag_text</span>(<span class="at">color =</span> <span class="st">&quot;firebrick&quot;</span>) <span class="sc">+</span></span>
<span id="cb339-10"><a href="the-many-variables-the-spurious-waffles.html#cb339-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_dag_edges</span>(<span class="at">edge_color =</span> <span class="st">&quot;firebrick&quot;</span>) <span class="sc">+</span></span>
<span id="cb339-11"><a href="the-many-variables-the-spurious-waffles.html#cb339-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="cn">NULL</span>, <span class="at">breaks =</span> <span class="cn">NULL</span>, <span class="at">expand =</span> <span class="fu">c</span>(.<span class="dv">1</span>, .<span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb339-12"><a href="the-many-variables-the-spurious-waffles.html#cb339-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="cn">NULL</span>, <span class="at">breaks =</span> <span class="cn">NULL</span>, <span class="at">expand =</span> <span class="fu">c</span>(.<span class="dv">1</span>, .<span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb339-13"><a href="the-many-variables-the-spurious-waffles.html#cb339-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb339-14"><a href="the-many-variables-the-spurious-waffles.html#cb339-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>())</span></code></pre></div>
<p><img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-152-1.png" width="672" style="display: block; margin: auto;" />
<br /></p>
<p>シミュレートする。</p>
<div class="sourceCode" id="cb340"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb340-1"><a href="the-many-variables-the-spurious-waffles.html#cb340-1" aria-hidden="true" tabindex="-1"></a>seq_M <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">M =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">2</span>,<span class="dv">2</span>,<span class="at">length.out=</span><span class="dv">50</span>),</span>
<span id="cb340-2"><a href="the-many-variables-the-spurious-waffles.html#cb340-2" aria-hidden="true" tabindex="-1"></a>                <span class="at">A =</span> <span class="dv">0</span>)</span>
<span id="cb340-3"><a href="the-many-variables-the-spurious-waffles.html#cb340-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb340-4"><a href="the-many-variables-the-spurious-waffles.html#cb340-4" aria-hidden="true" tabindex="-1"></a>pred_D <span class="ot">&lt;-</span> <span class="fu">predict</span>(b5<span class="fl">.6</span>, <span class="at">newdata =</span> seq_M, </span>
<span id="cb340-5"><a href="the-many-variables-the-spurious-waffles.html#cb340-5" aria-hidden="true" tabindex="-1"></a>                  <span class="at">resp =</span> <span class="st">&quot;D&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb340-6"><a href="the-many-variables-the-spurious-waffles.html#cb340-6" aria-hidden="true" tabindex="-1"></a>  　　　　<span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb340-7"><a href="the-many-variables-the-spurious-waffles.html#cb340-7" aria-hidden="true" tabindex="-1"></a>          <span class="fu">bind_cols</span>(seq_M)</span>
<span id="cb340-8"><a href="the-many-variables-the-spurious-waffles.html#cb340-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb340-9"><a href="the-many-variables-the-spurious-waffles.html#cb340-9" aria-hidden="true" tabindex="-1"></a>pred_D <span class="sc">%&gt;%</span></span>
<span id="cb340-10"><a href="the-many-variables-the-spurious-waffles.html#cb340-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>M,<span class="at">y =</span> Estimate,<span class="at">ymin =</span> Q2<span class="fl">.5</span>,<span class="at">ymax=</span>Q97<span class="fl">.5</span>))<span class="sc">+</span></span>
<span id="cb340-11"><a href="the-many-variables-the-spurious-waffles.html#cb340-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">size=</span><span class="fl">0.5</span>)<span class="sc">+</span></span>
<span id="cb340-12"><a href="the-many-variables-the-spurious-waffles.html#cb340-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="at">fill =</span> <span class="st">&quot;black&quot;</span>, <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">4</span>)<span class="sc">+</span></span>
<span id="cb340-13"><a href="the-many-variables-the-spurious-waffles.html#cb340-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">&quot;Total counterfactual effect of M on D&quot;</span>,</span>
<span id="cb340-14"><a href="the-many-variables-the-spurious-waffles.html#cb340-14" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">&quot;manipulated M&quot;</span>,</span>
<span id="cb340-15"><a href="the-many-variables-the-spurious-waffles.html#cb340-15" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;counterfactual D&quot;</span>) <span class="sc">+</span></span>
<span id="cb340-16"><a href="the-many-variables-the-spurious-waffles.html#cb340-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">2</span>, <span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb340-17"><a href="the-many-variables-the-spurious-waffles.html#cb340-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb340-18"><a href="the-many-variables-the-spurious-waffles.html#cb340-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb340-19"><a href="the-many-variables-the-spurious-waffles.html#cb340-19" aria-hidden="true" tabindex="-1"></a>        <span class="at">aspect.ratio=</span><span class="dv">1</span>) </span></code></pre></div>
<p><img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-153-1.png" width="672" style="display: block; margin: auto;" />
<br /></p>
<p>predict関数を使わずにやると…</p>
<div class="sourceCode" id="cb341"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb341-1"><a href="the-many-variables-the-spurious-waffles.html#cb341-1" aria-hidden="true" tabindex="-1"></a>post <span class="ot">&lt;-</span> </span>
<span id="cb341-2"><a href="the-many-variables-the-spurious-waffles.html#cb341-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">posterior_samples</span>(b5<span class="fl">.6</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb341-3"><a href="the-many-variables-the-spurious-waffles.html#cb341-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">iter =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">n</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb341-4"><a href="the-many-variables-the-spurious-waffles.html#cb341-4" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>lp__, <span class="sc">-</span><span class="fu">starts_with</span>(<span class="st">&quot;prior&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb341-5"><a href="the-many-variables-the-spurious-waffles.html#cb341-5" aria-hidden="true" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">expand</span>(<span class="fu">nesting</span>(iter, b_M_Intercept, b_M_A, sigma_M, b_D_Intercept, b_D_A, b_D_M, sigma_D), <span class="at">A =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">2</span>,<span class="dv">2</span>,<span class="at">length.out=</span><span class="dv">30</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb341-6"><a href="the-many-variables-the-spurious-waffles.html#cb341-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">M_sim =</span> <span class="fu">rnorm</span>(<span class="fu">n</span>(), </span>
<span id="cb341-7"><a href="the-many-variables-the-spurious-waffles.html#cb341-7" aria-hidden="true" tabindex="-1"></a>                       <span class="at">mean =</span> b_M_Intercept<span class="sc">+</span>b_M_A<span class="sc">*</span>A,</span>
<span id="cb341-8"><a href="the-many-variables-the-spurious-waffles.html#cb341-8" aria-hidden="true" tabindex="-1"></a>                       <span class="at">sd =</span> sigma_M)) <span class="sc">%&gt;%</span> </span>
<span id="cb341-9"><a href="the-many-variables-the-spurious-waffles.html#cb341-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">D_sim =</span> <span class="fu">rnorm</span>(<span class="fu">n</span>(), </span>
<span id="cb341-10"><a href="the-many-variables-the-spurious-waffles.html#cb341-10" aria-hidden="true" tabindex="-1"></a>                       <span class="at">mean =</span> b_D_Intercept<span class="sc">+</span>b_D_A<span class="sc">*</span>A<span class="sc">+</span></span>
<span id="cb341-11"><a href="the-many-variables-the-spurious-waffles.html#cb341-11" aria-hidden="true" tabindex="-1"></a>                              b_D_M<span class="sc">*</span>M_sim,</span>
<span id="cb341-12"><a href="the-many-variables-the-spurious-waffles.html#cb341-12" aria-hidden="true" tabindex="-1"></a>                       <span class="at">sd =</span> sigma_D)) <span class="sc">%&gt;%</span> </span>
<span id="cb341-13"><a href="the-many-variables-the-spurious-waffles.html#cb341-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">ends_with</span>(<span class="st">&quot;sim&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb341-14"><a href="the-many-variables-the-spurious-waffles.html#cb341-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(A,name) <span class="sc">%&gt;%</span> </span>
<span id="cb341-15"><a href="the-many-variables-the-spurious-waffles.html#cb341-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean =</span> <span class="fu">mean</span>(value),</span>
<span id="cb341-16"><a href="the-many-variables-the-spurious-waffles.html#cb341-16" aria-hidden="true" tabindex="-1"></a>            <span class="at">ll =</span> <span class="fu">quantile</span>(value,<span class="at">prob=</span>.<span class="dv">025</span>),</span>
<span id="cb341-17"><a href="the-many-variables-the-spurious-waffles.html#cb341-17" aria-hidden="true" tabindex="-1"></a>            <span class="at">ul =</span> <span class="fu">quantile</span>(value,<span class="at">prob=</span>.<span class="dv">975</span>))</span></code></pre></div>
<p><br /></p>
</div>
</div>
<div id="masked-relationship" class="section level2 hasAnchor" number="5.2">
<h2><span class="header-section-number">5.2</span> Masked relationship<a href="the-many-variables-the-spurious-waffles.html#masked-relationship" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>2つ以上の説明変数を用いることで、見えにくい因果関係を明らかにすることができることがある。<br />
ここでは、霊長類の母乳1グラム当たりのカロリー（K）とメスの体重（M）、大脳新皮質の割合（N）の関係を調べ、大脳新皮質の割合が高いほど母乳の栄養価が高いのかを調べる。</p>
<div class="sourceCode" id="cb342"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb342-1"><a href="the-many-variables-the-spurious-waffles.html#cb342-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(milk)</span>
<span id="cb342-2"><a href="the-many-variables-the-spurious-waffles.html#cb342-2" aria-hidden="true" tabindex="-1"></a>d2 <span class="ot">&lt;-</span> milk</span>
<span id="cb342-3"><a href="the-many-variables-the-spurious-waffles.html#cb342-3" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(milk)</span>
<span id="cb342-4"><a href="the-many-variables-the-spurious-waffles.html#cb342-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb342-5"><a href="the-many-variables-the-spurious-waffles.html#cb342-5" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(d2)</span></code></pre></div>
<pre><code>##              clade            species kcal.per.g perc.fat perc.protein
## 1    Strepsirrhine     Eulemur fulvus       0.49    16.60        15.42
## 2    Strepsirrhine           E macaco       0.51    19.27        16.91
## 3    Strepsirrhine           E mongoz       0.46    14.11        16.85
## 4    Strepsirrhine      E rubriventer       0.48    14.91        13.18
## 5    Strepsirrhine        Lemur catta       0.60    27.28        19.50
## 6 New World Monkey Alouatta seniculus       0.47    21.22        23.58
##   perc.lactose mass neocortex.perc
## 1        67.98 1.95          55.16
## 2        63.82 2.09             NA
## 3        69.04 2.51             NA
## 4        71.91 1.62             NA
## 5        53.22 2.19             NA
## 6        55.20 5.25          64.54</code></pre>
<div class="sourceCode" id="cb344"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb344-1"><a href="the-many-variables-the-spurious-waffles.html#cb344-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 標準化</span></span>
<span id="cb344-2"><a href="the-many-variables-the-spurious-waffles.html#cb344-2" aria-hidden="true" tabindex="-1"></a>d2 <span class="ot">&lt;-</span> d2 <span class="sc">%&gt;%</span> </span>
<span id="cb344-3"><a href="the-many-variables-the-spurious-waffles.html#cb344-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(kcal.per.g, mass, neocortex.perc) <span class="sc">%&gt;%</span> </span>
<span id="cb344-4"><a href="the-many-variables-the-spurious-waffles.html#cb344-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">cal =</span> kcal.per.g,<span class="at">neo =</span>neocortex.perc) <span class="sc">%&gt;%</span> </span>
<span id="cb344-5"><a href="the-many-variables-the-spurious-waffles.html#cb344-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">K =</span> <span class="fu">scale</span>(cal), <span class="at">M =</span> <span class="fu">scale</span>(<span class="fu">log</span>(mass)), </span>
<span id="cb344-6"><a href="the-many-variables-the-spurious-waffles.html#cb344-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">N =</span> <span class="fu">scale</span>(neo))</span></code></pre></div>
<p><br /></p>
<p>ぱっと見たところ、関係があるのかは分かりづらい。</p>
<div class="sourceCode" id="cb345"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb345-1"><a href="the-many-variables-the-spurious-waffles.html#cb345-1" aria-hidden="true" tabindex="-1"></a>d2 <span class="sc">%&gt;%</span> </span>
<span id="cb345-2"><a href="the-many-variables-the-spurious-waffles.html#cb345-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(cal, mass,neo) <span class="sc">%&gt;%</span> </span>
<span id="cb345-3"><a href="the-many-variables-the-spurious-waffles.html#cb345-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pairs</span>()</span></code></pre></div>
<p><img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-157-1.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb346"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb346-1"><a href="the-many-variables-the-spurious-waffles.html#cb346-1" aria-hidden="true" tabindex="-1"></a>d2_2 <span class="ot">&lt;-</span></span>
<span id="cb346-2"><a href="the-many-variables-the-spurious-waffles.html#cb346-2" aria-hidden="true" tabindex="-1"></a>  d2 <span class="sc">%&gt;%</span></span>
<span id="cb346-3"><a href="the-many-variables-the-spurious-waffles.html#cb346-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drop_na</span>(<span class="fu">ends_with</span>(<span class="st">&quot;_s&quot;</span>))</span></code></pre></div>
<p><br /></p>
<div id="k-nモデル" class="section level3 hasAnchor" number="5.2.1">
<h3><span class="header-section-number">5.2.1</span> K ~ Nモデル<a href="the-many-variables-the-spurious-waffles.html#k-nモデル" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>まずは、KとNだけの関係を考慮した単純なモデルを考える。<br />
<span class="math inline">\(K_{i} \sim Normal(\mu_{i}, \sigma)\)</span><br />
<span class="math inline">\(\mu_{i} \sim \alpha + \beta_{N}N_{i}\)</span><br />
<span class="math inline">\(\alpha \sim Normal(0, 1)\)</span><br />
<span class="math inline">\(\beta_{N} \sim Normal(0, 1)\)</span><br />
<br /></p>
<div class="sourceCode" id="cb347"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb347-1"><a href="the-many-variables-the-spurious-waffles.html#cb347-1" aria-hidden="true" tabindex="-1"></a>b5<span class="fl">.7</span>_draft <span class="ot">&lt;-</span> </span>
<span id="cb347-2"><a href="the-many-variables-the-spurious-waffles.html#cb347-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">brm</span>(<span class="at">data =</span> d2_2,</span>
<span id="cb347-3"><a href="the-many-variables-the-spurious-waffles.html#cb347-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> gaussian,</span>
<span id="cb347-4"><a href="the-many-variables-the-spurious-waffles.html#cb347-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">formula =</span> K <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> N,</span>
<span id="cb347-5"><a href="the-many-variables-the-spurious-waffles.html#cb347-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">class =</span> Intercept),</span>
<span id="cb347-6"><a href="the-many-variables-the-spurious-waffles.html#cb347-6" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">class =</span> b),</span>
<span id="cb347-7"><a href="the-many-variables-the-spurious-waffles.html#cb347-7" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>), <span class="at">class =</span> sigma)),</span>
<span id="cb347-8"><a href="the-many-variables-the-spurious-waffles.html#cb347-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>, <span class="at">chains =</span> <span class="dv">4</span>,<span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb347-9"><a href="the-many-variables-the-spurious-waffles.html#cb347-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">seed =</span> <span class="dv">5</span>,</span>
<span id="cb347-10"><a href="the-many-variables-the-spurious-waffles.html#cb347-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">sample_prior =</span> T,</span>
<span id="cb347-11"><a href="the-many-variables-the-spurious-waffles.html#cb347-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">backend =</span> <span class="st">&quot;cmdstanr&quot;</span>,</span>
<span id="cb347-12"><a href="the-many-variables-the-spurious-waffles.html#cb347-12" aria-hidden="true" tabindex="-1"></a>      <span class="at">file =</span> <span class="st">&quot;output/Chapter5/b5.7_draft&quot;</span>)</span>
<span id="cb347-13"><a href="the-many-variables-the-spurious-waffles.html#cb347-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb347-14"><a href="the-many-variables-the-spurious-waffles.html#cb347-14" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(b5<span class="fl">.7</span>_draft)</span></code></pre></div>
<pre><code>##  Family: gaussian 
##   Links: mu = identity; sigma = identity 
## Formula: K ~ 1 + N 
##    Data: d2_2 (Number of observations: 17) 
##   Draws: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
##          total post-warmup draws = 4000
## 
## Population-Level Effects: 
##           Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## Intercept     0.09      0.26    -0.44     0.59 1.00     3031     2316
## N             0.16      0.27    -0.38     0.70 1.00     3402     2565
## 
## Family Specific Parameters: 
##       Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## sigma     1.14      0.21     0.81     1.62 1.00     3229     2877
## 
## Draws were sampled using sample(hmc). For each parameter, Bulk_ESS
## and Tail_ESS are effective sample size measures, and Rhat is the potential
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<div class="sourceCode" id="cb349"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb349-1"><a href="the-many-variables-the-spurious-waffles.html#cb349-1" aria-hidden="true" tabindex="-1"></a><span class="fu">pairs</span>(b5<span class="fl">.7</span>_draft)</span></code></pre></div>
<p><img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-158-1.png" width="672" style="display: block; margin: auto;" />
<br /></p>
<p>事前分布が適切かを考える。<br />
かなり実際とはかけ離れていそう。</p>
<div class="sourceCode" id="cb350"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb350-1"><a href="the-many-variables-the-spurious-waffles.html#cb350-1" aria-hidden="true" tabindex="-1"></a><span class="fu">prior_samples</span>(b5<span class="fl">.7</span>_draft, <span class="at">summary =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb350-2"><a href="the-many-variables-the-spurious-waffles.html#cb350-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb350-3"><a href="the-many-variables-the-spurious-waffles.html#cb350-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb350-4"><a href="the-many-variables-the-spurious-waffles.html#cb350-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_sample</span>(<span class="at">n=</span><span class="dv">50</span>) <span class="sc">%&gt;%</span></span>
<span id="cb350-5"><a href="the-many-variables-the-spurious-waffles.html#cb350-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">iter =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">n</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb350-6"><a href="the-many-variables-the-spurious-waffles.html#cb350-6" aria-hidden="true" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">expand</span>(<span class="fu">nesting</span>(Intercept, b, iter), </span>
<span id="cb350-7"><a href="the-many-variables-the-spurious-waffles.html#cb350-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">N =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">2</span>,<span class="dv">2</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb350-8"><a href="the-many-variables-the-spurious-waffles.html#cb350-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">K =</span> Intercept <span class="sc">+</span> b<span class="sc">*</span>N) <span class="sc">%&gt;%</span> </span>
<span id="cb350-9"><a href="the-many-variables-the-spurious-waffles.html#cb350-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>N, <span class="at">y =</span> K))<span class="sc">+</span></span>
<span id="cb350-10"><a href="the-many-variables-the-spurious-waffles.html#cb350-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">group =</span> iter),</span>
<span id="cb350-11"><a href="the-many-variables-the-spurious-waffles.html#cb350-11" aria-hidden="true" tabindex="-1"></a>              <span class="at">color =</span> <span class="st">&quot;grey33&quot;</span>, <span class="at">alpha =</span> <span class="dv">3</span><span class="sc">/</span><span class="dv">4</span>)<span class="sc">+</span></span>
<span id="cb350-12"><a href="the-many-variables-the-spurious-waffles.html#cb350-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="st">&quot;neocortex percent (std)&quot;</span>,</span>
<span id="cb350-13"><a href="the-many-variables-the-spurious-waffles.html#cb350-13" aria-hidden="true" tabindex="-1"></a>                     <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">2</span>,<span class="dv">2</span>,<span class="at">by=</span><span class="dv">1</span>))<span class="sc">+</span></span>
<span id="cb350-14"><a href="the-many-variables-the-spurious-waffles.html#cb350-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="st">&quot;kilocal per g (std)&quot;</span>,</span>
<span id="cb350-15"><a href="the-many-variables-the-spurious-waffles.html#cb350-15" aria-hidden="true" tabindex="-1"></a>                     <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">2</span>,<span class="dv">2</span>,<span class="at">by=</span><span class="dv">1</span>))<span class="sc">+</span></span>
<span id="cb350-16"><a href="the-many-variables-the-spurious-waffles.html#cb350-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">2</span>,<span class="dv">2</span>))<span class="sc">+</span></span>
<span id="cb350-17"><a href="the-many-variables-the-spurious-waffles.html#cb350-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()<span class="sc">+</span></span>
<span id="cb350-18"><a href="the-many-variables-the-spurious-waffles.html#cb350-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">&quot;a ~ dnorm(0,1)</span><span class="sc">\n</span><span class="st">b = dnorm(0,1)&quot;</span>)<span class="sc">+</span></span>
<span id="cb350-19"><a href="the-many-variables-the-spurious-waffles.html#cb350-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">aspect.ratio=</span><span class="dv">1</span>) <span class="ot">-&gt;</span> p9</span>
<span id="cb350-20"><a href="the-many-variables-the-spurious-waffles.html#cb350-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb350-21"><a href="the-many-variables-the-spurious-waffles.html#cb350-21" aria-hidden="true" tabindex="-1"></a>p9</span></code></pre></div>
<p><img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-159-1.png" width="672" style="display: block; margin: auto;" />
<br /></p>
<p>もう少し事前分布の幅を小さくしてみる。<br />
今度はよさそう。</p>
<div class="sourceCode" id="cb351"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb351-1"><a href="the-many-variables-the-spurious-waffles.html#cb351-1" aria-hidden="true" tabindex="-1"></a>b5<span class="fl">.7</span>_t <span class="ot">&lt;-</span> </span>
<span id="cb351-2"><a href="the-many-variables-the-spurious-waffles.html#cb351-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">brm</span>(<span class="at">data =</span> d2_2,</span>
<span id="cb351-3"><a href="the-many-variables-the-spurious-waffles.html#cb351-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> gaussian,</span>
<span id="cb351-4"><a href="the-many-variables-the-spurious-waffles.html#cb351-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">formula =</span> K <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> N,</span>
<span id="cb351-5"><a href="the-many-variables-the-spurious-waffles.html#cb351-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>,<span class="fl">0.2</span>),<span class="at">class =</span> Intercept),</span>
<span id="cb351-6"><a href="the-many-variables-the-spurious-waffles.html#cb351-6" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>,<span class="fl">0.5</span>), <span class="at">class =</span> b),</span>
<span id="cb351-7"><a href="the-many-variables-the-spurious-waffles.html#cb351-7" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>), <span class="at">class =</span> sigma)),</span>
<span id="cb351-8"><a href="the-many-variables-the-spurious-waffles.html#cb351-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>, <span class="at">chains =</span> <span class="dv">4</span>,<span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb351-9"><a href="the-many-variables-the-spurious-waffles.html#cb351-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">seed =</span> <span class="dv">5</span>,</span>
<span id="cb351-10"><a href="the-many-variables-the-spurious-waffles.html#cb351-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">sample_prior =</span> T,</span>
<span id="cb351-11"><a href="the-many-variables-the-spurious-waffles.html#cb351-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">backend =</span> <span class="st">&quot;cmdstanr&quot;</span>,</span>
<span id="cb351-12"><a href="the-many-variables-the-spurious-waffles.html#cb351-12" aria-hidden="true" tabindex="-1"></a>      <span class="at">file =</span> <span class="st">&quot;output/Chapter5/b5.7_t&quot;</span>)</span>
<span id="cb351-13"><a href="the-many-variables-the-spurious-waffles.html#cb351-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb351-14"><a href="the-many-variables-the-spurious-waffles.html#cb351-14" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(b5<span class="fl">.7</span>_t)</span></code></pre></div>
<pre><code>##  Family: gaussian 
##   Links: mu = identity; sigma = identity 
## Formula: K ~ 1 + N 
##    Data: d2_2 (Number of observations: 17) 
##   Draws: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
##          total post-warmup draws = 4000
## 
## Population-Level Effects: 
##           Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## Intercept     0.04      0.16    -0.29     0.35 1.00     3778     2736
## N             0.12      0.25    -0.38     0.60 1.00     3510     2586
## 
## Family Specific Parameters: 
##       Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## sigma     1.11      0.20     0.80     1.57 1.00     3662     2969
## 
## Draws were sampled using sample(hmc). For each parameter, Bulk_ESS
## and Tail_ESS are effective sample size measures, and Rhat is the potential
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<div class="sourceCode" id="cb353"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb353-1"><a href="the-many-variables-the-spurious-waffles.html#cb353-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(b5<span class="fl">.7</span>_draft)</span></code></pre></div>
<pre><code>##  Family: gaussian 
##   Links: mu = identity; sigma = identity 
## Formula: K ~ 1 + N 
##    Data: d2_2 (Number of observations: 17) 
##   Draws: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
##          total post-warmup draws = 4000
## 
## Population-Level Effects: 
##           Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## Intercept     0.09      0.26    -0.44     0.59 1.00     3031     2316
## N             0.16      0.27    -0.38     0.70 1.00     3402     2565
## 
## Family Specific Parameters: 
##       Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## sigma     1.14      0.21     0.81     1.62 1.00     3229     2877
## 
## Draws were sampled using sample(hmc). For each parameter, Bulk_ESS
## and Tail_ESS are effective sample size measures, and Rhat is the potential
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<div class="sourceCode" id="cb355"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb355-1"><a href="the-many-variables-the-spurious-waffles.html#cb355-1" aria-hidden="true" tabindex="-1"></a><span class="fu">prior_samples</span>(b5<span class="fl">.7</span>_t, <span class="at">summary =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb355-2"><a href="the-many-variables-the-spurious-waffles.html#cb355-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb355-3"><a href="the-many-variables-the-spurious-waffles.html#cb355-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb355-4"><a href="the-many-variables-the-spurious-waffles.html#cb355-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_sample</span>(<span class="at">n=</span><span class="dv">50</span>) <span class="sc">%&gt;%</span></span>
<span id="cb355-5"><a href="the-many-variables-the-spurious-waffles.html#cb355-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">iter =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">n</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb355-6"><a href="the-many-variables-the-spurious-waffles.html#cb355-6" aria-hidden="true" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">expand</span>(<span class="fu">nesting</span>(Intercept, b, iter), </span>
<span id="cb355-7"><a href="the-many-variables-the-spurious-waffles.html#cb355-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">N =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">2</span>,<span class="dv">2</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb355-8"><a href="the-many-variables-the-spurious-waffles.html#cb355-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">K =</span> Intercept <span class="sc">+</span> b<span class="sc">*</span>N) <span class="sc">%&gt;%</span> </span>
<span id="cb355-9"><a href="the-many-variables-the-spurious-waffles.html#cb355-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>N, <span class="at">y =</span> K))<span class="sc">+</span></span>
<span id="cb355-10"><a href="the-many-variables-the-spurious-waffles.html#cb355-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">group =</span> iter),</span>
<span id="cb355-11"><a href="the-many-variables-the-spurious-waffles.html#cb355-11" aria-hidden="true" tabindex="-1"></a>              <span class="at">color =</span> <span class="st">&quot;grey33&quot;</span>, <span class="at">alpha =</span> <span class="dv">3</span><span class="sc">/</span><span class="dv">4</span>)<span class="sc">+</span></span>
<span id="cb355-12"><a href="the-many-variables-the-spurious-waffles.html#cb355-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="st">&quot;neocortex percent (std)&quot;</span>,</span>
<span id="cb355-13"><a href="the-many-variables-the-spurious-waffles.html#cb355-13" aria-hidden="true" tabindex="-1"></a>                     <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">2</span>,<span class="dv">2</span>,<span class="at">by=</span><span class="dv">1</span>))<span class="sc">+</span></span>
<span id="cb355-14"><a href="the-many-variables-the-spurious-waffles.html#cb355-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="st">&quot;kilocal per g (std)&quot;</span>,</span>
<span id="cb355-15"><a href="the-many-variables-the-spurious-waffles.html#cb355-15" aria-hidden="true" tabindex="-1"></a>                     <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">2</span>,<span class="dv">2</span>,<span class="at">by=</span><span class="dv">1</span>))<span class="sc">+</span></span>
<span id="cb355-16"><a href="the-many-variables-the-spurious-waffles.html#cb355-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">2</span>,<span class="dv">2</span>))<span class="sc">+</span></span>
<span id="cb355-17"><a href="the-many-variables-the-spurious-waffles.html#cb355-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()<span class="sc">+</span></span>
<span id="cb355-18"><a href="the-many-variables-the-spurious-waffles.html#cb355-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">&quot;a ~ dnorm(0,0.2)</span><span class="sc">\n</span><span class="st">b = dnorm(0,5)&quot;</span>)<span class="sc">+</span></span>
<span id="cb355-19"><a href="the-many-variables-the-spurious-waffles.html#cb355-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">aspect.ratio=</span><span class="dv">1</span>)　<span class="ot">-&gt;</span> p10</span>
<span id="cb355-20"><a href="the-many-variables-the-spurious-waffles.html#cb355-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb355-21"><a href="the-many-variables-the-spurious-waffles.html#cb355-21" aria-hidden="true" tabindex="-1"></a>p10</span></code></pre></div>
<p><img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-160-1.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb356"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb356-1"><a href="the-many-variables-the-spurious-waffles.html#cb356-1" aria-hidden="true" tabindex="-1"></a>p9<span class="sc">|</span>p10</span></code></pre></div>
<p><img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-160-2.png" width="672" style="display: block; margin: auto;" /></p>
<p><br /></p>
<p>推定結果も少し異なり、b5.7_tの方がより事後分布の標準偏差が小さくなっている。</p>
<div class="sourceCode" id="cb357"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb357-1"><a href="the-many-variables-the-spurious-waffles.html#cb357-1" aria-hidden="true" tabindex="-1"></a><span class="fu">bind_rows</span>(</span>
<span id="cb357-2"><a href="the-many-variables-the-spurious-waffles.html#cb357-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">posterior_samples</span>(b5<span class="fl">.7</span>_draft) <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">select</span>(b_Intercept<span class="sc">:</span>sigma),</span>
<span id="cb357-3"><a href="the-many-variables-the-spurious-waffles.html#cb357-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">posterior_samples</span>(b5<span class="fl">.7</span>_t) <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">select</span>(b_Intercept<span class="sc">:</span>sigma)</span>
<span id="cb357-4"><a href="the-many-variables-the-spurious-waffles.html#cb357-4" aria-hidden="true" tabindex="-1"></a>  )  <span class="sc">%&gt;%</span> </span>
<span id="cb357-5"><a href="the-many-variables-the-spurious-waffles.html#cb357-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">fit =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">&quot;b5.5_draft&quot;</span>, <span class="st">&quot;b5.5_t&quot;</span>), <span class="at">each =</span> <span class="fu">n</span>() <span class="sc">/</span> <span class="dv">2</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb357-6"><a href="the-many-variables-the-spurious-waffles.html#cb357-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span>fit) <span class="sc">%&gt;%</span> </span>
<span id="cb357-7"><a href="the-many-variables-the-spurious-waffles.html#cb357-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(name, fit) <span class="sc">%&gt;%</span> </span>
<span id="cb357-8"><a href="the-many-variables-the-spurious-waffles.html#cb357-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean =</span> <span class="fu">mean</span>(value),</span>
<span id="cb357-9"><a href="the-many-variables-the-spurious-waffles.html#cb357-9" aria-hidden="true" tabindex="-1"></a>            <span class="at">ll =</span> <span class="fu">quantile</span>(value, <span class="at">prob =</span> .<span class="dv">025</span>),</span>
<span id="cb357-10"><a href="the-many-variables-the-spurious-waffles.html#cb357-10" aria-hidden="true" tabindex="-1"></a>            <span class="at">ul =</span> <span class="fu">quantile</span>(value, <span class="at">prob =</span> .<span class="dv">975</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb357-11"><a href="the-many-variables-the-spurious-waffles.html#cb357-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">fit =</span> <span class="fu">factor</span>(fit, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&quot;b5.5_draft&quot;</span>, <span class="st">&quot;b5.5_t&quot;</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb357-12"><a href="the-many-variables-the-spurious-waffles.html#cb357-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb357-13"><a href="the-many-variables-the-spurious-waffles.html#cb357-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># plot</span></span>
<span id="cb357-14"><a href="the-many-variables-the-spurious-waffles.html#cb357-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> mean, <span class="at">y =</span> fit, <span class="at">xmin =</span> ll, <span class="at">xmax =</span> ul)) <span class="sc">+</span></span>
<span id="cb357-15"><a href="the-many-variables-the-spurious-waffles.html#cb357-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_pointrange</span>(<span class="at">color =</span> <span class="st">&quot;firebrick&quot;</span>) <span class="sc">+</span></span>
<span id="cb357-16"><a href="the-many-variables-the-spurious-waffles.html#cb357-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">color =</span> <span class="st">&quot;firebrick&quot;</span>, <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">5</span>) <span class="sc">+</span></span>
<span id="cb357-17"><a href="the-many-variables-the-spurious-waffles.html#cb357-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;posterior&quot;</span>, </span>
<span id="cb357-18"><a href="the-many-variables-the-spurious-waffles.html#cb357-18" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb357-19"><a href="the-many-variables-the-spurious-waffles.html#cb357-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb357-20"><a href="the-many-variables-the-spurious-waffles.html#cb357-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="dv">0</span>),</span>
<span id="cb357-21"><a href="the-many-variables-the-spurious-waffles.html#cb357-21" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.ticks.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb357-22"><a href="the-many-variables-the-spurious-waffles.html#cb357-22" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb357-23"><a href="the-many-variables-the-spurious-waffles.html#cb357-23" aria-hidden="true" tabindex="-1"></a>        <span class="at">strip.background =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb357-24"><a href="the-many-variables-the-spurious-waffles.html#cb357-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> name, <span class="at">ncol =</span> <span class="dv">1</span>)</span></code></pre></div>
<p><img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-161-1.png" width="672" style="display: block; margin: auto;" />
<br /></p>
<p>事後分布から信用区間と予測区間を作図。<br />
かなり微妙な変化…。</p>
<div class="sourceCode" id="cb358"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb358-1"><a href="the-many-variables-the-spurious-waffles.html#cb358-1" aria-hidden="true" tabindex="-1"></a>seq_N <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">N=</span><span class="fu">seq</span>(<span class="sc">-</span><span class="dv">2</span>,<span class="dv">2</span>,<span class="at">length.out =</span> <span class="dv">100</span>))</span>
<span id="cb358-2"><a href="the-many-variables-the-spurious-waffles.html#cb358-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb358-3"><a href="the-many-variables-the-spurious-waffles.html#cb358-3" aria-hidden="true" tabindex="-1"></a>fit_b57 <span class="ot">&lt;-</span> <span class="fu">fitted</span>(b5<span class="fl">.7</span>_t, </span>
<span id="cb358-4"><a href="the-many-variables-the-spurious-waffles.html#cb358-4" aria-hidden="true" tabindex="-1"></a>                  <span class="at">newdata =</span> seq_N,</span>
<span id="cb358-5"><a href="the-many-variables-the-spurious-waffles.html#cb358-5" aria-hidden="true" tabindex="-1"></a>                  <span class="at">prob =</span> <span class="fu">c</span>(.<span class="dv">055</span>,.<span class="dv">945</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb358-6"><a href="the-many-variables-the-spurious-waffles.html#cb358-6" aria-hidden="true" tabindex="-1"></a>           <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb358-7"><a href="the-many-variables-the-spurious-waffles.html#cb358-7" aria-hidden="true" tabindex="-1"></a>           <span class="fu">bind_cols</span>(seq_N)</span>
<span id="cb358-8"><a href="the-many-variables-the-spurious-waffles.html#cb358-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb358-9"><a href="the-many-variables-the-spurious-waffles.html#cb358-9" aria-hidden="true" tabindex="-1"></a>predict_b57 <span class="ot">&lt;-</span> <span class="fu">predict</span>(b5<span class="fl">.7</span>_t, </span>
<span id="cb358-10"><a href="the-many-variables-the-spurious-waffles.html#cb358-10" aria-hidden="true" tabindex="-1"></a>                  <span class="at">newdata =</span> seq_N,</span>
<span id="cb358-11"><a href="the-many-variables-the-spurious-waffles.html#cb358-11" aria-hidden="true" tabindex="-1"></a>                  <span class="at">prob =</span> <span class="fu">c</span>(.<span class="dv">055</span>,.<span class="dv">945</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb358-12"><a href="the-many-variables-the-spurious-waffles.html#cb358-12" aria-hidden="true" tabindex="-1"></a>           <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb358-13"><a href="the-many-variables-the-spurious-waffles.html#cb358-13" aria-hidden="true" tabindex="-1"></a>           <span class="fu">bind_cols</span>(seq_N)</span>
<span id="cb358-14"><a href="the-many-variables-the-spurious-waffles.html#cb358-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb358-15"><a href="the-many-variables-the-spurious-waffles.html#cb358-15" aria-hidden="true" tabindex="-1"></a>d2_2 <span class="sc">%&gt;%</span> </span>
<span id="cb358-16"><a href="the-many-variables-the-spurious-waffles.html#cb358-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>N,<span class="at">y=</span>K))<span class="sc">+</span></span>
<span id="cb358-17"><a href="the-many-variables-the-spurious-waffles.html#cb358-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size=</span><span class="dv">3</span>,<span class="at">shape=</span><span class="dv">1</span>,<span class="at">color=</span><span class="st">&quot;navyblue&quot;</span>)<span class="sc">+</span></span>
<span id="cb358-18"><a href="the-many-variables-the-spurious-waffles.html#cb358-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="at">data =</span> fit_b57,<span class="fu">aes</span>(<span class="at">y =</span> Estimate,</span>
<span id="cb358-19"><a href="the-many-variables-the-spurious-waffles.html#cb358-19" aria-hidden="true" tabindex="-1"></a>                                <span class="at">ymin =</span> Q5<span class="fl">.5</span>,</span>
<span id="cb358-20"><a href="the-many-variables-the-spurious-waffles.html#cb358-20" aria-hidden="true" tabindex="-1"></a>                                <span class="at">ymax  =</span> Q94<span class="fl">.5</span>),</span>
<span id="cb358-21"><a href="the-many-variables-the-spurious-waffles.html#cb358-21" aria-hidden="true" tabindex="-1"></a>              <span class="at">fill =</span> <span class="st">&quot;black&quot;</span>, <span class="at">alpha =</span> <span class="dv">3</span><span class="sc">/</span><span class="dv">8</span>)<span class="sc">+</span></span>
<span id="cb358-22"><a href="the-many-variables-the-spurious-waffles.html#cb358-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="at">data =</span> predict_b57,<span class="fu">aes</span>(<span class="at">y =</span> Estimate,</span>
<span id="cb358-23"><a href="the-many-variables-the-spurious-waffles.html#cb358-23" aria-hidden="true" tabindex="-1"></a>                                <span class="at">ymin =</span> Q5<span class="fl">.5</span>,</span>
<span id="cb358-24"><a href="the-many-variables-the-spurious-waffles.html#cb358-24" aria-hidden="true" tabindex="-1"></a>                                <span class="at">ymax  =</span> Q94<span class="fl">.5</span>),</span>
<span id="cb358-25"><a href="the-many-variables-the-spurious-waffles.html#cb358-25" aria-hidden="true" tabindex="-1"></a>              <span class="at">fill =</span> <span class="st">&quot;black&quot;</span>, <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">8</span>)<span class="sc">+</span></span>
<span id="cb358-26"><a href="the-many-variables-the-spurious-waffles.html#cb358-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> fit_b57,<span class="fu">aes</span>(<span class="at">y =</span> Estimate,</span>
<span id="cb358-27"><a href="the-many-variables-the-spurious-waffles.html#cb358-27" aria-hidden="true" tabindex="-1"></a>                                <span class="at">x =</span> N))<span class="sc">+</span></span>
<span id="cb358-28"><a href="the-many-variables-the-spurious-waffles.html#cb358-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="st">&quot;neocortex percent (std)&quot;</span>,</span>
<span id="cb358-29"><a href="the-many-variables-the-spurious-waffles.html#cb358-29" aria-hidden="true" tabindex="-1"></a>                     <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">2</span>,<span class="dv">2</span>,<span class="at">by=</span><span class="dv">1</span>))<span class="sc">+</span></span>
<span id="cb358-30"><a href="the-many-variables-the-spurious-waffles.html#cb358-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="st">&quot;kilocal per g (std)&quot;</span>,</span>
<span id="cb358-31"><a href="the-many-variables-the-spurious-waffles.html#cb358-31" aria-hidden="true" tabindex="-1"></a>                     <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">1</span>,<span class="dv">2</span>,<span class="at">by=</span><span class="dv">1</span>))<span class="sc">+</span></span>
<span id="cb358-32"><a href="the-many-variables-the-spurious-waffles.html#cb358-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()<span class="sc">+</span></span>
<span id="cb358-33"><a href="the-many-variables-the-spurious-waffles.html#cb358-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb358-34"><a href="the-many-variables-the-spurious-waffles.html#cb358-34" aria-hidden="true" tabindex="-1"></a>        <span class="at">aspect.ratio =</span> <span class="dv">1</span>) <span class="ot">-&gt;</span> p11</span>
<span id="cb358-35"><a href="the-many-variables-the-spurious-waffles.html#cb358-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb358-36"><a href="the-many-variables-the-spurious-waffles.html#cb358-36" aria-hidden="true" tabindex="-1"></a>p11  </span></code></pre></div>
<p><img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-162-1.png" width="672" style="display: block; margin: auto;" />
<br />　　</p>
</div>
<div id="k-mモデル" class="section level3 hasAnchor" number="5.2.2">
<h3><span class="header-section-number">5.2.2</span> K ~ Mモデル<a href="the-many-variables-the-spurious-waffles.html#k-mモデル" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>次に、メスの体重(M)と母乳のカロリー（K）の関係を考える。　　</p>
<div class="sourceCode" id="cb359"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb359-1"><a href="the-many-variables-the-spurious-waffles.html#cb359-1" aria-hidden="true" tabindex="-1"></a>b5<span class="fl">.8</span>_t <span class="ot">&lt;-</span> </span>
<span id="cb359-2"><a href="the-many-variables-the-spurious-waffles.html#cb359-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">brm</span>(<span class="at">data =</span> d2_2,</span>
<span id="cb359-3"><a href="the-many-variables-the-spurious-waffles.html#cb359-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> gaussian,</span>
<span id="cb359-4"><a href="the-many-variables-the-spurious-waffles.html#cb359-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">formula =</span> K <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> M,</span>
<span id="cb359-5"><a href="the-many-variables-the-spurious-waffles.html#cb359-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>,<span class="fl">0.2</span>),<span class="at">class =</span> Intercept),</span>
<span id="cb359-6"><a href="the-many-variables-the-spurious-waffles.html#cb359-6" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>,<span class="fl">0.5</span>), <span class="at">class =</span> b),</span>
<span id="cb359-7"><a href="the-many-variables-the-spurious-waffles.html#cb359-7" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>), <span class="at">class =</span> sigma)),</span>
<span id="cb359-8"><a href="the-many-variables-the-spurious-waffles.html#cb359-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>, <span class="at">chains =</span> <span class="dv">4</span>,<span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb359-9"><a href="the-many-variables-the-spurious-waffles.html#cb359-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">seed =</span> <span class="dv">5</span>,</span>
<span id="cb359-10"><a href="the-many-variables-the-spurious-waffles.html#cb359-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">sample_prior =</span> T,</span>
<span id="cb359-11"><a href="the-many-variables-the-spurious-waffles.html#cb359-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">backend =</span> <span class="st">&quot;cmdstanr&quot;</span>,</span>
<span id="cb359-12"><a href="the-many-variables-the-spurious-waffles.html#cb359-12" aria-hidden="true" tabindex="-1"></a>      <span class="at">file =</span> <span class="st">&quot;output/Chapter5/b5.8_t&quot;</span>)</span>
<span id="cb359-13"><a href="the-many-variables-the-spurious-waffles.html#cb359-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb359-14"><a href="the-many-variables-the-spurious-waffles.html#cb359-14" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(b5<span class="fl">.8</span>_t)</span></code></pre></div>
<pre><code>##  Family: gaussian 
##   Links: mu = identity; sigma = identity 
## Formula: K ~ 1 + M 
##    Data: d2_2 (Number of observations: 29) 
##   Draws: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
##          total post-warmup draws = 4000
## 
## Population-Level Effects: 
##           Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## Intercept     0.00      0.13    -0.26     0.26 1.00     4025     2916
## M            -0.29      0.17    -0.63     0.05 1.00     3524     2380
## 
## Family Specific Parameters: 
##       Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## sigma     0.98      0.14     0.75     1.28 1.00     3585     2874
## 
## Draws were sampled using sample(hmc). For each parameter, Bulk_ESS
## and Tail_ESS are effective sample size measures, and Rhat is the potential
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<p><br /></p>
<p>強くはないが、負の関係がありそう？</p>
<div class="sourceCode" id="cb361"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb361-1"><a href="the-many-variables-the-spurious-waffles.html#cb361-1" aria-hidden="true" tabindex="-1"></a>seq_M <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">M=</span><span class="fu">seq</span>(<span class="sc">-</span><span class="dv">2</span>,<span class="dv">2</span>,<span class="at">length.out =</span> <span class="dv">100</span>))</span>
<span id="cb361-2"><a href="the-many-variables-the-spurious-waffles.html#cb361-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb361-3"><a href="the-many-variables-the-spurious-waffles.html#cb361-3" aria-hidden="true" tabindex="-1"></a>fit_b58 <span class="ot">&lt;-</span> <span class="fu">fitted</span>(b5<span class="fl">.8</span>_t, </span>
<span id="cb361-4"><a href="the-many-variables-the-spurious-waffles.html#cb361-4" aria-hidden="true" tabindex="-1"></a>                  <span class="at">newdata =</span> seq_M,</span>
<span id="cb361-5"><a href="the-many-variables-the-spurious-waffles.html#cb361-5" aria-hidden="true" tabindex="-1"></a>                  <span class="at">prob =</span> <span class="fu">c</span>(.<span class="dv">055</span>,.<span class="dv">945</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb361-6"><a href="the-many-variables-the-spurious-waffles.html#cb361-6" aria-hidden="true" tabindex="-1"></a>           <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb361-7"><a href="the-many-variables-the-spurious-waffles.html#cb361-7" aria-hidden="true" tabindex="-1"></a>           <span class="fu">bind_cols</span>(seq_M)</span>
<span id="cb361-8"><a href="the-many-variables-the-spurious-waffles.html#cb361-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb361-9"><a href="the-many-variables-the-spurious-waffles.html#cb361-9" aria-hidden="true" tabindex="-1"></a>predict_b58 <span class="ot">&lt;-</span> <span class="fu">predict</span>(b5<span class="fl">.8</span>_t, </span>
<span id="cb361-10"><a href="the-many-variables-the-spurious-waffles.html#cb361-10" aria-hidden="true" tabindex="-1"></a>                  <span class="at">newdata =</span> seq_M,</span>
<span id="cb361-11"><a href="the-many-variables-the-spurious-waffles.html#cb361-11" aria-hidden="true" tabindex="-1"></a>                  <span class="at">prob =</span> <span class="fu">c</span>(.<span class="dv">055</span>,.<span class="dv">945</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb361-12"><a href="the-many-variables-the-spurious-waffles.html#cb361-12" aria-hidden="true" tabindex="-1"></a>           <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb361-13"><a href="the-many-variables-the-spurious-waffles.html#cb361-13" aria-hidden="true" tabindex="-1"></a>           <span class="fu">bind_cols</span>(seq_M)</span>
<span id="cb361-14"><a href="the-many-variables-the-spurious-waffles.html#cb361-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb361-15"><a href="the-many-variables-the-spurious-waffles.html#cb361-15" aria-hidden="true" tabindex="-1"></a>d2_2 <span class="sc">%&gt;%</span> </span>
<span id="cb361-16"><a href="the-many-variables-the-spurious-waffles.html#cb361-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>M,<span class="at">y=</span>K))<span class="sc">+</span></span>
<span id="cb361-17"><a href="the-many-variables-the-spurious-waffles.html#cb361-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size=</span><span class="dv">3</span>,<span class="at">shape=</span><span class="dv">1</span>,<span class="at">color=</span><span class="st">&quot;navyblue&quot;</span>)<span class="sc">+</span></span>
<span id="cb361-18"><a href="the-many-variables-the-spurious-waffles.html#cb361-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="at">data =</span> fit_b58,<span class="fu">aes</span>(<span class="at">y =</span> Estimate,</span>
<span id="cb361-19"><a href="the-many-variables-the-spurious-waffles.html#cb361-19" aria-hidden="true" tabindex="-1"></a>                                <span class="at">ymin =</span> Q5<span class="fl">.5</span>,</span>
<span id="cb361-20"><a href="the-many-variables-the-spurious-waffles.html#cb361-20" aria-hidden="true" tabindex="-1"></a>                                <span class="at">ymax  =</span> Q94<span class="fl">.5</span>),</span>
<span id="cb361-21"><a href="the-many-variables-the-spurious-waffles.html#cb361-21" aria-hidden="true" tabindex="-1"></a>              <span class="at">fill =</span> <span class="st">&quot;black&quot;</span>, <span class="at">alpha =</span> <span class="dv">3</span><span class="sc">/</span><span class="dv">8</span>)<span class="sc">+</span></span>
<span id="cb361-22"><a href="the-many-variables-the-spurious-waffles.html#cb361-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="at">data =</span> predict_b58,<span class="fu">aes</span>(<span class="at">y =</span> Estimate,</span>
<span id="cb361-23"><a href="the-many-variables-the-spurious-waffles.html#cb361-23" aria-hidden="true" tabindex="-1"></a>                                <span class="at">ymin =</span> Q5<span class="fl">.5</span>,</span>
<span id="cb361-24"><a href="the-many-variables-the-spurious-waffles.html#cb361-24" aria-hidden="true" tabindex="-1"></a>                                <span class="at">ymax  =</span> Q94<span class="fl">.5</span>),</span>
<span id="cb361-25"><a href="the-many-variables-the-spurious-waffles.html#cb361-25" aria-hidden="true" tabindex="-1"></a>              <span class="at">fill =</span> <span class="st">&quot;black&quot;</span>, <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">8</span>)<span class="sc">+</span></span>
<span id="cb361-26"><a href="the-many-variables-the-spurious-waffles.html#cb361-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> fit_b58,<span class="fu">aes</span>(<span class="at">y =</span> Estimate,</span>
<span id="cb361-27"><a href="the-many-variables-the-spurious-waffles.html#cb361-27" aria-hidden="true" tabindex="-1"></a>                                <span class="at">x =</span> M))<span class="sc">+</span></span>
<span id="cb361-28"><a href="the-many-variables-the-spurious-waffles.html#cb361-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="st">&quot;log body mass (std)&quot;</span>,</span>
<span id="cb361-29"><a href="the-many-variables-the-spurious-waffles.html#cb361-29" aria-hidden="true" tabindex="-1"></a>                     <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">2</span>,<span class="dv">2</span>,<span class="at">by=</span><span class="dv">1</span>))<span class="sc">+</span></span>
<span id="cb361-30"><a href="the-many-variables-the-spurious-waffles.html#cb361-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="st">&quot;kilocal per g (std)&quot;</span>,</span>
<span id="cb361-31"><a href="the-many-variables-the-spurious-waffles.html#cb361-31" aria-hidden="true" tabindex="-1"></a>                     <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">1</span>,<span class="dv">2</span>,<span class="at">by=</span><span class="fl">0.5</span>))<span class="sc">+</span></span>
<span id="cb361-32"><a href="the-many-variables-the-spurious-waffles.html#cb361-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim=</span><span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>,<span class="dv">2</span>))<span class="sc">+</span></span>
<span id="cb361-33"><a href="the-many-variables-the-spurious-waffles.html#cb361-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()<span class="sc">+</span></span>
<span id="cb361-34"><a href="the-many-variables-the-spurious-waffles.html#cb361-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb361-35"><a href="the-many-variables-the-spurious-waffles.html#cb361-35" aria-hidden="true" tabindex="-1"></a>        <span class="at">aspect.ratio =</span> <span class="dv">1</span>) <span class="ot">-&gt;</span> p12</span>
<span id="cb361-36"><a href="the-many-variables-the-spurious-waffles.html#cb361-36" aria-hidden="true" tabindex="-1"></a>p12</span></code></pre></div>
<p><img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-164-1.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb362"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb362-1"><a href="the-many-variables-the-spurious-waffles.html#cb362-1" aria-hidden="true" tabindex="-1"></a>(p11<span class="sc">|</span>p12)</span></code></pre></div>
<p><img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-164-2.png" width="672" style="display: block; margin: auto;" />
<br /></p>
</div>
<div id="k-n-mモデル" class="section level3 hasAnchor" number="5.2.3">
<h3><span class="header-section-number">5.2.3</span> K ~ N + Mモデル<a href="the-many-variables-the-spurious-waffles.html#k-n-mモデル" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>それでは、両方の説明変数を入れるモデルを考える。<br />
モデル式は以下の通り。</p>
<p><span class="math inline">\(K_{i} \sim Normal(\mu_{i}, \sigma)\)</span><br />
<span class="math inline">\(\mu_{i} \sim \alpha + \beta_{N}N_{i}+\beta_{M}M_{i}\)</span>
<span class="math inline">\(\alpha \sim Normal(0, 0.2)\)</span><br />
<span class="math inline">\(\beta_{N} \sim Normal(0, 0.5)\)</span><br />
<span class="math inline">\(\beta_{M} \sim Normal(0, 0.5)\)</span>
<span class="math inline">\(\sigma \sim Exponential(1)\)</span></p>
<div class="sourceCode" id="cb363"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb363-1"><a href="the-many-variables-the-spurious-waffles.html#cb363-1" aria-hidden="true" tabindex="-1"></a>b5<span class="fl">.9</span> <span class="ot">&lt;-</span> </span>
<span id="cb363-2"><a href="the-many-variables-the-spurious-waffles.html#cb363-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">brm</span>(<span class="at">data =</span> d2_2,</span>
<span id="cb363-3"><a href="the-many-variables-the-spurious-waffles.html#cb363-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> gaussian,</span>
<span id="cb363-4"><a href="the-many-variables-the-spurious-waffles.html#cb363-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">formula =</span> K <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> N <span class="sc">+</span> M,</span>
<span id="cb363-5"><a href="the-many-variables-the-spurious-waffles.html#cb363-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>,<span class="fl">0.2</span>),<span class="at">class =</span> Intercept),</span>
<span id="cb363-6"><a href="the-many-variables-the-spurious-waffles.html#cb363-6" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>,<span class="fl">0.5</span>), <span class="at">class =</span> b),</span>
<span id="cb363-7"><a href="the-many-variables-the-spurious-waffles.html#cb363-7" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>), <span class="at">class =</span> sigma)),</span>
<span id="cb363-8"><a href="the-many-variables-the-spurious-waffles.html#cb363-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>, <span class="at">chains =</span><span class="dv">4</span>,<span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb363-9"><a href="the-many-variables-the-spurious-waffles.html#cb363-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">seed =</span> <span class="dv">5</span>,</span>
<span id="cb363-10"><a href="the-many-variables-the-spurious-waffles.html#cb363-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">sample_prior =</span> T,</span>
<span id="cb363-11"><a href="the-many-variables-the-spurious-waffles.html#cb363-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">backend =</span> <span class="st">&quot;cmdstanr&quot;</span>,</span>
<span id="cb363-12"><a href="the-many-variables-the-spurious-waffles.html#cb363-12" aria-hidden="true" tabindex="-1"></a>      <span class="at">file =</span> <span class="st">&quot;output/Chapter5/b5.9&quot;</span>)</span></code></pre></div>
<p><br /></p>
<p>それぞれNは強く正の方向に、Mは強く負の方向に影響を与えている。<br />
2変数を入れたことによって効果が強まったよう。
<br /></p>
<div class="sourceCode" id="cb364"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb364-1"><a href="the-many-variables-the-spurious-waffles.html#cb364-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(b5<span class="fl">.9</span>)</span></code></pre></div>
<pre><code>##  Family: gaussian 
##   Links: mu = identity; sigma = identity 
## Formula: K ~ 1 + N + M 
##    Data: d2_2 (Number of observations: 17) 
##   Draws: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
##          total post-warmup draws = 4000
## 
## Population-Level Effects: 
##           Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## Intercept     0.07      0.14    -0.21     0.34 1.00     3167     2661
## N             0.61      0.28     0.03     1.11 1.00     2393     2393
## M            -0.65      0.24    -1.10    -0.13 1.00     2272     2592
## 
## Family Specific Parameters: 
##       Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## sigma     0.86      0.18     0.60     1.27 1.00     2290     2374
## 
## Draws were sampled using sample(hmc). For each parameter, Bulk_ESS
## and Tail_ESS are effective sample size measures, and Rhat is the potential
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<p><br /></p>
<p>上記2つのモデルと比較しても一目瞭然である。</p>
<div class="sourceCode" id="cb366"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb366-1"><a href="the-many-variables-the-spurious-waffles.html#cb366-1" aria-hidden="true" tabindex="-1"></a><span class="fu">bind_cols</span>(</span>
<span id="cb366-2"><a href="the-many-variables-the-spurious-waffles.html#cb366-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">posterior_samples</span>(b5<span class="fl">.7</span>_t) <span class="sc">%&gt;%</span> </span>
<span id="cb366-3"><a href="the-many-variables-the-spurious-waffles.html#cb366-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">transmute</span>(<span class="st">`</span><span class="at">b5.5_beta[N]</span><span class="st">`</span> <span class="ot">=</span> b_N),</span>
<span id="cb366-4"><a href="the-many-variables-the-spurious-waffles.html#cb366-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">posterior_samples</span>(b5<span class="fl">.8</span>_t) <span class="sc">%&gt;%</span> </span>
<span id="cb366-5"><a href="the-many-variables-the-spurious-waffles.html#cb366-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">transmute</span>(<span class="st">`</span><span class="at">b5.6_beta[M]</span><span class="st">`</span> <span class="ot">=</span> b_M),</span>
<span id="cb366-6"><a href="the-many-variables-the-spurious-waffles.html#cb366-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">posterior_samples</span>(b5<span class="fl">.9</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb366-7"><a href="the-many-variables-the-spurious-waffles.html#cb366-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">transmute</span>(<span class="st">`</span><span class="at">b5.7_beta[N]</span><span class="st">`</span> <span class="ot">=</span> b_N,</span>
<span id="cb366-8"><a href="the-many-variables-the-spurious-waffles.html#cb366-8" aria-hidden="true" tabindex="-1"></a>              <span class="st">`</span><span class="at">b5.7_beta[M]</span><span class="st">`</span> <span class="ot">=</span> b_M)</span>
<span id="cb366-9"><a href="the-many-variables-the-spurious-waffles.html#cb366-9" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb366-10"><a href="the-many-variables-the-spurious-waffles.html#cb366-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">everything</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb366-11"><a href="the-many-variables-the-spurious-waffles.html#cb366-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(name) <span class="sc">%&gt;%</span> </span>
<span id="cb366-12"><a href="the-many-variables-the-spurious-waffles.html#cb366-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean =</span> <span class="fu">mean</span>(value),</span>
<span id="cb366-13"><a href="the-many-variables-the-spurious-waffles.html#cb366-13" aria-hidden="true" tabindex="-1"></a>            <span class="at">ll   =</span> <span class="fu">quantile</span>(value, <span class="at">prob =</span> .<span class="dv">025</span>),</span>
<span id="cb366-14"><a href="the-many-variables-the-spurious-waffles.html#cb366-14" aria-hidden="true" tabindex="-1"></a>            <span class="at">ul   =</span> <span class="fu">quantile</span>(value, <span class="at">prob =</span> .<span class="dv">975</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb366-15"><a href="the-many-variables-the-spurious-waffles.html#cb366-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(name, <span class="at">into =</span> <span class="fu">c</span>(<span class="st">&quot;fit&quot;</span>, <span class="st">&quot;parameter&quot;</span>), <span class="at">sep =</span> <span class="st">&quot;_&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb366-16"><a href="the-many-variables-the-spurious-waffles.html#cb366-16" aria-hidden="true" tabindex="-1"></a>  <span class="co"># complete(fit, parameter) %&gt;% </span></span>
<span id="cb366-17"><a href="the-many-variables-the-spurious-waffles.html#cb366-17" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb366-18"><a href="the-many-variables-the-spurious-waffles.html#cb366-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> mean, <span class="at">y =</span> fit, <span class="at">xmin =</span> ll, <span class="at">xmax =</span> ul)) <span class="sc">+</span></span>
<span id="cb366-19"><a href="the-many-variables-the-spurious-waffles.html#cb366-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_pointrange</span>(<span class="at">color =</span> <span class="st">&quot;firebrick&quot;</span>) <span class="sc">+</span></span>
<span id="cb366-20"><a href="the-many-variables-the-spurious-waffles.html#cb366-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">color =</span> <span class="st">&quot;firebrick&quot;</span>, <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">5</span>) <span class="sc">+</span></span>
<span id="cb366-21"><a href="the-many-variables-the-spurious-waffles.html#cb366-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb366-22"><a href="the-many-variables-the-spurious-waffles.html#cb366-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb366-23"><a href="the-many-variables-the-spurious-waffles.html#cb366-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb366-24"><a href="the-many-variables-the-spurious-waffles.html#cb366-24" aria-hidden="true" tabindex="-1"></a>        <span class="at">strip.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">&quot;transparent&quot;</span>, <span class="at">color =</span> <span class="st">&quot;transparent&quot;</span>)) <span class="sc">+</span></span>
<span id="cb366-25"><a href="the-many-variables-the-spurious-waffles.html#cb366-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> parameter, <span class="at">ncol =</span> <span class="dv">1</span>, <span class="at">labeller =</span> label_parsed)</span></code></pre></div>
<p><img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-167-1.png" width="672" style="display: block; margin: auto;" /></p>
<p><br /></p>
<p>この結果をどのように解釈すべきだろうか？<br />
これは、NとMがそれぞれKに対して反対方向に影響を与えていて、かつNとMが正に相関していたため、それぞれがKに与える影響が打ち消しあっていたと考えられる。</p>
<div class="sourceCode" id="cb367"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb367-1"><a href="the-many-variables-the-spurious-waffles.html#cb367-1" aria-hidden="true" tabindex="-1"></a><span class="fu">pairs</span>(<span class="sc">~</span>K<span class="sc">+</span>M<span class="sc">+</span>N, d2_2)</span></code></pre></div>
<p><img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-168-1.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb368"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb368-1"><a href="the-many-variables-the-spurious-waffles.html#cb368-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(GGally)</span>
<span id="cb368-2"><a href="the-many-variables-the-spurious-waffles.html#cb368-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb368-3"><a href="the-many-variables-the-spurious-waffles.html#cb368-3" aria-hidden="true" tabindex="-1"></a><span class="fu">na.omit</span>(d2) <span class="sc">%&gt;%</span> </span>
<span id="cb368-4"><a href="the-many-variables-the-spurious-waffles.html#cb368-4" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(K,M,N)<span class="sc">%&gt;%</span></span>
<span id="cb368-5"><a href="the-many-variables-the-spurious-waffles.html#cb368-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_all</span>(<span class="sc">~</span> <span class="fu">as.numeric</span>(.)) <span class="sc">%&gt;%</span> </span>
<span id="cb368-6"><a href="the-many-variables-the-spurious-waffles.html#cb368-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggpairs</span>()</span></code></pre></div>
<p><img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-168-2.png" width="672" style="display: block; margin: auto;" /></p>
<p><br /></p>
<p>グラフィカルモデルを使って考える。<br />
結果に合致するグラフは3通り考えられるが、データからは区別することはできない（Marcov equivalence）。</p>
<div class="sourceCode" id="cb369"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb369-1"><a href="the-many-variables-the-spurious-waffles.html#cb369-1" aria-hidden="true" tabindex="-1"></a>gg_dag <span class="ot">&lt;-</span> <span class="cf">function</span>(d) {</span>
<span id="cb369-2"><a href="the-many-variables-the-spurious-waffles.html#cb369-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb369-3"><a href="the-many-variables-the-spurious-waffles.html#cb369-3" aria-hidden="true" tabindex="-1"></a>  d <span class="sc">%&gt;%</span> </span>
<span id="cb369-4"><a href="the-many-variables-the-spurious-waffles.html#cb369-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">xend =</span> xend, <span class="at">yend =</span> yend)) <span class="sc">+</span></span>
<span id="cb369-5"><a href="the-many-variables-the-spurious-waffles.html#cb369-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_dag_point</span>(<span class="at">color =</span> <span class="st">&quot;firebrick&quot;</span>, <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">4</span>, <span class="at">size =</span> <span class="dv">10</span>) <span class="sc">+</span></span>
<span id="cb369-6"><a href="the-many-variables-the-spurious-waffles.html#cb369-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_dag_text</span>(<span class="at">color =</span> <span class="st">&quot;firebrick&quot;</span>) <span class="sc">+</span></span>
<span id="cb369-7"><a href="the-many-variables-the-spurious-waffles.html#cb369-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_dag_edges</span>(<span class="at">edge_color =</span> <span class="st">&quot;firebrick&quot;</span>) <span class="sc">+</span></span>
<span id="cb369-8"><a href="the-many-variables-the-spurious-waffles.html#cb369-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_continuous</span>(<span class="cn">NULL</span>, <span class="at">breaks =</span> <span class="cn">NULL</span>, <span class="at">expand =</span> <span class="fu">c</span>(.<span class="dv">1</span>, .<span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb369-9"><a href="the-many-variables-the-spurious-waffles.html#cb369-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_y_continuous</span>(<span class="cn">NULL</span>, <span class="at">breaks =</span> <span class="cn">NULL</span>, <span class="at">expand =</span> <span class="fu">c</span>(.<span class="dv">1</span>, .<span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb369-10"><a href="the-many-variables-the-spurious-waffles.html#cb369-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb369-11"><a href="the-many-variables-the-spurious-waffles.html#cb369-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>())</span>
<span id="cb369-12"><a href="the-many-variables-the-spurious-waffles.html#cb369-12" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb369-13"><a href="the-many-variables-the-spurious-waffles.html#cb369-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb369-14"><a href="the-many-variables-the-spurious-waffles.html#cb369-14" aria-hidden="true" tabindex="-1"></a>dag_coords <span class="ot">&lt;-</span></span>
<span id="cb369-15"><a href="the-many-variables-the-spurious-waffles.html#cb369-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="at">name =</span> <span class="fu">c</span>(<span class="st">&quot;M&quot;</span>, <span class="st">&quot;N&quot;</span>, <span class="st">&quot;K&quot;</span>),</span>
<span id="cb369-16"><a href="the-many-variables-the-spurious-waffles.html#cb369-16" aria-hidden="true" tabindex="-1"></a>         <span class="at">x    =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">2</span>),</span>
<span id="cb369-17"><a href="the-many-variables-the-spurious-waffles.html#cb369-17" aria-hidden="true" tabindex="-1"></a>         <span class="at">y    =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">1</span>))</span>
<span id="cb369-18"><a href="the-many-variables-the-spurious-waffles.html#cb369-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb369-19"><a href="the-many-variables-the-spurious-waffles.html#cb369-19" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span></span>
<span id="cb369-20"><a href="the-many-variables-the-spurious-waffles.html#cb369-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dagify</span>(N <span class="sc">~</span> M,</span>
<span id="cb369-21"><a href="the-many-variables-the-spurious-waffles.html#cb369-21" aria-hidden="true" tabindex="-1"></a>         K <span class="sc">~</span> M <span class="sc">+</span> N,</span>
<span id="cb369-22"><a href="the-many-variables-the-spurious-waffles.html#cb369-22" aria-hidden="true" tabindex="-1"></a>         <span class="at">coords =</span> dag_coords) <span class="sc">%&gt;%</span></span>
<span id="cb369-23"><a href="the-many-variables-the-spurious-waffles.html#cb369-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gg_dag</span>()</span>
<span id="cb369-24"><a href="the-many-variables-the-spurious-waffles.html#cb369-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb369-25"><a href="the-many-variables-the-spurious-waffles.html#cb369-25" aria-hidden="true" tabindex="-1"></a><span class="co"># middle DAG</span></span>
<span id="cb369-26"><a href="the-many-variables-the-spurious-waffles.html#cb369-26" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span></span>
<span id="cb369-27"><a href="the-many-variables-the-spurious-waffles.html#cb369-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dagify</span>(M <span class="sc">~</span> N,</span>
<span id="cb369-28"><a href="the-many-variables-the-spurious-waffles.html#cb369-28" aria-hidden="true" tabindex="-1"></a>         K <span class="sc">~</span> M <span class="sc">+</span> N,</span>
<span id="cb369-29"><a href="the-many-variables-the-spurious-waffles.html#cb369-29" aria-hidden="true" tabindex="-1"></a>         <span class="at">coords =</span> dag_coords) <span class="sc">%&gt;%</span></span>
<span id="cb369-30"><a href="the-many-variables-the-spurious-waffles.html#cb369-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gg_dag</span>()</span>
<span id="cb369-31"><a href="the-many-variables-the-spurious-waffles.html#cb369-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb369-32"><a href="the-many-variables-the-spurious-waffles.html#cb369-32" aria-hidden="true" tabindex="-1"></a><span class="co"># right DAG</span></span>
<span id="cb369-33"><a href="the-many-variables-the-spurious-waffles.html#cb369-33" aria-hidden="true" tabindex="-1"></a>dag_coords <span class="ot">&lt;-</span></span>
<span id="cb369-34"><a href="the-many-variables-the-spurious-waffles.html#cb369-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="at">name =</span> <span class="fu">c</span>(<span class="st">&quot;M&quot;</span>, <span class="st">&quot;N&quot;</span>, <span class="st">&quot;K&quot;</span>, <span class="st">&quot;U&quot;</span>),</span>
<span id="cb369-35"><a href="the-many-variables-the-spurious-waffles.html#cb369-35" aria-hidden="true" tabindex="-1"></a>         <span class="at">x    =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">2</span>, <span class="dv">2</span>),</span>
<span id="cb369-36"><a href="the-many-variables-the-spurious-waffles.html#cb369-36" aria-hidden="true" tabindex="-1"></a>         <span class="at">y    =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">2</span>))</span>
<span id="cb369-37"><a href="the-many-variables-the-spurious-waffles.html#cb369-37" aria-hidden="true" tabindex="-1"></a>p3 <span class="ot">&lt;-</span></span>
<span id="cb369-38"><a href="the-many-variables-the-spurious-waffles.html#cb369-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dagify</span>(M <span class="sc">~</span> U,</span>
<span id="cb369-39"><a href="the-many-variables-the-spurious-waffles.html#cb369-39" aria-hidden="true" tabindex="-1"></a>         N <span class="sc">~</span> U,</span>
<span id="cb369-40"><a href="the-many-variables-the-spurious-waffles.html#cb369-40" aria-hidden="true" tabindex="-1"></a>         K <span class="sc">~</span> M <span class="sc">+</span> N,</span>
<span id="cb369-41"><a href="the-many-variables-the-spurious-waffles.html#cb369-41" aria-hidden="true" tabindex="-1"></a>         <span class="at">coords =</span> dag_coords) <span class="sc">%&gt;%</span></span>
<span id="cb369-42"><a href="the-many-variables-the-spurious-waffles.html#cb369-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gg_dag</span>() <span class="sc">+</span></span>
<span id="cb369-43"><a href="the-many-variables-the-spurious-waffles.html#cb369-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">x =</span> <span class="dv">2</span>, <span class="at">y =</span> <span class="dv">2</span>,</span>
<span id="cb369-44"><a href="the-many-variables-the-spurious-waffles.html#cb369-44" aria-hidden="true" tabindex="-1"></a>             <span class="at">shape =</span> <span class="dv">1</span>, <span class="at">size =</span> <span class="dv">10</span>, <span class="at">stroke =</span> <span class="fl">1.25</span>, <span class="at">color =</span> <span class="st">&quot;firebrick4&quot;</span>)</span>
<span id="cb369-45"><a href="the-many-variables-the-spurious-waffles.html#cb369-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb369-46"><a href="the-many-variables-the-spurious-waffles.html#cb369-46" aria-hidden="true" tabindex="-1"></a>p1<span class="sc">+</span>p2<span class="sc">+</span>p3</span></code></pre></div>
<p><img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-169-1.png" width="672" style="display: block; margin: auto;" /></p>
<p><br /></p>
</div>
<div id="counterfactual-plot-を描く" class="section level3 hasAnchor" number="5.2.4">
<h3><span class="header-section-number">5.2.4</span> Counterfactual plot を描く<a href="the-many-variables-the-spurious-waffles.html#counterfactual-plot-を描く" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb370"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb370-1"><a href="the-many-variables-the-spurious-waffles.html#cb370-1" aria-hidden="true" tabindex="-1"></a><span class="co"># K ~ N</span></span>
<span id="cb370-2"><a href="the-many-variables-the-spurious-waffles.html#cb370-2" aria-hidden="true" tabindex="-1"></a>seq_N <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">N =</span><span class="fu">seq</span>(<span class="sc">-</span><span class="dv">2</span>,<span class="dv">2</span>,<span class="at">length.out=</span><span class="dv">50</span>),</span>
<span id="cb370-3"><a href="the-many-variables-the-spurious-waffles.html#cb370-3" aria-hidden="true" tabindex="-1"></a>                <span class="at">M =</span> <span class="dv">0</span>)</span>
<span id="cb370-4"><a href="the-many-variables-the-spurious-waffles.html#cb370-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb370-5"><a href="the-many-variables-the-spurious-waffles.html#cb370-5" aria-hidden="true" tabindex="-1"></a>predict_b59_N <span class="ot">&lt;-</span> <span class="fu">fitted</span>(b5<span class="fl">.9</span>, </span>
<span id="cb370-6"><a href="the-many-variables-the-spurious-waffles.html#cb370-6" aria-hidden="true" tabindex="-1"></a>                         <span class="at">newdata =</span> seq_N,</span>
<span id="cb370-7"><a href="the-many-variables-the-spurious-waffles.html#cb370-7" aria-hidden="true" tabindex="-1"></a>                         <span class="at">prob =</span> <span class="fu">c</span>(.<span class="dv">055</span>, .<span class="dv">945</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb370-8"><a href="the-many-variables-the-spurious-waffles.html#cb370-8" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb370-9"><a href="the-many-variables-the-spurious-waffles.html#cb370-9" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">bind_cols</span>(seq_N)</span>
<span id="cb370-10"><a href="the-many-variables-the-spurious-waffles.html#cb370-10" aria-hidden="true" tabindex="-1"></a>                 </span>
<span id="cb370-11"><a href="the-many-variables-the-spurious-waffles.html#cb370-11" aria-hidden="true" tabindex="-1"></a>predict_b59_N <span class="sc">%&gt;%</span> </span>
<span id="cb370-12"><a href="the-many-variables-the-spurious-waffles.html#cb370-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>N, <span class="at">y=</span> Estimate, </span>
<span id="cb370-13"><a href="the-many-variables-the-spurious-waffles.html#cb370-13" aria-hidden="true" tabindex="-1"></a>             <span class="at">ymin =</span> Q5<span class="fl">.5</span>, <span class="at">ymax =</span> Q94<span class="fl">.5</span>))<span class="sc">+</span></span>
<span id="cb370-14"><a href="the-many-variables-the-spurious-waffles.html#cb370-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>()<span class="sc">+</span></span>
<span id="cb370-15"><a href="the-many-variables-the-spurious-waffles.html#cb370-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">7</span>, <span class="at">fill =</span> <span class="st">&quot;black&quot;</span>)<span class="sc">+</span></span>
<span id="cb370-16"><a href="the-many-variables-the-spurious-waffles.html#cb370-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="st">&quot;neocortex percent (std)&quot;</span>,</span>
<span id="cb370-17"><a href="the-many-variables-the-spurious-waffles.html#cb370-17" aria-hidden="true" tabindex="-1"></a>                     <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">2</span>,<span class="fl">1.5</span>,<span class="at">by=</span><span class="fl">0.5</span>))<span class="sc">+</span></span>
<span id="cb370-18"><a href="the-many-variables-the-spurious-waffles.html#cb370-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="st">&quot;kilocal per g (std)&quot;</span>,</span>
<span id="cb370-19"><a href="the-many-variables-the-spurious-waffles.html#cb370-19" aria-hidden="true" tabindex="-1"></a>                     <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">1</span>,<span class="dv">2</span>,<span class="at">by=</span><span class="fl">0.5</span>))<span class="sc">+</span></span>
<span id="cb370-20"><a href="the-many-variables-the-spurious-waffles.html#cb370-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim=</span><span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>,<span class="dv">2</span>))<span class="sc">+</span></span>
<span id="cb370-21"><a href="the-many-variables-the-spurious-waffles.html#cb370-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()<span class="sc">+</span></span>
<span id="cb370-22"><a href="the-many-variables-the-spurious-waffles.html#cb370-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb370-23"><a href="the-many-variables-the-spurious-waffles.html#cb370-23" aria-hidden="true" tabindex="-1"></a>        <span class="at">aspect.ratio =</span> <span class="dv">1</span>) <span class="ot">-&gt;</span> p13</span>
<span id="cb370-24"><a href="the-many-variables-the-spurious-waffles.html#cb370-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb370-25"><a href="the-many-variables-the-spurious-waffles.html#cb370-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb370-26"><a href="the-many-variables-the-spurious-waffles.html#cb370-26" aria-hidden="true" tabindex="-1"></a><span class="co"># K ~ M</span></span>
<span id="cb370-27"><a href="the-many-variables-the-spurious-waffles.html#cb370-27" aria-hidden="true" tabindex="-1"></a>seq_M <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">M =</span><span class="fu">seq</span>(<span class="sc">-</span><span class="dv">2</span>,<span class="dv">2</span>,<span class="at">length.out=</span><span class="dv">50</span>),</span>
<span id="cb370-28"><a href="the-many-variables-the-spurious-waffles.html#cb370-28" aria-hidden="true" tabindex="-1"></a>                <span class="at">N =</span> <span class="dv">0</span>)</span>
<span id="cb370-29"><a href="the-many-variables-the-spurious-waffles.html#cb370-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb370-30"><a href="the-many-variables-the-spurious-waffles.html#cb370-30" aria-hidden="true" tabindex="-1"></a>predict_b59_M <span class="ot">&lt;-</span> <span class="fu">fitted</span>(b5<span class="fl">.9</span>, </span>
<span id="cb370-31"><a href="the-many-variables-the-spurious-waffles.html#cb370-31" aria-hidden="true" tabindex="-1"></a>                         <span class="at">newdata =</span> seq_M,</span>
<span id="cb370-32"><a href="the-many-variables-the-spurious-waffles.html#cb370-32" aria-hidden="true" tabindex="-1"></a>                         <span class="at">prob =</span> <span class="fu">c</span>(.<span class="dv">055</span>, .<span class="dv">945</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb370-33"><a href="the-many-variables-the-spurious-waffles.html#cb370-33" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb370-34"><a href="the-many-variables-the-spurious-waffles.html#cb370-34" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">bind_cols</span>(seq_M)</span>
<span id="cb370-35"><a href="the-many-variables-the-spurious-waffles.html#cb370-35" aria-hidden="true" tabindex="-1"></a>                 </span>
<span id="cb370-36"><a href="the-many-variables-the-spurious-waffles.html#cb370-36" aria-hidden="true" tabindex="-1"></a>predict_b59_M <span class="sc">%&gt;%</span> </span>
<span id="cb370-37"><a href="the-many-variables-the-spurious-waffles.html#cb370-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>M, <span class="at">y=</span> Estimate, </span>
<span id="cb370-38"><a href="the-many-variables-the-spurious-waffles.html#cb370-38" aria-hidden="true" tabindex="-1"></a>             <span class="at">ymin =</span> Q5<span class="fl">.5</span>, <span class="at">ymax =</span> Q94<span class="fl">.5</span>))<span class="sc">+</span></span>
<span id="cb370-39"><a href="the-many-variables-the-spurious-waffles.html#cb370-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>()<span class="sc">+</span></span>
<span id="cb370-40"><a href="the-many-variables-the-spurious-waffles.html#cb370-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">7</span>, <span class="at">fill =</span> <span class="st">&quot;black&quot;</span>)<span class="sc">+</span></span>
<span id="cb370-41"><a href="the-many-variables-the-spurious-waffles.html#cb370-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="st">&quot;neocortex percent (std)&quot;</span>,</span>
<span id="cb370-42"><a href="the-many-variables-the-spurious-waffles.html#cb370-42" aria-hidden="true" tabindex="-1"></a>                     <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">2</span>,<span class="dv">2</span>,<span class="at">by=</span><span class="dv">1</span>))<span class="sc">+</span></span>
<span id="cb370-43"><a href="the-many-variables-the-spurious-waffles.html#cb370-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="st">&quot;kilocal per g (std)&quot;</span>,</span>
<span id="cb370-44"><a href="the-many-variables-the-spurious-waffles.html#cb370-44" aria-hidden="true" tabindex="-1"></a>                     <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">1</span>,<span class="dv">2</span>,<span class="at">by=</span><span class="fl">0.5</span>))<span class="sc">+</span></span>
<span id="cb370-45"><a href="the-many-variables-the-spurious-waffles.html#cb370-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim=</span><span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>,<span class="dv">2</span>))<span class="sc">+</span></span>
<span id="cb370-46"><a href="the-many-variables-the-spurious-waffles.html#cb370-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()<span class="sc">+</span></span>
<span id="cb370-47"><a href="the-many-variables-the-spurious-waffles.html#cb370-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb370-48"><a href="the-many-variables-the-spurious-waffles.html#cb370-48" aria-hidden="true" tabindex="-1"></a>        <span class="at">aspect.ratio =</span> <span class="dv">1</span>) <span class="ot">-&gt;</span> p14</span>
<span id="cb370-49"><a href="the-many-variables-the-spurious-waffles.html#cb370-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb370-50"><a href="the-many-variables-the-spurious-waffles.html#cb370-50" aria-hidden="true" tabindex="-1"></a>p13<span class="sc">+</span>p14<span class="sc">+</span></span>
<span id="cb370-51"><a href="the-many-variables-the-spurious-waffles.html#cb370-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_annotation</span>(<span class="at">title =</span> <span class="st">&quot;Figure 5.9 [bottom row]. Milk energy and neocortex among primates.&quot;</span>)</span></code></pre></div>
<p><img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-170-1.png" width="672" style="display: block; margin: auto;" /></p>
<p><br /></p>
</div>
<div id="overthinking-1" class="section level3 hasAnchor" number="5.2.5">
<h3><span class="header-section-number">5.2.5</span> Overthinking<a href="the-many-variables-the-spurious-waffles.html#overthinking-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Marcov evuivalentなグラフィカルモデルはどれ？</p>
<div class="sourceCode" id="cb371"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb371-1"><a href="the-many-variables-the-spurious-waffles.html#cb371-1" aria-hidden="true" tabindex="-1"></a>dag5<span class="fl">.7</span> <span class="ot">&lt;-</span> <span class="fu">dagitty</span>(<span class="st">&quot;dag{ M -&gt; K &lt;- N M -&gt; N }&quot;</span> )</span>
<span id="cb371-2"><a href="the-many-variables-the-spurious-waffles.html#cb371-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb371-3"><a href="the-many-variables-the-spurious-waffles.html#cb371-3" aria-hidden="true" tabindex="-1"></a><span class="fu">coordinates</span>(dag5<span class="fl">.7</span>) <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">x =</span> <span class="fu">c</span>(<span class="at">M =</span> <span class="dv">0</span>, <span class="at">K =</span> <span class="dv">1</span>, <span class="at">N =</span><span class="dv">2</span>), 　　　　　　　　　　　　　　<span class="at">y=</span><span class="fu">c</span>(<span class="at">M =</span><span class="fl">0.5</span>,<span class="at">K =</span> <span class="dv">1</span>,<span class="at">N =</span> <span class="fl">0.5</span>)) </span>
<span id="cb371-4"><a href="the-many-variables-the-spurious-waffles.html#cb371-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggdag_equivalent_dags</span>(dag5<span class="fl">.7</span>)</span></code></pre></div>
<p><img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-171-1.png" width="672" style="display: block; margin: auto;" />
<br /></p>
</div>
</div>
<div id="categorical-variables" class="section level2 hasAnchor" number="5.3">
<h2><span class="header-section-number">5.3</span> Categorical variables<a href="the-many-variables-the-spurious-waffles.html#categorical-variables" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="two-categories" class="section level3 hasAnchor" number="5.3.1">
<h3><span class="header-section-number">5.3.1</span> Two categories<a href="the-many-variables-the-spurious-waffles.html#two-categories" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>説明変数に質的変数を含む場合を考える。<br />
再びクンサン族のデータを考える。</p>
<div class="sourceCode" id="cb372"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb372-1"><a href="the-many-variables-the-spurious-waffles.html#cb372-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(Howell1)</span>
<span id="cb372-2"><a href="the-many-variables-the-spurious-waffles.html#cb372-2" aria-hidden="true" tabindex="-1"></a>d3 <span class="ot">&lt;-</span> Howell1</span>
<span id="cb372-3"><a href="the-many-variables-the-spurious-waffles.html#cb372-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb372-4"><a href="the-many-variables-the-spurious-waffles.html#cb372-4" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(d3)</span></code></pre></div>
<pre><code>## &#39;data.frame&#39;:    544 obs. of  4 variables:
##  $ height: num  152 140 137 157 145 ...
##  $ weight: num  47.8 36.5 31.9 53 41.3 ...
##  $ age   : num  63 63 65 41 51 35 32 27 19 54 ...
##  $ male  : int  1 0 0 1 0 1 0 1 0 1 ...</code></pre>
<p><br /></p>
<p>まずは、身長が性別によって違うというモデルを考える。
<br /></p>
<p><span class="math inline">\(h_{i} \sim Normal(\mu_{i}, \sigma)\)</span><br />
<span class="math inline">\(\mu_{i} \sim \alpha + \beta_{M}m_{i}\)</span><br />
<span class="math inline">\(\alpha \sim Normal(178, 20)\)</span><br />
<span class="math inline">\(\beta_{M} \sim Normal(0, 10)\)</span><br />
<span class="math inline">\(\sigma \sim Exponential(1)\)</span></p>
<p><br /></p>
<p>しかし、このモデルでは、男女の事前分布で違いが出てきてしまう（男は<span class="math inline">\(\alpha\)</span>と<span class="math inline">\(\beta_{M}\)</span>という2つのパラメータを使っているため）。</p>
<div class="sourceCode" id="cb374"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb374-1"><a href="the-many-variables-the-spurious-waffles.html#cb374-1" aria-hidden="true" tabindex="-1"></a>mu_f <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="fl">1e4</span>, <span class="dv">178</span>,<span class="dv">20</span>) <span class="co"># alphaに相当</span></span>
<span id="cb374-2"><a href="the-many-variables-the-spurious-waffles.html#cb374-2" aria-hidden="true" tabindex="-1"></a>mu_m <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="fl">1e4</span>, <span class="dv">178</span>,<span class="dv">20</span>) <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="fl">1e4</span>,<span class="dv">0</span>,<span class="dv">10</span>) </span>
<span id="cb374-3"><a href="the-many-variables-the-spurious-waffles.html#cb374-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb374-4"><a href="the-many-variables-the-spurious-waffles.html#cb374-4" aria-hidden="true" tabindex="-1"></a><span class="fu">precis</span>(<span class="fu">data.frame</span>(mu_f,mu_m),<span class="at">hist =</span> F)</span></code></pre></div>
<pre><code>##          mean       sd     5.5%    94.5%
## mu_f 178.4736 19.88366 146.6287 210.1023
## mu_m 178.0379 22.32357 142.2385 214.0687</code></pre>
<p><br /></p>
<p>そこで、以下のモデルを考える。<br />
<span class="math inline">\(h_{i} \sim Normal(\mu_{i}, \sigma)\)</span><br />
<span class="math inline">\(\mu_{i} \sim \alpha_{SEX[i]}\)</span><br />
<span class="math inline">\(\alpha_{j} \sim Normal(178, 20)\;\; for\,j=1,2\)</span><br />
<span class="math inline">\(\sigma \sim Exponential(1)\)</span></p>
<div class="sourceCode" id="cb376"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb376-1"><a href="the-many-variables-the-spurious-waffles.html#cb376-1" aria-hidden="true" tabindex="-1"></a>d3 <span class="ot">&lt;-</span> d3 <span class="sc">%&gt;%</span> </span>
<span id="cb376-2"><a href="the-many-variables-the-spurious-waffles.html#cb376-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">sex =</span> <span class="fu">factor</span>(<span class="fu">ifelse</span>(male<span class="sc">==</span><span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">1</span>)))</span>
<span id="cb376-3"><a href="the-many-variables-the-spurious-waffles.html#cb376-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb376-4"><a href="the-many-variables-the-spurious-waffles.html#cb376-4" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(d3)</span></code></pre></div>
<pre><code>## &#39;data.frame&#39;:    544 obs. of  5 variables:
##  $ height: num  152 140 137 157 145 ...
##  $ weight: num  47.8 36.5 31.9 53 41.3 ...
##  $ age   : num  63 63 65 41 51 35 32 27 19 54 ...
##  $ male  : int  1 0 0 1 0 1 0 1 0 1 ...
##  $ sex   : Factor w/ 2 levels &quot;1&quot;,&quot;2&quot;: 2 1 1 2 1 2 1 2 1 2 ...</code></pre>
<p><br /></p>
<p>brmsでモデリングする。</p>
<div class="sourceCode" id="cb378"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb378-1"><a href="the-many-variables-the-spurious-waffles.html#cb378-1" aria-hidden="true" tabindex="-1"></a>b5<span class="fl">.10</span> <span class="ot">&lt;-</span> <span class="fu">brm</span>(</span>
<span id="cb378-2"><a href="the-many-variables-the-spurious-waffles.html#cb378-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> d3,</span>
<span id="cb378-3"><a href="the-many-variables-the-spurious-waffles.html#cb378-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> gaussian,</span>
<span id="cb378-4"><a href="the-many-variables-the-spurious-waffles.html#cb378-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">formula =</span> height <span class="sc">~</span> <span class="dv">0</span> <span class="sc">+</span> sex,</span>
<span id="cb378-5"><a href="the-many-variables-the-spurious-waffles.html#cb378-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">178</span>, <span class="dv">20</span>), <span class="at">class =</span> b),</span>
<span id="cb378-6"><a href="the-many-variables-the-spurious-waffles.html#cb378-6" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>), <span class="at">class =</span> sigma)),</span>
<span id="cb378-7"><a href="the-many-variables-the-spurious-waffles.html#cb378-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>, <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb378-8"><a href="the-many-variables-the-spurious-waffles.html#cb378-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">seed =</span> <span class="dv">5</span>,</span>
<span id="cb378-9"><a href="the-many-variables-the-spurious-waffles.html#cb378-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">backend =</span> <span class="st">&quot;cmdstanr&quot;</span>,</span>
<span id="cb378-10"><a href="the-many-variables-the-spurious-waffles.html#cb378-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">file =</span> <span class="st">&quot;output/Chapter5/b5.10_2&quot;</span></span>
<span id="cb378-11"><a href="the-many-variables-the-spurious-waffles.html#cb378-11" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb378-12"><a href="the-many-variables-the-spurious-waffles.html#cb378-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb378-13"><a href="the-many-variables-the-spurious-waffles.html#cb378-13" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(b5<span class="fl">.10</span>)</span></code></pre></div>
<pre><code>##  Family: gaussian 
##   Links: mu = identity; sigma = identity 
## Formula: height ~ 0 + sex 
##    Data: d3 (Number of observations: 544) 
##   Draws: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
##          total post-warmup draws = 4000
## 
## Population-Level Effects: 
##      Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## sex1   134.86      1.54   131.83   137.87 1.00     3815     3177
## sex2   142.62      1.67   139.33   145.92 1.00     3173     2687
## 
## Family Specific Parameters: 
##       Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## sigma    26.76      0.77    25.31    28.35 1.00     4534     2777
## 
## Draws were sampled using sample(hmc). For each parameter, Bulk_ESS
## and Tail_ESS are effective sample size measures, and Rhat is the potential
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<div class="sourceCode" id="cb380"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb380-1"><a href="the-many-variables-the-spurious-waffles.html#cb380-1" aria-hidden="true" tabindex="-1"></a><span class="co">#posterior_samples(b5.10,summary=F) %&gt;% </span></span>
<span id="cb380-2"><a href="the-many-variables-the-spurious-waffles.html#cb380-2" aria-hidden="true" tabindex="-1"></a>  <span class="co">#data.frame() %&gt;% </span></span>
<span id="cb380-3"><a href="the-many-variables-the-spurious-waffles.html#cb380-3" aria-hidden="true" tabindex="-1"></a>  <span class="co">#mutate(diff = b_sex1 - b_sex2) %&gt;% </span></span>
<span id="cb380-4"><a href="the-many-variables-the-spurious-waffles.html#cb380-4" aria-hidden="true" tabindex="-1"></a>  <span class="co">#dplyr::select(-lp__) %&gt;% </span></span>
<span id="cb380-5"><a href="the-many-variables-the-spurious-waffles.html#cb380-5" aria-hidden="true" tabindex="-1"></a>  <span class="co">#map_df(mean_qi, .width = .89)</span></span></code></pre></div>
<p><br /></p>
</div>
<div id="many-categories" class="section level3 hasAnchor" number="5.3.2">
<h3><span class="header-section-number">5.3.2</span> Many Categories<a href="the-many-variables-the-spurious-waffles.html#many-categories" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>複数のカテゴリーがある場合を考える。</p>
<div class="sourceCode" id="cb381"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb381-1"><a href="the-many-variables-the-spurious-waffles.html#cb381-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(milk)</span>
<span id="cb381-2"><a href="the-many-variables-the-spurious-waffles.html#cb381-2" aria-hidden="true" tabindex="-1"></a>d4 <span class="ot">&lt;-</span> milk</span>
<span id="cb381-3"><a href="the-many-variables-the-spurious-waffles.html#cb381-3" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(milk)</span></code></pre></div>
<pre><code>## &#39;data.frame&#39;:    29 obs. of  8 variables:
##  $ clade         : Factor w/ 4 levels &quot;Ape&quot;,&quot;New World Monkey&quot;,..: 4 4 4 4 4 2 2 2 2 2 ...
##  $ species       : Factor w/ 29 levels &quot;A palliata&quot;,&quot;Alouatta seniculus&quot;,..: 11 8 9 10 16 2 1 6 28 27 ...
##  $ kcal.per.g    : num  0.49 0.51 0.46 0.48 0.6 0.47 0.56 0.89 0.91 0.92 ...
##  $ perc.fat      : num  16.6 19.3 14.1 14.9 27.3 ...
##  $ perc.protein  : num  15.4 16.9 16.9 13.2 19.5 ...
##  $ perc.lactose  : num  68 63.8 69 71.9 53.2 ...
##  $ mass          : num  1.95 2.09 2.51 1.62 2.19 5.25 5.37 2.51 0.71 0.68 ...
##  $ neocortex.perc: num  55.2 NA NA NA NA ...</code></pre>
<div class="sourceCode" id="cb383"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb383-1"><a href="the-many-variables-the-spurious-waffles.html#cb383-1" aria-hidden="true" tabindex="-1"></a>d4 <span class="sc">%&gt;%</span> </span>
<span id="cb383-2"><a href="the-many-variables-the-spurious-waffles.html#cb383-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(clade)</span></code></pre></div>
<pre><code>##              clade
## 1    Strepsirrhine
## 2 New World Monkey
## 3 Old World Monkey
## 4              Ape</code></pre>
<div class="sourceCode" id="cb385"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb385-1"><a href="the-many-variables-the-spurious-waffles.html#cb385-1" aria-hidden="true" tabindex="-1"></a>d4 <span class="ot">&lt;-</span> </span>
<span id="cb385-2"><a href="the-many-variables-the-spurious-waffles.html#cb385-2" aria-hidden="true" tabindex="-1"></a>  d4 <span class="sc">%&gt;%</span> </span>
<span id="cb385-3"><a href="the-many-variables-the-spurious-waffles.html#cb385-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">K =</span> <span class="fu">scale</span>(kcal.per.g))</span></code></pre></div>
<p><br /></p>
<p>以下のモデルを考える。<br />
<span class="math inline">\(K_{i} \sim Normal(\mu_{i}, \sigma)\)</span><br />
<span class="math inline">\(\mu_{i} = \alpha_{clade[i]}\)</span><br />
<span class="math inline">\(\alpha_{j} \sim Normal(0, 0.5)\)</span><br />
<span class="math inline">\(\sigma \sim Exponential(1)\)</span></p>
<div class="sourceCode" id="cb386"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb386-1"><a href="the-many-variables-the-spurious-waffles.html#cb386-1" aria-hidden="true" tabindex="-1"></a>b5<span class="fl">.11</span> <span class="ot">&lt;-</span> </span>
<span id="cb386-2"><a href="the-many-variables-the-spurious-waffles.html#cb386-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">brm</span>(<span class="at">data=</span>d4,</span>
<span id="cb386-3"><a href="the-many-variables-the-spurious-waffles.html#cb386-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> gaussian,</span>
<span id="cb386-4"><a href="the-many-variables-the-spurious-waffles.html#cb386-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">formula =</span> K <span class="sc">~</span> <span class="dv">0</span> <span class="sc">+</span> clade,</span>
<span id="cb386-5"><a href="the-many-variables-the-spurious-waffles.html#cb386-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">0.5</span>), <span class="at">class =</span> b),</span>
<span id="cb386-6"><a href="the-many-variables-the-spurious-waffles.html#cb386-6" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>), <span class="at">class =</span> sigma)),</span>
<span id="cb386-7"><a href="the-many-variables-the-spurious-waffles.html#cb386-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">iter =</span> <span class="dv">2000</span>,<span class="at">warmup =</span> <span class="dv">1000</span>,<span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb386-8"><a href="the-many-variables-the-spurious-waffles.html#cb386-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">seed =</span> <span class="dv">5</span>,</span>
<span id="cb386-9"><a href="the-many-variables-the-spurious-waffles.html#cb386-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">backend =</span> <span class="st">&quot;cmdstanr&quot;</span>,</span>
<span id="cb386-10"><a href="the-many-variables-the-spurious-waffles.html#cb386-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">file =</span> <span class="st">&quot;output/Chapter5/b5.11&quot;</span>)</span>
<span id="cb386-11"><a href="the-many-variables-the-spurious-waffles.html#cb386-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb386-12"><a href="the-many-variables-the-spurious-waffles.html#cb386-12" aria-hidden="true" tabindex="-1"></a><span class="fu">mcmc_plot</span>(b5<span class="fl">.11</span>, <span class="at">pars =</span> <span class="st">&quot;^b&quot;</span>)</span></code></pre></div>
<p><img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-178-1.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb387"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb387-1"><a href="the-many-variables-the-spurious-waffles.html#cb387-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(bayesplot)</span>
<span id="cb387-2"><a href="the-many-variables-the-spurious-waffles.html#cb387-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggmcmc)</span>
<span id="cb387-3"><a href="the-many-variables-the-spurious-waffles.html#cb387-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-4"><a href="the-many-variables-the-spurious-waffles.html#cb387-4" aria-hidden="true" tabindex="-1"></a><span class="fu">posterior_samples</span>(b5<span class="fl">.11</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb387-5"><a href="the-many-variables-the-spurious-waffles.html#cb387-5" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="fu">starts_with</span>(<span class="st">&quot;b_&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb387-6"><a href="the-many-variables-the-spurious-waffles.html#cb387-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mcmc_intervals</span>(<span class="at">prob =</span> .<span class="dv">5</span>, <span class="at">prob_outer=</span>.<span class="dv">89</span>)<span class="sc">+</span></span>
<span id="cb387-7"><a href="the-many-variables-the-spurious-waffles.html#cb387-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;My fancy bayesplot-based coefficient plot&quot;</span>) <span class="sc">+</span></span>
<span id="cb387-8"><a href="the-many-variables-the-spurious-waffles.html#cb387-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb387-9"><a href="the-many-variables-the-spurious-waffles.html#cb387-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="dv">0</span>),</span>
<span id="cb387-10"><a href="the-many-variables-the-spurious-waffles.html#cb387-10" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.ticks.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb387-11"><a href="the-many-variables-the-spurious-waffles.html#cb387-11" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid =</span> <span class="fu">element_blank</span>())</span></code></pre></div>
<p><img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-178-2.png" width="672" style="display: block; margin: auto;" /></p>
<p><br /></p>
</div>
</div>
<div id="practice-3" class="section level2 hasAnchor" number="5.4">
<h2><span class="header-section-number">5.4</span> Practice<a href="the-many-variables-the-spurious-waffles.html#practice-3" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="m1-3" class="section level3 hasAnchor" number="5.4.1">
<h3><span class="header-section-number">5.4.1</span> 5M1<a href="the-many-variables-the-spurious-waffles.html#m1-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<blockquote>
<p>Invent your own example of a spurious correlation. An outcome variable should be correlated with both predictor variables. But when both predictors are entered in the same model, the correlation between the outcome and one of the predictors should mostly vanish (or at least be greatly reduced).</p>
</blockquote>
<p>気温（T）とアイスクリームの売り上げ（I）、プールでの死亡事故の件数（P）の関係を考える。<br />
想定する因果関係は以下の通り。</p>
<div class="sourceCode" id="cb388"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb388-1"><a href="the-many-variables-the-spurious-waffles.html#cb388-1" aria-hidden="true" tabindex="-1"></a>gg_dag <span class="ot">&lt;-</span> <span class="cf">function</span>(d) {</span>
<span id="cb388-2"><a href="the-many-variables-the-spurious-waffles.html#cb388-2" aria-hidden="true" tabindex="-1"></a>  d <span class="sc">%&gt;%</span> </span>
<span id="cb388-3"><a href="the-many-variables-the-spurious-waffles.html#cb388-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">xend =</span> xend, <span class="at">yend =</span> yend)) <span class="sc">+</span></span>
<span id="cb388-4"><a href="the-many-variables-the-spurious-waffles.html#cb388-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_dag_point</span>(<span class="at">color =</span> <span class="st">&quot;firebrick&quot;</span>, <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">4</span>, <span class="at">size =</span> <span class="dv">10</span>) <span class="sc">+</span></span>
<span id="cb388-5"><a href="the-many-variables-the-spurious-waffles.html#cb388-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_dag_text</span>(<span class="at">color =</span> <span class="st">&quot;firebrick&quot;</span>) <span class="sc">+</span></span>
<span id="cb388-6"><a href="the-many-variables-the-spurious-waffles.html#cb388-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_dag_edges</span>(<span class="at">edge_color =</span> <span class="st">&quot;firebrick&quot;</span>) <span class="sc">+</span></span>
<span id="cb388-7"><a href="the-many-variables-the-spurious-waffles.html#cb388-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_continuous</span>(<span class="cn">NULL</span>, <span class="at">breaks =</span> <span class="cn">NULL</span>, <span class="at">expand =</span> <span class="fu">c</span>(.<span class="dv">1</span>, .<span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb388-8"><a href="the-many-variables-the-spurious-waffles.html#cb388-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_y_continuous</span>(<span class="cn">NULL</span>, <span class="at">breaks =</span> <span class="cn">NULL</span>, <span class="at">expand =</span> <span class="fu">c</span>(.<span class="dv">1</span>, .<span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb388-9"><a href="the-many-variables-the-spurious-waffles.html#cb388-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb388-10"><a href="the-many-variables-the-spurious-waffles.html#cb388-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>())</span>
<span id="cb388-11"><a href="the-many-variables-the-spurious-waffles.html#cb388-11" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb388-12"><a href="the-many-variables-the-spurious-waffles.html#cb388-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb388-13"><a href="the-many-variables-the-spurious-waffles.html#cb388-13" aria-hidden="true" tabindex="-1"></a>dag_coords <span class="ot">&lt;-</span></span>
<span id="cb388-14"><a href="the-many-variables-the-spurious-waffles.html#cb388-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="at">name =</span> <span class="fu">c</span>(<span class="st">&quot;T&quot;</span>, <span class="st">&quot;I&quot;</span>, <span class="st">&quot;P&quot;</span>),</span>
<span id="cb388-15"><a href="the-many-variables-the-spurious-waffles.html#cb388-15" aria-hidden="true" tabindex="-1"></a>         <span class="at">x    =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">2</span>),</span>
<span id="cb388-16"><a href="the-many-variables-the-spurious-waffles.html#cb388-16" aria-hidden="true" tabindex="-1"></a>         <span class="at">y    =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">1</span>))</span>
<span id="cb388-17"><a href="the-many-variables-the-spurious-waffles.html#cb388-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb388-18"><a href="the-many-variables-the-spurious-waffles.html#cb388-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dagify</span>(I <span class="sc">~</span> T,</span>
<span id="cb388-19"><a href="the-many-variables-the-spurious-waffles.html#cb388-19" aria-hidden="true" tabindex="-1"></a>         P <span class="sc">~</span> T,</span>
<span id="cb388-20"><a href="the-many-variables-the-spurious-waffles.html#cb388-20" aria-hidden="true" tabindex="-1"></a>         <span class="at">coords =</span> dag_coords) <span class="sc">%&gt;%</span></span>
<span id="cb388-21"><a href="the-many-variables-the-spurious-waffles.html#cb388-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gg_dag</span>()</span></code></pre></div>
<p><img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-179-1.png" width="672" style="display: block; margin: auto;" /></p>
<p><br /></p>
<p>シミュレーションする。<br />
IとPの間には正の相関がある</p>
<div class="sourceCode" id="cb389"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb389-1"><a href="the-many-variables-the-spurious-waffles.html#cb389-1" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb389-2"><a href="the-many-variables-the-spurious-waffles.html#cb389-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb389-3"><a href="the-many-variables-the-spurious-waffles.html#cb389-3" aria-hidden="true" tabindex="-1"></a>T <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(n, <span class="dv">25</span>, <span class="dv">5</span>)</span>
<span id="cb389-4"><a href="the-many-variables-the-spurious-waffles.html#cb389-4" aria-hidden="true" tabindex="-1"></a>I <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(n,<span class="fl">0.5</span><span class="sc">*</span>T<span class="sc">+</span><span class="dv">4</span>, <span class="dv">2</span>)</span>
<span id="cb389-5"><a href="the-many-variables-the-spurious-waffles.html#cb389-5" aria-hidden="true" tabindex="-1"></a>P <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(n,<span class="fl">0.3</span><span class="sc">*</span>T<span class="sc">+</span><span class="dv">2</span>, <span class="dv">3</span>)</span>
<span id="cb389-6"><a href="the-many-variables-the-spurious-waffles.html#cb389-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb389-7"><a href="the-many-variables-the-spurious-waffles.html#cb389-7" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">T =</span> T, <span class="at">I=</span>I, <span class="at">P=</span>P)</span>
<span id="cb389-8"><a href="the-many-variables-the-spurious-waffles.html#cb389-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb389-9"><a href="the-many-variables-the-spurious-waffles.html#cb389-9" aria-hidden="true" tabindex="-1"></a><span class="fu">pairs</span>(d)</span></code></pre></div>
<p><img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-180-1.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb390"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb390-1"><a href="the-many-variables-the-spurious-waffles.html#cb390-1" aria-hidden="true" tabindex="-1"></a>d <span class="sc">%&gt;%</span> </span>
<span id="cb390-2"><a href="the-many-variables-the-spurious-waffles.html#cb390-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>I, <span class="at">y =</span> P))<span class="sc">+</span></span>
<span id="cb390-3"><a href="the-many-variables-the-spurious-waffles.html#cb390-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()<span class="sc">+</span></span>
<span id="cb390-4"><a href="the-many-variables-the-spurious-waffles.html#cb390-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">&quot;lm&quot;</span>, <span class="at">color=</span><span class="st">&quot;black&quot;</span>)<span class="sc">+</span></span>
<span id="cb390-5"><a href="the-many-variables-the-spurious-waffles.html#cb390-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()<span class="sc">+</span></span>
<span id="cb390-6"><a href="the-many-variables-the-spurious-waffles.html#cb390-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid=</span><span class="fu">element_blank</span>(),<span class="at">aspect.ratio=</span><span class="dv">1</span>)</span></code></pre></div>
<p><img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-180-2.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb391"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb391-1"><a href="the-many-variables-the-spurious-waffles.html#cb391-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cor.test</span>(d<span class="sc">$</span>I,d<span class="sc">$</span>P)</span></code></pre></div>
<pre><code>## 
##  Pearson&#39;s product-moment correlation
## 
## data:  d$I and d$P
## t = 5.1296, df = 98, p-value = 1.467e-06
## alternative hypothesis: true correlation is not equal to 0
## 95 percent confidence interval:
##  0.2898452 0.6020814
## sample estimates:
##       cor 
## 0.4600711</code></pre>
<p><br /></p>
<p>モデルを考える。</p>
<div class="sourceCode" id="cb393"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb393-1"><a href="the-many-variables-the-spurious-waffles.html#cb393-1" aria-hidden="true" tabindex="-1"></a>modIT <span class="ot">&lt;-</span> <span class="fu">brm</span>(<span class="at">data =</span> d,</span>
<span id="cb393-2"><a href="the-many-variables-the-spurious-waffles.html#cb393-2" aria-hidden="true" tabindex="-1"></a>              <span class="at">family=</span>gaussian,</span>
<span id="cb393-3"><a href="the-many-variables-the-spurious-waffles.html#cb393-3" aria-hidden="true" tabindex="-1"></a>              <span class="at">formula =</span> I <span class="sc">~</span> <span class="dv">1</span><span class="sc">+</span>T,</span>
<span id="cb393-4"><a href="the-many-variables-the-spurious-waffles.html#cb393-4" aria-hidden="true" tabindex="-1"></a>              <span class="at">prior =</span></span>
<span id="cb393-5"><a href="the-many-variables-the-spurious-waffles.html#cb393-5" aria-hidden="true" tabindex="-1"></a>              <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>,<span class="dv">10</span>),<span class="at">class=</span>Intercept),</span>
<span id="cb393-6"><a href="the-many-variables-the-spurious-waffles.html#cb393-6" aria-hidden="true" tabindex="-1"></a>              <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>,<span class="dv">10</span>),<span class="at">class=</span> b)),</span>
<span id="cb393-7"><a href="the-many-variables-the-spurious-waffles.html#cb393-7" aria-hidden="true" tabindex="-1"></a>              <span class="at">iter=</span><span class="dv">4000</span>,<span class="at">warmup=</span><span class="dv">3000</span>,<span class="at">chains=</span><span class="dv">4</span>,<span class="at">seed=</span><span class="dv">4</span>,</span>
<span id="cb393-8"><a href="the-many-variables-the-spurious-waffles.html#cb393-8" aria-hidden="true" tabindex="-1"></a>              <span class="at">backend =</span> <span class="st">&quot;cmdstanr&quot;</span>,</span>
<span id="cb393-9"><a href="the-many-variables-the-spurious-waffles.html#cb393-9" aria-hidden="true" tabindex="-1"></a>              <span class="at">file =</span> <span class="st">&quot;output/Chapter5/mod_IT&quot;</span></span>
<span id="cb393-10"><a href="the-many-variables-the-spurious-waffles.html#cb393-10" aria-hidden="true" tabindex="-1"></a>              )</span>
<span id="cb393-11"><a href="the-many-variables-the-spurious-waffles.html#cb393-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb393-12"><a href="the-many-variables-the-spurious-waffles.html#cb393-12" aria-hidden="true" tabindex="-1"></a>modIP <span class="ot">&lt;-</span> <span class="fu">brm</span>(<span class="at">data =</span> d,</span>
<span id="cb393-13"><a href="the-many-variables-the-spurious-waffles.html#cb393-13" aria-hidden="true" tabindex="-1"></a>              <span class="at">family=</span>gaussian,</span>
<span id="cb393-14"><a href="the-many-variables-the-spurious-waffles.html#cb393-14" aria-hidden="true" tabindex="-1"></a>              <span class="at">formula =</span> I <span class="sc">~</span> <span class="dv">1</span><span class="sc">+</span>P,</span>
<span id="cb393-15"><a href="the-many-variables-the-spurious-waffles.html#cb393-15" aria-hidden="true" tabindex="-1"></a>              <span class="at">prior =</span></span>
<span id="cb393-16"><a href="the-many-variables-the-spurious-waffles.html#cb393-16" aria-hidden="true" tabindex="-1"></a>              <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>,<span class="dv">10</span>),<span class="at">class=</span>Intercept),</span>
<span id="cb393-17"><a href="the-many-variables-the-spurious-waffles.html#cb393-17" aria-hidden="true" tabindex="-1"></a>              <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>,<span class="dv">10</span>),<span class="at">class=</span> b)),</span>
<span id="cb393-18"><a href="the-many-variables-the-spurious-waffles.html#cb393-18" aria-hidden="true" tabindex="-1"></a>              <span class="at">iter=</span><span class="dv">4000</span>,<span class="at">warmup=</span><span class="dv">3000</span>,<span class="at">chains=</span><span class="dv">4</span>,<span class="at">seed=</span><span class="dv">4</span>,</span>
<span id="cb393-19"><a href="the-many-variables-the-spurious-waffles.html#cb393-19" aria-hidden="true" tabindex="-1"></a>              <span class="at">backend =</span> <span class="st">&quot;cmdstanr&quot;</span>,</span>
<span id="cb393-20"><a href="the-many-variables-the-spurious-waffles.html#cb393-20" aria-hidden="true" tabindex="-1"></a>              <span class="at">file =</span> <span class="st">&quot;output/Chapter5/mod_IP&quot;</span></span>
<span id="cb393-21"><a href="the-many-variables-the-spurious-waffles.html#cb393-21" aria-hidden="true" tabindex="-1"></a>              )</span>
<span id="cb393-22"><a href="the-many-variables-the-spurious-waffles.html#cb393-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb393-23"><a href="the-many-variables-the-spurious-waffles.html#cb393-23" aria-hidden="true" tabindex="-1"></a>modIPT <span class="ot">&lt;-</span> <span class="fu">brm</span>(<span class="at">data =</span> d,</span>
<span id="cb393-24"><a href="the-many-variables-the-spurious-waffles.html#cb393-24" aria-hidden="true" tabindex="-1"></a>              <span class="at">family=</span>gaussian,</span>
<span id="cb393-25"><a href="the-many-variables-the-spurious-waffles.html#cb393-25" aria-hidden="true" tabindex="-1"></a>              <span class="at">formula =</span> I <span class="sc">~</span> <span class="dv">1</span><span class="sc">+</span>P<span class="sc">+</span>T,</span>
<span id="cb393-26"><a href="the-many-variables-the-spurious-waffles.html#cb393-26" aria-hidden="true" tabindex="-1"></a>              <span class="at">prior =</span></span>
<span id="cb393-27"><a href="the-many-variables-the-spurious-waffles.html#cb393-27" aria-hidden="true" tabindex="-1"></a>              <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>,<span class="dv">10</span>),<span class="at">class=</span>Intercept),</span>
<span id="cb393-28"><a href="the-many-variables-the-spurious-waffles.html#cb393-28" aria-hidden="true" tabindex="-1"></a>              <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>,<span class="dv">10</span>),<span class="at">class=</span> b)),</span>
<span id="cb393-29"><a href="the-many-variables-the-spurious-waffles.html#cb393-29" aria-hidden="true" tabindex="-1"></a>              <span class="at">iter=</span><span class="dv">4000</span>,<span class="at">warmup=</span><span class="dv">3000</span>,<span class="at">chains=</span><span class="dv">4</span>,<span class="at">seed=</span><span class="dv">4</span>,</span>
<span id="cb393-30"><a href="the-many-variables-the-spurious-waffles.html#cb393-30" aria-hidden="true" tabindex="-1"></a>              <span class="at">backend =</span> <span class="st">&quot;cmdstanr&quot;</span>,</span>
<span id="cb393-31"><a href="the-many-variables-the-spurious-waffles.html#cb393-31" aria-hidden="true" tabindex="-1"></a>              <span class="at">file =</span> <span class="st">&quot;output/Chapter5/mod_IPT&quot;</span></span>
<span id="cb393-32"><a href="the-many-variables-the-spurious-waffles.html#cb393-32" aria-hidden="true" tabindex="-1"></a>              )</span></code></pre></div>
<p><br /></p>
<p>結果を見てみる。</p>
<div class="sourceCode" id="cb394"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb394-1"><a href="the-many-variables-the-spurious-waffles.html#cb394-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(modIT)</span></code></pre></div>
<pre><code>##  Family: gaussian 
##   Links: mu = identity; sigma = identity 
## Formula: I ~ 1 + T 
##    Data: d (Number of observations: 100) 
##   Draws: 4 chains, each with iter = 4000; warmup = 3000; thin = 1;
##          total post-warmup draws = 4000
## 
## Population-Level Effects: 
##           Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## Intercept     3.66      1.00     1.75     5.67 1.00     3754     2569
## T             0.51      0.04     0.43     0.59 1.00     3825     2555
## 
## Family Specific Parameters: 
##       Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## sigma     1.92      0.13     1.68     2.21 1.00     3754     2494
## 
## Draws were sampled using sample(hmc). For each parameter, Bulk_ESS
## and Tail_ESS are effective sample size measures, and Rhat is the potential
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<div class="sourceCode" id="cb396"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb396-1"><a href="the-many-variables-the-spurious-waffles.html#cb396-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(modIP)</span></code></pre></div>
<pre><code>##  Family: gaussian 
##   Links: mu = identity; sigma = identity 
## Formula: I ~ 1 + P 
##    Data: d (Number of observations: 100) 
##   Draws: 4 chains, each with iter = 4000; warmup = 3000; thin = 1;
##          total post-warmup draws = 4000
## 
## Population-Level Effects: 
##           Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## Intercept    13.19      1.00    11.18    15.18 1.00     3823     2768
## P             0.32      0.10     0.14     0.51 1.00     3820     2986
## 
## Family Specific Parameters: 
##       Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## sigma     3.01      0.22     2.62     3.48 1.00     3579     2733
## 
## Draws were sampled using sample(hmc). For each parameter, Bulk_ESS
## and Tail_ESS are effective sample size measures, and Rhat is the potential
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<div class="sourceCode" id="cb398"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb398-1"><a href="the-many-variables-the-spurious-waffles.html#cb398-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(modIPT)</span></code></pre></div>
<pre><code>##  Family: gaussian 
##   Links: mu = identity; sigma = identity 
## Formula: I ~ 1 + P + T 
##    Data: d (Number of observations: 100) 
##   Draws: 4 chains, each with iter = 4000; warmup = 3000; thin = 1;
##          total post-warmup draws = 4000
## 
## Population-Level Effects: 
##           Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## Intercept     3.76      1.04     1.71     5.80 1.00     5273     3077
## P            -0.03      0.07    -0.16     0.11 1.00     3462     2738
## T             0.52      0.04     0.43     0.60 1.00     3477     2780
## 
## Family Specific Parameters: 
##       Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## sigma     1.92      0.14     1.68     2.21 1.00     3730     2822
## 
## Draws were sampled using sample(hmc). For each parameter, Bulk_ESS
## and Tail_ESS are effective sample size measures, and Rhat is the potential
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<div class="sourceCode" id="cb400"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb400-1"><a href="the-many-variables-the-spurious-waffles.html#cb400-1" aria-hidden="true" tabindex="-1"></a><span class="fu">bind_cols</span>(</span>
<span id="cb400-2"><a href="the-many-variables-the-spurious-waffles.html#cb400-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">posterior_samples</span>(modIT) <span class="sc">%&gt;%</span> </span>
<span id="cb400-3"><a href="the-many-variables-the-spurious-waffles.html#cb400-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">transmute</span>(<span class="st">&quot;modIT_[T]&quot;</span><span class="ot">=</span> b_T),</span>
<span id="cb400-4"><a href="the-many-variables-the-spurious-waffles.html#cb400-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">posterior_samples</span>(modIP) <span class="sc">%&gt;%</span> </span>
<span id="cb400-5"><a href="the-many-variables-the-spurious-waffles.html#cb400-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">transmute</span>(<span class="st">&quot;modIP_[P]&quot;</span> <span class="ot">=</span> b_P),</span>
<span id="cb400-6"><a href="the-many-variables-the-spurious-waffles.html#cb400-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">posterior_samples</span>(modIPT) <span class="sc">%&gt;%</span> </span>
<span id="cb400-7"><a href="the-many-variables-the-spurious-waffles.html#cb400-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">transmute</span>(<span class="st">&quot;modIPT_[T]&quot;</span> <span class="ot">=</span> b_T,</span>
<span id="cb400-8"><a href="the-many-variables-the-spurious-waffles.html#cb400-8" aria-hidden="true" tabindex="-1"></a>              <span class="st">&quot;modIPT_[P]&quot;</span> <span class="ot">=</span> b_P)</span>
<span id="cb400-9"><a href="the-many-variables-the-spurious-waffles.html#cb400-9" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb400-10"><a href="the-many-variables-the-spurious-waffles.html#cb400-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">everything</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb400-11"><a href="the-many-variables-the-spurious-waffles.html#cb400-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(name) <span class="sc">%&gt;%</span> </span>
<span id="cb400-12"><a href="the-many-variables-the-spurious-waffles.html#cb400-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean =</span> <span class="fu">mean</span>(value),</span>
<span id="cb400-13"><a href="the-many-variables-the-spurious-waffles.html#cb400-13" aria-hidden="true" tabindex="-1"></a>            <span class="at">ll   =</span> <span class="fu">quantile</span>(value, <span class="at">prob =</span> .<span class="dv">025</span>),</span>
<span id="cb400-14"><a href="the-many-variables-the-spurious-waffles.html#cb400-14" aria-hidden="true" tabindex="-1"></a>            <span class="at">ul   =</span> <span class="fu">quantile</span>(value, <span class="at">prob =</span> .<span class="dv">975</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb400-15"><a href="the-many-variables-the-spurious-waffles.html#cb400-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(name, <span class="at">into =</span> <span class="fu">c</span>(<span class="st">&quot;fit&quot;</span>, <span class="st">&quot;parameter&quot;</span>), <span class="at">sep =</span> <span class="st">&quot;_&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb400-16"><a href="the-many-variables-the-spurious-waffles.html#cb400-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> mean, <span class="at">y =</span> fit,<span class="at">xmin =</span> ll,<span class="at">xmax =</span> ul)) <span class="sc">+</span></span>
<span id="cb400-17"><a href="the-many-variables-the-spurious-waffles.html#cb400-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_pointrange</span>(<span class="at">color =</span> <span class="st">&quot;firebrick&quot;</span>) <span class="sc">+</span></span>
<span id="cb400-18"><a href="the-many-variables-the-spurious-waffles.html#cb400-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">color =</span> <span class="st">&quot;firebrick&quot;</span>, <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">5</span>) <span class="sc">+</span></span>
<span id="cb400-19"><a href="the-many-variables-the-spurious-waffles.html#cb400-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb400-20"><a href="the-many-variables-the-spurious-waffles.html#cb400-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb400-21"><a href="the-many-variables-the-spurious-waffles.html#cb400-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb400-22"><a href="the-many-variables-the-spurious-waffles.html#cb400-22" aria-hidden="true" tabindex="-1"></a>        <span class="at">strip.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">&quot;transparent&quot;</span>, <span class="at">color =</span> <span class="st">&quot;transparent&quot;</span>)) <span class="sc">+</span></span>
<span id="cb400-23"><a href="the-many-variables-the-spurious-waffles.html#cb400-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> parameter, <span class="at">ncol =</span> <span class="dv">1</span>)</span></code></pre></div>
<p><img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-182-1.png" width="672" style="display: block; margin: auto;" />
<br /></p>
</div>
<div id="m2-3" class="section level3 hasAnchor" number="5.4.2">
<h3><span class="header-section-number">5.4.2</span> 5M2<a href="the-many-variables-the-spurious-waffles.html#m2-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<blockquote>
<p>Invent your own example of a masked relationship. An outcome variable should be correlated with both predictor variables, but in opposite directions. And the two predictor variables should be correlated with one another.</p>
</blockquote>
<p>自分への信頼（C）と勉強時間（S）、慢心（M）、成績（G）の関係を考える。<br />
想定する因果関係は以下の通り。</p>
<div class="sourceCode" id="cb401"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb401-1"><a href="the-many-variables-the-spurious-waffles.html#cb401-1" aria-hidden="true" tabindex="-1"></a>dag_coords <span class="ot">&lt;-</span></span>
<span id="cb401-2"><a href="the-many-variables-the-spurious-waffles.html#cb401-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="at">name =</span> <span class="fu">c</span>(<span class="st">&quot;S&quot;</span>, <span class="st">&quot;M&quot;</span>, <span class="st">&quot;G&quot;</span>, <span class="st">&quot;C&quot;</span>),</span>
<span id="cb401-3"><a href="the-many-variables-the-spurious-waffles.html#cb401-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">x    =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">2</span>, <span class="dv">2</span>),</span>
<span id="cb401-4"><a href="the-many-variables-the-spurious-waffles.html#cb401-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">y    =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">2</span>))</span>
<span id="cb401-5"><a href="the-many-variables-the-spurious-waffles.html#cb401-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb401-6"><a href="the-many-variables-the-spurious-waffles.html#cb401-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dagify</span>(S <span class="sc">~</span> C,</span>
<span id="cb401-7"><a href="the-many-variables-the-spurious-waffles.html#cb401-7" aria-hidden="true" tabindex="-1"></a>         M <span class="sc">~</span> C,</span>
<span id="cb401-8"><a href="the-many-variables-the-spurious-waffles.html#cb401-8" aria-hidden="true" tabindex="-1"></a>         G <span class="sc">~</span> S <span class="sc">+</span> M,</span>
<span id="cb401-9"><a href="the-many-variables-the-spurious-waffles.html#cb401-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">coords =</span> dag_coords) <span class="sc">%&gt;%</span></span>
<span id="cb401-10"><a href="the-many-variables-the-spurious-waffles.html#cb401-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gg_dag</span>() <span class="sc">+</span></span>
<span id="cb401-11"><a href="the-many-variables-the-spurious-waffles.html#cb401-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">x =</span> <span class="dv">2</span>, <span class="at">y =</span> <span class="dv">2</span>,</span>
<span id="cb401-12"><a href="the-many-variables-the-spurious-waffles.html#cb401-12" aria-hidden="true" tabindex="-1"></a>             <span class="at">shape =</span> <span class="dv">1</span>, <span class="at">size =</span> <span class="dv">10</span>, <span class="at">stroke =</span> <span class="fl">1.25</span>, <span class="at">color =</span> <span class="st">&quot;firebrick4&quot;</span>)</span></code></pre></div>
<p><img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-183-1.png" width="672" style="display: block; margin: auto;" /></p>
<p><br /></p>
<p>シミュレートする。</p>
<div class="sourceCode" id="cb402"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb402-1"><a href="the-many-variables-the-spurious-waffles.html#cb402-1" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb402-2"><a href="the-many-variables-the-spurious-waffles.html#cb402-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb402-3"><a href="the-many-variables-the-spurious-waffles.html#cb402-3" aria-hidden="true" tabindex="-1"></a>C <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(n)</span>
<span id="cb402-4"><a href="the-many-variables-the-spurious-waffles.html#cb402-4" aria-hidden="true" tabindex="-1"></a>S <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(n, <span class="fl">1.2</span><span class="sc">*</span>C , <span class="fl">0.4</span>)</span>
<span id="cb402-5"><a href="the-many-variables-the-spurious-waffles.html#cb402-5" aria-hidden="true" tabindex="-1"></a>M <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(n, <span class="fl">1.0</span><span class="sc">*</span>C , <span class="fl">0.3</span>)</span>
<span id="cb402-6"><a href="the-many-variables-the-spurious-waffles.html#cb402-6" aria-hidden="true" tabindex="-1"></a>G <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(n, <span class="fl">0.5</span><span class="sc">*</span>S <span class="sc">-</span> <span class="fl">0.6</span><span class="sc">*</span>M , <span class="fl">0.8</span>)</span>
<span id="cb402-7"><a href="the-many-variables-the-spurious-waffles.html#cb402-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb402-8"><a href="the-many-variables-the-spurious-waffles.html#cb402-8" aria-hidden="true" tabindex="-1"></a>d2 <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">S =</span> S, <span class="at">M =</span> M, <span class="at">G =</span> G)</span>
<span id="cb402-9"><a href="the-many-variables-the-spurious-waffles.html#cb402-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb402-10"><a href="the-many-variables-the-spurious-waffles.html#cb402-10" aria-hidden="true" tabindex="-1"></a><span class="fu">pairs</span>(d2)</span></code></pre></div>
<p><img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-184-1.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb403"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb403-1"><a href="the-many-variables-the-spurious-waffles.html#cb403-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cor</span>(d2)</span></code></pre></div>
<pre><code>##             S          M           G
## S  1.00000000  0.9168803 -0.05796131
## M  0.91688025  1.0000000 -0.19285146
## G -0.05796131 -0.1928515  1.00000000</code></pre>
<div class="sourceCode" id="cb405"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb405-1"><a href="the-many-variables-the-spurious-waffles.html#cb405-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cor.test</span>(d2<span class="sc">$</span>S,d2<span class="sc">$</span>G)</span></code></pre></div>
<pre><code>## 
##  Pearson&#39;s product-moment correlation
## 
## data:  d2$S and d2$G
## t = -0.57475, df = 98, p-value = 0.5668
## alternative hypothesis: true correlation is not equal to 0
## 95 percent confidence interval:
##  -0.2515160  0.1400512
## sample estimates:
##         cor 
## -0.05796131</code></pre>
<p><br /></p>
<p>モデリング。</p>
<div class="sourceCode" id="cb407"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb407-1"><a href="the-many-variables-the-spurious-waffles.html#cb407-1" aria-hidden="true" tabindex="-1"></a>modGS  <span class="ot">&lt;-</span> <span class="fu">brm</span>(<span class="at">data =</span> d2,</span>
<span id="cb407-2"><a href="the-many-variables-the-spurious-waffles.html#cb407-2" aria-hidden="true" tabindex="-1"></a>              <span class="at">family=</span>gaussian,</span>
<span id="cb407-3"><a href="the-many-variables-the-spurious-waffles.html#cb407-3" aria-hidden="true" tabindex="-1"></a>              <span class="at">formula =</span> G <span class="sc">~</span> <span class="dv">1</span><span class="sc">+</span>S,</span>
<span id="cb407-4"><a href="the-many-variables-the-spurious-waffles.html#cb407-4" aria-hidden="true" tabindex="-1"></a>              <span class="at">prior =</span></span>
<span id="cb407-5"><a href="the-many-variables-the-spurious-waffles.html#cb407-5" aria-hidden="true" tabindex="-1"></a>              <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>,<span class="dv">1</span>),<span class="at">class=</span>Intercept),</span>
<span id="cb407-6"><a href="the-many-variables-the-spurious-waffles.html#cb407-6" aria-hidden="true" tabindex="-1"></a>              <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>,<span class="dv">1</span>),<span class="at">class=</span> b)),</span>
<span id="cb407-7"><a href="the-many-variables-the-spurious-waffles.html#cb407-7" aria-hidden="true" tabindex="-1"></a>               <span class="at">iter=</span><span class="dv">4000</span>,<span class="at">warmup=</span><span class="dv">3000</span>,<span class="at">chains=</span><span class="dv">4</span>,<span class="at">seed=</span><span class="dv">4</span>,</span>
<span id="cb407-8"><a href="the-many-variables-the-spurious-waffles.html#cb407-8" aria-hidden="true" tabindex="-1"></a>               <span class="at">backend =</span> <span class="st">&quot;cmdstanr&quot;</span>,</span>
<span id="cb407-9"><a href="the-many-variables-the-spurious-waffles.html#cb407-9" aria-hidden="true" tabindex="-1"></a>              <span class="at">file =</span> <span class="st">&quot;output/Chapter5/modGS&quot;</span></span>
<span id="cb407-10"><a href="the-many-variables-the-spurious-waffles.html#cb407-10" aria-hidden="true" tabindex="-1"></a>              )</span>
<span id="cb407-11"><a href="the-many-variables-the-spurious-waffles.html#cb407-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb407-12"><a href="the-many-variables-the-spurious-waffles.html#cb407-12" aria-hidden="true" tabindex="-1"></a>modGM <span class="ot">&lt;-</span> <span class="fu">brm</span>(<span class="at">data =</span> d2,</span>
<span id="cb407-13"><a href="the-many-variables-the-spurious-waffles.html#cb407-13" aria-hidden="true" tabindex="-1"></a>              <span class="at">family=</span>gaussian,</span>
<span id="cb407-14"><a href="the-many-variables-the-spurious-waffles.html#cb407-14" aria-hidden="true" tabindex="-1"></a>              <span class="at">formula =</span> G <span class="sc">~</span> <span class="dv">1</span><span class="sc">+</span>M,</span>
<span id="cb407-15"><a href="the-many-variables-the-spurious-waffles.html#cb407-15" aria-hidden="true" tabindex="-1"></a>              <span class="at">prior =</span></span>
<span id="cb407-16"><a href="the-many-variables-the-spurious-waffles.html#cb407-16" aria-hidden="true" tabindex="-1"></a>              <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>,<span class="dv">1</span>),<span class="at">class=</span>Intercept),</span>
<span id="cb407-17"><a href="the-many-variables-the-spurious-waffles.html#cb407-17" aria-hidden="true" tabindex="-1"></a>              <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>,<span class="dv">1</span>),<span class="at">class=</span> b)),</span>
<span id="cb407-18"><a href="the-many-variables-the-spurious-waffles.html#cb407-18" aria-hidden="true" tabindex="-1"></a>              <span class="at">iter=</span><span class="dv">4000</span>,<span class="at">warmup=</span><span class="dv">3000</span>,<span class="at">chains=</span><span class="dv">4</span>,<span class="at">seed=</span><span class="dv">4</span>,</span>
<span id="cb407-19"><a href="the-many-variables-the-spurious-waffles.html#cb407-19" aria-hidden="true" tabindex="-1"></a>              <span class="at">backend =</span> <span class="st">&quot;cmdstanr&quot;</span>,</span>
<span id="cb407-20"><a href="the-many-variables-the-spurious-waffles.html#cb407-20" aria-hidden="true" tabindex="-1"></a>              <span class="at">file =</span> <span class="st">&quot;output/Chapter5/modGM&quot;</span></span>
<span id="cb407-21"><a href="the-many-variables-the-spurious-waffles.html#cb407-21" aria-hidden="true" tabindex="-1"></a>              )</span>
<span id="cb407-22"><a href="the-many-variables-the-spurious-waffles.html#cb407-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb407-23"><a href="the-many-variables-the-spurious-waffles.html#cb407-23" aria-hidden="true" tabindex="-1"></a>modGSM <span class="ot">&lt;-</span> <span class="fu">brm</span>(<span class="at">data =</span> d2,</span>
<span id="cb407-24"><a href="the-many-variables-the-spurious-waffles.html#cb407-24" aria-hidden="true" tabindex="-1"></a>              <span class="at">family=</span>gaussian,</span>
<span id="cb407-25"><a href="the-many-variables-the-spurious-waffles.html#cb407-25" aria-hidden="true" tabindex="-1"></a>              <span class="at">formula =</span> G <span class="sc">~</span> <span class="dv">1</span><span class="sc">+</span>S <span class="sc">+</span> M,</span>
<span id="cb407-26"><a href="the-many-variables-the-spurious-waffles.html#cb407-26" aria-hidden="true" tabindex="-1"></a>              <span class="at">prior =</span></span>
<span id="cb407-27"><a href="the-many-variables-the-spurious-waffles.html#cb407-27" aria-hidden="true" tabindex="-1"></a>              <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>,<span class="dv">1</span>),<span class="at">class=</span>Intercept),</span>
<span id="cb407-28"><a href="the-many-variables-the-spurious-waffles.html#cb407-28" aria-hidden="true" tabindex="-1"></a>              <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>,<span class="dv">1</span>),<span class="at">class=</span> b)),</span>
<span id="cb407-29"><a href="the-many-variables-the-spurious-waffles.html#cb407-29" aria-hidden="true" tabindex="-1"></a>              <span class="at">iter=</span><span class="dv">4000</span>,<span class="at">warmup=</span><span class="dv">3000</span>,<span class="at">chains=</span><span class="dv">4</span>,<span class="at">seed=</span><span class="dv">4</span>,</span>
<span id="cb407-30"><a href="the-many-variables-the-spurious-waffles.html#cb407-30" aria-hidden="true" tabindex="-1"></a>              <span class="at">backend =</span> <span class="st">&quot;cmdstanr&quot;</span>,</span>
<span id="cb407-31"><a href="the-many-variables-the-spurious-waffles.html#cb407-31" aria-hidden="true" tabindex="-1"></a>              <span class="at">file =</span> <span class="st">&quot;output/Chapter5/modGSM&quot;</span></span>
<span id="cb407-32"><a href="the-many-variables-the-spurious-waffles.html#cb407-32" aria-hidden="true" tabindex="-1"></a>              )</span></code></pre></div>
<div class="sourceCode" id="cb408"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb408-1"><a href="the-many-variables-the-spurious-waffles.html#cb408-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(modGM)</span></code></pre></div>
<pre><code>##  Family: gaussian 
##   Links: mu = identity; sigma = identity 
## Formula: G ~ 1 + M 
##    Data: d2 (Number of observations: 100) 
##   Draws: 4 chains, each with iter = 4000; warmup = 3000; thin = 1;
##          total post-warmup draws = 4000
## 
## Population-Level Effects: 
##           Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## Intercept     0.06      0.08    -0.09     0.21 1.00     3984     2763
## M             0.05      0.07    -0.09     0.18 1.00     4048     3210
## 
## Family Specific Parameters: 
##       Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## sigma     0.76      0.06     0.66     0.88 1.00     4013     2954
## 
## Draws were sampled using sample(hmc). For each parameter, Bulk_ESS
## and Tail_ESS are effective sample size measures, and Rhat is the potential
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<div class="sourceCode" id="cb410"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb410-1"><a href="the-many-variables-the-spurious-waffles.html#cb410-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(modGS)</span></code></pre></div>
<pre><code>##  Family: gaussian 
##   Links: mu = identity; sigma = identity 
## Formula: G ~ 1 + S 
##    Data: d2 (Number of observations: 100) 
##   Draws: 4 chains, each with iter = 4000; warmup = 3000; thin = 1;
##          total post-warmup draws = 4000
## 
## Population-Level Effects: 
##           Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## Intercept     0.03      0.07    -0.11     0.18 1.00     4104     2701
## S             0.14      0.06     0.02     0.25 1.00     3954     3018
## 
## Family Specific Parameters: 
##       Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## sigma     0.74      0.05     0.64     0.86 1.00     4109     3192
## 
## Draws were sampled using sample(hmc). For each parameter, Bulk_ESS
## and Tail_ESS are effective sample size measures, and Rhat is the potential
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<div class="sourceCode" id="cb412"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb412-1"><a href="the-many-variables-the-spurious-waffles.html#cb412-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(modGSM)</span></code></pre></div>
<pre><code>##  Family: gaussian 
##   Links: mu = identity; sigma = identity 
## Formula: G ~ 1 + S + M 
##    Data: d2 (Number of observations: 100) 
##   Draws: 4 chains, each with iter = 4000; warmup = 3000; thin = 1;
##          total post-warmup draws = 4000
## 
## Population-Level Effects: 
##           Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## Intercept    -0.06      0.08    -0.21     0.09 1.00     2917     2274
## S             0.57      0.13     0.30     0.83 1.00     2340     2048
## M            -0.56      0.16    -0.87    -0.23 1.00     2325     2074
## 
## Family Specific Parameters: 
##       Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## sigma     0.70      0.05     0.60     0.81 1.00     3112     2629
## 
## Draws were sampled using sample(hmc). For each parameter, Bulk_ESS
## and Tail_ESS are effective sample size measures, and Rhat is the potential
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<div class="sourceCode" id="cb414"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb414-1"><a href="the-many-variables-the-spurious-waffles.html#cb414-1" aria-hidden="true" tabindex="-1"></a><span class="fu">bind_cols</span>(</span>
<span id="cb414-2"><a href="the-many-variables-the-spurious-waffles.html#cb414-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">posterior_samples</span>(modGS) <span class="sc">%&gt;%</span> </span>
<span id="cb414-3"><a href="the-many-variables-the-spurious-waffles.html#cb414-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">transmute</span>(<span class="st">&quot;modGS_[S]&quot;</span><span class="ot">=</span> b_S),</span>
<span id="cb414-4"><a href="the-many-variables-the-spurious-waffles.html#cb414-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">posterior_samples</span>(modGM) <span class="sc">%&gt;%</span> </span>
<span id="cb414-5"><a href="the-many-variables-the-spurious-waffles.html#cb414-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">transmute</span>(<span class="st">&quot;modGM_[M]&quot;</span> <span class="ot">=</span> b_M),</span>
<span id="cb414-6"><a href="the-many-variables-the-spurious-waffles.html#cb414-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">posterior_samples</span>(modGSM) <span class="sc">%&gt;%</span> </span>
<span id="cb414-7"><a href="the-many-variables-the-spurious-waffles.html#cb414-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">transmute</span>(<span class="st">&quot;modGSM_[S]&quot;</span> <span class="ot">=</span> b_S,</span>
<span id="cb414-8"><a href="the-many-variables-the-spurious-waffles.html#cb414-8" aria-hidden="true" tabindex="-1"></a>              <span class="st">&quot;modGSM_[M]&quot;</span> <span class="ot">=</span> b_M)</span>
<span id="cb414-9"><a href="the-many-variables-the-spurious-waffles.html#cb414-9" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb414-10"><a href="the-many-variables-the-spurious-waffles.html#cb414-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">everything</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb414-11"><a href="the-many-variables-the-spurious-waffles.html#cb414-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(name) <span class="sc">%&gt;%</span> </span>
<span id="cb414-12"><a href="the-many-variables-the-spurious-waffles.html#cb414-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean =</span> <span class="fu">mean</span>(value),</span>
<span id="cb414-13"><a href="the-many-variables-the-spurious-waffles.html#cb414-13" aria-hidden="true" tabindex="-1"></a>            <span class="at">ll   =</span> <span class="fu">quantile</span>(value, <span class="at">prob =</span> .<span class="dv">025</span>),</span>
<span id="cb414-14"><a href="the-many-variables-the-spurious-waffles.html#cb414-14" aria-hidden="true" tabindex="-1"></a>            <span class="at">ul   =</span> <span class="fu">quantile</span>(value, <span class="at">prob =</span> .<span class="dv">975</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb414-15"><a href="the-many-variables-the-spurious-waffles.html#cb414-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(name, <span class="at">into =</span> <span class="fu">c</span>(<span class="st">&quot;fit&quot;</span>, <span class="st">&quot;parameter&quot;</span>), <span class="at">sep =</span> <span class="st">&quot;_&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb414-16"><a href="the-many-variables-the-spurious-waffles.html#cb414-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> mean, <span class="at">y =</span> fit,<span class="at">xmin =</span> ll,<span class="at">xmax =</span> ul)) <span class="sc">+</span></span>
<span id="cb414-17"><a href="the-many-variables-the-spurious-waffles.html#cb414-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_pointrange</span>(<span class="at">color =</span> <span class="st">&quot;firebrick&quot;</span>) <span class="sc">+</span></span>
<span id="cb414-18"><a href="the-many-variables-the-spurious-waffles.html#cb414-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">color =</span> <span class="st">&quot;firebrick&quot;</span>, <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">5</span>) <span class="sc">+</span></span>
<span id="cb414-19"><a href="the-many-variables-the-spurious-waffles.html#cb414-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb414-20"><a href="the-many-variables-the-spurious-waffles.html#cb414-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb414-21"><a href="the-many-variables-the-spurious-waffles.html#cb414-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb414-22"><a href="the-many-variables-the-spurious-waffles.html#cb414-22" aria-hidden="true" tabindex="-1"></a>        <span class="at">strip.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">&quot;transparent&quot;</span>, <span class="at">color =</span> <span class="st">&quot;transparent&quot;</span>)) <span class="sc">+</span></span>
<span id="cb414-23"><a href="the-many-variables-the-spurious-waffles.html#cb414-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> parameter, <span class="at">ncol =</span> <span class="dv">1</span>)</span></code></pre></div>
<p><img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-186-1.png" width="672" style="display: block; margin: auto;" /></p>
<p><br /></p>
</div>
<div id="m4-3" class="section level3 hasAnchor" number="5.4.3">
<h3><span class="header-section-number">5.4.3</span> 5M4<a href="the-many-variables-the-spurious-waffles.html#m4-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<blockquote>
<p>In the divorce data, States with high numbers of members of the Church of Jesus Christ of Latter-day Saints (LDS) have much lower divorce rates than the regression models expected. Find a list of LDS population by State and use those numbers as a predictor variable, predicting divorce rate using marriage rate, median age at marriage, and percent LDS population (possibly standardized). You may want to consider transformations of the raw percent LDS variable.</p>
</blockquote>
<div class="sourceCode" id="cb415"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb415-1"><a href="the-many-variables-the-spurious-waffles.html#cb415-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;WaffleDivorce&quot;</span>)</span>
<span id="cb415-2"><a href="the-many-variables-the-spurious-waffles.html#cb415-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb415-3"><a href="the-many-variables-the-spurious-waffles.html#cb415-3" aria-hidden="true" tabindex="-1"></a>lds <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;data/lds-data.csv&quot;</span>)</span>
<span id="cb415-4"><a href="the-many-variables-the-spurious-waffles.html#cb415-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb415-5"><a href="the-many-variables-the-spurious-waffles.html#cb415-5" aria-hidden="true" tabindex="-1"></a>lds <span class="ot">&lt;-</span> </span>
<span id="cb415-6"><a href="the-many-variables-the-spurious-waffles.html#cb415-6" aria-hidden="true" tabindex="-1"></a>lds <span class="sc">%&gt;%</span> </span>
<span id="cb415-7"><a href="the-many-variables-the-spurious-waffles.html#cb415-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">ldsrate =</span> <span class="fu">log</span>(members<span class="sc">/</span>population)) <span class="sc">%&gt;%</span> </span>
<span id="cb415-8"><a href="the-many-variables-the-spurious-waffles.html#cb415-8" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(state, ldsrate) <span class="sc">%&gt;%</span> </span>
<span id="cb415-9"><a href="the-many-variables-the-spurious-waffles.html#cb415-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">Location =</span> state)</span>
<span id="cb415-10"><a href="the-many-variables-the-spurious-waffles.html#cb415-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb415-11"><a href="the-many-variables-the-spurious-waffles.html#cb415-11" aria-hidden="true" tabindex="-1"></a>lds <span class="sc">%&gt;%</span> </span>
<span id="cb415-12"><a href="the-many-variables-the-spurious-waffles.html#cb415-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>ldsrate))<span class="sc">+</span></span>
<span id="cb415-13"><a href="the-many-variables-the-spurious-waffles.html#cb415-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>()</span></code></pre></div>
<p><img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-187-1.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb416"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb416-1"><a href="the-many-variables-the-spurious-waffles.html#cb416-1" aria-hidden="true" tabindex="-1"></a>d4 <span class="ot">&lt;-</span> </span>
<span id="cb416-2"><a href="the-many-variables-the-spurious-waffles.html#cb416-2" aria-hidden="true" tabindex="-1"></a>  WaffleDivorce <span class="sc">%&gt;%</span> </span>
<span id="cb416-3"><a href="the-many-variables-the-spurious-waffles.html#cb416-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(lds, <span class="at">by =</span> <span class="st">&quot;Location&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb416-4"><a href="the-many-variables-the-spurious-waffles.html#cb416-4" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(MedianAgeMarriage, Divorce, Marriage,ldsrate,South) <span class="sc">%&gt;%</span> </span>
<span id="cb416-5"><a href="the-many-variables-the-spurious-waffles.html#cb416-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>,standardize)) <span class="sc">%&gt;%</span> </span>
<span id="cb416-6"><a href="the-many-variables-the-spurious-waffles.html#cb416-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">A =</span> MedianAgeMarriage,</span>
<span id="cb416-7"><a href="the-many-variables-the-spurious-waffles.html#cb416-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">D =</span> Divorce,</span>
<span id="cb416-8"><a href="the-many-variables-the-spurious-waffles.html#cb416-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">M =</span> Marriage,</span>
<span id="cb416-9"><a href="the-many-variables-the-spurious-waffles.html#cb416-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">S=</span>South,</span>
<span id="cb416-10"><a href="the-many-variables-the-spurious-waffles.html#cb416-10" aria-hidden="true" tabindex="-1"></a>         <span class="at">L =</span> ldsrate)</span>
<span id="cb416-11"><a href="the-many-variables-the-spurious-waffles.html#cb416-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb416-12"><a href="the-many-variables-the-spurious-waffles.html#cb416-12" aria-hidden="true" tabindex="-1"></a><span class="fu">datatable</span>(d4)</span></code></pre></div>
<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-43ac3be5c5271d6ab1e2" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-43ac3be5c5271d6ab1e2">{"x":{"filter":"none","vertical":false,"data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47","48","49","50"],[-0.606289505135423,-0.686699253827126,-0.204240761676919,-1.41038699205243,0.599856725240091,-0.284650510368621,1.2431347147737,0.43903722785669,2.93173943729942,0.278217730473285,-0.123831012985219,0.68026647393179,-2.29489422766114,0.760676222623492,-0.284650510368621,-0.525879756443724,-0.847518751210527,-1.00833824859393,-0.123831012985219,0.278217730473285,1.0019054686986,1.96682245299901,0.278217730473285,0.197807981781586,-0.204240761676919,-0.36506025906032,-0.284650510368621,-0.525879756443724,0.599856725240091,1.3235444634654,-0.204240761676919,1.8864127043073,-0.284650510368621,-0.606289505135423,0.197807981781586,-1.32997724336073,-0.0434212642935173,0.841085971315194,1.7255932069239,0.278217730473285,-0.36506025906032,-0.686699253827126,-0.686699253827126,-2.21448447896944,0.68026647393179,0.278217730473285,-0.123831012985219,-0.847518751210527,0.197807981781586,-1.49079674074414],[1.65420529625679,1.54436430712952,0.610715899547661,2.0935692527659,-0.927057948234219,1.05007985605677,-1.64102437756152,-0.432773497161472,-1.86070635581607,-0.652455475416026,0.99515936149313,-0.762296464543303,-1.09181943192513,-0.927057948234219,0.720556888674938,0.281192932165829,0.500874910420383,1.59928480169315,0.720556888674938,1.81896677994771,-0.48769399172511,-1.0368989373615,-0.268012013470557,-1.25658091561605,0.775477383238576,-0.103250529779641,-0.322932508034195,-0.48769399172511,0.22627243760219,-1.97054734494335,0.281192932165829,-1.69594487212516,0.116431448474914,-0.927057948234219,-0.103250529779641,1.70912579082043,0.391033921293106,-1.09181943192513,-0.158171024343279,-0.872137453670581,0.665636394111299,0.940238866929492,0.171351943038552,0.281192932165829,-0.0483300352160025,-0.432773497161472,0.171351943038552,0.665636394111299,-0.762296464543303,0.336113426729468],[0.0226440603666971,1.54980161998118,0.0489743631186713,1.65512283098907,-0.266989269905014,0.891544051181833,-0.79359532494449,0.786222840173938,-0.635613508432648,-0.819925627696464,0.5229198126542,1.26016828970947,1.49714101447723,-0.582952902928701,-0.0826771506411978,0.364937996142357,0.5229198126542,0.549250115406173,0.127965271374593,-1.74148622401555,-0.477631691920805,-1.13588926072015,-0.951577141456334,-1.26754077448002,-0.214328664401067,-0.398640783664883,-0.424971086416857,-0.135337756145145,-0.898916535952386,-1.39919228823989,0.0753046658706445,-0.872586233200412,0.0753046658706445,1.73411373924499,-0.846255930448439,0.970534959437754,-0.319649875408963,-1.21488016897607,-1.34653168273594,-0.530292297424752,-0.00368624238527616,-0.187998361649094,0.364937996142357,2.49769251905224,-0.977907444208308,0.101634968622619,0.338607693390383,0.549250115406173,-0.767265022192517,2.78732584932395],[-0.409089920979932,1.21059641868532,1.45583457611071,-0.109906651459131,0.418341759989858,0.701120401000105,-0.902979155665755,-0.669050794537481,-0.906588322427468,-0.437876103159373,-0.348548420542442,1.34314283092822,2.78362470255068,-0.899580526462804,-0.518861065246238,-0.267382977636086,0.0769973078365038,-0.370942631522232,-0.582374508929445,-0.357510546574323,-0.472813382993198,-0.989089190042542,-0.894735590855512,-0.6512304441157,-0.461036950386781,-0.0201570947051832,1.24012236436498,0.0647676453172939,-0.559809480875635,-1.03980169230934,0.916857774900037,-0.942623269052776,-0.320194550271706,0.205997399922223,-0.738954323610751,0.0265825525579821,1.00221255017389,-0.985448328651335,-0.999838002538896,-0.370906882462099,-0.00668671510274941,-0.403565383599227,0.0298802807575683,3.63953805777464,-0.444374530789016,-0.0603746555356726,1.04157074810478,-0.212202900326332,-0.865929381605926,2.06327700399828],[1,0,0,1,0,0,0,0,0,1,1,0,0,0,0,0,0,1,1,0,0,0,0,0,1,1,0,0,0,0,0,0,1,0,0,0,0,0,0,1,0,1,1,0,0,1,0,1,0,0]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>A<\/th>\n      <th>D<\/th>\n      <th>M<\/th>\n      <th>L<\/th>\n      <th>S<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[1,2,3,4,5]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false},"selection":{"mode":"multiple","selected":null,"target":"row","selectable":null}},"evals":[],"jsHooks":[]}</script>
<div class="sourceCode" id="cb417"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb417-1"><a href="the-many-variables-the-spurious-waffles.html#cb417-1" aria-hidden="true" tabindex="-1"></a><span class="fu">pairs</span>(d4)</span></code></pre></div>
<p><img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-188-1.png" width="672" style="display: block; margin: auto;" /></p>
<p><br /></p>
<p>modelling</p>
<div class="sourceCode" id="cb418"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb418-1"><a href="the-many-variables-the-spurious-waffles.html#cb418-1" aria-hidden="true" tabindex="-1"></a>b<span class="fl">.5</span>M4 <span class="ot">&lt;-</span> </span>
<span id="cb418-2"><a href="the-many-variables-the-spurious-waffles.html#cb418-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">brm</span>(<span class="at">data =</span> d4,</span>
<span id="cb418-3"><a href="the-many-variables-the-spurious-waffles.html#cb418-3" aria-hidden="true" tabindex="-1"></a>            <span class="at">family =</span> gaussian,</span>
<span id="cb418-4"><a href="the-many-variables-the-spurious-waffles.html#cb418-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">formula =</span> D <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> A <span class="sc">+</span> M <span class="sc">+</span> L,</span>
<span id="cb418-5"><a href="the-many-variables-the-spurious-waffles.html#cb418-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">prior=</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>,<span class="fl">0.2</span>),<span class="at">class=</span>Intercept),</span>
<span id="cb418-6"><a href="the-many-variables-the-spurious-waffles.html#cb418-6" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>,<span class="fl">0.5</span>),<span class="at">class=</span>b),</span>
<span id="cb418-7"><a href="the-many-variables-the-spurious-waffles.html#cb418-7" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>),<span class="at">class=</span>sigma)),</span>
<span id="cb418-8"><a href="the-many-variables-the-spurious-waffles.html#cb418-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">seed =</span> <span class="dv">5</span>, <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>,</span>
<span id="cb418-9"><a href="the-many-variables-the-spurious-waffles.html#cb418-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">backend =</span> <span class="st">&quot;cmdstanr&quot;</span>,</span>
<span id="cb418-10"><a href="the-many-variables-the-spurious-waffles.html#cb418-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">sample_prior =</span> T,</span>
<span id="cb418-11"><a href="the-many-variables-the-spurious-waffles.html#cb418-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">file =</span> <span class="st">&quot;output/Chapter5/b.5M4&quot;</span>)</span>
<span id="cb418-12"><a href="the-many-variables-the-spurious-waffles.html#cb418-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb418-13"><a href="the-many-variables-the-spurious-waffles.html#cb418-13" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(b<span class="fl">.5</span>M4)</span></code></pre></div>
<pre><code>##  Family: gaussian 
##   Links: mu = identity; sigma = identity 
## Formula: D ~ 1 + A + M + L 
##    Data: d4 (Number of observations: 50) 
##   Draws: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
##          total post-warmup draws = 4000
## 
## Population-Level Effects: 
##           Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## Intercept    -0.00      0.10    -0.20     0.21 1.00     3999     2466
## A            -0.69      0.16    -0.99    -0.37 1.00     3257     2947
## M             0.08      0.17    -0.24     0.42 1.00     3068     3018
## L            -0.29      0.16    -0.59     0.02 1.00     3199     2816
## 
## Family Specific Parameters: 
##       Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## sigma     0.80      0.09     0.65     0.99 1.00     3561     2782
## 
## Draws were sampled using sample(hmc). For each parameter, Bulk_ESS
## and Tail_ESS are effective sample size measures, and Rhat is the potential
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<div class="sourceCode" id="cb420"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb420-1"><a href="the-many-variables-the-spurious-waffles.html#cb420-1" aria-hidden="true" tabindex="-1"></a>b<span class="fl">.5</span>M4_2 <span class="ot">&lt;-</span> <span class="fu">brm</span>(<span class="at">data =</span> d4,</span>
<span id="cb420-2"><a href="the-many-variables-the-spurious-waffles.html#cb420-2" aria-hidden="true" tabindex="-1"></a>            <span class="at">family =</span> gaussian,</span>
<span id="cb420-3"><a href="the-many-variables-the-spurious-waffles.html#cb420-3" aria-hidden="true" tabindex="-1"></a>            <span class="at">formula =</span> M <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> A <span class="sc">+</span> L,</span>
<span id="cb420-4"><a href="the-many-variables-the-spurious-waffles.html#cb420-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">prior=</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>,<span class="fl">0.2</span>),<span class="at">class=</span>Intercept),</span>
<span id="cb420-5"><a href="the-many-variables-the-spurious-waffles.html#cb420-5" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>,<span class="fl">0.5</span>),<span class="at">class=</span>b),</span>
<span id="cb420-6"><a href="the-many-variables-the-spurious-waffles.html#cb420-6" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>),<span class="at">class=</span>sigma)),</span>
<span id="cb420-7"><a href="the-many-variables-the-spurious-waffles.html#cb420-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">seed =</span> <span class="dv">5</span>, <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>,</span>
<span id="cb420-8"><a href="the-many-variables-the-spurious-waffles.html#cb420-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">sample_prior =</span> T,</span>
<span id="cb420-9"><a href="the-many-variables-the-spurious-waffles.html#cb420-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">backend =</span> <span class="st">&quot;cmdstanr&quot;</span>,</span>
<span id="cb420-10"><a href="the-many-variables-the-spurious-waffles.html#cb420-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">file =</span> <span class="st">&quot;output/Chapter5/b.5M4_2&quot;</span>)</span>
<span id="cb420-11"><a href="the-many-variables-the-spurious-waffles.html#cb420-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb420-12"><a href="the-many-variables-the-spurious-waffles.html#cb420-12" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(b<span class="fl">.5</span>M4_2)</span></code></pre></div>
<pre><code>##  Family: gaussian 
##   Links: mu = identity; sigma = identity 
## Formula: M ~ 1 + A + L 
##    Data: d4 (Number of observations: 50) 
##   Draws: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
##          total post-warmup draws = 4000
## 
## Population-Level Effects: 
##           Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## Intercept     0.00      0.08    -0.17     0.17 1.00     3796     2327
## A            -0.44      0.11    -0.67    -0.22 1.00     3163     2902
## L             0.42      0.11     0.19     0.64 1.00     3332     3089
## 
## Family Specific Parameters: 
##       Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## sigma     0.63      0.07     0.52     0.78 1.00     3609     2898
## 
## Draws were sampled using sample(hmc). For each parameter, Bulk_ESS
## and Tail_ESS are effective sample size measures, and Rhat is the potential
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<div class="sourceCode" id="cb422"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb422-1"><a href="the-many-variables-the-spurious-waffles.html#cb422-1" aria-hidden="true" tabindex="-1"></a>b<span class="fl">.5</span>M4_3<span class="ot">&lt;-</span> <span class="fu">brm</span>(<span class="at">data =</span> d4,</span>
<span id="cb422-2"><a href="the-many-variables-the-spurious-waffles.html#cb422-2" aria-hidden="true" tabindex="-1"></a>            <span class="at">family =</span> gaussian,</span>
<span id="cb422-3"><a href="the-many-variables-the-spurious-waffles.html#cb422-3" aria-hidden="true" tabindex="-1"></a>            <span class="at">formula =</span> A <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> M <span class="sc">+</span> L,</span>
<span id="cb422-4"><a href="the-many-variables-the-spurious-waffles.html#cb422-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">prior=</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>,<span class="fl">0.2</span>),<span class="at">class=</span>Intercept),</span>
<span id="cb422-5"><a href="the-many-variables-the-spurious-waffles.html#cb422-5" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>,<span class="fl">0.5</span>),<span class="at">class=</span>b),</span>
<span id="cb422-6"><a href="the-many-variables-the-spurious-waffles.html#cb422-6" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>),<span class="at">class=</span>sigma)),</span>
<span id="cb422-7"><a href="the-many-variables-the-spurious-waffles.html#cb422-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">seed =</span> <span class="dv">5</span>, <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>,</span>
<span id="cb422-8"><a href="the-many-variables-the-spurious-waffles.html#cb422-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">sample_prior =</span> T,</span>
<span id="cb422-9"><a href="the-many-variables-the-spurious-waffles.html#cb422-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">backend =</span> <span class="st">&quot;cmdstanr&quot;</span>,</span>
<span id="cb422-10"><a href="the-many-variables-the-spurious-waffles.html#cb422-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">file =</span> <span class="st">&quot;output/Chapter5/b.5M4_3&quot;</span>)</span>
<span id="cb422-11"><a href="the-many-variables-the-spurious-waffles.html#cb422-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb422-12"><a href="the-many-variables-the-spurious-waffles.html#cb422-12" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(b<span class="fl">.5</span>M4_3)</span></code></pre></div>
<pre><code>##  Family: gaussian 
##   Links: mu = identity; sigma = identity 
## Formula: A ~ 1 + M + L 
##    Data: d4 (Number of observations: 50) 
##   Draws: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
##          total post-warmup draws = 4000
## 
## Population-Level Effects: 
##           Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## Intercept    -0.00      0.09    -0.17     0.17 1.00     3742     2832
## M            -0.51      0.13    -0.77    -0.25 1.00     2603     2777
## L            -0.26      0.13    -0.53    -0.01 1.00     2517     2746
## 
## Family Specific Parameters: 
##       Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## sigma     0.69      0.08     0.57     0.85 1.00     3757     3123
## 
## Draws were sampled using sample(hmc). For each parameter, Bulk_ESS
## and Tail_ESS are effective sample size measures, and Rhat is the potential
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<div class="sourceCode" id="cb424"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb424-1"><a href="the-many-variables-the-spurious-waffles.html#cb424-1" aria-hidden="true" tabindex="-1"></a>b<span class="fl">.5</span>M4_4<span class="ot">&lt;-</span> <span class="fu">brm</span>(<span class="at">data =</span> d4,</span>
<span id="cb424-2"><a href="the-many-variables-the-spurious-waffles.html#cb424-2" aria-hidden="true" tabindex="-1"></a>            <span class="at">family =</span> gaussian,</span>
<span id="cb424-3"><a href="the-many-variables-the-spurious-waffles.html#cb424-3" aria-hidden="true" tabindex="-1"></a>            <span class="at">formula =</span> L <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> A <span class="sc">+</span> M,</span>
<span id="cb424-4"><a href="the-many-variables-the-spurious-waffles.html#cb424-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">prior=</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>,<span class="fl">0.2</span>),<span class="at">class=</span>Intercept),</span>
<span id="cb424-5"><a href="the-many-variables-the-spurious-waffles.html#cb424-5" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>,<span class="fl">0.5</span>),<span class="at">class=</span>b),</span>
<span id="cb424-6"><a href="the-many-variables-the-spurious-waffles.html#cb424-6" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>),<span class="at">class=</span>sigma)),</span>
<span id="cb424-7"><a href="the-many-variables-the-spurious-waffles.html#cb424-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">seed =</span> <span class="dv">5</span>, <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>,</span>
<span id="cb424-8"><a href="the-many-variables-the-spurious-waffles.html#cb424-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">sample_prior =</span> T,</span>
<span id="cb424-9"><a href="the-many-variables-the-spurious-waffles.html#cb424-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">backend =</span> <span class="st">&quot;cmdstanr&quot;</span>,</span>
<span id="cb424-10"><a href="the-many-variables-the-spurious-waffles.html#cb424-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">file =</span> <span class="st">&quot;output/Chapter5/b.5M4_4&quot;</span>)</span>
<span id="cb424-11"><a href="the-many-variables-the-spurious-waffles.html#cb424-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb424-12"><a href="the-many-variables-the-spurious-waffles.html#cb424-12" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(b<span class="fl">.5</span>M4_4)</span></code></pre></div>
<pre><code>##  Family: gaussian 
##   Links: mu = identity; sigma = identity 
## Formula: L ~ 1 + A + M 
##    Data: d4 (Number of observations: 50) 
##   Draws: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
##          total post-warmup draws = 4000
## 
## Population-Level Effects: 
##           Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## Intercept     0.00      0.09    -0.17     0.17 1.00     3967     2519
## A            -0.27      0.13    -0.53    -0.01 1.00     2896     2913
## M             0.50      0.14     0.23     0.77 1.00     3000     2825
## 
## Family Specific Parameters: 
##       Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## sigma     0.70      0.07     0.57     0.86 1.00     3993     3024
## 
## Draws were sampled using sample(hmc). For each parameter, Bulk_ESS
## and Tail_ESS are effective sample size measures, and Rhat is the potential
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<div class="sourceCode" id="cb426"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb426-1"><a href="the-many-variables-the-spurious-waffles.html#cb426-1" aria-hidden="true" tabindex="-1"></a>b<span class="fl">.5</span>M4_5<span class="ot">&lt;-</span> <span class="fu">brm</span>(<span class="at">data =</span> d4,</span>
<span id="cb426-2"><a href="the-many-variables-the-spurious-waffles.html#cb426-2" aria-hidden="true" tabindex="-1"></a>            <span class="at">family =</span> gaussian,</span>
<span id="cb426-3"><a href="the-many-variables-the-spurious-waffles.html#cb426-3" aria-hidden="true" tabindex="-1"></a>            <span class="at">formula =</span> M <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> A <span class="sc">+</span> L <span class="sc">+</span> D,</span>
<span id="cb426-4"><a href="the-many-variables-the-spurious-waffles.html#cb426-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">prior=</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>,<span class="fl">0.2</span>),<span class="at">class=</span>Intercept),</span>
<span id="cb426-5"><a href="the-many-variables-the-spurious-waffles.html#cb426-5" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>,<span class="fl">0.5</span>),<span class="at">class=</span>b),</span>
<span id="cb426-6"><a href="the-many-variables-the-spurious-waffles.html#cb426-6" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>),<span class="at">class=</span>sigma)),</span>
<span id="cb426-7"><a href="the-many-variables-the-spurious-waffles.html#cb426-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">seed =</span> <span class="dv">5</span>, <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>,</span>
<span id="cb426-8"><a href="the-many-variables-the-spurious-waffles.html#cb426-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">sample_prior =</span> T,</span>
<span id="cb426-9"><a href="the-many-variables-the-spurious-waffles.html#cb426-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">backend =</span> <span class="st">&quot;cmdstanr&quot;</span>,</span>
<span id="cb426-10"><a href="the-many-variables-the-spurious-waffles.html#cb426-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">file =</span> <span class="st">&quot;output/Chapter5/b.5M4_5&quot;</span>)</span>
<span id="cb426-11"><a href="the-many-variables-the-spurious-waffles.html#cb426-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb426-12"><a href="the-many-variables-the-spurious-waffles.html#cb426-12" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(b<span class="fl">.5</span>M4_5)</span></code></pre></div>
<pre><code>##  Family: gaussian 
##   Links: mu = identity; sigma = identity 
## Formula: M ~ 1 + A + L + D 
##    Data: d4 (Number of observations: 50) 
##   Draws: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
##          total post-warmup draws = 4000
## 
## Population-Level Effects: 
##           Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## Intercept    -0.00      0.08    -0.17     0.16 1.00     4281     2508
## A            -0.40      0.14    -0.69    -0.13 1.00     2097     2265
## L             0.43      0.12     0.20     0.66 1.00     2510     2688
## D             0.05      0.12    -0.18     0.28 1.00     3043     2803
## 
## Family Specific Parameters: 
##       Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## sigma     0.64      0.07     0.53     0.79 1.00     3391     2947
## 
## Draws were sampled using sample(hmc). For each parameter, Bulk_ESS
## and Tail_ESS are effective sample size measures, and Rhat is the potential
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<div class="sourceCode" id="cb428"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb428-1"><a href="the-many-variables-the-spurious-waffles.html#cb428-1" aria-hidden="true" tabindex="-1"></a><span class="co"># all</span></span>
<span id="cb428-2"><a href="the-many-variables-the-spurious-waffles.html#cb428-2" aria-hidden="true" tabindex="-1"></a>b1 <span class="ot">&lt;-</span> <span class="fu">bf</span>(D <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> A <span class="sc">+</span> L)</span>
<span id="cb428-3"><a href="the-many-variables-the-spurious-waffles.html#cb428-3" aria-hidden="true" tabindex="-1"></a>b2 <span class="ot">&lt;-</span> <span class="fu">bf</span>(M <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> A <span class="sc">+</span> L)</span>
<span id="cb428-4"><a href="the-many-variables-the-spurious-waffles.html#cb428-4" aria-hidden="true" tabindex="-1"></a>b3 <span class="ot">&lt;-</span> <span class="fu">bf</span>(A <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> L)</span>
<span id="cb428-5"><a href="the-many-variables-the-spurious-waffles.html#cb428-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb428-6"><a href="the-many-variables-the-spurious-waffles.html#cb428-6" aria-hidden="true" tabindex="-1"></a>b<span class="fl">.5</span>M4_all<span class="ot">&lt;-</span> <span class="fu">brm</span>(<span class="at">data =</span> d4,</span>
<span id="cb428-7"><a href="the-many-variables-the-spurious-waffles.html#cb428-7" aria-hidden="true" tabindex="-1"></a>            <span class="at">family =</span> gaussian,</span>
<span id="cb428-8"><a href="the-many-variables-the-spurious-waffles.html#cb428-8" aria-hidden="true" tabindex="-1"></a>            <span class="at">formula =</span> b1 <span class="sc">+</span> b2 <span class="sc">+</span>b3<span class="sc">+</span> <span class="fu">set_rescor</span>(<span class="cn">FALSE</span>),</span>
<span id="cb428-9"><a href="the-many-variables-the-spurious-waffles.html#cb428-9" aria-hidden="true" tabindex="-1"></a>            <span class="at">prior=</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>,<span class="fl">0.2</span>),<span class="at">class=</span>Intercept, <span class="at">resp =</span> D),</span>
<span id="cb428-10"><a href="the-many-variables-the-spurious-waffles.html#cb428-10" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>,<span class="fl">0.5</span>),<span class="at">class=</span>b,<span class="at">resp=</span>D),</span>
<span id="cb428-11"><a href="the-many-variables-the-spurious-waffles.html#cb428-11" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>),<span class="at">class=</span>sigma,<span class="at">resp=</span>D),</span>
<span id="cb428-12"><a href="the-many-variables-the-spurious-waffles.html#cb428-12" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>,<span class="fl">0.2</span>),<span class="at">class=</span>Intercept,<span class="at">resp=</span>A),</span>
<span id="cb428-13"><a href="the-many-variables-the-spurious-waffles.html#cb428-13" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>,<span class="fl">0.5</span>),<span class="at">class=</span>b,<span class="at">resp=</span>A),</span>
<span id="cb428-14"><a href="the-many-variables-the-spurious-waffles.html#cb428-14" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>),<span class="at">class=</span>sigma,<span class="at">resp=</span>A),</span>
<span id="cb428-15"><a href="the-many-variables-the-spurious-waffles.html#cb428-15" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>,<span class="fl">0.2</span>),<span class="at">class=</span>Intercept,<span class="at">resp=</span>M),</span>
<span id="cb428-16"><a href="the-many-variables-the-spurious-waffles.html#cb428-16" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>,<span class="fl">0.5</span>),<span class="at">class=</span>b,<span class="at">resp=</span>M),</span>
<span id="cb428-17"><a href="the-many-variables-the-spurious-waffles.html#cb428-17" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>),<span class="at">class=</span>sigma,</span>
<span id="cb428-18"><a href="the-many-variables-the-spurious-waffles.html#cb428-18" aria-hidden="true" tabindex="-1"></a>                      <span class="at">resp=</span>M)),</span>
<span id="cb428-19"><a href="the-many-variables-the-spurious-waffles.html#cb428-19" aria-hidden="true" tabindex="-1"></a>      <span class="at">seed =</span> <span class="dv">5</span>, <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>,</span>
<span id="cb428-20"><a href="the-many-variables-the-spurious-waffles.html#cb428-20" aria-hidden="true" tabindex="-1"></a>      <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">sample_prior =</span> T,</span>
<span id="cb428-21"><a href="the-many-variables-the-spurious-waffles.html#cb428-21" aria-hidden="true" tabindex="-1"></a>      <span class="at">backend =</span> <span class="st">&quot;cmdstanr&quot;</span>,</span>
<span id="cb428-22"><a href="the-many-variables-the-spurious-waffles.html#cb428-22" aria-hidden="true" tabindex="-1"></a>      <span class="at">file =</span> <span class="st">&quot;output/Chapter5/b.5M4_all&quot;</span>)</span>
<span id="cb428-23"><a href="the-many-variables-the-spurious-waffles.html#cb428-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb428-24"><a href="the-many-variables-the-spurious-waffles.html#cb428-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb428-25"><a href="the-many-variables-the-spurious-waffles.html#cb428-25" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(b<span class="fl">.5</span>M4_all)</span></code></pre></div>
<pre><code>##  Family: MV(gaussian, gaussian, gaussian) 
##   Links: mu = identity; sigma = identity
##          mu = identity; sigma = identity
##          mu = identity; sigma = identity 
## Formula: D ~ 1 + A + L 
##          M ~ 1 + A + L 
##          A ~ 1 + L 
##    Data: d4 (Number of observations: 50) 
##   Draws: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
##          total post-warmup draws = 4000
## 
## Population-Level Effects: 
##             Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## D_Intercept     0.00      0.10    -0.19     0.20 1.00     8041     2770
## M_Intercept     0.00      0.08    -0.16     0.17 1.00     8274     2960
## A_Intercept    -0.00      0.10    -0.19     0.18 1.00     7400     2906
## D_A            -0.73      0.14    -0.99    -0.45 1.00     4533     3290
## D_L            -0.26      0.14    -0.53     0.02 1.00     4510     3388
## M_A            -0.44      0.11    -0.66    -0.21 1.00     4511     2830
## M_L             0.42      0.11     0.20     0.64 1.00     4550     3271
## A_L            -0.61      0.11    -0.82    -0.39 1.00     8292     3027
## 
## Family Specific Parameters: 
##         Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## sigma_D     0.79      0.08     0.65     0.97 1.00     6552     2899
## sigma_M     0.64      0.07     0.52     0.78 1.00     7181     3337
## sigma_A     0.79      0.08     0.65     0.98 1.00     6647     2817
## 
## Draws were sampled using sample(hmc). For each parameter, Bulk_ESS
## and Tail_ESS are effective sample size measures, and Rhat is the potential
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<div class="sourceCode" id="cb430"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb430-1"><a href="the-many-variables-the-spurious-waffles.html#cb430-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(bayesplot)</span>
<span id="cb430-2"><a href="the-many-variables-the-spurious-waffles.html#cb430-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb430-3"><a href="the-many-variables-the-spurious-waffles.html#cb430-3" aria-hidden="true" tabindex="-1"></a><span class="fu">posterior_samples</span>(b<span class="fl">.5</span>M4_all) <span class="sc">%&gt;%</span> </span>
<span id="cb430-4"><a href="the-many-variables-the-spurious-waffles.html#cb430-4" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>lp__) <span class="sc">%&gt;%</span> </span>
<span id="cb430-5"><a href="the-many-variables-the-spurious-waffles.html#cb430-5" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="fu">starts_with</span>(<span class="st">&quot;b_&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb430-6"><a href="the-many-variables-the-spurious-waffles.html#cb430-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mcmc_intervals</span>()</span></code></pre></div>
<p><img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-190-1.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb431"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb431-1"><a href="the-many-variables-the-spurious-waffles.html#cb431-1" aria-hidden="true" tabindex="-1"></a><span class="fu">posterior_samples</span>(b<span class="fl">.5</span>M4_all) <span class="sc">%&gt;%</span> </span>
<span id="cb431-2"><a href="the-many-variables-the-spurious-waffles.html#cb431-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="fu">starts_with</span>(<span class="st">&quot;b_&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb431-3"><a href="the-many-variables-the-spurious-waffles.html#cb431-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">everything</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb431-4"><a href="the-many-variables-the-spurious-waffles.html#cb431-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(name) <span class="sc">%&gt;%</span> </span>
<span id="cb431-5"><a href="the-many-variables-the-spurious-waffles.html#cb431-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">median_hdi</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb431-6"><a href="the-many-variables-the-spurious-waffles.html#cb431-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>()</span></code></pre></div>
<pre><code>##            name         value    .lower      .upper .width .point .interval
## 1 b_A_Intercept -0.0012076800 -0.185829  0.18290800   0.95 median       hdi
## 2         b_A_L -0.6104695000 -0.832102 -0.39804600   0.95 median       hdi
## 3         b_D_A -0.7285490000 -0.984386 -0.45322400   0.95 median       hdi
## 4 b_D_Intercept  0.0011336100 -0.183601  0.20455000   0.95 median       hdi
## 5         b_D_L -0.2561405000 -0.536132  0.00771803   0.95 median       hdi
## 6         b_M_A -0.4346445000 -0.661619 -0.20759500   0.95 median       hdi
## 7 b_M_Intercept  0.0002934045 -0.166698  0.16098400   0.95 median       hdi
## 8         b_M_L  0.4217880000  0.202541  0.64777700   0.95 median       hdi</code></pre>
<p>Graphical model</p>
<div class="sourceCode" id="cb433"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb433-1"><a href="the-many-variables-the-spurious-waffles.html#cb433-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dagitty)</span>
<span id="cb433-2"><a href="the-many-variables-the-spurious-waffles.html#cb433-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb433-3"><a href="the-many-variables-the-spurious-waffles.html#cb433-3" aria-hidden="true" tabindex="-1"></a>mad_dag <span class="ot">&lt;-</span> <span class="fu">dagitty</span>(<span class="st">&quot;dag{  D&lt;-A -&gt; M &lt;- L-&gt;D;</span></span>
<span id="cb433-4"><a href="the-many-variables-the-spurious-waffles.html#cb433-4" aria-hidden="true" tabindex="-1"></a><span class="st">                          A &lt;- L</span></span>
<span id="cb433-5"><a href="the-many-variables-the-spurious-waffles.html#cb433-5" aria-hidden="true" tabindex="-1"></a><span class="st">                   }&quot;</span>)</span>
<span id="cb433-6"><a href="the-many-variables-the-spurious-waffles.html#cb433-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb433-7"><a href="the-many-variables-the-spurious-waffles.html#cb433-7" aria-hidden="true" tabindex="-1"></a><span class="fu">ggdag</span>(mad_dag)</span></code></pre></div>
<p><img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-191-1.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb434"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb434-1"><a href="the-many-variables-the-spurious-waffles.html#cb434-1" aria-hidden="true" tabindex="-1"></a><span class="fu">impliedConditionalIndependencies</span>(mad_dag)</span></code></pre></div>
<pre><code>## D _||_ M | A, L</code></pre>
<div class="sourceCode" id="cb436"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb436-1"><a href="the-many-variables-the-spurious-waffles.html#cb436-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggdag_equivalent_dags</span>(mad_dag)</span></code></pre></div>
<p><img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-191-2.png" width="672" style="display: block; margin: auto;" /></p>
<p><br /></p>
</div>
<div id="h1-3" class="section level3 hasAnchor" number="5.4.4">
<h3><span class="header-section-number">5.4.4</span> 5H1<a href="the-many-variables-the-spurious-waffles.html#h1-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<blockquote>
<p>In the divorce example, suppose the DAG is: M→A→D. What are the implied conditional independencies of the graph? Are the data consistent with it?</p>
</blockquote>
<div class="sourceCode" id="cb437"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb437-1"><a href="the-many-variables-the-spurious-waffles.html#cb437-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dagitty)</span>
<span id="cb437-2"><a href="the-many-variables-the-spurious-waffles.html#cb437-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb437-3"><a href="the-many-variables-the-spurious-waffles.html#cb437-3" aria-hidden="true" tabindex="-1"></a>mad_dag <span class="ot">&lt;-</span> <span class="fu">dagitty</span>(<span class="st">&quot;dag{M -&gt; A -&gt; D}&quot;</span>)</span>
<span id="cb437-4"><a href="the-many-variables-the-spurious-waffles.html#cb437-4" aria-hidden="true" tabindex="-1"></a><span class="fu">impliedConditionalIndependencies</span>(mad_dag)</span></code></pre></div>
<pre><code>## D _||_ M | A</code></pre>
<p>データに適合する因果ダイアグラムは以下の通り。</p>
<div class="sourceCode" id="cb439"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb439-1"><a href="the-many-variables-the-spurious-waffles.html#cb439-1" aria-hidden="true" tabindex="-1"></a><span class="fu">equivalentDAGs</span>(mad_dag)</span></code></pre></div>
<pre><code>## [[1]]
## dag {
## A
## D
## M
## A -&gt; D
## M -&gt; A
## }
## 
## [[2]]
## dag {
## A
## D
## M
## A -&gt; D
## A -&gt; M
## }
## 
## [[3]]
## dag {
## A
## D
## M
## A -&gt; M
## D -&gt; A
## }</code></pre>
</div>
<div id="h2-3" class="section level3 hasAnchor" number="5.4.5">
<h3><span class="header-section-number">5.4.5</span> 5H2<a href="the-many-variables-the-spurious-waffles.html#h2-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<blockquote>
<p>Assuming that the DAG for the divorce example is indeed M→A→D, fit a new model and use it to estimate the counterfactual effect of halving a State’s marriage rate M. Using the counterfactual example from the chapter (starting on page 140) as a template.</p>
</blockquote>
<div class="sourceCode" id="cb441"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb441-1"><a href="the-many-variables-the-spurious-waffles.html#cb441-1" aria-hidden="true" tabindex="-1"></a>mad_dag <span class="ot">&lt;-</span> <span class="fu">dagitty</span>(<span class="st">&quot;dag{  M -&gt; A -&gt; D}&quot;</span>)</span>
<span id="cb441-2"><a href="the-many-variables-the-spurious-waffles.html#cb441-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggdag_equivalent_dags</span>(mad_dag)</span></code></pre></div>
<p><img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-194-1.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb442"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb442-1"><a href="the-many-variables-the-spurious-waffles.html#cb442-1" aria-hidden="true" tabindex="-1"></a>b1 <span class="ot">&lt;-</span> <span class="fu">bf</span>(D <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> A <span class="sc">+</span> M)</span>
<span id="cb442-2"><a href="the-many-variables-the-spurious-waffles.html#cb442-2" aria-hidden="true" tabindex="-1"></a>b2 <span class="ot">&lt;-</span> <span class="fu">bf</span>(A <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> M)</span>
<span id="cb442-3"><a href="the-many-variables-the-spurious-waffles.html#cb442-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb442-4"><a href="the-many-variables-the-spurious-waffles.html#cb442-4" aria-hidden="true" tabindex="-1"></a>b<span class="fl">.5</span>H2 <span class="ot">&lt;-</span> </span>
<span id="cb442-5"><a href="the-many-variables-the-spurious-waffles.html#cb442-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">brm</span>(<span class="at">data =</span> d4,</span>
<span id="cb442-6"><a href="the-many-variables-the-spurious-waffles.html#cb442-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> gaussian,</span>
<span id="cb442-7"><a href="the-many-variables-the-spurious-waffles.html#cb442-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">formula =</span> b1 <span class="sc">+</span> b2 <span class="sc">+</span> <span class="fu">set_rescor</span>(<span class="at">rescor =</span> <span class="cn">FALSE</span>),</span>
<span id="cb442-8"><a href="the-many-variables-the-spurious-waffles.html#cb442-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>,<span class="fl">0.2</span>),<span class="at">class=</span>Intercept,<span class="at">resp=</span>D),  </span>
<span id="cb442-9"><a href="the-many-variables-the-spurious-waffles.html#cb442-9" aria-hidden="true" tabindex="-1"></a>              <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>,<span class="fl">0.2</span>),<span class="at">class=</span>Intercept,<span class="at">resp=</span>A),</span>
<span id="cb442-10"><a href="the-many-variables-the-spurious-waffles.html#cb442-10" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>,<span class="fl">0.5</span>),<span class="at">class=</span>b,<span class="at">resp=</span>A),</span>
<span id="cb442-11"><a href="the-many-variables-the-spurious-waffles.html#cb442-11" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>,<span class="fl">0.5</span>),<span class="at">class=</span>b,<span class="at">resp=</span>D),</span>
<span id="cb442-12"><a href="the-many-variables-the-spurious-waffles.html#cb442-12" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>),<span class="at">class=</span>sigma,</span>
<span id="cb442-13"><a href="the-many-variables-the-spurious-waffles.html#cb442-13" aria-hidden="true" tabindex="-1"></a>                      <span class="at">resp =</span> D),</span>
<span id="cb442-14"><a href="the-many-variables-the-spurious-waffles.html#cb442-14" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>),<span class="at">class=</span>sigma,</span>
<span id="cb442-15"><a href="the-many-variables-the-spurious-waffles.html#cb442-15" aria-hidden="true" tabindex="-1"></a>                      <span class="at">resp =</span> A)),</span>
<span id="cb442-16"><a href="the-many-variables-the-spurious-waffles.html#cb442-16" aria-hidden="true" tabindex="-1"></a>      <span class="at">seed =</span> <span class="dv">5</span>, <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>,</span>
<span id="cb442-17"><a href="the-many-variables-the-spurious-waffles.html#cb442-17" aria-hidden="true" tabindex="-1"></a>      <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">sample_prior =</span> T,</span>
<span id="cb442-18"><a href="the-many-variables-the-spurious-waffles.html#cb442-18" aria-hidden="true" tabindex="-1"></a>      <span class="at">backend =</span> <span class="st">&quot;cmdstanr&quot;</span>,</span>
<span id="cb442-19"><a href="the-many-variables-the-spurious-waffles.html#cb442-19" aria-hidden="true" tabindex="-1"></a>      <span class="at">file =</span> <span class="st">&quot;output/Chapter5/b.5H2&quot;</span>)</span>
<span id="cb442-20"><a href="the-many-variables-the-spurious-waffles.html#cb442-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb442-21"><a href="the-many-variables-the-spurious-waffles.html#cb442-21" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(b<span class="fl">.5</span>H2)</span></code></pre></div>
<pre><code>##  Family: MV(gaussian, gaussian) 
##   Links: mu = identity; sigma = identity
##          mu = identity; sigma = identity 
## Formula: D ~ 1 + A + M 
##          A ~ 1 + M 
##    Data: d4 (Number of observations: 50) 
##   Draws: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
##          total post-warmup draws = 4000
## 
## Population-Level Effects: 
##             Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## D_Intercept     0.00      0.10    -0.20     0.20 1.00     6273     3012
## A_Intercept    -0.00      0.09    -0.18     0.18 1.00     5121     2775
## D_A            -0.60      0.16    -0.92    -0.29 1.00     3693     3016
## D_M            -0.06      0.16    -0.37     0.25 1.00     3797     2818
## A_M            -0.69      0.10    -0.89    -0.49 1.00     5113     2805
## 
## Family Specific Parameters: 
##         Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## sigma_D     0.83      0.09     0.68     1.02 1.00     5012     3145
## sigma_A     0.71      0.07     0.58     0.88 1.00     4978     3004
## 
## Draws were sampled using sample(hmc). For each parameter, Bulk_ESS
## and Tail_ESS are effective sample size measures, and Rhat is the potential
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<div class="sourceCode" id="cb444"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb444-1"><a href="the-many-variables-the-spurious-waffles.html#cb444-1" aria-hidden="true" tabindex="-1"></a><span class="fu">posterior_samples</span>(b<span class="fl">.5</span>H2) <span class="sc">%&gt;%</span> </span>
<span id="cb444-2"><a href="the-many-variables-the-spurious-waffles.html#cb444-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="fu">starts_with</span>(<span class="st">&quot;b_&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb444-3"><a href="the-many-variables-the-spurious-waffles.html#cb444-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mcmc_intervals</span>(<span class="at">prob =</span> <span class="fl">0.5</span>,<span class="at">prob_outer=</span>.<span class="dv">95</span>)</span></code></pre></div>
<p><img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-194-2.png" width="672" style="display: block; margin: auto;" /></p>
<p><br /></p>
<div class="sourceCode" id="cb445"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb445-1"><a href="the-many-variables-the-spurious-waffles.html#cb445-1" aria-hidden="true" tabindex="-1"></a><span class="fu">posterior_samples</span>(b<span class="fl">.5</span>H2) <span class="sc">%&gt;%</span> </span>
<span id="cb445-2"><a href="the-many-variables-the-spurious-waffles.html#cb445-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb445-3"><a href="the-many-variables-the-spurious-waffles.html#cb445-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="fu">starts_with</span>(<span class="st">&quot;b_&quot;</span>),<span class="fu">starts_with</span>(<span class="st">&quot;sigma&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb445-4"><a href="the-many-variables-the-spurious-waffles.html#cb445-4" aria-hidden="true" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">expand</span>(<span class="fu">nesting</span>(b_D_Intercept, b_A_Intercept, b_D_A, b_D_M, b_A_M,sigma_D, sigma_A),</span>
<span id="cb445-5"><a href="the-many-variables-the-spurious-waffles.html#cb445-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">M =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">2</span>,<span class="dv">2</span>,<span class="at">length.out=</span><span class="dv">50</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb445-6"><a href="the-many-variables-the-spurious-waffles.html#cb445-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">a_sim =</span> <span class="fu">rnorm</span>(<span class="fu">n</span>(),<span class="at">mean=</span>b_A_Intercept<span class="sc">+</span></span>
<span id="cb445-7"><a href="the-many-variables-the-spurious-waffles.html#cb445-7" aria-hidden="true" tabindex="-1"></a>                         b_A_M<span class="sc">*</span>M, sigma_A),</span>
<span id="cb445-8"><a href="the-many-variables-the-spurious-waffles.html#cb445-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">d_sim =</span> <span class="fu">rnorm</span>(<span class="fu">n</span>(),<span class="at">mean=</span>b_D_Intercept<span class="sc">+</span></span>
<span id="cb445-9"><a href="the-many-variables-the-spurious-waffles.html#cb445-9" aria-hidden="true" tabindex="-1"></a>                         b_D_M<span class="sc">*</span>M <span class="sc">+</span> b_A_M<span class="sc">*</span>a_sim, sigma_D)) <span class="sc">%&gt;%</span> </span>
<span id="cb445-10"><a href="the-many-variables-the-spurious-waffles.html#cb445-10" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(a_sim, M, d_sim) <span class="sc">%&gt;%</span> </span>
<span id="cb445-11"><a href="the-many-variables-the-spurious-waffles.html#cb445-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">c</span>(a_sim,d_sim)) <span class="sc">%&gt;%</span> </span>
<span id="cb445-12"><a href="the-many-variables-the-spurious-waffles.html#cb445-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(name,M) <span class="sc">%&gt;%</span> </span>
<span id="cb445-13"><a href="the-many-variables-the-spurious-waffles.html#cb445-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mean_qi</span>(value,<span class="at">.width =</span> <span class="fu">c</span>(.<span class="dv">89</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb445-14"><a href="the-many-variables-the-spurious-waffles.html#cb445-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>M,<span class="at">y=</span>value,</span>
<span id="cb445-15"><a href="the-many-variables-the-spurious-waffles.html#cb445-15" aria-hidden="true" tabindex="-1"></a>             <span class="at">ymin =</span> .lower,</span>
<span id="cb445-16"><a href="the-many-variables-the-spurious-waffles.html#cb445-16" aria-hidden="true" tabindex="-1"></a>             <span class="at">ymax =</span> .upper))<span class="sc">+</span></span>
<span id="cb445-17"><a href="the-many-variables-the-spurious-waffles.html#cb445-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>()<span class="sc">+</span></span>
<span id="cb445-18"><a href="the-many-variables-the-spurious-waffles.html#cb445-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="at">alpha=</span><span class="dv">3</span><span class="sc">/</span><span class="dv">8</span>)<span class="sc">+</span></span>
<span id="cb445-19"><a href="the-many-variables-the-spurious-waffles.html#cb445-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()<span class="sc">+</span></span>
<span id="cb445-20"><a href="the-many-variables-the-spurious-waffles.html#cb445-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">aspect.ratio =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb445-21"><a href="the-many-variables-the-spurious-waffles.html#cb445-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>name)</span></code></pre></div>
<p><img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-195-1.png" width="672" style="display: block; margin: auto;" /></p>
<p><br /></p>
</div>
<div id="h3-3" class="section level3 hasAnchor" number="5.4.6">
<h3><span class="header-section-number">5.4.6</span> 5H3<a href="the-many-variables-the-spurious-waffles.html#h3-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<blockquote>
<p>Return to the milk energy model, m5.7. Suppose that the true causal relationship among the variables is:</p>
</blockquote>
<div class="sourceCode" id="cb446"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb446-1"><a href="the-many-variables-the-spurious-waffles.html#cb446-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dagify</span>(K <span class="sc">~</span> M <span class="sc">+</span> N,</span>
<span id="cb446-2"><a href="the-many-variables-the-spurious-waffles.html#cb446-2" aria-hidden="true" tabindex="-1"></a>       N <span class="sc">~</span> M) <span class="sc">%&gt;%</span> </span>
<span id="cb446-3"><a href="the-many-variables-the-spurious-waffles.html#cb446-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggdag</span>()<span class="sc">+</span></span>
<span id="cb446-4"><a href="the-many-variables-the-spurious-waffles.html#cb446-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_dag</span>()</span></code></pre></div>
<p><img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-196-1.png" width="288" style="display: block; margin: auto;" /></p>
<blockquote>
<p>Now compute the counterfactual effect on K of doubling M. You will need to account for both the direct and indirect paths of causation. Use the counterfactual example from the chapter (starting on page 140) as a template.</p>
</blockquote>
<div class="sourceCode" id="cb447"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb447-1"><a href="the-many-variables-the-spurious-waffles.html#cb447-1" aria-hidden="true" tabindex="-1"></a>b1 <span class="ot">&lt;-</span> <span class="fu">bf</span>(N <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> M)</span>
<span id="cb447-2"><a href="the-many-variables-the-spurious-waffles.html#cb447-2" aria-hidden="true" tabindex="-1"></a>b2 <span class="ot">&lt;-</span> <span class="fu">bf</span>(K <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> M <span class="sc">+</span> N)</span>
<span id="cb447-3"><a href="the-many-variables-the-spurious-waffles.html#cb447-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb447-4"><a href="the-many-variables-the-spurious-waffles.html#cb447-4" aria-hidden="true" tabindex="-1"></a>b<span class="fl">.5</span>H3 <span class="ot">&lt;-</span> </span>
<span id="cb447-5"><a href="the-many-variables-the-spurious-waffles.html#cb447-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">brm</span>(<span class="at">formula =</span> b1 <span class="sc">+</span> b2 <span class="sc">+</span> <span class="fu">set_rescor</span>(<span class="cn">FALSE</span>),</span>
<span id="cb447-6"><a href="the-many-variables-the-spurious-waffles.html#cb447-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> d2_2,</span>
<span id="cb447-7"><a href="the-many-variables-the-spurious-waffles.html#cb447-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> gaussian,</span>
<span id="cb447-8"><a href="the-many-variables-the-spurious-waffles.html#cb447-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">0.2</span>), <span class="at">class =</span> Intercept, <span class="at">resp =</span> N),</span>
<span id="cb447-9"><a href="the-many-variables-the-spurious-waffles.html#cb447-9" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">0.2</span>), <span class="at">class =</span> Intercept, <span class="at">resp =</span> K),</span>
<span id="cb447-10"><a href="the-many-variables-the-spurious-waffles.html#cb447-10" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">0.5</span>), <span class="at">class =</span> b, <span class="at">resp =</span> N),</span>
<span id="cb447-11"><a href="the-many-variables-the-spurious-waffles.html#cb447-11" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">0.5</span>), <span class="at">class =</span> b, <span class="at">resp =</span> K),</span>
<span id="cb447-12"><a href="the-many-variables-the-spurious-waffles.html#cb447-12" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>), <span class="at">class =</span> sigma, <span class="at">resp =</span> N),</span>
<span id="cb447-13"><a href="the-many-variables-the-spurious-waffles.html#cb447-13" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>), <span class="at">class =</span> sigma, <span class="at">resp =</span> K)),</span>
<span id="cb447-14"><a href="the-many-variables-the-spurious-waffles.html#cb447-14" aria-hidden="true" tabindex="-1"></a>      <span class="at">seed =</span><span class="dv">5</span>, <span class="at">iter =</span> <span class="dv">4000</span>, <span class="at">warmup =</span> <span class="dv">2000</span>, <span class="at">chains =</span><span class="dv">4</span>,</span>
<span id="cb447-15"><a href="the-many-variables-the-spurious-waffles.html#cb447-15" aria-hidden="true" tabindex="-1"></a>      <span class="at">backend =</span> <span class="st">&quot;cmdstanr&quot;</span>,</span>
<span id="cb447-16"><a href="the-many-variables-the-spurious-waffles.html#cb447-16" aria-hidden="true" tabindex="-1"></a>      <span class="at">file =</span> <span class="st">&quot;output/Chapter5/b.5H3&quot;</span>)</span>
<span id="cb447-17"><a href="the-many-variables-the-spurious-waffles.html#cb447-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb447-18"><a href="the-many-variables-the-spurious-waffles.html#cb447-18" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(b<span class="fl">.5</span>H3)</span></code></pre></div>
<pre><code>##  Family: MV(gaussian, gaussian) 
##   Links: mu = identity; sigma = identity
##          mu = identity; sigma = identity 
## Formula: N ~ 1 + M 
##          K ~ 1 + M + N 
##    Data: d2_2 (Number of observations: 17) 
##   Draws: 4 chains, each with iter = 4000; warmup = 2000; thin = 1;
##          total post-warmup draws = 8000
## 
## Population-Level Effects: 
##             Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## N_Intercept    -0.02      0.13    -0.29     0.23 1.00    10735     5770
## K_Intercept     0.07      0.14    -0.22     0.35 1.00    11199     6075
## N_M             0.60      0.16     0.28     0.90 1.00     8398     5129
## K_M            -0.64      0.25    -1.11    -0.12 1.00     5971     5279
## K_N             0.61      0.28     0.04     1.13 1.00     5973     5529
## 
## Family Specific Parameters: 
##         Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## sigma_N     0.72      0.14     0.50     1.04 1.00     8317     5584
## sigma_K     0.87      0.18     0.60     1.28 1.00     6616     5730
## 
## Draws were sampled using sample(hmc). For each parameter, Bulk_ESS
## and Tail_ESS are effective sample size measures, and Rhat is the potential
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<div class="sourceCode" id="cb449"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb449-1"><a href="the-many-variables-the-spurious-waffles.html#cb449-1" aria-hidden="true" tabindex="-1"></a><span class="fu">pairs</span>(b<span class="fl">.5</span>H3)</span></code></pre></div>
<p><img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-197-1.png" width="672" style="display: block; margin: auto;" /></p>
<p><br /></p>
<div class="sourceCode" id="cb450"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb450-1"><a href="the-many-variables-the-spurious-waffles.html#cb450-1" aria-hidden="true" tabindex="-1"></a>seq_M <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">M =</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">80</span>,<span class="at">length.out=</span><span class="dv">200</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb450-2"><a href="the-many-variables-the-spurious-waffles.html#cb450-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">M_log =</span> <span class="fu">log</span>(M),</span>
<span id="cb450-3"><a href="the-many-variables-the-spurious-waffles.html#cb450-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">M_sim =</span> <span class="fu">standardize</span>(M_log))</span>
<span id="cb450-4"><a href="the-many-variables-the-spurious-waffles.html#cb450-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb450-5"><a href="the-many-variables-the-spurious-waffles.html#cb450-5" aria-hidden="true" tabindex="-1"></a>sim <span class="ot">&lt;-</span> </span>
<span id="cb450-6"><a href="the-many-variables-the-spurious-waffles.html#cb450-6" aria-hidden="true" tabindex="-1"></a><span class="fu">posterior_samples</span>(b<span class="fl">.5</span>H3) <span class="sc">%&gt;%</span> </span>
<span id="cb450-7"><a href="the-many-variables-the-spurious-waffles.html#cb450-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>(<span class="at">var =</span> <span class="st">&quot;iter&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb450-8"><a href="the-many-variables-the-spurious-waffles.html#cb450-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">I_N =</span> b_N_Intercept, <span class="at">I_K =</span> b_K_Intercept) <span class="sc">%&gt;%</span></span>
<span id="cb450-9"><a href="the-many-variables-the-spurious-waffles.html#cb450-9" aria-hidden="true" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">expand</span>(<span class="fu">nesting</span>(iter,I_N,I_K,b_N_M, b_K_M,</span>
<span id="cb450-10"><a href="the-many-variables-the-spurious-waffles.html#cb450-10" aria-hidden="true" tabindex="-1"></a>                 b_K_N, sigma_N, sigma_K),</span>
<span id="cb450-11"><a href="the-many-variables-the-spurious-waffles.html#cb450-11" aria-hidden="true" tabindex="-1"></a>         <span class="at">M =</span> <span class="fu">seq</span>(<span class="fl">0.5</span>,<span class="dv">80</span>,<span class="at">length.out=</span><span class="dv">200</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb450-12"><a href="the-many-variables-the-spurious-waffles.html#cb450-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">M_sim =</span> (<span class="fu">log</span>(M) <span class="sc">-</span> <span class="fu">mean</span>(<span class="fu">log</span>(d2_2<span class="sc">$</span>mass)))<span class="sc">/</span><span class="fu">sd</span>(<span class="fu">log</span>(d2_2<span class="sc">$</span>mass))) <span class="sc">%&gt;%</span> </span>
<span id="cb450-13"><a href="the-many-variables-the-spurious-waffles.html#cb450-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">sim_N =</span> <span class="fu">rnorm</span>(<span class="fu">n</span>(),<span class="at">mean =</span> I_N <span class="sc">+</span> b_N_M<span class="sc">*</span>M_sim,sigma_N),</span>
<span id="cb450-14"><a href="the-many-variables-the-spurious-waffles.html#cb450-14" aria-hidden="true" tabindex="-1"></a>         <span class="at">sim_K =</span> <span class="fu">rnorm</span>(<span class="fu">n</span>(),<span class="at">mean =</span> I_K <span class="sc">+</span> b_K_M<span class="sc">*</span>M_sim <span class="sc">+</span> b_K_N<span class="sc">*</span>sim_N,sigma_K)) </span>
<span id="cb450-15"><a href="the-many-variables-the-spurious-waffles.html#cb450-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb450-16"><a href="the-many-variables-the-spurious-waffles.html#cb450-16" aria-hidden="true" tabindex="-1"></a>sim <span class="sc">%&gt;%</span> </span>
<span id="cb450-17"><a href="the-many-variables-the-spurious-waffles.html#cb450-17" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(M, M_sim,sim_K) <span class="sc">%&gt;%</span> </span>
<span id="cb450-18"><a href="the-many-variables-the-spurious-waffles.html#cb450-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(M) <span class="sc">%&gt;%</span> </span>
<span id="cb450-19"><a href="the-many-variables-the-spurious-waffles.html#cb450-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mean_qi</span>(sim_K) <span class="sc">%&gt;%</span> </span>
<span id="cb450-20"><a href="the-many-variables-the-spurious-waffles.html#cb450-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>M, <span class="at">y =</span> sim_K, <span class="at">ymin =</span> .lower,</span>
<span id="cb450-21"><a href="the-many-variables-the-spurious-waffles.html#cb450-21" aria-hidden="true" tabindex="-1"></a>             <span class="at">ymax =</span> .upper))<span class="sc">+</span></span>
<span id="cb450-22"><a href="the-many-variables-the-spurious-waffles.html#cb450-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="at">alpha=</span><span class="dv">3</span><span class="sc">/</span><span class="dv">8</span>)<span class="sc">+</span></span>
<span id="cb450-23"><a href="the-many-variables-the-spurious-waffles.html#cb450-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">color =</span> <span class="st">&quot;black&quot;</span>)<span class="sc">+</span></span>
<span id="cb450-24"><a href="the-many-variables-the-spurious-waffles.html#cb450-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;mass&quot;</span>, <span class="at">y=</span> <span class="st">&quot;counterfactual K&quot;</span>)</span></code></pre></div>
<p><img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-198-1.png" width="672" style="display: block; margin: auto;" /></p>
<p><br /></p>
</div>
<div id="h4-3" class="section level3 hasAnchor" number="5.4.7">
<h3><span class="header-section-number">5.4.7</span> 5H4<a href="the-many-variables-the-spurious-waffles.html#h4-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<blockquote>
<p>Here is an open practice problem to engage your imagination. In the divorce data, States in the southern United States have many of the highest divorce rates. Add the South indicator variable to the analysis. First, draw one or more DAGs that represent your ideas for how Southern American culture might influence any of the other three variables (D, M, or A). Then list the testable implications of your DAGs, if there are any, and fit one or more models to evaluate the implications. What do you think the influence of “Southerness” is?</p>
</blockquote>
<p>データの分布をみてみる。南部のほうが離婚率が高い。</p>
<div class="sourceCode" id="cb451"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb451-1"><a href="the-many-variables-the-spurious-waffles.html#cb451-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;WaffleDivorce&quot;</span>)</span>
<span id="cb451-2"><a href="the-many-variables-the-spurious-waffles.html#cb451-2" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> WaffleDivorce</span>
<span id="cb451-3"><a href="the-many-variables-the-spurious-waffles.html#cb451-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb451-4"><a href="the-many-variables-the-spurious-waffles.html#cb451-4" aria-hidden="true" tabindex="-1"></a>d <span class="sc">%&gt;%</span> </span>
<span id="cb451-5"><a href="the-many-variables-the-spurious-waffles.html#cb451-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span><span class="fu">as.factor</span>(South),<span class="at">y=</span>Divorce))<span class="sc">+</span></span>
<span id="cb451-6"><a href="the-many-variables-the-spurious-waffles.html#cb451-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_violin</span>()<span class="sc">+</span></span>
<span id="cb451-7"><a href="the-many-variables-the-spurious-waffles.html#cb451-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_summary</span>(<span class="at">geom =</span> <span class="st">&quot;point&quot;</span>, <span class="at">fun =</span> <span class="st">&quot;median&quot;</span>)</span></code></pre></div>
<p><img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-199-1.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb452"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb452-1"><a href="the-many-variables-the-spurious-waffles.html#cb452-1" aria-hidden="true" tabindex="-1"></a>d <span class="sc">%&gt;%</span> </span>
<span id="cb452-2"><a href="the-many-variables-the-spurious-waffles.html#cb452-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">A =</span> MedianAgeMarriage, <span class="at">D =</span> Divorce,</span>
<span id="cb452-3"><a href="the-many-variables-the-spurious-waffles.html#cb452-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">M =</span> Marriage, <span class="at">S =</span> South) <span class="sc">%&gt;%</span> </span>
<span id="cb452-4"><a href="the-many-variables-the-spurious-waffles.html#cb452-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">M =</span> <span class="fu">standardize</span>(M), <span class="at">A =</span> <span class="fu">standardize</span>(A),</span>
<span id="cb452-5"><a href="the-many-variables-the-spurious-waffles.html#cb452-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">D =</span> <span class="fu">standardize</span>(D)) <span class="ot">-&gt;</span>d</span></code></pre></div>
<p>以下のような因果モデルを考える。</p>
<div class="sourceCode" id="cb453"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb453-1"><a href="the-many-variables-the-spurious-waffles.html#cb453-1" aria-hidden="true" tabindex="-1"></a>mad_dag <span class="ot">&lt;-</span> <span class="fu">dagitty</span>(<span class="st">&quot;dag{  M -&gt; A -&gt; D &lt;-M ;</span></span>
<span id="cb453-2"><a href="the-many-variables-the-spurious-waffles.html#cb453-2" aria-hidden="true" tabindex="-1"></a><span class="st">                          M  &lt;-  S -&gt; A}&quot;</span>)</span>
<span id="cb453-3"><a href="the-many-variables-the-spurious-waffles.html#cb453-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggdag</span>(mad_dag)<span class="sc">+</span></span>
<span id="cb453-4"><a href="the-many-variables-the-spurious-waffles.html#cb453-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_dag</span>()</span></code></pre></div>
<p><img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-201-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>モデリングを行う。</p>
<div class="sourceCode" id="cb454"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb454-1"><a href="the-many-variables-the-spurious-waffles.html#cb454-1" aria-hidden="true" tabindex="-1"></a>b1 <span class="ot">&lt;-</span> <span class="fu">bf</span>(D <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> A <span class="sc">+</span> M <span class="sc">+</span> S)</span>
<span id="cb454-2"><a href="the-many-variables-the-spurious-waffles.html#cb454-2" aria-hidden="true" tabindex="-1"></a>b2<span class="ot">&lt;-</span> <span class="fu">bf</span>(M <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> A <span class="sc">+</span> S)</span>
<span id="cb454-3"><a href="the-many-variables-the-spurious-waffles.html#cb454-3" aria-hidden="true" tabindex="-1"></a>b3 <span class="ot">&lt;-</span> <span class="fu">bf</span>(A <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> M <span class="sc">+</span> S)</span>
<span id="cb454-4"><a href="the-many-variables-the-spurious-waffles.html#cb454-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb454-5"><a href="the-many-variables-the-spurious-waffles.html#cb454-5" aria-hidden="true" tabindex="-1"></a>b<span class="fl">.5</span>H4 <span class="ot">&lt;-</span> </span>
<span id="cb454-6"><a href="the-many-variables-the-spurious-waffles.html#cb454-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">brm</span>(<span class="at">family=</span>gaussian,</span>
<span id="cb454-7"><a href="the-many-variables-the-spurious-waffles.html#cb454-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span>d,</span>
<span id="cb454-8"><a href="the-many-variables-the-spurious-waffles.html#cb454-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">formula =</span> b1 <span class="sc">+</span> b2 <span class="sc">+</span> b3 <span class="sc">+</span> <span class="fu">set_rescor</span>(<span class="cn">FALSE</span>),</span>
<span id="cb454-9"><a href="the-many-variables-the-spurious-waffles.html#cb454-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>,<span class="fl">0.2</span>),<span class="at">class=</span>Intercept,</span>
<span id="cb454-10"><a href="the-many-variables-the-spurious-waffles.html#cb454-10" aria-hidden="true" tabindex="-1"></a>                      <span class="at">resp =</span> D),</span>
<span id="cb454-11"><a href="the-many-variables-the-spurious-waffles.html#cb454-11" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>,<span class="fl">0.5</span>),<span class="at">class=</span>b,</span>
<span id="cb454-12"><a href="the-many-variables-the-spurious-waffles.html#cb454-12" aria-hidden="true" tabindex="-1"></a>                      <span class="at">resp =</span> D),</span>
<span id="cb454-13"><a href="the-many-variables-the-spurious-waffles.html#cb454-13" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>),<span class="at">class=</span>sigma,</span>
<span id="cb454-14"><a href="the-many-variables-the-spurious-waffles.html#cb454-14" aria-hidden="true" tabindex="-1"></a>                      <span class="at">resp =</span> D),</span>
<span id="cb454-15"><a href="the-many-variables-the-spurious-waffles.html#cb454-15" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>,<span class="fl">0.2</span>),<span class="at">class=</span>Intercept,</span>
<span id="cb454-16"><a href="the-many-variables-the-spurious-waffles.html#cb454-16" aria-hidden="true" tabindex="-1"></a>                      <span class="at">resp =</span> M),</span>
<span id="cb454-17"><a href="the-many-variables-the-spurious-waffles.html#cb454-17" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>,<span class="fl">0.5</span>),<span class="at">class=</span>b,</span>
<span id="cb454-18"><a href="the-many-variables-the-spurious-waffles.html#cb454-18" aria-hidden="true" tabindex="-1"></a>                      <span class="at">resp =</span> M),</span>
<span id="cb454-19"><a href="the-many-variables-the-spurious-waffles.html#cb454-19" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>),<span class="at">class=</span>sigma,</span>
<span id="cb454-20"><a href="the-many-variables-the-spurious-waffles.html#cb454-20" aria-hidden="true" tabindex="-1"></a>                      <span class="at">resp =</span> M),</span>
<span id="cb454-21"><a href="the-many-variables-the-spurious-waffles.html#cb454-21" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>,<span class="fl">0.2</span>),<span class="at">class=</span>Intercept,</span>
<span id="cb454-22"><a href="the-many-variables-the-spurious-waffles.html#cb454-22" aria-hidden="true" tabindex="-1"></a>                      <span class="at">resp =</span> A),</span>
<span id="cb454-23"><a href="the-many-variables-the-spurious-waffles.html#cb454-23" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>,<span class="fl">0.5</span>),<span class="at">class=</span>b,</span>
<span id="cb454-24"><a href="the-many-variables-the-spurious-waffles.html#cb454-24" aria-hidden="true" tabindex="-1"></a>                      <span class="at">resp =</span> A),</span>
<span id="cb454-25"><a href="the-many-variables-the-spurious-waffles.html#cb454-25" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>),<span class="at">class=</span>sigma,</span>
<span id="cb454-26"><a href="the-many-variables-the-spurious-waffles.html#cb454-26" aria-hidden="true" tabindex="-1"></a>                      <span class="at">resp =</span> A)),</span>
<span id="cb454-27"><a href="the-many-variables-the-spurious-waffles.html#cb454-27" aria-hidden="true" tabindex="-1"></a>      <span class="at">seed =</span> <span class="dv">123</span>, <span class="at">iter=</span><span class="dv">4000</span>,<span class="at">warmup=</span><span class="dv">2000</span>,<span class="at">chains=</span><span class="dv">4</span>,</span>
<span id="cb454-28"><a href="the-many-variables-the-spurious-waffles.html#cb454-28" aria-hidden="true" tabindex="-1"></a>      <span class="at">backend =</span> <span class="st">&quot;cmdstanr&quot;</span>,</span>
<span id="cb454-29"><a href="the-many-variables-the-spurious-waffles.html#cb454-29" aria-hidden="true" tabindex="-1"></a>      <span class="at">file =</span> <span class="st">&quot;output/Chapter5/b.5H4&quot;</span>)</span>
<span id="cb454-30"><a href="the-many-variables-the-spurious-waffles.html#cb454-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb454-31"><a href="the-many-variables-the-spurious-waffles.html#cb454-31" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(b<span class="fl">.5</span>H4)</span></code></pre></div>
<pre><code>##  Family: MV(gaussian, gaussian, gaussian) 
##   Links: mu = identity; sigma = identity
##          mu = identity; sigma = identity
##          mu = identity; sigma = identity 
## Formula: D ~ 1 + A + M + S 
##          M ~ 1 + A + S 
##          A ~ 1 + M + S 
##    Data: d (Number of observations: 50) 
##   Draws: 4 chains, each with iter = 4000; warmup = 2000; thin = 1;
##          total post-warmup draws = 8000
## 
## Population-Level Effects: 
##             Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## D_Intercept    -0.10      0.12    -0.33     0.13 1.00    12250     5790
## M_Intercept     0.05      0.11    -0.17     0.26 1.00    13042     5840
## A_Intercept     0.10      0.10    -0.10     0.30 1.00    11197     5669
## D_A            -0.56      0.16    -0.86    -0.24 1.00     6887     6388
## D_M            -0.04      0.15    -0.35     0.26 1.00     6858     6283
## D_S             0.37      0.24    -0.11     0.82 1.00    11215     5985
## M_A            -0.71      0.10    -0.91    -0.50 1.00    11273     6246
## M_S            -0.17      0.21    -0.58     0.25 1.00    12003     6100
## A_M            -0.68      0.10    -0.88    -0.48 1.00    11990     6153
## A_S            -0.36      0.20    -0.75     0.03 1.00    11809     6006
## 
## Family Specific Parameters: 
##         Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## sigma_D     0.81      0.09     0.66     1.00 1.00    11478     6089
## sigma_M     0.71      0.08     0.58     0.88 1.00    11514     6271
## sigma_A     0.69      0.07     0.57     0.85 1.00    11642     6268
## 
## Draws were sampled using sample(hmc). For each parameter, Bulk_ESS
## and Tail_ESS are effective sample size measures, and Rhat is the potential
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<div class="sourceCode" id="cb456"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb456-1"><a href="the-many-variables-the-spurious-waffles.html#cb456-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(bayesplot)</span>
<span id="cb456-2"><a href="the-many-variables-the-spurious-waffles.html#cb456-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb456-3"><a href="the-many-variables-the-spurious-waffles.html#cb456-3" aria-hidden="true" tabindex="-1"></a><span class="fu">posterior_samples</span>(b<span class="fl">.5</span>H4) <span class="sc">%&gt;%</span> </span>
<span id="cb456-4"><a href="the-many-variables-the-spurious-waffles.html#cb456-4" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>lp__) <span class="sc">%&gt;%</span> </span>
<span id="cb456-5"><a href="the-many-variables-the-spurious-waffles.html#cb456-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mcmc_intervals</span>()</span></code></pre></div>
<p><img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-203-1.png" width="672" style="display: block; margin: auto;" /></p>
<p><code>L</code>も含むモデルを考える。</p>
<div class="sourceCode" id="cb457"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb457-1"><a href="the-many-variables-the-spurious-waffles.html#cb457-1" aria-hidden="true" tabindex="-1"></a>b<span class="fl">.5</span>H4_2 <span class="ot">&lt;-</span> </span>
<span id="cb457-2"><a href="the-many-variables-the-spurious-waffles.html#cb457-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">brm</span>(<span class="at">data =</span> d4,</span>
<span id="cb457-3"><a href="the-many-variables-the-spurious-waffles.html#cb457-3" aria-hidden="true" tabindex="-1"></a>            <span class="at">family =</span> gaussian,</span>
<span id="cb457-4"><a href="the-many-variables-the-spurious-waffles.html#cb457-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">formula =</span> D <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> A <span class="sc">+</span> L <span class="sc">+</span> S <span class="sc">+</span> M,</span>
<span id="cb457-5"><a href="the-many-variables-the-spurious-waffles.html#cb457-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">prior=</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>,<span class="fl">0.2</span>),<span class="at">class=</span>Intercept),</span>
<span id="cb457-6"><a href="the-many-variables-the-spurious-waffles.html#cb457-6" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>,<span class="fl">0.5</span>),<span class="at">class=</span>b),</span>
<span id="cb457-7"><a href="the-many-variables-the-spurious-waffles.html#cb457-7" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>),<span class="at">class=</span>sigma)),</span>
<span id="cb457-8"><a href="the-many-variables-the-spurious-waffles.html#cb457-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">seed =</span> <span class="dv">5</span>, <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>,</span>
<span id="cb457-9"><a href="the-many-variables-the-spurious-waffles.html#cb457-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">chains =</span> <span class="dv">4</span>,</span>
<span id="cb457-10"><a href="the-many-variables-the-spurious-waffles.html#cb457-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">backend =</span> <span class="st">&quot;cmdstanr&quot;</span>,</span>
<span id="cb457-11"><a href="the-many-variables-the-spurious-waffles.html#cb457-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">file =</span> <span class="st">&quot;output/Chapter5/b.5H4_2&quot;</span>)</span>
<span id="cb457-12"><a href="the-many-variables-the-spurious-waffles.html#cb457-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb457-13"><a href="the-many-variables-the-spurious-waffles.html#cb457-13" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(b<span class="fl">.5</span>H4_2)</span></code></pre></div>
<pre><code>##  Family: gaussian 
##   Links: mu = identity; sigma = identity 
## Formula: D ~ 1 + A + L + S + M 
##    Data: d4 (Number of observations: 50) 
##   Draws: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
##          total post-warmup draws = 4000
## 
## Population-Level Effects: 
##           Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## Intercept    -0.07      0.12    -0.31     0.18 1.00     3294     2797
## A            -0.64      0.17    -0.97    -0.31 1.00     2929     2670
## L            -0.23      0.17    -0.56     0.11 1.00     2852     2822
## S             0.24      0.26    -0.25     0.75 1.00     3048     2947
## M             0.07      0.17    -0.28     0.39 1.00     3055     2751
## 
## Family Specific Parameters: 
##       Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## sigma     0.80      0.08     0.66     0.98 1.00     3035     2621
## 
## Draws were sampled using sample(hmc). For each parameter, Bulk_ESS
## and Tail_ESS are effective sample size measures, and Rhat is the potential
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="geocentric-model.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="the-haunted-dag-the-causal-terror.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
