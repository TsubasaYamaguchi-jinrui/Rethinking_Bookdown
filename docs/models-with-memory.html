<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>13 Models with Memory | Statistical Rethinking Second Edition</title>
  <meta name="description" content="13 Models with Memory | Statistical Rethinking Second Edition" />
  <meta name="generator" content="bookdown 0.31 and GitBook 2.6.7" />

  <meta property="og:title" content="13 Models with Memory | Statistical Rethinking Second Edition" />
  <meta property="og:type" content="book" />
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="13 Models with Memory | Statistical Rethinking Second Edition" />
  
  
  

<meta name="author" content="Tsubasa Yamaguchi" />


<meta name="date" content="2023-02-01" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="monsters-and-mixtures.html"/>
<link rel="next" href="adventures-in-covariance.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<script src="libs/htmlwidgets-1.6.1/htmlwidgets.js"></script>
<link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet" />
<script src="libs/datatables-binding-0.27/datatables.js"></script>
<link href="libs/dt-core-1.12.1/css/jquery.dataTables.min.css" rel="stylesheet" />
<link href="libs/dt-core-1.12.1/css/jquery.dataTables.extra.css" rel="stylesheet" />
<script src="libs/dt-core-1.12.1/js/jquery.dataTables.min.js"></script>
<link href="libs/crosstalk-1.2.0/css/crosstalk.min.css" rel="stylesheet" />
<script src="libs/crosstalk-1.2.0/js/crosstalk.min.js"></script>
<link href="libs/tabwid-1.1.2/tabwid.css" rel="stylesheet" />
<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="custom_style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>本稿の目的</a></li>
<li class="chapter" data-level="" data-path="パッケージの読み込み.html"><a href="パッケージの読み込み.html"><i class="fa fa-check"></i>パッケージの読み込み</a></li>
<li class="chapter" data-level="1" data-path="the-golem-of-prague.html"><a href="the-golem-of-prague.html"><i class="fa fa-check"></i><b>1</b> The Golem of Prague 　</a></li>
<li class="chapter" data-level="2" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html"><i class="fa fa-check"></i><b>2</b> Small Worlds and Large Worlds</a>
<ul>
<li class="chapter" data-level="2.1" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#byesian-updating"><i class="fa fa-check"></i><b>2.1</b> Byesian Updating</a></li>
<li class="chapter" data-level="2.2" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#making-th-model"><i class="fa fa-check"></i><b>2.2</b> Making th model</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#grid-approximation"><i class="fa fa-check"></i><b>2.2.1</b> Grid approximation</a></li>
<li class="chapter" data-level="2.2.2" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#quadratic-approximation"><i class="fa fa-check"></i><b>2.2.2</b> Quadratic approximation</a></li>
<li class="chapter" data-level="2.2.3" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#mcmc"><i class="fa fa-check"></i><b>2.2.3</b> MCMC</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#practice"><i class="fa fa-check"></i><b>2.3</b> Practice</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#m1"><i class="fa fa-check"></i><b>2.3.1</b> 2M1</a></li>
<li class="chapter" data-level="2.3.2" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#m2"><i class="fa fa-check"></i><b>2.3.2</b> 2M2</a></li>
<li class="chapter" data-level="2.3.3" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#m3"><i class="fa fa-check"></i><b>2.3.3</b> 2M3</a></li>
<li class="chapter" data-level="2.3.4" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#m4"><i class="fa fa-check"></i><b>2.3.4</b> 2M4</a></li>
<li class="chapter" data-level="2.3.5" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#m5"><i class="fa fa-check"></i><b>2.3.5</b> 2M5</a></li>
<li class="chapter" data-level="2.3.6" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#m7"><i class="fa fa-check"></i><b>2.3.6</b> 2M7</a></li>
<li class="chapter" data-level="2.3.7" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#h1"><i class="fa fa-check"></i><b>2.3.7</b> 2H1</a></li>
<li class="chapter" data-level="2.3.8" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#h2"><i class="fa fa-check"></i><b>2.3.8</b> 2H2</a></li>
<li class="chapter" data-level="2.3.9" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#h3"><i class="fa fa-check"></i><b>2.3.9</b> 2H3</a></li>
<li class="chapter" data-level="2.3.10" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#h4"><i class="fa fa-check"></i><b>2.3.10</b> 2H4</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html"><i class="fa fa-check"></i><b>3</b> Sampling the Imaginary</a>
<ul>
<li class="chapter" data-level="3.1" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#sampling-from-a-grid-aproximate-posterior"><i class="fa fa-check"></i><b>3.1</b> Sampling from a grid-aproximate posterior</a></li>
<li class="chapter" data-level="3.2" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#sampling-to-summarize"><i class="fa fa-check"></i><b>3.2</b> Sampling to summarize</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#intervals-of-defined-mass"><i class="fa fa-check"></i><b>3.2.1</b> Intervals of defined mass</a></li>
<li class="chapter" data-level="3.2.2" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#highly-skewed-example"><i class="fa fa-check"></i><b>3.2.2</b> highly skewed example</a></li>
<li class="chapter" data-level="3.2.3" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#point-estimate"><i class="fa fa-check"></i><b>3.2.3</b> Point estimate　　</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#sampling-to-simulate-prediction"><i class="fa fa-check"></i><b>3.3</b> Sampling to simulate prediction</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#model-checking"><i class="fa fa-check"></i><b>3.3.1</b> Model checking</a></li>
<li class="chapter" data-level="3.3.2" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#practice-with-brms"><i class="fa fa-check"></i><b>3.3.2</b> Practice with brms</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#practice-1"><i class="fa fa-check"></i><b>3.4</b> Practice</a>
<ul>
<li class="chapter" data-level="3.4.1" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#e"><i class="fa fa-check"></i><b>3.4.1</b> 3E</a></li>
<li class="chapter" data-level="3.4.2" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#m"><i class="fa fa-check"></i><b>3.4.2</b> 3M</a></li>
<li class="chapter" data-level="3.4.3" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#h"><i class="fa fa-check"></i><b>3.4.3</b> 3H</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="geocentric-model.html"><a href="geocentric-model.html"><i class="fa fa-check"></i><b>4</b> Geocentric Model</a>
<ul>
<li class="chapter" data-level="4.1" data-path="geocentric-model.html"><a href="geocentric-model.html#why-normal-distributions-are-normal"><i class="fa fa-check"></i><b>4.1</b> Why normal distributions are normal</a></li>
<li class="chapter" data-level="4.2" data-path="geocentric-model.html"><a href="geocentric-model.html#normal-by-multiplication"><i class="fa fa-check"></i><b>4.2</b> Normal by multiplication</a></li>
<li class="chapter" data-level="4.3" data-path="geocentric-model.html"><a href="geocentric-model.html#gaussian-model-of-height"><i class="fa fa-check"></i><b>4.3</b> Gaussian model of height</a></li>
<li class="chapter" data-level="4.4" data-path="geocentric-model.html"><a href="geocentric-model.html#grid-approximationで事後分布を描く"><i class="fa fa-check"></i><b>4.4</b> Grid approximationで事後分布を描く</a>
<ul>
<li class="chapter" data-level="4.4.1" data-path="geocentric-model.html"><a href="geocentric-model.html#事後分布からサンプリングする"><i class="fa fa-check"></i><b>4.4.1</b> 事後分布からサンプリングする</a></li>
<li class="chapter" data-level="4.4.2" data-path="geocentric-model.html"><a href="geocentric-model.html#rethinking"><i class="fa fa-check"></i><b>4.4.2</b> rethinking</a></li>
<li class="chapter" data-level="4.4.3" data-path="geocentric-model.html"><a href="geocentric-model.html#finding-posterior-with-brms"><i class="fa fa-check"></i><b>4.4.3</b> Finding posterior with brms</a></li>
<li class="chapter" data-level="4.4.4" data-path="geocentric-model.html"><a href="geocentric-model.html#事後分布からのサンプリング"><i class="fa fa-check"></i><b>4.4.4</b> 事後分布からのサンプリング</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="geocentric-model.html"><a href="geocentric-model.html#linear-prediction"><i class="fa fa-check"></i><b>4.5</b> Linear prediction</a>
<ul>
<li class="chapter" data-level="4.5.1" data-path="geocentric-model.html"><a href="geocentric-model.html#finding-the-posterior-distribution"><i class="fa fa-check"></i><b>4.5.1</b> Finding the posterior distribution</a></li>
<li class="chapter" data-level="4.5.2" data-path="geocentric-model.html"><a href="geocentric-model.html#plotting-posterior-inference-agaist-the-data"><i class="fa fa-check"></i><b>4.5.2</b> Plotting posterior inference agaist the data</a></li>
<li class="chapter" data-level="4.5.3" data-path="geocentric-model.html"><a href="geocentric-model.html#plotting-regression-intervals-and-contours"><i class="fa fa-check"></i><b>4.5.3</b> Plotting regression intervals and contours</a></li>
<li class="chapter" data-level="4.5.4" data-path="geocentric-model.html"><a href="geocentric-model.html#prediction-intervals"><i class="fa fa-check"></i><b>4.5.4</b> Prediction intervals</a></li>
</ul></li>
<li class="chapter" data-level="4.6" data-path="geocentric-model.html"><a href="geocentric-model.html#curves-from-lines"><i class="fa fa-check"></i><b>4.6</b> Curves from lines</a>
<ul>
<li class="chapter" data-level="4.6.1" data-path="geocentric-model.html"><a href="geocentric-model.html#polynomial-regression"><i class="fa fa-check"></i><b>4.6.1</b> Polynomial regression</a></li>
<li class="chapter" data-level="4.6.2" data-path="geocentric-model.html"><a href="geocentric-model.html#overthinking"><i class="fa fa-check"></i><b>4.6.2</b> overthinking</a></li>
<li class="chapter" data-level="4.6.3" data-path="geocentric-model.html"><a href="geocentric-model.html#splines"><i class="fa fa-check"></i><b>4.6.3</b> Splines</a></li>
</ul></li>
<li class="chapter" data-level="4.7" data-path="geocentric-model.html"><a href="geocentric-model.html#practice-2"><i class="fa fa-check"></i><b>4.7</b> Practice</a>
<ul>
<li class="chapter" data-level="4.7.1" data-path="geocentric-model.html"><a href="geocentric-model.html#m1-2"><i class="fa fa-check"></i><b>4.7.1</b> 4M1</a></li>
<li class="chapter" data-level="4.7.2" data-path="geocentric-model.html"><a href="geocentric-model.html#m2-2"><i class="fa fa-check"></i><b>4.7.2</b> 4M2</a></li>
<li class="chapter" data-level="4.7.3" data-path="geocentric-model.html"><a href="geocentric-model.html#m4-2"><i class="fa fa-check"></i><b>4.7.3</b> 4M4</a></li>
<li class="chapter" data-level="4.7.4" data-path="geocentric-model.html"><a href="geocentric-model.html#m5-2"><i class="fa fa-check"></i><b>4.7.4</b> 4M5</a></li>
<li class="chapter" data-level="4.7.5" data-path="geocentric-model.html"><a href="geocentric-model.html#m6-1"><i class="fa fa-check"></i><b>4.7.5</b> 4M6</a></li>
<li class="chapter" data-level="4.7.6" data-path="geocentric-model.html"><a href="geocentric-model.html#m7-1"><i class="fa fa-check"></i><b>4.7.6</b> 4M7</a></li>
<li class="chapter" data-level="4.7.7" data-path="geocentric-model.html"><a href="geocentric-model.html#m8"><i class="fa fa-check"></i><b>4.7.7</b> 4M8</a></li>
<li class="chapter" data-level="4.7.8" data-path="geocentric-model.html"><a href="geocentric-model.html#h1-2"><i class="fa fa-check"></i><b>4.7.8</b> 4H1</a></li>
<li class="chapter" data-level="4.7.9" data-path="geocentric-model.html"><a href="geocentric-model.html#h2-2"><i class="fa fa-check"></i><b>4.7.9</b> 4H2</a></li>
<li class="chapter" data-level="4.7.10" data-path="geocentric-model.html"><a href="geocentric-model.html#h3-2"><i class="fa fa-check"></i><b>4.7.10</b> 4H3</a></li>
<li class="chapter" data-level="4.7.11" data-path="geocentric-model.html"><a href="geocentric-model.html#h4-2"><i class="fa fa-check"></i><b>4.7.11</b> 4H4</a></li>
<li class="chapter" data-level="4.7.12" data-path="geocentric-model.html"><a href="geocentric-model.html#h5-1"><i class="fa fa-check"></i><b>4.7.12</b> 4H5</a></li>
<li class="chapter" data-level="4.7.13" data-path="geocentric-model.html"><a href="geocentric-model.html#h6"><i class="fa fa-check"></i><b>4.7.13</b> 4H6</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html"><i class="fa fa-check"></i><b>5</b> The many variables &amp; the spurious waffles</a>
<ul>
<li class="chapter" data-level="5.1" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#spurious-association"><i class="fa fa-check"></i><b>5.1</b> Spurious association</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#グラフを用いて因果モデルを考える"><i class="fa fa-check"></i><b>5.1.1</b> グラフを用いて因果モデルを考える</a></li>
<li class="chapter" data-level="5.1.2" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#predictor-residual-plots"><i class="fa fa-check"></i><b>5.1.2</b> Predictor residual plots</a></li>
<li class="chapter" data-level="5.1.3" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#posterior-prediction-plots"><i class="fa fa-check"></i><b>5.1.3</b> Posterior prediction plots</a></li>
<li class="chapter" data-level="5.1.4" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#counterfactual-plot"><i class="fa fa-check"></i><b>5.1.4</b> Counterfactual plot</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#masked-relationship"><i class="fa fa-check"></i><b>5.2</b> Masked relationship</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#k-nモデル"><i class="fa fa-check"></i><b>5.2.1</b> K ~ Nモデル</a></li>
<li class="chapter" data-level="5.2.2" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#k-mモデル"><i class="fa fa-check"></i><b>5.2.2</b> K ~ Mモデル</a></li>
<li class="chapter" data-level="5.2.3" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#k-n-mモデル"><i class="fa fa-check"></i><b>5.2.3</b> K ~ N + Mモデル</a></li>
<li class="chapter" data-level="5.2.4" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#counterfactual-plot-を描く"><i class="fa fa-check"></i><b>5.2.4</b> Counterfactual plot を描く</a></li>
<li class="chapter" data-level="5.2.5" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#overthinking-1"><i class="fa fa-check"></i><b>5.2.5</b> Overthinking</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#categorical-variables"><i class="fa fa-check"></i><b>5.3</b> Categorical variables</a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#two-categories"><i class="fa fa-check"></i><b>5.3.1</b> Two categories</a></li>
<li class="chapter" data-level="5.3.2" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#many-categories"><i class="fa fa-check"></i><b>5.3.2</b> Many Categories</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#practice-3"><i class="fa fa-check"></i><b>5.4</b> Practice</a>
<ul>
<li class="chapter" data-level="5.4.1" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#m1-3"><i class="fa fa-check"></i><b>5.4.1</b> 5M1</a></li>
<li class="chapter" data-level="5.4.2" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#m2-3"><i class="fa fa-check"></i><b>5.4.2</b> 5M2</a></li>
<li class="chapter" data-level="5.4.3" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#m4-3"><i class="fa fa-check"></i><b>5.4.3</b> 5M4</a></li>
<li class="chapter" data-level="5.4.4" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#h1-3"><i class="fa fa-check"></i><b>5.4.4</b> 5H1</a></li>
<li class="chapter" data-level="5.4.5" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#h2-3"><i class="fa fa-check"></i><b>5.4.5</b> 5H2</a></li>
<li class="chapter" data-level="5.4.6" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#h3-3"><i class="fa fa-check"></i><b>5.4.6</b> 5H3</a></li>
<li class="chapter" data-level="5.4.7" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#h4-3"><i class="fa fa-check"></i><b>5.4.7</b> 5H4</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html"><i class="fa fa-check"></i><b>6</b> The Haunted DAG &amp; the Causal Terror</a>
<ul>
<li class="chapter" data-level="6.1" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#multicollinearity"><i class="fa fa-check"></i><b>6.1</b> Multicollinearity</a>
<ul>
<li class="chapter" data-level="6.1.1" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#multicollinear-milk"><i class="fa fa-check"></i><b>6.1.1</b> Multicollinear milk</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#post-treatment-bias"><i class="fa fa-check"></i><b>6.2</b> Post-treatment bias</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#blocked-by-consequence"><i class="fa fa-check"></i><b>6.2.1</b> Blocked by consequence</a></li>
<li class="chapter" data-level="6.2.2" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#fungus-and-d-separation"><i class="fa fa-check"></i><b>6.2.2</b> Fungus and d-separation</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#collider-bias"><i class="fa fa-check"></i><b>6.3</b> Collider bias</a>
<ul>
<li class="chapter" data-level="6.3.1" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#collider-of-false-sorrow"><i class="fa fa-check"></i><b>6.3.1</b> Collider of false sorrow</a></li>
<li class="chapter" data-level="6.3.2" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#the-haunted-dag"><i class="fa fa-check"></i><b>6.3.2</b> The haunted DAG</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#confronting-confoundings"><i class="fa fa-check"></i><b>6.4</b> Confronting confoundings</a>
<ul>
<li class="chapter" data-level="6.4.1" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#two-roads"><i class="fa fa-check"></i><b>6.4.1</b> Two roads</a></li>
<li class="chapter" data-level="6.4.2" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#backdoor-waffles"><i class="fa fa-check"></i><b>6.4.2</b> Backdoor Waffles</a></li>
</ul></li>
<li class="chapter" data-level="6.5" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#practice-4"><i class="fa fa-check"></i><b>6.5</b> Practice</a>
<ul>
<li class="chapter" data-level="6.5.1" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#m1-4"><i class="fa fa-check"></i><b>6.5.1</b> 6M1</a></li>
<li class="chapter" data-level="6.5.2" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#m2-4"><i class="fa fa-check"></i><b>6.5.2</b> 6M2</a></li>
<li class="chapter" data-level="6.5.3" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#h1-4"><i class="fa fa-check"></i><b>6.5.3</b> 6H1</a></li>
<li class="chapter" data-level="6.5.4" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#h2-4"><i class="fa fa-check"></i><b>6.5.4</b> 6H2</a></li>
<li class="chapter" data-level="6.5.5" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#h3-4"><i class="fa fa-check"></i><b>6.5.5</b> 6H3</a></li>
<li class="chapter" data-level="6.5.6" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#h4-4"><i class="fa fa-check"></i><b>6.5.6</b> 6H4</a></li>
<li class="chapter" data-level="6.5.7" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#h5-2"><i class="fa fa-check"></i><b>6.5.7</b> 6H5</a></li>
</ul></li>
<li class="chapter" data-level="6.6" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#おまけ-ランダム効果を入れてみる"><i class="fa fa-check"></i><b>6.6</b> おまけ　ランダム効果を入れてみる</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="ulysses-compass.html"><a href="ulysses-compass.html"><i class="fa fa-check"></i><b>7</b> Ulysses’ Compass</a>
<ul>
<li class="chapter" data-level="7.1" data-path="ulysses-compass.html"><a href="ulysses-compass.html#the-problems-with-parameters"><i class="fa fa-check"></i><b>7.1</b> The problems with parameters</a>
<ul>
<li class="chapter" data-level="7.1.1" data-path="ulysses-compass.html"><a href="ulysses-compass.html#more-parameters-always-improve-fit"><i class="fa fa-check"></i><b>7.1.1</b> More parameters always improve fit</a></li>
<li class="chapter" data-level="7.1.2" data-path="ulysses-compass.html"><a href="ulysses-compass.html#too-few-parameters-hurts-too"><i class="fa fa-check"></i><b>7.1.2</b> Too few parameters hurts too</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="ulysses-compass.html"><a href="ulysses-compass.html#entropy-and-accuracy"><i class="fa fa-check"></i><b>7.2</b> Entropy and accuracy</a>
<ul>
<li class="chapter" data-level="7.2.1" data-path="ulysses-compass.html"><a href="ulysses-compass.html#information-and-uncertainty"><i class="fa fa-check"></i><b>7.2.1</b> Information and uncertainty</a></li>
<li class="chapter" data-level="7.2.2" data-path="ulysses-compass.html"><a href="ulysses-compass.html#from-entropy-to-acculacy"><i class="fa fa-check"></i><b>7.2.2</b> From entropy to acculacy</a></li>
<li class="chapter" data-level="7.2.3" data-path="ulysses-compass.html"><a href="ulysses-compass.html#estimating-divergence"><i class="fa fa-check"></i><b>7.2.3</b> Estimating divergence</a></li>
<li class="chapter" data-level="7.2.4" data-path="ulysses-compass.html"><a href="ulysses-compass.html#scoring-the-right-data"><i class="fa fa-check"></i><b>7.2.4</b> Scoring the right data</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="ulysses-compass.html"><a href="ulysses-compass.html#golem-taming-regularization"><i class="fa fa-check"></i><b>7.3</b> Golem taming: regularization</a></li>
<li class="chapter" data-level="7.4" data-path="ulysses-compass.html"><a href="ulysses-compass.html#predicting-predictive-accuracy"><i class="fa fa-check"></i><b>7.4</b> Predicting predictive accuracy</a>
<ul>
<li class="chapter" data-level="7.4.1" data-path="ulysses-compass.html"><a href="ulysses-compass.html#cross-validation"><i class="fa fa-check"></i><b>7.4.1</b> Cross validation</a></li>
<li class="chapter" data-level="7.4.2" data-path="ulysses-compass.html"><a href="ulysses-compass.html#information-criteria"><i class="fa fa-check"></i><b>7.4.2</b> Information criteria</a></li>
<li class="chapter" data-level="7.4.3" data-path="ulysses-compass.html"><a href="ulysses-compass.html#overthinking-waic-calculation"><i class="fa fa-check"></i><b>7.4.3</b> overthinking: WAIC calculation</a></li>
<li class="chapter" data-level="7.4.4" data-path="ulysses-compass.html"><a href="ulysses-compass.html#comparing-cv-psis-and-waic"><i class="fa fa-check"></i><b>7.4.4</b> Comparing CV, PSIS, and WAIC</a></li>
</ul></li>
<li class="chapter" data-level="7.5" data-path="ulysses-compass.html"><a href="ulysses-compass.html#model-comparison"><i class="fa fa-check"></i><b>7.5</b> Model comparison</a>
<ul>
<li class="chapter" data-level="7.5.1" data-path="ulysses-compass.html"><a href="ulysses-compass.html#model-mis-selection"><i class="fa fa-check"></i><b>7.5.1</b> Model mis-selection</a></li>
<li class="chapter" data-level="7.5.2" data-path="ulysses-compass.html"><a href="ulysses-compass.html#outlier-and-other-illusions"><i class="fa fa-check"></i><b>7.5.2</b> Outlier and other illusions</a></li>
</ul></li>
<li class="chapter" data-level="7.6" data-path="ulysses-compass.html"><a href="ulysses-compass.html#practice-5"><i class="fa fa-check"></i><b>7.6</b> Practice</a>
<ul>
<li class="chapter" data-level="7.6.1" data-path="ulysses-compass.html"><a href="ulysses-compass.html#e2"><i class="fa fa-check"></i><b>7.6.1</b> 7E2</a></li>
<li class="chapter" data-level="7.6.2" data-path="ulysses-compass.html"><a href="ulysses-compass.html#e3"><i class="fa fa-check"></i><b>7.6.2</b> 7E3</a></li>
<li class="chapter" data-level="7.6.3" data-path="ulysses-compass.html"><a href="ulysses-compass.html#e4"><i class="fa fa-check"></i><b>7.6.3</b> 7E4</a></li>
<li class="chapter" data-level="7.6.4" data-path="ulysses-compass.html"><a href="ulysses-compass.html#m4-4"><i class="fa fa-check"></i><b>7.6.4</b> 7M4</a></li>
<li class="chapter" data-level="7.6.5" data-path="ulysses-compass.html"><a href="ulysses-compass.html#h1-5"><i class="fa fa-check"></i><b>7.6.5</b> 7H1</a></li>
<li class="chapter" data-level="7.6.6" data-path="ulysses-compass.html"><a href="ulysses-compass.html#h2-5"><i class="fa fa-check"></i><b>7.6.6</b> 7H2</a></li>
<li class="chapter" data-level="7.6.7" data-path="ulysses-compass.html"><a href="ulysses-compass.html#h3-5"><i class="fa fa-check"></i><b>7.6.7</b> 7H3</a></li>
<li class="chapter" data-level="7.6.8" data-path="ulysses-compass.html"><a href="ulysses-compass.html#h4-5"><i class="fa fa-check"></i><b>7.6.8</b> 7H4</a></li>
<li class="chapter" data-level="7.6.9" data-path="ulysses-compass.html"><a href="ulysses-compass.html#h5-3"><i class="fa fa-check"></i><b>7.6.9</b> 7H5</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="conditional-manatees.html"><a href="conditional-manatees.html"><i class="fa fa-check"></i><b>8</b> Conditional Manatees</a>
<ul>
<li class="chapter" data-level="8.1" data-path="conditional-manatees.html"><a href="conditional-manatees.html#building-an-interaction"><i class="fa fa-check"></i><b>8.1</b> Building an interaction</a>
<ul>
<li class="chapter" data-level="8.1.1" data-path="conditional-manatees.html"><a href="conditional-manatees.html#making-a-rugged-model"><i class="fa fa-check"></i><b>8.1.1</b> Making a rugged model</a></li>
<li class="chapter" data-level="8.1.2" data-path="conditional-manatees.html"><a href="conditional-manatees.html#adding-an-indicator-variable-isnt-enough"><i class="fa fa-check"></i><b>8.1.2</b> Adding an indicator variable isn’t enough</a></li>
<li class="chapter" data-level="8.1.3" data-path="conditional-manatees.html"><a href="conditional-manatees.html#adding-interaction-does-work"><i class="fa fa-check"></i><b>8.1.3</b> Adding interaction does work</a></li>
<li class="chapter" data-level="8.1.4" data-path="conditional-manatees.html"><a href="conditional-manatees.html#plotting-the-interaction"><i class="fa fa-check"></i><b>8.1.4</b> Plotting the interaction</a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="conditional-manatees.html"><a href="conditional-manatees.html#symmetry-of-interaction"><i class="fa fa-check"></i><b>8.2</b> Symmetry of interaction</a></li>
<li class="chapter" data-level="8.3" data-path="conditional-manatees.html"><a href="conditional-manatees.html#continuous-interaction"><i class="fa fa-check"></i><b>8.3</b> Continuous interaction</a>
<ul>
<li class="chapter" data-level="8.3.1" data-path="conditional-manatees.html"><a href="conditional-manatees.html#a-winter-flower"><i class="fa fa-check"></i><b>8.3.1</b> A winter flower</a></li>
<li class="chapter" data-level="8.3.2" data-path="conditional-manatees.html"><a href="conditional-manatees.html#the-models"><i class="fa fa-check"></i><b>8.3.2</b> The models</a></li>
<li class="chapter" data-level="8.3.3" data-path="conditional-manatees.html"><a href="conditional-manatees.html#plotting-posterior-predictions"><i class="fa fa-check"></i><b>8.3.3</b> Plotting posterior predictions</a></li>
<li class="chapter" data-level="8.3.4" data-path="conditional-manatees.html"><a href="conditional-manatees.html#plotting-prior-predictions"><i class="fa fa-check"></i><b>8.3.4</b> Plotting prior predictions</a></li>
</ul></li>
<li class="chapter" data-level="8.4" data-path="conditional-manatees.html"><a href="conditional-manatees.html#practice-6"><i class="fa fa-check"></i><b>8.4</b> Practice</a>
<ul>
<li class="chapter" data-level="8.4.1" data-path="conditional-manatees.html"><a href="conditional-manatees.html#m4-5"><i class="fa fa-check"></i><b>8.4.1</b> 8M4</a></li>
<li class="chapter" data-level="8.4.2" data-path="conditional-manatees.html"><a href="conditional-manatees.html#h1-6"><i class="fa fa-check"></i><b>8.4.2</b> 8H1</a></li>
<li class="chapter" data-level="8.4.3" data-path="conditional-manatees.html"><a href="conditional-manatees.html#h2-6"><i class="fa fa-check"></i><b>8.4.3</b> 8H2</a></li>
<li class="chapter" data-level="8.4.4" data-path="conditional-manatees.html"><a href="conditional-manatees.html#h3-6"><i class="fa fa-check"></i><b>8.4.4</b> 8H3</a></li>
<li class="chapter" data-level="8.4.5" data-path="conditional-manatees.html"><a href="conditional-manatees.html#h4-6"><i class="fa fa-check"></i><b>8.4.5</b> 8H4</a></li>
<li class="chapter" data-level="8.4.6" data-path="conditional-manatees.html"><a href="conditional-manatees.html#h5-4"><i class="fa fa-check"></i><b>8.4.6</b> 8H5</a></li>
<li class="chapter" data-level="8.4.7" data-path="conditional-manatees.html"><a href="conditional-manatees.html#h6-1"><i class="fa fa-check"></i><b>8.4.7</b> 8H6</a></li>
<li class="chapter" data-level="8.4.8" data-path="conditional-manatees.html"><a href="conditional-manatees.html#h7"><i class="fa fa-check"></i><b>8.4.8</b> 8H7</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="9" data-path="marcov-chain-monte-carlo.html"><a href="marcov-chain-monte-carlo.html"><i class="fa fa-check"></i><b>9</b> Marcov Chain Monte Carlo</a>
<ul>
<li class="chapter" data-level="9.1" data-path="marcov-chain-monte-carlo.html"><a href="marcov-chain-monte-carlo.html#good-king-marcov-and-his-island-kingdom"><i class="fa fa-check"></i><b>9.1</b> Good King Marcov and his island kingdom</a></li>
<li class="chapter" data-level="9.2" data-path="marcov-chain-monte-carlo.html"><a href="marcov-chain-monte-carlo.html#metropolis-algorythm"><i class="fa fa-check"></i><b>9.2</b> Metropolis algorythm</a>
<ul>
<li class="chapter" data-level="9.2.1" data-path="marcov-chain-monte-carlo.html"><a href="marcov-chain-monte-carlo.html#gibbs-sampling"><i class="fa fa-check"></i><b>9.2.1</b> Gibbs sampling</a></li>
<li class="chapter" data-level="9.2.2" data-path="marcov-chain-monte-carlo.html"><a href="marcov-chain-monte-carlo.html#high-dimentional-problem"><i class="fa fa-check"></i><b>9.2.2</b> High-dimentional problem</a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="marcov-chain-monte-carlo.html"><a href="marcov-chain-monte-carlo.html#hamiltonian-monte-carlo"><i class="fa fa-check"></i><b>9.3</b> Hamiltonian Monte Carlo</a>
<ul>
<li class="chapter" data-level="9.3.1" data-path="marcov-chain-monte-carlo.html"><a href="marcov-chain-monte-carlo.html#another-probable"><i class="fa fa-check"></i><b>9.3.1</b> Another probable</a></li>
<li class="chapter" data-level="9.3.2" data-path="marcov-chain-monte-carlo.html"><a href="marcov-chain-monte-carlo.html#limitations"><i class="fa fa-check"></i><b>9.3.2</b> Limitations</a></li>
</ul></li>
<li class="chapter" data-level="9.4" data-path="marcov-chain-monte-carlo.html"><a href="marcov-chain-monte-carlo.html#easy-hmc-ulam-brm"><i class="fa fa-check"></i><b>9.4</b> Easy HMC: <del>ulam</del> <code>brm()</code></a>
<ul>
<li class="chapter" data-level="9.4.1" data-path="marcov-chain-monte-carlo.html"><a href="marcov-chain-monte-carlo.html#preparation"><i class="fa fa-check"></i><b>9.4.1</b> Preparation</a></li>
<li class="chapter" data-level="9.4.2" data-path="marcov-chain-monte-carlo.html"><a href="marcov-chain-monte-carlo.html#sampling-from-posterior"><i class="fa fa-check"></i><b>9.4.2</b> Sampling from posterior</a></li>
<li class="chapter" data-level="9.4.3" data-path="marcov-chain-monte-carlo.html"><a href="marcov-chain-monte-carlo.html#sampling-again-in-parallel"><i class="fa fa-check"></i><b>9.4.3</b> Sampling again in parallel</a></li>
<li class="chapter" data-level="9.4.4" data-path="marcov-chain-monte-carlo.html"><a href="marcov-chain-monte-carlo.html#visualization"><i class="fa fa-check"></i><b>9.4.4</b> Visualization</a></li>
<li class="chapter" data-level="9.4.5" data-path="marcov-chain-monte-carlo.html"><a href="marcov-chain-monte-carlo.html#checking-the-chain"><i class="fa fa-check"></i><b>9.4.5</b> Checking the chain</a></li>
</ul></li>
<li class="chapter" data-level="9.5" data-path="marcov-chain-monte-carlo.html"><a href="marcov-chain-monte-carlo.html#care-and-feeding-of-your-marcov-chain"><i class="fa fa-check"></i><b>9.5</b> Care and feeding of your Marcov chain</a>
<ul>
<li class="chapter" data-level="9.5.1" data-path="marcov-chain-monte-carlo.html"><a href="marcov-chain-monte-carlo.html#how-many-samples-do-you-need"><i class="fa fa-check"></i><b>9.5.1</b> How many samples do you need</a></li>
<li class="chapter" data-level="9.5.2" data-path="marcov-chain-monte-carlo.html"><a href="marcov-chain-monte-carlo.html#how-many-chains-do-we-need"><i class="fa fa-check"></i><b>9.5.2</b> How many chains do we need</a></li>
<li class="chapter" data-level="9.5.3" data-path="marcov-chain-monte-carlo.html"><a href="marcov-chain-monte-carlo.html#taming-and-wild-chain"><i class="fa fa-check"></i><b>9.5.3</b> Taming and wild chain</a></li>
<li class="chapter" data-level="9.5.4" data-path="marcov-chain-monte-carlo.html"><a href="marcov-chain-monte-carlo.html#non-identifiable-parameters"><i class="fa fa-check"></i><b>9.5.4</b> Non-identifiable parameters</a></li>
</ul></li>
<li class="chapter" data-level="9.6" data-path="marcov-chain-monte-carlo.html"><a href="marcov-chain-monte-carlo.html#practice-7"><i class="fa fa-check"></i><b>9.6</b> Practice</a>
<ul>
<li class="chapter" data-level="9.6.1" data-path="marcov-chain-monte-carlo.html"><a href="marcov-chain-monte-carlo.html#m1-5"><i class="fa fa-check"></i><b>9.6.1</b> 9M1</a></li>
<li class="chapter" data-level="9.6.2" data-path="marcov-chain-monte-carlo.html"><a href="marcov-chain-monte-carlo.html#m2-5"><i class="fa fa-check"></i><b>9.6.2</b> 9M2</a></li>
<li class="chapter" data-level="9.6.3" data-path="marcov-chain-monte-carlo.html"><a href="marcov-chain-monte-carlo.html#m3-2"><i class="fa fa-check"></i><b>9.6.3</b> 9M3</a></li>
<li class="chapter" data-level="9.6.4" data-path="marcov-chain-monte-carlo.html"><a href="marcov-chain-monte-carlo.html#h1-7"><i class="fa fa-check"></i><b>9.6.4</b> 9H1</a></li>
<li class="chapter" data-level="9.6.5" data-path="marcov-chain-monte-carlo.html"><a href="marcov-chain-monte-carlo.html#h2-7"><i class="fa fa-check"></i><b>9.6.5</b> 9H2</a></li>
<li class="chapter" data-level="9.6.6" data-path="marcov-chain-monte-carlo.html"><a href="marcov-chain-monte-carlo.html#h3-7"><i class="fa fa-check"></i><b>9.6.6</b> 9H3</a></li>
<li class="chapter" data-level="9.6.7" data-path="marcov-chain-monte-carlo.html"><a href="marcov-chain-monte-carlo.html#h4-7"><i class="fa fa-check"></i><b>9.6.7</b> 9H4</a></li>
<li class="chapter" data-level="9.6.8" data-path="marcov-chain-monte-carlo.html"><a href="marcov-chain-monte-carlo.html#h5-5"><i class="fa fa-check"></i><b>9.6.8</b> 9H5</a></li>
<li class="chapter" data-level="9.6.9" data-path="marcov-chain-monte-carlo.html"><a href="marcov-chain-monte-carlo.html#h6-2"><i class="fa fa-check"></i><b>9.6.9</b> 9H6</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="10" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html"><i class="fa fa-check"></i><b>10</b> Big Entropy and the Generalized Linear Model</a>
<ul>
<li class="chapter" data-level="10.1" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html#maximum-entropy"><i class="fa fa-check"></i><b>10.1</b> Maximum entropy</a>
<ul>
<li class="chapter" data-level="10.1.1" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html#gaussian"><i class="fa fa-check"></i><b>10.1.1</b> Gaussian</a></li>
<li class="chapter" data-level="10.1.2" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html#binomial"><i class="fa fa-check"></i><b>10.1.2</b> Binomial</a></li>
</ul></li>
<li class="chapter" data-level="10.2" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html#generalized-linear-models"><i class="fa fa-check"></i><b>10.2</b> Generalized linear models</a>
<ul>
<li class="chapter" data-level="10.2.1" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html#meet-the-family"><i class="fa fa-check"></i><b>10.2.1</b> Meet the family</a></li>
<li class="chapter" data-level="10.2.2" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html#linking-linear-models-to-distributions"><i class="fa fa-check"></i><b>10.2.2</b> Linking linear models to distributions</a></li>
<li class="chapter" data-level="10.2.3" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html#overthinking-2"><i class="fa fa-check"></i><b>10.2.3</b> Overthinking</a></li>
<li class="chapter" data-level="10.2.4" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html#omitted-variable-bias-again"><i class="fa fa-check"></i><b>10.2.4</b> Omitted variable bias again</a></li>
<li class="chapter" data-level="10.2.5" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html#absolute-and-relative-differences"><i class="fa fa-check"></i><b>10.2.5</b> Absolute and relative differences</a></li>
<li class="chapter" data-level="10.2.6" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html#glms-and-information-criteria"><i class="fa fa-check"></i><b>10.2.6</b> GLMs and information criteria</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="11" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html"><i class="fa fa-check"></i><b>11</b> God Spiked the Integers</a>
<ul>
<li class="chapter" data-level="11.1" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#binomial-regression"><i class="fa fa-check"></i><b>11.1</b> Binomial regression</a>
<ul>
<li class="chapter" data-level="11.1.1" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#logistic-regression"><i class="fa fa-check"></i><b>11.1.1</b> Logistic regression</a></li>
<li class="chapter" data-level="11.1.2" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#relative-shark-and-absolute-deer"><i class="fa fa-check"></i><b>11.1.2</b> Relative shark and absolute deer</a></li>
<li class="chapter" data-level="11.1.3" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#aggregated-binomial-chimpanzees-again-condensed"><i class="fa fa-check"></i><b>11.1.3</b> Aggregated binomial: Chimpanzees again, condensed</a></li>
</ul></li>
<li class="chapter" data-level="11.2" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#aggregated-binomial-graduate-school-admittions."><i class="fa fa-check"></i><b>11.2</b> Aggregated binomial: Graduate school admittions.</a></li>
<li class="chapter" data-level="11.3" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#poisson-regression"><i class="fa fa-check"></i><b>11.3</b> Poisson regression</a>
<ul>
<li class="chapter" data-level="11.3.1" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#oceanic-tool-complexity"><i class="fa fa-check"></i><b>11.3.1</b> Oceanic tool complexity</a></li>
<li class="chapter" data-level="11.3.2" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#negative-binomial-gamma-poisson-models."><i class="fa fa-check"></i><b>11.3.2</b> Negative binomial (Gamma-Poisson) models.</a></li>
<li class="chapter" data-level="11.3.3" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#example-exposure-and-the-offset"><i class="fa fa-check"></i><b>11.3.3</b> Example: Exposure and the offset</a></li>
</ul></li>
<li class="chapter" data-level="11.4" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#multinomial-and-categorical-models"><i class="fa fa-check"></i><b>11.4</b> Multinomial and categorical models</a>
<ul>
<li class="chapter" data-level="11.4.1" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#predictors-matched-to-outcomes"><i class="fa fa-check"></i><b>11.4.1</b> Predictors matched to outcomes</a></li>
<li class="chapter" data-level="11.4.2" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#predictor-matched-to-observations"><i class="fa fa-check"></i><b>11.4.2</b> Predictor matched to observations</a></li>
<li class="chapter" data-level="11.4.3" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#multinomial-in-disguise-as-poisson"><i class="fa fa-check"></i><b>11.4.3</b> Multinomial in disguise as Poisson</a></li>
</ul></li>
<li class="chapter" data-level="11.5" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#practice-8"><i class="fa fa-check"></i><b>11.5</b> Practice</a>
<ul>
<li class="chapter" data-level="11.5.1" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#e1"><i class="fa fa-check"></i><b>11.5.1</b> 11E1</a></li>
<li class="chapter" data-level="11.5.2" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#e2-1"><i class="fa fa-check"></i><b>11.5.2</b> 11E2</a></li>
<li class="chapter" data-level="11.5.3" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#e3-1"><i class="fa fa-check"></i><b>11.5.3</b> 11E3</a></li>
<li class="chapter" data-level="11.5.4" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#e4-1"><i class="fa fa-check"></i><b>11.5.4</b> 11E4</a></li>
<li class="chapter" data-level="11.5.5" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#m7-2"><i class="fa fa-check"></i><b>11.5.5</b> 11M7</a></li>
<li class="chapter" data-level="11.5.6" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#m8-1"><i class="fa fa-check"></i><b>11.5.6</b> 11M8</a></li>
<li class="chapter" data-level="11.5.7" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#h1-8"><i class="fa fa-check"></i><b>11.5.7</b> 11H1</a></li>
<li class="chapter" data-level="11.5.8" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#h2-8"><i class="fa fa-check"></i><b>11.5.8</b> 11H2</a></li>
<li class="chapter" data-level="11.5.9" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#h3-8"><i class="fa fa-check"></i><b>11.5.9</b> 11H3</a></li>
<li class="chapter" data-level="11.5.10" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#h4-8"><i class="fa fa-check"></i><b>11.5.10</b> 11H4</a></li>
<li class="chapter" data-level="11.5.11" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#h5-6"><i class="fa fa-check"></i><b>11.5.11</b> 11H5</a></li>
<li class="chapter" data-level="11.5.12" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#h6-3"><i class="fa fa-check"></i><b>11.5.12</b> 11H6</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="12" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html"><i class="fa fa-check"></i><b>12</b> Monsters and Mixtures</a>
<ul>
<li class="chapter" data-level="12.1" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#over-dispersed-counts"><i class="fa fa-check"></i><b>12.1</b> Over-dispersed counts</a>
<ul>
<li class="chapter" data-level="12.1.1" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#beta-binomial."><i class="fa fa-check"></i><b>12.1.1</b> Beta binomial.</a></li>
<li class="chapter" data-level="12.1.2" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#negative-binomial-or-gamma-poisson."><i class="fa fa-check"></i><b>12.1.2</b> Negative binomial or gamma-Poisson.</a></li>
<li class="chapter" data-level="12.1.3" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#over-dispersion-entropy-and-information-criteria."><i class="fa fa-check"></i><b>12.1.3</b> Over-dispersion, entropy, and information criteria.</a></li>
</ul></li>
<li class="chapter" data-level="12.2" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#zero-inflated-outcomes"><i class="fa fa-check"></i><b>12.2</b> Zero-inflated outcomes</a>
<ul>
<li class="chapter" data-level="12.2.1" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#example-zero-inflated-poisson."><i class="fa fa-check"></i><b>12.2.1</b> Example: Zero-inflated Poisson.</a></li>
</ul></li>
<li class="chapter" data-level="12.3" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#ordered-categorical-outcomes"><i class="fa fa-check"></i><b>12.3</b> Ordered categorical outcomes</a>
<ul>
<li class="chapter" data-level="12.3.1" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#example-moral-intuition."><i class="fa fa-check"></i><b>12.3.1</b> Example: Moral intuition.</a></li>
<li class="chapter" data-level="12.3.2" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#adding-predictor-variables."><i class="fa fa-check"></i><b>12.3.2</b> Adding predictor variables.</a></li>
</ul></li>
<li class="chapter" data-level="12.4" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#ordered-categorical-predictors"><i class="fa fa-check"></i><b>12.4</b> Ordered categorical predictors</a></li>
<li class="chapter" data-level="12.5" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#practice-9"><i class="fa fa-check"></i><b>12.5</b> Practice</a>
<ul>
<li class="chapter" data-level="12.5.1" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#m1-6"><i class="fa fa-check"></i><b>12.5.1</b> 12M1</a></li>
<li class="chapter" data-level="12.5.2" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#m2-6"><i class="fa fa-check"></i><b>12.5.2</b> 12M2</a></li>
<li class="chapter" data-level="12.5.3" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#m3-3"><i class="fa fa-check"></i><b>12.5.3</b> 12M3</a></li>
<li class="chapter" data-level="12.5.4" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#h1-9"><i class="fa fa-check"></i><b>12.5.4</b> 12H1</a></li>
<li class="chapter" data-level="12.5.5" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#h2-9"><i class="fa fa-check"></i><b>12.5.5</b> 12H2</a></li>
<li class="chapter" data-level="12.5.6" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#h3-9"><i class="fa fa-check"></i><b>12.5.6</b> 12H3</a></li>
<li class="chapter" data-level="12.5.7" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#h4-9"><i class="fa fa-check"></i><b>12.5.7</b> 12H4</a></li>
<li class="chapter" data-level="12.5.8" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#h5-7"><i class="fa fa-check"></i><b>12.5.8</b> 12H5</a></li>
<li class="chapter" data-level="12.5.9" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#h6-4"><i class="fa fa-check"></i><b>12.5.9</b> 12H6</a></li>
<li class="chapter" data-level="12.5.10" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#h7-1"><i class="fa fa-check"></i><b>12.5.10</b> 12H7</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="13" data-path="models-with-memory.html"><a href="models-with-memory.html"><i class="fa fa-check"></i><b>13</b> Models with Memory</a>
<ul>
<li class="chapter" data-level="13.1" data-path="models-with-memory.html"><a href="models-with-memory.html#multilevel-tadpoles"><i class="fa fa-check"></i><b>13.1</b> Multilevel tadpoles</a></li>
<li class="chapter" data-level="13.2" data-path="models-with-memory.html"><a href="models-with-memory.html#varying-effects-and-the-underfittingoverfitting-trade-off"><i class="fa fa-check"></i><b>13.2</b> Varying effects and the underfitting/overfitting trade-off 　</a>
<ul>
<li class="chapter" data-level="13.2.1" data-path="models-with-memory.html"><a href="models-with-memory.html#the-model"><i class="fa fa-check"></i><b>13.2.1</b> The model</a></li>
<li class="chapter" data-level="13.2.2" data-path="models-with-memory.html"><a href="models-with-memory.html#simulate-survivors"><i class="fa fa-check"></i><b>13.2.2</b> Simulate survivors</a></li>
</ul></li>
<li class="chapter" data-level="13.3" data-path="models-with-memory.html"><a href="models-with-memory.html#more-than-one-type-of-cluster"><i class="fa fa-check"></i><b>13.3</b> More than one type of cluster</a>
<ul>
<li class="chapter" data-level="13.3.1" data-path="models-with-memory.html"><a href="models-with-memory.html#even-more-clusters"><i class="fa fa-check"></i><b>13.3.1</b> Even more clusters</a></li>
</ul></li>
<li class="chapter" data-level="13.4" data-path="models-with-memory.html"><a href="models-with-memory.html#divergent-transitions-and-non-centered-priors"><i class="fa fa-check"></i><b>13.4</b> Divergent transitions and non-centered priors</a>
<ul>
<li class="chapter" data-level="13.4.1" data-path="models-with-memory.html"><a href="models-with-memory.html#the-devils-funnel"><i class="fa fa-check"></i><b>13.4.1</b> The Devil’s Funnel</a></li>
<li class="chapter" data-level="13.4.2" data-path="models-with-memory.html"><a href="models-with-memory.html#non-centered-chimpanzees"><i class="fa fa-check"></i><b>13.4.2</b> Non-centered chimpanzees</a></li>
</ul></li>
<li class="chapter" data-level="13.5" data-path="models-with-memory.html"><a href="models-with-memory.html#multilevel-posterior-predictions"><i class="fa fa-check"></i><b>13.5</b> Multilevel posterior predictions</a>
<ul>
<li class="chapter" data-level="13.5.1" data-path="models-with-memory.html"><a href="models-with-memory.html#posterior-prediction-for-same-clusters"><i class="fa fa-check"></i><b>13.5.1</b> Posterior prediction for same clusters</a></li>
<li class="chapter" data-level="13.5.2" data-path="models-with-memory.html"><a href="models-with-memory.html#posterior-prediction-for-new-clusters"><i class="fa fa-check"></i><b>13.5.2</b> Posterior prediction for new clusters</a></li>
</ul></li>
<li class="chapter" data-level="13.6" data-path="models-with-memory.html"><a href="models-with-memory.html#post-stratification"><i class="fa fa-check"></i><b>13.6</b> Post stratification</a>
<ul>
<li class="chapter" data-level="13.6.1" data-path="models-with-memory.html"><a href="models-with-memory.html#meet-the-data"><i class="fa fa-check"></i><b>13.6.1</b> Meet the data</a></li>
<li class="chapter" data-level="13.6.2" data-path="models-with-memory.html"><a href="models-with-memory.html#settle-the-mr-part-of-mrp."><i class="fa fa-check"></i><b>13.6.2</b> Settle the MR part of MRP.</a></li>
<li class="chapter" data-level="13.6.3" data-path="models-with-memory.html"><a href="models-with-memory.html#post-stratify-to-put-the-p-in-mrp."><i class="fa fa-check"></i><b>13.6.3</b> Post-stratify to put the P in MRP.</a></li>
</ul></li>
<li class="chapter" data-level="13.7" data-path="models-with-memory.html"><a href="models-with-memory.html#practice-10"><i class="fa fa-check"></i><b>13.7</b> Practice</a>
<ul>
<li class="chapter" data-level="13.7.1" data-path="models-with-memory.html"><a href="models-with-memory.html#m1-7"><i class="fa fa-check"></i><b>13.7.1</b> 13M1</a></li>
<li class="chapter" data-level="13.7.2" data-path="models-with-memory.html"><a href="models-with-memory.html#m2-7"><i class="fa fa-check"></i><b>13.7.2</b> 13M2</a></li>
<li class="chapter" data-level="13.7.3" data-path="models-with-memory.html"><a href="models-with-memory.html#m3-4"><i class="fa fa-check"></i><b>13.7.3</b> 13M3</a></li>
<li class="chapter" data-level="13.7.4" data-path="models-with-memory.html"><a href="models-with-memory.html#m4-6"><i class="fa fa-check"></i><b>13.7.4</b> 13M4</a></li>
<li class="chapter" data-level="13.7.5" data-path="models-with-memory.html"><a href="models-with-memory.html#m5-3"><i class="fa fa-check"></i><b>13.7.5</b> 13M5</a></li>
<li class="chapter" data-level="13.7.6" data-path="models-with-memory.html"><a href="models-with-memory.html#m6-2"><i class="fa fa-check"></i><b>13.7.6</b> 13M6</a></li>
<li class="chapter" data-level="13.7.7" data-path="models-with-memory.html"><a href="models-with-memory.html#h1-10"><i class="fa fa-check"></i><b>13.7.7</b> 13H1</a></li>
<li class="chapter" data-level="13.7.8" data-path="models-with-memory.html"><a href="models-with-memory.html#h2-10"><i class="fa fa-check"></i><b>13.7.8</b> 13H2</a></li>
<li class="chapter" data-level="13.7.9" data-path="models-with-memory.html"><a href="models-with-memory.html#h3-10"><i class="fa fa-check"></i><b>13.7.9</b> 13H3</a></li>
<li class="chapter" data-level="13.7.10" data-path="models-with-memory.html"><a href="models-with-memory.html#h4-10"><i class="fa fa-check"></i><b>13.7.10</b> 13H4</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="14" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html"><i class="fa fa-check"></i><b>14</b> Adventures in Covariance</a>
<ul>
<li class="chapter" data-level="14.1" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#varying-slopes-by-construction"><i class="fa fa-check"></i><b>14.1</b> Varying slopes by construction</a>
<ul>
<li class="chapter" data-level="14.1.1" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#simulate-and-population"><i class="fa fa-check"></i><b>14.1.1</b> Simulate and population</a></li>
<li class="chapter" data-level="14.1.2" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#simulate-observation"><i class="fa fa-check"></i><b>14.1.2</b> Simulate observation</a></li>
<li class="chapter" data-level="14.1.3" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#the-varying-slope-model"><i class="fa fa-check"></i><b>14.1.3</b> The varying slope model</a></li>
</ul></li>
<li class="chapter" data-level="14.2" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#advanced-varing-slopes"><i class="fa fa-check"></i><b>14.2</b> Advanced varing slopes</a></li>
<li class="chapter" data-level="14.3" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#instruments-and-causal-designs"><i class="fa fa-check"></i><b>14.3</b> Instruments and causal designs</a>
<ul>
<li class="chapter" data-level="14.3.1" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#instrumental-variables"><i class="fa fa-check"></i><b>14.3.1</b> Instrumental variables</a></li>
<li class="chapter" data-level="14.3.2" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#other-designs"><i class="fa fa-check"></i><b>14.3.2</b> Other designs</a></li>
</ul></li>
<li class="chapter" data-level="14.4" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#social-relations-as-correlated-varying-effects"><i class="fa fa-check"></i><b>14.4</b> Social relations as correlated varying effects</a></li>
<li class="chapter" data-level="14.5" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#continuous-categories-and-the-gaussian-process"><i class="fa fa-check"></i><b>14.5</b> Continuous categories and the Gaussian process</a>
<ul>
<li class="chapter" data-level="14.5.1" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#example-spatial-autocorrelation-in-oceanic-tools"><i class="fa fa-check"></i><b>14.5.1</b> Example: Spatial autocorrelation in Oceanic tools</a></li>
<li class="chapter" data-level="14.5.2" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#example-phylogenetic-distance"><i class="fa fa-check"></i><b>14.5.2</b> Example: Phylogenetic distance</a></li>
</ul></li>
<li class="chapter" data-level="14.6" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#practice-11"><i class="fa fa-check"></i><b>14.6</b> Practice</a>
<ul>
<li class="chapter" data-level="14.6.1" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#m1-8"><i class="fa fa-check"></i><b>14.6.1</b> 14M1</a></li>
<li class="chapter" data-level="14.6.2" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#m2-8"><i class="fa fa-check"></i><b>14.6.2</b> 14M2</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="実行環境.html"><a href="実行環境.html"><i class="fa fa-check"></i>実行環境</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Statistical Rethinking Second Edition</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="models-with-memory" class="section level1 hasAnchor" number="13">
<h1><span class="header-section-number">13</span> Models with Memory<a href="models-with-memory.html#models-with-memory" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div id="multilevel-tadpoles" class="section level2 hasAnchor" number="13.1">
<h2><span class="header-section-number">13.1</span> Multilevel tadpoles<a href="models-with-memory.html#multilevel-tadpoles" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>オタマジャクシの生存率に関するデータを用いる<span class="citation">(<a href="#ref-Vonesh2005" role="doc-biblioref">Vonesh and Bolker 2005</a>)</span>。各行はそれぞれ異なる水槽を表しおり、水槽ごとに観測できない違いがあると考える。</p>
<div class="sourceCode" id="cb1114"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1114-1"><a href="models-with-memory.html#cb1114-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(reedfrogs)</span>
<span id="cb1114-2"><a href="models-with-memory.html#cb1114-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1114-3"><a href="models-with-memory.html#cb1114-3" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> reedfrogs</span>
<span id="cb1114-4"><a href="models-with-memory.html#cb1114-4" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(d)</span></code></pre></div>
<pre><code>##   density pred  size surv propsurv
## 1      10   no   big    9      0.9
## 2      10   no   big   10      1.0
## 3      10   no   big    7      0.7
## 4      10   no   big   10      1.0
## 5      10   no small    9      0.9
## 6      10   no small    9      0.9</code></pre>
<div class="sourceCode" id="cb1116"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1116-1"><a href="models-with-memory.html#cb1116-1" aria-hidden="true" tabindex="-1"></a>d <span class="sc">%&gt;%</span> </span>
<span id="cb1116-2"><a href="models-with-memory.html#cb1116-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">tank =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(d)) <span class="ot">-&gt;</span>d</span></code></pre></div>
<p>まずは、それぞれの水槽が違う切片を持つモデルを考える。</p>
<p><span class="math display">\[
\begin{aligned}  
  S_{i} &amp;\sim Binomial(N_{i}, p_{i})\\
  logit(p_{i}) &amp;= \alpha_{tank[i]}\\
   \alpha_{j} &amp;\sim Normal(0,1.5) \;\; for \; j = 1 .. 48
\end{aligned}
\]</span>
<br /></p>
<div class="sourceCode" id="cb1117"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1117-1"><a href="models-with-memory.html#cb1117-1" aria-hidden="true" tabindex="-1"></a>b13<span class="fl">.1</span> <span class="ot">&lt;-</span> </span>
<span id="cb1117-2"><a href="models-with-memory.html#cb1117-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">brm</span>(<span class="at">data =</span> d,</span>
<span id="cb1117-3"><a href="models-with-memory.html#cb1117-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> binomial,</span>
<span id="cb1117-4"><a href="models-with-memory.html#cb1117-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">formula =</span> surv <span class="sc">|</span> <span class="fu">trials</span>(density) <span class="sc">~</span> <span class="dv">0</span> <span class="sc">+</span> <span class="fu">factor</span>(tank),</span>
<span id="cb1117-5"><a href="models-with-memory.html#cb1117-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>,<span class="fl">1.5</span>), <span class="at">class =</span> b),</span>
<span id="cb1117-6"><a href="models-with-memory.html#cb1117-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">backend =</span> <span class="st">&quot;cmdstanr&quot;</span>,</span>
<span id="cb1117-7"><a href="models-with-memory.html#cb1117-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">seed =</span> <span class="dv">13</span>, <span class="at">file =</span> <span class="st">&quot;output/Chapter13/b13.1&quot;</span>)</span></code></pre></div>
結果は以下の通り（表<a href="models-with-memory.html#tab:res-b13-1">13.1</a>）。48個の切片が推定されている。
<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:res-b13-1">表13.1: </span>b13.1の結果。
</caption>
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
Estimate
</th>
<th style="text-align:right;">
Est.Error
</th>
<th style="text-align:right;">
Q2.5
</th>
<th style="text-align:right;">
Q97.5
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
factortank1
</td>
<td style="text-align:right;">
1.71
</td>
<td style="text-align:right;">
0.76
</td>
<td style="text-align:right;">
0.32
</td>
<td style="text-align:right;">
3.30
</td>
</tr>
<tr>
<td style="text-align:left;">
factortank2
</td>
<td style="text-align:right;">
2.40
</td>
<td style="text-align:right;">
0.88
</td>
<td style="text-align:right;">
0.83
</td>
<td style="text-align:right;">
4.37
</td>
</tr>
<tr>
<td style="text-align:left;">
factortank3
</td>
<td style="text-align:right;">
0.76
</td>
<td style="text-align:right;">
0.63
</td>
<td style="text-align:right;">
-0.41
</td>
<td style="text-align:right;">
2.03
</td>
</tr>
<tr>
<td style="text-align:left;">
factortank4
</td>
<td style="text-align:right;">
2.41
</td>
<td style="text-align:right;">
0.91
</td>
<td style="text-align:right;">
0.77
</td>
<td style="text-align:right;">
4.29
</td>
</tr>
<tr>
<td style="text-align:left;">
factortank5
</td>
<td style="text-align:right;">
1.72
</td>
<td style="text-align:right;">
0.78
</td>
<td style="text-align:right;">
0.31
</td>
<td style="text-align:right;">
3.42
</td>
</tr>
<tr>
<td style="text-align:left;">
factortank6
</td>
<td style="text-align:right;">
1.71
</td>
<td style="text-align:right;">
0.79
</td>
<td style="text-align:right;">
0.30
</td>
<td style="text-align:right;">
3.42
</td>
</tr>
<tr>
<td style="text-align:left;">
factortank7
</td>
<td style="text-align:right;">
2.42
</td>
<td style="text-align:right;">
0.90
</td>
<td style="text-align:right;">
0.81
</td>
<td style="text-align:right;">
4.41
</td>
</tr>
<tr>
<td style="text-align:left;">
factortank8
</td>
<td style="text-align:right;">
1.72
</td>
<td style="text-align:right;">
0.79
</td>
<td style="text-align:right;">
0.27
</td>
<td style="text-align:right;">
3.35
</td>
</tr>
<tr>
<td style="text-align:left;">
factortank9
</td>
<td style="text-align:right;">
-0.37
</td>
<td style="text-align:right;">
0.61
</td>
<td style="text-align:right;">
-1.58
</td>
<td style="text-align:right;">
0.78
</td>
</tr>
<tr>
<td style="text-align:left;">
factortank10
</td>
<td style="text-align:right;">
1.70
</td>
<td style="text-align:right;">
0.75
</td>
<td style="text-align:right;">
0.33
</td>
<td style="text-align:right;">
3.30
</td>
</tr>
</tbody>
</table>
<p><img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-596-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>続いて、階層モデルを考える。</p>
<p><span class="math display">\[
\begin{aligned}  
  S_{i} &amp;\sim Binomial(N_{i}, p_{i})\\
  logit(p_{i}) &amp;= \alpha_{tank[i]}\\
   \alpha_{j} &amp;\sim Normal(\bar{\alpha},\sigma) \\
   \bar{\alpha} &amp;\sim Normal(0,1.5)\\
   \sigma &amp;\sim Exponential(1)
\end{aligned}
\]</span>
<br /></p>
<div class="sourceCode" id="cb1118"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1118-1"><a href="models-with-memory.html#cb1118-1" aria-hidden="true" tabindex="-1"></a>b13<span class="fl">.2</span> <span class="ot">&lt;-</span> </span>
<span id="cb1118-2"><a href="models-with-memory.html#cb1118-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">brm</span>(<span class="at">data =</span>d,</span>
<span id="cb1118-3"><a href="models-with-memory.html#cb1118-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> binomial, </span>
<span id="cb1118-4"><a href="models-with-memory.html#cb1118-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">formula =</span> surv <span class="sc">|</span> <span class="fu">trials</span>(density) <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> (<span class="dv">1</span><span class="sc">|</span>tank),</span>
<span id="cb1118-5"><a href="models-with-memory.html#cb1118-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>,<span class="fl">1.5</span>), <span class="at">class =</span> Intercept),</span>
<span id="cb1118-6"><a href="models-with-memory.html#cb1118-6" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>), <span class="at">class =</span> sd)),</span>
<span id="cb1118-7"><a href="models-with-memory.html#cb1118-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">iter =</span> <span class="dv">5000</span>, <span class="at">warmup =</span><span class="dv">1000</span>, <span class="at">sample_prior =</span> <span class="st">&quot;yes&quot;</span>,</span>
<span id="cb1118-8"><a href="models-with-memory.html#cb1118-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">backend =</span> <span class="st">&quot;cmdstanr&quot;</span>,</span>
<span id="cb1118-9"><a href="models-with-memory.html#cb1118-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">seed =</span> <span class="dv">13</span>, <span class="at">file =</span> <span class="st">&quot;output/Chapter13/b13.2&quot;</span>)</span></code></pre></div>
<p>結果は以下の通り（表<a href="models-with-memory.html#tab:res-b13-2">13.2</a>）。</p>
<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:res-b13-2">表13.2: </span>b13.1の結果。
</caption>
<thead>
<tr>
<th style="text-align:left;">
param
</th>
<th style="text-align:right;">
Estimate
</th>
<th style="text-align:right;">
Est.Error
</th>
<th style="text-align:right;">
Q2.5
</th>
<th style="text-align:right;">
Q97.5
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
b_Intercept
</td>
<td style="text-align:right;">
1.35
</td>
<td style="text-align:right;">
0.26
</td>
<td style="text-align:right;">
0.85
</td>
<td style="text-align:right;">
1.86
</td>
</tr>
<tr>
<td style="text-align:left;">
sd_tank__Intercept
</td>
<td style="text-align:right;">
1.62
</td>
<td style="text-align:right;">
0.22
</td>
<td style="text-align:right;">
1.25
</td>
<td style="text-align:right;">
2.10
</td>
</tr>
<tr>
<td style="text-align:left;">
r_tank[1,Intercept]
</td>
<td style="text-align:right;">
0.80
</td>
<td style="text-align:right;">
0.90
</td>
<td style="text-align:right;">
-0.79
</td>
<td style="text-align:right;">
2.74
</td>
</tr>
<tr>
<td style="text-align:left;">
r_tank[2,Intercept]
</td>
<td style="text-align:right;">
1.74
</td>
<td style="text-align:right;">
1.12
</td>
<td style="text-align:right;">
-0.16
</td>
<td style="text-align:right;">
4.19
</td>
</tr>
<tr>
<td style="text-align:left;">
r_tank[3,Intercept]
</td>
<td style="text-align:right;">
-0.35
</td>
<td style="text-align:right;">
0.71
</td>
<td style="text-align:right;">
-1.68
</td>
<td style="text-align:right;">
1.13
</td>
</tr>
<tr>
<td style="text-align:left;">
r_tank[4,Intercept]
</td>
<td style="text-align:right;">
1.73
</td>
<td style="text-align:right;">
1.12
</td>
<td style="text-align:right;">
-0.18
</td>
<td style="text-align:right;">
4.26
</td>
</tr>
<tr>
<td style="text-align:left;">
r_tank[5,Intercept]
</td>
<td style="text-align:right;">
0.80
</td>
<td style="text-align:right;">
0.89
</td>
<td style="text-align:right;">
-0.80
</td>
<td style="text-align:right;">
2.72
</td>
</tr>
<tr>
<td style="text-align:left;">
r_tank[6,Intercept]
</td>
<td style="text-align:right;">
0.80
</td>
<td style="text-align:right;">
0.90
</td>
<td style="text-align:right;">
-0.79
</td>
<td style="text-align:right;">
2.75
</td>
</tr>
<tr>
<td style="text-align:left;">
r_tank[7,Intercept]
</td>
<td style="text-align:right;">
1.73
</td>
<td style="text-align:right;">
1.10
</td>
<td style="text-align:right;">
-0.16
</td>
<td style="text-align:right;">
4.14
</td>
</tr>
<tr>
<td style="text-align:left;">
r_tank[8,Intercept]
</td>
<td style="text-align:right;">
0.79
</td>
<td style="text-align:right;">
0.89
</td>
<td style="text-align:right;">
-0.78
</td>
<td style="text-align:right;">
2.68
</td>
</tr>
</tbody>
</table>
<p>モデルを比較してみる（表<a href="models-with-memory.html#tab:compare-13-1-13-2">13.3</a>）。b13.2の方が圧倒的に良いモデル。</p>
<pre><code>##       elpd_diff se_diff elpd_waic se_elpd_waic p_waic se_p_waic waic   se_waic
## b13.2    0.0       0.0  -100.1       3.6         21.0    0.8     200.2    7.3 
## b13.1   -6.9       1.9  -107.0       2.3         25.3    1.2     214.0    4.5</code></pre>
<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:compare-13-1-13-2">表13.3: </span>b13.1とb13.2のモデル比較。
</caption>
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
elpd_diff
</th>
<th style="text-align:right;">
se_diff
</th>
<th style="text-align:right;">
elpd_waic
</th>
<th style="text-align:right;">
se_elpd_waic
</th>
<th style="text-align:right;">
p_waic
</th>
<th style="text-align:right;">
se_p_waic
</th>
<th style="text-align:right;">
waic
</th>
<th style="text-align:right;">
se_waic
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
b13.2
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;">
-100.08
</td>
<td style="text-align:right;">
3.64
</td>
<td style="text-align:right;">
20.96
</td>
<td style="text-align:right;">
0.79
</td>
<td style="text-align:right;">
200.17
</td>
<td style="text-align:right;">
7.28
</td>
</tr>
<tr>
<td style="text-align:left;">
b13.1
</td>
<td style="text-align:right;">
-6.91
</td>
<td style="text-align:right;">
1.86
</td>
<td style="text-align:right;">
-107.00
</td>
<td style="text-align:right;">
2.26
</td>
<td style="text-align:right;">
25.25
</td>
<td style="text-align:right;">
1.24
</td>
<td style="text-align:right;">
214.00
</td>
<td style="text-align:right;">
4.52
</td>
</tr>
</tbody>
</table>
<p>モデルの推定結果は、実データよりも事後分布の中央値に近づいている（= 縮合）。また、小さい水槽（= サンプルサイズが小さい）ではより縮合が起きている。これは、サンプルサイズが小さいほど結果に対する影響が小さいため。さらに、事後分布中央値から離れているデータほど縮合が起きている。 　
<img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-598-1.png" width="672" style="display: block; margin: auto;" /></p>
<p><img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-599-1.png" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="varying-effects-and-the-underfittingoverfitting-trade-off" class="section level2 hasAnchor" number="13.2">
<h2><span class="header-section-number">13.2</span> Varying effects and the underfitting/overfitting trade-off 　<a href="models-with-memory.html#varying-effects-and-the-underfittingoverfitting-trade-off" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>先ほどのオタマジャクシの例で、もしすべてのデータをプールしたとすると、全体の平均はより正確に推定できるが、それぞれの水槽の平均にはあまり当てはまらない（underfitting）。一方、もしすべての水槽に異なる切片を推定するとすれば、それぞれの水槽の平均値を推定できるがデータ数が少ないので不正確になってしまう（overfitting）。階層モデルを用いれば、overfittingとunderfittingの両方を防ぐことができる。それぞれのクラスター内のデータ数が十分に多ければすべての水槽に異なる切片を推定するモデルの結果に近くなるが、少なければ縮合が起きてoverfittingを防いでくれる。</p>
<div id="the-model" class="section level3 hasAnchor" number="13.2.1">
<h3><span class="header-section-number">13.2.1</span> The model<a href="models-with-memory.html#the-model" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>b13.2のモデル式を用いてシミュレーションデータを作成する。</p>
<div class="sourceCode" id="cb1120"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1120-1"><a href="models-with-memory.html#cb1120-1" aria-hidden="true" tabindex="-1"></a>a_bar <span class="ot">&lt;-</span> <span class="fl">1.5</span></span>
<span id="cb1120-2"><a href="models-with-memory.html#cb1120-2" aria-hidden="true" tabindex="-1"></a>sigma <span class="ot">&lt;-</span> <span class="fl">1.5</span></span>
<span id="cb1120-3"><a href="models-with-memory.html#cb1120-3" aria-hidden="true" tabindex="-1"></a>n_ponds <span class="ot">&lt;-</span> <span class="dv">60</span></span>
<span id="cb1120-4"><a href="models-with-memory.html#cb1120-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1120-5"><a href="models-with-memory.html#cb1120-5" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">55</span>)</span>
<span id="cb1120-6"><a href="models-with-memory.html#cb1120-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1120-7"><a href="models-with-memory.html#cb1120-7" aria-hidden="true" tabindex="-1"></a>dsim <span class="ot">&lt;-</span> </span>
<span id="cb1120-8"><a href="models-with-memory.html#cb1120-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="at">pond =</span> <span class="dv">1</span><span class="sc">:</span>n_ponds,</span>
<span id="cb1120-9"><a href="models-with-memory.html#cb1120-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">ni=</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="dv">5</span>,<span class="dv">10</span>,<span class="dv">25</span>,<span class="dv">35</span>),<span class="at">each=</span>n_ponds<span class="sc">/</span><span class="dv">4</span>) <span class="sc">%&gt;%</span> <span class="fu">as.integer</span>(),</span>
<span id="cb1120-10"><a href="models-with-memory.html#cb1120-10" aria-hidden="true" tabindex="-1"></a>         <span class="at">true_a =</span> <span class="fu">rnorm</span>(<span class="at">n =</span> n_ponds, <span class="at">mean =</span> a_bar, <span class="at">sd =</span> sigma))</span>
<span id="cb1120-11"><a href="models-with-memory.html#cb1120-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1120-12"><a href="models-with-memory.html#cb1120-12" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(dsim)</span></code></pre></div>
<pre><code>## # A tibble: 6 × 3
##    pond    ni true_a
##   &lt;int&gt; &lt;int&gt;  &lt;dbl&gt;
## 1     1     5  1.68 
## 2     2     5 -1.22 
## 3     3     5  1.73 
## 4     4     5 -0.179
## 5     5     5  1.50 
## 6     6     5  3.28</code></pre>
</div>
<div id="simulate-survivors" class="section level3 hasAnchor" number="13.2.2">
<h3><span class="header-section-number">13.2.2</span> Simulate survivors<a href="models-with-memory.html#simulate-survivors" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>生存数をシミュレートする。</p>
<div class="sourceCode" id="cb1122"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1122-1"><a href="models-with-memory.html#cb1122-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">5005</span>)</span>
<span id="cb1122-2"><a href="models-with-memory.html#cb1122-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1122-3"><a href="models-with-memory.html#cb1122-3" aria-hidden="true" tabindex="-1"></a>dsim <span class="ot">&lt;-</span> </span>
<span id="cb1122-4"><a href="models-with-memory.html#cb1122-4" aria-hidden="true" tabindex="-1"></a>  dsim <span class="sc">%&gt;%</span> </span>
<span id="cb1122-5"><a href="models-with-memory.html#cb1122-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">si =</span> <span class="fu">rbinom</span>(<span class="at">n =</span> <span class="fu">n</span>(), <span class="at">prob =</span> <span class="fu">inv_logit_scaled</span>(true_a), <span class="at">size=</span>ni),</span>
<span id="cb1122-6"><a href="models-with-memory.html#cb1122-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">p_nopool =</span> si<span class="sc">/</span>ni)</span></code></pre></div>
<table class="table" style="margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:right;">
pond
</th>
<th style="text-align:right;">
ni
</th>
<th style="text-align:right;">
true_a
</th>
<th style="text-align:right;">
si
</th>
<th style="text-align:right;">
p_nopool
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
47
</td>
<td style="text-align:right;">
35
</td>
<td style="text-align:right;">
2.1398394
</td>
<td style="text-align:right;">
33
</td>
<td style="text-align:right;">
0.9428571
</td>
</tr>
<tr>
<td style="text-align:right;">
59
</td>
<td style="text-align:right;">
35
</td>
<td style="text-align:right;">
-0.9496280
</td>
<td style="text-align:right;">
9
</td>
<td style="text-align:right;">
0.2571429
</td>
</tr>
<tr>
<td style="text-align:right;">
60
</td>
<td style="text-align:right;">
35
</td>
<td style="text-align:right;">
0.7680259
</td>
<td style="text-align:right;">
24
</td>
<td style="text-align:right;">
0.6857143
</td>
</tr>
<tr>
<td style="text-align:right;">
17
</td>
<td style="text-align:right;">
10
</td>
<td style="text-align:right;">
5.0330458
</td>
<td style="text-align:right;">
10
</td>
<td style="text-align:right;">
1.0000000
</td>
</tr>
<tr>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
1.5028623
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
1.0000000
</td>
</tr>
<tr>
<td style="text-align:right;">
39
</td>
<td style="text-align:right;">
25
</td>
<td style="text-align:right;">
2.2360616
</td>
<td style="text-align:right;">
23
</td>
<td style="text-align:right;">
0.9200000
</td>
</tr>
<tr>
<td style="text-align:right;">
33
</td>
<td style="text-align:right;">
25
</td>
<td style="text-align:right;">
0.0979725
</td>
<td style="text-align:right;">
18
</td>
<td style="text-align:right;">
0.7200000
</td>
</tr>
<tr>
<td style="text-align:right;">
12
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
0.2351493
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
0.4000000
</td>
</tr>
<tr>
<td style="text-align:right;">
31
</td>
<td style="text-align:right;">
25
</td>
<td style="text-align:right;">
3.8471316
</td>
<td style="text-align:right;">
25
</td>
<td style="text-align:right;">
1.0000000
</td>
</tr>
<tr>
<td style="text-align:right;">
42
</td>
<td style="text-align:right;">
25
</td>
<td style="text-align:right;">
1.0700611
</td>
<td style="text-align:right;">
19
</td>
<td style="text-align:right;">
0.7600000
</td>
</tr>
</tbody>
</table>
<div id="computing-the-non-pooling-estimates" class="section level4 hasAnchor" number="13.2.2.1">
<h4><span class="header-section-number">13.2.2.1</span> Computing the non-pooling estimates<a href="models-with-memory.html#computing-the-non-pooling-estimates" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>それでは、実際にモデリングを行う。</p>
<div class="sourceCode" id="cb1123"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1123-1"><a href="models-with-memory.html#cb1123-1" aria-hidden="true" tabindex="-1"></a>b13<span class="fl">.3</span> <span class="ot">&lt;-</span> </span>
<span id="cb1123-2"><a href="models-with-memory.html#cb1123-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">brm</span>(<span class="at">data =</span> dsim,</span>
<span id="cb1123-3"><a href="models-with-memory.html#cb1123-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> binomial,</span>
<span id="cb1123-4"><a href="models-with-memory.html#cb1123-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">formula =</span> si<span class="sc">|</span><span class="fu">trials</span>(ni) <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> (<span class="dv">1</span><span class="sc">|</span>pond),</span>
<span id="cb1123-5"><a href="models-with-memory.html#cb1123-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">1.5</span>), <span class="at">class =</span> Intercept),</span>
<span id="cb1123-6"><a href="models-with-memory.html#cb1123-6" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>), <span class="at">class =</span> sd)),</span>
<span id="cb1123-7"><a href="models-with-memory.html#cb1123-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">iter =</span> <span class="dv">5000</span>, <span class="at">warmup =</span><span class="dv">1000</span>,</span>
<span id="cb1123-8"><a href="models-with-memory.html#cb1123-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">backend =</span> <span class="st">&quot;cmdstanr&quot;</span>,</span>
<span id="cb1123-9"><a href="models-with-memory.html#cb1123-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">seed =</span> <span class="dv">13</span>, <span class="at">file =</span> <span class="st">&quot;output/Chapter13/b13.3&quot;</span>)</span></code></pre></div>
<p>結果は以下の通り（表<a href="models-with-memory.html#tab:res-b13-3">13.4</a>）。</p>
<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:res-b13-3">表13.4: </span>b13.3の結果。
</caption>
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
Estimate
</th>
<th style="text-align:right;">
Est.Error
</th>
<th style="text-align:right;">
Q2.5
</th>
<th style="text-align:right;">
Q97.5
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
b_Intercept
</td>
<td style="text-align:right;">
1.31
</td>
<td style="text-align:right;">
0.20
</td>
<td style="text-align:right;">
0.93
</td>
<td style="text-align:right;">
1.71
</td>
</tr>
<tr>
<td style="text-align:left;">
sd_pond__Intercept
</td>
<td style="text-align:right;">
1.28
</td>
<td style="text-align:right;">
0.18
</td>
<td style="text-align:right;">
0.97
</td>
<td style="text-align:right;">
1.66
</td>
</tr>
<tr>
<td style="text-align:left;">
r_pond[1,Intercept]
</td>
<td style="text-align:right;">
0.99
</td>
<td style="text-align:right;">
1.00
</td>
<td style="text-align:right;">
-0.80
</td>
<td style="text-align:right;">
3.13
</td>
</tr>
<tr>
<td style="text-align:left;">
r_pond[2,Intercept]
</td>
<td style="text-align:right;">
-1.13
</td>
<td style="text-align:right;">
0.79
</td>
<td style="text-align:right;">
-2.69
</td>
<td style="text-align:right;">
0.42
</td>
</tr>
<tr>
<td style="text-align:left;">
r_pond[3,Intercept]
</td>
<td style="text-align:right;">
0.14
</td>
<td style="text-align:right;">
0.86
</td>
<td style="text-align:right;">
-1.45
</td>
<td style="text-align:right;">
1.95
</td>
</tr>
<tr>
<td style="text-align:left;">
r_pond[4,Intercept]
</td>
<td style="text-align:right;">
-1.70
</td>
<td style="text-align:right;">
0.81
</td>
<td style="text-align:right;">
-3.36
</td>
<td style="text-align:right;">
-0.19
</td>
</tr>
<tr>
<td style="text-align:left;">
r_pond[5,Intercept]
</td>
<td style="text-align:right;">
0.98
</td>
<td style="text-align:right;">
0.99
</td>
<td style="text-align:right;">
-0.79
</td>
<td style="text-align:right;">
3.07
</td>
</tr>
<tr>
<td style="text-align:left;">
r_pond[6,Intercept]
</td>
<td style="text-align:right;">
1.00
</td>
<td style="text-align:right;">
1.00
</td>
<td style="text-align:right;">
-0.78
</td>
<td style="text-align:right;">
3.14
</td>
</tr>
<tr>
<td style="text-align:left;">
r_pond[7,Intercept]
</td>
<td style="text-align:right;">
-0.52
</td>
<td style="text-align:right;">
0.81
</td>
<td style="text-align:right;">
-2.05
</td>
<td style="text-align:right;">
1.11
</td>
</tr>
<tr>
<td style="text-align:left;">
r_pond[8,Intercept]
</td>
<td style="text-align:right;">
-0.53
</td>
<td style="text-align:right;">
0.80
</td>
<td style="text-align:right;">
-2.08
</td>
<td style="text-align:right;">
1.10
</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb1124"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1124-1"><a href="models-with-memory.html#cb1124-1" aria-hidden="true" tabindex="-1"></a>p_partpool <span class="ot">&lt;-</span> </span>
<span id="cb1124-2"><a href="models-with-memory.html#cb1124-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coef</span>(b13<span class="fl">.3</span>)<span class="sc">$</span>pond[, , ] <span class="sc">%&gt;%</span> </span>
<span id="cb1124-3"><a href="models-with-memory.html#cb1124-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb1124-4"><a href="models-with-memory.html#cb1124-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">transmute</span>(<span class="at">p_partpool =</span> <span class="fu">inv_logit_scaled</span>(Estimate))</span>
<span id="cb1124-5"><a href="models-with-memory.html#cb1124-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1124-6"><a href="models-with-memory.html#cb1124-6" aria-hidden="true" tabindex="-1"></a>dsim2 <span class="ot">&lt;-</span> </span>
<span id="cb1124-7"><a href="models-with-memory.html#cb1124-7" aria-hidden="true" tabindex="-1"></a>  dsim <span class="sc">%&gt;%</span></span>
<span id="cb1124-8"><a href="models-with-memory.html#cb1124-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(p_partpool) <span class="sc">%&gt;%</span> </span>
<span id="cb1124-9"><a href="models-with-memory.html#cb1124-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">p_true =</span> <span class="fu">inv_logit_scaled</span>(true_a)) <span class="sc">%&gt;%</span></span>
<span id="cb1124-10"><a href="models-with-memory.html#cb1124-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">nopool_error   =</span> <span class="fu">abs</span>(p_nopool   <span class="sc">-</span> p_true),</span>
<span id="cb1124-11"><a href="models-with-memory.html#cb1124-11" aria-hidden="true" tabindex="-1"></a>         <span class="at">partpool_error =</span> <span class="fu">abs</span>(p_partpool <span class="sc">-</span> p_true))</span>
<span id="cb1124-12"><a href="models-with-memory.html#cb1124-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1124-13"><a href="models-with-memory.html#cb1124-13" aria-hidden="true" tabindex="-1"></a><span class="fu">slice_sample</span>(dsim2 <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">select</span>(pond, p_partpool, p_true,</span>
<span id="cb1124-14"><a href="models-with-memory.html#cb1124-14" aria-hidden="true" tabindex="-1"></a>                              p_nopool, nopool_error, </span>
<span id="cb1124-15"><a href="models-with-memory.html#cb1124-15" aria-hidden="true" tabindex="-1"></a>                              partpool_error), <span class="at">n=</span><span class="dv">10</span>)</span></code></pre></div>
<pre><code>## # A tibble: 10 × 6
##     pond p_partpool p_true p_nopool nopool_error partpool_error
##    &lt;int&gt;      &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt;        &lt;dbl&gt;          &lt;dbl&gt;
##  1    48      0.265  0.385    0.229      0.156           0.120 
##  2    30      0.879  0.869    0.9        0.0309          0.0100
##  3    38      0.771  0.805    0.76       0.0451          0.0338
##  4    47      0.929  0.895    0.943      0.0481          0.0348
##  5    52      0.832  0.880    0.829      0.0512          0.0479
##  6    12      0.545  0.559    0.4        0.159           0.0139
##  7    53      0.509  0.489    0.486      0.00344         0.0203
##  8    42      0.772  0.745    0.76       0.0154          0.0270
##  9    33      0.736  0.524    0.72       0.196           0.211 
## 10    18      0.880  0.959    0.9        0.0585          0.0789</code></pre>
<p>実際の値（青）も推定値（黒）も水槽内の個体数が多いほど真の確率に近づいている。また、推定値の方がほとんどの場合真の値に近くなっている。これは、縮合によってoverfittingが抑えられていることを示している。加えて、実際の値と推定値の違いは水槽内の個体数が多いほど小さくなっている。これは、サンプルサイズが小さいほど縮合が生じていることを示している。<br />
<img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-605-1.png" width="672" style="display: block; margin: auto;" /></p>
</div>
</div>
</div>
<div id="more-than-one-type-of-cluster" class="section level2 hasAnchor" number="13.3">
<h2><span class="header-section-number">13.3</span> More than one type of cluster<a href="models-with-memory.html#more-than-one-type-of-cluster" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Chapter11で用いたチンパンジーの実験データ<span class="citation">(<a href="#ref-Silk2005" role="doc-biblioref">Silk et al. 2005</a>)</span>を用いて、2つ以上のクラスターのあるデータを扱う。データ内には対象個体（<code>actor</code>）と実験日（<code>block</code>）の2つのクラスターが存在する。</p>
<p><span class="math display">\[
\begin{aligned}  
  L_{i} &amp;\sim Binomial(1,p_{i})\\
  logit(p_{i}) &amp;= \bar{\alpha} +  \beta_{treatment[i]}+z_{actor[i]}\sigma_{\alpha} + x_{block[i]}\sigma_{\gamma}\\
  \beta_{j} &amp;\sim Normal(0,0.5)\\
  \bar{\alpha}_{} &amp;\sim Normal(0,1.5)\\
  z_{j} &amp;\sim Normal(0,1)\\
  x_{j} &amp;\sim Normal(0,1)\\
  \sigma_{\alpha} &amp;\sim Exponential(1)\\
  \sigma_{\gamma} &amp;\sim Exponential(1)\\
\end{aligned}
\]</span>
<br /></p>
<div class="sourceCode" id="cb1126"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1126-1"><a href="models-with-memory.html#cb1126-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;chimpanzees&quot;</span>)</span>
<span id="cb1126-2"><a href="models-with-memory.html#cb1126-2" aria-hidden="true" tabindex="-1"></a>d2 <span class="ot">&lt;-</span> chimpanzees</span>
<span id="cb1126-3"><a href="models-with-memory.html#cb1126-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1126-4"><a href="models-with-memory.html#cb1126-4" aria-hidden="true" tabindex="-1"></a>d2 <span class="sc">%&gt;%</span> </span>
<span id="cb1126-5"><a href="models-with-memory.html#cb1126-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">treatment =</span> <span class="fu">factor</span>(<span class="dv">1</span> <span class="sc">+</span> prosoc_left <span class="sc">+</span> <span class="dv">2</span><span class="sc">*</span>condition),</span>
<span id="cb1126-6"><a href="models-with-memory.html#cb1126-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">block =</span> <span class="fu">factor</span>(block),</span>
<span id="cb1126-7"><a href="models-with-memory.html#cb1126-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">actor =</span> <span class="fu">factor</span>(actor)) <span class="ot">-&gt;</span> d2</span>
<span id="cb1126-8"><a href="models-with-memory.html#cb1126-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1126-9"><a href="models-with-memory.html#cb1126-9" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(d2)</span></code></pre></div>
<pre><code>##   actor recipient condition block trial prosoc_left chose_prosoc pulled_left
## 1     1        NA         0     1     2           0            1           0
## 2     1        NA         0     1     4           0            0           1
## 3     1        NA         0     1     6           1            0           0
## 4     1        NA         0     1     8           0            1           0
## 5     1        NA         0     1    10           1            1           1
## 6     1        NA         0     1    12           1            1           1
##   treatment
## 1         1
## 2         1
## 3         2
## 4         1
## 5         2
## 6         2</code></pre>
<p>それでは、モデルを回す。</p>
<div class="sourceCode" id="cb1128"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1128-1"><a href="models-with-memory.html#cb1128-1" aria-hidden="true" tabindex="-1"></a>b13<span class="fl">.4</span> <span class="ot">&lt;-</span> </span>
<span id="cb1128-2"><a href="models-with-memory.html#cb1128-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">brm</span>(<span class="at">data =</span> d2,</span>
<span id="cb1128-3"><a href="models-with-memory.html#cb1128-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> bernoulli,</span>
<span id="cb1128-4"><a href="models-with-memory.html#cb1128-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">bf</span>(pulled_left <span class="sc">~</span> a <span class="sc">+</span> b,</span>
<span id="cb1128-5"><a href="models-with-memory.html#cb1128-5" aria-hidden="true" tabindex="-1"></a>         a <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> (<span class="dv">1</span><span class="sc">|</span>actor) <span class="sc">+</span> (<span class="dv">1</span><span class="sc">|</span>block),</span>
<span id="cb1128-6"><a href="models-with-memory.html#cb1128-6" aria-hidden="true" tabindex="-1"></a>         b <span class="sc">~</span> <span class="dv">0</span> <span class="sc">+</span> treatment,</span>
<span id="cb1128-7"><a href="models-with-memory.html#cb1128-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">nl =</span> <span class="cn">TRUE</span>),</span>
<span id="cb1128-8"><a href="models-with-memory.html#cb1128-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">0.5</span>), <span class="at">nlpar =</span> b),</span>
<span id="cb1128-9"><a href="models-with-memory.html#cb1128-9" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">1.5</span>), <span class="at">class =</span> b, </span>
<span id="cb1128-10"><a href="models-with-memory.html#cb1128-10" aria-hidden="true" tabindex="-1"></a>                      <span class="at">coef =</span> Intercept, <span class="at">nlpar =</span> a),</span>
<span id="cb1128-11"><a href="models-with-memory.html#cb1128-11" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>), <span class="at">class =</span> sd, </span>
<span id="cb1128-12"><a href="models-with-memory.html#cb1128-12" aria-hidden="true" tabindex="-1"></a>                      <span class="at">group =</span> actor, <span class="at">nlpar =</span> a),</span>
<span id="cb1128-13"><a href="models-with-memory.html#cb1128-13" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>), <span class="at">class =</span> sd, </span>
<span id="cb1128-14"><a href="models-with-memory.html#cb1128-14" aria-hidden="true" tabindex="-1"></a>                      <span class="at">group =</span> block, <span class="at">nlpar =</span> a)),</span>
<span id="cb1128-15"><a href="models-with-memory.html#cb1128-15" aria-hidden="true" tabindex="-1"></a>      <span class="at">backend =</span> <span class="st">&quot;cmdstanr&quot;</span>,</span>
<span id="cb1128-16"><a href="models-with-memory.html#cb1128-16" aria-hidden="true" tabindex="-1"></a>      <span class="at">seed =</span> <span class="dv">13</span>, <span class="at">file =</span> <span class="st">&quot;output/Chapter13/b13.4&quot;</span></span>
<span id="cb1128-17"><a href="models-with-memory.html#cb1128-17" aria-hidden="true" tabindex="-1"></a>      )</span></code></pre></div>
<p>収束のチェックをする。問題なさそう。<br />
<img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-608-1.png" width="672" style="display: block; margin: auto;" /></p>
<p><img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-609-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>結果は以下の通り（表<a href="models-with-memory.html#tab:res-b13-4">13.5</a>）。</p>
<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:res-b13-4">表13.5: </span>b13.4の結果。
</caption>
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
Estimate
</th>
<th style="text-align:right;">
Est.Error
</th>
<th style="text-align:right;">
Q2.5
</th>
<th style="text-align:right;">
Q97.5
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
b_a_Intercept
</td>
<td style="text-align:right;">
0.60
</td>
<td style="text-align:right;">
0.73
</td>
<td style="text-align:right;">
-0.85
</td>
<td style="text-align:right;">
2.01
</td>
</tr>
<tr>
<td style="text-align:left;">
b_b_treatment1
</td>
<td style="text-align:right;">
-0.13
</td>
<td style="text-align:right;">
0.30
</td>
<td style="text-align:right;">
-0.71
</td>
<td style="text-align:right;">
0.46
</td>
</tr>
<tr>
<td style="text-align:left;">
b_b_treatment2
</td>
<td style="text-align:right;">
0.40
</td>
<td style="text-align:right;">
0.30
</td>
<td style="text-align:right;">
-0.17
</td>
<td style="text-align:right;">
0.98
</td>
</tr>
<tr>
<td style="text-align:left;">
b_b_treatment3
</td>
<td style="text-align:right;">
-0.47
</td>
<td style="text-align:right;">
0.31
</td>
<td style="text-align:right;">
-1.07
</td>
<td style="text-align:right;">
0.13
</td>
</tr>
<tr>
<td style="text-align:left;">
b_b_treatment4
</td>
<td style="text-align:right;">
0.29
</td>
<td style="text-align:right;">
0.29
</td>
<td style="text-align:right;">
-0.30
</td>
<td style="text-align:right;">
0.86
</td>
</tr>
<tr>
<td style="text-align:left;">
sd_actor__a_Intercept
</td>
<td style="text-align:right;">
2.00
</td>
<td style="text-align:right;">
0.66
</td>
<td style="text-align:right;">
1.09
</td>
<td style="text-align:right;">
3.56
</td>
</tr>
<tr>
<td style="text-align:left;">
sd_block__a_Intercept
</td>
<td style="text-align:right;">
0.20
</td>
<td style="text-align:right;">
0.17
</td>
<td style="text-align:right;">
0.01
</td>
<td style="text-align:right;">
0.65
</td>
</tr>
<tr>
<td style="text-align:left;">
r_actor__a[1,Intercept]
</td>
<td style="text-align:right;">
-0.96
</td>
<td style="text-align:right;">
0.72
</td>
<td style="text-align:right;">
-2.40
</td>
<td style="text-align:right;">
0.48
</td>
</tr>
<tr>
<td style="text-align:left;">
r_actor__a[2,Intercept]
</td>
<td style="text-align:right;">
4.05
</td>
<td style="text-align:right;">
1.32
</td>
<td style="text-align:right;">
1.97
</td>
<td style="text-align:right;">
7.15
</td>
</tr>
<tr>
<td style="text-align:left;">
r_actor__a[3,Intercept]
</td>
<td style="text-align:right;">
-1.26
</td>
<td style="text-align:right;">
0.73
</td>
<td style="text-align:right;">
-2.73
</td>
<td style="text-align:right;">
0.22
</td>
</tr>
</tbody>
</table>
<p><code>block</code>の標準偏差は小さいため、これを除いても影響は小さいと考えられる。</p>
<div class="sourceCode" id="cb1129"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1129-1"><a href="models-with-memory.html#cb1129-1" aria-hidden="true" tabindex="-1"></a>b13<span class="fl">.5</span> <span class="ot">&lt;-</span> </span>
<span id="cb1129-2"><a href="models-with-memory.html#cb1129-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">brm</span>(<span class="at">data =</span> d2,</span>
<span id="cb1129-3"><a href="models-with-memory.html#cb1129-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> bernoulli,</span>
<span id="cb1129-4"><a href="models-with-memory.html#cb1129-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">bf</span>(pulled_left <span class="sc">~</span> a <span class="sc">+</span> b,</span>
<span id="cb1129-5"><a href="models-with-memory.html#cb1129-5" aria-hidden="true" tabindex="-1"></a>         a <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> (<span class="dv">1</span><span class="sc">|</span>actor),</span>
<span id="cb1129-6"><a href="models-with-memory.html#cb1129-6" aria-hidden="true" tabindex="-1"></a>         b <span class="sc">~</span> <span class="dv">0</span> <span class="sc">+</span> treatment,</span>
<span id="cb1129-7"><a href="models-with-memory.html#cb1129-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">nl =</span> <span class="cn">TRUE</span>),</span>
<span id="cb1129-8"><a href="models-with-memory.html#cb1129-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">0.5</span>), <span class="at">nlpar =</span> b),</span>
<span id="cb1129-9"><a href="models-with-memory.html#cb1129-9" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">1.5</span>), <span class="at">class =</span> b, </span>
<span id="cb1129-10"><a href="models-with-memory.html#cb1129-10" aria-hidden="true" tabindex="-1"></a>                      <span class="at">coef =</span> Intercept, <span class="at">nlpar =</span> a),</span>
<span id="cb1129-11"><a href="models-with-memory.html#cb1129-11" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>), <span class="at">class =</span> sd, </span>
<span id="cb1129-12"><a href="models-with-memory.html#cb1129-12" aria-hidden="true" tabindex="-1"></a>                      <span class="at">group =</span> actor, <span class="at">nlpar =</span> a)),</span>
<span id="cb1129-13"><a href="models-with-memory.html#cb1129-13" aria-hidden="true" tabindex="-1"></a>      <span class="at">backend =</span> <span class="st">&quot;cmdstanr&quot;</span>,</span>
<span id="cb1129-14"><a href="models-with-memory.html#cb1129-14" aria-hidden="true" tabindex="-1"></a>      <span class="at">seed =</span> <span class="dv">13</span>, <span class="at">file =</span> <span class="st">&quot;output/Chapter13/b13.5&quot;</span></span>
<span id="cb1129-15"><a href="models-with-memory.html#cb1129-15" aria-hidden="true" tabindex="-1"></a>      )</span></code></pre></div>
<p>モデル比較をすると、b13.5の方宇賀PSISが小さい（表@ref{tab:comp-b13-4}）。このことも、<code>block</code>間でそこまで大きなばらつきがないことを示している。</p>
<div class="sourceCode" id="cb1130"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1130-1"><a href="models-with-memory.html#cb1130-1" aria-hidden="true" tabindex="-1"></a>b13<span class="fl">.4</span> <span class="ot">&lt;-</span> <span class="fu">add_criterion</span>(b13<span class="fl">.4</span>, <span class="st">&quot;loo&quot;</span>)</span>
<span id="cb1130-2"><a href="models-with-memory.html#cb1130-2" aria-hidden="true" tabindex="-1"></a>b13<span class="fl">.5</span> <span class="ot">&lt;-</span> <span class="fu">add_criterion</span>(b13<span class="fl">.5</span>, <span class="st">&quot;loo&quot;</span>)</span>
<span id="cb1130-3"><a href="models-with-memory.html#cb1130-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1130-4"><a href="models-with-memory.html#cb1130-4" aria-hidden="true" tabindex="-1"></a>r <span class="ot">&lt;-</span> <span class="fu">loo_compare</span>(b13<span class="fl">.4</span>, b13<span class="fl">.5</span>, <span class="at">criterion =</span> <span class="st">&quot;loo&quot;</span>)</span>
<span id="cb1130-5"><a href="models-with-memory.html#cb1130-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1130-6"><a href="models-with-memory.html#cb1130-6" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(r, <span class="at">simplify =</span> F) <span class="sc">%&gt;%</span> </span>
<span id="cb1130-7"><a href="models-with-memory.html#cb1130-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="at">digits =</span> <span class="dv">2</span>,</span>
<span id="cb1130-8"><a href="models-with-memory.html#cb1130-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">booktabs =</span> <span class="cn">TRUE</span>,</span>
<span id="cb1130-9"><a href="models-with-memory.html#cb1130-9" aria-hidden="true" tabindex="-1"></a>        <span class="at">caption =</span> <span class="st">&quot;b13.4とb13.5の比較。&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1130-10"><a href="models-with-memory.html#cb1130-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">latex_options =</span> <span class="fu">c</span>(<span class="st">&quot;striped&quot;</span>, <span class="st">&quot;hold_position&quot;</span>))</span></code></pre></div>
<pre><code>##       elpd_diff se_diff elpd_loo se_elpd_loo p_loo  se_p_loo looic  se_looic
## b13.5    0.0       0.0  -265.7      9.6         8.7    0.4    531.4   19.2  
## b13.4   -0.7       0.8  -266.4      9.7        10.8    0.6    532.8   19.4</code></pre>
<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:comp-b13-4">表13.6: </span>b13.4とb13.5の比較。
</caption>
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
elpd_diff
</th>
<th style="text-align:right;">
se_diff
</th>
<th style="text-align:right;">
elpd_loo
</th>
<th style="text-align:right;">
se_elpd_loo
</th>
<th style="text-align:right;">
p_loo
</th>
<th style="text-align:right;">
se_p_loo
</th>
<th style="text-align:right;">
looic
</th>
<th style="text-align:right;">
se_looic
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
b13.5
</td>
<td style="text-align:right;">
0.0
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;">
-265.71
</td>
<td style="text-align:right;">
9.61
</td>
<td style="text-align:right;">
8.66
</td>
<td style="text-align:right;">
0.44
</td>
<td style="text-align:right;">
531.41
</td>
<td style="text-align:right;">
19.21
</td>
</tr>
<tr>
<td style="text-align:left;">
b13.4
</td>
<td style="text-align:right;">
-0.7
</td>
<td style="text-align:right;">
0.79
</td>
<td style="text-align:right;">
-266.41
</td>
<td style="text-align:right;">
9.68
</td>
<td style="text-align:right;">
10.83
</td>
<td style="text-align:right;">
0.55
</td>
<td style="text-align:right;">
532.82
</td>
<td style="text-align:right;">
19.37
</td>
</tr>
</tbody>
</table>
<div id="even-more-clusters" class="section level3 hasAnchor" number="13.3.1">
<h3><span class="header-section-number">13.3.1</span> Even more clusters<a href="models-with-memory.html#even-more-clusters" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><code>treatment</code>もランダム効果に入れることができる。</p>
<div class="sourceCode" id="cb1132"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1132-1"><a href="models-with-memory.html#cb1132-1" aria-hidden="true" tabindex="-1"></a>b13<span class="fl">.6</span> <span class="ot">&lt;-</span> </span>
<span id="cb1132-2"><a href="models-with-memory.html#cb1132-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">brm</span>(<span class="at">data =</span> d2, </span>
<span id="cb1132-3"><a href="models-with-memory.html#cb1132-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> bernoulli,</span>
<span id="cb1132-4"><a href="models-with-memory.html#cb1132-4" aria-hidden="true" tabindex="-1"></a>      pulled_left <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> actor) <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> block) <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> treatment),</span>
<span id="cb1132-5"><a href="models-with-memory.html#cb1132-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">1.5</span>), <span class="at">class =</span> Intercept),</span>
<span id="cb1132-6"><a href="models-with-memory.html#cb1132-6" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>), <span class="at">class =</span> sd)),</span>
<span id="cb1132-7"><a href="models-with-memory.html#cb1132-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>, <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>,  </span>
<span id="cb1132-8"><a href="models-with-memory.html#cb1132-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">seed =</span> <span class="dv">13</span>,</span>
<span id="cb1132-9"><a href="models-with-memory.html#cb1132-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">backend =</span> <span class="st">&quot;cmdstanr&quot;</span>,</span>
<span id="cb1132-10"><a href="models-with-memory.html#cb1132-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">file =</span> <span class="st">&quot;output/Chapter13/b13.6&quot;</span>)</span></code></pre></div>
<p>固定効果と変量効果に入れた場合で、<code>treatment</code>の推定値は大きく変わらない（表<a href="models-with-memory.html#tab:b13-4vsb13-6">13.7</a>）。これは、各条件で十分にデータ数があるためである。b13.6で少しだけ縮合が起きている。</p>
<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:b13-4vsb13-6">表13.7: </span>b13.4とb14.6のtreatmentの値
</caption>
<thead>
<tr>
<th style="empty-cells: hide;border-bottom:hidden;" colspan="1">
</th>
<th style="border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="4">
<div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
b13.4
</div>
</th>
<th style="border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="4">
<div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
b13.6
</div>
</th>
</tr>
<tr>
<th style="text-align:left;">
par
</th>
<th style="text-align:right;">
Est_fixed
</th>
<th style="text-align:right;">
se_fixed
</th>
<th style="text-align:right;">
Q2.5_fixed
</th>
<th style="text-align:right;">
Q97.5_fixed
</th>
<th style="text-align:right;">
Est_random
</th>
<th style="text-align:right;">
se_random
</th>
<th style="text-align:right;">
Q2.5_random
</th>
<th style="text-align:right;">
Q97.5_random
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
b_treatment1
</td>
<td style="text-align:right;">
-0.1252342
</td>
<td style="text-align:right;">
0.2985188
</td>
<td style="text-align:right;">
-0.7130660
</td>
<td style="text-align:right;">
0.4626933
</td>
<td style="text-align:right;">
-0.1464338
</td>
<td style="text-align:right;">
0.4206498
</td>
<td style="text-align:right;">
-0.9350493
</td>
<td style="text-align:right;">
0.5975902
</td>
</tr>
<tr>
<td style="text-align:left;">
b_treatment2
</td>
<td style="text-align:right;">
0.4009403
</td>
<td style="text-align:right;">
0.2960419
</td>
<td style="text-align:right;">
-0.1682906
</td>
<td style="text-align:right;">
0.9831511
</td>
<td style="text-align:right;">
0.3490351
</td>
<td style="text-align:right;">
0.4238662
</td>
<td style="text-align:right;">
-0.3693319
</td>
<td style="text-align:right;">
1.1606370
</td>
</tr>
<tr>
<td style="text-align:left;">
b_treatment3
</td>
<td style="text-align:right;">
-0.4709128
</td>
<td style="text-align:right;">
0.3066623
</td>
<td style="text-align:right;">
-1.0746720
</td>
<td style="text-align:right;">
0.1270108
</td>
<td style="text-align:right;">
-0.4695689
</td>
<td style="text-align:right;">
0.4373799
</td>
<td style="text-align:right;">
-1.3439747
</td>
<td style="text-align:right;">
0.2151697
</td>
</tr>
<tr>
<td style="text-align:left;">
b_treatment4
</td>
<td style="text-align:right;">
0.2863133
</td>
<td style="text-align:right;">
0.2936503
</td>
<td style="text-align:right;">
-0.3017152
</td>
<td style="text-align:right;">
0.8585155
</td>
<td style="text-align:right;">
0.2414440
</td>
<td style="text-align:right;">
0.4149398
</td>
<td style="text-align:right;">
-0.4727484
</td>
<td style="text-align:right;">
1.0509438
</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="divergent-transitions-and-non-centered-priors" class="section level2 hasAnchor" number="13.4">
<h2><span class="header-section-number">13.4</span> Divergent transitions and non-centered priors<a href="models-with-memory.html#divergent-transitions-and-non-centered-priors" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>事後分布の傾きに急な部分があるとき、<code>divergent transition</code>が生じることがある。これは、階層モデルを扱うときによく生じる。これに対処する方法は大きく分けて2つある。</p>
<ol style="list-style-type: decimal">
<li>warmup期間でうまく調節が行われるようにする（i.e., <code>adapt_delta</code>の値を上げる）。<br />
</li>
<li>最パラメータ化を行う。</li>
</ol>
<div id="the-devils-funnel" class="section level3 hasAnchor" number="13.4.1">
<h3><span class="header-section-number">13.4.1</span> The Devil’s Funnel<a href="models-with-memory.html#the-devils-funnel" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>以下のモデルを考える。</p>
<p><span class="math display">\[
\begin{aligned}  
  v &amp;\sim Normal(0,3)\\
  x &amp;\sim Normal(0, exp(v))\\
\end{aligned}
\]</span></p>
<p>モデルを回してみると、非常に多くのdivergent transitionが生じる。</p>
<div class="sourceCode" id="cb1133"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1133-1"><a href="models-with-memory.html#cb1133-1" aria-hidden="true" tabindex="-1"></a><span class="co">#m13.7 &lt;- </span></span>
<span id="cb1133-2"><a href="models-with-memory.html#cb1133-2" aria-hidden="true" tabindex="-1"></a> <span class="co"># ulam(</span></span>
<span id="cb1133-3"><a href="models-with-memory.html#cb1133-3" aria-hidden="true" tabindex="-1"></a>  <span class="co">#  data = list(N = 1),</span></span>
<span id="cb1133-4"><a href="models-with-memory.html#cb1133-4" aria-hidden="true" tabindex="-1"></a>   <span class="co"># alist(</span></span>
<span id="cb1133-5"><a href="models-with-memory.html#cb1133-5" aria-hidden="true" tabindex="-1"></a>    <span class="co">#  v ~ normal(0, 3),</span></span>
<span id="cb1133-6"><a href="models-with-memory.html#cb1133-6" aria-hidden="true" tabindex="-1"></a>     <span class="co"># x ~ normal(0, exp(v))</span></span>
<span id="cb1133-7"><a href="models-with-memory.html#cb1133-7" aria-hidden="true" tabindex="-1"></a>    <span class="co">#), </span></span>
<span id="cb1133-8"><a href="models-with-memory.html#cb1133-8" aria-hidden="true" tabindex="-1"></a>    <span class="co">#chains = 4 </span></span>
<span id="cb1133-9"><a href="models-with-memory.html#cb1133-9" aria-hidden="true" tabindex="-1"></a>  <span class="co">#)</span></span>
<span id="cb1133-10"><a href="models-with-memory.html#cb1133-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1133-11"><a href="models-with-memory.html#cb1133-11" aria-hidden="true" tabindex="-1"></a>m13<span class="fl">.7</span> <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;output/Chapter13/m13.7.rds&quot;</span>)</span>
<span id="cb1133-12"><a href="models-with-memory.html#cb1133-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1133-13"><a href="models-with-memory.html#cb1133-13" aria-hidden="true" tabindex="-1"></a><span class="fu">precis</span>(m13<span class="fl">.7</span>)</span></code></pre></div>
<pre><code>##       mean         sd       5.5%      94.5%     n_eff    Rhat4
## v 2.318110   2.189705  -1.950641   5.800031  6.859522 1.429809
## x 8.048351 122.682505 -77.021070 158.026145 71.127011 1.032196</code></pre>
<p>xの分布は以下のようになる。かなり急であることが分かる。<br />
<img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-613-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>traceplotもうまく収束していないことを示している。</p>
<p>この例はNealの漏斗と呼ばれる。対数事後確率<span class="math inline">\(p(v,x) = p(x|v)*p(v)\)</span>を計算し、その上にMCMCサンプルも図示する。対数事後確率の高いところからうまくサンプリングできていないことが分かる。これは、zが小さいところではxの事後分布が0付近でかなり急になっているからである。<br />
<img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-615-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>これを解決するために、non-centered parametarazationという最パラメータ化を行う。この方法は、あるパラメータの分布が別のパラメータに強く依存しないようにすることである。non-centered parametarazationでは、標準化と逆のことを行っている。すなわち、下の式では<span class="math inline">\(z\)</span>が<span class="math inline">\(x\)</span>を標準化したものになるようにしている。<br />
<span class="math display">\[
\begin{aligned}  
  v &amp;\sim Normal(0,3)\\
  z &amp;\sim Normal(0,1)\\
  x &amp;= z\:exp(v)
\end{aligned}
\]</span>
<br /></p>
<p>最パラメータ後はvとzについて事後分布を得ることになるが、このとき対数事後分布に傾きが急な場所ができないため、うまくサンプリングができる。</p>
<div class="sourceCode" id="cb1135"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1135-1"><a href="models-with-memory.html#cb1135-1" aria-hidden="true" tabindex="-1"></a><span class="co">#m13.7nc &lt;- ulam(</span></span>
<span id="cb1135-2"><a href="models-with-memory.html#cb1135-2" aria-hidden="true" tabindex="-1"></a>  <span class="co">#alist(</span></span>
<span id="cb1135-3"><a href="models-with-memory.html#cb1135-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">#v ~ normal(0,3),</span></span>
<span id="cb1135-4"><a href="models-with-memory.html#cb1135-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">#z ~ normal(0,1),</span></span>
<span id="cb1135-5"><a href="models-with-memory.html#cb1135-5" aria-hidden="true" tabindex="-1"></a>    <span class="co">#gq&gt; real[1]:x&lt;&lt;- z*exp(v)</span></span>
<span id="cb1135-6"><a href="models-with-memory.html#cb1135-6" aria-hidden="true" tabindex="-1"></a>  <span class="co">#),</span></span>
<span id="cb1135-7"><a href="models-with-memory.html#cb1135-7" aria-hidden="true" tabindex="-1"></a>  <span class="co">#data = list(N=1), chains=4</span></span>
<span id="cb1135-8"><a href="models-with-memory.html#cb1135-8" aria-hidden="true" tabindex="-1"></a><span class="co">#)</span></span>
<span id="cb1135-9"><a href="models-with-memory.html#cb1135-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1135-10"><a href="models-with-memory.html#cb1135-10" aria-hidden="true" tabindex="-1"></a>m13<span class="fl">.7</span>nc <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="at">file=</span><span class="st">&quot;output/Chapter13/m13.7nc&quot;</span>)</span>
<span id="cb1135-11"><a href="models-with-memory.html#cb1135-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1135-12"><a href="models-with-memory.html#cb1135-12" aria-hidden="true" tabindex="-1"></a><span class="fu">precis</span>(m13<span class="fl">.7</span>nc)</span></code></pre></div>
<pre><code>##           mean           sd       5.5%     94.5%    n_eff     Rhat4
## v   0.04191068    3.1933725  -5.076669  5.278982 1329.498 1.0002242
## z   0.02140103    0.9948099  -1.582802  1.623487 1269.240 0.9991946
## x -27.78654239 2164.0742844 -28.304278 42.382686 1479.803 1.0000306</code></pre>
<p><img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-617-1.png" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="non-centered-chimpanzees" class="section level3 hasAnchor" number="13.4.2">
<h3><span class="header-section-number">13.4.2</span> Non-centered chimpanzees<a href="models-with-memory.html#non-centered-chimpanzees" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>もともとnon-centered parametarazationを行っていたモデルの有効サンプルサイズに問題はなさそう。
<img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-618-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>ところで、常に再パラメータ化を行った方がいいということではない。クラスター内でのばらつきが小さい場合や、クラスター内で各ユニットのデータ数が少ない場合には再パラメータ化が有効である。</p>
</div>
</div>
<div id="multilevel-posterior-predictions" class="section level2 hasAnchor" number="13.5">
<h2><span class="header-section-number">13.5</span> Multilevel posterior predictions<a href="models-with-memory.html#multilevel-posterior-predictions" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="posterior-prediction-for-same-clusters" class="section level3 hasAnchor" number="13.5.1">
<h3><span class="header-section-number">13.5.1</span> Posterior prediction for same clusters<a href="models-with-memory.html#posterior-prediction-for-same-clusters" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><code>chimp</code>の個体2の事後予測を描写する。</p>
<div class="sourceCode" id="cb1137"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1137-1"><a href="models-with-memory.html#cb1137-1" aria-hidden="true" tabindex="-1"></a>nd <span class="ot">&lt;-</span> d2 <span class="sc">%&gt;%</span> </span>
<span id="cb1137-2"><a href="models-with-memory.html#cb1137-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">distinct</span>(treatment) <span class="sc">%&gt;%</span> </span>
<span id="cb1137-3"><a href="models-with-memory.html#cb1137-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">actor=</span><span class="dv">2</span>, <span class="at">block=</span><span class="dv">1</span>)</span>
<span id="cb1137-4"><a href="models-with-memory.html#cb1137-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1137-5"><a href="models-with-memory.html#cb1137-5" aria-hidden="true" tabindex="-1"></a>labels <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;R/N&quot;</span>, <span class="st">&quot;L/N&quot;</span>, <span class="st">&quot;R/P&quot;</span>, <span class="st">&quot;L,P&quot;</span>)</span>
<span id="cb1137-6"><a href="models-with-memory.html#cb1137-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1137-7"><a href="models-with-memory.html#cb1137-7" aria-hidden="true" tabindex="-1"></a>fit13<span class="fl">.4</span> <span class="ot">&lt;-</span> <span class="fu">fitted</span>(b13<span class="fl">.4</span>, <span class="at">newdata =</span> nd) <span class="sc">%&gt;%</span> </span>
<span id="cb1137-8"><a href="models-with-memory.html#cb1137-8" aria-hidden="true" tabindex="-1"></a>           <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1137-9"><a href="models-with-memory.html#cb1137-9" aria-hidden="true" tabindex="-1"></a>           <span class="fu">bind_cols</span>(nd) <span class="sc">%&gt;%</span> </span>
<span id="cb1137-10"><a href="models-with-memory.html#cb1137-10" aria-hidden="true" tabindex="-1"></a>           <span class="fu">mutate</span>(<span class="at">treatment =</span> <span class="fu">factor</span>(treatment, <span class="at">labels =</span> labels))</span></code></pre></div>
<p>個体2の推定値は以下の通り（表<a href="models-with-memory.html#tab:b13-4-actor2">13.8</a>）。</p>
<div class="sourceCode" id="cb1138"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1138-1"><a href="models-with-memory.html#cb1138-1" aria-hidden="true" tabindex="-1"></a>fit13<span class="fl">.4</span> <span class="sc">%&gt;%</span> </span>
<span id="cb1138-2"><a href="models-with-memory.html#cb1138-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="at">booktabs =</span> <span class="cn">TRUE</span>, </span>
<span id="cb1138-3"><a href="models-with-memory.html#cb1138-3" aria-hidden="true" tabindex="-1"></a>        <span class="at">caption =</span> <span class="st">&quot;個体2の推定値&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1138-4"><a href="models-with-memory.html#cb1138-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">latex_options =</span> <span class="fu">c</span>(<span class="st">&quot;striped&quot;</span>,<span class="st">&quot;hold_position&quot;</span>))</span></code></pre></div>
<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:b13-4-actor2">表13.8: </span>個体2の推定値
</caption>
<thead>
<tr>
<th style="text-align:right;">
Estimate
</th>
<th style="text-align:right;">
Est.Error
</th>
<th style="text-align:right;">
Q2.5
</th>
<th style="text-align:right;">
Q97.5
</th>
<th style="text-align:left;">
treatment
</th>
<th style="text-align:right;">
actor
</th>
<th style="text-align:right;">
block
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
0.9786448
</td>
<td style="text-align:right;">
0.0203763
</td>
<td style="text-align:right;">
0.9243916
</td>
<td style="text-align:right;">
0.9993467
</td>
<td style="text-align:left;">
R/N
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
0.9871279
</td>
<td style="text-align:right;">
0.0128489
</td>
<td style="text-align:right;">
0.9521603
</td>
<td style="text-align:right;">
0.9995752
</td>
<td style="text-align:left;">
L/N
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
0.9705514
</td>
<td style="text-align:right;">
0.0274387
</td>
<td style="text-align:right;">
0.8965248
</td>
<td style="text-align:right;">
0.9990162
</td>
<td style="text-align:left;">
R/P
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
0.9856228
</td>
<td style="text-align:right;">
0.0140419
</td>
<td style="text-align:right;">
0.9469928
</td>
<td style="text-align:right;">
0.9995442
</td>
<td style="text-align:left;">
L,P
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
1
</td>
</tr>
</tbody>
</table>
<p>描写すると以下のようになる。<br />
<img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-620-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>続いて個体5について、<code>fitted()</code>を用いずに事後分布を描く。</p>
<div class="sourceCode" id="cb1139"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1139-1"><a href="models-with-memory.html#cb1139-1" aria-hidden="true" tabindex="-1"></a>post <span class="ot">&lt;-</span> <span class="fu">posterior_samples</span>(b13<span class="fl">.4</span>)</span>
<span id="cb1139-2"><a href="models-with-memory.html#cb1139-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1139-3"><a href="models-with-memory.html#cb1139-3" aria-hidden="true" tabindex="-1"></a>post <span class="sc">%&gt;%</span> </span>
<span id="cb1139-4"><a href="models-with-memory.html#cb1139-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">transmute</span>(<span class="at">actor_5 =</span> <span class="st">`</span><span class="at">r_actor__a[5,Intercept]</span><span class="st">`</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1139-5"><a href="models-with-memory.html#cb1139-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>actor_5))<span class="sc">+</span></span>
<span id="cb1139-6"><a href="models-with-memory.html#cb1139-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">size=</span><span class="dv">0</span>, <span class="at">fill=</span><span class="st">&quot;orange1&quot;</span>, <span class="at">color =</span> <span class="st">&quot;transparent&quot;</span>)<span class="sc">+</span></span>
<span id="cb1139-7"><a href="models-with-memory.html#cb1139-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">aspect.ratio=</span><span class="fl">0.8</span>)<span class="sc">+</span></span>
<span id="cb1139-8"><a href="models-with-memory.html#cb1139-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Chimp #5&#39;s density&quot;</span>)</span></code></pre></div>
<p><img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-621-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>個体5の推定値は以下の通り（表<a href="models-with-memory.html#tab:b13-4-actor5">13.9</a>）。</p>
<div class="sourceCode" id="cb1140"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1140-1"><a href="models-with-memory.html#cb1140-1" aria-hidden="true" tabindex="-1"></a>post <span class="sc">%&gt;%</span> </span>
<span id="cb1140-2"><a href="models-with-memory.html#cb1140-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(b_b_treatment1<span class="sc">:</span>b_b_treatment4) <span class="sc">%&gt;%</span> </span>
<span id="cb1140-3"><a href="models-with-memory.html#cb1140-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">fitted =</span> <span class="fu">inv_logit_scaled</span>(b_a_Intercept <span class="sc">+</span> value <span class="sc">+</span> <span class="st">`</span><span class="at">r_actor__a[1,Intercept]</span><span class="st">`</span> <span class="sc">+</span> <span class="st">`</span><span class="at">r_block__a[1,Intercept]</span><span class="st">`</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1140-4"><a href="models-with-memory.html#cb1140-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">treatment =</span> <span class="fu">factor</span>(<span class="fu">str_remove</span>(name, <span class="st">&quot;b_b_treatment&quot;</span>),</span>
<span id="cb1140-5"><a href="models-with-memory.html#cb1140-5" aria-hidden="true" tabindex="-1"></a>                            <span class="at">labels =</span> labels)) <span class="sc">%&gt;%</span> </span>
<span id="cb1140-6"><a href="models-with-memory.html#cb1140-6" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(name<span class="sc">:</span>treatment) <span class="sc">%&gt;%</span> </span>
<span id="cb1140-7"><a href="models-with-memory.html#cb1140-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(treatment) <span class="sc">%&gt;%</span> </span>
<span id="cb1140-8"><a href="models-with-memory.html#cb1140-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mean_qi</span>(fitted) <span class="ot">-&gt;</span> fit13<span class="fl">.4</span>_act5</span></code></pre></div>
<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:b13-4-actor5">表13.9: </span>個体5の推定値
</caption>
<thead>
<tr>
<th style="text-align:left;">
treatment
</th>
<th style="text-align:right;">
fitted
</th>
<th style="text-align:right;">
.lower
</th>
<th style="text-align:right;">
.upper
</th>
<th style="text-align:right;">
.width
</th>
<th style="text-align:left;">
.point
</th>
<th style="text-align:left;">
.interval
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
R/N
</td>
<td style="text-align:right;">
0.35
</td>
<td style="text-align:right;">
0.20
</td>
<td style="text-align:right;">
0.51
</td>
<td style="text-align:right;">
0.95
</td>
<td style="text-align:left;">
mean
</td>
<td style="text-align:left;">
qi
</td>
</tr>
<tr>
<td style="text-align:left;">
L/N
</td>
<td style="text-align:right;">
0.47
</td>
<td style="text-align:right;">
0.29
</td>
<td style="text-align:right;">
0.63
</td>
<td style="text-align:right;">
0.95
</td>
<td style="text-align:left;">
mean
</td>
<td style="text-align:left;">
qi
</td>
</tr>
<tr>
<td style="text-align:left;">
R/P
</td>
<td style="text-align:right;">
0.28
</td>
<td style="text-align:right;">
0.15
</td>
<td style="text-align:right;">
0.42
</td>
<td style="text-align:right;">
0.95
</td>
<td style="text-align:left;">
mean
</td>
<td style="text-align:left;">
qi
</td>
</tr>
<tr>
<td style="text-align:left;">
L,P
</td>
<td style="text-align:right;">
0.44
</td>
<td style="text-align:right;">
0.27
</td>
<td style="text-align:right;">
0.61
</td>
<td style="text-align:right;">
0.95
</td>
<td style="text-align:left;">
mean
</td>
<td style="text-align:left;">
qi
</td>
</tr>
</tbody>
</table>
<p>図示すると以下の通り。
<img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-623-1.png" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="posterior-prediction-for-new-clusters" class="section level3 hasAnchor" number="13.5.2">
<h3><span class="header-section-number">13.5.2</span> Posterior prediction for new clusters<a href="models-with-memory.html#posterior-prediction-for-new-clusters" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>現在の推定結果から新たなclusterについて予測をしたい。まず、平均的な個体（つまり、ランダム効果を0にしたとき）の推定値と80%信用区間は以下の通り（表<a href="models-with-memory.html#tab:b13-4-qi-new">13.10</a>）。</p>
<div class="sourceCode" id="cb1141"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1141-1"><a href="models-with-memory.html#cb1141-1" aria-hidden="true" tabindex="-1"></a>fit13<span class="fl">.4</span>_new_ave <span class="ot">&lt;-</span></span>
<span id="cb1141-2"><a href="models-with-memory.html#cb1141-2" aria-hidden="true" tabindex="-1"></a>  post <span class="sc">%&gt;%</span> </span>
<span id="cb1141-3"><a href="models-with-memory.html#cb1141-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(b_b_treatment1<span class="sc">:</span>b_b_treatment4) <span class="sc">%&gt;%</span> </span>
<span id="cb1141-4"><a href="models-with-memory.html#cb1141-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">fitted =</span> <span class="fu">inv_logit_scaled</span>(b_a_Intercept <span class="sc">+</span> value)) <span class="sc">%&gt;%</span> </span>
<span id="cb1141-5"><a href="models-with-memory.html#cb1141-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">treatment =</span> <span class="fu">factor</span>(<span class="fu">str_remove</span>(name, <span class="st">&quot;b_b_treatment&quot;</span>),</span>
<span id="cb1141-6"><a href="models-with-memory.html#cb1141-6" aria-hidden="true" tabindex="-1"></a>                            <span class="at">labels =</span> labels)) <span class="sc">%&gt;%</span> </span>
<span id="cb1141-7"><a href="models-with-memory.html#cb1141-7" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(name<span class="sc">:</span>treatment) <span class="sc">%&gt;%</span></span>
<span id="cb1141-8"><a href="models-with-memory.html#cb1141-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(treatment) <span class="sc">%&gt;%</span></span>
<span id="cb1141-9"><a href="models-with-memory.html#cb1141-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mean_qi</span>(fitted, <span class="at">.width =</span> .<span class="dv">8</span>)</span></code></pre></div>
<div class="sourceCode" id="cb1142"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1142-1"><a href="models-with-memory.html#cb1142-1" aria-hidden="true" tabindex="-1"></a>fit13<span class="fl">.4</span>_new_ave　<span class="sc">%&gt;%</span> </span>
<span id="cb1142-2"><a href="models-with-memory.html#cb1142-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="at">booktabs =</span> <span class="cn">TRUE</span>, </span>
<span id="cb1142-3"><a href="models-with-memory.html#cb1142-3" aria-hidden="true" tabindex="-1"></a>        <span class="at">digits=</span><span class="dv">2</span>,</span>
<span id="cb1142-4"><a href="models-with-memory.html#cb1142-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">caption =</span> <span class="st">&quot;平均的な個体&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1142-5"><a href="models-with-memory.html#cb1142-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">latex_options =</span> <span class="fu">c</span>(<span class="st">&quot;striped&quot;</span>,<span class="st">&quot;hold_position&quot;</span>))</span></code></pre></div>
<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:b13-4-qi-new">表13.10: </span>平均的な個体
</caption>
<thead>
<tr>
<th style="text-align:left;">
treatment
</th>
<th style="text-align:right;">
fitted
</th>
<th style="text-align:right;">
.lower
</th>
<th style="text-align:right;">
.upper
</th>
<th style="text-align:right;">
.width
</th>
<th style="text-align:left;">
.point
</th>
<th style="text-align:left;">
.interval
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
R/N
</td>
<td style="text-align:right;">
0.60
</td>
<td style="text-align:right;">
0.40
</td>
<td style="text-align:right;">
0.80
</td>
<td style="text-align:right;">
0.8
</td>
<td style="text-align:left;">
mean
</td>
<td style="text-align:left;">
qi
</td>
</tr>
<tr>
<td style="text-align:left;">
L/N
</td>
<td style="text-align:right;">
0.71
</td>
<td style="text-align:right;">
0.52
</td>
<td style="text-align:right;">
0.87
</td>
<td style="text-align:right;">
0.8
</td>
<td style="text-align:left;">
mean
</td>
<td style="text-align:left;">
qi
</td>
</tr>
<tr>
<td style="text-align:left;">
R/P
</td>
<td style="text-align:right;">
0.53
</td>
<td style="text-align:right;">
0.32
</td>
<td style="text-align:right;">
0.73
</td>
<td style="text-align:right;">
0.8
</td>
<td style="text-align:left;">
mean
</td>
<td style="text-align:left;">
qi
</td>
</tr>
<tr>
<td style="text-align:left;">
L,P
</td>
<td style="text-align:right;">
0.69
</td>
<td style="text-align:right;">
0.49
</td>
<td style="text-align:right;">
0.86
</td>
<td style="text-align:right;">
0.8
</td>
<td style="text-align:left;">
mean
</td>
<td style="text-align:left;">
qi
</td>
</tr>
</tbody>
</table>
<p><img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-625-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>続いて、シミュレーションを行ってランダム効果を考慮に入れた（個体間のばらつきを考慮に入れた）推定値と80%信用区間を図示すると、以下のようになる（表@ref(tab:res-b13.4-qi-sim)）。</p>
<div class="sourceCode" id="cb1143"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1143-1"><a href="models-with-memory.html#cb1143-1" aria-hidden="true" tabindex="-1"></a>fit13<span class="fl">.4</span>_new_sim <span class="ot">&lt;-</span></span>
<span id="cb1143-2"><a href="models-with-memory.html#cb1143-2" aria-hidden="true" tabindex="-1"></a>  post <span class="sc">%&gt;%</span> </span>
<span id="cb1143-3"><a href="models-with-memory.html#cb1143-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">a_sim =</span> <span class="fu">rnorm</span>(<span class="fu">n</span>(),<span class="at">mean=</span>b_a_Intercept, <span class="at">sd =</span> sd_actor__a_Intercept)) <span class="sc">%&gt;%</span> </span>
<span id="cb1143-4"><a href="models-with-memory.html#cb1143-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(b_b_treatment1<span class="sc">:</span>b_b_treatment4) <span class="sc">%&gt;%</span> </span>
<span id="cb1143-5"><a href="models-with-memory.html#cb1143-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">fitted =</span> <span class="fu">inv_logit_scaled</span>(a_sim <span class="sc">+</span> value)) <span class="sc">%&gt;%</span> </span>
<span id="cb1143-6"><a href="models-with-memory.html#cb1143-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">treatment =</span> <span class="fu">factor</span>(<span class="fu">str_remove</span>(name, <span class="st">&quot;b_b_treatment&quot;</span>),</span>
<span id="cb1143-7"><a href="models-with-memory.html#cb1143-7" aria-hidden="true" tabindex="-1"></a>                            <span class="at">labels =</span> labels)) <span class="sc">%&gt;%</span> </span>
<span id="cb1143-8"><a href="models-with-memory.html#cb1143-8" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(name<span class="sc">:</span>treatment) <span class="sc">%&gt;%</span></span>
<span id="cb1143-9"><a href="models-with-memory.html#cb1143-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(treatment) <span class="sc">%&gt;%</span></span>
<span id="cb1143-10"><a href="models-with-memory.html#cb1143-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mean_qi</span>(fitted, <span class="at">.width =</span> .<span class="dv">8</span>)</span></code></pre></div>
<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>
(#tab:res-b13.4-qi-sim)ランダム効果を考慮した個体
</caption>
<thead>
<tr>
<th style="text-align:left;">
treatment
</th>
<th style="text-align:right;">
fitted
</th>
<th style="text-align:right;">
.lower
</th>
<th style="text-align:right;">
.upper
</th>
<th style="text-align:right;">
.width
</th>
<th style="text-align:left;">
.point
</th>
<th style="text-align:left;">
.interval
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
R/N
</td>
<td style="text-align:right;">
0.57
</td>
<td style="text-align:right;">
0.10
</td>
<td style="text-align:right;">
0.96
</td>
<td style="text-align:right;">
0.8
</td>
<td style="text-align:left;">
mean
</td>
<td style="text-align:left;">
qi
</td>
</tr>
<tr>
<td style="text-align:left;">
L/N
</td>
<td style="text-align:right;">
0.64
</td>
<td style="text-align:right;">
0.15
</td>
<td style="text-align:right;">
0.98
</td>
<td style="text-align:right;">
0.8
</td>
<td style="text-align:left;">
mean
</td>
<td style="text-align:left;">
qi
</td>
</tr>
<tr>
<td style="text-align:left;">
R/P
</td>
<td style="text-align:right;">
0.52
</td>
<td style="text-align:right;">
0.07
</td>
<td style="text-align:right;">
0.94
</td>
<td style="text-align:right;">
0.8
</td>
<td style="text-align:left;">
mean
</td>
<td style="text-align:left;">
qi
</td>
</tr>
<tr>
<td style="text-align:left;">
L,P
</td>
<td style="text-align:right;">
0.63
</td>
<td style="text-align:right;">
0.14
</td>
<td style="text-align:right;">
0.97
</td>
<td style="text-align:right;">
0.8
</td>
<td style="text-align:left;">
mean
</td>
<td style="text-align:left;">
qi
</td>
</tr>
</tbody>
</table>
<p><img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-627-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>最後に、新たに100個体についてデータを取得した際の推定値をシミュレートする。</p>
<div class="sourceCode" id="cb1144"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1144-1"><a href="models-with-memory.html#cb1144-1" aria-hidden="true" tabindex="-1"></a>nd <span class="ot">&lt;-</span> <span class="fu">distinct</span>(d2, treatment) <span class="sc">%&gt;%</span> </span>
<span id="cb1144-2"><a href="models-with-memory.html#cb1144-2" aria-hidden="true" tabindex="-1"></a>      tidyr<span class="sc">::</span><span class="fu">expand</span>(<span class="at">actor =</span> <span class="fu">str_c</span>(<span class="st">&quot;new&quot;</span>,<span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>),</span>
<span id="cb1144-3"><a href="models-with-memory.html#cb1144-3" aria-hidden="true" tabindex="-1"></a>             treatment) <span class="sc">%&gt;%</span> </span>
<span id="cb1144-4"><a href="models-with-memory.html#cb1144-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">row =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">n</span>())</span>
<span id="cb1144-5"><a href="models-with-memory.html#cb1144-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1144-6"><a href="models-with-memory.html#cb1144-6" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">13</span>)</span>
<span id="cb1144-7"><a href="models-with-memory.html#cb1144-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1144-8"><a href="models-with-memory.html#cb1144-8" aria-hidden="true" tabindex="-1"></a>fit13<span class="fl">.4</span>_new_100 <span class="ot">&lt;-</span> </span>
<span id="cb1144-9"><a href="models-with-memory.html#cb1144-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fitted</span>(b13<span class="fl">.4</span>,</span>
<span id="cb1144-10"><a href="models-with-memory.html#cb1144-10" aria-hidden="true" tabindex="-1"></a>         <span class="at">newdata=</span>nd,</span>
<span id="cb1144-11"><a href="models-with-memory.html#cb1144-11" aria-hidden="true" tabindex="-1"></a>         <span class="at">allow_new_levels =</span><span class="cn">TRUE</span>,</span>
<span id="cb1144-12"><a href="models-with-memory.html#cb1144-12" aria-hidden="true" tabindex="-1"></a>         <span class="at">sample_new_levels =</span> <span class="st">&quot;gaussian&quot;</span>,</span>
<span id="cb1144-13"><a href="models-with-memory.html#cb1144-13" aria-hidden="true" tabindex="-1"></a>         <span class="at">summary =</span>F,</span>
<span id="cb1144-14"><a href="models-with-memory.html#cb1144-14" aria-hidden="true" tabindex="-1"></a>         <span class="at">nsamples=</span><span class="dv">100</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1144-15"><a href="models-with-memory.html#cb1144-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>()</span></code></pre></div>
<div class="sourceCode" id="cb1145"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1145-1"><a href="models-with-memory.html#cb1145-1" aria-hidden="true" tabindex="-1"></a>p7 <span class="ot">&lt;-</span> fit13<span class="fl">.4</span>_new_100 <span class="sc">%&gt;%</span> </span>
<span id="cb1145-2"><a href="models-with-memory.html#cb1145-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_names</span>(<span class="fu">pull</span>(nd,row)) <span class="sc">%&gt;%</span> </span>
<span id="cb1145-3"><a href="models-with-memory.html#cb1145-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">iter =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">n</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb1145-4"><a href="models-with-memory.html#cb1145-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span>iter,<span class="at">names_to=</span><span class="st">&quot;row&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1145-5"><a href="models-with-memory.html#cb1145-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">row=</span><span class="fu">as.double</span>(row)) <span class="sc">%&gt;%</span> </span>
<span id="cb1145-6"><a href="models-with-memory.html#cb1145-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(nd, <span class="at">by=</span><span class="st">&quot;row&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1145-7"><a href="models-with-memory.html#cb1145-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">actor_n =</span> <span class="fu">str_remove</span>(actor, <span class="st">&quot;new&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">as.double</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb1145-8"><a href="models-with-memory.html#cb1145-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(actor_n <span class="sc">==</span> iter) <span class="sc">%&gt;%</span> </span>
<span id="cb1145-9"><a href="models-with-memory.html#cb1145-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">treatment =</span> <span class="fu">factor</span>(treatment, <span class="at">labels =</span> labels)) <span class="sc">%&gt;%</span> </span>
<span id="cb1145-10"><a href="models-with-memory.html#cb1145-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> treatment, <span class="at">y =</span> value, <span class="at">group =</span> actor)) <span class="sc">+</span></span>
<span id="cb1145-11"><a href="models-with-memory.html#cb1145-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>, <span class="at">color =</span> <span class="st">&quot;navy&quot;</span>) <span class="sc">+</span></span>
<span id="cb1145-12"><a href="models-with-memory.html#cb1145-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;100 simulated actors&quot;</span>) <span class="sc">+</span></span>
<span id="cb1145-13"><a href="models-with-memory.html#cb1145-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">14</span>, <span class="at">hjust =</span> .<span class="dv">5</span>),</span>
<span id="cb1145-14"><a href="models-with-memory.html#cb1145-14" aria-hidden="true" tabindex="-1"></a>        <span class="at">aspect.ratio =</span> <span class="fl">0.8</span>)</span>
<span id="cb1145-15"><a href="models-with-memory.html#cb1145-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1145-16"><a href="models-with-memory.html#cb1145-16" aria-hidden="true" tabindex="-1"></a>p5<span class="sc">|</span>p6<span class="sc">|</span>p7</span></code></pre></div>
<p><img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-629-1.png" width="672" style="display: block; margin: auto;" /></p>
</div>
</div>
<div id="post-stratification" class="section level2 hasAnchor" number="13.6">
<h2><span class="header-section-number">13.6</span> Post stratification<a href="models-with-memory.html#post-stratification" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>新たなクラスターに関する予測をする他の方法としては、post stratificationがある。例えば、それぞれのカテゴリー<span class="math inline">\(i\)</span>について推定値<span class="math inline">\(p_{i}\)</span>が推定されたとき、それぞれのカテゴリーのデータ数に基づいて算出した以下の式を用いる。</p>
<p><span class="math display">\[
\frac{\sum_{i} N_{i}p_{i}}{\sum_{i} N_{i}}
\]</span></p>
<div id="meet-the-data" class="section level3 hasAnchor" number="13.6.1">
<h3><span class="header-section-number">13.6.1</span> Meet the data<a href="models-with-memory.html#meet-the-data" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>以下では、Monica Alexanderの<a href="https://www.monicaalexander.com/posts/2019-08-07-mrp/">ブログ</a>の例を用いる。</p>
<div class="sourceCode" id="cb1146"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1146-1"><a href="models-with-memory.html#cb1146-1" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">&quot;data/mrp_data_ch13.rds&quot;</span>)</span>
<span id="cb1146-2"><a href="models-with-memory.html#cb1146-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1146-3"><a href="models-with-memory.html#cb1146-3" aria-hidden="true" tabindex="-1"></a>d <span class="sc">%&gt;%</span> </span>
<span id="cb1146-4"><a href="models-with-memory.html#cb1146-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">10</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1146-5"><a href="models-with-memory.html#cb1146-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="at">booktabs =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1146-6"><a href="models-with-memory.html#cb1146-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">latex_options =</span> <span class="fu">c</span>(<span class="st">&quot;striped&quot;</span>,<span class="st">&quot;hold_position&quot;</span>))</span></code></pre></div>
<table class="table" style="margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:right;">
kept_name
</th>
<th style="text-align:left;">
state_name
</th>
<th style="text-align:left;">
age_group
</th>
<th style="text-align:left;">
decade_married
</th>
<th style="text-align:left;">
educ_group
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
0
</td>
<td style="text-align:left;">
ohio
</td>
<td style="text-align:left;">
50
</td>
<td style="text-align:left;">
1979
</td>
<td style="text-align:left;">
&gt;BA
</td>
</tr>
<tr>
<td style="text-align:right;">
0
</td>
<td style="text-align:left;">
virginia
</td>
<td style="text-align:left;">
35
</td>
<td style="text-align:left;">
1999
</td>
<td style="text-align:left;">
&gt;BA
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
new york
</td>
<td style="text-align:left;">
35
</td>
<td style="text-align:left;">
2009
</td>
<td style="text-align:left;">
&gt;BA
</td>
</tr>
<tr>
<td style="text-align:right;">
0
</td>
<td style="text-align:left;">
rhode island
</td>
<td style="text-align:left;">
55
</td>
<td style="text-align:left;">
1999
</td>
<td style="text-align:left;">
&gt;BA
</td>
</tr>
<tr>
<td style="text-align:right;">
0
</td>
<td style="text-align:left;">
illinois
</td>
<td style="text-align:left;">
35
</td>
<td style="text-align:left;">
2009
</td>
<td style="text-align:left;">
&gt;BA
</td>
</tr>
<tr>
<td style="text-align:right;">
0
</td>
<td style="text-align:left;">
north carolina
</td>
<td style="text-align:left;">
25
</td>
<td style="text-align:left;">
2009
</td>
<td style="text-align:left;">
&gt;BA
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
iowa
</td>
<td style="text-align:left;">
35
</td>
<td style="text-align:left;">
1999
</td>
<td style="text-align:left;">
&gt;BA
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
texas
</td>
<td style="text-align:left;">
35
</td>
<td style="text-align:left;">
2009
</td>
<td style="text-align:left;">
&gt;BA
</td>
</tr>
<tr>
<td style="text-align:right;">
0
</td>
<td style="text-align:left;">
south dakota
</td>
<td style="text-align:left;">
35
</td>
<td style="text-align:left;">
1999
</td>
<td style="text-align:left;">
&gt;BA
</td>
</tr>
<tr>
<td style="text-align:right;">
0
</td>
<td style="text-align:left;">
texas
</td>
<td style="text-align:left;">
35
</td>
<td style="text-align:left;">
2009
</td>
<td style="text-align:left;">
&gt;BA
</td>
</tr>
</tbody>
</table>
<p>データ<code>d</code>は、女性が結婚後に姓を変更したかについてのデータ。変数の説明は以下の通り。<br />
- <code>kept_name</code> 回答、1 = “yes”, 0 = “no”。<br />
- <code>age_group</code> 25歳から75歳まで、25 = [25,30), 30 = [30,40)…。<br />
- <code>decade_married</code> 1979年から2019年まで、1979 = [1979,1989), 1989 =[1989,1999), …。<br />
- <code>educ_group</code> &lt;BA = no bachelor’s degree, BA = bachelor’s degree, &gt;BA = above bachelor’s degree。<br />
- <code>state_name</code> 州の名前。</p>
<p>データ<code>cell_counts</code>はUS censusによるデータで、<code>n</code>は各カテゴリーに該当する人数を表している。一部のカテゴリーについては十分なサンプル数があるが、それ以外についてはサンプル数が小さいものもあり、ばらつきが大きい。よって、新たなかてごりーについて予測を行う場合には、 個のばらつきを考慮する必要がある。</p>
<div class="sourceCode" id="cb1147"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1147-1"><a href="models-with-memory.html#cb1147-1" aria-hidden="true" tabindex="-1"></a>cell_counts <span class="sc">%&gt;%</span> </span>
<span id="cb1147-2"><a href="models-with-memory.html#cb1147-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> n)) <span class="sc">+</span></span>
<span id="cb1147-3"><a href="models-with-memory.html#cb1147-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">binwidth =</span> <span class="dv">2000</span>, <span class="at">fill =</span> <span class="st">&quot;blue&quot;</span>) <span class="sc">+</span></span>
<span id="cb1147-4"><a href="models-with-memory.html#cb1147-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">3</span> <span class="sc">*</span> <span class="dv">100000</span>, <span class="at">labels =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="st">&quot;100K&quot;</span>, <span class="st">&quot;200K&quot;</span>, <span class="st">&quot;300K&quot;</span>))<span class="sc">+</span></span>
<span id="cb1147-5"><a href="models-with-memory.html#cb1147-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">aspect.ratio=</span><span class="dv">1</span>)</span></code></pre></div>
<p><img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-631-1.png" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="settle-the-mr-part-of-mrp." class="section level3 hasAnchor" number="13.6.2">
<h3><span class="header-section-number">13.6.2</span> Settle the MR part of MRP.<a href="models-with-memory.html#settle-the-mr-part-of-mrp." class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>まずは、データを用いてモデリングを行う。全体の平均の事前分布としては、<span class="math inline">\(Normal(-1,1)\)</span>を用いる。これは、結婚後には姓を変えると答える人の方が多いと考えられるため。</p>
<div class="sourceCode" id="cb1148"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1148-1"><a href="models-with-memory.html#cb1148-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">n =</span> <span class="fu">rnorm</span>(<span class="fl">1e6</span>, <span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1148-2"><a href="models-with-memory.html#cb1148-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">p =</span> <span class="fu">inv_logit_scaled</span>(n)) <span class="sc">%&gt;%</span> </span>
<span id="cb1148-3"><a href="models-with-memory.html#cb1148-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> p)) <span class="sc">+</span></span>
<span id="cb1148-4"><a href="models-with-memory.html#cb1148-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">fill =</span> <span class="st">&quot;blue&quot;</span>, <span class="at">binwidth =</span> .<span class="dv">02</span>) <span class="sc">+</span></span>
<span id="cb1148-5"><a href="models-with-memory.html#cb1148-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> <span class="cn">NULL</span>)<span class="sc">+</span></span>
<span id="cb1148-6"><a href="models-with-memory.html#cb1148-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">aspect.ratio=</span><span class="fl">0.7</span>)</span></code></pre></div>
<p><img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-632-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>それでは、モデリングを行う。</p>
<div class="sourceCode" id="cb1149"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1149-1"><a href="models-with-memory.html#cb1149-1" aria-hidden="true" tabindex="-1"></a>b13<span class="fl">.7</span> <span class="ot">&lt;-</span> </span>
<span id="cb1149-2"><a href="models-with-memory.html#cb1149-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">brm</span>(<span class="at">data =</span>d,</span>
<span id="cb1149-3"><a href="models-with-memory.html#cb1149-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> bernoulli,</span>
<span id="cb1149-4"><a href="models-with-memory.html#cb1149-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">formula =</span> kept_name <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> (<span class="dv">1</span><span class="sc">|</span>age_group) <span class="sc">+</span> </span>
<span id="cb1149-5"><a href="models-with-memory.html#cb1149-5" aria-hidden="true" tabindex="-1"></a>        (<span class="dv">1</span><span class="sc">|</span>decade_married) <span class="sc">+</span> (<span class="dv">1</span><span class="sc">|</span>educ_group) <span class="sc">+</span> (<span class="dv">1</span><span class="sc">|</span>state_name),</span>
<span id="cb1149-6"><a href="models-with-memory.html#cb1149-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>), <span class="at">class =</span> Intercept),</span>
<span id="cb1149-7"><a href="models-with-memory.html#cb1149-7" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>), <span class="at">class =</span> sd)),</span>
<span id="cb1149-8"><a href="models-with-memory.html#cb1149-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">seed =</span> <span class="dv">13</span>, <span class="at">control =</span> <span class="fu">list</span>(<span class="at">adapt_delta =</span>.<span class="dv">98</span>),</span>
<span id="cb1149-9"><a href="models-with-memory.html#cb1149-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">backend =</span> <span class="st">&quot;cmdstanr&quot;</span>,</span>
<span id="cb1149-10"><a href="models-with-memory.html#cb1149-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">file =</span> <span class="st">&quot;output/Chapter13/b13.7&quot;</span>)</span></code></pre></div>
結果は以下の通り（表@ref{tab:res-b13-7}）
<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:res-b13-7">表13.11: </span>b13.7の結果
</caption>
<thead>
<tr>
<th style="text-align:left;">
par
</th>
<th style="text-align:right;">
Estimate
</th>
<th style="text-align:right;">
Est.Error
</th>
<th style="text-align:right;">
Q2.5
</th>
<th style="text-align:right;">
Q97.5
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
b_Intercept
</td>
<td style="text-align:right;">
-0.72
</td>
<td style="text-align:right;">
0.62
</td>
<td style="text-align:right;">
-1.97
</td>
<td style="text-align:right;">
0.50
</td>
</tr>
<tr>
<td style="text-align:left;">
sd_age_group__Intercept
</td>
<td style="text-align:right;">
1.16
</td>
<td style="text-align:right;">
0.29
</td>
<td style="text-align:right;">
0.73
</td>
<td style="text-align:right;">
1.86
</td>
</tr>
<tr>
<td style="text-align:left;">
sd_decade_married__Intercept
</td>
<td style="text-align:right;">
1.01
</td>
<td style="text-align:right;">
0.40
</td>
<td style="text-align:right;">
0.50
</td>
<td style="text-align:right;">
2.05
</td>
</tr>
<tr>
<td style="text-align:left;">
sd_educ_group__Intercept
</td>
<td style="text-align:right;">
0.92
</td>
<td style="text-align:right;">
0.48
</td>
<td style="text-align:right;">
0.35
</td>
<td style="text-align:right;">
2.22
</td>
</tr>
<tr>
<td style="text-align:left;">
sd_state_name__Intercept
</td>
<td style="text-align:right;">
0.25
</td>
<td style="text-align:right;">
0.06
</td>
<td style="text-align:right;">
0.14
</td>
<td style="text-align:right;">
0.38
</td>
</tr>
</tbody>
</table>
<p>推定値の90%信用区間は以下の通り。<br />
<img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-634-1.png" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="post-stratify-to-put-the-p-in-mrp." class="section level3 hasAnchor" number="13.6.3">
<h3><span class="header-section-number">13.6.3</span> Post-stratify to put the P in MRP.<a href="models-with-memory.html#post-stratify-to-put-the-p-in-mrp." class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>ここでは、<code>age_group</code>と<code>state</code>のみに焦点を当てる。以下では、3つの推定方法による結果を比較する。</p>
<div id="estimate-by-age-group" class="section level4 hasAnchor" number="13.6.3.1">
<h4><span class="header-section-number">13.6.3.1</span> Estimate by age group<a href="models-with-memory.html#estimate-by-age-group" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>まずは、生データの姓を変更した女性の割合を年齢層ごとに図示する。
<img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-635-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>続いて、階層モデルの推定結果を図示する。<br />
<img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-636-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>最後に、post-stratificationによる推定結果を図示する。<br />
まずは、<code>cell_counts</code>データの各年齢カテゴリーの全体に占める割合を算出し、モデルの結果をもとにそれぞれのカテゴリーにおける事後予測分布を算出する。</p>
<div class="sourceCode" id="cb1150"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1150-1"><a href="models-with-memory.html#cb1150-1" aria-hidden="true" tabindex="-1"></a>age_prop <span class="ot">&lt;-</span>  </span>
<span id="cb1150-2"><a href="models-with-memory.html#cb1150-2" aria-hidden="true" tabindex="-1"></a>  cell_counts <span class="sc">%&gt;%</span> </span>
<span id="cb1150-3"><a href="models-with-memory.html#cb1150-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(age_group) <span class="sc">%&gt;%</span> </span>
<span id="cb1150-4"><a href="models-with-memory.html#cb1150-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prop =</span> n<span class="sc">/</span><span class="fu">sum</span>(n)) <span class="sc">%&gt;%</span> </span>
<span id="cb1150-5"><a href="models-with-memory.html#cb1150-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb1150-6"><a href="models-with-memory.html#cb1150-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1150-7"><a href="models-with-memory.html#cb1150-7" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">add_predicted_draws</span>(b13<span class="fl">.7</span>,</span>
<span id="cb1150-8"><a href="models-with-memory.html#cb1150-8" aria-hidden="true" tabindex="-1"></a>                    <span class="at">newdata =</span> age_prop <span class="sc">%&gt;%</span> </span>
<span id="cb1150-9"><a href="models-with-memory.html#cb1150-9" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">filter</span>(<span class="fu">between</span>(age_group,<span class="dv">20</span>,<span class="dv">80</span>),</span>
<span id="cb1150-10"><a href="models-with-memory.html#cb1150-10" aria-hidden="true" tabindex="-1"></a>                             decade_married <span class="sc">&gt;</span><span class="dv">1969</span>),</span>
<span id="cb1150-11"><a href="models-with-memory.html#cb1150-11" aria-hidden="true" tabindex="-1"></a>                    <span class="at">allow_new_levels =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p>この結果を用い、以下の数式に基づき各カテゴリのデータ数に応じて重みづけを行う。<br />
<span class="math display">\[
\frac{\sum_{i} N_{i}p_{i}}{\sum_{i} N_{i}}
\]</span></p>
<div class="sourceCode" id="cb1151"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1151-1"><a href="models-with-memory.html#cb1151-1" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> </span>
<span id="cb1151-2"><a href="models-with-memory.html#cb1151-2" aria-hidden="true" tabindex="-1"></a>  p <span class="sc">%&gt;%</span> </span>
<span id="cb1151-3"><a href="models-with-memory.html#cb1151-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(age_group, .draw) <span class="sc">%&gt;%</span> </span>
<span id="cb1151-4"><a href="models-with-memory.html#cb1151-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">kept_name_predict =</span> <span class="fu">sum</span>(.prediction<span class="sc">*</span>prop)) <span class="sc">%&gt;%</span> </span>
<span id="cb1151-5"><a href="models-with-memory.html#cb1151-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(age_group) <span class="sc">%&gt;%</span> </span>
<span id="cb1151-6"><a href="models-with-memory.html#cb1151-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mean_qi</span>(kept_name_predict)</span></code></pre></div>
<p>全ての結果を図示すると以下の通り。
<img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-639-1.png" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="estimate-by-us-state." class="section level4 hasAnchor" number="13.6.3.2">
<h4><span class="header-section-number">13.6.3.2</span> Estimate by US state.<a href="models-with-memory.html#estimate-by-us-state." class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>続いて、州ごとの予測結果を図示する。
<img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-640-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>続いて、階層レベルモデルの結果を図示する。<br />
<img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-641-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>最後に、post-stratificationによる推定結果を図示する。</p>
<div class="sourceCode" id="cb1152"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1152-1"><a href="models-with-memory.html#cb1152-1" aria-hidden="true" tabindex="-1"></a>state_prop <span class="ot">&lt;-</span> </span>
<span id="cb1152-2"><a href="models-with-memory.html#cb1152-2" aria-hidden="true" tabindex="-1"></a>  cell_counts <span class="sc">%&gt;%</span> </span>
<span id="cb1152-3"><a href="models-with-memory.html#cb1152-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(state_name) <span class="sc">%&gt;%</span> </span>
<span id="cb1152-4"><a href="models-with-memory.html#cb1152-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prop=</span>n<span class="sc">/</span><span class="fu">sum</span>(n))</span>
<span id="cb1152-5"><a href="models-with-memory.html#cb1152-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1152-6"><a href="models-with-memory.html#cb1152-6" aria-hidden="true" tabindex="-1"></a><span class="fu">add_predicted_draws</span>(b13<span class="fl">.7</span>,</span>
<span id="cb1152-7"><a href="models-with-memory.html#cb1152-7" aria-hidden="true" tabindex="-1"></a>                    <span class="at">newdata =</span> state_prop <span class="sc">%&gt;%</span> </span>
<span id="cb1152-8"><a href="models-with-memory.html#cb1152-8" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">filter</span>(<span class="fu">between</span>(age_group,<span class="dv">20</span>,<span class="dv">80</span>),</span>
<span id="cb1152-9"><a href="models-with-memory.html#cb1152-9" aria-hidden="true" tabindex="-1"></a>                             decade_married <span class="sc">&gt;</span> <span class="dv">1969</span>),</span>
<span id="cb1152-10"><a href="models-with-memory.html#cb1152-10" aria-hidden="true" tabindex="-1"></a>                    <span class="at">allow_new_levels =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb1152-11"><a href="models-with-memory.html#cb1152-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(state_name, .draw) <span class="sc">%&gt;%</span> </span>
<span id="cb1152-12"><a href="models-with-memory.html#cb1152-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">kept_name_predict =</span> <span class="fu">sum</span>(.prediction<span class="sc">*</span>prop)) <span class="sc">%&gt;%</span> </span>
<span id="cb1152-13"><a href="models-with-memory.html#cb1152-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(state_name) <span class="sc">%&gt;%</span> </span>
<span id="cb1152-14"><a href="models-with-memory.html#cb1152-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mean_qi</span>(kept_name_predict) <span class="ot">-&gt;</span> pp</span></code></pre></div>
<p>全部を図示すると以下の通り。<br />
<span class="math inline">\(\sigma_{state}\)</span>の推定値は小さかったので、縮合によってモデルによる推定値のばらつきが小さくなっていることが分かる。
<img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-643-1.png" width="672" style="display: block; margin: auto;" /></p>
</div>
</div>
</div>
<div id="practice-10" class="section level2 hasAnchor" number="13.7">
<h2><span class="header-section-number">13.7</span> Practice<a href="models-with-memory.html#practice-10" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="m1-7" class="section level3 hasAnchor" number="13.7.1">
<h3><span class="header-section-number">13.7.1</span> 13M1<a href="models-with-memory.html#m1-7" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<blockquote>
<p>Revisit the Reed frog survival data, <code>data(reedfrogs)</code>, and add the predation and size treatment variables to the varying intercepts model. Consider models with either main effect alone, both main effects, as well as a model including both and their interaction. Instead of focusing on inferences about these two predictor variables, focus on the inferred variation across tanks. Explain why it changes as it does across models.</p>
</blockquote>
<p><code>reedfrogs</code>データで、<code>pred</code>（捕食者がいたか）と<code>size</code>（オタマジャクシの大きさ(big or small)）も説明変数に加える。どちらか一方を加えたモデル、両方を加えたモデル、交互作用も含めたモデルの計4つのモデルを比較する。</p>
<div class="sourceCode" id="cb1153"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1153-1"><a href="models-with-memory.html#cb1153-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(reedfrogs)</span>
<span id="cb1153-2"><a href="models-with-memory.html#cb1153-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1153-3"><a href="models-with-memory.html#cb1153-3" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> reedfrogs</span>
<span id="cb1153-4"><a href="models-with-memory.html#cb1153-4" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(d)</span></code></pre></div>
<pre><code>##   density pred  size surv propsurv
## 1      10   no   big    9      0.9
## 2      10   no   big   10      1.0
## 3      10   no   big    7      0.7
## 4      10   no   big   10      1.0
## 5      10   no small    9      0.9
## 6      10   no small    9      0.9</code></pre>
<div class="sourceCode" id="cb1155"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1155-1"><a href="models-with-memory.html#cb1155-1" aria-hidden="true" tabindex="-1"></a>d <span class="sc">%&gt;%</span> </span>
<span id="cb1155-2"><a href="models-with-memory.html#cb1155-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">tank =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(d)) <span class="ot">-&gt;</span>d</span>
<span id="cb1155-3"><a href="models-with-memory.html#cb1155-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1155-4"><a href="models-with-memory.html#cb1155-4" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(d)</span></code></pre></div>
<pre><code>##   density pred  size surv propsurv tank
## 1      10   no   big    9      0.9    1
## 2      10   no   big   10      1.0    2
## 3      10   no   big    7      0.7    3
## 4      10   no   big   10      1.0    4
## 5      10   no small    9      0.9    5
## 6      10   no small    9      0.9    6</code></pre>
<div class="sourceCode" id="cb1157"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1157-1"><a href="models-with-memory.html#cb1157-1" aria-hidden="true" tabindex="-1"></a>d <span class="sc">%&gt;%</span> </span>
<span id="cb1157-2"><a href="models-with-memory.html#cb1157-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">pred =</span> <span class="fu">ifelse</span>(pred <span class="sc">==</span> <span class="st">&quot;pred&quot;</span>,<span class="dv">1</span>,<span class="dv">0</span>),</span>
<span id="cb1157-3"><a href="models-with-memory.html#cb1157-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">size =</span> <span class="fu">ifelse</span>(size <span class="sc">==</span> <span class="st">&quot;big&quot;</span>, <span class="dv">1</span>,<span class="dv">0</span>)) <span class="ot">-&gt;</span>dd</span>
<span id="cb1157-4"><a href="models-with-memory.html#cb1157-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1157-5"><a href="models-with-memory.html#cb1157-5" aria-hidden="true" tabindex="-1"></a>b13M1a <span class="ot">&lt;-</span> </span>
<span id="cb1157-6"><a href="models-with-memory.html#cb1157-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">brm</span>(<span class="at">data =</span>dd,</span>
<span id="cb1157-7"><a href="models-with-memory.html#cb1157-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> binomial,</span>
<span id="cb1157-8"><a href="models-with-memory.html#cb1157-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">formula =</span> <span class="fu">bf</span>(surv<span class="sc">|</span><span class="fu">trials</span>(density) <span class="sc">~</span> a <span class="sc">+</span> b,</span>
<span id="cb1157-9"><a href="models-with-memory.html#cb1157-9" aria-hidden="true" tabindex="-1"></a>                   a <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> (<span class="dv">1</span><span class="sc">|</span>tank),</span>
<span id="cb1157-10"><a href="models-with-memory.html#cb1157-10" aria-hidden="true" tabindex="-1"></a>                   b <span class="sc">~</span> <span class="dv">0</span> <span class="sc">+</span> pred,</span>
<span id="cb1157-11"><a href="models-with-memory.html#cb1157-11" aria-hidden="true" tabindex="-1"></a>                   <span class="at">nl =</span> <span class="cn">TRUE</span>),</span>
<span id="cb1157-12"><a href="models-with-memory.html#cb1157-12" aria-hidden="true" tabindex="-1"></a>      <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>,<span class="fl">1.5</span>), <span class="at">class =</span> b, </span>
<span id="cb1157-13"><a href="models-with-memory.html#cb1157-13" aria-hidden="true" tabindex="-1"></a>                      <span class="at">coef =</span> Intercept, <span class="at">nlpar =</span>a),</span>
<span id="cb1157-14"><a href="models-with-memory.html#cb1157-14" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>,<span class="fl">1.5</span>), <span class="at">class =</span> b, <span class="at">nlpar =</span>b),</span>
<span id="cb1157-15"><a href="models-with-memory.html#cb1157-15" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>), <span class="at">class =</span> sd, <span class="at">nlpar =</span>a)),</span>
<span id="cb1157-16"><a href="models-with-memory.html#cb1157-16" aria-hidden="true" tabindex="-1"></a>      <span class="at">backend =</span> <span class="st">&quot;cmdstanr&quot;</span>,</span>
<span id="cb1157-17"><a href="models-with-memory.html#cb1157-17" aria-hidden="true" tabindex="-1"></a>      <span class="at">seed =</span> <span class="dv">15</span>, <span class="at">file =</span> <span class="st">&quot;output/Chapter13/b13M1a&quot;</span></span>
<span id="cb1157-18"><a href="models-with-memory.html#cb1157-18" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb1157-19"><a href="models-with-memory.html#cb1157-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1157-20"><a href="models-with-memory.html#cb1157-20" aria-hidden="true" tabindex="-1"></a>b13M1b <span class="ot">&lt;-</span> </span>
<span id="cb1157-21"><a href="models-with-memory.html#cb1157-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">brm</span>(<span class="at">data =</span>dd,</span>
<span id="cb1157-22"><a href="models-with-memory.html#cb1157-22" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> binomial,</span>
<span id="cb1157-23"><a href="models-with-memory.html#cb1157-23" aria-hidden="true" tabindex="-1"></a>      <span class="at">formula =</span> <span class="fu">bf</span>(surv<span class="sc">|</span><span class="fu">trials</span>(density) <span class="sc">~</span> a <span class="sc">+</span> b,</span>
<span id="cb1157-24"><a href="models-with-memory.html#cb1157-24" aria-hidden="true" tabindex="-1"></a>                   a <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> (<span class="dv">1</span><span class="sc">|</span>tank),</span>
<span id="cb1157-25"><a href="models-with-memory.html#cb1157-25" aria-hidden="true" tabindex="-1"></a>                   b <span class="sc">~</span> <span class="dv">0</span> <span class="sc">+</span> size,</span>
<span id="cb1157-26"><a href="models-with-memory.html#cb1157-26" aria-hidden="true" tabindex="-1"></a>                   <span class="at">nl =</span> <span class="cn">TRUE</span>),</span>
<span id="cb1157-27"><a href="models-with-memory.html#cb1157-27" aria-hidden="true" tabindex="-1"></a>      <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>,<span class="fl">1.5</span>), <span class="at">class =</span> b, </span>
<span id="cb1157-28"><a href="models-with-memory.html#cb1157-28" aria-hidden="true" tabindex="-1"></a>                      <span class="at">coef =</span> Intercept, <span class="at">nlpar =</span>a),</span>
<span id="cb1157-29"><a href="models-with-memory.html#cb1157-29" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>,<span class="fl">1.5</span>), <span class="at">class =</span> b, <span class="at">nlpar =</span>b),</span>
<span id="cb1157-30"><a href="models-with-memory.html#cb1157-30" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>), <span class="at">class =</span> sd, <span class="at">nlpar =</span>a)),</span>
<span id="cb1157-31"><a href="models-with-memory.html#cb1157-31" aria-hidden="true" tabindex="-1"></a>      <span class="at">backend =</span> <span class="st">&quot;cmdstanr&quot;</span>,</span>
<span id="cb1157-32"><a href="models-with-memory.html#cb1157-32" aria-hidden="true" tabindex="-1"></a>      <span class="at">seed =</span> <span class="dv">15</span>, <span class="at">file =</span> <span class="st">&quot;output/Chapter13/b13M1b&quot;</span></span>
<span id="cb1157-33"><a href="models-with-memory.html#cb1157-33" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb1157-34"><a href="models-with-memory.html#cb1157-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1157-35"><a href="models-with-memory.html#cb1157-35" aria-hidden="true" tabindex="-1"></a>b13M1c <span class="ot">&lt;-</span> </span>
<span id="cb1157-36"><a href="models-with-memory.html#cb1157-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">brm</span>(<span class="at">data =</span>dd,</span>
<span id="cb1157-37"><a href="models-with-memory.html#cb1157-37" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> binomial,</span>
<span id="cb1157-38"><a href="models-with-memory.html#cb1157-38" aria-hidden="true" tabindex="-1"></a>      <span class="at">formula =</span> <span class="fu">bf</span>(surv<span class="sc">|</span><span class="fu">trials</span>(density) <span class="sc">~</span> a <span class="sc">+</span> b,</span>
<span id="cb1157-39"><a href="models-with-memory.html#cb1157-39" aria-hidden="true" tabindex="-1"></a>                   a <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> (<span class="dv">1</span><span class="sc">|</span>tank),</span>
<span id="cb1157-40"><a href="models-with-memory.html#cb1157-40" aria-hidden="true" tabindex="-1"></a>                   b <span class="sc">~</span> <span class="dv">0</span> <span class="sc">+</span> pred <span class="sc">+</span> size,</span>
<span id="cb1157-41"><a href="models-with-memory.html#cb1157-41" aria-hidden="true" tabindex="-1"></a>                   <span class="at">nl =</span> <span class="cn">TRUE</span>),</span>
<span id="cb1157-42"><a href="models-with-memory.html#cb1157-42" aria-hidden="true" tabindex="-1"></a>      <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>,<span class="fl">1.5</span>), <span class="at">class =</span> b, </span>
<span id="cb1157-43"><a href="models-with-memory.html#cb1157-43" aria-hidden="true" tabindex="-1"></a>                      <span class="at">coef =</span> Intercept, <span class="at">nlpar =</span>a),</span>
<span id="cb1157-44"><a href="models-with-memory.html#cb1157-44" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>,<span class="fl">1.5</span>), <span class="at">class =</span> b, <span class="at">nlpar =</span>b),</span>
<span id="cb1157-45"><a href="models-with-memory.html#cb1157-45" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>), <span class="at">class =</span> sd, <span class="at">nlpar =</span>a)),</span>
<span id="cb1157-46"><a href="models-with-memory.html#cb1157-46" aria-hidden="true" tabindex="-1"></a>      <span class="at">backend =</span> <span class="st">&quot;cmdstanr&quot;</span>,</span>
<span id="cb1157-47"><a href="models-with-memory.html#cb1157-47" aria-hidden="true" tabindex="-1"></a>      <span class="at">seed =</span> <span class="dv">15</span>, <span class="at">file =</span> <span class="st">&quot;output/Chapter13/b13M1c&quot;</span></span>
<span id="cb1157-48"><a href="models-with-memory.html#cb1157-48" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb1157-49"><a href="models-with-memory.html#cb1157-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1157-50"><a href="models-with-memory.html#cb1157-50" aria-hidden="true" tabindex="-1"></a>b13M1d <span class="ot">&lt;-</span> </span>
<span id="cb1157-51"><a href="models-with-memory.html#cb1157-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">brm</span>(<span class="at">data =</span>dd,</span>
<span id="cb1157-52"><a href="models-with-memory.html#cb1157-52" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> binomial,</span>
<span id="cb1157-53"><a href="models-with-memory.html#cb1157-53" aria-hidden="true" tabindex="-1"></a>      <span class="at">formula =</span> <span class="fu">bf</span>(surv<span class="sc">|</span><span class="fu">trials</span>(density) <span class="sc">~</span> a <span class="sc">+</span> b,</span>
<span id="cb1157-54"><a href="models-with-memory.html#cb1157-54" aria-hidden="true" tabindex="-1"></a>                   a <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> (<span class="dv">1</span><span class="sc">|</span>tank),</span>
<span id="cb1157-55"><a href="models-with-memory.html#cb1157-55" aria-hidden="true" tabindex="-1"></a>                   b <span class="sc">~</span> <span class="dv">0</span> <span class="sc">+</span> pred<span class="sc">*</span>size,</span>
<span id="cb1157-56"><a href="models-with-memory.html#cb1157-56" aria-hidden="true" tabindex="-1"></a>                   <span class="at">nl =</span> <span class="cn">TRUE</span>),</span>
<span id="cb1157-57"><a href="models-with-memory.html#cb1157-57" aria-hidden="true" tabindex="-1"></a>      <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>,<span class="fl">1.5</span>), <span class="at">class =</span> b, </span>
<span id="cb1157-58"><a href="models-with-memory.html#cb1157-58" aria-hidden="true" tabindex="-1"></a>                      <span class="at">coef =</span> Intercept, <span class="at">nlpar =</span>a),</span>
<span id="cb1157-59"><a href="models-with-memory.html#cb1157-59" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>,<span class="fl">1.5</span>), <span class="at">class =</span> b, <span class="at">nlpar =</span>b),</span>
<span id="cb1157-60"><a href="models-with-memory.html#cb1157-60" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>), <span class="at">class =</span> sd, <span class="at">nlpar =</span>a)),</span>
<span id="cb1157-61"><a href="models-with-memory.html#cb1157-61" aria-hidden="true" tabindex="-1"></a>      <span class="at">backend =</span> <span class="st">&quot;cmdstanr&quot;</span>,</span>
<span id="cb1157-62"><a href="models-with-memory.html#cb1157-62" aria-hidden="true" tabindex="-1"></a>      <span class="at">seed =</span> <span class="dv">15</span>, <span class="at">file =</span> <span class="st">&quot;output/Chapter13/b13M1d&quot;</span></span>
<span id="cb1157-63"><a href="models-with-memory.html#cb1157-63" aria-hidden="true" tabindex="-1"></a>      )</span></code></pre></div>
<div class="sourceCode" id="cb1158"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1158-1"><a href="models-with-memory.html#cb1158-1" aria-hidden="true" tabindex="-1"></a><span class="fu">posterior_summary</span>(b13M1a) <span class="sc">%&gt;%</span> </span>
<span id="cb1158-2"><a href="models-with-memory.html#cb1158-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1158-3"><a href="models-with-memory.html#cb1158-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>(<span class="at">var =</span> <span class="st">&quot;par&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1158-4"><a href="models-with-memory.html#cb1158-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">str_detect</span>(par, <span class="st">&quot;b_|sd_&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1158-5"><a href="models-with-memory.html#cb1158-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_names</span>(<span class="fu">c</span>(<span class="st">&quot;par&quot;</span>,<span class="st">&quot;Est_a&quot;</span>,<span class="st">&quot;SE_a&quot;</span>,<span class="st">&quot;Q2.5_a&quot;</span>,<span class="st">&quot;Q97.5_a&quot;</span>))<span class="ot">-&gt;</span> res_13M1a </span>
<span id="cb1158-6"><a href="models-with-memory.html#cb1158-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1158-7"><a href="models-with-memory.html#cb1158-7" aria-hidden="true" tabindex="-1"></a><span class="fu">posterior_summary</span>(b13M1b) <span class="sc">%&gt;%</span> </span>
<span id="cb1158-8"><a href="models-with-memory.html#cb1158-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1158-9"><a href="models-with-memory.html#cb1158-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>(<span class="at">var =</span> <span class="st">&quot;par&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1158-10"><a href="models-with-memory.html#cb1158-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">str_detect</span>(par, <span class="st">&quot;b_|sd_&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1158-11"><a href="models-with-memory.html#cb1158-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_names</span>(<span class="fu">c</span>(<span class="st">&quot;par&quot;</span>,<span class="st">&quot;Est_b&quot;</span>,<span class="st">&quot;SE_b&quot;</span>,<span class="st">&quot;Q2.5_b&quot;</span>,<span class="st">&quot;Q97.5_b&quot;</span>))<span class="ot">-&gt;</span> res_13M1b</span>
<span id="cb1158-12"><a href="models-with-memory.html#cb1158-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1158-13"><a href="models-with-memory.html#cb1158-13" aria-hidden="true" tabindex="-1"></a><span class="fu">posterior_summary</span>(b13M1c) <span class="sc">%&gt;%</span> </span>
<span id="cb1158-14"><a href="models-with-memory.html#cb1158-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1158-15"><a href="models-with-memory.html#cb1158-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>(<span class="at">var =</span> <span class="st">&quot;par&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1158-16"><a href="models-with-memory.html#cb1158-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">str_detect</span>(par, <span class="st">&quot;b_|sd_&quot;</span>))<span class="sc">%&gt;%</span> </span>
<span id="cb1158-17"><a href="models-with-memory.html#cb1158-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_names</span>(<span class="fu">c</span>(<span class="st">&quot;par&quot;</span>,<span class="st">&quot;Est_c&quot;</span>,<span class="st">&quot;SE_c&quot;</span>,<span class="st">&quot;Q2.5_c&quot;</span>,<span class="st">&quot;Q97.5_c&quot;</span>)) <span class="ot">-&gt;</span> res_13M1c</span>
<span id="cb1158-18"><a href="models-with-memory.html#cb1158-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1158-19"><a href="models-with-memory.html#cb1158-19" aria-hidden="true" tabindex="-1"></a><span class="fu">posterior_summary</span>(b13M1d) <span class="sc">%&gt;%</span> </span>
<span id="cb1158-20"><a href="models-with-memory.html#cb1158-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1158-21"><a href="models-with-memory.html#cb1158-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>(<span class="at">var =</span> <span class="st">&quot;par&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1158-22"><a href="models-with-memory.html#cb1158-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">str_detect</span>(par, <span class="st">&quot;b_|sd_&quot;</span>))<span class="sc">%&gt;%</span> </span>
<span id="cb1158-23"><a href="models-with-memory.html#cb1158-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_names</span>(<span class="fu">c</span>(<span class="st">&quot;par&quot;</span>,<span class="st">&quot;Est_d&quot;</span>,<span class="st">&quot;SE_d&quot;</span>,<span class="st">&quot;Q2.5_d&quot;</span>,<span class="st">&quot;Q97.5_d&quot;</span>)) <span class="ot">-&gt;</span> res_13M1d</span>
<span id="cb1158-24"><a href="models-with-memory.html#cb1158-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1158-25"><a href="models-with-memory.html#cb1158-25" aria-hidden="true" tabindex="-1"></a>res_13M1a <span class="sc">%&gt;%</span> </span>
<span id="cb1158-26"><a href="models-with-memory.html#cb1158-26" aria-hidden="true" tabindex="-1"></a><span class="fu">full_join</span>(res_13M1b,<span class="at">by=</span><span class="st">&quot;par&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1158-27"><a href="models-with-memory.html#cb1158-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">full_join</span>(res_13M1c) <span class="sc">%&gt;%</span> </span>
<span id="cb1158-28"><a href="models-with-memory.html#cb1158-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">full_join</span>(res_13M1d) <span class="sc">%&gt;%</span> </span>
<span id="cb1158-29"><a href="models-with-memory.html#cb1158-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">where</span>(is.numeric),<span class="sc">~</span><span class="fu">round</span>(.x,<span class="dv">2</span>)))<span class="ot">-&gt;</span> res_13M1</span>
<span id="cb1158-30"><a href="models-with-memory.html#cb1158-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1158-31"><a href="models-with-memory.html#cb1158-31" aria-hidden="true" tabindex="-1"></a>res_13M1[<span class="fu">is.na</span>(res_13M1)] <span class="ot">&lt;-</span> <span class="st">&quot;-&quot;</span></span></code></pre></div>
結果は以下の通り（表<a href="models-with-memory.html#tab:res-b13M1">13.12</a>）。ランダム効果の標準偏差の推定値は、<code>pred</code>が入っているモデルではほとんど変わらないが、<code>size</code>だけのモデルでは大きくなっている。これは、<code>pred</code>がタンクごとの違いの大部分を説明しているからだと考えられる。<br />

<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:res-b13M1">表13.12: </span>モデルの比較
</caption>
<thead>
<tr>
<th style="empty-cells: hide;border-bottom:hidden;" colspan="1">
</th>
<th style="border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="4">
<div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
pred only
</div>
</th>
<th style="border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="4">
<div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
size only
</div>
</th>
<th style="border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="4">
<div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
pred and size
</div>
</th>
<th style="border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="4">
<div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
including interaction
</div>
</th>
</tr>
<tr>
<th style="text-align:center;">
par
</th>
<th style="text-align:center;">
Estimate
</th>
<th style="text-align:center;">
SE
</th>
<th style="text-align:center;">
Q2.5
</th>
<th style="text-align:center;">
Q97.5
</th>
<th style="text-align:center;">
Estimate
</th>
<th style="text-align:center;">
SE
</th>
<th style="text-align:center;">
Q2.5
</th>
<th style="text-align:center;">
Q97.5
</th>
<th style="text-align:center;">
Estimate
</th>
<th style="text-align:center;">
SE
</th>
<th style="text-align:center;">
Q2.5
</th>
<th style="text-align:center;">
Q97.5
</th>
<th style="text-align:center;">
Estimate
</th>
<th style="text-align:center;">
SE
</th>
<th style="text-align:center;">
Q2.5
</th>
<th style="text-align:center;">
Q97.5
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center;">
b_a_Intercept
</td>
<td style="text-align:center;">
2.57
</td>
<td style="text-align:center;">
0.25
</td>
<td style="text-align:center;">
2.09
</td>
<td style="text-align:center;">
3.08
</td>
<td style="text-align:center;">
1.52
</td>
<td style="text-align:center;">
0.34
</td>
<td style="text-align:center;">
0.84
</td>
<td style="text-align:center;">
2.2
</td>
<td style="text-align:center;">
2.8
</td>
<td style="text-align:center;">
0.27
</td>
<td style="text-align:center;">
2.26
</td>
<td style="text-align:center;">
3.34
</td>
<td style="text-align:center;">
2.48
</td>
<td style="text-align:center;">
0.29
</td>
<td style="text-align:center;">
1.92
</td>
<td style="text-align:center;">
3.08
</td>
</tr>
<tr>
<td style="text-align:center;">
b_b_pred
</td>
<td style="text-align:center;">
-2.5
</td>
<td style="text-align:center;">
0.31
</td>
<td style="text-align:center;">
-3.12
</td>
<td style="text-align:center;">
-1.88
</td>
<td style="text-align:center;">
<ul>
<li></td>
<td style="text-align:center;">
<ul>
<li></td>
<td style="text-align:center;">
<ul>
<li></td>
<td style="text-align:center;">
<ul>
<li></td>
<td style="text-align:center;">
-2.51
</td>
<td style="text-align:center;">
0.3
</td>
<td style="text-align:center;">
-3.13
</td>
<td style="text-align:center;">
-1.92
</td>
<td style="text-align:center;">
-1.99
</td>
<td style="text-align:center;">
0.37
</td>
<td style="text-align:center;">
-2.70
</td>
<td style="text-align:center;">
-1.28
</td>
</tr>
<tr>
<td style="text-align:center;">
sd_tank__a_Intercept
</td>
<td style="text-align:center;">
0.82
</td>
<td style="text-align:center;">
0.15
</td>
<td style="text-align:center;">
0.57
</td>
<td style="text-align:center;">
1.14
</td>
<td style="text-align:center;">
1.62
</td>
<td style="text-align:center;">
0.22
</td>
<td style="text-align:center;">
1.24
</td>
<td style="text-align:center;">
2.1
</td>
<td style="text-align:center;">
0.78
</td>
<td style="text-align:center;">
0.15
</td>
<td style="text-align:center;">
0.53
</td>
<td style="text-align:center;">
1.1
</td>
<td style="text-align:center;">
0.74
</td>
<td style="text-align:center;">
0.14
</td>
<td style="text-align:center;">
0.49
</td>
<td style="text-align:center;">
1.05
</td>
</tr>
<tr>
<td style="text-align:center;">
b_b_size
</td>
<td style="text-align:center;">
<ul>
<li></td>
<td style="text-align:center;">
<ul>
<li></td>
<td style="text-align:center;">
<ul>
<li></td>
<td style="text-align:center;">
<ul>
<li></td>
<td style="text-align:center;">
-0.35
</td>
<td style="text-align:center;">
0.49
</td>
<td style="text-align:center;">
-1.31
</td>
<td style="text-align:center;">
0.63
</td>
<td style="text-align:center;">
-0.46
</td>
<td style="text-align:center;">
0.29
</td>
<td style="text-align:center;">
-1.01
</td>
<td style="text-align:center;">
0.15
</td>
<td style="text-align:center;">
0.22
</td>
<td style="text-align:center;">
0.42
</td>
<td style="text-align:center;">
-0.58
</td>
<td style="text-align:center;">
1.07
</td>
</tr>
<tr>
<td style="text-align:center;">
b_b_pred:size
</td>
<td style="text-align:center;">
<ul>
<li></td>
<td style="text-align:center;">
<ul>
<li></td>
<td style="text-align:center;">
<ul>
<li></td>
<td style="text-align:center;">
<ul>
<li></td>
<td style="text-align:center;">
<ul>
<li></td>
<td style="text-align:center;">
<ul>
<li></td>
<td style="text-align:center;">
<ul>
<li></td>
<td style="text-align:center;">
<ul>
<li></td>
<td style="text-align:center;">
<ul>
<li></td>
<td style="text-align:center;">
<ul>
<li></td>
<td style="text-align:center;">
<ul>
<li></td>
<td style="text-align:center;">
<ul>
<li></td>
<td style="text-align:center;">
-1.13
</td>
<td style="text-align:center;">
0.52
</td>
<td style="text-align:center;">
-2.16
</td>
<td style="text-align:center;">
-0.13
</td>
</tr>
</tbody>
</table></li>
</ul></li>
</ul></li>
</ul></li>
</ul></li>
</ul></li>
</ul></li>
</ul></li>
</ul></li>
</ul></li>
</ul></li>
</ul></li>
</ul></li>
</ul></li>
</ul></li>
</ul></li>
</ul></li>
</ul></li>
</ul></li>
</ul></li>
</ul>
</div>
<div id="m2-7" class="section level3 hasAnchor" number="13.7.2">
<h3><span class="header-section-number">13.7.2</span> 13M2<a href="models-with-memory.html#m2-7" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<blockquote>
<p>Compare the models you fit just above, using WAIC. Can you reconcile the differences in WAIC with the posterior distributions of the models?</p>
</blockquote>
<p>WAICを比較する（表@ref{tab:comp-waic}）。ほとんど変わらないが、やはりpredのみのモデルが最も予測がよい。</p>
<div class="sourceCode" id="cb1159"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1159-1"><a href="models-with-memory.html#cb1159-1" aria-hidden="true" tabindex="-1"></a>b13M1a <span class="ot">&lt;-</span> <span class="fu">add_criterion</span>(b13M1a, <span class="st">&quot;waic&quot;</span>)</span>
<span id="cb1159-2"><a href="models-with-memory.html#cb1159-2" aria-hidden="true" tabindex="-1"></a>b13M1b <span class="ot">&lt;-</span> <span class="fu">add_criterion</span>(b13M1b, <span class="st">&quot;waic&quot;</span>)</span>
<span id="cb1159-3"><a href="models-with-memory.html#cb1159-3" aria-hidden="true" tabindex="-1"></a>b13M1c <span class="ot">&lt;-</span> <span class="fu">add_criterion</span>(b13M1c, <span class="st">&quot;waic&quot;</span>)</span>
<span id="cb1159-4"><a href="models-with-memory.html#cb1159-4" aria-hidden="true" tabindex="-1"></a>b13M1d <span class="ot">&lt;-</span> <span class="fu">add_criterion</span>(b13M1d, <span class="st">&quot;waic&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb1160"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1160-1"><a href="models-with-memory.html#cb1160-1" aria-hidden="true" tabindex="-1"></a><span class="fu">loo_compare</span>(b13M1a,b13M1b,b13M1c,b13M1d, <span class="at">criterion=</span><span class="st">&quot;waic&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1160-2"><a href="models-with-memory.html#cb1160-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="at">simplify =</span> F) <span class="sc">%&gt;%</span> </span>
<span id="cb1160-3"><a href="models-with-memory.html#cb1160-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="at">digits =</span> <span class="dv">2</span>,</span>
<span id="cb1160-4"><a href="models-with-memory.html#cb1160-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">booktabs =</span> <span class="cn">TRUE</span>,</span>
<span id="cb1160-5"><a href="models-with-memory.html#cb1160-5" aria-hidden="true" tabindex="-1"></a>        <span class="at">caption =</span> <span class="st">&quot;WAICの比較。&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1160-6"><a href="models-with-memory.html#cb1160-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">latex_options =</span> <span class="fu">c</span>(<span class="st">&quot;striped&quot;</span>, <span class="st">&quot;hold_position&quot;</span>))</span></code></pre></div>
<pre><code>##        elpd_diff se_diff elpd_waic se_elpd_waic p_waic se_p_waic waic   se_waic
## b13M1a    0.0       0.0   -99.3       4.6         19.0    2.0     198.6    9.1 
## b13M1c   -0.7       1.0  -100.0       4.4         19.1    1.9     199.9    8.8 
## b13M1b   -0.9       2.9  -100.2       3.6         21.0    0.9     200.4    7.3 
## b13M1d   -1.0       1.7  -100.2       4.8         19.3    2.2     200.5    9.6</code></pre>
<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:comp-waic">表13.13: </span>WAICの比較。
</caption>
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
elpd_diff
</th>
<th style="text-align:right;">
se_diff
</th>
<th style="text-align:right;">
elpd_waic
</th>
<th style="text-align:right;">
se_elpd_waic
</th>
<th style="text-align:right;">
p_waic
</th>
<th style="text-align:right;">
se_p_waic
</th>
<th style="text-align:right;">
waic
</th>
<th style="text-align:right;">
se_waic
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
b13M1a
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;">
-99.28
</td>
<td style="text-align:right;">
4.55
</td>
<td style="text-align:right;">
19.03
</td>
<td style="text-align:right;">
1.96
</td>
<td style="text-align:right;">
198.55
</td>
<td style="text-align:right;">
9.11
</td>
</tr>
<tr>
<td style="text-align:left;">
b13M1c
</td>
<td style="text-align:right;">
-0.69
</td>
<td style="text-align:right;">
0.96
</td>
<td style="text-align:right;">
-99.96
</td>
<td style="text-align:right;">
4.41
</td>
<td style="text-align:right;">
19.12
</td>
<td style="text-align:right;">
1.89
</td>
<td style="text-align:right;">
199.92
</td>
<td style="text-align:right;">
8.83
</td>
</tr>
<tr>
<td style="text-align:left;">
b13M1b
</td>
<td style="text-align:right;">
-0.94
</td>
<td style="text-align:right;">
2.89
</td>
<td style="text-align:right;">
-100.22
</td>
<td style="text-align:right;">
3.63
</td>
<td style="text-align:right;">
21.02
</td>
<td style="text-align:right;">
0.86
</td>
<td style="text-align:right;">
200.43
</td>
<td style="text-align:right;">
7.27
</td>
</tr>
<tr>
<td style="text-align:left;">
b13M1d
</td>
<td style="text-align:right;">
-0.97
</td>
<td style="text-align:right;">
1.68
</td>
<td style="text-align:right;">
-100.24
</td>
<td style="text-align:right;">
4.82
</td>
<td style="text-align:right;">
19.34
</td>
<td style="text-align:right;">
2.15
</td>
<td style="text-align:right;">
200.49
</td>
<td style="text-align:right;">
9.65
</td>
</tr>
</tbody>
</table>
</div>
<div id="m3-4" class="section level3 hasAnchor" number="13.7.3">
<h3><span class="header-section-number">13.7.3</span> 13M3<a href="models-with-memory.html#m3-4" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<blockquote>
<p>Re-estimate the basic Reed frog varying intercept model, but now using a Cauchy distribution in place of the Gaussian distribution for the varying intercepts. That is, fit this model:</p>
</blockquote>
$$
<span class="math display">\[\begin{aligned}

s_i &amp;\sim Binomial(n_i,p_i)\\
logit(p_i) &amp;= \alpha_{tank}\\
\alpha_{tank} &amp;\sim Cauchy(\alpha,\sigma)\\
\alpha &amp;\sim Normal(0,1)\\
\sigma &amp;\sim Exponential(1)

\end{aligned}\]</span>
<p>$$</p>
<blockquote>
<p>Compare the posterior means of the intercepts,
, to the posterior means produced in the chapter, using the customary Gaussian prior. Can you explain the pattern of differences?</p>
</blockquote>
<p>ランダム効果の標準偏差にコーシー分布を用いてモデリングを行う。
<code>brms</code>だと実装できないので、<code>ulam</code>関数でモデリングする。</p>
<div class="sourceCode" id="cb1162"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1162-1"><a href="models-with-memory.html#cb1162-1" aria-hidden="true" tabindex="-1"></a><span class="co">#b13M3 &lt;- </span></span>
<span id="cb1162-2"><a href="models-with-memory.html#cb1162-2" aria-hidden="true" tabindex="-1"></a> <span class="co"># m_TankCauchy &lt;- ulam(</span></span>
<span id="cb1162-3"><a href="models-with-memory.html#cb1162-3" aria-hidden="true" tabindex="-1"></a>  <span class="co">#alist(</span></span>
<span id="cb1162-4"><a href="models-with-memory.html#cb1162-4" aria-hidden="true" tabindex="-1"></a>   <span class="co"># surv ~ dbinom(density, p),</span></span>
<span id="cb1162-5"><a href="models-with-memory.html#cb1162-5" aria-hidden="true" tabindex="-1"></a>    <span class="co">#logit(p) &lt;- a[tank],</span></span>
<span id="cb1162-6"><a href="models-with-memory.html#cb1162-6" aria-hidden="true" tabindex="-1"></a>    <span class="co">#a[tank] ~ dcauchy(a_bar, sigma),</span></span>
<span id="cb1162-7"><a href="models-with-memory.html#cb1162-7" aria-hidden="true" tabindex="-1"></a>    <span class="co">#a_bar ~ dnorm(0, 1.5),</span></span>
<span id="cb1162-8"><a href="models-with-memory.html#cb1162-8" aria-hidden="true" tabindex="-1"></a>    <span class="co">#sigma ~ dexp(1)</span></span>
<span id="cb1162-9"><a href="models-with-memory.html#cb1162-9" aria-hidden="true" tabindex="-1"></a>  <span class="co">#),</span></span>
<span id="cb1162-10"><a href="models-with-memory.html#cb1162-10" aria-hidden="true" tabindex="-1"></a>  <span class="co">#data = d, chains = 4, cores = 4, log_lik = TRUE,</span></span>
<span id="cb1162-11"><a href="models-with-memory.html#cb1162-11" aria-hidden="true" tabindex="-1"></a>  <span class="co">#iter = 2e3, control = list(adapt_delta = 0.99)</span></span>
<span id="cb1162-12"><a href="models-with-memory.html#cb1162-12" aria-hidden="true" tabindex="-1"></a><span class="co">#)</span></span>
<span id="cb1162-13"><a href="models-with-memory.html#cb1162-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1162-14"><a href="models-with-memory.html#cb1162-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1162-15"><a href="models-with-memory.html#cb1162-15" aria-hidden="true" tabindex="-1"></a>b13M3 <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;output/Chapter13/b13M3.rds&quot;</span>)</span></code></pre></div>
<p>各tankのランダム切片の推定値を示すと以下のようになる(表<a href="models-with-memory.html#fig:fig-13M3">13.1</a>)。白抜きの点は実測値、オレンジの点はコーシー分布を事前分布としたときの推定値、青い点は正規分布を事前分布としたときの推定値を示す。また、点線は実測値の平均値である。</p>
<p>正規分布のほうがコーシー分布よりも点線に近い推定値をとっており、縮合がより強く生じていることがわかる。これは、コーシー分布のほうが正規分布よりも裾の広い分布だからである。</p>
<div class="sourceCode" id="cb1163"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1163-1"><a href="models-with-memory.html#cb1163-1" aria-hidden="true" tabindex="-1"></a><span class="fu">posterior_summary</span>(b13<span class="fl">.2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1163-2"><a href="models-with-memory.html#cb1163-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1163-3"><a href="models-with-memory.html#cb1163-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">everything</span>(), logistic)) <span class="sc">%&gt;%</span> </span>
<span id="cb1163-4"><a href="models-with-memory.html#cb1163-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>(<span class="at">var =</span> <span class="st">&quot;par&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1163-5"><a href="models-with-memory.html#cb1163-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">str_detect</span>(par,<span class="st">&quot;r_t&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1163-6"><a href="models-with-memory.html#cb1163-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">tank =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">n</span>(),</span>
<span id="cb1163-7"><a href="models-with-memory.html#cb1163-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">type =</span> <span class="st">&quot;normal&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1163-8"><a href="models-with-memory.html#cb1163-8" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>Est.Error, <span class="sc">-</span>par) <span class="ot">-&gt;</span> post_b13<span class="fl">.2</span></span>
<span id="cb1163-9"><a href="models-with-memory.html#cb1163-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1163-10"><a href="models-with-memory.html#cb1163-10" aria-hidden="true" tabindex="-1"></a><span class="fu">extract.samples</span>(b13M3) <span class="sc">%&gt;%</span> </span>
<span id="cb1163-11"><a href="models-with-memory.html#cb1163-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1163-12"><a href="models-with-memory.html#cb1163-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">everything</span>(), logistic)) <span class="sc">%&gt;%</span> </span>
<span id="cb1163-13"><a href="models-with-memory.html#cb1163-13" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>a_bar, <span class="sc">-</span>sigma) <span class="ot">-&gt;</span> a</span>
<span id="cb1163-14"><a href="models-with-memory.html#cb1163-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1163-15"><a href="models-with-memory.html#cb1163-15" aria-hidden="true" tabindex="-1"></a><span class="fu">data.frame</span>(<span class="at">tank =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">48</span>) <span class="sc">%&gt;%</span>   </span>
<span id="cb1163-16"><a href="models-with-memory.html#cb1163-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Estimate =</span> <span class="fu">map_dbl</span>(a,mean)) <span class="sc">%&gt;%</span> </span>
<span id="cb1163-17"><a href="models-with-memory.html#cb1163-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Q2.5 =</span> <span class="fu">map_dbl</span>(a, <span class="sc">~</span><span class="fu">quantile</span>(., <span class="at">probs =</span> <span class="fl">0.025</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb1163-18"><a href="models-with-memory.html#cb1163-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Q97.5 =</span> <span class="fu">map_dbl</span>(a, <span class="sc">~</span><span class="fu">quantile</span>(., <span class="at">probs =</span> <span class="fl">0.975</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb1163-19"><a href="models-with-memory.html#cb1163-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">type =</span> <span class="st">&quot;cauchy&quot;</span>)<span class="ot">-&gt;</span> post_b13M3</span>
<span id="cb1163-20"><a href="models-with-memory.html#cb1163-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1163-21"><a href="models-with-memory.html#cb1163-21" aria-hidden="true" tabindex="-1"></a><span class="fu">bind_rows</span>(post_b13<span class="fl">.2</span>, post_b13M3) <span class="ot">-&gt;</span> post</span>
<span id="cb1163-22"><a href="models-with-memory.html#cb1163-22" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1163-23"><a href="models-with-memory.html#cb1163-23" aria-hidden="true" tabindex="-1"></a>post <span class="sc">%&gt;%</span> </span>
<span id="cb1163-24"><a href="models-with-memory.html#cb1163-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>tank, <span class="at">y=</span>Estimate))<span class="sc">+</span></span>
<span id="cb1163-25"><a href="models-with-memory.html#cb1163-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color =</span> type),</span>
<span id="cb1163-26"><a href="models-with-memory.html#cb1163-26" aria-hidden="true" tabindex="-1"></a>            <span class="at">position =</span> <span class="st">&quot;dodge&quot;</span>)<span class="sc">+</span></span>
<span id="cb1163-27"><a href="models-with-memory.html#cb1163-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> d,</span>
<span id="cb1163-28"><a href="models-with-memory.html#cb1163-28" aria-hidden="true" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">y =</span> propsurv),</span>
<span id="cb1163-29"><a href="models-with-memory.html#cb1163-29" aria-hidden="true" tabindex="-1"></a>             <span class="at">shape =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb1163-30"><a href="models-with-memory.html#cb1163-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">data =</span> d,</span>
<span id="cb1163-31"><a href="models-with-memory.html#cb1163-31" aria-hidden="true" tabindex="-1"></a>             <span class="at">yintercept =</span> <span class="fu">mean</span>(d<span class="sc">$</span>propsurv),</span>
<span id="cb1163-32"><a href="models-with-memory.html#cb1163-32" aria-hidden="true" tabindex="-1"></a>             <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>)<span class="sc">+</span></span>
<span id="cb1163-33"><a href="models-with-memory.html#cb1163-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">aspect.ratio =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb1163-34"><a href="models-with-memory.html#cb1163-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;orange&quot;</span>,<span class="st">&quot;blue3&quot;</span>))</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fig-13M3"></span>
<img src="Rethinking_Bookdown_files/figure-html/fig-13M3-1.png" alt="練習問題13M3の図。ランダム効果の事前分布に正規分布とコーシー分布を使用したときの違い" width="672" />
<p class="caption">
図13.1: 練習問題13M3の図。ランダム効果の事前分布に正規分布とコーシー分布を使用したときの違い
</p>
</div>
</div>
<div id="m4-6" class="section level3 hasAnchor" number="13.7.4">
<h3><span class="header-section-number">13.7.4</span> 13M4<a href="models-with-memory.html#m4-6" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<blockquote>
<p>今度はstudentのt分布を事前分布として用いて先ほどの結果と比較せよ。</p>
</blockquote>
<div class="sourceCode" id="cb1164"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1164-1"><a href="models-with-memory.html#cb1164-1" aria-hidden="true" tabindex="-1"></a><span class="co">#b13M4 &lt;- </span></span>
<span id="cb1164-2"><a href="models-with-memory.html#cb1164-2" aria-hidden="true" tabindex="-1"></a> <span class="co"># m_TankCauchy &lt;- ulam(</span></span>
<span id="cb1164-3"><a href="models-with-memory.html#cb1164-3" aria-hidden="true" tabindex="-1"></a>  <span class="co">#alist(</span></span>
<span id="cb1164-4"><a href="models-with-memory.html#cb1164-4" aria-hidden="true" tabindex="-1"></a>   <span class="co"># surv ~ dbinom(density, p),</span></span>
<span id="cb1164-5"><a href="models-with-memory.html#cb1164-5" aria-hidden="true" tabindex="-1"></a>  <span class="co">#  logit(p) &lt;- a[tank],</span></span>
<span id="cb1164-6"><a href="models-with-memory.html#cb1164-6" aria-hidden="true" tabindex="-1"></a>   <span class="co"># a[tank] ~ dstudent(2, a_bar, sigma),</span></span>
<span id="cb1164-7"><a href="models-with-memory.html#cb1164-7" aria-hidden="true" tabindex="-1"></a>  <span class="co">#  a_bar ~ dnorm(0, 1.5),</span></span>
<span id="cb1164-8"><a href="models-with-memory.html#cb1164-8" aria-hidden="true" tabindex="-1"></a>   <span class="co"># sigma ~ dexp(1)</span></span>
<span id="cb1164-9"><a href="models-with-memory.html#cb1164-9" aria-hidden="true" tabindex="-1"></a>  <span class="co">#),</span></span>
<span id="cb1164-10"><a href="models-with-memory.html#cb1164-10" aria-hidden="true" tabindex="-1"></a>  <span class="co">#data = d, chains = 4, cores = 4, log_lik = TRUE,</span></span>
<span id="cb1164-11"><a href="models-with-memory.html#cb1164-11" aria-hidden="true" tabindex="-1"></a>  <span class="co">#iter = 2e3, control = list(adapt_delta = 0.99)</span></span>
<span id="cb1164-12"><a href="models-with-memory.html#cb1164-12" aria-hidden="true" tabindex="-1"></a><span class="co">#)</span></span>
<span id="cb1164-13"><a href="models-with-memory.html#cb1164-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1164-14"><a href="models-with-memory.html#cb1164-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1164-15"><a href="models-with-memory.html#cb1164-15" aria-hidden="true" tabindex="-1"></a>b13M4 <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;output/Chapter13/b13M4.rds&quot;</span>)</span></code></pre></div>
<p>各tankのランダム切片の推定値を示すと以下のようになる(表<a href="models-with-memory.html#fig:fig-13M3">13.1</a>)。白抜きの点は実測値、オレンジの点はコーシー分布を事前分布としたときの推定値、青い点はt分布を事前分布としたときの推定値を示す。また、点線は実測値の平均値である。</p>
<p>結果、ほとんど同じ推定値をとることがわかる。</p>
<div class="sourceCode" id="cb1165"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1165-1"><a href="models-with-memory.html#cb1165-1" aria-hidden="true" tabindex="-1"></a><span class="fu">extract.samples</span>(b13M4) <span class="sc">%&gt;%</span> </span>
<span id="cb1165-2"><a href="models-with-memory.html#cb1165-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1165-3"><a href="models-with-memory.html#cb1165-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">everything</span>(), logistic)) <span class="sc">%&gt;%</span> </span>
<span id="cb1165-4"><a href="models-with-memory.html#cb1165-4" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>a_bar, <span class="sc">-</span>sigma) <span class="ot">-&gt;</span> b</span>
<span id="cb1165-5"><a href="models-with-memory.html#cb1165-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1165-6"><a href="models-with-memory.html#cb1165-6" aria-hidden="true" tabindex="-1"></a><span class="fu">data.frame</span>(<span class="at">tank =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">48</span>) <span class="sc">%&gt;%</span>   </span>
<span id="cb1165-7"><a href="models-with-memory.html#cb1165-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Estimate =</span> <span class="fu">map_dbl</span>(a,mean)) <span class="sc">%&gt;%</span> </span>
<span id="cb1165-8"><a href="models-with-memory.html#cb1165-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Q2.5 =</span> <span class="fu">map_dbl</span>(b, <span class="sc">~</span><span class="fu">quantile</span>(., <span class="at">probs =</span> <span class="fl">0.025</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb1165-9"><a href="models-with-memory.html#cb1165-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Q97.5 =</span> <span class="fu">map_dbl</span>(b, <span class="sc">~</span><span class="fu">quantile</span>(., <span class="at">probs =</span> <span class="fl">0.975</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb1165-10"><a href="models-with-memory.html#cb1165-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">type =</span> <span class="st">&quot;student&quot;</span>)<span class="ot">-&gt;</span> post_b13M4</span>
<span id="cb1165-11"><a href="models-with-memory.html#cb1165-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1165-12"><a href="models-with-memory.html#cb1165-12" aria-hidden="true" tabindex="-1"></a><span class="fu">bind_rows</span>(post_b13M4, post_b13M3) <span class="ot">-&gt;</span> post</span>
<span id="cb1165-13"><a href="models-with-memory.html#cb1165-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1165-14"><a href="models-with-memory.html#cb1165-14" aria-hidden="true" tabindex="-1"></a>post <span class="sc">%&gt;%</span> </span>
<span id="cb1165-15"><a href="models-with-memory.html#cb1165-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>tank, <span class="at">y=</span>Estimate))<span class="sc">+</span></span>
<span id="cb1165-16"><a href="models-with-memory.html#cb1165-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color =</span> type), <span class="at">alpha =</span> <span class="fl">0.5</span>,<span class="at">size =</span> <span class="dv">2</span>,</span>
<span id="cb1165-17"><a href="models-with-memory.html#cb1165-17" aria-hidden="true" tabindex="-1"></a>            <span class="at">position =</span> <span class="fu">position_dodge</span>(<span class="at">width =</span> <span class="dv">1</span>))<span class="sc">+</span></span>
<span id="cb1165-18"><a href="models-with-memory.html#cb1165-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> d,</span>
<span id="cb1165-19"><a href="models-with-memory.html#cb1165-19" aria-hidden="true" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">y =</span> propsurv),</span>
<span id="cb1165-20"><a href="models-with-memory.html#cb1165-20" aria-hidden="true" tabindex="-1"></a>             <span class="at">shape =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb1165-21"><a href="models-with-memory.html#cb1165-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">data =</span> d,</span>
<span id="cb1165-22"><a href="models-with-memory.html#cb1165-22" aria-hidden="true" tabindex="-1"></a>             <span class="at">yintercept =</span> <span class="fu">mean</span>(d<span class="sc">$</span>propsurv),</span>
<span id="cb1165-23"><a href="models-with-memory.html#cb1165-23" aria-hidden="true" tabindex="-1"></a>             <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>)<span class="sc">+</span></span>
<span id="cb1165-24"><a href="models-with-memory.html#cb1165-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">aspect.ratio =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb1165-25"><a href="models-with-memory.html#cb1165-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;orange&quot;</span>,<span class="st">&quot;blue3&quot;</span>))</span></code></pre></div>
<p><img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-649-1.png" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="m5-3" class="section level3 hasAnchor" number="13.7.5">
<h3><span class="header-section-number">13.7.5</span> 13M5<a href="models-with-memory.html#m5-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<blockquote>
<p>Modify the cross-classified chimpanzees model m13.4 so that the adaptive prior for blocks contains a parameter for its mean:
<span class="math display">\[
\gamma_i \sim Normal(\bar{\gamma}, \sigma_{\gamma})\\
\bar{\gamma} \sim Normal(0,1.5)
\]</span></p>
</blockquote>
<blockquote>
<p>Compare this model to m13.4. What has including done?</p>
</blockquote>
<p>これも<code>brms</code>パッケージでは推定ができなそうなので、<code>ulam</code>関数を用いる。</p>
<div class="sourceCode" id="cb1166"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1166-1"><a href="models-with-memory.html#cb1166-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(chimpanzees)</span>
<span id="cb1166-2"><a href="models-with-memory.html#cb1166-2" aria-hidden="true" tabindex="-1"></a>d2 <span class="ot">&lt;-</span> chimpanzees</span>
<span id="cb1166-3"><a href="models-with-memory.html#cb1166-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1166-4"><a href="models-with-memory.html#cb1166-4" aria-hidden="true" tabindex="-1"></a>d2<span class="sc">$</span>treatment <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">+</span> d2<span class="sc">$</span>prosoc_left <span class="sc">+</span> <span class="dv">2</span> <span class="sc">*</span> d2<span class="sc">$</span>condition</span>
<span id="cb1166-5"><a href="models-with-memory.html#cb1166-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1166-6"><a href="models-with-memory.html#cb1166-6" aria-hidden="true" tabindex="-1"></a>dat_list <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb1166-7"><a href="models-with-memory.html#cb1166-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">pulled_left =</span> d2<span class="sc">$</span>pulled_left,</span>
<span id="cb1166-8"><a href="models-with-memory.html#cb1166-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">actor =</span> d2<span class="sc">$</span>actor,</span>
<span id="cb1166-9"><a href="models-with-memory.html#cb1166-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">block_id =</span> d2<span class="sc">$</span>block,</span>
<span id="cb1166-10"><a href="models-with-memory.html#cb1166-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">treatment =</span> <span class="fu">as.integer</span>(d2<span class="sc">$</span>treatment)</span>
<span id="cb1166-11"><a href="models-with-memory.html#cb1166-11" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1166-12"><a href="models-with-memory.html#cb1166-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1166-13"><a href="models-with-memory.html#cb1166-13" aria-hidden="true" tabindex="-1"></a><span class="co">#b13M5 &lt;- ulam(</span></span>
<span id="cb1166-14"><a href="models-with-memory.html#cb1166-14" aria-hidden="true" tabindex="-1"></a> <span class="co"># alist(</span></span>
<span id="cb1166-15"><a href="models-with-memory.html#cb1166-15" aria-hidden="true" tabindex="-1"></a>  <span class="co">#  pulled_left ~ dbinom(1, p),</span></span>
<span id="cb1166-16"><a href="models-with-memory.html#cb1166-16" aria-hidden="true" tabindex="-1"></a>  <span class="co">#  logit(p) &lt;- a[actor] + g[block_id] + b[treatment],</span></span>
<span id="cb1166-17"><a href="models-with-memory.html#cb1166-17" aria-hidden="true" tabindex="-1"></a>  <span class="co">#  b[treatment] ~ dnorm(0, 0.5),</span></span>
<span id="cb1166-18"><a href="models-with-memory.html#cb1166-18" aria-hidden="true" tabindex="-1"></a>  <span class="co">#  ## adaptive priors</span></span>
<span id="cb1166-19"><a href="models-with-memory.html#cb1166-19" aria-hidden="true" tabindex="-1"></a>  <span class="co">#  a[actor] ~ dnorm(a_bar, sigma_a),</span></span>
<span id="cb1166-20"><a href="models-with-memory.html#cb1166-20" aria-hidden="true" tabindex="-1"></a>  <span class="co">#  g[block_id] ~ dnorm(g_bar, sigma_g),</span></span>
<span id="cb1166-21"><a href="models-with-memory.html#cb1166-21" aria-hidden="true" tabindex="-1"></a>  <span class="co">#  ## hyper-priors</span></span>
<span id="cb1166-22"><a href="models-with-memory.html#cb1166-22" aria-hidden="true" tabindex="-1"></a>  <span class="co">#  a_bar ~ dnorm(0, 1.5),</span></span>
<span id="cb1166-23"><a href="models-with-memory.html#cb1166-23" aria-hidden="true" tabindex="-1"></a>  <span class="co">#  g_bar ~ dnorm(0, 1.5),</span></span>
<span id="cb1166-24"><a href="models-with-memory.html#cb1166-24" aria-hidden="true" tabindex="-1"></a>  <span class="co">#  sigma_a ~ dexp(1),</span></span>
<span id="cb1166-25"><a href="models-with-memory.html#cb1166-25" aria-hidden="true" tabindex="-1"></a>  <span class="co">#  sigma_g ~ dexp(1)</span></span>
<span id="cb1166-26"><a href="models-with-memory.html#cb1166-26" aria-hidden="true" tabindex="-1"></a>  <span class="co">#),</span></span>
<span id="cb1166-27"><a href="models-with-memory.html#cb1166-27" aria-hidden="true" tabindex="-1"></a>  <span class="co">#data = dat_list, chains = 4, cores = 4, log_lik = TRUE</span></span>
<span id="cb1166-28"><a href="models-with-memory.html#cb1166-28" aria-hidden="true" tabindex="-1"></a><span class="co"># )</span></span>
<span id="cb1166-29"><a href="models-with-memory.html#cb1166-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1166-30"><a href="models-with-memory.html#cb1166-30" aria-hidden="true" tabindex="-1"></a>b13M5 <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;output/Chapter13/b13M5.rds&quot;</span>)</span></code></pre></div>
<p>それでは、<code>b13.4</code>と結果を比較する。</p>
<p>新しいモデル(b13M5)の有効サンプル数(n_eff)とGelman-Rubin統計量(Rhat)を見ると、そのサンプリングは非常に非効率的であることがわかる。元のモデル(b13.4)と比較すると、すべてのパラメータで有効サンプル数が大幅に悪化している。</p>
<p>これは、b13M5はオーバー・パラメータ化されているからである。<code>actor</code>と<code>block</code>のランダム切片の平均は(ここでは、<code>a_bar</code>、<code>g_bar</code>)現在のモデルではどちらもモデルの切片の中に含まれている。そのため、これらは識別不能であり、別々に推定することはできない。</p>
<div class="sourceCode" id="cb1167"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1167-1"><a href="models-with-memory.html#cb1167-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(easystats)</span>
<span id="cb1167-2"><a href="models-with-memory.html#cb1167-2" aria-hidden="true" tabindex="-1"></a><span class="fu">model_parameters</span>(b13<span class="fl">.4</span>)</span></code></pre></div>
<pre><code>## Parameter    | Median |        95% CI |     pd |  Rhat |     ESS
## ----------------------------------------------------------------
## a_Intercept  |   0.59 | [-0.85, 2.01] | 79.95% | 1.006 |  945.00
## b_treatment1 |  -0.12 | [-0.71, 0.46] | 66.25% | 1.002 | 2476.00
## b_treatment2 |   0.40 | [-0.17, 0.98] | 91.20% | 1.001 | 2494.00
## b_treatment3 |  -0.47 | [-1.07, 0.13] | 93.70% | 1.002 | 2300.00
## b_treatment4 |   0.29 | [-0.30, 0.86] | 83.83% | 1.000 | 2596.00</code></pre>
<div class="sourceCode" id="cb1169"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1169-1"><a href="models-with-memory.html#cb1169-1" aria-hidden="true" tabindex="-1"></a><span class="fu">precis</span>(b13M5, <span class="dv">2</span>, <span class="at">pars =</span> <span class="fu">c</span>(<span class="st">&quot;a_bar&quot;</span>, <span class="st">&quot;b&quot;</span>, <span class="st">&quot;g_bar&quot;</span>))</span></code></pre></div>
<pre><code>##             mean        sd        5.5%      94.5%    n_eff    Rhat4
## a_bar  0.4049342 1.1218173 -1.33440410 2.30157449 257.0455 1.010909
## b[1]  -0.1430008 0.3095102 -0.61967802 0.36858667 573.5765 1.004046
## b[2]   0.3889532 0.2985868 -0.08154383 0.88374908 528.3317 1.003222
## b[3]  -0.4791117 0.3108014 -0.98463977 0.01555968 492.5316 1.001266
## b[4]   0.2649693 0.3059801 -0.20340321 0.77382354 665.3800 1.002914
## g_bar  0.2384293 1.1329296 -1.56088869 2.03449592 118.2272 1.028422</code></pre>
</div>
<div id="m6-2" class="section level3 hasAnchor" number="13.7.6">
<h3><span class="header-section-number">13.7.6</span> 13M6<a href="models-with-memory.html#m6-2" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<blockquote>
<p>Sometimes the prior and the data are in conflict, because they concentrate around different regions of parameter space. What happens in these cases depends a lot upon the shape of the tails of distributions. Likewise, the tails of distributions strongly influence can outliers are shrunk or not towards mean. I want you to consider four different models to fit to one observation at <span class="math inline">\(y=0\)</span>. The models differ only in the distributions assigned to the likelihood and prior. Here are the four models:</p>
</blockquote>
$$
<span class="math display">\[\begin{aligned}
Model \;NN: y &amp;\sim Normal(\mu,1)\\
\mu &amp;\sim Normal(10,1)\\
\\
Model \;NT: y &amp;\sim Normal(\mu,1)\\
\mu &amp;\sim Student(2,10,1)\\
\\
Model \;TN: y &amp;\sim Student(2,\mu,1)\\
\mu &amp;\sim Normal(10,1)\\
\\
Model \;TT: y &amp;\sim Student(2,\mu,1)\\
\mu &amp;\sim Student(2,10,1)\\
\\

\end{aligned}\]</span>
<p>$$</p>
<p><span class="math inline">\(y=0\)</span>の1つのデータに対する4つのモデルを比較する。</p>
<div class="sourceCode" id="cb1171"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1171-1"><a href="models-with-memory.html#cb1171-1" aria-hidden="true" tabindex="-1"></a>d3 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">y=</span><span class="dv">0</span>)</span>
<span id="cb1171-2"><a href="models-with-memory.html#cb1171-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1171-3"><a href="models-with-memory.html#cb1171-3" aria-hidden="true" tabindex="-1"></a>b13M6_a <span class="ot">&lt;-</span> <span class="fu">brm</span>(<span class="at">data =</span> d3,</span>
<span id="cb1171-4"><a href="models-with-memory.html#cb1171-4" aria-hidden="true" tabindex="-1"></a>             <span class="at">family =</span> <span class="st">&quot;gaussian&quot;</span>,</span>
<span id="cb1171-5"><a href="models-with-memory.html#cb1171-5" aria-hidden="true" tabindex="-1"></a>             <span class="at">formula =</span> y <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb1171-6"><a href="models-with-memory.html#cb1171-6" aria-hidden="true" tabindex="-1"></a>             <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">10</span>,<span class="dv">1</span>), <span class="at">class =</span> Intercept),</span>
<span id="cb1171-7"><a href="models-with-memory.html#cb1171-7" aria-hidden="true" tabindex="-1"></a>                       <span class="fu">prior</span>(<span class="fu">constant</span>(<span class="dv">1</span>), <span class="at">class =</span> sigma)),</span>
<span id="cb1171-8"><a href="models-with-memory.html#cb1171-8" aria-hidden="true" tabindex="-1"></a>             <span class="at">backend =</span> <span class="st">&quot;cmdstanr&quot;</span>,</span>
<span id="cb1171-9"><a href="models-with-memory.html#cb1171-9" aria-hidden="true" tabindex="-1"></a>             <span class="at">file =</span> <span class="st">&quot;output/Chapter13/b13M6_a&quot;</span>)</span>
<span id="cb1171-10"><a href="models-with-memory.html#cb1171-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1171-11"><a href="models-with-memory.html#cb1171-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1171-12"><a href="models-with-memory.html#cb1171-12" aria-hidden="true" tabindex="-1"></a>b13M6_b <span class="ot">&lt;-</span> <span class="fu">brm</span>(<span class="at">data =</span> d3,</span>
<span id="cb1171-13"><a href="models-with-memory.html#cb1171-13" aria-hidden="true" tabindex="-1"></a>             <span class="at">family =</span> student,</span>
<span id="cb1171-14"><a href="models-with-memory.html#cb1171-14" aria-hidden="true" tabindex="-1"></a>             <span class="at">formula =</span> y <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb1171-15"><a href="models-with-memory.html#cb1171-15" aria-hidden="true" tabindex="-1"></a>             <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="st">&quot;constant(2)&quot;</span>, <span class="at">class =</span> <span class="st">&quot;nu&quot;</span>),</span>
<span id="cb1171-16"><a href="models-with-memory.html#cb1171-16" aria-hidden="true" tabindex="-1"></a>                       <span class="fu">prior</span>(<span class="st">&quot;constant(1)&quot;</span>, <span class="at">class =</span> <span class="st">&quot;sigma&quot;</span>),</span>
<span id="cb1171-17"><a href="models-with-memory.html#cb1171-17" aria-hidden="true" tabindex="-1"></a>                       <span class="fu">prior</span>(<span class="st">&quot;normal(10,1)&quot;</span>,<span class="at">class=</span> <span class="st">&quot;Intercept&quot;</span>)),</span>
<span id="cb1171-18"><a href="models-with-memory.html#cb1171-18" aria-hidden="true" tabindex="-1"></a>             <span class="at">seed =</span><span class="dv">13</span>,          </span>
<span id="cb1171-19"><a href="models-with-memory.html#cb1171-19" aria-hidden="true" tabindex="-1"></a>             <span class="at">backend =</span> <span class="st">&quot;cmdstanr&quot;</span>,</span>
<span id="cb1171-20"><a href="models-with-memory.html#cb1171-20" aria-hidden="true" tabindex="-1"></a>             <span class="at">file =</span> <span class="st">&quot;output/Chapter13/b13M6_b&quot;</span>)</span>
<span id="cb1171-21"><a href="models-with-memory.html#cb1171-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1171-22"><a href="models-with-memory.html#cb1171-22" aria-hidden="true" tabindex="-1"></a>b13M6_c <span class="ot">&lt;-</span> <span class="fu">brm</span>(<span class="at">data =</span> d3,</span>
<span id="cb1171-23"><a href="models-with-memory.html#cb1171-23" aria-hidden="true" tabindex="-1"></a>             <span class="at">family =</span> gaussian,</span>
<span id="cb1171-24"><a href="models-with-memory.html#cb1171-24" aria-hidden="true" tabindex="-1"></a>             <span class="at">formula =</span> y <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb1171-25"><a href="models-with-memory.html#cb1171-25" aria-hidden="true" tabindex="-1"></a>             <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">constant</span>(<span class="dv">1</span>), <span class="at">class =</span> sigma),</span>
<span id="cb1171-26"><a href="models-with-memory.html#cb1171-26" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">prior</span>(<span class="fu">student_t</span>(<span class="dv">2</span>,<span class="dv">10</span>,<span class="dv">1</span>),<span class="at">class=</span>Intercept)),</span>
<span id="cb1171-27"><a href="models-with-memory.html#cb1171-27" aria-hidden="true" tabindex="-1"></a>             <span class="at">seed =</span><span class="dv">13</span>,          </span>
<span id="cb1171-28"><a href="models-with-memory.html#cb1171-28" aria-hidden="true" tabindex="-1"></a>             <span class="at">backend =</span> <span class="st">&quot;cmdstanr&quot;</span>,</span>
<span id="cb1171-29"><a href="models-with-memory.html#cb1171-29" aria-hidden="true" tabindex="-1"></a>             <span class="at">file =</span> <span class="st">&quot;output/Chapter13/b13M6_c&quot;</span>)</span>
<span id="cb1171-30"><a href="models-with-memory.html#cb1171-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1171-31"><a href="models-with-memory.html#cb1171-31" aria-hidden="true" tabindex="-1"></a>b13M6_d <span class="ot">&lt;-</span> <span class="fu">brm</span>(<span class="at">data =</span> d3,</span>
<span id="cb1171-32"><a href="models-with-memory.html#cb1171-32" aria-hidden="true" tabindex="-1"></a>             <span class="at">family =</span> student,</span>
<span id="cb1171-33"><a href="models-with-memory.html#cb1171-33" aria-hidden="true" tabindex="-1"></a>             <span class="at">formula =</span> y <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb1171-34"><a href="models-with-memory.html#cb1171-34" aria-hidden="true" tabindex="-1"></a>             <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">constant</span>(<span class="dv">2</span>), <span class="at">class =</span> nu),</span>
<span id="cb1171-35"><a href="models-with-memory.html#cb1171-35" aria-hidden="true" tabindex="-1"></a>                       <span class="fu">prior</span>(<span class="fu">constant</span>(<span class="dv">1</span>), <span class="at">class =</span> sigma),</span>
<span id="cb1171-36"><a href="models-with-memory.html#cb1171-36" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">prior</span>(<span class="fu">student_t</span>(<span class="dv">2</span>,<span class="dv">10</span>,<span class="dv">1</span>),<span class="at">class=</span>Intercept)),</span>
<span id="cb1171-37"><a href="models-with-memory.html#cb1171-37" aria-hidden="true" tabindex="-1"></a>             <span class="at">seed =</span><span class="dv">13</span>,          </span>
<span id="cb1171-38"><a href="models-with-memory.html#cb1171-38" aria-hidden="true" tabindex="-1"></a>             <span class="at">backend =</span> <span class="st">&quot;cmdstanr&quot;</span>,</span>
<span id="cb1171-39"><a href="models-with-memory.html#cb1171-39" aria-hidden="true" tabindex="-1"></a>             <span class="at">file =</span> <span class="st">&quot;output/Chapter13/b13M6_d&quot;</span>)</span></code></pre></div>
3つ目のモデルのみ正しく推定できた（応答変数に正規分布、事前分布にt分布）。事前分布が真の値から離れているとうまく推定できない。一方で、応答変数の分布が広すぎてもうまく推定できない？
<table class="table" style="margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
Estimate
</th>
<th style="text-align:right;">
Est.Error
</th>
<th style="text-align:right;">
Q2.5
</th>
<th style="text-align:right;">
Q97.5
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
model NN
</td>
<td style="text-align:right;">
5.01
</td>
<td style="text-align:right;">
0.70
</td>
<td style="text-align:right;">
3.63
</td>
<td style="text-align:right;">
6.41
</td>
</tr>
<tr>
<td style="text-align:left;">
model TN
</td>
<td style="text-align:right;">
9.68
</td>
<td style="text-align:right;">
0.99
</td>
<td style="text-align:right;">
7.81
</td>
<td style="text-align:right;">
11.63
</td>
</tr>
<tr>
<td style="text-align:left;">
model NT
</td>
<td style="text-align:right;">
0.31
</td>
<td style="text-align:right;">
1.00
</td>
<td style="text-align:right;">
-1.61
</td>
<td style="text-align:right;">
2.27
</td>
</tr>
<tr>
<td style="text-align:left;">
model TT
</td>
<td style="text-align:right;">
4.44
</td>
<td style="text-align:right;">
4.51
</td>
<td style="text-align:right;">
-1.66
</td>
<td style="text-align:right;">
11.40
</td>
</tr>
</tbody>
</table>
</div>
<div id="h1-10" class="section level3 hasAnchor" number="13.7.7">
<h3><span class="header-section-number">13.7.7</span> 13H1<a href="models-with-memory.html#h1-10" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<blockquote>
<p>In 1980, a typical Bengali woman could have 5 or more children in her lifetime. By the year 2000, a typical Bengali woman had only 2 or 3. You’re going to look at a historical set of data, when contraception was widely available but many families chose not to use it. These data reside in data(bangladesh) and come from the 1988 Bangladesh Fertility Survey. Each row is one of 1934 women. There are six variables, but you can focus on three of them for this practice problem:</p>
</blockquote>
<blockquote>
<ol style="list-style-type: decimal">
<li>district: ID number of administrative district each woman resided in</li>
<li>use.contraception: An indicator (0/1) of whether the woman was using contraception</li>
<li>urban: An indicator (0/1) of whether the woman lived in a city, as opposed to living in a rural area</li>
</ol>
</blockquote>
<blockquote>
<p>The first thing to do is ensure that the cluster variable, district, is a contiguous set of integers. Recall that these values will be index values inside the model. If there are gaps, you’ll have parameters for which there is no data to inform them. Worse, the model probably won’t run. Look at the unique values of the district variable:</p>
</blockquote>
<div class="sourceCode" id="cb1172"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1172-1"><a href="models-with-memory.html#cb1172-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(bangladesh)</span>
<span id="cb1172-2"><a href="models-with-memory.html#cb1172-2" aria-hidden="true" tabindex="-1"></a>d4 <span class="ot">&lt;-</span> bangladesh</span>
<span id="cb1172-3"><a href="models-with-memory.html#cb1172-3" aria-hidden="true" tabindex="-1"></a><span class="fu">sort</span>(<span class="fu">unique</span>(d4<span class="sc">$</span>district))</span></code></pre></div>
<pre><code>##  [1]  1  2  3  4  5  6  7  8  9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25
## [26] 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50
## [51] 51 52 53 55 56 57 58 59 60 61</code></pre>
<blockquote>
<p>District 54 is absent. So district isn’t yet a good index variable, because it’s not contiguous. This is easy to fix. Just make a new variable that is contiguous. This is enough to do it:</p>
</blockquote>
<div class="sourceCode" id="cb1174"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1174-1"><a href="models-with-memory.html#cb1174-1" aria-hidden="true" tabindex="-1"></a>d4<span class="sc">$</span>district_id <span class="ot">&lt;-</span> <span class="fu">as.integer</span>(<span class="fu">as.factor</span>(d4<span class="sc">$</span>district))</span>
<span id="cb1174-2"><a href="models-with-memory.html#cb1174-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sort</span>(<span class="fu">unique</span>(d4<span class="sc">$</span>district_id))</span></code></pre></div>
<pre><code>##  [1]  1  2  3  4  5  6  7  8  9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25
## [26] 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50
## [51] 51 52 53 54 55 56 57 58 59 60</code></pre>
<blockquote>
<p>ow there are 60 values, contiguous integers 1 to 60. Now, focus on predicting use.contraception, clustered by district_id. Do not include urban just yet. Fit both (1) a traditional fixed-effects model that uses dummy variables for district and (2) a multilevel model with varying intercepts for district. Plot the predicted proportions of women in each district using contraception, for both the fixed-effects model and the varying-effects model. That is, make a plot in which district ID is on the horizontal axis and expected proportion using contraception is on the vertical. Make one plot for each model, or layer them on the same plot, as you prefer. How do the models disagree? Can you explain the pattern of disagreement? In particular, can you explain the most extreme cases of disagreement, both why they happen where they do and why the models reach different inferences?</p>
</blockquote>
<p>バングラデシュの産子数に関するデータ。<br />
- <code>district</code>: 女性の住んでいた地区。<br />
- <code>use.contraception</code>: 避妊を行ったか否か。</p>
<div class="sourceCode" id="cb1176"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1176-1"><a href="models-with-memory.html#cb1176-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;bangladesh&quot;</span>)</span>
<span id="cb1176-2"><a href="models-with-memory.html#cb1176-2" aria-hidden="true" tabindex="-1"></a>d4 <span class="ot">&lt;-</span> bangladesh</span>
<span id="cb1176-3"><a href="models-with-memory.html#cb1176-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1176-4"><a href="models-with-memory.html#cb1176-4" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(d4)</span></code></pre></div>
<pre><code>## Rows: 1,934
## Columns: 6
## $ woman             &lt;int&gt; 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 1…
## $ district          &lt;int&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1…
## $ use.contraception &lt;int&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 1…
## $ living.children   &lt;int&gt; 4, 1, 3, 4, 1, 1, 4, 4, 2, 4, 1, 1, 2, 4, 4, 4, 1, 4…
## $ age.centered      &lt;dbl&gt; 18.4400, -5.5599, 1.4400, 8.4400, -13.5590, -11.5600…
## $ urban             &lt;int&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1…</code></pre>
<p>避妊の有無が、地区によってどのくらいばらついていたのかを推定。
固定効果とランダム効果に地区名を入れたモデルをそれぞれまわす。</p>
<div class="sourceCode" id="cb1178"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1178-1"><a href="models-with-memory.html#cb1178-1" aria-hidden="true" tabindex="-1"></a>d4 <span class="sc">%&gt;%</span> </span>
<span id="cb1178-2"><a href="models-with-memory.html#cb1178-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">district =</span> <span class="fu">factor</span>(district)) <span class="ot">-&gt;</span> d4</span>
<span id="cb1178-3"><a href="models-with-memory.html#cb1178-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1178-4"><a href="models-with-memory.html#cb1178-4" aria-hidden="true" tabindex="-1"></a>b13H1a <span class="ot">&lt;-</span> <span class="fu">brm</span>(</span>
<span id="cb1178-5"><a href="models-with-memory.html#cb1178-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> d4,</span>
<span id="cb1178-6"><a href="models-with-memory.html#cb1178-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> bernoulli,</span>
<span id="cb1178-7"><a href="models-with-memory.html#cb1178-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">formula =</span> use.contraception <span class="sc">~</span> <span class="dv">0</span> <span class="sc">+</span> district,</span>
<span id="cb1178-8"><a href="models-with-memory.html#cb1178-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">prior =</span> <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>,<span class="dv">3</span>), <span class="at">class =</span> b),</span>
<span id="cb1178-9"><a href="models-with-memory.html#cb1178-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">backend =</span> <span class="st">&quot;cmdstanr&quot;</span>,</span>
<span id="cb1178-10"><a href="models-with-memory.html#cb1178-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">13</span>, <span class="at">file =</span> <span class="st">&quot;output/Chapter13/b13H1a&quot;</span></span>
<span id="cb1178-11"><a href="models-with-memory.html#cb1178-11" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1178-12"><a href="models-with-memory.html#cb1178-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1178-13"><a href="models-with-memory.html#cb1178-13" aria-hidden="true" tabindex="-1"></a>b13H1b <span class="ot">&lt;-</span> <span class="fu">brm</span>(</span>
<span id="cb1178-14"><a href="models-with-memory.html#cb1178-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> d4,</span>
<span id="cb1178-15"><a href="models-with-memory.html#cb1178-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> bernoulli,</span>
<span id="cb1178-16"><a href="models-with-memory.html#cb1178-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">formula =</span> use.contraception <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> (<span class="dv">1</span><span class="sc">|</span>district),</span>
<span id="cb1178-17"><a href="models-with-memory.html#cb1178-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>,<span class="dv">3</span>), <span class="at">class =</span> Intercept),</span>
<span id="cb1178-18"><a href="models-with-memory.html#cb1178-18" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>), <span class="at">class =</span>sd)),</span>
<span id="cb1178-19"><a href="models-with-memory.html#cb1178-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">backend =</span> <span class="st">&quot;cmdstanr&quot;</span>,</span>
<span id="cb1178-20"><a href="models-with-memory.html#cb1178-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">13</span>, <span class="at">file =</span> <span class="st">&quot;output/Chapter13/b13H1b&quot;</span></span>
<span id="cb1178-21"><a href="models-with-memory.html#cb1178-21" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p>ランダム効果モデルでは縮合が起きて、元データの平均（点線）に近づいていることが分かる。また、データ数が少ない地区（十字架が小さい地区）ほどより縮合が起きている。<br />
<img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-659-1.png" width="100%" style="display: block; margin: auto;" /></p>
</div>
<div id="h2-10" class="section level3 hasAnchor" number="13.7.8">
<h3><span class="header-section-number">13.7.8</span> 13H2<a href="models-with-memory.html#h2-10" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<blockquote>
<p>Return to the Trolley data, data(Trolley), from Chapter 12. Define and fit a varying intercepts model for these data. Cluster intercepts on individual participants, as indicated by the unique values in the id variable. Include action, intention, and contact as ordinary terms. Compare the varying intercepts model and a model that ignores individuals, using both WAIC and posterior predictions. What is the impact of individual variation in these data?</p>
</blockquote>
<p>Chapter12でも用いたトロッコ問題のデータ<span class="citation">(<a href="#ref-Cushman2006" role="doc-biblioref">Cushman et al. 2006</a>)</span>を用いる。被験者のIDをランダム効果に入れる。</p>
<div class="sourceCode" id="cb1179"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1179-1"><a href="models-with-memory.html#cb1179-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(Trolley)</span>
<span id="cb1179-2"><a href="models-with-memory.html#cb1179-2" aria-hidden="true" tabindex="-1"></a>d5 <span class="ot">&lt;-</span> Trolley</span></code></pre></div>
<div class="sourceCode" id="cb1180"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1180-1"><a href="models-with-memory.html#cb1180-1" aria-hidden="true" tabindex="-1"></a>inits <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="st">`</span><span class="at">Intercept[1]</span><span class="st">`</span> <span class="ot">=</span> <span class="sc">-</span><span class="dv">2</span>,</span>
<span id="cb1180-2"><a href="models-with-memory.html#cb1180-2" aria-hidden="true" tabindex="-1"></a>              <span class="st">`</span><span class="at">Intercept[2]</span><span class="st">`</span> <span class="ot">=</span> <span class="sc">-</span><span class="dv">1</span>,</span>
<span id="cb1180-3"><a href="models-with-memory.html#cb1180-3" aria-hidden="true" tabindex="-1"></a>              <span class="st">`</span><span class="at">Intercept[3]</span><span class="st">`</span> <span class="ot">=</span> <span class="dv">0</span>,</span>
<span id="cb1180-4"><a href="models-with-memory.html#cb1180-4" aria-hidden="true" tabindex="-1"></a>              <span class="st">`</span><span class="at">Intercept[4]</span><span class="st">`</span> <span class="ot">=</span> <span class="dv">1</span>,</span>
<span id="cb1180-5"><a href="models-with-memory.html#cb1180-5" aria-hidden="true" tabindex="-1"></a>              <span class="st">`</span><span class="at">Intercept[5]</span><span class="st">`</span> <span class="ot">=</span> <span class="dv">2</span>,</span>
<span id="cb1180-6"><a href="models-with-memory.html#cb1180-6" aria-hidden="true" tabindex="-1"></a>              <span class="st">`</span><span class="at">Intercept[6]</span><span class="st">`</span> <span class="ot">=</span> <span class="fl">2.5</span>)</span>
<span id="cb1180-7"><a href="models-with-memory.html#cb1180-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1180-8"><a href="models-with-memory.html#cb1180-8" aria-hidden="true" tabindex="-1"></a>inits_list <span class="ot">&lt;-</span> <span class="fu">list</span>(inits, inits, inits, inits)</span>
<span id="cb1180-9"><a href="models-with-memory.html#cb1180-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1180-10"><a href="models-with-memory.html#cb1180-10" aria-hidden="true" tabindex="-1"></a>b13H2 <span class="ot">&lt;-</span></span>
<span id="cb1180-11"><a href="models-with-memory.html#cb1180-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">brm</span>(<span class="at">data =</span> d5,</span>
<span id="cb1180-12"><a href="models-with-memory.html#cb1180-12" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> cumulative,</span>
<span id="cb1180-13"><a href="models-with-memory.html#cb1180-13" aria-hidden="true" tabindex="-1"></a>      response <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> action <span class="sc">+</span> contact <span class="sc">+</span> intention <span class="sc">+</span></span>
<span id="cb1180-14"><a href="models-with-memory.html#cb1180-14" aria-hidden="true" tabindex="-1"></a>        intention<span class="sc">:</span>action <span class="sc">+</span> intention<span class="sc">:</span>contact <span class="sc">+</span> (<span class="dv">1</span><span class="sc">|</span>id),</span>
<span id="cb1180-15"><a href="models-with-memory.html#cb1180-15" aria-hidden="true" tabindex="-1"></a>      <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">1.5</span>), <span class="at">class =</span> Intercept),</span>
<span id="cb1180-16"><a href="models-with-memory.html#cb1180-16" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">0.5</span>), <span class="at">class =</span> b)),</span>
<span id="cb1180-17"><a href="models-with-memory.html#cb1180-17" aria-hidden="true" tabindex="-1"></a>      <span class="at">iter =</span> <span class="dv">6500</span>, <span class="at">warmup =</span> <span class="dv">4000</span>, <span class="at">cores =</span> <span class="dv">4</span>, <span class="at">chains =</span> <span class="dv">4</span>,</span>
<span id="cb1180-18"><a href="models-with-memory.html#cb1180-18" aria-hidden="true" tabindex="-1"></a>      <span class="at">seed =</span> <span class="dv">12</span>,</span>
<span id="cb1180-19"><a href="models-with-memory.html#cb1180-19" aria-hidden="true" tabindex="-1"></a>      <span class="at">backend =</span> <span class="st">&quot;cmdstanr&quot;</span>,</span>
<span id="cb1180-20"><a href="models-with-memory.html#cb1180-20" aria-hidden="true" tabindex="-1"></a>      <span class="at">file =</span> <span class="st">&quot;output/Chapter13/b13H2&quot;</span>)</span>
<span id="cb1180-21"><a href="models-with-memory.html#cb1180-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1180-22"><a href="models-with-memory.html#cb1180-22" aria-hidden="true" tabindex="-1"></a>b12<span class="fl">.5</span> <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;output/Chapter12/b12.5.rds&quot;</span>)</span></code></pre></div>
結果は以下の通り（表<a href="models-with-memory.html#tab:res-b13H2">13.14</a>）。ランダム効果を含む方が推定値が0から離れている。これは、ランダム効果がデータのばらつきの多くを説明しているため、説明変数の効果がより明確になったから？
<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:res-b13H2">表13.14: </span>モデルの比較2
</caption>
<thead>
<tr>
<th style="empty-cells: hide;border-bottom:hidden;" colspan="1">
</th>
<th style="border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="4">
<div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
including random
</div>
</th>
<th style="border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="4">
<div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
fixed only
</div>
</th>
</tr>
<tr>
<th style="text-align:center;">
par
</th>
<th style="text-align:center;">
Estimate
</th>
<th style="text-align:center;">
SE
</th>
<th style="text-align:center;">
Q2.5
</th>
<th style="text-align:center;">
Q97.5
</th>
<th style="text-align:center;">
Estimate
</th>
<th style="text-align:center;">
SE
</th>
<th style="text-align:center;">
Q2.5
</th>
<th style="text-align:center;">
Q97.5
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center;">
b_Intercept[1]
</td>
<td style="text-align:center;">
-3.73
</td>
<td style="text-align:center;">
0.12
</td>
<td style="text-align:center;">
-3.96
</td>
<td style="text-align:center;">
-3.49
</td>
<td style="text-align:center;">
-2.64
</td>
<td style="text-align:center;">
0.05
</td>
<td style="text-align:center;">
-2.74
</td>
<td style="text-align:center;">
-2.54
</td>
</tr>
<tr>
<td style="text-align:center;">
b_Intercept[2]
</td>
<td style="text-align:center;">
-2.78
</td>
<td style="text-align:center;">
0.12
</td>
<td style="text-align:center;">
-3.01
</td>
<td style="text-align:center;">
-2.55
</td>
<td style="text-align:center;">
-1.94
</td>
<td style="text-align:center;">
0.05
</td>
<td style="text-align:center;">
-2.04
</td>
<td style="text-align:center;">
-1.85
</td>
</tr>
<tr>
<td style="text-align:center;">
b_Intercept[3]
</td>
<td style="text-align:center;">
-1.97
</td>
<td style="text-align:center;">
0.12
</td>
<td style="text-align:center;">
-2.20
</td>
<td style="text-align:center;">
-1.75
</td>
<td style="text-align:center;">
-1.35
</td>
<td style="text-align:center;">
0.05
</td>
<td style="text-align:center;">
-1.44
</td>
<td style="text-align:center;">
-1.26
</td>
</tr>
<tr>
<td style="text-align:center;">
b_Intercept[4]
</td>
<td style="text-align:center;">
-0.47
</td>
<td style="text-align:center;">
0.11
</td>
<td style="text-align:center;">
-0.70
</td>
<td style="text-align:center;">
-0.25
</td>
<td style="text-align:center;">
-0.31
</td>
<td style="text-align:center;">
0.04
</td>
<td style="text-align:center;">
-0.4
</td>
<td style="text-align:center;">
-0.23
</td>
</tr>
<tr>
<td style="text-align:center;">
b_Intercept[5]
</td>
<td style="text-align:center;">
0.58
</td>
<td style="text-align:center;">
0.11
</td>
<td style="text-align:center;">
0.35
</td>
<td style="text-align:center;">
0.80
</td>
<td style="text-align:center;">
0.36
</td>
<td style="text-align:center;">
0.04
</td>
<td style="text-align:center;">
0.27
</td>
<td style="text-align:center;">
0.45
</td>
</tr>
<tr>
<td style="text-align:center;">
b_Intercept[6]
</td>
<td style="text-align:center;">
1.99
</td>
<td style="text-align:center;">
0.12
</td>
<td style="text-align:center;">
1.76
</td>
<td style="text-align:center;">
2.22
</td>
<td style="text-align:center;">
1.26
</td>
<td style="text-align:center;">
0.05
</td>
<td style="text-align:center;">
1.17
</td>
<td style="text-align:center;">
1.36
</td>
</tr>
<tr>
<td style="text-align:center;">
b_action
</td>
<td style="text-align:center;">
-0.65
</td>
<td style="text-align:center;">
0.06
</td>
<td style="text-align:center;">
-0.77
</td>
<td style="text-align:center;">
-0.55
</td>
<td style="text-align:center;">
-0.48
</td>
<td style="text-align:center;">
0.05
</td>
<td style="text-align:center;">
-0.58
</td>
<td style="text-align:center;">
-0.37
</td>
</tr>
<tr>
<td style="text-align:center;">
b_contact
</td>
<td style="text-align:center;">
-0.46
</td>
<td style="text-align:center;">
0.07
</td>
<td style="text-align:center;">
-0.60
</td>
<td style="text-align:center;">
-0.32
</td>
<td style="text-align:center;">
-0.34
</td>
<td style="text-align:center;">
0.07
</td>
<td style="text-align:center;">
-0.48
</td>
<td style="text-align:center;">
-0.21
</td>
</tr>
<tr>
<td style="text-align:center;">
b_intention
</td>
<td style="text-align:center;">
-0.39
</td>
<td style="text-align:center;">
0.06
</td>
<td style="text-align:center;">
-0.51
</td>
<td style="text-align:center;">
-0.27
</td>
<td style="text-align:center;">
-0.29
</td>
<td style="text-align:center;">
0.06
</td>
<td style="text-align:center;">
-0.41
</td>
<td style="text-align:center;">
-0.18
</td>
</tr>
<tr>
<td style="text-align:center;">
b_action:intention
</td>
<td style="text-align:center;">
-0.55
</td>
<td style="text-align:center;">
0.08
</td>
<td style="text-align:center;">
-0.71
</td>
<td style="text-align:center;">
-0.39
</td>
<td style="text-align:center;">
-0.43
</td>
<td style="text-align:center;">
0.08
</td>
<td style="text-align:center;">
-0.59
</td>
<td style="text-align:center;">
-0.27
</td>
</tr>
<tr>
<td style="text-align:center;">
b_contact:intention
</td>
<td style="text-align:center;">
-1.66
</td>
<td style="text-align:center;">
0.10
</td>
<td style="text-align:center;">
-1.86
</td>
<td style="text-align:center;">
-1.46
</td>
<td style="text-align:center;">
-1.23
</td>
<td style="text-align:center;">
0.1
</td>
<td style="text-align:center;">
-1.42
</td>
<td style="text-align:center;">
-1.04
</td>
</tr>
<tr>
<td style="text-align:center;">
sd_id__Intercept
</td>
<td style="text-align:center;">
1.92
</td>
<td style="text-align:center;">
0.08
</td>
<td style="text-align:center;">
1.76
</td>
<td style="text-align:center;">
2.08
</td>
<td style="text-align:center;">
<ul>
<li></td>
<td style="text-align:center;">
<ul>
<li></td>
<td style="text-align:center;">
<ul>
<li></td>
<td style="text-align:center;">
<ul>
<li></td>
</tr>
</tbody>
</table></li>
</ul></li>
</ul></li>
</ul></li>
</ul>
<p>予測分布を描くと以下の通り。
<img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-662-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>最後に、WAICを比較すると以下の通り。圧倒的にランダム効果を含んだ方がよい。</p>
<div class="sourceCode" id="cb1181"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1181-1"><a href="models-with-memory.html#cb1181-1" aria-hidden="true" tabindex="-1"></a>b12<span class="fl">.5</span> <span class="ot">&lt;-</span> <span class="fu">add_criterion</span>(b12<span class="fl">.5</span>, <span class="st">&quot;waic&quot;</span>)</span>
<span id="cb1181-2"><a href="models-with-memory.html#cb1181-2" aria-hidden="true" tabindex="-1"></a>b13H2 <span class="ot">&lt;-</span> <span class="fu">add_criterion</span>(b13H2, <span class="st">&quot;waic&quot;</span>)</span>
<span id="cb1181-3"><a href="models-with-memory.html#cb1181-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1181-4"><a href="models-with-memory.html#cb1181-4" aria-hidden="true" tabindex="-1"></a><span class="fu">loo_compare</span>(b12<span class="fl">.5</span>, b13H2, <span class="at">criterion=</span><span class="st">&quot;waic&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1181-5"><a href="models-with-memory.html#cb1181-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="at">simplify =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1181-6"><a href="models-with-memory.html#cb1181-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="at">booktabs =</span> <span class="cn">TRUE</span>,</span>
<span id="cb1181-7"><a href="models-with-memory.html#cb1181-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">digits=</span><span class="dv">2</span>) <span class="sc">%&gt;%</span></span>
<span id="cb1181-8"><a href="models-with-memory.html#cb1181-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">latex_options =</span> <span class="fu">c</span>(<span class="st">&quot;striped&quot;</span>,<span class="st">&quot;hold_position&quot;</span>))</span></code></pre></div>
<pre><code>##       elpd_diff se_diff  elpd_waic se_elpd_waic p_waic   se_p_waic waic    
## b13H2      0.0       0.0 -15528.8      89.7        356.2      4.7   31057.5
## b12.5  -2935.8      86.8 -18464.5      40.4         10.9      0.1   36929.0
##       se_waic 
## b13H2    179.5
## b12.5     80.7</code></pre>
<table class="table" style="margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
elpd_diff
</th>
<th style="text-align:right;">
se_diff
</th>
<th style="text-align:right;">
elpd_waic
</th>
<th style="text-align:right;">
se_elpd_waic
</th>
<th style="text-align:right;">
p_waic
</th>
<th style="text-align:right;">
se_p_waic
</th>
<th style="text-align:right;">
waic
</th>
<th style="text-align:right;">
se_waic
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
b13H2
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;">
0.0
</td>
<td style="text-align:right;">
-15528.75
</td>
<td style="text-align:right;">
89.73
</td>
<td style="text-align:right;">
356.24
</td>
<td style="text-align:right;">
4.68
</td>
<td style="text-align:right;">
31057.50
</td>
<td style="text-align:right;">
179.46
</td>
</tr>
<tr>
<td style="text-align:left;">
b12.5
</td>
<td style="text-align:right;">
-2935.75
</td>
<td style="text-align:right;">
86.8
</td>
<td style="text-align:right;">
-18464.50
</td>
<td style="text-align:right;">
40.37
</td>
<td style="text-align:right;">
10.85
</td>
<td style="text-align:right;">
0.06
</td>
<td style="text-align:right;">
36929.01
</td>
<td style="text-align:right;">
80.75
</td>
</tr>
</tbody>
</table>
</div>
<div id="h3-10" class="section level3 hasAnchor" number="13.7.9">
<h3><span class="header-section-number">13.7.9</span> 13H3<a href="models-with-memory.html#h3-10" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<blockquote>
<p>The Trolley data are also clustered by story, which indicates a unique narrative for each vignette. Define and fit a cross-classified varying intercepts model with both id and story. Use the same ordinary terms as in the previous problem. Compare this model to the previous models. What do you infer about the impact of different stories on responses?</p>
</blockquote>
<p>先ほどのモデルに、<code>story</code>もランダム効果に加える。</p>
<div class="sourceCode" id="cb1183"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1183-1"><a href="models-with-memory.html#cb1183-1" aria-hidden="true" tabindex="-1"></a>b13H3 <span class="ot">&lt;-</span></span>
<span id="cb1183-2"><a href="models-with-memory.html#cb1183-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">brm</span>(<span class="at">data =</span> d5,</span>
<span id="cb1183-3"><a href="models-with-memory.html#cb1183-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> cumulative,</span>
<span id="cb1183-4"><a href="models-with-memory.html#cb1183-4" aria-hidden="true" tabindex="-1"></a>      response <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> action <span class="sc">+</span> contact <span class="sc">+</span> intention <span class="sc">+</span></span>
<span id="cb1183-5"><a href="models-with-memory.html#cb1183-5" aria-hidden="true" tabindex="-1"></a>        intention<span class="sc">:</span>action <span class="sc">+</span> intention<span class="sc">:</span>contact <span class="sc">+</span> </span>
<span id="cb1183-6"><a href="models-with-memory.html#cb1183-6" aria-hidden="true" tabindex="-1"></a>        (<span class="dv">1</span><span class="sc">|</span>id) <span class="sc">+</span>(<span class="dv">1</span><span class="sc">|</span>story),</span>
<span id="cb1183-7"><a href="models-with-memory.html#cb1183-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">1.5</span>), <span class="at">class =</span> Intercept),</span>
<span id="cb1183-8"><a href="models-with-memory.html#cb1183-8" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">0.5</span>), <span class="at">class =</span> b)),</span>
<span id="cb1183-9"><a href="models-with-memory.html#cb1183-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">iter =</span> <span class="dv">6500</span>, <span class="at">warmup =</span> <span class="dv">5000</span>, <span class="at">cores =</span> <span class="dv">4</span>, <span class="at">chains =</span> <span class="dv">4</span>,</span>
<span id="cb1183-10"><a href="models-with-memory.html#cb1183-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">seed =</span> <span class="dv">12</span>,</span>
<span id="cb1183-11"><a href="models-with-memory.html#cb1183-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">backend =</span> <span class="st">&quot;cmdstanr&quot;</span>,</span>
<span id="cb1183-12"><a href="models-with-memory.html#cb1183-12" aria-hidden="true" tabindex="-1"></a>      <span class="at">file =</span> <span class="st">&quot;output/Chapter13/b13H3&quot;</span>)</span>
<span id="cb1183-13"><a href="models-with-memory.html#cb1183-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1183-14"><a href="models-with-memory.html#cb1183-14" aria-hidden="true" tabindex="-1"></a>b13H3 <span class="sc">%&gt;%</span> </span>
<span id="cb1183-15"><a href="models-with-memory.html#cb1183-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">posterior_summary</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1183-16"><a href="models-with-memory.html#cb1183-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1183-17"><a href="models-with-memory.html#cb1183-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>(<span class="at">var =</span> <span class="st">&quot;par&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1183-18"><a href="models-with-memory.html#cb1183-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">str_detect</span>(par,<span class="st">&quot;b_|sd&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1183-19"><a href="models-with-memory.html#cb1183-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_names</span>(<span class="fu">c</span>(<span class="st">&quot;par&quot;</span>,<span class="st">&quot;Est_r2&quot;</span>,<span class="st">&quot;SE_r2&quot;</span>,<span class="st">&quot;Q2.5_r2&quot;</span>,<span class="st">&quot;Q97.5_r2&quot;</span>)) <span class="ot">-&gt;</span> r_random2</span></code></pre></div>
<p><code>id</code>のみをランダム効果に入れたモデルとの比較は以下の通り（表<a href="models-with-memory.html#tab:res-b13H3">13.15</a>）。少し推定値に違いが出ている。</p>
<div class="sourceCode" id="cb1184"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1184-1"><a href="models-with-memory.html#cb1184-1" aria-hidden="true" tabindex="-1"></a>r_random2  <span class="sc">%&gt;%</span> </span>
<span id="cb1184-2"><a href="models-with-memory.html#cb1184-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">full_join</span>(r_random) <span class="sc">%&gt;%</span> </span>
<span id="cb1184-3"><a href="models-with-memory.html#cb1184-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">where</span>(is.numeric), <span class="sc">~</span> <span class="fu">round</span>(.x,<span class="dv">2</span>)))<span class="ot">-&gt;</span> r_full2</span>
<span id="cb1184-4"><a href="models-with-memory.html#cb1184-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1184-5"><a href="models-with-memory.html#cb1184-5" aria-hidden="true" tabindex="-1"></a>r_full2[<span class="fu">is.na</span>(r_full2)] <span class="ot">&lt;-</span> <span class="st">&quot;-&quot;</span></span>
<span id="cb1184-6"><a href="models-with-memory.html#cb1184-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1184-7"><a href="models-with-memory.html#cb1184-7" aria-hidden="true" tabindex="-1"></a>r_full2 <span class="sc">%&gt;%</span> </span>
<span id="cb1184-8"><a href="models-with-memory.html#cb1184-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="at">booktabs =</span> <span class="cn">TRUE</span>, </span>
<span id="cb1184-9"><a href="models-with-memory.html#cb1184-9" aria-hidden="true" tabindex="-1"></a>        <span class="at">caption =</span> <span class="st">&quot;モデルの比較3&quot;</span>,</span>
<span id="cb1184-10"><a href="models-with-memory.html#cb1184-10" aria-hidden="true" tabindex="-1"></a>        <span class="at">digits =</span><span class="dv">2</span>,</span>
<span id="cb1184-11"><a href="models-with-memory.html#cb1184-11" aria-hidden="true" tabindex="-1"></a>        <span class="at">col.names =</span> <span class="fu">c</span>(<span class="st">&quot;par&quot;</span>, <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">&quot;Estimate&quot;</span>,<span class="st">&quot;SE&quot;</span>,<span class="st">&quot;Q2.5&quot;</span>,<span class="st">&quot;Q97.5&quot;</span>),<span class="dv">2</span>)),</span>
<span id="cb1184-12"><a href="models-with-memory.html#cb1184-12" aria-hidden="true" tabindex="-1"></a>          <span class="at">align =</span> <span class="st">&quot;c&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1184-13"><a href="models-with-memory.html#cb1184-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_header_above</span>(<span class="fu">c</span>(<span class="st">&quot;&quot;</span>, <span class="st">&quot;id + story&quot;</span><span class="ot">=</span><span class="dv">4</span>, <span class="st">&quot;id only&quot;</span><span class="ot">=</span><span class="dv">4</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1184-14"><a href="models-with-memory.html#cb1184-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">latex_options =</span> <span class="fu">c</span>(<span class="st">&quot;striped&quot;</span>,<span class="st">&quot;hold_position&quot;</span>,</span>
<span id="cb1184-15"><a href="models-with-memory.html#cb1184-15" aria-hidden="true" tabindex="-1"></a>                                  <span class="st">&quot;repeat_header&quot;</span>,<span class="st">&quot;scale_down&quot;</span>))</span></code></pre></div>
<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:res-b13H3">表13.15: </span>モデルの比較3
</caption>
<thead>
<tr>
<th style="empty-cells: hide;border-bottom:hidden;" colspan="1">
</th>
<th style="border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="4">
<div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
id + story
</div>
</th>
<th style="border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="4">
<div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
id only
</div>
</th>
</tr>
<tr>
<th style="text-align:center;">
par
</th>
<th style="text-align:center;">
Estimate
</th>
<th style="text-align:center;">
SE
</th>
<th style="text-align:center;">
Q2.5
</th>
<th style="text-align:center;">
Q97.5
</th>
<th style="text-align:center;">
Estimate
</th>
<th style="text-align:center;">
SE
</th>
<th style="text-align:center;">
Q2.5
</th>
<th style="text-align:center;">
Q97.5
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center;">
b_Intercept[1]
</td>
<td style="text-align:center;">
-4.04
</td>
<td style="text-align:center;">
0.20
</td>
<td style="text-align:center;">
-4.43
</td>
<td style="text-align:center;">
-3.65
</td>
<td style="text-align:center;">
-3.73
</td>
<td style="text-align:center;">
0.12
</td>
<td style="text-align:center;">
-3.96
</td>
<td style="text-align:center;">
-3.49
</td>
</tr>
<tr>
<td style="text-align:center;">
b_Intercept[2]
</td>
<td style="text-align:center;">
-3.07
</td>
<td style="text-align:center;">
0.20
</td>
<td style="text-align:center;">
-3.45
</td>
<td style="text-align:center;">
-2.68
</td>
<td style="text-align:center;">
-2.78
</td>
<td style="text-align:center;">
0.12
</td>
<td style="text-align:center;">
-3.01
</td>
<td style="text-align:center;">
-2.55
</td>
</tr>
<tr>
<td style="text-align:center;">
b_Intercept[3]
</td>
<td style="text-align:center;">
-2.24
</td>
<td style="text-align:center;">
0.20
</td>
<td style="text-align:center;">
-2.62
</td>
<td style="text-align:center;">
-1.86
</td>
<td style="text-align:center;">
-1.97
</td>
<td style="text-align:center;">
0.12
</td>
<td style="text-align:center;">
-2.2
</td>
<td style="text-align:center;">
-1.75
</td>
</tr>
<tr>
<td style="text-align:center;">
b_Intercept[4]
</td>
<td style="text-align:center;">
-0.69
</td>
<td style="text-align:center;">
0.20
</td>
<td style="text-align:center;">
-1.06
</td>
<td style="text-align:center;">
-0.31
</td>
<td style="text-align:center;">
-0.47
</td>
<td style="text-align:center;">
0.11
</td>
<td style="text-align:center;">
-0.7
</td>
<td style="text-align:center;">
-0.25
</td>
</tr>
<tr>
<td style="text-align:center;">
b_Intercept[5]
</td>
<td style="text-align:center;">
0.40
</td>
<td style="text-align:center;">
0.20
</td>
<td style="text-align:center;">
0.02
</td>
<td style="text-align:center;">
0.77
</td>
<td style="text-align:center;">
0.58
</td>
<td style="text-align:center;">
0.11
</td>
<td style="text-align:center;">
0.35
</td>
<td style="text-align:center;">
0.8
</td>
</tr>
<tr>
<td style="text-align:center;">
b_Intercept[6]
</td>
<td style="text-align:center;">
1.84
</td>
<td style="text-align:center;">
0.20
</td>
<td style="text-align:center;">
1.46
</td>
<td style="text-align:center;">
2.22
</td>
<td style="text-align:center;">
1.99
</td>
<td style="text-align:center;">
0.12
</td>
<td style="text-align:center;">
1.76
</td>
<td style="text-align:center;">
2.22
</td>
</tr>
<tr>
<td style="text-align:center;">
b_action
</td>
<td style="text-align:center;">
-0.90
</td>
<td style="text-align:center;">
0.07
</td>
<td style="text-align:center;">
-1.04
</td>
<td style="text-align:center;">
-0.77
</td>
<td style="text-align:center;">
-0.65
</td>
<td style="text-align:center;">
0.06
</td>
<td style="text-align:center;">
-0.77
</td>
<td style="text-align:center;">
-0.55
</td>
</tr>
<tr>
<td style="text-align:center;">
b_contact
</td>
<td style="text-align:center;">
-1.09
</td>
<td style="text-align:center;">
0.10
</td>
<td style="text-align:center;">
-1.28
</td>
<td style="text-align:center;">
-0.90
</td>
<td style="text-align:center;">
-0.46
</td>
<td style="text-align:center;">
0.07
</td>
<td style="text-align:center;">
-0.6
</td>
<td style="text-align:center;">
-0.32
</td>
</tr>
<tr>
<td style="text-align:center;">
b_intention
</td>
<td style="text-align:center;">
-0.47
</td>
<td style="text-align:center;">
0.07
</td>
<td style="text-align:center;">
-0.60
</td>
<td style="text-align:center;">
-0.33
</td>
<td style="text-align:center;">
-0.39
</td>
<td style="text-align:center;">
0.06
</td>
<td style="text-align:center;">
-0.51
</td>
<td style="text-align:center;">
-0.27
</td>
</tr>
<tr>
<td style="text-align:center;">
b_action:intention
</td>
<td style="text-align:center;">
-0.52
</td>
<td style="text-align:center;">
0.08
</td>
<td style="text-align:center;">
-0.69
</td>
<td style="text-align:center;">
-0.36
</td>
<td style="text-align:center;">
-0.55
</td>
<td style="text-align:center;">
0.08
</td>
<td style="text-align:center;">
-0.71
</td>
<td style="text-align:center;">
-0.39
</td>
</tr>
<tr>
<td style="text-align:center;">
b_contact:intention
</td>
<td style="text-align:center;">
-1.28
</td>
<td style="text-align:center;">
0.11
</td>
<td style="text-align:center;">
-1.49
</td>
<td style="text-align:center;">
-1.06
</td>
<td style="text-align:center;">
-1.66
</td>
<td style="text-align:center;">
0.1
</td>
<td style="text-align:center;">
-1.86
</td>
<td style="text-align:center;">
-1.46
</td>
</tr>
<tr>
<td style="text-align:center;">
sd_id__Intercept
</td>
<td style="text-align:center;">
1.98
</td>
<td style="text-align:center;">
0.08
</td>
<td style="text-align:center;">
1.81
</td>
<td style="text-align:center;">
2.15
</td>
<td style="text-align:center;">
1.92
</td>
<td style="text-align:center;">
0.08
</td>
<td style="text-align:center;">
1.76
</td>
<td style="text-align:center;">
2.08
</td>
</tr>
<tr>
<td style="text-align:center;">
sd_story__Intercept
</td>
<td style="text-align:center;">
0.55
</td>
<td style="text-align:center;">
0.14
</td>
<td style="text-align:center;">
0.35
</td>
<td style="text-align:center;">
0.89
</td>
<td style="text-align:center;">
<ul>
<li></td>
<td style="text-align:center;">
<ul>
<li></td>
<td style="text-align:center;">
<ul>
<li></td>
<td style="text-align:center;">
<ul>
<li></td>
</tr>
</tbody>
</table></li>
</ul></li>
</ul></li>
</ul></li>
</ul>
<p>WAIを比較すると以下の通り。<code>story</code>もランダム効果に含んだモデルの方が少しだけ良い。</p>
<div class="sourceCode" id="cb1185"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1185-1"><a href="models-with-memory.html#cb1185-1" aria-hidden="true" tabindex="-1"></a>b13H3 <span class="ot">&lt;-</span> <span class="fu">add_criterion</span>(b13H3, <span class="st">&quot;waic&quot;</span>)</span>
<span id="cb1185-2"><a href="models-with-memory.html#cb1185-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1185-3"><a href="models-with-memory.html#cb1185-3" aria-hidden="true" tabindex="-1"></a><span class="fu">loo_compare</span>(b13H3, b13H2, <span class="at">criterion=</span><span class="st">&quot;waic&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1185-4"><a href="models-with-memory.html#cb1185-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="at">simplify =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1185-5"><a href="models-with-memory.html#cb1185-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="at">booktabs =</span> <span class="cn">TRUE</span>,</span>
<span id="cb1185-6"><a href="models-with-memory.html#cb1185-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">digits=</span><span class="dv">2</span>) <span class="sc">%&gt;%</span></span>
<span id="cb1185-7"><a href="models-with-memory.html#cb1185-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">latex_options =</span> <span class="fu">c</span>(<span class="st">&quot;striped&quot;</span>,<span class="st">&quot;hold_position&quot;</span>))</span></code></pre></div>
<pre><code>##       elpd_diff se_diff  elpd_waic se_elpd_waic p_waic   se_p_waic waic    
## b13H3      0.0       0.0 -15283.5      90.2        366.7      4.8   30567.0
## b13H2   -245.2      21.3 -15528.8      89.7        356.2      4.7   31057.5
##       se_waic 
## b13H3    180.5
## b13H2    179.5</code></pre>
<table class="table" style="margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
elpd_diff
</th>
<th style="text-align:right;">
se_diff
</th>
<th style="text-align:right;">
elpd_waic
</th>
<th style="text-align:right;">
se_elpd_waic
</th>
<th style="text-align:right;">
p_waic
</th>
<th style="text-align:right;">
se_p_waic
</th>
<th style="text-align:right;">
waic
</th>
<th style="text-align:right;">
se_waic
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
b13H3
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;">
-15283.51
</td>
<td style="text-align:right;">
90.24
</td>
<td style="text-align:right;">
366.75
</td>
<td style="text-align:right;">
4.80
</td>
<td style="text-align:right;">
30567.03
</td>
<td style="text-align:right;">
180.47
</td>
</tr>
<tr>
<td style="text-align:left;">
b13H2
</td>
<td style="text-align:right;">
-245.24
</td>
<td style="text-align:right;">
21.33
</td>
<td style="text-align:right;">
-15528.75
</td>
<td style="text-align:right;">
89.73
</td>
<td style="text-align:right;">
356.24
</td>
<td style="text-align:right;">
4.68
</td>
<td style="text-align:right;">
31057.50
</td>
<td style="text-align:right;">
179.46
</td>
</tr>
</tbody>
</table>
</div>
<div id="h4-10" class="section level3 hasAnchor" number="13.7.10">
<h3><span class="header-section-number">13.7.10</span> 13H4<a href="models-with-memory.html#h4-10" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<blockquote>
<p>Revisit the Reed frog survival data, <code>data(reedfrogs)</code>, and add the <code>predation</code> and <code>size</code> treatmenr variables to the varying intercepts model. Consider models with either predictor alone, both predictors, as well as a model including their interactions. What do you infer about the causal influence of these predictor variables? Also focus on the inferred variation across tanks (th <span class="math inline">\(\sigma\)</span> across tanks). Explain why it changes as it does across models with different predictors included.</p>
</blockquote>
<p>再び<code>reed frog</code>データで、<code>pred</code>と<code>size</code>もランダム効果に入れてみる。</p>
<div class="sourceCode" id="cb1187"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1187-1"><a href="models-with-memory.html#cb1187-1" aria-hidden="true" tabindex="-1"></a>b13H4 <span class="ot">&lt;-</span> </span>
<span id="cb1187-2"><a href="models-with-memory.html#cb1187-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">brm</span>(<span class="at">data =</span>dd,</span>
<span id="cb1187-3"><a href="models-with-memory.html#cb1187-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> binomial,</span>
<span id="cb1187-4"><a href="models-with-memory.html#cb1187-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">formula =</span> surv<span class="sc">|</span><span class="fu">trials</span>(density) <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> (<span class="dv">1</span><span class="sc">|</span>tank) <span class="sc">+</span> (<span class="dv">1</span><span class="sc">|</span>size)<span class="sc">+</span></span>
<span id="cb1187-5"><a href="models-with-memory.html#cb1187-5" aria-hidden="true" tabindex="-1"></a>        (<span class="dv">1</span><span class="sc">|</span>pred),</span>
<span id="cb1187-6"><a href="models-with-memory.html#cb1187-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>,<span class="fl">1.5</span>), <span class="at">class =</span> Intercept),</span>
<span id="cb1187-7"><a href="models-with-memory.html#cb1187-7" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>), <span class="at">class =</span> sd)),</span>
<span id="cb1187-8"><a href="models-with-memory.html#cb1187-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">control =</span> <span class="fu">list</span>(<span class="at">adapt_delta =</span>.<span class="dv">999</span>),</span>
<span id="cb1187-9"><a href="models-with-memory.html#cb1187-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">iter =</span> <span class="dv">6000</span>, <span class="at">warmup=</span><span class="dv">5000</span>,</span>
<span id="cb1187-10"><a href="models-with-memory.html#cb1187-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">seed =</span> <span class="dv">15</span>, <span class="at">file =</span> <span class="st">&quot;output/Chapter13/b13H4&quot;</span>,</span>
<span id="cb1187-11"><a href="models-with-memory.html#cb1187-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">backend =</span> <span class="st">&quot;cmdstanr&quot;</span>,</span>
<span id="cb1187-12"><a href="models-with-memory.html#cb1187-12" aria-hidden="true" tabindex="-1"></a>      )</span></code></pre></div>
<p>これまでのモデルと比較する（表<a href="models-with-memory.html#tab:comp-waic2">13.16</a>）。そこまで大きな違いはない。</p>
<div class="sourceCode" id="cb1188"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1188-1"><a href="models-with-memory.html#cb1188-1" aria-hidden="true" tabindex="-1"></a>b13H4 <span class="ot">&lt;-</span> <span class="fu">add_criterion</span>(b13H4, <span class="st">&quot;waic&quot;</span>)</span>
<span id="cb1188-2"><a href="models-with-memory.html#cb1188-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1188-3"><a href="models-with-memory.html#cb1188-3" aria-hidden="true" tabindex="-1"></a><span class="fu">loo_compare</span>(b13M1a,b13M1b,b13M1c,b13M1d, b13H4,<span class="at">criterion=</span><span class="st">&quot;waic&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1188-4"><a href="models-with-memory.html#cb1188-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="at">simplify =</span> F) <span class="sc">%&gt;%</span> </span>
<span id="cb1188-5"><a href="models-with-memory.html#cb1188-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="at">digits =</span> <span class="dv">2</span>,</span>
<span id="cb1188-6"><a href="models-with-memory.html#cb1188-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">booktabs =</span> <span class="cn">TRUE</span>,</span>
<span id="cb1188-7"><a href="models-with-memory.html#cb1188-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">caption =</span> <span class="st">&quot;WAICの比較2。&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1188-8"><a href="models-with-memory.html#cb1188-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">latex_options =</span> <span class="fu">c</span>(<span class="st">&quot;striped&quot;</span>, <span class="st">&quot;hold_position&quot;</span>))</span></code></pre></div>
<pre><code>##        elpd_diff se_diff elpd_waic se_elpd_waic p_waic se_p_waic waic   se_waic
## b13M1a    0.0       0.0   -99.3       4.6         19.0    2.0     198.6    9.1 
## b13M1c   -0.7       1.0  -100.0       4.4         19.1    1.9     199.9    8.8 
## b13H4    -0.8       0.9  -100.1       4.5         19.4    2.0     200.1    9.1 
## b13M1b   -0.9       2.9  -100.2       3.6         21.0    0.9     200.4    7.3 
## b13M1d   -1.0       1.7  -100.2       4.8         19.3    2.2     200.5    9.6</code></pre>
<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:comp-waic2">表13.16: </span>WAICの比較2。
</caption>
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
elpd_diff
</th>
<th style="text-align:right;">
se_diff
</th>
<th style="text-align:right;">
elpd_waic
</th>
<th style="text-align:right;">
se_elpd_waic
</th>
<th style="text-align:right;">
p_waic
</th>
<th style="text-align:right;">
se_p_waic
</th>
<th style="text-align:right;">
waic
</th>
<th style="text-align:right;">
se_waic
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
b13M1a
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;">
-99.28
</td>
<td style="text-align:right;">
4.55
</td>
<td style="text-align:right;">
19.03
</td>
<td style="text-align:right;">
1.96
</td>
<td style="text-align:right;">
198.55
</td>
<td style="text-align:right;">
9.11
</td>
</tr>
<tr>
<td style="text-align:left;">
b13M1c
</td>
<td style="text-align:right;">
-0.69
</td>
<td style="text-align:right;">
0.96
</td>
<td style="text-align:right;">
-99.96
</td>
<td style="text-align:right;">
4.41
</td>
<td style="text-align:right;">
19.12
</td>
<td style="text-align:right;">
1.89
</td>
<td style="text-align:right;">
199.92
</td>
<td style="text-align:right;">
8.83
</td>
</tr>
<tr>
<td style="text-align:left;">
b13H4
</td>
<td style="text-align:right;">
-0.78
</td>
<td style="text-align:right;">
0.85
</td>
<td style="text-align:right;">
-100.05
</td>
<td style="text-align:right;">
4.53
</td>
<td style="text-align:right;">
19.40
</td>
<td style="text-align:right;">
1.97
</td>
<td style="text-align:right;">
200.11
</td>
<td style="text-align:right;">
9.07
</td>
</tr>
<tr>
<td style="text-align:left;">
b13M1b
</td>
<td style="text-align:right;">
-0.94
</td>
<td style="text-align:right;">
2.89
</td>
<td style="text-align:right;">
-100.22
</td>
<td style="text-align:right;">
3.63
</td>
<td style="text-align:right;">
21.02
</td>
<td style="text-align:right;">
0.86
</td>
<td style="text-align:right;">
200.43
</td>
<td style="text-align:right;">
7.27
</td>
</tr>
<tr>
<td style="text-align:left;">
b13M1d
</td>
<td style="text-align:right;">
-0.97
</td>
<td style="text-align:right;">
1.68
</td>
<td style="text-align:right;">
-100.24
</td>
<td style="text-align:right;">
4.82
</td>
<td style="text-align:right;">
19.34
</td>
<td style="text-align:right;">
2.15
</td>
<td style="text-align:right;">
200.49
</td>
<td style="text-align:right;">
9.65
</td>
</tr>
</tbody>
</table>
<p>交互作用も含むモデルと事後分布を比較すると以下の通り。すべてではないが、全部ランダム効果に入れたモデルの方がより縮合が起きている？<br />
<img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-667-1.png" width="100%" style="display: block; margin: auto;" /></p>
<p>ランダム効果<code>tank</code>の標準偏差の推定値はほとんど変わらない。</p>
<div class="sourceCode" id="cb1190"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1190-1"><a href="models-with-memory.html#cb1190-1" aria-hidden="true" tabindex="-1"></a><span class="fu">posterior_summary</span>(b13H4) <span class="sc">%&gt;%</span> </span>
<span id="cb1190-2"><a href="models-with-memory.html#cb1190-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1190-3"><a href="models-with-memory.html#cb1190-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>(<span class="at">var =</span> <span class="st">&quot;par&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1190-4"><a href="models-with-memory.html#cb1190-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">str_detect</span>(par,<span class="st">&quot;sd&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1190-5"><a href="models-with-memory.html#cb1190-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="at">booktabs =</span><span class="cn">TRUE</span>,</span>
<span id="cb1190-6"><a href="models-with-memory.html#cb1190-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">digits =</span><span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1190-7"><a href="models-with-memory.html#cb1190-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">latex_options =</span> <span class="fu">c</span>(<span class="st">&quot;hold_position&quot;</span>, <span class="st">&quot;striped&quot;</span>))</span></code></pre></div>
<table class="table" style="margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;">
par
</th>
<th style="text-align:right;">
Estimate
</th>
<th style="text-align:right;">
Est.Error
</th>
<th style="text-align:right;">
Q2.5
</th>
<th style="text-align:right;">
Q97.5
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
sd_pred__Intercept
</td>
<td style="text-align:right;">
1.74
</td>
<td style="text-align:right;">
0.82
</td>
<td style="text-align:right;">
0.70
</td>
<td style="text-align:right;">
3.77
</td>
</tr>
<tr>
<td style="text-align:left;">
sd_size__Intercept
</td>
<td style="text-align:right;">
0.64
</td>
<td style="text-align:right;">
0.62
</td>
<td style="text-align:right;">
0.03
</td>
<td style="text-align:right;">
2.28
</td>
</tr>
<tr>
<td style="text-align:left;">
sd_tank__Intercept
</td>
<td style="text-align:right;">
0.79
</td>
<td style="text-align:right;">
0.15
</td>
<td style="text-align:right;">
0.52
</td>
<td style="text-align:right;">
1.11
</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb1191"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1191-1"><a href="models-with-memory.html#cb1191-1" aria-hidden="true" tabindex="-1"></a><span class="fu">posterior_summary</span>(b13M1d) <span class="sc">%&gt;%</span> </span>
<span id="cb1191-2"><a href="models-with-memory.html#cb1191-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1191-3"><a href="models-with-memory.html#cb1191-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>(<span class="at">var =</span> <span class="st">&quot;par&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1191-4"><a href="models-with-memory.html#cb1191-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">str_detect</span>(par,<span class="st">&quot;sd&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1191-5"><a href="models-with-memory.html#cb1191-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="at">booktabs =</span><span class="cn">TRUE</span>,</span>
<span id="cb1191-6"><a href="models-with-memory.html#cb1191-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">digits =</span><span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1191-7"><a href="models-with-memory.html#cb1191-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">latex_options =</span> <span class="fu">c</span>(<span class="st">&quot;hold_position&quot;</span>, <span class="st">&quot;striped&quot;</span>))</span></code></pre></div>
<table class="table" style="margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;">
par
</th>
<th style="text-align:right;">
Estimate
</th>
<th style="text-align:right;">
Est.Error
</th>
<th style="text-align:right;">
Q2.5
</th>
<th style="text-align:right;">
Q97.5
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
sd_tank__a_Intercept
</td>
<td style="text-align:right;">
0.74
</td>
<td style="text-align:right;">
0.14
</td>
<td style="text-align:right;">
0.49
</td>
<td style="text-align:right;">
1.05
</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<h3>References</h3>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-Cushman2006" class="csl-entry">
Cushman F, Young L, Hauser M (2006) The role of conscious reasoning and intuition in moral judgment: Testing three principles of harm. Psychol Sci 17:1082–1089
</div>
<div id="ref-Silk2005" class="csl-entry">
Silk JB, Brosnan SF, Vonk J, et al (2005) Chimpanzees are indifferent to the welfare of unrelated group members. Nature 437:1357–1359
</div>
<div id="ref-Vonesh2005" class="csl-entry">
Vonesh JR, Bolker BM (2005) Compensatory larval responses shift trade-offs associated with predator-induced hatching plasticity. Ecology 86:1580–1591
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="monsters-and-mixtures.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="adventures-in-covariance.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
