<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>7 Ulysses’ Compass | Statistical Rethinking Second Edition</title>
  <meta name="description" content="7 Ulysses’ Compass | Statistical Rethinking Second Edition" />
  <meta name="generator" content="bookdown 0.31 and GitBook 2.6.7" />

  <meta property="og:title" content="7 Ulysses’ Compass | Statistical Rethinking Second Edition" />
  <meta property="og:type" content="book" />
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="7 Ulysses’ Compass | Statistical Rethinking Second Edition" />
  
  
  

<meta name="author" content="Tsubasa Yamaguchi" />


<meta name="date" content="2023-02-01" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="the-haunted-dag-the-causal-terror.html"/>
<link rel="next" href="conditional-manatees.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<script src="libs/htmlwidgets-1.6.1/htmlwidgets.js"></script>
<link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet" />
<script src="libs/datatables-binding-0.27/datatables.js"></script>
<link href="libs/dt-core-1.12.1/css/jquery.dataTables.min.css" rel="stylesheet" />
<link href="libs/dt-core-1.12.1/css/jquery.dataTables.extra.css" rel="stylesheet" />
<script src="libs/dt-core-1.12.1/js/jquery.dataTables.min.js"></script>
<link href="libs/crosstalk-1.2.0/css/crosstalk.min.css" rel="stylesheet" />
<script src="libs/crosstalk-1.2.0/js/crosstalk.min.js"></script>
<link href="libs/tabwid-1.1.2/tabwid.css" rel="stylesheet" />
<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="custom_style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>本稿の目的</a></li>
<li class="chapter" data-level="" data-path="パッケージの読み込み.html"><a href="パッケージの読み込み.html"><i class="fa fa-check"></i>パッケージの読み込み</a></li>
<li class="chapter" data-level="1" data-path="the-golem-of-prague.html"><a href="the-golem-of-prague.html"><i class="fa fa-check"></i><b>1</b> The Golem of Prague 　</a></li>
<li class="chapter" data-level="2" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html"><i class="fa fa-check"></i><b>2</b> Small Worlds and Large Worlds</a>
<ul>
<li class="chapter" data-level="2.1" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#byesian-updating"><i class="fa fa-check"></i><b>2.1</b> Byesian Updating</a></li>
<li class="chapter" data-level="2.2" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#making-th-model"><i class="fa fa-check"></i><b>2.2</b> Making th model</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#grid-approximation"><i class="fa fa-check"></i><b>2.2.1</b> Grid approximation</a></li>
<li class="chapter" data-level="2.2.2" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#quadratic-approximation"><i class="fa fa-check"></i><b>2.2.2</b> Quadratic approximation</a></li>
<li class="chapter" data-level="2.2.3" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#mcmc"><i class="fa fa-check"></i><b>2.2.3</b> MCMC</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#practice"><i class="fa fa-check"></i><b>2.3</b> Practice</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#m1"><i class="fa fa-check"></i><b>2.3.1</b> 2M1</a></li>
<li class="chapter" data-level="2.3.2" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#m2"><i class="fa fa-check"></i><b>2.3.2</b> 2M2</a></li>
<li class="chapter" data-level="2.3.3" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#m3"><i class="fa fa-check"></i><b>2.3.3</b> 2M3</a></li>
<li class="chapter" data-level="2.3.4" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#m4"><i class="fa fa-check"></i><b>2.3.4</b> 2M4</a></li>
<li class="chapter" data-level="2.3.5" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#m5"><i class="fa fa-check"></i><b>2.3.5</b> 2M5</a></li>
<li class="chapter" data-level="2.3.6" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#m7"><i class="fa fa-check"></i><b>2.3.6</b> 2M7</a></li>
<li class="chapter" data-level="2.3.7" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#h1"><i class="fa fa-check"></i><b>2.3.7</b> 2H1</a></li>
<li class="chapter" data-level="2.3.8" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#h2"><i class="fa fa-check"></i><b>2.3.8</b> 2H2</a></li>
<li class="chapter" data-level="2.3.9" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#h3"><i class="fa fa-check"></i><b>2.3.9</b> 2H3</a></li>
<li class="chapter" data-level="2.3.10" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#h4"><i class="fa fa-check"></i><b>2.3.10</b> 2H4</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html"><i class="fa fa-check"></i><b>3</b> Sampling the Imaginary</a>
<ul>
<li class="chapter" data-level="3.1" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#sampling-from-a-grid-aproximate-posterior"><i class="fa fa-check"></i><b>3.1</b> Sampling from a grid-aproximate posterior</a></li>
<li class="chapter" data-level="3.2" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#sampling-to-summarize"><i class="fa fa-check"></i><b>3.2</b> Sampling to summarize</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#intervals-of-defined-mass"><i class="fa fa-check"></i><b>3.2.1</b> Intervals of defined mass</a></li>
<li class="chapter" data-level="3.2.2" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#highly-skewed-example"><i class="fa fa-check"></i><b>3.2.2</b> highly skewed example</a></li>
<li class="chapter" data-level="3.2.3" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#point-estimate"><i class="fa fa-check"></i><b>3.2.3</b> Point estimate　　</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#sampling-to-simulate-prediction"><i class="fa fa-check"></i><b>3.3</b> Sampling to simulate prediction</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#model-checking"><i class="fa fa-check"></i><b>3.3.1</b> Model checking</a></li>
<li class="chapter" data-level="3.3.2" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#practice-with-brms"><i class="fa fa-check"></i><b>3.3.2</b> Practice with brms</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#practice-1"><i class="fa fa-check"></i><b>3.4</b> Practice</a>
<ul>
<li class="chapter" data-level="3.4.1" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#e"><i class="fa fa-check"></i><b>3.4.1</b> 3E</a></li>
<li class="chapter" data-level="3.4.2" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#m"><i class="fa fa-check"></i><b>3.4.2</b> 3M</a></li>
<li class="chapter" data-level="3.4.3" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#h"><i class="fa fa-check"></i><b>3.4.3</b> 3H</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="geocentric-model.html"><a href="geocentric-model.html"><i class="fa fa-check"></i><b>4</b> Geocentric Model</a>
<ul>
<li class="chapter" data-level="4.1" data-path="geocentric-model.html"><a href="geocentric-model.html#why-normal-distributions-are-normal"><i class="fa fa-check"></i><b>4.1</b> Why normal distributions are normal</a></li>
<li class="chapter" data-level="4.2" data-path="geocentric-model.html"><a href="geocentric-model.html#normal-by-multiplication"><i class="fa fa-check"></i><b>4.2</b> Normal by multiplication</a></li>
<li class="chapter" data-level="4.3" data-path="geocentric-model.html"><a href="geocentric-model.html#gaussian-model-of-height"><i class="fa fa-check"></i><b>4.3</b> Gaussian model of height</a></li>
<li class="chapter" data-level="4.4" data-path="geocentric-model.html"><a href="geocentric-model.html#grid-approximationで事後分布を描く"><i class="fa fa-check"></i><b>4.4</b> Grid approximationで事後分布を描く</a>
<ul>
<li class="chapter" data-level="4.4.1" data-path="geocentric-model.html"><a href="geocentric-model.html#事後分布からサンプリングする"><i class="fa fa-check"></i><b>4.4.1</b> 事後分布からサンプリングする</a></li>
<li class="chapter" data-level="4.4.2" data-path="geocentric-model.html"><a href="geocentric-model.html#rethinking"><i class="fa fa-check"></i><b>4.4.2</b> rethinking</a></li>
<li class="chapter" data-level="4.4.3" data-path="geocentric-model.html"><a href="geocentric-model.html#finding-posterior-with-brms"><i class="fa fa-check"></i><b>4.4.3</b> Finding posterior with brms</a></li>
<li class="chapter" data-level="4.4.4" data-path="geocentric-model.html"><a href="geocentric-model.html#事後分布からのサンプリング"><i class="fa fa-check"></i><b>4.4.4</b> 事後分布からのサンプリング</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="geocentric-model.html"><a href="geocentric-model.html#linear-prediction"><i class="fa fa-check"></i><b>4.5</b> Linear prediction</a>
<ul>
<li class="chapter" data-level="4.5.1" data-path="geocentric-model.html"><a href="geocentric-model.html#finding-the-posterior-distribution"><i class="fa fa-check"></i><b>4.5.1</b> Finding the posterior distribution</a></li>
<li class="chapter" data-level="4.5.2" data-path="geocentric-model.html"><a href="geocentric-model.html#plotting-posterior-inference-agaist-the-data"><i class="fa fa-check"></i><b>4.5.2</b> Plotting posterior inference agaist the data</a></li>
<li class="chapter" data-level="4.5.3" data-path="geocentric-model.html"><a href="geocentric-model.html#plotting-regression-intervals-and-contours"><i class="fa fa-check"></i><b>4.5.3</b> Plotting regression intervals and contours</a></li>
<li class="chapter" data-level="4.5.4" data-path="geocentric-model.html"><a href="geocentric-model.html#prediction-intervals"><i class="fa fa-check"></i><b>4.5.4</b> Prediction intervals</a></li>
</ul></li>
<li class="chapter" data-level="4.6" data-path="geocentric-model.html"><a href="geocentric-model.html#curves-from-lines"><i class="fa fa-check"></i><b>4.6</b> Curves from lines</a>
<ul>
<li class="chapter" data-level="4.6.1" data-path="geocentric-model.html"><a href="geocentric-model.html#polynomial-regression"><i class="fa fa-check"></i><b>4.6.1</b> Polynomial regression</a></li>
<li class="chapter" data-level="4.6.2" data-path="geocentric-model.html"><a href="geocentric-model.html#overthinking"><i class="fa fa-check"></i><b>4.6.2</b> overthinking</a></li>
<li class="chapter" data-level="4.6.3" data-path="geocentric-model.html"><a href="geocentric-model.html#splines"><i class="fa fa-check"></i><b>4.6.3</b> Splines</a></li>
</ul></li>
<li class="chapter" data-level="4.7" data-path="geocentric-model.html"><a href="geocentric-model.html#practice-2"><i class="fa fa-check"></i><b>4.7</b> Practice</a>
<ul>
<li class="chapter" data-level="4.7.1" data-path="geocentric-model.html"><a href="geocentric-model.html#m1-2"><i class="fa fa-check"></i><b>4.7.1</b> 4M1</a></li>
<li class="chapter" data-level="4.7.2" data-path="geocentric-model.html"><a href="geocentric-model.html#m2-2"><i class="fa fa-check"></i><b>4.7.2</b> 4M2</a></li>
<li class="chapter" data-level="4.7.3" data-path="geocentric-model.html"><a href="geocentric-model.html#m4-2"><i class="fa fa-check"></i><b>4.7.3</b> 4M4</a></li>
<li class="chapter" data-level="4.7.4" data-path="geocentric-model.html"><a href="geocentric-model.html#m5-2"><i class="fa fa-check"></i><b>4.7.4</b> 4M5</a></li>
<li class="chapter" data-level="4.7.5" data-path="geocentric-model.html"><a href="geocentric-model.html#m6-1"><i class="fa fa-check"></i><b>4.7.5</b> 4M6</a></li>
<li class="chapter" data-level="4.7.6" data-path="geocentric-model.html"><a href="geocentric-model.html#m7-1"><i class="fa fa-check"></i><b>4.7.6</b> 4M7</a></li>
<li class="chapter" data-level="4.7.7" data-path="geocentric-model.html"><a href="geocentric-model.html#m8"><i class="fa fa-check"></i><b>4.7.7</b> 4M8</a></li>
<li class="chapter" data-level="4.7.8" data-path="geocentric-model.html"><a href="geocentric-model.html#h1-2"><i class="fa fa-check"></i><b>4.7.8</b> 4H1</a></li>
<li class="chapter" data-level="4.7.9" data-path="geocentric-model.html"><a href="geocentric-model.html#h2-2"><i class="fa fa-check"></i><b>4.7.9</b> 4H2</a></li>
<li class="chapter" data-level="4.7.10" data-path="geocentric-model.html"><a href="geocentric-model.html#h3-2"><i class="fa fa-check"></i><b>4.7.10</b> 4H3</a></li>
<li class="chapter" data-level="4.7.11" data-path="geocentric-model.html"><a href="geocentric-model.html#h4-2"><i class="fa fa-check"></i><b>4.7.11</b> 4H4</a></li>
<li class="chapter" data-level="4.7.12" data-path="geocentric-model.html"><a href="geocentric-model.html#h5-1"><i class="fa fa-check"></i><b>4.7.12</b> 4H5</a></li>
<li class="chapter" data-level="4.7.13" data-path="geocentric-model.html"><a href="geocentric-model.html#h6"><i class="fa fa-check"></i><b>4.7.13</b> 4H6</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html"><i class="fa fa-check"></i><b>5</b> The many variables &amp; the spurious waffles</a>
<ul>
<li class="chapter" data-level="5.1" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#spurious-association"><i class="fa fa-check"></i><b>5.1</b> Spurious association</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#グラフを用いて因果モデルを考える"><i class="fa fa-check"></i><b>5.1.1</b> グラフを用いて因果モデルを考える</a></li>
<li class="chapter" data-level="5.1.2" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#predictor-residual-plots"><i class="fa fa-check"></i><b>5.1.2</b> Predictor residual plots</a></li>
<li class="chapter" data-level="5.1.3" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#posterior-prediction-plots"><i class="fa fa-check"></i><b>5.1.3</b> Posterior prediction plots</a></li>
<li class="chapter" data-level="5.1.4" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#counterfactual-plot"><i class="fa fa-check"></i><b>5.1.4</b> Counterfactual plot</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#masked-relationship"><i class="fa fa-check"></i><b>5.2</b> Masked relationship</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#k-nモデル"><i class="fa fa-check"></i><b>5.2.1</b> K ~ Nモデル</a></li>
<li class="chapter" data-level="5.2.2" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#k-mモデル"><i class="fa fa-check"></i><b>5.2.2</b> K ~ Mモデル</a></li>
<li class="chapter" data-level="5.2.3" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#k-n-mモデル"><i class="fa fa-check"></i><b>5.2.3</b> K ~ N + Mモデル</a></li>
<li class="chapter" data-level="5.2.4" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#counterfactual-plot-を描く"><i class="fa fa-check"></i><b>5.2.4</b> Counterfactual plot を描く</a></li>
<li class="chapter" data-level="5.2.5" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#overthinking-1"><i class="fa fa-check"></i><b>5.2.5</b> Overthinking</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#categorical-variables"><i class="fa fa-check"></i><b>5.3</b> Categorical variables</a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#two-categories"><i class="fa fa-check"></i><b>5.3.1</b> Two categories</a></li>
<li class="chapter" data-level="5.3.2" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#many-categories"><i class="fa fa-check"></i><b>5.3.2</b> Many Categories</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#practice-3"><i class="fa fa-check"></i><b>5.4</b> Practice</a>
<ul>
<li class="chapter" data-level="5.4.1" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#m1-3"><i class="fa fa-check"></i><b>5.4.1</b> 5M1</a></li>
<li class="chapter" data-level="5.4.2" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#m2-3"><i class="fa fa-check"></i><b>5.4.2</b> 5M2</a></li>
<li class="chapter" data-level="5.4.3" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#m4-3"><i class="fa fa-check"></i><b>5.4.3</b> 5M4</a></li>
<li class="chapter" data-level="5.4.4" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#h1-3"><i class="fa fa-check"></i><b>5.4.4</b> 5H1</a></li>
<li class="chapter" data-level="5.4.5" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#h2-3"><i class="fa fa-check"></i><b>5.4.5</b> 5H2</a></li>
<li class="chapter" data-level="5.4.6" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#h3-3"><i class="fa fa-check"></i><b>5.4.6</b> 5H3</a></li>
<li class="chapter" data-level="5.4.7" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#h4-3"><i class="fa fa-check"></i><b>5.4.7</b> 5H4</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html"><i class="fa fa-check"></i><b>6</b> The Haunted DAG &amp; the Causal Terror</a>
<ul>
<li class="chapter" data-level="6.1" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#multicollinearity"><i class="fa fa-check"></i><b>6.1</b> Multicollinearity</a>
<ul>
<li class="chapter" data-level="6.1.1" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#multicollinear-milk"><i class="fa fa-check"></i><b>6.1.1</b> Multicollinear milk</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#post-treatment-bias"><i class="fa fa-check"></i><b>6.2</b> Post-treatment bias</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#blocked-by-consequence"><i class="fa fa-check"></i><b>6.2.1</b> Blocked by consequence</a></li>
<li class="chapter" data-level="6.2.2" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#fungus-and-d-separation"><i class="fa fa-check"></i><b>6.2.2</b> Fungus and d-separation</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#collider-bias"><i class="fa fa-check"></i><b>6.3</b> Collider bias</a>
<ul>
<li class="chapter" data-level="6.3.1" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#collider-of-false-sorrow"><i class="fa fa-check"></i><b>6.3.1</b> Collider of false sorrow</a></li>
<li class="chapter" data-level="6.3.2" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#the-haunted-dag"><i class="fa fa-check"></i><b>6.3.2</b> The haunted DAG</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#confronting-confoundings"><i class="fa fa-check"></i><b>6.4</b> Confronting confoundings</a>
<ul>
<li class="chapter" data-level="6.4.1" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#two-roads"><i class="fa fa-check"></i><b>6.4.1</b> Two roads</a></li>
<li class="chapter" data-level="6.4.2" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#backdoor-waffles"><i class="fa fa-check"></i><b>6.4.2</b> Backdoor Waffles</a></li>
</ul></li>
<li class="chapter" data-level="6.5" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#practice-4"><i class="fa fa-check"></i><b>6.5</b> Practice</a>
<ul>
<li class="chapter" data-level="6.5.1" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#m1-4"><i class="fa fa-check"></i><b>6.5.1</b> 6M1</a></li>
<li class="chapter" data-level="6.5.2" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#m2-4"><i class="fa fa-check"></i><b>6.5.2</b> 6M2</a></li>
<li class="chapter" data-level="6.5.3" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#h1-4"><i class="fa fa-check"></i><b>6.5.3</b> 6H1</a></li>
<li class="chapter" data-level="6.5.4" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#h2-4"><i class="fa fa-check"></i><b>6.5.4</b> 6H2</a></li>
<li class="chapter" data-level="6.5.5" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#h3-4"><i class="fa fa-check"></i><b>6.5.5</b> 6H3</a></li>
<li class="chapter" data-level="6.5.6" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#h4-4"><i class="fa fa-check"></i><b>6.5.6</b> 6H4</a></li>
<li class="chapter" data-level="6.5.7" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#h5-2"><i class="fa fa-check"></i><b>6.5.7</b> 6H5</a></li>
</ul></li>
<li class="chapter" data-level="6.6" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#おまけ-ランダム効果を入れてみる"><i class="fa fa-check"></i><b>6.6</b> おまけ　ランダム効果を入れてみる</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="ulysses-compass.html"><a href="ulysses-compass.html"><i class="fa fa-check"></i><b>7</b> Ulysses’ Compass</a>
<ul>
<li class="chapter" data-level="7.1" data-path="ulysses-compass.html"><a href="ulysses-compass.html#the-problems-with-parameters"><i class="fa fa-check"></i><b>7.1</b> The problems with parameters</a>
<ul>
<li class="chapter" data-level="7.1.1" data-path="ulysses-compass.html"><a href="ulysses-compass.html#more-parameters-always-improve-fit"><i class="fa fa-check"></i><b>7.1.1</b> More parameters always improve fit</a></li>
<li class="chapter" data-level="7.1.2" data-path="ulysses-compass.html"><a href="ulysses-compass.html#too-few-parameters-hurts-too"><i class="fa fa-check"></i><b>7.1.2</b> Too few parameters hurts too</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="ulysses-compass.html"><a href="ulysses-compass.html#entropy-and-accuracy"><i class="fa fa-check"></i><b>7.2</b> Entropy and accuracy</a>
<ul>
<li class="chapter" data-level="7.2.1" data-path="ulysses-compass.html"><a href="ulysses-compass.html#information-and-uncertainty"><i class="fa fa-check"></i><b>7.2.1</b> Information and uncertainty</a></li>
<li class="chapter" data-level="7.2.2" data-path="ulysses-compass.html"><a href="ulysses-compass.html#from-entropy-to-acculacy"><i class="fa fa-check"></i><b>7.2.2</b> From entropy to acculacy</a></li>
<li class="chapter" data-level="7.2.3" data-path="ulysses-compass.html"><a href="ulysses-compass.html#estimating-divergence"><i class="fa fa-check"></i><b>7.2.3</b> Estimating divergence</a></li>
<li class="chapter" data-level="7.2.4" data-path="ulysses-compass.html"><a href="ulysses-compass.html#scoring-the-right-data"><i class="fa fa-check"></i><b>7.2.4</b> Scoring the right data</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="ulysses-compass.html"><a href="ulysses-compass.html#golem-taming-regularization"><i class="fa fa-check"></i><b>7.3</b> Golem taming: regularization</a></li>
<li class="chapter" data-level="7.4" data-path="ulysses-compass.html"><a href="ulysses-compass.html#predicting-predictive-accuracy"><i class="fa fa-check"></i><b>7.4</b> Predicting predictive accuracy</a>
<ul>
<li class="chapter" data-level="7.4.1" data-path="ulysses-compass.html"><a href="ulysses-compass.html#cross-validation"><i class="fa fa-check"></i><b>7.4.1</b> Cross validation</a></li>
<li class="chapter" data-level="7.4.2" data-path="ulysses-compass.html"><a href="ulysses-compass.html#information-criteria"><i class="fa fa-check"></i><b>7.4.2</b> Information criteria</a></li>
<li class="chapter" data-level="7.4.3" data-path="ulysses-compass.html"><a href="ulysses-compass.html#overthinking-waic-calculation"><i class="fa fa-check"></i><b>7.4.3</b> overthinking: WAIC calculation</a></li>
<li class="chapter" data-level="7.4.4" data-path="ulysses-compass.html"><a href="ulysses-compass.html#comparing-cv-psis-and-waic"><i class="fa fa-check"></i><b>7.4.4</b> Comparing CV, PSIS, and WAIC</a></li>
</ul></li>
<li class="chapter" data-level="7.5" data-path="ulysses-compass.html"><a href="ulysses-compass.html#model-comparison"><i class="fa fa-check"></i><b>7.5</b> Model comparison</a>
<ul>
<li class="chapter" data-level="7.5.1" data-path="ulysses-compass.html"><a href="ulysses-compass.html#model-mis-selection"><i class="fa fa-check"></i><b>7.5.1</b> Model mis-selection</a></li>
<li class="chapter" data-level="7.5.2" data-path="ulysses-compass.html"><a href="ulysses-compass.html#outlier-and-other-illusions"><i class="fa fa-check"></i><b>7.5.2</b> Outlier and other illusions</a></li>
</ul></li>
<li class="chapter" data-level="7.6" data-path="ulysses-compass.html"><a href="ulysses-compass.html#practice-5"><i class="fa fa-check"></i><b>7.6</b> Practice</a>
<ul>
<li class="chapter" data-level="7.6.1" data-path="ulysses-compass.html"><a href="ulysses-compass.html#e2"><i class="fa fa-check"></i><b>7.6.1</b> 7E2</a></li>
<li class="chapter" data-level="7.6.2" data-path="ulysses-compass.html"><a href="ulysses-compass.html#e3"><i class="fa fa-check"></i><b>7.6.2</b> 7E3</a></li>
<li class="chapter" data-level="7.6.3" data-path="ulysses-compass.html"><a href="ulysses-compass.html#e4"><i class="fa fa-check"></i><b>7.6.3</b> 7E4</a></li>
<li class="chapter" data-level="7.6.4" data-path="ulysses-compass.html"><a href="ulysses-compass.html#m4-4"><i class="fa fa-check"></i><b>7.6.4</b> 7M4</a></li>
<li class="chapter" data-level="7.6.5" data-path="ulysses-compass.html"><a href="ulysses-compass.html#h1-5"><i class="fa fa-check"></i><b>7.6.5</b> 7H1</a></li>
<li class="chapter" data-level="7.6.6" data-path="ulysses-compass.html"><a href="ulysses-compass.html#h2-5"><i class="fa fa-check"></i><b>7.6.6</b> 7H2</a></li>
<li class="chapter" data-level="7.6.7" data-path="ulysses-compass.html"><a href="ulysses-compass.html#h3-5"><i class="fa fa-check"></i><b>7.6.7</b> 7H3</a></li>
<li class="chapter" data-level="7.6.8" data-path="ulysses-compass.html"><a href="ulysses-compass.html#h4-5"><i class="fa fa-check"></i><b>7.6.8</b> 7H4</a></li>
<li class="chapter" data-level="7.6.9" data-path="ulysses-compass.html"><a href="ulysses-compass.html#h5-3"><i class="fa fa-check"></i><b>7.6.9</b> 7H5</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="conditional-manatees.html"><a href="conditional-manatees.html"><i class="fa fa-check"></i><b>8</b> Conditional Manatees</a>
<ul>
<li class="chapter" data-level="8.1" data-path="conditional-manatees.html"><a href="conditional-manatees.html#building-an-interaction"><i class="fa fa-check"></i><b>8.1</b> Building an interaction</a>
<ul>
<li class="chapter" data-level="8.1.1" data-path="conditional-manatees.html"><a href="conditional-manatees.html#making-a-rugged-model"><i class="fa fa-check"></i><b>8.1.1</b> Making a rugged model</a></li>
<li class="chapter" data-level="8.1.2" data-path="conditional-manatees.html"><a href="conditional-manatees.html#adding-an-indicator-variable-isnt-enough"><i class="fa fa-check"></i><b>8.1.2</b> Adding an indicator variable isn’t enough</a></li>
<li class="chapter" data-level="8.1.3" data-path="conditional-manatees.html"><a href="conditional-manatees.html#adding-interaction-does-work"><i class="fa fa-check"></i><b>8.1.3</b> Adding interaction does work</a></li>
<li class="chapter" data-level="8.1.4" data-path="conditional-manatees.html"><a href="conditional-manatees.html#plotting-the-interaction"><i class="fa fa-check"></i><b>8.1.4</b> Plotting the interaction</a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="conditional-manatees.html"><a href="conditional-manatees.html#symmetry-of-interaction"><i class="fa fa-check"></i><b>8.2</b> Symmetry of interaction</a></li>
<li class="chapter" data-level="8.3" data-path="conditional-manatees.html"><a href="conditional-manatees.html#continuous-interaction"><i class="fa fa-check"></i><b>8.3</b> Continuous interaction</a>
<ul>
<li class="chapter" data-level="8.3.1" data-path="conditional-manatees.html"><a href="conditional-manatees.html#a-winter-flower"><i class="fa fa-check"></i><b>8.3.1</b> A winter flower</a></li>
<li class="chapter" data-level="8.3.2" data-path="conditional-manatees.html"><a href="conditional-manatees.html#the-models"><i class="fa fa-check"></i><b>8.3.2</b> The models</a></li>
<li class="chapter" data-level="8.3.3" data-path="conditional-manatees.html"><a href="conditional-manatees.html#plotting-posterior-predictions"><i class="fa fa-check"></i><b>8.3.3</b> Plotting posterior predictions</a></li>
<li class="chapter" data-level="8.3.4" data-path="conditional-manatees.html"><a href="conditional-manatees.html#plotting-prior-predictions"><i class="fa fa-check"></i><b>8.3.4</b> Plotting prior predictions</a></li>
</ul></li>
<li class="chapter" data-level="8.4" data-path="conditional-manatees.html"><a href="conditional-manatees.html#practice-6"><i class="fa fa-check"></i><b>8.4</b> Practice</a>
<ul>
<li class="chapter" data-level="8.4.1" data-path="conditional-manatees.html"><a href="conditional-manatees.html#m4-5"><i class="fa fa-check"></i><b>8.4.1</b> 8M4</a></li>
<li class="chapter" data-level="8.4.2" data-path="conditional-manatees.html"><a href="conditional-manatees.html#h1-6"><i class="fa fa-check"></i><b>8.4.2</b> 8H1</a></li>
<li class="chapter" data-level="8.4.3" data-path="conditional-manatees.html"><a href="conditional-manatees.html#h2-6"><i class="fa fa-check"></i><b>8.4.3</b> 8H2</a></li>
<li class="chapter" data-level="8.4.4" data-path="conditional-manatees.html"><a href="conditional-manatees.html#h3-6"><i class="fa fa-check"></i><b>8.4.4</b> 8H3</a></li>
<li class="chapter" data-level="8.4.5" data-path="conditional-manatees.html"><a href="conditional-manatees.html#h4-6"><i class="fa fa-check"></i><b>8.4.5</b> 8H4</a></li>
<li class="chapter" data-level="8.4.6" data-path="conditional-manatees.html"><a href="conditional-manatees.html#h5-4"><i class="fa fa-check"></i><b>8.4.6</b> 8H5</a></li>
<li class="chapter" data-level="8.4.7" data-path="conditional-manatees.html"><a href="conditional-manatees.html#h6-1"><i class="fa fa-check"></i><b>8.4.7</b> 8H6</a></li>
<li class="chapter" data-level="8.4.8" data-path="conditional-manatees.html"><a href="conditional-manatees.html#h7"><i class="fa fa-check"></i><b>8.4.8</b> 8H7</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="9" data-path="marcov-chain-monte-carlo.html"><a href="marcov-chain-monte-carlo.html"><i class="fa fa-check"></i><b>9</b> Marcov Chain Monte Carlo</a>
<ul>
<li class="chapter" data-level="9.1" data-path="marcov-chain-monte-carlo.html"><a href="marcov-chain-monte-carlo.html#good-king-marcov-and-his-island-kingdom"><i class="fa fa-check"></i><b>9.1</b> Good King Marcov and his island kingdom</a></li>
<li class="chapter" data-level="9.2" data-path="marcov-chain-monte-carlo.html"><a href="marcov-chain-monte-carlo.html#metropolis-algorythm"><i class="fa fa-check"></i><b>9.2</b> Metropolis algorythm</a>
<ul>
<li class="chapter" data-level="9.2.1" data-path="marcov-chain-monte-carlo.html"><a href="marcov-chain-monte-carlo.html#gibbs-sampling"><i class="fa fa-check"></i><b>9.2.1</b> Gibbs sampling</a></li>
<li class="chapter" data-level="9.2.2" data-path="marcov-chain-monte-carlo.html"><a href="marcov-chain-monte-carlo.html#high-dimentional-problem"><i class="fa fa-check"></i><b>9.2.2</b> High-dimentional problem</a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="marcov-chain-monte-carlo.html"><a href="marcov-chain-monte-carlo.html#hamiltonian-monte-carlo"><i class="fa fa-check"></i><b>9.3</b> Hamiltonian Monte Carlo</a>
<ul>
<li class="chapter" data-level="9.3.1" data-path="marcov-chain-monte-carlo.html"><a href="marcov-chain-monte-carlo.html#another-probable"><i class="fa fa-check"></i><b>9.3.1</b> Another probable</a></li>
<li class="chapter" data-level="9.3.2" data-path="marcov-chain-monte-carlo.html"><a href="marcov-chain-monte-carlo.html#limitations"><i class="fa fa-check"></i><b>9.3.2</b> Limitations</a></li>
</ul></li>
<li class="chapter" data-level="9.4" data-path="marcov-chain-monte-carlo.html"><a href="marcov-chain-monte-carlo.html#easy-hmc-ulam-brm"><i class="fa fa-check"></i><b>9.4</b> Easy HMC: <del>ulam</del> <code>brm()</code></a>
<ul>
<li class="chapter" data-level="9.4.1" data-path="marcov-chain-monte-carlo.html"><a href="marcov-chain-monte-carlo.html#preparation"><i class="fa fa-check"></i><b>9.4.1</b> Preparation</a></li>
<li class="chapter" data-level="9.4.2" data-path="marcov-chain-monte-carlo.html"><a href="marcov-chain-monte-carlo.html#sampling-from-posterior"><i class="fa fa-check"></i><b>9.4.2</b> Sampling from posterior</a></li>
<li class="chapter" data-level="9.4.3" data-path="marcov-chain-monte-carlo.html"><a href="marcov-chain-monte-carlo.html#sampling-again-in-parallel"><i class="fa fa-check"></i><b>9.4.3</b> Sampling again in parallel</a></li>
<li class="chapter" data-level="9.4.4" data-path="marcov-chain-monte-carlo.html"><a href="marcov-chain-monte-carlo.html#visualization"><i class="fa fa-check"></i><b>9.4.4</b> Visualization</a></li>
<li class="chapter" data-level="9.4.5" data-path="marcov-chain-monte-carlo.html"><a href="marcov-chain-monte-carlo.html#checking-the-chain"><i class="fa fa-check"></i><b>9.4.5</b> Checking the chain</a></li>
</ul></li>
<li class="chapter" data-level="9.5" data-path="marcov-chain-monte-carlo.html"><a href="marcov-chain-monte-carlo.html#care-and-feeding-of-your-marcov-chain"><i class="fa fa-check"></i><b>9.5</b> Care and feeding of your Marcov chain</a>
<ul>
<li class="chapter" data-level="9.5.1" data-path="marcov-chain-monte-carlo.html"><a href="marcov-chain-monte-carlo.html#how-many-samples-do-you-need"><i class="fa fa-check"></i><b>9.5.1</b> How many samples do you need</a></li>
<li class="chapter" data-level="9.5.2" data-path="marcov-chain-monte-carlo.html"><a href="marcov-chain-monte-carlo.html#how-many-chains-do-we-need"><i class="fa fa-check"></i><b>9.5.2</b> How many chains do we need</a></li>
<li class="chapter" data-level="9.5.3" data-path="marcov-chain-monte-carlo.html"><a href="marcov-chain-monte-carlo.html#taming-and-wild-chain"><i class="fa fa-check"></i><b>9.5.3</b> Taming and wild chain</a></li>
<li class="chapter" data-level="9.5.4" data-path="marcov-chain-monte-carlo.html"><a href="marcov-chain-monte-carlo.html#non-identifiable-parameters"><i class="fa fa-check"></i><b>9.5.4</b> Non-identifiable parameters</a></li>
</ul></li>
<li class="chapter" data-level="9.6" data-path="marcov-chain-monte-carlo.html"><a href="marcov-chain-monte-carlo.html#practice-7"><i class="fa fa-check"></i><b>9.6</b> Practice</a>
<ul>
<li class="chapter" data-level="9.6.1" data-path="marcov-chain-monte-carlo.html"><a href="marcov-chain-monte-carlo.html#m1-5"><i class="fa fa-check"></i><b>9.6.1</b> 9M1</a></li>
<li class="chapter" data-level="9.6.2" data-path="marcov-chain-monte-carlo.html"><a href="marcov-chain-monte-carlo.html#m2-5"><i class="fa fa-check"></i><b>9.6.2</b> 9M2</a></li>
<li class="chapter" data-level="9.6.3" data-path="marcov-chain-monte-carlo.html"><a href="marcov-chain-monte-carlo.html#m3-2"><i class="fa fa-check"></i><b>9.6.3</b> 9M3</a></li>
<li class="chapter" data-level="9.6.4" data-path="marcov-chain-monte-carlo.html"><a href="marcov-chain-monte-carlo.html#h1-7"><i class="fa fa-check"></i><b>9.6.4</b> 9H1</a></li>
<li class="chapter" data-level="9.6.5" data-path="marcov-chain-monte-carlo.html"><a href="marcov-chain-monte-carlo.html#h2-7"><i class="fa fa-check"></i><b>9.6.5</b> 9H2</a></li>
<li class="chapter" data-level="9.6.6" data-path="marcov-chain-monte-carlo.html"><a href="marcov-chain-monte-carlo.html#h3-7"><i class="fa fa-check"></i><b>9.6.6</b> 9H3</a></li>
<li class="chapter" data-level="9.6.7" data-path="marcov-chain-monte-carlo.html"><a href="marcov-chain-monte-carlo.html#h4-7"><i class="fa fa-check"></i><b>9.6.7</b> 9H4</a></li>
<li class="chapter" data-level="9.6.8" data-path="marcov-chain-monte-carlo.html"><a href="marcov-chain-monte-carlo.html#h5-5"><i class="fa fa-check"></i><b>9.6.8</b> 9H5</a></li>
<li class="chapter" data-level="9.6.9" data-path="marcov-chain-monte-carlo.html"><a href="marcov-chain-monte-carlo.html#h6-2"><i class="fa fa-check"></i><b>9.6.9</b> 9H6</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="10" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html"><i class="fa fa-check"></i><b>10</b> Big Entropy and the Generalized Linear Model</a>
<ul>
<li class="chapter" data-level="10.1" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html#maximum-entropy"><i class="fa fa-check"></i><b>10.1</b> Maximum entropy</a>
<ul>
<li class="chapter" data-level="10.1.1" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html#gaussian"><i class="fa fa-check"></i><b>10.1.1</b> Gaussian</a></li>
<li class="chapter" data-level="10.1.2" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html#binomial"><i class="fa fa-check"></i><b>10.1.2</b> Binomial</a></li>
</ul></li>
<li class="chapter" data-level="10.2" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html#generalized-linear-models"><i class="fa fa-check"></i><b>10.2</b> Generalized linear models</a>
<ul>
<li class="chapter" data-level="10.2.1" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html#meet-the-family"><i class="fa fa-check"></i><b>10.2.1</b> Meet the family</a></li>
<li class="chapter" data-level="10.2.2" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html#linking-linear-models-to-distributions"><i class="fa fa-check"></i><b>10.2.2</b> Linking linear models to distributions</a></li>
<li class="chapter" data-level="10.2.3" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html#overthinking-2"><i class="fa fa-check"></i><b>10.2.3</b> Overthinking</a></li>
<li class="chapter" data-level="10.2.4" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html#omitted-variable-bias-again"><i class="fa fa-check"></i><b>10.2.4</b> Omitted variable bias again</a></li>
<li class="chapter" data-level="10.2.5" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html#absolute-and-relative-differences"><i class="fa fa-check"></i><b>10.2.5</b> Absolute and relative differences</a></li>
<li class="chapter" data-level="10.2.6" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html#glms-and-information-criteria"><i class="fa fa-check"></i><b>10.2.6</b> GLMs and information criteria</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="11" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html"><i class="fa fa-check"></i><b>11</b> God Spiked the Integers</a>
<ul>
<li class="chapter" data-level="11.1" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#binomial-regression"><i class="fa fa-check"></i><b>11.1</b> Binomial regression</a>
<ul>
<li class="chapter" data-level="11.1.1" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#logistic-regression"><i class="fa fa-check"></i><b>11.1.1</b> Logistic regression</a></li>
<li class="chapter" data-level="11.1.2" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#relative-shark-and-absolute-deer"><i class="fa fa-check"></i><b>11.1.2</b> Relative shark and absolute deer</a></li>
<li class="chapter" data-level="11.1.3" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#aggregated-binomial-chimpanzees-again-condensed"><i class="fa fa-check"></i><b>11.1.3</b> Aggregated binomial: Chimpanzees again, condensed</a></li>
</ul></li>
<li class="chapter" data-level="11.2" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#aggregated-binomial-graduate-school-admittions."><i class="fa fa-check"></i><b>11.2</b> Aggregated binomial: Graduate school admittions.</a></li>
<li class="chapter" data-level="11.3" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#poisson-regression"><i class="fa fa-check"></i><b>11.3</b> Poisson regression</a>
<ul>
<li class="chapter" data-level="11.3.1" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#oceanic-tool-complexity"><i class="fa fa-check"></i><b>11.3.1</b> Oceanic tool complexity</a></li>
<li class="chapter" data-level="11.3.2" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#negative-binomial-gamma-poisson-models."><i class="fa fa-check"></i><b>11.3.2</b> Negative binomial (Gamma-Poisson) models.</a></li>
<li class="chapter" data-level="11.3.3" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#example-exposure-and-the-offset"><i class="fa fa-check"></i><b>11.3.3</b> Example: Exposure and the offset</a></li>
</ul></li>
<li class="chapter" data-level="11.4" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#multinomial-and-categorical-models"><i class="fa fa-check"></i><b>11.4</b> Multinomial and categorical models</a>
<ul>
<li class="chapter" data-level="11.4.1" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#predictors-matched-to-outcomes"><i class="fa fa-check"></i><b>11.4.1</b> Predictors matched to outcomes</a></li>
<li class="chapter" data-level="11.4.2" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#predictor-matched-to-observations"><i class="fa fa-check"></i><b>11.4.2</b> Predictor matched to observations</a></li>
<li class="chapter" data-level="11.4.3" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#multinomial-in-disguise-as-poisson"><i class="fa fa-check"></i><b>11.4.3</b> Multinomial in disguise as Poisson</a></li>
</ul></li>
<li class="chapter" data-level="11.5" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#practice-8"><i class="fa fa-check"></i><b>11.5</b> Practice</a>
<ul>
<li class="chapter" data-level="11.5.1" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#e1"><i class="fa fa-check"></i><b>11.5.1</b> 11E1</a></li>
<li class="chapter" data-level="11.5.2" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#e2-1"><i class="fa fa-check"></i><b>11.5.2</b> 11E2</a></li>
<li class="chapter" data-level="11.5.3" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#e3-1"><i class="fa fa-check"></i><b>11.5.3</b> 11E3</a></li>
<li class="chapter" data-level="11.5.4" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#e4-1"><i class="fa fa-check"></i><b>11.5.4</b> 11E4</a></li>
<li class="chapter" data-level="11.5.5" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#m7-2"><i class="fa fa-check"></i><b>11.5.5</b> 11M7</a></li>
<li class="chapter" data-level="11.5.6" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#m8-1"><i class="fa fa-check"></i><b>11.5.6</b> 11M8</a></li>
<li class="chapter" data-level="11.5.7" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#h1-8"><i class="fa fa-check"></i><b>11.5.7</b> 11H1</a></li>
<li class="chapter" data-level="11.5.8" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#h2-8"><i class="fa fa-check"></i><b>11.5.8</b> 11H2</a></li>
<li class="chapter" data-level="11.5.9" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#h3-8"><i class="fa fa-check"></i><b>11.5.9</b> 11H3</a></li>
<li class="chapter" data-level="11.5.10" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#h4-8"><i class="fa fa-check"></i><b>11.5.10</b> 11H4</a></li>
<li class="chapter" data-level="11.5.11" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#h5-6"><i class="fa fa-check"></i><b>11.5.11</b> 11H5</a></li>
<li class="chapter" data-level="11.5.12" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#h6-3"><i class="fa fa-check"></i><b>11.5.12</b> 11H6</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="12" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html"><i class="fa fa-check"></i><b>12</b> Monsters and Mixtures</a>
<ul>
<li class="chapter" data-level="12.1" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#over-dispersed-counts"><i class="fa fa-check"></i><b>12.1</b> Over-dispersed counts</a>
<ul>
<li class="chapter" data-level="12.1.1" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#beta-binomial."><i class="fa fa-check"></i><b>12.1.1</b> Beta binomial.</a></li>
<li class="chapter" data-level="12.1.2" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#negative-binomial-or-gamma-poisson."><i class="fa fa-check"></i><b>12.1.2</b> Negative binomial or gamma-Poisson.</a></li>
<li class="chapter" data-level="12.1.3" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#over-dispersion-entropy-and-information-criteria."><i class="fa fa-check"></i><b>12.1.3</b> Over-dispersion, entropy, and information criteria.</a></li>
</ul></li>
<li class="chapter" data-level="12.2" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#zero-inflated-outcomes"><i class="fa fa-check"></i><b>12.2</b> Zero-inflated outcomes</a>
<ul>
<li class="chapter" data-level="12.2.1" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#example-zero-inflated-poisson."><i class="fa fa-check"></i><b>12.2.1</b> Example: Zero-inflated Poisson.</a></li>
</ul></li>
<li class="chapter" data-level="12.3" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#ordered-categorical-outcomes"><i class="fa fa-check"></i><b>12.3</b> Ordered categorical outcomes</a>
<ul>
<li class="chapter" data-level="12.3.1" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#example-moral-intuition."><i class="fa fa-check"></i><b>12.3.1</b> Example: Moral intuition.</a></li>
<li class="chapter" data-level="12.3.2" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#adding-predictor-variables."><i class="fa fa-check"></i><b>12.3.2</b> Adding predictor variables.</a></li>
</ul></li>
<li class="chapter" data-level="12.4" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#ordered-categorical-predictors"><i class="fa fa-check"></i><b>12.4</b> Ordered categorical predictors</a></li>
<li class="chapter" data-level="12.5" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#practice-9"><i class="fa fa-check"></i><b>12.5</b> Practice</a>
<ul>
<li class="chapter" data-level="12.5.1" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#m1-6"><i class="fa fa-check"></i><b>12.5.1</b> 12M1</a></li>
<li class="chapter" data-level="12.5.2" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#m2-6"><i class="fa fa-check"></i><b>12.5.2</b> 12M2</a></li>
<li class="chapter" data-level="12.5.3" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#m3-3"><i class="fa fa-check"></i><b>12.5.3</b> 12M3</a></li>
<li class="chapter" data-level="12.5.4" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#h1-9"><i class="fa fa-check"></i><b>12.5.4</b> 12H1</a></li>
<li class="chapter" data-level="12.5.5" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#h2-9"><i class="fa fa-check"></i><b>12.5.5</b> 12H2</a></li>
<li class="chapter" data-level="12.5.6" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#h3-9"><i class="fa fa-check"></i><b>12.5.6</b> 12H3</a></li>
<li class="chapter" data-level="12.5.7" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#h4-9"><i class="fa fa-check"></i><b>12.5.7</b> 12H4</a></li>
<li class="chapter" data-level="12.5.8" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#h5-7"><i class="fa fa-check"></i><b>12.5.8</b> 12H5</a></li>
<li class="chapter" data-level="12.5.9" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#h6-4"><i class="fa fa-check"></i><b>12.5.9</b> 12H6</a></li>
<li class="chapter" data-level="12.5.10" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#h7-1"><i class="fa fa-check"></i><b>12.5.10</b> 12H7</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="13" data-path="models-with-memory.html"><a href="models-with-memory.html"><i class="fa fa-check"></i><b>13</b> Models with Memory</a>
<ul>
<li class="chapter" data-level="13.1" data-path="models-with-memory.html"><a href="models-with-memory.html#multilevel-tadpoles"><i class="fa fa-check"></i><b>13.1</b> Multilevel tadpoles</a></li>
<li class="chapter" data-level="13.2" data-path="models-with-memory.html"><a href="models-with-memory.html#varying-effects-and-the-underfittingoverfitting-trade-off"><i class="fa fa-check"></i><b>13.2</b> Varying effects and the underfitting/overfitting trade-off 　</a>
<ul>
<li class="chapter" data-level="13.2.1" data-path="models-with-memory.html"><a href="models-with-memory.html#the-model"><i class="fa fa-check"></i><b>13.2.1</b> The model</a></li>
<li class="chapter" data-level="13.2.2" data-path="models-with-memory.html"><a href="models-with-memory.html#simulate-survivors"><i class="fa fa-check"></i><b>13.2.2</b> Simulate survivors</a></li>
</ul></li>
<li class="chapter" data-level="13.3" data-path="models-with-memory.html"><a href="models-with-memory.html#more-than-one-type-of-cluster"><i class="fa fa-check"></i><b>13.3</b> More than one type of cluster</a>
<ul>
<li class="chapter" data-level="13.3.1" data-path="models-with-memory.html"><a href="models-with-memory.html#even-more-clusters"><i class="fa fa-check"></i><b>13.3.1</b> Even more clusters</a></li>
</ul></li>
<li class="chapter" data-level="13.4" data-path="models-with-memory.html"><a href="models-with-memory.html#divergent-transitions-and-non-centered-priors"><i class="fa fa-check"></i><b>13.4</b> Divergent transitions and non-centered priors</a>
<ul>
<li class="chapter" data-level="13.4.1" data-path="models-with-memory.html"><a href="models-with-memory.html#the-devils-funnel"><i class="fa fa-check"></i><b>13.4.1</b> The Devil’s Funnel</a></li>
<li class="chapter" data-level="13.4.2" data-path="models-with-memory.html"><a href="models-with-memory.html#non-centered-chimpanzees"><i class="fa fa-check"></i><b>13.4.2</b> Non-centered chimpanzees</a></li>
</ul></li>
<li class="chapter" data-level="13.5" data-path="models-with-memory.html"><a href="models-with-memory.html#multilevel-posterior-predictions"><i class="fa fa-check"></i><b>13.5</b> Multilevel posterior predictions</a>
<ul>
<li class="chapter" data-level="13.5.1" data-path="models-with-memory.html"><a href="models-with-memory.html#posterior-prediction-for-same-clusters"><i class="fa fa-check"></i><b>13.5.1</b> Posterior prediction for same clusters</a></li>
<li class="chapter" data-level="13.5.2" data-path="models-with-memory.html"><a href="models-with-memory.html#posterior-prediction-for-new-clusters"><i class="fa fa-check"></i><b>13.5.2</b> Posterior prediction for new clusters</a></li>
</ul></li>
<li class="chapter" data-level="13.6" data-path="models-with-memory.html"><a href="models-with-memory.html#post-stratification"><i class="fa fa-check"></i><b>13.6</b> Post stratification</a>
<ul>
<li class="chapter" data-level="13.6.1" data-path="models-with-memory.html"><a href="models-with-memory.html#meet-the-data"><i class="fa fa-check"></i><b>13.6.1</b> Meet the data</a></li>
<li class="chapter" data-level="13.6.2" data-path="models-with-memory.html"><a href="models-with-memory.html#settle-the-mr-part-of-mrp."><i class="fa fa-check"></i><b>13.6.2</b> Settle the MR part of MRP.</a></li>
<li class="chapter" data-level="13.6.3" data-path="models-with-memory.html"><a href="models-with-memory.html#post-stratify-to-put-the-p-in-mrp."><i class="fa fa-check"></i><b>13.6.3</b> Post-stratify to put the P in MRP.</a></li>
</ul></li>
<li class="chapter" data-level="13.7" data-path="models-with-memory.html"><a href="models-with-memory.html#practice-10"><i class="fa fa-check"></i><b>13.7</b> Practice</a>
<ul>
<li class="chapter" data-level="13.7.1" data-path="models-with-memory.html"><a href="models-with-memory.html#m1-7"><i class="fa fa-check"></i><b>13.7.1</b> 13M1</a></li>
<li class="chapter" data-level="13.7.2" data-path="models-with-memory.html"><a href="models-with-memory.html#m2-7"><i class="fa fa-check"></i><b>13.7.2</b> 13M2</a></li>
<li class="chapter" data-level="13.7.3" data-path="models-with-memory.html"><a href="models-with-memory.html#m3-4"><i class="fa fa-check"></i><b>13.7.3</b> 13M3</a></li>
<li class="chapter" data-level="13.7.4" data-path="models-with-memory.html"><a href="models-with-memory.html#m4-6"><i class="fa fa-check"></i><b>13.7.4</b> 13M4</a></li>
<li class="chapter" data-level="13.7.5" data-path="models-with-memory.html"><a href="models-with-memory.html#m5-3"><i class="fa fa-check"></i><b>13.7.5</b> 13M5</a></li>
<li class="chapter" data-level="13.7.6" data-path="models-with-memory.html"><a href="models-with-memory.html#m6-2"><i class="fa fa-check"></i><b>13.7.6</b> 13M6</a></li>
<li class="chapter" data-level="13.7.7" data-path="models-with-memory.html"><a href="models-with-memory.html#h1-10"><i class="fa fa-check"></i><b>13.7.7</b> 13H1</a></li>
<li class="chapter" data-level="13.7.8" data-path="models-with-memory.html"><a href="models-with-memory.html#h2-10"><i class="fa fa-check"></i><b>13.7.8</b> 13H2</a></li>
<li class="chapter" data-level="13.7.9" data-path="models-with-memory.html"><a href="models-with-memory.html#h3-10"><i class="fa fa-check"></i><b>13.7.9</b> 13H3</a></li>
<li class="chapter" data-level="13.7.10" data-path="models-with-memory.html"><a href="models-with-memory.html#h4-10"><i class="fa fa-check"></i><b>13.7.10</b> 13H4</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="14" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html"><i class="fa fa-check"></i><b>14</b> Adventures in Covariance</a>
<ul>
<li class="chapter" data-level="14.1" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#varying-slopes-by-construction"><i class="fa fa-check"></i><b>14.1</b> Varying slopes by construction</a>
<ul>
<li class="chapter" data-level="14.1.1" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#simulate-and-population"><i class="fa fa-check"></i><b>14.1.1</b> Simulate and population</a></li>
<li class="chapter" data-level="14.1.2" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#simulate-observation"><i class="fa fa-check"></i><b>14.1.2</b> Simulate observation</a></li>
<li class="chapter" data-level="14.1.3" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#the-varying-slope-model"><i class="fa fa-check"></i><b>14.1.3</b> The varying slope model</a></li>
</ul></li>
<li class="chapter" data-level="14.2" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#advanced-varing-slopes"><i class="fa fa-check"></i><b>14.2</b> Advanced varing slopes</a></li>
<li class="chapter" data-level="14.3" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#instruments-and-causal-designs"><i class="fa fa-check"></i><b>14.3</b> Instruments and causal designs</a>
<ul>
<li class="chapter" data-level="14.3.1" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#instrumental-variables"><i class="fa fa-check"></i><b>14.3.1</b> Instrumental variables</a></li>
<li class="chapter" data-level="14.3.2" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#other-designs"><i class="fa fa-check"></i><b>14.3.2</b> Other designs</a></li>
</ul></li>
<li class="chapter" data-level="14.4" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#social-relations-as-correlated-varying-effects"><i class="fa fa-check"></i><b>14.4</b> Social relations as correlated varying effects</a></li>
<li class="chapter" data-level="14.5" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#continuous-categories-and-the-gaussian-process"><i class="fa fa-check"></i><b>14.5</b> Continuous categories and the Gaussian process</a>
<ul>
<li class="chapter" data-level="14.5.1" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#example-spatial-autocorrelation-in-oceanic-tools"><i class="fa fa-check"></i><b>14.5.1</b> Example: Spatial autocorrelation in Oceanic tools</a></li>
<li class="chapter" data-level="14.5.2" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#example-phylogenetic-distance"><i class="fa fa-check"></i><b>14.5.2</b> Example: Phylogenetic distance</a></li>
</ul></li>
<li class="chapter" data-level="14.6" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#practice-11"><i class="fa fa-check"></i><b>14.6</b> Practice</a>
<ul>
<li class="chapter" data-level="14.6.1" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#m1-8"><i class="fa fa-check"></i><b>14.6.1</b> 14M1</a></li>
<li class="chapter" data-level="14.6.2" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#m2-8"><i class="fa fa-check"></i><b>14.6.2</b> 14M2</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="実行環境.html"><a href="実行環境.html"><i class="fa fa-check"></i>実行環境</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Statistical Rethinking Second Edition</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="ulysses-compass" class="section level1 hasAnchor" number="7">
<h1><span class="header-section-number">7</span> Ulysses’ Compass<a href="ulysses-compass.html#ulysses-compass" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div id="the-problems-with-parameters" class="section level2 hasAnchor" number="7.1">
<h2><span class="header-section-number">7.1</span> The problems with parameters<a href="ulysses-compass.html#the-problems-with-parameters" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>説明変数が多ければ多いほどモデルのデータへの当てはまりは良くなる。しかし、既存のデータへの当てはまりがよくなりすぎると(overfitting)、新たなデータを予測する制度が低くなってしまう。一方で、シンプルすぎるモデルもうまく予測ができない(underfitting)。<br />
<br /></p>
<div id="more-parameters-always-improve-fit" class="section level3 hasAnchor" number="7.1.1">
<h3><span class="header-section-number">7.1.1</span> More parameters always improve fit<a href="ulysses-compass.html#more-parameters-always-improve-fit" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>ホミニンの脳容量と体重の関係を考える。</p>
<div class="sourceCode" id="cb568"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb568-1"><a href="ulysses-compass.html#cb568-1" aria-hidden="true" tabindex="-1"></a>(d <span class="ot">&lt;-</span> </span>
<span id="cb568-2"><a href="ulysses-compass.html#cb568-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="at">species =</span> <span class="fu">c</span>(<span class="st">&quot;afarensis&quot;</span>, <span class="st">&quot;africanus&quot;</span>, <span class="st">&quot;habilis&quot;</span>, <span class="st">&quot;boisei&quot;</span>, <span class="st">&quot;rudolfensis&quot;</span>, <span class="st">&quot;ergaster&quot;</span>, <span class="st">&quot;sapiens&quot;</span>), </span>
<span id="cb568-3"><a href="ulysses-compass.html#cb568-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">brain=</span> <span class="fu">c</span>(<span class="dv">438</span>, <span class="dv">452</span>, <span class="dv">612</span>, <span class="dv">521</span>, <span class="dv">752</span>, <span class="dv">871</span>, <span class="dv">1350</span>), </span>
<span id="cb568-4"><a href="ulysses-compass.html#cb568-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">mass =</span> <span class="fu">c</span>(<span class="fl">37.0</span>, <span class="fl">35.5</span>,<span class="fl">34.5</span>,<span class="fl">41.5</span>,<span class="fl">55.5</span>,<span class="fl">61.0</span>,<span class="fl">53.5</span>)))</span></code></pre></div>
<pre><code>## # A tibble: 7 × 3
##   species     brain  mass
##   &lt;chr&gt;       &lt;dbl&gt; &lt;dbl&gt;
## 1 afarensis     438  37  
## 2 africanus     452  35.5
## 3 habilis       612  34.5
## 4 boisei        521  41.5
## 5 rudolfensis   752  55.5
## 6 ergaster      871  61  
## 7 sapiens      1350  53.5</code></pre>
<div class="sourceCode" id="cb570"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb570-1"><a href="ulysses-compass.html#cb570-1" aria-hidden="true" tabindex="-1"></a>d <span class="sc">%&gt;%</span> </span>
<span id="cb570-2"><a href="ulysses-compass.html#cb570-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>mass,<span class="at">y=</span>brain))<span class="sc">+</span></span>
<span id="cb570-3"><a href="ulysses-compass.html#cb570-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size=</span><span class="fl">3.5</span>,<span class="at">shape=</span><span class="dv">1</span>,<span class="at">color=</span><span class="st">&quot;navy&quot;</span>)<span class="sc">+</span></span>
<span id="cb570-4"><a href="ulysses-compass.html#cb570-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text_repel</span>(<span class="fu">aes</span>(<span class="at">label =</span> species))<span class="sc">+</span></span>
<span id="cb570-5"><a href="ulysses-compass.html#cb570-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">600</span>,<span class="dv">1200</span>,<span class="dv">200</span>))<span class="sc">+</span></span>
<span id="cb570-6"><a href="ulysses-compass.html#cb570-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">30</span>,<span class="dv">70</span>),<span class="at">breaks=</span><span class="fu">seq</span>(<span class="dv">30</span>,<span class="dv">70</span>,<span class="dv">10</span>))<span class="sc">+</span></span>
<span id="cb570-7"><a href="ulysses-compass.html#cb570-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">aspect.ratio=</span><span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb570-8"><a href="ulysses-compass.html#cb570-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x=</span><span class="st">&quot;body mass (kg)&quot;</span>,<span class="at">y=</span><span class="st">&quot;brain volume (cc)&quot;</span>,</span>
<span id="cb570-9"><a href="ulysses-compass.html#cb570-9" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">&quot;Average brain volume by body</span><span class="sc">\n</span><span class="st">mass for six hominin species&quot;</span>)</span></code></pre></div>
<p><img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-262-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>標準化する。</p>
<div class="sourceCode" id="cb571"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb571-1"><a href="ulysses-compass.html#cb571-1" aria-hidden="true" tabindex="-1"></a>d <span class="sc">%&gt;%</span> </span>
<span id="cb571-2"><a href="ulysses-compass.html#cb571-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">M =</span> (mass<span class="sc">-</span><span class="fu">mean</span>(mass))<span class="sc">/</span><span class="fu">sd</span>(mass),</span>
<span id="cb571-3"><a href="ulysses-compass.html#cb571-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">B =</span> brain<span class="sc">/</span><span class="fu">max</span>(brain)) <span class="ot">-&gt;</span> d</span></code></pre></div>
<p><br /></p>
<div id="単回帰" class="section level4 hasAnchor" number="7.1.1.1">
<h4><span class="header-section-number">7.1.1.1</span> 単回帰<a href="ulysses-compass.html#単回帰" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>まずは単純な線形回帰を考える。モデルは以下の通り。<br />
<br /></p>
<p><span class="math inline">\(B_{i} \sim Normal(\mu_{i}, \sigma)\)</span><br />
<span class="math inline">\(\mu_{i} = \alpha + \beta M_{i}\)</span><br />
<span class="math inline">\(\alpha \sim Normal(0.5,1)\)</span><br />
<span class="math inline">\(\beta \sim Normal(0,10)\)</span><br />
<span class="math inline">\(\sigma \sim Lognormal(0,1)\)</span></p>
<div class="sourceCode" id="cb572"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb572-1"><a href="ulysses-compass.html#cb572-1" aria-hidden="true" tabindex="-1"></a>b7<span class="fl">.1</span> <span class="ot">&lt;-</span> </span>
<span id="cb572-2"><a href="ulysses-compass.html#cb572-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">brm</span>(<span class="at">data =</span> d,</span>
<span id="cb572-3"><a href="ulysses-compass.html#cb572-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> gaussian,</span>
<span id="cb572-4"><a href="ulysses-compass.html#cb572-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">formula =</span> B <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> M,</span>
<span id="cb572-5"><a href="ulysses-compass.html#cb572-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="fl">0.5</span>, <span class="dv">1</span>),<span class="at">class =</span> Intercept),</span>
<span id="cb572-6"><a href="ulysses-compass.html#cb572-6" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">10</span>), <span class="at">class =</span> b),</span>
<span id="cb572-7"><a href="ulysses-compass.html#cb572-7" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">lognormal</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">class =</span> sigma)),</span>
<span id="cb572-8"><a href="ulysses-compass.html#cb572-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">seed =</span><span class="dv">7</span>, <span class="at">file =</span> <span class="st">&quot;output/Chapter7/b7.1&quot;</span>)</span>
<span id="cb572-9"><a href="ulysses-compass.html#cb572-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb572-10"><a href="ulysses-compass.html#cb572-10" aria-hidden="true" tabindex="-1"></a><span class="fu">posterior_summary</span>(b7<span class="fl">.1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb572-11"><a href="ulysses-compass.html#cb572-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">round</span>(<span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb572-12"><a href="ulysses-compass.html#cb572-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb572-13"><a href="ulysses-compass.html#cb572-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>(<span class="at">var =</span> <span class="st">&quot;parameters&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb572-14"><a href="ulysses-compass.html#cb572-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>()</span></code></pre></div>
<pre><code>## # A tibble: 5 × 5
##   parameters  Estimate Est.Error   Q2.5 Q97.5
##   &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;
## 1 b_Intercept     0.53      0.12   0.32  0.76
## 2 b_M             0.16      0.12  -0.09  0.39
## 3 sigma           0.27      0.12   0.13  0.58
## 4 lprior         -4.72      0.15  -5.11 -4.56
## 5 lp__           -5.63      1.66 -10.1  -3.78</code></pre>
<p><br /></p>
<p><span class="math inline">\(R^2\)</span>を計算する。</p>
<div class="sourceCode" id="cb574"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb574-1"><a href="ulysses-compass.html#cb574-1" aria-hidden="true" tabindex="-1"></a>R2 <span class="ot">&lt;-</span> <span class="cf">function</span>(brm_fit, <span class="at">seed =</span> <span class="dv">7</span>, ...) {</span>
<span id="cb574-2"><a href="ulysses-compass.html#cb574-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set.seed</span>(seed)</span>
<span id="cb574-3"><a href="ulysses-compass.html#cb574-3" aria-hidden="true" tabindex="-1"></a>  p <span class="ot">&lt;-</span> <span class="fu">predict</span>(brm_fit, <span class="at">summary =</span> F, ...)</span>
<span id="cb574-4"><a href="ulysses-compass.html#cb574-4" aria-hidden="true" tabindex="-1"></a>  r <span class="ot">&lt;-</span> <span class="fu">apply</span>(p, <span class="dv">2</span>, mean) <span class="sc">-</span> d<span class="sc">$</span>B</span>
<span id="cb574-5"><a href="ulysses-compass.html#cb574-5" aria-hidden="true" tabindex="-1"></a>  <span class="dv">1</span> <span class="sc">-</span> rethinking<span class="sc">::</span><span class="fu">var2</span>(r)<span class="sc">/</span>rethinking<span class="sc">::</span><span class="fu">var2</span>(d<span class="sc">$</span>B)</span>
<span id="cb574-6"><a href="ulysses-compass.html#cb574-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb574-7"><a href="ulysses-compass.html#cb574-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb574-8"><a href="ulysses-compass.html#cb574-8" aria-hidden="true" tabindex="-1"></a><span class="fu">R2</span>(b7<span class="fl">.1</span>,<span class="at">seed=</span><span class="dv">7</span>)</span></code></pre></div>
<pre><code>## [1] 0.4947021</code></pre>
<p><br /></p>
</div>
<div id="多項回帰" class="section level4 hasAnchor" number="7.1.1.2">
<h4><span class="header-section-number">7.1.1.2</span> 多項回帰<a href="ulysses-compass.html#多項回帰" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>続いて、2乗項を入れたモデルを考える。</p>
<p><br /></p>
<p><span class="math inline">\(B_{i} \sim Normal(\mu_{i}, \sigma)\)</span><br />
<span class="math inline">\(\mu_{i} = \alpha + \beta_{1} M{i} + \beta_{2} M_{i}^2\)</span><br />
<span class="math inline">\(\alpha \sim Normal(0.5,1)\)</span><br />
<span class="math inline">\(\beta_{j} \sim Normal(0,10) \;\; j =1,2\)</span><br />
<span class="math inline">\(\sigma \sim Lognormal(0,1)\)</span></p>
<div class="sourceCode" id="cb576"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb576-1"><a href="ulysses-compass.html#cb576-1" aria-hidden="true" tabindex="-1"></a>b7<span class="fl">.2</span> <span class="ot">&lt;-</span> </span>
<span id="cb576-2"><a href="ulysses-compass.html#cb576-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">brm</span>(<span class="at">data =</span> d,</span>
<span id="cb576-3"><a href="ulysses-compass.html#cb576-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> gaussian,</span>
<span id="cb576-4"><a href="ulysses-compass.html#cb576-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">formula =</span> B <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> M <span class="sc">+</span> <span class="fu">I</span>(M<span class="sc">^</span><span class="dv">2</span>),</span>
<span id="cb576-5"><a href="ulysses-compass.html#cb576-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="fl">0.5</span>, <span class="dv">1</span>),<span class="at">class =</span> Intercept),</span>
<span id="cb576-6"><a href="ulysses-compass.html#cb576-6" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">10</span>), <span class="at">class =</span> b),</span>
<span id="cb576-7"><a href="ulysses-compass.html#cb576-7" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">lognormal</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">class =</span> sigma)),</span>
<span id="cb576-8"><a href="ulysses-compass.html#cb576-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">seed =</span><span class="dv">7</span>, <span class="at">file =</span> <span class="st">&quot;output/Chapter7/b7.2&quot;</span>)</span>
<span id="cb576-9"><a href="ulysses-compass.html#cb576-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb576-10"><a href="ulysses-compass.html#cb576-10" aria-hidden="true" tabindex="-1"></a><span class="fu">posterior_summary</span>(b7<span class="fl">.2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb576-11"><a href="ulysses-compass.html#cb576-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">round</span>(<span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb576-12"><a href="ulysses-compass.html#cb576-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb576-13"><a href="ulysses-compass.html#cb576-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>(<span class="at">var =</span> <span class="st">&quot;parameters&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb576-14"><a href="ulysses-compass.html#cb576-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>()</span></code></pre></div>
<pre><code>## # A tibble: 6 × 5
##   parameters  Estimate Est.Error   Q2.5 Q97.5
##   &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;
## 1 b_Intercept     0.61      0.26   0.1   1.15
## 2 b_M             0.19      0.16  -0.13  0.52
## 3 b_IME2         -0.1       0.26  -0.62  0.43
## 4 sigma           0.31      0.15   0.14  0.7 
## 5 lprior         -7.92      0.15  -8.31 -7.78
## 6 lp__           -9.54      1.99 -14.4  -7.01</code></pre>
<div class="sourceCode" id="cb578"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb578-1"><a href="ulysses-compass.html#cb578-1" aria-hidden="true" tabindex="-1"></a><span class="fu">R2</span>(b7<span class="fl">.2</span>)</span></code></pre></div>
<pre><code>## [1] 0.540159</code></pre>
<p><br /></p>
<p>同様に、3乗項～6乗項を順番に足したモデルを考える。</p>
<div class="sourceCode" id="cb580"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb580-1"><a href="ulysses-compass.html#cb580-1" aria-hidden="true" tabindex="-1"></a>b7<span class="fl">.3</span> <span class="ot">&lt;-</span> </span>
<span id="cb580-2"><a href="ulysses-compass.html#cb580-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">brm</span>(<span class="at">data =</span> d,</span>
<span id="cb580-3"><a href="ulysses-compass.html#cb580-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> gaussian,</span>
<span id="cb580-4"><a href="ulysses-compass.html#cb580-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">formula =</span> B <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> M <span class="sc">+</span> <span class="fu">I</span>(M<span class="sc">^</span><span class="dv">2</span>)<span class="sc">+</span><span class="fu">I</span>(M<span class="sc">^</span><span class="dv">3</span>),</span>
<span id="cb580-5"><a href="ulysses-compass.html#cb580-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="fl">0.5</span>, <span class="dv">1</span>),<span class="at">class =</span> Intercept),</span>
<span id="cb580-6"><a href="ulysses-compass.html#cb580-6" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">10</span>), <span class="at">class =</span> b),</span>
<span id="cb580-7"><a href="ulysses-compass.html#cb580-7" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">lognormal</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">class =</span> sigma)),</span>
<span id="cb580-8"><a href="ulysses-compass.html#cb580-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">control =</span> <span class="fu">list</span>(<span class="at">adapt_delta =</span> .<span class="dv">99</span>),</span>
<span id="cb580-9"><a href="ulysses-compass.html#cb580-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">seed =</span><span class="dv">7</span>, <span class="at">file =</span> <span class="st">&quot;output/Chapter7/b7.3&quot;</span>)</span>
<span id="cb580-10"><a href="ulysses-compass.html#cb580-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb580-11"><a href="ulysses-compass.html#cb580-11" aria-hidden="true" tabindex="-1"></a>b7<span class="fl">.4</span> <span class="ot">&lt;-</span> </span>
<span id="cb580-12"><a href="ulysses-compass.html#cb580-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">brm</span>(<span class="at">data =</span> d,</span>
<span id="cb580-13"><a href="ulysses-compass.html#cb580-13" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> gaussian,</span>
<span id="cb580-14"><a href="ulysses-compass.html#cb580-14" aria-hidden="true" tabindex="-1"></a>      <span class="at">formula =</span> B <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> M <span class="sc">+</span> <span class="fu">I</span>(M<span class="sc">^</span><span class="dv">2</span>)<span class="sc">+</span><span class="fu">I</span>(M<span class="sc">^</span><span class="dv">3</span>)<span class="sc">+</span><span class="fu">I</span>(M<span class="sc">^</span><span class="dv">4</span>),</span>
<span id="cb580-15"><a href="ulysses-compass.html#cb580-15" aria-hidden="true" tabindex="-1"></a>      <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="fl">0.5</span>, <span class="dv">1</span>),<span class="at">class =</span> Intercept),</span>
<span id="cb580-16"><a href="ulysses-compass.html#cb580-16" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">10</span>), <span class="at">class =</span> b),</span>
<span id="cb580-17"><a href="ulysses-compass.html#cb580-17" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">lognormal</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">class =</span> sigma)),</span>
<span id="cb580-18"><a href="ulysses-compass.html#cb580-18" aria-hidden="true" tabindex="-1"></a>                     <span class="at">iter =</span><span class="dv">18000</span>, <span class="at">warmup=</span><span class="dv">10000</span>,<span class="at">thin=</span><span class="dv">4</span>,</span>
<span id="cb580-19"><a href="ulysses-compass.html#cb580-19" aria-hidden="true" tabindex="-1"></a>      <span class="at">control =</span> <span class="fu">list</span>(<span class="at">adapt_delta =</span> .<span class="dv">995</span>,</span>
<span id="cb580-20"><a href="ulysses-compass.html#cb580-20" aria-hidden="true" tabindex="-1"></a>                     <span class="at">max_treedepth =</span> <span class="dv">15</span>),</span>
<span id="cb580-21"><a href="ulysses-compass.html#cb580-21" aria-hidden="true" tabindex="-1"></a>      <span class="at">seed =</span><span class="dv">7</span>, <span class="at">file =</span> <span class="st">&quot;output/Chapter7/b7.4&quot;</span>)</span>
<span id="cb580-22"><a href="ulysses-compass.html#cb580-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb580-23"><a href="ulysses-compass.html#cb580-23" aria-hidden="true" tabindex="-1"></a>b7<span class="fl">.5</span> <span class="ot">&lt;-</span> </span>
<span id="cb580-24"><a href="ulysses-compass.html#cb580-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">brm</span>(<span class="at">data =</span> d,</span>
<span id="cb580-25"><a href="ulysses-compass.html#cb580-25" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> gaussian,</span>
<span id="cb580-26"><a href="ulysses-compass.html#cb580-26" aria-hidden="true" tabindex="-1"></a>      <span class="at">formula =</span> B <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> M <span class="sc">+</span> <span class="fu">I</span>(M<span class="sc">^</span><span class="dv">2</span>)<span class="sc">+</span><span class="fu">I</span>(M<span class="sc">^</span><span class="dv">3</span>)<span class="sc">+</span><span class="fu">I</span>(M<span class="sc">^</span><span class="dv">4</span>)<span class="sc">+</span><span class="fu">I</span>(M<span class="sc">^</span><span class="dv">5</span>),</span>
<span id="cb580-27"><a href="ulysses-compass.html#cb580-27" aria-hidden="true" tabindex="-1"></a>      <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="fl">0.5</span>, <span class="dv">1</span>),<span class="at">class =</span> Intercept),</span>
<span id="cb580-28"><a href="ulysses-compass.html#cb580-28" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">10</span>), <span class="at">class =</span> b),</span>
<span id="cb580-29"><a href="ulysses-compass.html#cb580-29" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">lognormal</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">class =</span> sigma)),</span>
<span id="cb580-30"><a href="ulysses-compass.html#cb580-30" aria-hidden="true" tabindex="-1"></a>      <span class="at">iter=</span><span class="dv">20000</span>,<span class="at">warmup=</span><span class="dv">18000</span>,<span class="at">thin=</span><span class="dv">1</span>,</span>
<span id="cb580-31"><a href="ulysses-compass.html#cb580-31" aria-hidden="true" tabindex="-1"></a>      <span class="at">control =</span> <span class="fu">list</span>(<span class="at">adapt_delta =</span> .<span class="dv">999</span>,</span>
<span id="cb580-32"><a href="ulysses-compass.html#cb580-32" aria-hidden="true" tabindex="-1"></a>                     <span class="at">max_treedepth =</span> <span class="dv">15</span>),</span>
<span id="cb580-33"><a href="ulysses-compass.html#cb580-33" aria-hidden="true" tabindex="-1"></a>      <span class="at">seed =</span><span class="dv">7</span>, <span class="at">file =</span> <span class="st">&quot;output/Chapter7/b7.5&quot;</span>)</span></code></pre></div>
<p>6乗項を入れるときには、少し手間が必要。　
<span class="math inline">\(\sigma\)</span>を0.001に固定する。</p>
<div class="sourceCode" id="cb581"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb581-1"><a href="ulysses-compass.html#cb581-1" aria-hidden="true" tabindex="-1"></a>custom_normal <span class="ot">&lt;-</span> <span class="fu">custom_family</span>(</span>
<span id="cb581-2"><a href="ulysses-compass.html#cb581-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;custom_normal&quot;</span>, <span class="at">dpars =</span> <span class="st">&quot;mu&quot;</span>,</span>
<span id="cb581-3"><a href="ulysses-compass.html#cb581-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">links =</span> <span class="st">&quot;identity&quot;</span>,</span>
<span id="cb581-4"><a href="ulysses-compass.html#cb581-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">type =</span> <span class="st">&quot;real&quot;</span></span>
<span id="cb581-5"><a href="ulysses-compass.html#cb581-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb581-6"><a href="ulysses-compass.html#cb581-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb581-7"><a href="ulysses-compass.html#cb581-7" aria-hidden="true" tabindex="-1"></a>stan_funs  <span class="ot">&lt;-</span> <span class="st">&quot;real custom_normal_lpdf(real y, real mu) {</span></span>
<span id="cb581-8"><a href="ulysses-compass.html#cb581-8" aria-hidden="true" tabindex="-1"></a><span class="st">  return normal_lpdf(y | mu, 0.001);</span></span>
<span id="cb581-9"><a href="ulysses-compass.html#cb581-9" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb581-10"><a href="ulysses-compass.html#cb581-10" aria-hidden="true" tabindex="-1"></a><span class="st">real custom_normal_rng(real mu) {</span></span>
<span id="cb581-11"><a href="ulysses-compass.html#cb581-11" aria-hidden="true" tabindex="-1"></a><span class="st">  return normal_rng(mu, 0.001);</span></span>
<span id="cb581-12"><a href="ulysses-compass.html#cb581-12" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb581-13"><a href="ulysses-compass.html#cb581-13" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span> </span>
<span id="cb581-14"><a href="ulysses-compass.html#cb581-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb581-15"><a href="ulysses-compass.html#cb581-15" aria-hidden="true" tabindex="-1"></a>stanvars <span class="ot">&lt;-</span> <span class="fu">stanvar</span>(<span class="at">scode =</span> stan_funs, <span class="at">block =</span> <span class="st">&quot;functions&quot;</span>)</span>
<span id="cb581-16"><a href="ulysses-compass.html#cb581-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb581-17"><a href="ulysses-compass.html#cb581-17" aria-hidden="true" tabindex="-1"></a>b7<span class="fl">.6</span> <span class="ot">&lt;-</span> </span>
<span id="cb581-18"><a href="ulysses-compass.html#cb581-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">brm</span>(<span class="at">data =</span> d,</span>
<span id="cb581-19"><a href="ulysses-compass.html#cb581-19" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> custom_normal,</span>
<span id="cb581-20"><a href="ulysses-compass.html#cb581-20" aria-hidden="true" tabindex="-1"></a>      <span class="at">formula =</span> B <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> M <span class="sc">+</span> <span class="fu">I</span>(M<span class="sc">^</span><span class="dv">2</span>)<span class="sc">+</span><span class="fu">I</span>(M<span class="sc">^</span><span class="dv">3</span>)<span class="sc">+</span><span class="fu">I</span>(M<span class="sc">^</span><span class="dv">4</span>)<span class="sc">+</span><span class="fu">I</span>(M<span class="sc">^</span><span class="dv">5</span>)<span class="sc">+</span><span class="fu">I</span>(M<span class="sc">^</span><span class="dv">6</span>),</span>
<span id="cb581-21"><a href="ulysses-compass.html#cb581-21" aria-hidden="true" tabindex="-1"></a>      <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="fl">0.5</span>, <span class="dv">1</span>),<span class="at">class =</span> Intercept),</span>
<span id="cb581-22"><a href="ulysses-compass.html#cb581-22" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">10</span>), <span class="at">class =</span> b)),</span>
<span id="cb581-23"><a href="ulysses-compass.html#cb581-23" aria-hidden="true" tabindex="-1"></a>      <span class="at">iter=</span><span class="dv">8000</span>,<span class="at">warmup=</span><span class="dv">5000</span>,</span>
<span id="cb581-24"><a href="ulysses-compass.html#cb581-24" aria-hidden="true" tabindex="-1"></a>      <span class="at">control =</span> <span class="fu">list</span>(<span class="at">adapt_delta =</span> .<span class="dv">999</span>,</span>
<span id="cb581-25"><a href="ulysses-compass.html#cb581-25" aria-hidden="true" tabindex="-1"></a>                     <span class="at">max_treedepth =</span> <span class="dv">15</span>),</span>
<span id="cb581-26"><a href="ulysses-compass.html#cb581-26" aria-hidden="true" tabindex="-1"></a>      <span class="at">stanvars =</span> stanvars,</span>
<span id="cb581-27"><a href="ulysses-compass.html#cb581-27" aria-hidden="true" tabindex="-1"></a>      <span class="at">seed =</span><span class="dv">7</span>, <span class="at">file =</span> <span class="st">&quot;output/Chapter7/b7.6&quot;</span>)</span></code></pre></div>
<p><br /></p>
</div>
<div id="plot" class="section level4 hasAnchor" number="7.1.1.3">
<h4><span class="header-section-number">7.1.1.3</span> plot<a href="ulysses-compass.html#plot" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>全ての結果を作図する。<br />
複雑なモデルほどフィットするようになる(R2も大きくなる)ことが分かる。</p>
<div class="sourceCode" id="cb582"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb582-1"><a href="ulysses-compass.html#cb582-1" aria-hidden="true" tabindex="-1"></a><span class="co">#make_figure &lt;- function(brms_fit, ylim = range(d$B)){</span></span>
<span id="cb582-2"><a href="ulysses-compass.html#cb582-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb582-3"><a href="ulysses-compass.html#cb582-3" aria-hidden="true" tabindex="-1"></a> <span class="co"># r2 &lt;- R2(brms_fit)</span></span>
<span id="cb582-4"><a href="ulysses-compass.html#cb582-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb582-5"><a href="ulysses-compass.html#cb582-5" aria-hidden="true" tabindex="-1"></a>  <span class="co">#nd &lt;- tibble(M = seq(-2,2,length.out=200))</span></span>
<span id="cb582-6"><a href="ulysses-compass.html#cb582-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb582-7"><a href="ulysses-compass.html#cb582-7" aria-hidden="true" tabindex="-1"></a>  <span class="co">#fitted(brms_fit,newdata = nd, probs = c(0.055,0.945)) %&gt;% </span></span>
<span id="cb582-8"><a href="ulysses-compass.html#cb582-8" aria-hidden="true" tabindex="-1"></a>  <span class="co">#data.frame() %&gt;% </span></span>
<span id="cb582-9"><a href="ulysses-compass.html#cb582-9" aria-hidden="true" tabindex="-1"></a>  <span class="co">#bind_cols(nd) %&gt;% </span></span>
<span id="cb582-10"><a href="ulysses-compass.html#cb582-10" aria-hidden="true" tabindex="-1"></a>  <span class="co">#ggplot()+</span></span>
<span id="cb582-11"><a href="ulysses-compass.html#cb582-11" aria-hidden="true" tabindex="-1"></a>  <span class="co">#geom_lineribbon(aes(x=M, y = Estimate, </span></span>
<span id="cb582-12"><a href="ulysses-compass.html#cb582-12" aria-hidden="true" tabindex="-1"></a>   <span class="co">#          ymin = Q5.5,ymax=Q94.5),</span></span>
<span id="cb582-13"><a href="ulysses-compass.html#cb582-13" aria-hidden="true" tabindex="-1"></a>    <span class="co">#         color = &quot;black&quot;, fill=&quot;black&quot;,alpha=3/8,</span></span>
<span id="cb582-14"><a href="ulysses-compass.html#cb582-14" aria-hidden="true" tabindex="-1"></a>     <span class="co">#        size=1)+</span></span>
<span id="cb582-15"><a href="ulysses-compass.html#cb582-15" aria-hidden="true" tabindex="-1"></a>  <span class="co">#geom_point(data=d, aes(x=M,y=B),</span></span>
<span id="cb582-16"><a href="ulysses-compass.html#cb582-16" aria-hidden="true" tabindex="-1"></a>   <span class="co">#          color=&quot;navy&quot;,size=2)+</span></span>
<span id="cb582-17"><a href="ulysses-compass.html#cb582-17" aria-hidden="true" tabindex="-1"></a>  <span class="co">#labs(subtitle =  bquote(italic(R)^2==.(round(r2, digits = 2))),</span></span>
<span id="cb582-18"><a href="ulysses-compass.html#cb582-18" aria-hidden="true" tabindex="-1"></a>   <span class="co">#      x = &quot;body mass (std)&quot;,</span></span>
<span id="cb582-19"><a href="ulysses-compass.html#cb582-19" aria-hidden="true" tabindex="-1"></a>    <span class="co">#     y = &quot;brain volume (std)&quot;) +</span></span>
<span id="cb582-20"><a href="ulysses-compass.html#cb582-20" aria-hidden="true" tabindex="-1"></a>    <span class="co">#coord_cartesian(xlim = c(-1.2, 1.5),</span></span>
<span id="cb582-21"><a href="ulysses-compass.html#cb582-21" aria-hidden="true" tabindex="-1"></a>     <span class="co">#               ylim = ylim)+</span></span>
<span id="cb582-22"><a href="ulysses-compass.html#cb582-22" aria-hidden="true" tabindex="-1"></a>    <span class="co">#theme_classic()+</span></span>
<span id="cb582-23"><a href="ulysses-compass.html#cb582-23" aria-hidden="true" tabindex="-1"></a>    <span class="co">#theme(aspect.ratio=1)</span></span>
<span id="cb582-24"><a href="ulysses-compass.html#cb582-24" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb582-25"><a href="ulysses-compass.html#cb582-25" aria-hidden="true" tabindex="-1"></a><span class="co">#}</span></span>
<span id="cb582-26"><a href="ulysses-compass.html#cb582-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb582-27"><a href="ulysses-compass.html#cb582-27" aria-hidden="true" tabindex="-1"></a><span class="co">#p1 &lt;- make_figure(b7.1)</span></span>
<span id="cb582-28"><a href="ulysses-compass.html#cb582-28" aria-hidden="true" tabindex="-1"></a><span class="co">#p2 &lt;- make_figure(b7.2)</span></span>
<span id="cb582-29"><a href="ulysses-compass.html#cb582-29" aria-hidden="true" tabindex="-1"></a><span class="co">#p3 &lt;- make_figure(b7.3)</span></span>
<span id="cb582-30"><a href="ulysses-compass.html#cb582-30" aria-hidden="true" tabindex="-1"></a><span class="co">#p4 &lt;- make_figure(b7.4, ylim =c(.25,1.1))</span></span>
<span id="cb582-31"><a href="ulysses-compass.html#cb582-31" aria-hidden="true" tabindex="-1"></a><span class="co">#p5 &lt;- make_figure(b7.5, ylim =c(.1,1.4))</span></span>
<span id="cb582-32"><a href="ulysses-compass.html#cb582-32" aria-hidden="true" tabindex="-1"></a><span class="co">#p6 &lt;- make_figure(b7.6,ylim = c(-0.25,1.5))+</span></span>
<span id="cb582-33"><a href="ulysses-compass.html#cb582-33" aria-hidden="true" tabindex="-1"></a><span class="co">#  geom_hline(yintercept = 0, color = &quot;grey&quot;,</span></span>
<span id="cb582-34"><a href="ulysses-compass.html#cb582-34" aria-hidden="true" tabindex="-1"></a> <span class="co">#            linetype=2)+</span></span>
<span id="cb582-35"><a href="ulysses-compass.html#cb582-35" aria-hidden="true" tabindex="-1"></a>  <span class="co">#labs(subtitle = bquote(italic(R)^2== &quot;1&quot;))</span></span>
<span id="cb582-36"><a href="ulysses-compass.html#cb582-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb582-37"><a href="ulysses-compass.html#cb582-37" aria-hidden="true" tabindex="-1"></a><span class="co">#((p1|p2|p3))/((p4|p5|p6))+</span></span>
<span id="cb582-38"><a href="ulysses-compass.html#cb582-38" aria-hidden="true" tabindex="-1"></a> <span class="co">#  plot_annotation(title = &quot;Figure7.3. Polynomial linear models of increasing\ndegree for the hominin data.&quot;) -&gt;p7</span></span>
<span id="cb582-39"><a href="ulysses-compass.html#cb582-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb582-40"><a href="ulysses-compass.html#cb582-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb582-41"><a href="ulysses-compass.html#cb582-41" aria-hidden="true" tabindex="-1"></a>p7 <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;output/Chapter7/p7.rds&quot;</span>)</span>
<span id="cb582-42"><a href="ulysses-compass.html#cb582-42" aria-hidden="true" tabindex="-1"></a>p7</span></code></pre></div>
<p><img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-270-1.png" width="672" style="display: block; margin: auto;" /></p>
<p><br /></p>
</div>
</div>
<div id="too-few-parameters-hurts-too" class="section level3 hasAnchor" number="7.1.2">
<h3><span class="header-section-number">7.1.2</span> Too few parameters hurts too<a href="ulysses-compass.html#too-few-parameters-hurts-too" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>複雑なモデルほどデータを1つ抜いた時に結果が大きく変わってしまう。一方で、シンプルなモデルは1つデータを抜いても大きく推定結果は変わらない。</p>
<div class="sourceCode" id="cb583"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb583-1"><a href="ulysses-compass.html#cb583-1" aria-hidden="true" tabindex="-1"></a>brain_loo_lines <span class="ot">&lt;-</span> <span class="cf">function</span>(brms_fit, row, ...) {</span>
<span id="cb583-2"><a href="ulysses-compass.html#cb583-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb583-3"><a href="ulysses-compass.html#cb583-3" aria-hidden="true" tabindex="-1"></a>  nd <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">M =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">2</span>,<span class="dv">2</span>,<span class="at">length.out=</span><span class="dv">200</span>))</span>
<span id="cb583-4"><a href="ulysses-compass.html#cb583-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb583-5"><a href="ulysses-compass.html#cb583-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># refit the model</span></span>
<span id="cb583-6"><a href="ulysses-compass.html#cb583-6" aria-hidden="true" tabindex="-1"></a>  new_fit <span class="ot">&lt;-</span> </span>
<span id="cb583-7"><a href="ulysses-compass.html#cb583-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">update</span>(brms_fit,</span>
<span id="cb583-8"><a href="ulysses-compass.html#cb583-8" aria-hidden="true" tabindex="-1"></a>           <span class="at">newdata =</span> <span class="fu">filter</span>(d, <span class="fu">row_number</span>() <span class="sc">!=</span> row), </span>
<span id="cb583-9"><a href="ulysses-compass.html#cb583-9" aria-hidden="true" tabindex="-1"></a>           <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>, <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb583-10"><a href="ulysses-compass.html#cb583-10" aria-hidden="true" tabindex="-1"></a>           <span class="at">seed =</span> <span class="dv">7</span>,</span>
<span id="cb583-11"><a href="ulysses-compass.html#cb583-11" aria-hidden="true" tabindex="-1"></a>           <span class="at">refresh =</span> <span class="dv">0</span>,</span>
<span id="cb583-12"><a href="ulysses-compass.html#cb583-12" aria-hidden="true" tabindex="-1"></a>           ...)</span>
<span id="cb583-13"><a href="ulysses-compass.html#cb583-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb583-14"><a href="ulysses-compass.html#cb583-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># pull the lines values</span></span>
<span id="cb583-15"><a href="ulysses-compass.html#cb583-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fitted</span>(new_fit, </span>
<span id="cb583-16"><a href="ulysses-compass.html#cb583-16" aria-hidden="true" tabindex="-1"></a>         <span class="at">newdata =</span> nd) <span class="sc">%&gt;%</span> </span>
<span id="cb583-17"><a href="ulysses-compass.html#cb583-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb583-18"><a href="ulysses-compass.html#cb583-18" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(Estimate) <span class="sc">%&gt;%</span> </span>
<span id="cb583-19"><a href="ulysses-compass.html#cb583-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">bind_cols</span>(nd)</span>
<span id="cb583-20"><a href="ulysses-compass.html#cb583-20" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb583-21"><a href="ulysses-compass.html#cb583-21" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb583-22"><a href="ulysses-compass.html#cb583-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb583-23"><a href="ulysses-compass.html#cb583-23" aria-hidden="true" tabindex="-1"></a><span class="co">#b7.1_fits &lt;-</span></span>
<span id="cb583-24"><a href="ulysses-compass.html#cb583-24" aria-hidden="true" tabindex="-1"></a> <span class="co"># tibble(row = 1:7) %&gt;% </span></span>
<span id="cb583-25"><a href="ulysses-compass.html#cb583-25" aria-hidden="true" tabindex="-1"></a>  <span class="co">#mutate(post = purrr::map(row, ~brain_loo_lines(brms_fit = b7.1, row = .))) %&gt;% </span></span>
<span id="cb583-26"><a href="ulysses-compass.html#cb583-26" aria-hidden="true" tabindex="-1"></a>  <span class="co">#unnest(post)</span></span>
<span id="cb583-27"><a href="ulysses-compass.html#cb583-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb583-28"><a href="ulysses-compass.html#cb583-28" aria-hidden="true" tabindex="-1"></a>b7<span class="fl">.1</span>_fits <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;output/Chapter7/b7.1_fits.rds&quot;</span>)</span>
<span id="cb583-29"><a href="ulysses-compass.html#cb583-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb583-30"><a href="ulysses-compass.html#cb583-30" aria-hidden="true" tabindex="-1"></a><span class="co">#b7.4_fits &lt;-</span></span>
<span id="cb583-31"><a href="ulysses-compass.html#cb583-31" aria-hidden="true" tabindex="-1"></a> <span class="co"># tibble(row = 1:7) %&gt;% </span></span>
<span id="cb583-32"><a href="ulysses-compass.html#cb583-32" aria-hidden="true" tabindex="-1"></a>  <span class="co">#mutate(post = purrr::map(row, ~brain_loo_lines(brms_fit = b7.4,  row = .,             </span></span>
<span id="cb583-33"><a href="ulysses-compass.html#cb583-33" aria-hidden="true" tabindex="-1"></a>   <span class="co">#                                              control = list(adapt_delta = .999)))) %&gt;% </span></span>
<span id="cb583-34"><a href="ulysses-compass.html#cb583-34" aria-hidden="true" tabindex="-1"></a>  <span class="co">#unnest(post)</span></span>
<span id="cb583-35"><a href="ulysses-compass.html#cb583-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb583-36"><a href="ulysses-compass.html#cb583-36" aria-hidden="true" tabindex="-1"></a>b7<span class="fl">.4</span>_fits <span class="ot">&lt;-</span><span class="fu">readRDS</span>(<span class="st">&quot;output/Chapter7/b7.4_fits.rds&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb584"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb584-1"><a href="ulysses-compass.html#cb584-1" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span></span>
<span id="cb584-2"><a href="ulysses-compass.html#cb584-2" aria-hidden="true" tabindex="-1"></a>  b7<span class="fl">.1</span>_fits <span class="sc">%&gt;%</span>  </span>
<span id="cb584-3"><a href="ulysses-compass.html#cb584-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> M)) <span class="sc">+</span></span>
<span id="cb584-4"><a href="ulysses-compass.html#cb584-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> Estimate, <span class="at">group =</span> row), <span class="at">size =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>, <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb584-5"><a href="ulysses-compass.html#cb584-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> d,</span>
<span id="cb584-6"><a href="ulysses-compass.html#cb584-6" aria-hidden="true" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">y =</span> B),) <span class="sc">+</span></span>
<span id="cb584-7"><a href="ulysses-compass.html#cb584-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">&quot;b7.1&quot;</span>,</span>
<span id="cb584-8"><a href="ulysses-compass.html#cb584-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">&quot;body mass (std)&quot;</span>,</span>
<span id="cb584-9"><a href="ulysses-compass.html#cb584-9" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;brain volume (std)&quot;</span>) <span class="sc">+</span></span>
<span id="cb584-10"><a href="ulysses-compass.html#cb584-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">range</span>(d<span class="sc">$</span>M),</span>
<span id="cb584-11"><a href="ulysses-compass.html#cb584-11" aria-hidden="true" tabindex="-1"></a>                  <span class="at">ylim =</span> <span class="fu">range</span>(d<span class="sc">$</span>B))<span class="sc">+</span></span>
<span id="cb584-12"><a href="ulysses-compass.html#cb584-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()<span class="sc">+</span></span>
<span id="cb584-13"><a href="ulysses-compass.html#cb584-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">aspect.ratio=</span><span class="dv">1</span>)</span>
<span id="cb584-14"><a href="ulysses-compass.html#cb584-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb584-15"><a href="ulysses-compass.html#cb584-15" aria-hidden="true" tabindex="-1"></a><span class="co"># right</span></span>
<span id="cb584-16"><a href="ulysses-compass.html#cb584-16" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span></span>
<span id="cb584-17"><a href="ulysses-compass.html#cb584-17" aria-hidden="true" tabindex="-1"></a>  b7<span class="fl">.4</span>_fits <span class="sc">%&gt;%</span>  </span>
<span id="cb584-18"><a href="ulysses-compass.html#cb584-18" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb584-19"><a href="ulysses-compass.html#cb584-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> M, <span class="at">y =</span> Estimate)) <span class="sc">+</span></span>
<span id="cb584-20"><a href="ulysses-compass.html#cb584-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">group =</span> row), <span class="at">size =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>, <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb584-21"><a href="ulysses-compass.html#cb584-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> d,</span>
<span id="cb584-22"><a href="ulysses-compass.html#cb584-22" aria-hidden="true" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">y =</span> B)) <span class="sc">+</span></span>
<span id="cb584-23"><a href="ulysses-compass.html#cb584-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">&quot;b7.4&quot;</span>,</span>
<span id="cb584-24"><a href="ulysses-compass.html#cb584-24" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">&quot;body mass (std)&quot;</span>,</span>
<span id="cb584-25"><a href="ulysses-compass.html#cb584-25" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;brain volume (std)&quot;</span>) <span class="sc">+</span></span>
<span id="cb584-26"><a href="ulysses-compass.html#cb584-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">range</span>(d<span class="sc">$</span>M),</span>
<span id="cb584-27"><a href="ulysses-compass.html#cb584-27" aria-hidden="true" tabindex="-1"></a>                  <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">0.1</span>, <span class="fl">1.4</span>))<span class="sc">+</span></span>
<span id="cb584-28"><a href="ulysses-compass.html#cb584-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()<span class="sc">+</span></span>
<span id="cb584-29"><a href="ulysses-compass.html#cb584-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">aspect.ratio=</span><span class="dv">1</span>)</span>
<span id="cb584-30"><a href="ulysses-compass.html#cb584-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb584-31"><a href="ulysses-compass.html#cb584-31" aria-hidden="true" tabindex="-1"></a><span class="co"># combine</span></span>
<span id="cb584-32"><a href="ulysses-compass.html#cb584-32" aria-hidden="true" tabindex="-1"></a>p1 <span class="sc">+</span> p2</span></code></pre></div>
<p><img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-272-1.png" width="672" style="display: block; margin: auto;" /></p>
<p><br /></p>
</div>
</div>
<div id="entropy-and-accuracy" class="section level2 hasAnchor" number="7.2">
<h2><span class="header-section-number">7.2</span> Entropy and accuracy<a href="ulysses-compass.html#entropy-and-accuracy" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="information-and-uncertainty" class="section level3 hasAnchor" number="7.2.1">
<h3><span class="header-section-number">7.2.1</span> Information and uncertainty<a href="ulysses-compass.html#information-and-uncertainty" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>どのようにモデルを評価すればいいだろうか。<br />
<strong>Information theory</strong>では、不確実性を評価するうえで以下の指標を用いる(= <strong>Information entropy</strong>)。 ただし、<span class="math inline">\(n\)</span>個の異なる出来事が起きる可能性がある場合、<span class="math inline">\(p_{i}\)</span>はイベント<span class="math inline">\(i\)</span>が起きる確率である。</p>
<p><br /></p>
<p><span class="math inline">\(H(p) = -Elog(p_{i}) = - \sum_{i=1}^n log(p_{i})\)</span></p>
<p><br /></p>
<p>例えば、晴れと雨になる確率がそれぞれ0.3と0.7であれば、以下のようになる。</p>
<div class="sourceCode" id="cb585"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb585-1"><a href="ulysses-compass.html#cb585-1" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">0.3</span>, <span class="fl">0.7</span>)</span>
<span id="cb585-2"><a href="ulysses-compass.html#cb585-2" aria-hidden="true" tabindex="-1"></a><span class="sc">-</span><span class="fu">sum</span>(p<span class="sc">*</span><span class="fu">log</span>(p))</span></code></pre></div>
<pre><code>## [1] 0.6108643</code></pre>
<p><br /></p>
</div>
<div id="from-entropy-to-acculacy" class="section level3 hasAnchor" number="7.2.2">
<h3><span class="header-section-number">7.2.2</span> From entropy to acculacy<a href="ulysses-compass.html#from-entropy-to-acculacy" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>実際にモデルが真のモデル(target)からどの程度外れているかを評価する際には、<em>Kullback-Leibler divergence</em>を用いる。<em>KL divergence</em>は以下の式で与えられる。<br />
なお、イベント<span class="math inline">\(i\)</span>が起こる真の確率を<span class="math inline">\(p_{i}\)</span>、あるモデルにおいてイベント<span class="math inline">\(i\)</span>が起きるとされる確率を<span class="math inline">\(q_{i}\)</span>とおく。<br />
<br /></p>
<p><span class="math inline">\(D_{KL}(p,q) = \sum_{i} p_{i}(log(p_{i})-log(q_{i})) = \sum_{i} p_{i}log(\frac{p_{i}}{q_{i}})\)</span></p>
<p><br /></p>
<p>例えば、p = {0.3, 0.7}のとき、qによってdivergenceがどのように変化するかを調べると以下のようになり、真の値から遠ざかるほど大きくなることが分かる。</p>
<div class="sourceCode" id="cb587"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb587-1"><a href="ulysses-compass.html#cb587-1" aria-hidden="true" tabindex="-1"></a>D <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb587-2"><a href="ulysses-compass.html#cb587-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">p_1 =</span> <span class="fl">0.3</span>,</span>
<span id="cb587-3"><a href="ulysses-compass.html#cb587-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">p_2 =</span> <span class="fl">0.7</span>,</span>
<span id="cb587-4"><a href="ulysses-compass.html#cb587-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">q_1 =</span> <span class="fu">seq</span>(<span class="fl">0.01</span>,<span class="fl">0.99</span>,<span class="at">by =</span> <span class="fl">0.01</span>)</span>
<span id="cb587-5"><a href="ulysses-compass.html#cb587-5" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb587-6"><a href="ulysses-compass.html#cb587-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">q_2 =</span> <span class="dv">1</span> <span class="sc">-</span> q_1,</span>
<span id="cb587-7"><a href="ulysses-compass.html#cb587-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">d_kl =</span> (p_1<span class="sc">*</span><span class="fu">log</span>(p_1<span class="sc">/</span>q_1))<span class="sc">+</span>(p_2<span class="sc">*</span><span class="fu">log</span>(p_2<span class="sc">/</span>q_2)))</span>
<span id="cb587-8"><a href="ulysses-compass.html#cb587-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb587-9"><a href="ulysses-compass.html#cb587-9" aria-hidden="true" tabindex="-1"></a>D <span class="sc">%&gt;%</span> </span>
<span id="cb587-10"><a href="ulysses-compass.html#cb587-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>q_1,<span class="at">y=</span>d_kl))<span class="sc">+</span></span>
<span id="cb587-11"><a href="ulysses-compass.html#cb587-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">color=</span><span class="st">&quot;navy&quot;</span>,<span class="at">size=</span><span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb587-12"><a href="ulysses-compass.html#cb587-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="fu">aes</span>(<span class="at">xintercept =</span> p_1),<span class="at">linetype=</span><span class="st">&quot;dashed&quot;</span>)<span class="sc">+</span></span>
<span id="cb587-13"><a href="ulysses-compass.html#cb587-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="at">geom=</span><span class="st">&quot;text&quot;</span>,<span class="at">x=</span><span class="fl">0.4</span>,<span class="at">y=</span><span class="fl">1.5</span>,<span class="at">label=</span><span class="st">&quot;q = p&quot;</span>)<span class="sc">+</span></span>
<span id="cb587-14"><a href="ulysses-compass.html#cb587-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">aspect.ratio=</span><span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb587-15"><a href="ulysses-compass.html#cb587-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;q[1]&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Divergence of q from p&quot;</span>)</span></code></pre></div>
<p><img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-274-1.png" width="672" style="display: block; margin: auto;" />
<br /></p>
</div>
<div id="estimating-divergence" class="section level3 hasAnchor" number="7.2.3">
<h3><span class="header-section-number">7.2.3</span> Estimating divergence<a href="ulysses-compass.html#estimating-divergence" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>真のモデルが未知な状態(<span class="math inline">\(p_{i}\)</span>が未知)で<span class="math inline">\(divergence\)</span>は推定できないが、異なるモデル同士の<span class="math inline">\(divergence\)</span>の差を求めることはできる(<span class="math inline">\(p_{i}\)</span>が打ち消されるので)。その際、そのモデルの平均対数尤度さえわかればよい。<br />
そこで、以下の値を求める(<span class="math inline">\(\frac{1}{n}\)</span>倍していないので、平均対数尤度のn倍値である)。<br />
<br /></p>
<p><span class="math inline">\(S(q) = \sum_{i} log(q_{i})\)</span></p>
<p><br /></p>
<p>ベイズ統計では、事後分布を用いて<em>log-pointwise-predictive-density</em>を用いることで対数尤度を求める。<br />
なお、以下で<span class="math inline">\(y\)</span>はデータを、<span class="math inline">\(\theta\)</span>はパラメータを、Sはiterationの数を表す。</p>
<p><span class="math inline">\(lppd(y, \theta) = \sum_{i} log\frac{1}{S} \sum_{s}p(y_{i}|\theta_{s})\)</span></p>
<div class="sourceCode" id="cb588"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb588-1"><a href="ulysses-compass.html#cb588-1" aria-hidden="true" tabindex="-1"></a>lppd <span class="ot">&lt;-</span> <span class="cf">function</span>(brms_fit) {</span>
<span id="cb588-2"><a href="ulysses-compass.html#cb588-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb588-3"><a href="ulysses-compass.html#cb588-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">log_lik</span>(brms_fit) <span class="sc">%&gt;%</span></span>
<span id="cb588-4"><a href="ulysses-compass.html#cb588-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb588-5"><a href="ulysses-compass.html#cb588-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pivot_longer</span>(<span class="fu">everything</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb588-6"><a href="ulysses-compass.html#cb588-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prob =</span> <span class="fu">exp</span>(value)) <span class="sc">%&gt;%</span> </span>
<span id="cb588-7"><a href="ulysses-compass.html#cb588-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(name) <span class="sc">%&gt;%</span> </span>
<span id="cb588-8"><a href="ulysses-compass.html#cb588-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">log_prob_score =</span> <span class="fu">mean</span>(prob) <span class="sc">%&gt;%</span> <span class="fu">log</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb588-9"><a href="ulysses-compass.html#cb588-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">lppd =</span> <span class="fu">sum</span>(log_prob_score))</span>
<span id="cb588-10"><a href="ulysses-compass.html#cb588-10" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb588-11"><a href="ulysses-compass.html#cb588-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb588-12"><a href="ulysses-compass.html#cb588-12" aria-hidden="true" tabindex="-1"></a><span class="fu">lppd</span>(b7<span class="fl">.1</span>)</span></code></pre></div>
<pre><code>## # A tibble: 1 × 1
##    lppd
##   &lt;dbl&gt;
## 1  1.36</code></pre>
<p><br /></p>
</div>
<div id="scoring-the-right-data" class="section level3 hasAnchor" number="7.2.4">
<h3><span class="header-section-number">7.2.4</span> Scoring the right data<a href="ulysses-compass.html#scoring-the-right-data" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>対数尤度も<span class="math inline">\(R^2\)</span>と同様にモデルが複雑なほど大きくなってしまう。-&gt; brmsの結果だと少し変…?</p>
<div class="sourceCode" id="cb590"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb590-1"><a href="ulysses-compass.html#cb590-1" aria-hidden="true" tabindex="-1"></a><span class="co">#tibble(name = str_c(&quot;b7.&quot;, 1:6)) %&gt;% </span></span>
<span id="cb590-2"><a href="ulysses-compass.html#cb590-2" aria-hidden="true" tabindex="-1"></a> <span class="co"># mutate(brms_fit = purrr::map(name,get)) %&gt;% </span></span>
<span id="cb590-3"><a href="ulysses-compass.html#cb590-3" aria-hidden="true" tabindex="-1"></a>  <span class="co">#mutate(lppd = purrr::map(brms_fit, lppd)) %&gt;% </span></span>
<span id="cb590-4"><a href="ulysses-compass.html#cb590-4" aria-hidden="true" tabindex="-1"></a>  <span class="co">#unnest(lppd) -&gt; t_lppd</span></span>
<span id="cb590-5"><a href="ulysses-compass.html#cb590-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb590-6"><a href="ulysses-compass.html#cb590-6" aria-hidden="true" tabindex="-1"></a><span class="fu">readRDS</span>(<span class="st">&quot;output/Chapter7/t_lppd.rds&quot;</span>)</span></code></pre></div>
<pre><code>## # A tibble: 6 × 3
##   name  brms_fit     lppd
##   &lt;chr&gt; &lt;list&gt;      &lt;dbl&gt;
## 1 b7.1  &lt;brmsfit&gt;  1.36  
## 2 b7.2  &lt;brmsfit&gt;  0.722 
## 3 b7.3  &lt;brmsfit&gt;  0.601 
## 4 b7.4  &lt;brmsfit&gt;  0.0125
## 5 b7.5  &lt;brmsfit&gt;  1.22  
## 6 b7.6  &lt;brmsfit&gt; 25.9</code></pre>
<p><br /></p>
<p>ここで、以下のシミュレーションを考える。<br />
1. ある真のモデル(パラメータは3個)を仮定し、そのモデルからデータを10000個生成する。<br />
2. 生成したデータに対してパラメータをそれぞれ1~5個としたモデルをあてはめ、<em>Deviance</em>を計算する。これをN回繰り返す(training)。<br />
3. 真のモデルから新たに10000回データを生成し、2で用いたモデルをあてはめ、<em>Deviance</em>を計算する(test)。これをN回繰り返す。</p>
<p><br /></p>
<p>すると、training dataに関しては、パラメータの数が大きいほど<em>Deviance</em>も小さくなる(当てはまりがよくなる)が、test dataに関してはパラメータが3のときに最も<em>Deviance</em>が小さくなる。</p>
<p><br /></p>
</div>
</div>
<div id="golem-taming-regularization" class="section level2 hasAnchor" number="7.3">
<h2><span class="header-section-number">7.3</span> Golem taming: regularization<a href="ulysses-compass.html#golem-taming-regularization" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>overfittingを防ぐ方法の一つは、データの過学習を防ぐような事前分布を用いることである。そのような事前分布の一つが<em>regularizing prior</em>である。<br />
幅の狭い事前分布を用いれば、とくにデータが少ないときにはoverfittingをある程度は防ぐことができる。ただし、あまりに狭いとunderfittingになるので注意が必要である。<br />
<br /></p>
</div>
<div id="predicting-predictive-accuracy" class="section level2 hasAnchor" number="7.4">
<h2><span class="header-section-number">7.4</span> Predicting predictive accuracy<a href="ulysses-compass.html#predicting-predictive-accuracy" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>実際にはtest sampleは存在しない。それでは、どのようにモデルを評価すればいいだろうか。<br />
主要な方法としては、<em>cross validation</em>と<em>information criteria</em>がある。</p>
<div id="cross-validation" class="section level3 hasAnchor" number="7.4.1">
<h3><span class="header-section-number">7.4.1</span> Cross validation<a href="ulysses-compass.html#cross-validation" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>全てのサンプルについてLOOCVを行うのは計算が大変なため、各サンプルの重要度(事後分布に影響を与える程度)に応じて重みづけをする<em>Pareto-smoothed importance sampling</em>(PSIS)がよく用いられる。</p>
<div class="sourceCode" id="cb592"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb592-1"><a href="ulysses-compass.html#cb592-1" aria-hidden="true" tabindex="-1"></a><span class="co">#lppd &lt;- tibble(name = str_c(&quot;b7.&quot;, 1:2)) %&gt;% </span></span>
<span id="cb592-2"><a href="ulysses-compass.html#cb592-2" aria-hidden="true" tabindex="-1"></a> <span class="co"># mutate(brms_fit = purrr::map(name,get)) %&gt;% </span></span>
<span id="cb592-3"><a href="ulysses-compass.html#cb592-3" aria-hidden="true" tabindex="-1"></a>  <span class="co">#mutate(lppd = purrr::map(brms_fit, loo, reloo= &quot;T&quot;)) </span></span>
<span id="cb592-4"><a href="ulysses-compass.html#cb592-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb592-5"><a href="ulysses-compass.html#cb592-5" aria-hidden="true" tabindex="-1"></a>lppd <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;output/Chapter7/lppd.rds&quot;</span>)</span>
<span id="cb592-6"><a href="ulysses-compass.html#cb592-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb592-7"><a href="ulysses-compass.html#cb592-7" aria-hidden="true" tabindex="-1"></a>lppd<span class="sc">$</span>lppd[[<span class="dv">1</span>]]</span></code></pre></div>
<pre><code>## 
## Computed from 4000 by 7 log-likelihood matrix
## 
##          Estimate  SE
## elpd_loo     -2.0 2.7
## p_loo         3.4 1.7
## looic         4.0 5.4
## ------
## Monte Carlo SE of elpd_loo is 0.2.
## 
## Pareto k diagnostic values:
##                          Count Pct.    Min. n_eff
## (-Inf, 0.5]   (good)     6     85.7%   43        
##  (0.5, 0.7]   (ok)       1     14.3%   383       
##    (0.7, 1]   (bad)      0      0.0%   &lt;NA&gt;      
##    (1, Inf)   (very bad) 0      0.0%   &lt;NA&gt;      
## 
## All Pareto k estimates are ok (k &lt; 0.7).
## See help(&#39;pareto-k-diagnostic&#39;) for details.</code></pre>
<div class="sourceCode" id="cb594"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb594-1"><a href="ulysses-compass.html#cb594-1" aria-hidden="true" tabindex="-1"></a>lppd<span class="sc">$</span>lppd[[<span class="dv">2</span>]]</span></code></pre></div>
<pre><code>## 
## Computed from 4000 by 7 log-likelihood matrix
## 
##          Estimate  SE
## elpd_loo     -2.9 1.9
## p_loo         3.6 1.3
## looic         5.8 3.7
## ------
## Monte Carlo SE of elpd_loo is 0.2.
## 
## Pareto k diagnostic values:
##                          Count Pct.    Min. n_eff
## (-Inf, 0.5]   (good)     5     71.4%   36        
##  (0.5, 0.7]   (ok)       2     28.6%   132       
##    (0.7, 1]   (bad)      0      0.0%   &lt;NA&gt;      
##    (1, Inf)   (very bad) 0      0.0%   &lt;NA&gt;      
## 
## All Pareto k estimates are ok (k &lt; 0.7).
## See help(&#39;pareto-k-diagnostic&#39;) for details.</code></pre>
<p><br /></p>
</div>
<div id="information-criteria" class="section level3 hasAnchor" number="7.4.2">
<h3><span class="header-section-number">7.4.2</span> Information criteria<a href="ulysses-compass.html#information-criteria" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>もう一つが情報量基準である。<br />
事前分布がflatなとき、overfittingによって<em>Deviance</em>がパラメータの2倍分だけ向上することが理論的に分かっている(see figure7.8)。AICはこれを利用して以下のようにモデルを評価する(ただし、pはパラメータの数)。<br />
<br /></p>
<p><span class="math inline">\(AIC = D_{train} + 2p = -2lppd + 2p\)</span></p>
<p><br /></p>
<p>ただし、AICは以下の仮定を満たしているときにしか使えない。<br />
1. 事前分布がflatであるか、事後分布にほとんど影響を与えないとき。<br />
2. 事後分布が多変量正規分布に従うとき。<br />
3. サンプル数Nがパラメータ数pよりも十分大きいとき。<br />
<br /></p>
<p>＊DICは1の仮定が不要であるが、2と3の仮定は必要。</p>
<p><br /></p>
<p><strong>WAIC</strong><br />
1と2の仮定を必要とせず、Nが大きいときにはLOOCVの結果と一致する。</p>
<p><span class="math inline">\(WAIC(y,\theta) = -2(lppd - \sum_{i} var_{\theta} log p(y_{i}|\theta))\)</span></p>
<p><br /></p>
<div class="sourceCode" id="cb596"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb596-1"><a href="ulysses-compass.html#cb596-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">name =</span> <span class="fu">str_c</span>(<span class="st">&quot;b7.&quot;</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb596-2"><a href="ulysses-compass.html#cb596-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">brms_fit =</span> purrr<span class="sc">::</span><span class="fu">map</span>(name,get)) <span class="sc">%&gt;%</span> </span>
<span id="cb596-3"><a href="ulysses-compass.html#cb596-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">WAIC =</span> purrr<span class="sc">::</span><span class="fu">map</span>(brms_fit, WAIC)) <span class="ot">-&gt;</span>r</span>
<span id="cb596-4"><a href="ulysses-compass.html#cb596-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb596-5"><a href="ulysses-compass.html#cb596-5" aria-hidden="true" tabindex="-1"></a>r<span class="sc">$</span>WAIC</span></code></pre></div>
<pre><code>## [[1]]
## 
## Computed from 4000 by 7 log-likelihood matrix
## 
##           Estimate  SE
## elpd_waic     -0.9 1.7
## p_waic         2.2 0.7
## waic           1.8 3.3
## 
## 1 (14.3%) p_waic estimates greater than 0.4. We recommend trying loo instead. 
## 
## [[2]]
## 
## Computed from 4000 by 7 log-likelihood matrix
## 
##           Estimate  SE
## elpd_waic     -2.0 1.1
## p_waic         2.7 0.6
## waic           3.9 2.3
## 
## 2 (28.6%) p_waic estimates greater than 0.4. We recommend trying loo instead. 
## 
## [[3]]
## 
## Computed from 4000 by 7 log-likelihood matrix
## 
##           Estimate  SE
## elpd_waic     -3.0 0.9
## p_waic         3.6 0.4
## waic           6.0 1.8
## 
## 5 (71.4%) p_waic estimates greater than 0.4. We recommend trying loo instead. 
## 
## [[4]]
## 
## Computed from 8000 by 7 log-likelihood matrix
## 
##           Estimate  SE
## elpd_waic     -4.4 0.5
## p_waic         4.4 0.4
## waic           8.9 1.1
## 
## 7 (100.0%) p_waic estimates greater than 0.4. We recommend trying loo instead. 
## 
## [[5]]
## 
## Computed from 8000 by 7 log-likelihood matrix
## 
##           Estimate  SE
## elpd_waic     -5.1 0.5
## p_waic         6.3 0.4
## waic          10.2 1.1
## 
## 7 (100.0%) p_waic estimates greater than 0.4. We recommend trying loo instead.</code></pre>
<p><br /></p>
</div>
<div id="overthinking-waic-calculation" class="section level3 hasAnchor" number="7.4.3">
<h3><span class="header-section-number">7.4.3</span> overthinking: WAIC calculation<a href="ulysses-compass.html#overthinking-waic-calculation" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>以下の例を考える。</p>
<div class="sourceCode" id="cb598"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb598-1"><a href="ulysses-compass.html#cb598-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(cars)</span>
<span id="cb598-2"><a href="ulysses-compass.html#cb598-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(cars)</span></code></pre></div>
<pre><code>##   speed dist
## 1     4    2
## 2     4   10
## 3     7    4
## 4     7   22
## 5     8   16
## 6     9   10</code></pre>
<div class="sourceCode" id="cb600"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb600-1"><a href="ulysses-compass.html#cb600-1" aria-hidden="true" tabindex="-1"></a>b7.m <span class="ot">&lt;-</span> <span class="fu">brm</span>(</span>
<span id="cb600-2"><a href="ulysses-compass.html#cb600-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> cars,</span>
<span id="cb600-3"><a href="ulysses-compass.html#cb600-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> gaussian,</span>
<span id="cb600-4"><a href="ulysses-compass.html#cb600-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">formula =</span> dist <span class="sc">~</span> <span class="dv">1</span><span class="sc">+</span> speed,</span>
<span id="cb600-5"><a href="ulysses-compass.html#cb600-5" aria-hidden="true" tabindex="-1"></a>   <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">100</span>), <span class="at">class =</span> Intercept),</span>
<span id="cb600-6"><a href="ulysses-compass.html#cb600-6" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">10</span>), <span class="at">class =</span> b),</span>
<span id="cb600-7"><a href="ulysses-compass.html#cb600-7" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>), <span class="at">class =</span> sigma)),</span>
<span id="cb600-8"><a href="ulysses-compass.html#cb600-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">backend =</span> <span class="st">&quot;cmdstanr&quot;</span>,</span>
<span id="cb600-9"><a href="ulysses-compass.html#cb600-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed=</span><span class="dv">7</span>, <span class="at">file =</span> <span class="st">&quot;output/Chapter7/b7.m&quot;</span></span>
<span id="cb600-10"><a href="ulysses-compass.html#cb600-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb600-11"><a href="ulysses-compass.html#cb600-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb600-12"><a href="ulysses-compass.html#cb600-12" aria-hidden="true" tabindex="-1"></a><span class="fu">posterior_summary</span>(b7.m) <span class="sc">%&gt;%</span> </span>
<span id="cb600-13"><a href="ulysses-compass.html#cb600-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb600-14"><a href="ulysses-compass.html#cb600-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>(<span class="at">var =</span> <span class="st">&quot;parameters&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb600-15"><a href="ulysses-compass.html#cb600-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(parameters <span class="sc">!=</span><span class="st">&quot;lp__&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb600-16"><a href="ulysses-compass.html#cb600-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>()</span></code></pre></div>
<pre><code>## # A tibble: 4 × 5
##   parameters  Estimate Est.Error   Q2.5  Q97.5
##   &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;
## 1 b_Intercept   -17.5      6.06  -29.3   -5.51
## 2 b_speed         3.92     0.377   3.16   4.65
## 3 sigma          13.9      1.23   11.7   16.5 
## 4 lprior        -22.8      1.23  -25.4  -20.6</code></pre>
<p>WAICを計算する。<br />
関数を使った値とほとんど一致する。</p>
<div class="sourceCode" id="cb602"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb602-1"><a href="ulysses-compass.html#cb602-1" aria-hidden="true" tabindex="-1"></a>lppd <span class="ot">&lt;-</span> <span class="fu">lppd</span>(b7.m)[[<span class="dv">1</span>]]</span>
<span id="cb602-2"><a href="ulysses-compass.html#cb602-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb602-3"><a href="ulysses-compass.html#cb602-3" aria-hidden="true" tabindex="-1"></a>pwaic <span class="ot">&lt;-</span> </span>
<span id="cb602-4"><a href="ulysses-compass.html#cb602-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">log_lik</span>(b7.m) <span class="sc">%&gt;%</span> </span>
<span id="cb602-5"><a href="ulysses-compass.html#cb602-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb602-6"><a href="ulysses-compass.html#cb602-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">everything</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb602-7"><a href="ulysses-compass.html#cb602-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(name) <span class="sc">%&gt;%</span> </span>
<span id="cb602-8"><a href="ulysses-compass.html#cb602-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">var_log =</span> <span class="fu">var</span>(value)) <span class="sc">%&gt;%</span> </span>
<span id="cb602-9"><a href="ulysses-compass.html#cb602-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">pwaic =</span> <span class="fu">sum</span>(var_log)) <span class="sc">%&gt;%</span> </span>
<span id="cb602-10"><a href="ulysses-compass.html#cb602-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>()</span>
<span id="cb602-11"><a href="ulysses-compass.html#cb602-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb602-12"><a href="ulysses-compass.html#cb602-12" aria-hidden="true" tabindex="-1"></a>hand_waic <span class="ot">&lt;-</span> <span class="sc">-</span><span class="dv">2</span><span class="sc">*</span>(lppd<span class="sc">-</span>pwaic)</span>
<span id="cb602-13"><a href="ulysses-compass.html#cb602-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb602-14"><a href="ulysses-compass.html#cb602-14" aria-hidden="true" tabindex="-1"></a>hand_waic</span></code></pre></div>
<pre><code>## [1] -145.3186</code></pre>
<div class="sourceCode" id="cb604"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb604-1"><a href="ulysses-compass.html#cb604-1" aria-hidden="true" tabindex="-1"></a><span class="fu">WAIC</span>(b7.m)</span></code></pre></div>
<pre><code>## 
## Computed from 4000 by 50 log-likelihood matrix
## 
##           Estimate   SE
## elpd_waic   -210.8  8.2
## p_waic         4.2  1.6
## waic         421.5 16.4
## 
## 2 (4.0%) p_waic estimates greater than 0.4. We recommend trying loo instead.</code></pre>
<div class="sourceCode" id="cb606"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb606-1"><a href="ulysses-compass.html#cb606-1" aria-hidden="true" tabindex="-1"></a><span class="fu">loo</span>(b7.m)</span></code></pre></div>
<pre><code>## 
## Computed from 4000 by 50 log-likelihood matrix
## 
##          Estimate   SE
## elpd_loo   -210.9  8.3
## p_loo         4.3  1.7
## looic       421.8 16.5
## ------
## Monte Carlo SE of elpd_loo is 0.1.
## 
## Pareto k diagnostic values:
##                          Count Pct.    Min. n_eff
## (-Inf, 0.5]   (good)     49    98.0%   855       
##  (0.5, 0.7]   (ok)        1     2.0%   252       
##    (0.7, 1]   (bad)       0     0.0%   &lt;NA&gt;      
##    (1, Inf)   (very bad)  0     0.0%   &lt;NA&gt;      
## 
## All Pareto k estimates are ok (k &lt; 0.7).
## See help(&#39;pareto-k-diagnostic&#39;) for details.</code></pre>
<p><br /></p>
</div>
<div id="comparing-cv-psis-and-waic" class="section level3 hasAnchor" number="7.4.4">
<h3><span class="header-section-number">7.4.4</span> Comparing CV, PSIS, and WAIC<a href="ulysses-compass.html#comparing-cv-psis-and-waic" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>それぞれを比較して使うことが重要である。<br />
正しく推定できていれば、ほとんど同じになるはずである。<br />
<br /></p>
</div>
</div>
<div id="model-comparison" class="section level2 hasAnchor" number="7.5">
<h2><span class="header-section-number">7.5</span> Model comparison<a href="ulysses-compass.html#model-comparison" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="model-mis-selection" class="section level3 hasAnchor" number="7.5.1">
<h3><span class="header-section-number">7.5.1</span> Model mis-selection<a href="ulysses-compass.html#model-mis-selection" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>WAICやPSISはあくまでもモデルの予測に関する指標であって、因果関係についてはなにも教えてくれない。</p>
<p><br /></p>
<p>例えば、Chapter6での植物の成長に関するモデルを再び考える。処置後の真菌の情報を入れたモデルは、処置が植物の成長に与える影響を推測する際には不適切だが、WAICはもっとも小さい。</p>
<div class="sourceCode" id="cb608"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb608-1"><a href="ulysses-compass.html#cb608-1" aria-hidden="true" tabindex="-1"></a>b6<span class="fl">.3</span>_h <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;output/Chapter6/b6.3_h.rds&quot;</span>)</span>
<span id="cb608-2"><a href="ulysses-compass.html#cb608-2" aria-hidden="true" tabindex="-1"></a>b6<span class="fl">.3</span>_htf <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;output/Chapter6/b6.3_htf.rds&quot;</span>)</span>
<span id="cb608-3"><a href="ulysses-compass.html#cb608-3" aria-hidden="true" tabindex="-1"></a>b6<span class="fl">.3</span>_ht <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;output/Chapter6/b6.3_ht.rds&quot;</span>)  </span>
<span id="cb608-4"><a href="ulysses-compass.html#cb608-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb608-5"><a href="ulysses-compass.html#cb608-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb608-6"><a href="ulysses-compass.html#cb608-6" aria-hidden="true" tabindex="-1"></a><span class="co"># WAIC</span></span>
<span id="cb608-7"><a href="ulysses-compass.html#cb608-7" aria-hidden="true" tabindex="-1"></a>b6<span class="fl">.3</span>_h <span class="ot">&lt;-</span> <span class="fu">add_criterion</span>(b6<span class="fl">.3</span>_h, <span class="at">criterion =</span> <span class="st">&quot;waic&quot;</span>) </span>
<span id="cb608-8"><a href="ulysses-compass.html#cb608-8" aria-hidden="true" tabindex="-1"></a>b6<span class="fl">.3</span>_htf <span class="ot">&lt;-</span> <span class="fu">add_criterion</span>(b6<span class="fl">.3</span>_htf,<span class="at">criterion =</span> <span class="st">&quot;waic&quot;</span>) </span>
<span id="cb608-9"><a href="ulysses-compass.html#cb608-9" aria-hidden="true" tabindex="-1"></a>b6<span class="fl">.3</span>_ht <span class="ot">&lt;-</span> <span class="fu">add_criterion</span>(b6<span class="fl">.3</span>_ht, <span class="at">criterion =</span> <span class="st">&quot;waic&quot;</span>) </span>
<span id="cb608-10"><a href="ulysses-compass.html#cb608-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb608-11"><a href="ulysses-compass.html#cb608-11" aria-hidden="true" tabindex="-1"></a>w <span class="ot">&lt;-</span> <span class="fu">loo_compare</span>(b6<span class="fl">.3</span>_h, b6<span class="fl">.3</span>_htf, b6<span class="fl">.3</span>_ht, <span class="at">criterion =</span> <span class="st">&quot;waic&quot;</span>)</span>
<span id="cb608-12"><a href="ulysses-compass.html#cb608-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb608-13"><a href="ulysses-compass.html#cb608-13" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(w, <span class="at">simplify =</span> F) </span></code></pre></div>
<pre><code>##          elpd_diff se_diff elpd_waic se_elpd_waic p_waic se_p_waic waic  
## b6.3_htf    0.0       0.0  -180.6       6.7          3.4    0.5     361.3
## b6.3_ht   -20.6       4.9  -201.3       5.4          2.5    0.3     402.5
## b6.3_h    -22.4       5.8  -203.0       5.7          1.6    0.2     406.0
##          se_waic
## b6.3_htf   13.4 
## b6.3_ht    10.8 
## b6.3_h     11.3</code></pre>
<div class="sourceCode" id="cb610"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb610-1"><a href="ulysses-compass.html#cb610-1" aria-hidden="true" tabindex="-1"></a><span class="co">#PSIS </span></span>
<span id="cb610-2"><a href="ulysses-compass.html#cb610-2" aria-hidden="true" tabindex="-1"></a>b6<span class="fl">.3</span>_h_loo <span class="ot">&lt;-</span> <span class="fu">add_criterion</span>(b6<span class="fl">.3</span>_h, <span class="at">criterion =</span> <span class="st">&quot;loo&quot;</span>) </span>
<span id="cb610-3"><a href="ulysses-compass.html#cb610-3" aria-hidden="true" tabindex="-1"></a>b6<span class="fl">.3</span>_htf_loo <span class="ot">&lt;-</span> <span class="fu">add_criterion</span>(b6<span class="fl">.3</span>_htf,<span class="at">criterion =</span> <span class="st">&quot;loo&quot;</span>) </span>
<span id="cb610-4"><a href="ulysses-compass.html#cb610-4" aria-hidden="true" tabindex="-1"></a>b6<span class="fl">.3</span>_ht_loo <span class="ot">&lt;-</span> <span class="fu">add_criterion</span>(b6<span class="fl">.3</span>_ht, <span class="at">criterion =</span> <span class="st">&quot;loo&quot;</span>) </span>
<span id="cb610-5"><a href="ulysses-compass.html#cb610-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb610-6"><a href="ulysses-compass.html#cb610-6" aria-hidden="true" tabindex="-1"></a>w_loo <span class="ot">&lt;-</span> <span class="fu">loo_compare</span>(b6<span class="fl">.3</span>_h_loo, b6<span class="fl">.3</span>_htf_loo, b6<span class="fl">.3</span>_ht_loo, <span class="at">criterion =</span> <span class="st">&quot;loo&quot;</span>)</span>
<span id="cb610-7"><a href="ulysses-compass.html#cb610-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb610-8"><a href="ulysses-compass.html#cb610-8" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(w_loo, <span class="at">simplify =</span> F)  </span></code></pre></div>
<pre><code>##              elpd_diff se_diff elpd_loo se_elpd_loo p_loo  se_p_loo looic 
## b6.3_htf_loo    0.0       0.0  -180.7      6.7         3.4    0.5    361.3
## b6.3_ht_loo   -20.6       4.9  -201.3      5.4         2.5    0.3    402.5
## b6.3_h_loo    -22.3       5.8  -203.0      5.7         1.6    0.2    406.0
##              se_looic
## b6.3_htf_loo   13.5  
## b6.3_ht_loo    10.8  
## b6.3_h_loo     11.3</code></pre>
<p><br /></p>
<p>WAICの差が正規分布すると仮定すると、b6.3_htfとb6.3_htのWAICの差の99%信頼区間は以下の通り。</p>
<div class="sourceCode" id="cb612"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb612-1"><a href="ulysses-compass.html#cb612-1" aria-hidden="true" tabindex="-1"></a>(w[<span class="dv">2</span>, <span class="dv">1</span>] <span class="sc">*</span> <span class="sc">-</span><span class="dv">2</span>) <span class="sc">+</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>) <span class="sc">*</span> (w[<span class="dv">2</span>, <span class="dv">2</span>] <span class="sc">*</span> <span class="dv">2</span>) <span class="sc">*</span> <span class="fl">2.6</span></span></code></pre></div>
<pre><code>## [1] 15.56371 66.88758</code></pre>
<p><br /></p>
<p>WAICを標準誤差と共にプロットすると…。</p>
<div class="sourceCode" id="cb614"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb614-1"><a href="ulysses-compass.html#cb614-1" aria-hidden="true" tabindex="-1"></a>w[,<span class="dv">7</span><span class="sc">:</span><span class="dv">8</span>] <span class="sc">%&gt;%</span> </span>
<span id="cb614-2"><a href="ulysses-compass.html#cb614-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb614-3"><a href="ulysses-compass.html#cb614-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>(<span class="st">&quot;model_name&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb614-4"><a href="ulysses-compass.html#cb614-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">model_name =</span></span>
<span id="cb614-5"><a href="ulysses-compass.html#cb614-5" aria-hidden="true" tabindex="-1"></a>           <span class="fu">fct_reorder</span>(model_name,waic,<span class="at">.desc=</span>T)) <span class="sc">%&gt;%</span> </span>
<span id="cb614-6"><a href="ulysses-compass.html#cb614-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> waic, <span class="at">y =</span> model_name, </span>
<span id="cb614-7"><a href="ulysses-compass.html#cb614-7" aria-hidden="true" tabindex="-1"></a>             <span class="at">xmin =</span> waic <span class="sc">-</span> se_waic, </span>
<span id="cb614-8"><a href="ulysses-compass.html#cb614-8" aria-hidden="true" tabindex="-1"></a>             <span class="at">xmax =</span> waic <span class="sc">+</span> se_waic))<span class="sc">+</span></span>
<span id="cb614-9"><a href="ulysses-compass.html#cb614-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_pointrange</span>(<span class="at">shape=</span><span class="dv">21</span>, <span class="at">fill =</span> <span class="st">&quot;black&quot;</span>,<span class="at">color=</span><span class="st">&quot;black&quot;</span>)<span class="sc">+</span></span>
<span id="cb614-10"><a href="ulysses-compass.html#cb614-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;WAIC with standard error&quot;</span>,</span>
<span id="cb614-11"><a href="ulysses-compass.html#cb614-11" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="cn">NULL</span>)<span class="sc">+</span></span>
<span id="cb614-12"><a href="ulysses-compass.html#cb614-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.ticks.y =</span> <span class="fu">element_blank</span>())</span></code></pre></div>
<p><img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-283-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>b6.3_hとb6.3_htのWAICの差の標準誤差は差そのものよりも大きい。よってこれらのモデルのWAICの間に差はほとんどないといえる。</p>
<div class="sourceCode" id="cb615"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb615-1"><a href="ulysses-compass.html#cb615-1" aria-hidden="true" tabindex="-1"></a><span class="fu">loo_compare</span>(b6<span class="fl">.3</span>_h, b6<span class="fl">.3</span>_ht, <span class="at">criterion =</span> <span class="st">&quot;waic&quot;</span>)[<span class="dv">2</span>,<span class="dv">2</span>]<span class="sc">*</span><span class="dv">2</span></span></code></pre></div>
<pre><code>## [1] 4.652457</code></pre>
<p>各モデルのWAICに基づくweightは以下のように算出する。
なお、<span class="math inline">\(\varDelta_{i}\)</span>はWAICが最小のモデルとのWAICの差である。</p>
<p><span class="math inline">\(w_{i} = \frac {exp(-0.5\varDelta_{i})}{\sum_{j} exp(-0.5\varDelta_{j})}\)</span></p>
<div class="sourceCode" id="cb617"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb617-1"><a href="ulysses-compass.html#cb617-1" aria-hidden="true" tabindex="-1"></a><span class="fu">model_weights</span>(b6<span class="fl">.3</span>_htf,b6<span class="fl">.3</span>_h, b6<span class="fl">.3</span>_ht, <span class="at">weights =</span> <span class="st">&quot;waic&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb617-2"><a href="ulysses-compass.html#cb617-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">round</span>(<span class="dv">2</span>)</span></code></pre></div>
<pre><code>## b6.3_htf   b6.3_h  b6.3_ht 
##        1        0        0</code></pre>
<p><br /></p>
</div>
<div id="outlier-and-other-illusions" class="section level3 hasAnchor" number="7.5.2">
<h3><span class="header-section-number">7.5.2</span> Outlier and other illusions<a href="ulysses-compass.html#outlier-and-other-illusions" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Waffle Divorceの例を再び考える。</p>
<div class="sourceCode" id="cb619"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb619-1"><a href="ulysses-compass.html#cb619-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;WaffleDivorce&quot;</span>)</span>
<span id="cb619-2"><a href="ulysses-compass.html#cb619-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb619-3"><a href="ulysses-compass.html#cb619-3" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> WaffleDivorce <span class="sc">%&gt;%</span> </span>
<span id="cb619-4"><a href="ulysses-compass.html#cb619-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">D =</span> <span class="fu">standardize</span>(Divorce),</span>
<span id="cb619-5"><a href="ulysses-compass.html#cb619-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">M =</span> <span class="fu">standardize</span>(Marriage),</span>
<span id="cb619-6"><a href="ulysses-compass.html#cb619-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">A =</span> <span class="fu">standardize</span>(MedianAgeMarriage))</span>
<span id="cb619-7"><a href="ulysses-compass.html#cb619-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb619-8"><a href="ulysses-compass.html#cb619-8" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(WaffleDivorce)</span></code></pre></div>
<p><br /></p>
<p>Aのみが説明変数のモデルb5.1が最もPSISが小さいが、b5.3との差はわずかである。つまり、Mはほとんど予測を向上させない。</p>
<div class="sourceCode" id="cb620"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb620-1"><a href="ulysses-compass.html#cb620-1" aria-hidden="true" tabindex="-1"></a>b5<span class="fl">.1</span> <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;output/Chapter5/b5.1.rds&quot;</span>)</span>
<span id="cb620-2"><a href="ulysses-compass.html#cb620-2" aria-hidden="true" tabindex="-1"></a>b5<span class="fl">.2</span> <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;output/Chapter5/b5.2.rds&quot;</span>)</span>
<span id="cb620-3"><a href="ulysses-compass.html#cb620-3" aria-hidden="true" tabindex="-1"></a>b5<span class="fl">.3</span> <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;output/Chapter5/b5.3.rds&quot;</span>)  </span>
<span id="cb620-4"><a href="ulysses-compass.html#cb620-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb620-5"><a href="ulysses-compass.html#cb620-5" aria-hidden="true" tabindex="-1"></a>b5<span class="fl">.1</span> <span class="ot">&lt;-</span> <span class="fu">add_criterion</span>(b5<span class="fl">.1</span>, <span class="at">criterion =</span> <span class="st">&quot;loo&quot;</span>)</span>
<span id="cb620-6"><a href="ulysses-compass.html#cb620-6" aria-hidden="true" tabindex="-1"></a>b5<span class="fl">.2</span> <span class="ot">&lt;-</span> <span class="fu">add_criterion</span>(b5<span class="fl">.2</span>, <span class="at">criterion =</span> <span class="st">&quot;loo&quot;</span>)</span>
<span id="cb620-7"><a href="ulysses-compass.html#cb620-7" aria-hidden="true" tabindex="-1"></a>b5<span class="fl">.3</span> <span class="ot">&lt;-</span> <span class="fu">add_criterion</span>(b5<span class="fl">.3</span>, <span class="at">criterion =</span> <span class="st">&quot;loo&quot;</span>)</span>
<span id="cb620-8"><a href="ulysses-compass.html#cb620-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb620-9"><a href="ulysses-compass.html#cb620-9" aria-hidden="true" tabindex="-1"></a><span class="fu">loo_compare</span>(b5<span class="fl">.1</span>,b5<span class="fl">.2</span>,b5<span class="fl">.3</span>, <span class="at">criterion =</span> <span class="st">&quot;loo&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb620-10"><a href="ulysses-compass.html#cb620-10" aria-hidden="true" tabindex="-1"></a> <span class="fu">print</span>(<span class="at">simplify =</span> F)</span></code></pre></div>
<pre><code>##      elpd_diff se_diff elpd_loo se_elpd_loo p_loo se_p_loo looic se_looic
## b5.1   0.0       0.0   -62.9      6.4         3.7   1.8    125.9  12.8   
## b5.3  -0.9       0.4   -63.8      6.4         4.8   1.9    127.7  12.9   
## b5.2  -6.7       4.6   -69.6      4.9         2.9   0.9    139.2   9.8</code></pre>
<p><br /></p>
<p>教科書と違い、<span class="math inline">\(k\)</span>が大きすぎるデータは出なかった。
0.5以上となったのは1点のみ。</p>
<div class="sourceCode" id="cb622"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb622-1"><a href="ulysses-compass.html#cb622-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(loo)</span>
<span id="cb622-2"><a href="ulysses-compass.html#cb622-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb622-3"><a href="ulysses-compass.html#cb622-3" aria-hidden="true" tabindex="-1"></a><span class="fu">loo</span>(b5<span class="fl">.3</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb622-4"><a href="ulysses-compass.html#cb622-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pareto_k_ids</span>(<span class="at">threshold =</span> .<span class="dv">5</span>)</span></code></pre></div>
<pre><code>## [1] 13</code></pre>
<div class="sourceCode" id="cb624"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb624-1"><a href="ulysses-compass.html#cb624-1" aria-hidden="true" tabindex="-1"></a>d <span class="sc">%&gt;%</span> </span>
<span id="cb624-2"><a href="ulysses-compass.html#cb624-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">13</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb624-3"><a href="ulysses-compass.html#cb624-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(Location,Loc)</span></code></pre></div>
<pre><code>##   Location Loc
## 1    Idaho  ID</code></pre>
<div class="sourceCode" id="cb626"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb626-1"><a href="ulysses-compass.html#cb626-1" aria-hidden="true" tabindex="-1"></a><span class="fu">pareto_k_values</span>(<span class="fu">loo</span>(b5<span class="fl">.3</span>))[<span class="dv">13</span>]</span></code></pre></div>
<pre><code>## [1] 0.5123012</code></pre>
<p>WAICのpwaicと比較してみる。</p>
<div class="sourceCode" id="cb628"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb628-1"><a href="ulysses-compass.html#cb628-1" aria-hidden="true" tabindex="-1"></a>k <span class="ot">&lt;-</span> <span class="fu">pareto_k_values</span>(<span class="fu">loo</span>(b5<span class="fl">.3</span>))  </span>
<span id="cb628-2"><a href="ulysses-compass.html#cb628-2" aria-hidden="true" tabindex="-1"></a>b5<span class="fl">.3</span> <span class="ot">&lt;-</span> <span class="fu">add_criterion</span>(b5<span class="fl">.3</span>, <span class="st">&quot;waic&quot;</span>)</span>
<span id="cb628-3"><a href="ulysses-compass.html#cb628-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb628-4"><a href="ulysses-compass.html#cb628-4" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">k =</span> k,</span>
<span id="cb628-5"><a href="ulysses-compass.html#cb628-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">p_waic =</span> b5<span class="fl">.3</span><span class="sc">$</span>criteria<span class="sc">$</span>waic<span class="sc">$</span>pointwise[,<span class="dv">2</span>],</span>
<span id="cb628-6"><a href="ulysses-compass.html#cb628-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">Loc =</span> <span class="fu">pull</span>(d,Loc)) <span class="sc">%&gt;%</span> </span>
<span id="cb628-7"><a href="ulysses-compass.html#cb628-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> k, <span class="at">y =</span> p_waic, <span class="at">color =</span> Loc <span class="sc">==</span> <span class="st">&quot;ID&quot;</span>))<span class="sc">+</span></span>
<span id="cb628-8"><a href="ulysses-compass.html#cb628-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fl">0.5</span>, <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>,</span>
<span id="cb628-9"><a href="ulysses-compass.html#cb628-9" aria-hidden="true" tabindex="-1"></a>             <span class="at">alpha =</span><span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>)<span class="sc">+</span></span>
<span id="cb628-10"><a href="ulysses-compass.html#cb628-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">shape =</span> Loc <span class="sc">==</span> <span class="st">&quot;ID&quot;</span>),<span class="at">size=</span><span class="dv">2</span>, <span class="at">stroke=</span><span class="fl">1.5</span>)<span class="sc">+</span></span>
<span id="cb628-11"><a href="ulysses-compass.html#cb628-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">data =</span> . <span class="sc">%&gt;%</span> <span class="fu">filter</span>(p_waic <span class="sc">&gt;</span>.<span class="dv">5</span>),</span>
<span id="cb628-12"><a href="ulysses-compass.html#cb628-12" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">aes</span>(<span class="at">x =</span> k<span class="fl">-0.05</span>,<span class="at">label=</span>Loc))<span class="sc">+</span></span>
<span id="cb628-13"><a href="ulysses-compass.html#cb628-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_shape_manual</span>(<span class="at">values=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">19</span>))<span class="sc">+</span></span>
<span id="cb628-14"><a href="ulysses-compass.html#cb628-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values=</span><span class="fu">c</span>(<span class="st">&quot;navy&quot;</span>,<span class="st">&quot;red&quot;</span>))<span class="sc">+</span></span>
<span id="cb628-15"><a href="ulysses-compass.html#cb628-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position=</span><span class="st">&quot;none&quot;</span>,</span>
<span id="cb628-16"><a href="ulysses-compass.html#cb628-16" aria-hidden="true" tabindex="-1"></a>        <span class="at">aspect.ratio=</span><span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb628-17"><a href="ulysses-compass.html#cb628-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;b5.3&quot;</span>) <span class="ot">-&gt;</span>p1</span>
<span id="cb628-18"><a href="ulysses-compass.html#cb628-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb628-19"><a href="ulysses-compass.html#cb628-19" aria-hidden="true" tabindex="-1"></a>p1</span></code></pre></div>
<p><img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-289-1.png" width="672" style="display: block; margin: auto;" />
<br /></p>
<p>外れ値があった場合、正規分布よりも裾の広い分布を用いることでより頑強な結果が得られる。</p>
<div class="sourceCode" id="cb629"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb629-1"><a href="ulysses-compass.html#cb629-1" aria-hidden="true" tabindex="-1"></a>b5<span class="fl">.3</span>t <span class="ot">&lt;-</span> </span>
<span id="cb629-2"><a href="ulysses-compass.html#cb629-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">brm</span>(<span class="at">data =</span>d,</span>
<span id="cb629-3"><a href="ulysses-compass.html#cb629-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> student,</span>
<span id="cb629-4"><a href="ulysses-compass.html#cb629-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">formula =</span> <span class="fu">bf</span>(D <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> A <span class="sc">+</span> M, <span class="at">nu=</span><span class="dv">2</span>),</span>
<span id="cb629-5"><a href="ulysses-compass.html#cb629-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">0.2</span>),<span class="at">class=</span> Intercept),</span>
<span id="cb629-6"><a href="ulysses-compass.html#cb629-6" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">0.5</span>), <span class="at">class =</span> b),</span>
<span id="cb629-7"><a href="ulysses-compass.html#cb629-7" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>), <span class="at">class =</span> sigma)),</span>
<span id="cb629-8"><a href="ulysses-compass.html#cb629-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">backend =</span> <span class="st">&quot;cmdstanr&quot;</span>,</span>
<span id="cb629-9"><a href="ulysses-compass.html#cb629-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">seed =</span><span class="dv">5</span>, <span class="at">file =</span> <span class="st">&quot;output/Chapter7/b5.3t&quot;</span>)</span>
<span id="cb629-10"><a href="ulysses-compass.html#cb629-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb629-11"><a href="ulysses-compass.html#cb629-11" aria-hidden="true" tabindex="-1"></a><span class="fu">posterior_summary</span>(b5<span class="fl">.3</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb629-12"><a href="ulysses-compass.html#cb629-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb629-13"><a href="ulysses-compass.html#cb629-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">round</span>(<span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb629-14"><a href="ulysses-compass.html#cb629-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>(<span class="at">var =</span> <span class="st">&quot;parameters&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb629-15"><a href="ulysses-compass.html#cb629-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(parameters <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;b_Intercept&quot;</span>,<span class="st">&quot;b_A&quot;</span>,<span class="st">&quot;b_M&quot;</span>,<span class="st">&quot;sigma&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb629-16"><a href="ulysses-compass.html#cb629-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() </span></code></pre></div>
<pre><code>## # A tibble: 4 × 5
##   parameters  Estimate Est.Error  Q2.5 Q97.5
##   &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1 b_Intercept     0         0.1  -0.19  0.2 
## 2 b_A            -0.61      0.16 -0.93 -0.29
## 3 b_M            -0.06      0.16 -0.38  0.25
## 4 sigma           0.83      0.09  0.68  1.01</code></pre>
<div class="sourceCode" id="cb631"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb631-1"><a href="ulysses-compass.html#cb631-1" aria-hidden="true" tabindex="-1"></a><span class="fu">posterior_summary</span>(b5<span class="fl">.3</span>t) <span class="sc">%&gt;%</span> </span>
<span id="cb631-2"><a href="ulysses-compass.html#cb631-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb631-3"><a href="ulysses-compass.html#cb631-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">round</span>(<span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb631-4"><a href="ulysses-compass.html#cb631-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>(<span class="at">var =</span> <span class="st">&quot;parameters&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb631-5"><a href="ulysses-compass.html#cb631-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(parameters <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;b_Intercept&quot;</span>,<span class="st">&quot;b_A&quot;</span>,<span class="st">&quot;b_M&quot;</span>,<span class="st">&quot;sigma&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb631-6"><a href="ulysses-compass.html#cb631-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() </span></code></pre></div>
<pre><code>## # A tibble: 4 × 5
##   parameters  Estimate Est.Error  Q2.5 Q97.5
##   &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1 b_Intercept     0.03      0.1  -0.18  0.23
## 2 b_A            -0.7       0.15 -1    -0.41
## 3 b_M             0.05      0.2  -0.32  0.47
## 4 sigma           0.58      0.09  0.43  0.78</code></pre>
<div class="sourceCode" id="cb633"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb633-1"><a href="ulysses-compass.html#cb633-1" aria-hidden="true" tabindex="-1"></a>b5<span class="fl">.3</span>t <span class="ot">&lt;-</span> <span class="fu">add_criterion</span>(b5<span class="fl">.3</span>t,<span class="fu">c</span>(<span class="st">&quot;waic&quot;</span>,<span class="st">&quot;loo&quot;</span>))</span></code></pre></div>
<p>かなり改善したことが分かる。</p>
<div class="sourceCode" id="cb634"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb634-1"><a href="ulysses-compass.html#cb634-1" aria-hidden="true" tabindex="-1"></a>k_t <span class="ot">&lt;-</span> <span class="fu">pareto_k_values</span>(<span class="fu">loo</span>(b5<span class="fl">.3</span>t))</span>
<span id="cb634-2"><a href="ulysses-compass.html#cb634-2" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">k =</span> k_t,</span>
<span id="cb634-3"><a href="ulysses-compass.html#cb634-3" aria-hidden="true" tabindex="-1"></a>       <span class="at">p_waic =</span> b5<span class="fl">.3</span>t<span class="sc">$</span>criteria<span class="sc">$</span>waic<span class="sc">$</span>pointwise[,<span class="dv">2</span>],</span>
<span id="cb634-4"><a href="ulysses-compass.html#cb634-4" aria-hidden="true" tabindex="-1"></a>       <span class="at">Loc =</span> <span class="fu">pull</span>(d,Loc)) <span class="sc">%&gt;%</span> </span>
<span id="cb634-5"><a href="ulysses-compass.html#cb634-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> k, <span class="at">y =</span> p_waic, <span class="at">color =</span> Loc <span class="sc">==</span> <span class="st">&quot;ID&quot;</span>))<span class="sc">+</span></span>
<span id="cb634-6"><a href="ulysses-compass.html#cb634-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">shape =</span> Loc <span class="sc">==</span> <span class="st">&quot;ID&quot;</span>),<span class="at">size=</span><span class="dv">2</span>, <span class="at">stroke=</span><span class="fl">1.5</span>)<span class="sc">+</span></span>
<span id="cb634-7"><a href="ulysses-compass.html#cb634-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">data =</span> . <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Loc <span class="sc">%in%</span><span class="fu">c</span>(<span class="st">&quot;ME&quot;</span>,<span class="st">&quot;ID&quot;</span>)),</span>
<span id="cb634-8"><a href="ulysses-compass.html#cb634-8" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">aes</span>(<span class="at">x =</span> k<span class="fl">-0.02</span>,<span class="at">y =</span> p_waic<span class="fl">+0.02</span>,<span class="at">label=</span>Loc))<span class="sc">+</span></span>
<span id="cb634-9"><a href="ulysses-compass.html#cb634-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_shape_manual</span>(<span class="at">values=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">19</span>))<span class="sc">+</span></span>
<span id="cb634-10"><a href="ulysses-compass.html#cb634-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values=</span><span class="fu">c</span>(<span class="st">&quot;navy&quot;</span>,<span class="st">&quot;red&quot;</span>))<span class="sc">+</span></span>
<span id="cb634-11"><a href="ulysses-compass.html#cb634-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position=</span><span class="st">&quot;none&quot;</span>,</span>
<span id="cb634-12"><a href="ulysses-compass.html#cb634-12" aria-hidden="true" tabindex="-1"></a>        <span class="at">aspect.ratio=</span><span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb634-13"><a href="ulysses-compass.html#cb634-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;b5.3t&quot;</span>) <span class="ot">-&gt;</span>p2</span>
<span id="cb634-14"><a href="ulysses-compass.html#cb634-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb634-15"><a href="ulysses-compass.html#cb634-15" aria-hidden="true" tabindex="-1"></a>p1<span class="sc">|</span>p2</span></code></pre></div>
<p><img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-292-1.png" width="672" style="display: block; margin: auto;" /></p>
<p><br /></p>
</div>
</div>
<div id="practice-5" class="section level2 hasAnchor" number="7.6">
<h2><span class="header-section-number">7.6</span> Practice<a href="ulysses-compass.html#practice-5" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="e2" class="section level3 hasAnchor" number="7.6.1">
<h3><span class="header-section-number">7.6.1</span> 7E2<a href="ulysses-compass.html#e2" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<blockquote>
<p>Suppose a coin is weighted such that, when it is tossed and lands on a table, it comes up heads 70% of the time. What is the entropy of this coin?</p>
</blockquote>
<div class="sourceCode" id="cb635"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb635-1"><a href="ulysses-compass.html#cb635-1" aria-hidden="true" tabindex="-1"></a><span class="sc">-</span>(<span class="fl">0.7</span><span class="sc">*</span><span class="fu">log</span>(<span class="fl">0.7</span>)<span class="sc">+</span><span class="fl">0.3</span><span class="sc">*</span><span class="fu">log</span>(<span class="fl">0.3</span>))</span></code></pre></div>
<pre><code>## [1] 0.6108643</code></pre>
</div>
<div id="e3" class="section level3 hasAnchor" number="7.6.2">
<h3><span class="header-section-number">7.6.2</span> 7E3<a href="ulysses-compass.html#e3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<blockquote>
<p>Suppose a four-sided die is loaded such that, when tossed onto a table, it shows “1” 20%, “2” 25%, “3” 25%, and “4” 30% of the time. What is the entropy of this die?</p>
</blockquote>
<div class="sourceCode" id="cb637"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb637-1"><a href="ulysses-compass.html#cb637-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">0.2</span>,<span class="fl">0.25</span>,<span class="fl">0.25</span>,<span class="fl">0.3</span>)</span>
<span id="cb637-2"><a href="ulysses-compass.html#cb637-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb637-3"><a href="ulysses-compass.html#cb637-3" aria-hidden="true" tabindex="-1"></a>ent <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb637-4"><a href="ulysses-compass.html#cb637-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb637-5"><a href="ulysses-compass.html#cb637-5" aria-hidden="true" tabindex="-1"></a>ent <span class="ot">&lt;-</span>  <span class="fu">tibble</span>(<span class="at">p =</span> x) <span class="sc">%&gt;%</span> </span>
<span id="cb637-6"><a href="ulysses-compass.html#cb637-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">plog =</span> p<span class="sc">*</span><span class="fu">log</span>(p)) <span class="sc">%&gt;%</span> </span>
<span id="cb637-7"><a href="ulysses-compass.html#cb637-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">entropy =</span> <span class="sc">-</span><span class="fu">sum</span>(plog))</span>
<span id="cb637-8"><a href="ulysses-compass.html#cb637-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb637-9"><a href="ulysses-compass.html#cb637-9" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(ent)</span>
<span id="cb637-10"><a href="ulysses-compass.html#cb637-10" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb637-11"><a href="ulysses-compass.html#cb637-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb637-12"><a href="ulysses-compass.html#cb637-12" aria-hidden="true" tabindex="-1"></a><span class="fu">ent</span>(x)  </span></code></pre></div>
<pre><code>## # A tibble: 1 × 1
##   entropy
##     &lt;dbl&gt;
## 1    1.38</code></pre>
</div>
<div id="e4" class="section level3 hasAnchor" number="7.6.3">
<h3><span class="header-section-number">7.6.3</span> 7E4<a href="ulysses-compass.html#e4" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<blockquote>
<p>Suppose another four-sided die is loaded such that it never shows “4.” The other three sides show equally often. What is the entropy of this die?</p>
</blockquote>
<div class="sourceCode" id="cb639"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb639-1"><a href="ulysses-compass.html#cb639-1" aria-hidden="true" tabindex="-1"></a><span class="co">#4 </span></span>
<span id="cb639-2"><a href="ulysses-compass.html#cb639-2" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">3</span>,<span class="dv">1</span><span class="sc">/</span><span class="dv">3</span>,<span class="dv">1</span><span class="sc">/</span><span class="dv">3</span>)</span>
<span id="cb639-3"><a href="ulysses-compass.html#cb639-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ent</span>(x)</span></code></pre></div>
<pre><code>## # A tibble: 1 × 1
##   entropy
##     &lt;dbl&gt;
## 1    1.10</code></pre>
<p><br /></p>
</div>
<div id="m4-4" class="section level3 hasAnchor" number="7.6.4">
<h3><span class="header-section-number">7.6.4</span> 7M4<a href="ulysses-compass.html#m4-4" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<blockquote>
<p>What happens to the effective number of parameters, as measured by PSIS or WAIC, as a prior becomes more concentrated? Why? Perform some experiments, if you are not sure.</p>
</blockquote>
<p>事前分布が狭いほど事後分布の対数尤度のばらつきも小さくなるので、WAICもPSISも小さくなる。</p>
<div class="sourceCode" id="cb641"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb641-1"><a href="ulysses-compass.html#cb641-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">2000</span>)</span>
<span id="cb641-2"><a href="ulysses-compass.html#cb641-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(glue)</span>
<span id="cb641-3"><a href="ulysses-compass.html#cb641-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb641-4"><a href="ulysses-compass.html#cb641-4" aria-hidden="true" tabindex="-1"></a><span class="co">#prior_sim &lt;- tibble(prior_sd=rep(c(0.1,1,10),each=50)) %&gt;% </span></span>
<span id="cb641-5"><a href="ulysses-compass.html#cb641-5" aria-hidden="true" tabindex="-1"></a>  <span class="co">#mutate(sample = purrr::map(1:n(),</span></span>
<span id="cb641-6"><a href="ulysses-compass.html#cb641-6" aria-hidden="true" tabindex="-1"></a>                      <span class="co">#function(x){</span></span>
<span id="cb641-7"><a href="ulysses-compass.html#cb641-7" aria-hidden="true" tabindex="-1"></a>                        <span class="co">#n &lt;- 20</span></span>
<span id="cb641-8"><a href="ulysses-compass.html#cb641-8" aria-hidden="true" tabindex="-1"></a>                        <span class="co">#tibble(x1 = rnorm(n = n),</span></span>
<span id="cb641-9"><a href="ulysses-compass.html#cb641-9" aria-hidden="true" tabindex="-1"></a>                               <span class="co">#x2 = rnorm(n = n),</span></span>
<span id="cb641-10"><a href="ulysses-compass.html#cb641-10" aria-hidden="true" tabindex="-1"></a>                               <span class="co">#x3 = rnorm(n = n)) %&gt;%                     mutate(y = rnorm(n = n, mean =0.3 + </span></span>
<span id="cb641-11"><a href="ulysses-compass.html#cb641-11" aria-hidden="true" tabindex="-1"></a>                    <span class="co">#0.8 * x1 + 0.6 * x2 + 1.2 * x3),</span></span>
<span id="cb641-12"><a href="ulysses-compass.html#cb641-12" aria-hidden="true" tabindex="-1"></a>                  <span class="co">#across(everything(), standardize))</span></span>
<span id="cb641-13"><a href="ulysses-compass.html#cb641-13" aria-hidden="true" tabindex="-1"></a>                      <span class="co">#}),</span></span>
<span id="cb641-14"><a href="ulysses-compass.html#cb641-14" aria-hidden="true" tabindex="-1"></a>         <span class="co">#model = purrr::map2(sample,prior_sd,</span></span>
<span id="cb641-15"><a href="ulysses-compass.html#cb641-15" aria-hidden="true" tabindex="-1"></a>                      <span class="co">#function(df, p_sd){</span></span>
<span id="cb641-16"><a href="ulysses-compass.html#cb641-16" aria-hidden="true" tabindex="-1"></a>                        <span class="co">#mod &lt;- brm(y ~ 1+x1+x2+x3,</span></span>
<span id="cb641-17"><a href="ulysses-compass.html#cb641-17" aria-hidden="true" tabindex="-1"></a>                                   <span class="co">#data=df,</span></span>
<span id="cb641-18"><a href="ulysses-compass.html#cb641-18" aria-hidden="true" tabindex="-1"></a>                                   <span class="co">#family=gaussian,</span></span>
<span id="cb641-19"><a href="ulysses-compass.html#cb641-19" aria-hidden="true" tabindex="-1"></a>  <span class="co">#prior = c(prior(normal(0, 0.2), class = Intercept),</span></span>
<span id="cb641-20"><a href="ulysses-compass.html#cb641-20" aria-hidden="true" tabindex="-1"></a><span class="co">#prior_string(glue(&quot;normal(0, {p_sd})&quot;), class = &quot;b&quot;),</span></span>
<span id="cb641-21"><a href="ulysses-compass.html#cb641-21" aria-hidden="true" tabindex="-1"></a>              <span class="co">#prior(exponential(1), class = sigma)),</span></span>
<span id="cb641-22"><a href="ulysses-compass.html#cb641-22" aria-hidden="true" tabindex="-1"></a>                  <span class="co">#iter=4000,warmup=3000,seed=1234)</span></span>
<span id="cb641-23"><a href="ulysses-compass.html#cb641-23" aria-hidden="true" tabindex="-1"></a>                        <span class="co">#return(mod)</span></span>
<span id="cb641-24"><a href="ulysses-compass.html#cb641-24" aria-hidden="true" tabindex="-1"></a>                      <span class="co">#}))</span></span>
<span id="cb641-25"><a href="ulysses-compass.html#cb641-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb641-26"><a href="ulysses-compass.html#cb641-26" aria-hidden="true" tabindex="-1"></a><span class="co">#prior_sim %&gt;% </span></span>
<span id="cb641-27"><a href="ulysses-compass.html#cb641-27" aria-hidden="true" tabindex="-1"></a> <span class="co">#mutate(infc = purrr::map(model, </span></span>
<span id="cb641-28"><a href="ulysses-compass.html#cb641-28" aria-hidden="true" tabindex="-1"></a>  <span class="co">#         function(mod){</span></span>
<span id="cb641-29"><a href="ulysses-compass.html#cb641-29" aria-hidden="true" tabindex="-1"></a>   <span class="co">#          w &lt;- suppressWarnings(brms::waic(mod))</span></span>
<span id="cb641-30"><a href="ulysses-compass.html#cb641-30" aria-hidden="true" tabindex="-1"></a>    <span class="co">#         p &lt;- suppressWarnings(brms::loo(mod))</span></span>
<span id="cb641-31"><a href="ulysses-compass.html#cb641-31" aria-hidden="true" tabindex="-1"></a>    <span class="co">#tibble(p_waic = w$estimates[&quot;p_waic&quot;, &quot;Estimate&quot;],</span></span>
<span id="cb641-32"><a href="ulysses-compass.html#cb641-32" aria-hidden="true" tabindex="-1"></a>     <span class="co">#       p_loo = p$estimates[&quot;p_loo&quot;, &quot;Estimate&quot;])</span></span>
<span id="cb641-33"><a href="ulysses-compass.html#cb641-33" aria-hidden="true" tabindex="-1"></a>      <span class="co">#        })) %&gt;%</span></span>
<span id="cb641-34"><a href="ulysses-compass.html#cb641-34" aria-hidden="true" tabindex="-1"></a>  <span class="co">#unnest(infc) -&gt; prior_sim</span></span>
<span id="cb641-35"><a href="ulysses-compass.html#cb641-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb641-36"><a href="ulysses-compass.html#cb641-36" aria-hidden="true" tabindex="-1"></a>prior_sim <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;output/Chapter7/prior_sim.rds&quot;</span>)</span>
<span id="cb641-37"><a href="ulysses-compass.html#cb641-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb641-38"><a href="ulysses-compass.html#cb641-38" aria-hidden="true" tabindex="-1"></a>prior_sim <span class="sc">%&gt;%</span></span>
<span id="cb641-39"><a href="ulysses-compass.html#cb641-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">c</span>(p_waic, p_loo)) <span class="sc">%&gt;%</span></span>
<span id="cb641-40"><a href="ulysses-compass.html#cb641-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prior_sd =</span> <span class="fu">glue</span>(<span class="st">&quot;sd~&#39;=&#39;~{prior_sd}&quot;</span>),</span>
<span id="cb641-41"><a href="ulysses-compass.html#cb641-41" aria-hidden="true" tabindex="-1"></a>         <span class="at">prior_sd =</span> <span class="fu">fct_inorder</span>(prior_sd),</span>
<span id="cb641-42"><a href="ulysses-compass.html#cb641-42" aria-hidden="true" tabindex="-1"></a>         <span class="at">name =</span> <span class="fu">factor</span>(name, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&quot;p_waic&quot;</span>, <span class="st">&quot;p_loo&quot;</span>),</span>
<span id="cb641-43"><a href="ulysses-compass.html#cb641-43" aria-hidden="true" tabindex="-1"></a>                       <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;p[WAIC]&quot;</span>, <span class="st">&quot;p[PSIS]&quot;</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb641-44"><a href="ulysses-compass.html#cb641-44" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> value)) <span class="sc">+</span></span>
<span id="cb641-45"><a href="ulysses-compass.html#cb641-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(<span class="at">rows =</span> <span class="fu">vars</span>(prior_sd), <span class="at">cols =</span> <span class="fu">vars</span>(name),</span>
<span id="cb641-46"><a href="ulysses-compass.html#cb641-46" aria-hidden="true" tabindex="-1"></a>             <span class="at">labeller =</span> label_parsed) <span class="sc">+</span></span>
<span id="cb641-47"><a href="ulysses-compass.html#cb641-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(<span class="at">y =</span> <span class="fu">after_stat</span>(density)), <span class="at">binwidth =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb641-48"><a href="ulysses-compass.html#cb641-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Value&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Density&quot;</span>) <span class="sc">+</span></span>
<span id="cb641-49"><a href="ulysses-compass.html#cb641-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.border =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="cn">NA</span>))</span></code></pre></div>
<p><img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-296-1.png" width="672" style="display: block; margin: auto;" />
<br /></p>
</div>
<div id="h1-5" class="section level3 hasAnchor" number="7.6.5">
<h3><span class="header-section-number">7.6.5</span> 7H1<a href="ulysses-compass.html#h1-5" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<blockquote>
<p>In 2007, The Wall Street Journal published an editorial (“We’re Number One, Alas”) with a graph of corportate tax rates in 29 countries plotted against tax revenue. A badly fit curve was drawn in (reconstructed at right), seemingly by hand, to make the argument that the relationship between tax rate and tax revenue increases and then declines, such that higher tax rates can actually produce less tax revenue. I want you to actually fit a curve to these data, found in <code>data(Laffer)</code>. Consider models that use tax rate to predict tax revenue. Compare, using WAIC or PSIS, a straight-line model to any curved models you like. What do you conclude about the relationship between tax rate and tax revenue.</p>
</blockquote>
<div class="sourceCode" id="cb642"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb642-1"><a href="ulysses-compass.html#cb642-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(Laffer)</span>
<span id="cb642-2"><a href="ulysses-compass.html#cb642-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb642-3"><a href="ulysses-compass.html#cb642-3" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> Laffer <span class="sc">%&gt;%</span> </span>
<span id="cb642-4"><a href="ulysses-compass.html#cb642-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">tax_rate2 =</span> tax_rate<span class="sc">^</span><span class="dv">2</span>,</span>
<span id="cb642-5"><a href="ulysses-compass.html#cb642-5" aria-hidden="true" tabindex="-1"></a>         <span class="fu">across</span>(<span class="fu">everything</span>(),standardize))</span>
<span id="cb642-6"><a href="ulysses-compass.html#cb642-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb642-7"><a href="ulysses-compass.html#cb642-7" aria-hidden="true" tabindex="-1"></a>Laffer <span class="sc">%&gt;%</span> </span>
<span id="cb642-8"><a href="ulysses-compass.html#cb642-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>tax_rate,<span class="at">y=</span>tax_revenue))<span class="sc">+</span></span>
<span id="cb642-9"><a href="ulysses-compass.html#cb642-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size=</span><span class="dv">3</span>,<span class="at">shape=</span><span class="dv">21</span>,<span class="at">color=</span><span class="st">&quot;navy&quot;</span>)<span class="sc">+</span></span>
<span id="cb642-10"><a href="ulysses-compass.html#cb642-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()<span class="sc">+</span></span>
<span id="cb642-11"><a href="ulysses-compass.html#cb642-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">aspect.ratio=</span><span class="dv">1</span>)</span></code></pre></div>
<p><img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-297-1.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb643"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb643-1"><a href="ulysses-compass.html#cb643-1" aria-hidden="true" tabindex="-1"></a>laf_line <span class="ot">&lt;-</span> </span>
<span id="cb643-2"><a href="ulysses-compass.html#cb643-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">brm</span>(<span class="at">data =</span> d,</span>
<span id="cb643-3"><a href="ulysses-compass.html#cb643-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> gaussian,</span>
<span id="cb643-4"><a href="ulysses-compass.html#cb643-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">formula =</span> tax_revenue <span class="sc">~</span> tax_rate,</span>
<span id="cb643-5"><a href="ulysses-compass.html#cb643-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>,<span class="fl">0.2</span>),<span class="at">class =</span> Intercept),</span>
<span id="cb643-6"><a href="ulysses-compass.html#cb643-6" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">0.5</span>), <span class="at">class =</span> b),</span>
<span id="cb643-7"><a href="ulysses-compass.html#cb643-7" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>), <span class="at">class =</span> sigma)),</span>
<span id="cb643-8"><a href="ulysses-compass.html#cb643-8" aria-hidden="true" tabindex="-1"></a>                <span class="at">iter =</span> <span class="dv">4000</span>, <span class="at">warmup =</span> <span class="dv">2000</span>,<span class="at">seed =</span> <span class="dv">1234</span>,</span>
<span id="cb643-9"><a href="ulysses-compass.html#cb643-9" aria-hidden="true" tabindex="-1"></a>                <span class="at">backend =</span> <span class="st">&quot;cmdstanr&quot;</span>,</span>
<span id="cb643-10"><a href="ulysses-compass.html#cb643-10" aria-hidden="true" tabindex="-1"></a>                <span class="at">file =</span> <span class="st">&quot;output/Chapter7/laf_line&quot;</span>)</span>
<span id="cb643-11"><a href="ulysses-compass.html#cb643-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb643-12"><a href="ulysses-compass.html#cb643-12" aria-hidden="true" tabindex="-1"></a>laf_curve <span class="ot">&lt;-</span> </span>
<span id="cb643-13"><a href="ulysses-compass.html#cb643-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">brm</span>(<span class="at">data =</span> d,</span>
<span id="cb643-14"><a href="ulysses-compass.html#cb643-14" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> gaussian,</span>
<span id="cb643-15"><a href="ulysses-compass.html#cb643-15" aria-hidden="true" tabindex="-1"></a>      <span class="at">formula =</span> tax_revenue <span class="sc">~</span> <span class="dv">1</span><span class="sc">+</span>tax_rate <span class="sc">+</span> tax_rate2,</span>
<span id="cb643-16"><a href="ulysses-compass.html#cb643-16" aria-hidden="true" tabindex="-1"></a>      <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>,<span class="fl">0.2</span>),<span class="at">class =</span> Intercept),</span>
<span id="cb643-17"><a href="ulysses-compass.html#cb643-17" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">0.5</span>), <span class="at">class =</span> b),</span>
<span id="cb643-18"><a href="ulysses-compass.html#cb643-18" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>), <span class="at">class =</span> sigma)),</span>
<span id="cb643-19"><a href="ulysses-compass.html#cb643-19" aria-hidden="true" tabindex="-1"></a>                <span class="at">iter =</span> <span class="dv">4000</span>, <span class="at">warmup =</span> <span class="dv">2000</span>,<span class="at">seed =</span> <span class="dv">1234</span>,</span>
<span id="cb643-20"><a href="ulysses-compass.html#cb643-20" aria-hidden="true" tabindex="-1"></a>                <span class="at">backend =</span> <span class="st">&quot;cmdstanr&quot;</span>,</span>
<span id="cb643-21"><a href="ulysses-compass.html#cb643-21" aria-hidden="true" tabindex="-1"></a>                <span class="at">file =</span> <span class="st">&quot;output/Chapter7/laf_curve&quot;</span>)</span>
<span id="cb643-22"><a href="ulysses-compass.html#cb643-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb643-23"><a href="ulysses-compass.html#cb643-23" aria-hidden="true" tabindex="-1"></a>laf_spline <span class="ot">&lt;-</span> </span>
<span id="cb643-24"><a href="ulysses-compass.html#cb643-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">brm</span>(<span class="at">data =</span> d,</span>
<span id="cb643-25"><a href="ulysses-compass.html#cb643-25" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> gaussian,</span>
<span id="cb643-26"><a href="ulysses-compass.html#cb643-26" aria-hidden="true" tabindex="-1"></a>      <span class="at">formula =</span> tax_revenue <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> <span class="fu">s</span>(tax_rate),</span>
<span id="cb643-27"><a href="ulysses-compass.html#cb643-27" aria-hidden="true" tabindex="-1"></a>      <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>,<span class="fl">0.2</span>),<span class="at">class =</span> Intercept),</span>
<span id="cb643-28"><a href="ulysses-compass.html#cb643-28" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">0.5</span>), <span class="at">class =</span> b),</span>
<span id="cb643-29"><a href="ulysses-compass.html#cb643-29" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>), <span class="at">class =</span> sigma)),</span>
<span id="cb643-30"><a href="ulysses-compass.html#cb643-30" aria-hidden="true" tabindex="-1"></a>              <span class="at">iter =</span> <span class="dv">10000</span>, <span class="at">warmup =</span><span class="dv">6000</span>,<span class="at">seed =</span> <span class="dv">1234</span>,</span>
<span id="cb643-31"><a href="ulysses-compass.html#cb643-31" aria-hidden="true" tabindex="-1"></a>              <span class="at">thin =</span> <span class="dv">2</span>,</span>
<span id="cb643-32"><a href="ulysses-compass.html#cb643-32" aria-hidden="true" tabindex="-1"></a>      　　　　　　　<span class="at">backend =</span> <span class="st">&quot;cmdstanr&quot;</span>,</span>
<span id="cb643-33"><a href="ulysses-compass.html#cb643-33" aria-hidden="true" tabindex="-1"></a>                <span class="at">file =</span> <span class="st">&quot;output/Chapter7/laf_spline&quot;</span>)</span>
<span id="cb643-34"><a href="ulysses-compass.html#cb643-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb643-35"><a href="ulysses-compass.html#cb643-35" aria-hidden="true" tabindex="-1"></a><span class="fu">conditional_effects</span>(laf_line, <span class="at">method =</span> <span class="st">&quot;fitted&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb643-36"><a href="ulysses-compass.html#cb643-36" aria-hidden="true" tabindex="-1"></a>    <span class="fu">plot</span>(<span class="at">points =</span> <span class="cn">TRUE</span>,<span class="at">theme =</span><span class="fu">theme</span>(<span class="at">aspect.ratio=</span><span class="dv">1</span>)) <span class="ot">-&gt;</span></span>
<span id="cb643-37"><a href="ulysses-compass.html#cb643-37" aria-hidden="true" tabindex="-1"></a>  p_line</span></code></pre></div>
<p><img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-297-2.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb644"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb644-1"><a href="ulysses-compass.html#cb644-1" aria-hidden="true" tabindex="-1"></a><span class="fu">conditional_effects</span>(laf_curve, <span class="at">method =</span> <span class="st">&quot;fitted&quot;</span>,<span class="at">effects =</span> <span class="st">&quot;tax_rate&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb644-2"><a href="ulysses-compass.html#cb644-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>(<span class="at">points =</span> <span class="cn">TRUE</span>,<span class="at">theme =</span><span class="fu">theme</span>(<span class="at">aspect.ratio=</span><span class="dv">1</span>))<span class="ot">-&gt;</span></span>
<span id="cb644-3"><a href="ulysses-compass.html#cb644-3" aria-hidden="true" tabindex="-1"></a>  p_curve</span></code></pre></div>
<p><img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-297-3.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb645"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb645-1"><a href="ulysses-compass.html#cb645-1" aria-hidden="true" tabindex="-1"></a><span class="fu">conditional_effects</span>(laf_spline, <span class="at">method =</span> <span class="st">&quot;fitted&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb645-2"><a href="ulysses-compass.html#cb645-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>(<span class="at">points =</span> <span class="cn">TRUE</span>,<span class="at">theme =</span><span class="fu">theme</span>(<span class="at">aspect.ratio=</span><span class="dv">1</span>))<span class="ot">-&gt;</span></span>
<span id="cb645-3"><a href="ulysses-compass.html#cb645-3" aria-hidden="true" tabindex="-1"></a>  p_spline</span></code></pre></div>
<p><img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-297-4.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb646"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb646-1"><a href="ulysses-compass.html#cb646-1" aria-hidden="true" tabindex="-1"></a>p_line<span class="sc">$</span>tax_rate <span class="sc">+</span> p_curve<span class="sc">$</span>tax_rate <span class="sc">+</span> p_spline<span class="sc">$</span>tax_rate</span></code></pre></div>
<p><img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-297-5.png" width="672" style="display: block; margin: auto;" />
<br /></p>
<p>WAICとPSISを計算してみると…。<br />
差はほとんどなく、どのモデルも大きな違いはない。</p>
<div class="sourceCode" id="cb647"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb647-1"><a href="ulysses-compass.html#cb647-1" aria-hidden="true" tabindex="-1"></a>laf_line <span class="ot">&lt;-</span> <span class="fu">add_criterion</span>(laf_line,</span>
<span id="cb647-2"><a href="ulysses-compass.html#cb647-2" aria-hidden="true" tabindex="-1"></a>                          <span class="at">criterion =</span> <span class="fu">c</span>(<span class="st">&quot;waic&quot;</span>,<span class="st">&quot;loo&quot;</span>))</span>
<span id="cb647-3"><a href="ulysses-compass.html#cb647-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb647-4"><a href="ulysses-compass.html#cb647-4" aria-hidden="true" tabindex="-1"></a>laf_curve <span class="ot">&lt;-</span> <span class="fu">add_criterion</span>(laf_curve,</span>
<span id="cb647-5"><a href="ulysses-compass.html#cb647-5" aria-hidden="true" tabindex="-1"></a>                          <span class="at">criterion =</span> <span class="fu">c</span>(<span class="st">&quot;waic&quot;</span>,<span class="st">&quot;loo&quot;</span>))</span>
<span id="cb647-6"><a href="ulysses-compass.html#cb647-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb647-7"><a href="ulysses-compass.html#cb647-7" aria-hidden="true" tabindex="-1"></a>laf_spline <span class="ot">&lt;-</span> <span class="fu">add_criterion</span>(laf_spline,</span>
<span id="cb647-8"><a href="ulysses-compass.html#cb647-8" aria-hidden="true" tabindex="-1"></a>                          <span class="at">criterion =</span> <span class="fu">c</span>(<span class="st">&quot;waic&quot;</span>,<span class="st">&quot;loo&quot;</span>))</span>
<span id="cb647-9"><a href="ulysses-compass.html#cb647-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb647-10"><a href="ulysses-compass.html#cb647-10" aria-hidden="true" tabindex="-1"></a><span class="co">#waic</span></span>
<span id="cb647-11"><a href="ulysses-compass.html#cb647-11" aria-hidden="true" tabindex="-1"></a><span class="fu">loo_compare</span>(laf_line, laf_curve, laf_spline, <span class="at">criterion =</span> <span class="st">&quot;waic&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb647-12"><a href="ulysses-compass.html#cb647-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="at">simplify=</span>F)</span></code></pre></div>
<pre><code>##            elpd_diff se_diff elpd_waic se_elpd_waic p_waic se_p_waic waic 
## laf_spline   0.0       0.0   -42.2       9.1          5.3    3.6      84.4
## laf_line    -1.0       0.8   -43.2       9.3          4.6    3.4      86.3
## laf_curve   -1.1       0.8   -43.3       9.4          4.9    3.6      86.6
##            se_waic
## laf_spline  18.2  
## laf_line    18.5  
## laf_curve   18.9</code></pre>
<div class="sourceCode" id="cb649"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb649-1"><a href="ulysses-compass.html#cb649-1" aria-hidden="true" tabindex="-1"></a><span class="co">#loo</span></span>
<span id="cb649-2"><a href="ulysses-compass.html#cb649-2" aria-hidden="true" tabindex="-1"></a><span class="fu">loo_compare</span>(laf_line, laf_curve, laf_spline, <span class="at">criterion =</span> <span class="st">&quot;loo&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb649-3"><a href="ulysses-compass.html#cb649-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="at">simplify=</span>F)</span></code></pre></div>
<pre><code>##            elpd_diff se_diff elpd_loo se_elpd_loo p_loo se_p_loo looic se_looic
## laf_spline   0.0       0.0   -42.6      9.4         5.7   3.9     85.2  18.9   
## laf_line    -1.0       0.8   -43.6      9.6         5.0   3.8     87.2  19.3   
## laf_curve   -2.0       1.4   -44.6     10.7         6.2   4.8     89.1  21.3</code></pre>
<p><br/></p>
</div>
<div id="h2-5" class="section level3 hasAnchor" number="7.6.6">
<h3><span class="header-section-number">7.6.6</span> 7H2<a href="ulysses-compass.html#h2-5" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<blockquote>
<p>In the <code>Laffer</code> data, there is one country with a high tax revenue that is an outlier. Use PSIS and WAIC to measure the importance of this outlier in the models you fit in the previous problem. Then use robust regression with a Student’s t distribution to revist the curve fitting problem. How much does a curved relationship depend upon the outlier point.</p>
</blockquote>
<p>一方で、pareto_kが0.7以上の点があり、外れ値があったことがうかがえる。</p>
<div class="sourceCode" id="cb651"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb651-1"><a href="ulysses-compass.html#cb651-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gghighlight)</span>
<span id="cb651-2"><a href="ulysses-compass.html#cb651-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb651-3"><a href="ulysses-compass.html#cb651-3" aria-hidden="true" tabindex="-1"></a>criteria_influence <span class="ot">&lt;-</span> <span class="cf">function</span>(mod) {</span>
<span id="cb651-4"><a href="ulysses-compass.html#cb651-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="at">pareto_k =</span> mod<span class="sc">$</span>criteria<span class="sc">$</span>loo<span class="sc">$</span>diagnostics<span class="sc">$</span>pareto_k,</span>
<span id="cb651-5"><a href="ulysses-compass.html#cb651-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">p_waic =</span> mod<span class="sc">$</span>criteria<span class="sc">$</span>waic<span class="sc">$</span>pointwise[, <span class="st">&quot;p_waic&quot;</span>]) <span class="sc">%&gt;%</span></span>
<span id="cb651-6"><a href="ulysses-compass.html#cb651-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rowid_to_column</span>(<span class="at">var =</span> <span class="st">&quot;obs&quot;</span>)</span>
<span id="cb651-7"><a href="ulysses-compass.html#cb651-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb651-8"><a href="ulysses-compass.html#cb651-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb651-9"><a href="ulysses-compass.html#cb651-9" aria-hidden="true" tabindex="-1"></a>influ <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(</span>
<span id="cb651-10"><a href="ulysses-compass.html#cb651-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">criteria_influence</span>(laf_line) <span class="sc">%&gt;%</span></span>
<span id="cb651-11"><a href="ulysses-compass.html#cb651-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">type =</span> <span class="st">&quot;Linear&quot;</span>),</span>
<span id="cb651-12"><a href="ulysses-compass.html#cb651-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">criteria_influence</span>(laf_curve) <span class="sc">%&gt;%</span></span>
<span id="cb651-13"><a href="ulysses-compass.html#cb651-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">type =</span> <span class="st">&quot;Curve&quot;</span>),</span>
<span id="cb651-14"><a href="ulysses-compass.html#cb651-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">criteria_influence</span>(laf_spline) <span class="sc">%&gt;%</span></span>
<span id="cb651-15"><a href="ulysses-compass.html#cb651-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">type =</span> <span class="st">&quot;Spline&quot;</span>)</span>
<span id="cb651-16"><a href="ulysses-compass.html#cb651-16" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb651-17"><a href="ulysses-compass.html#cb651-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb651-18"><a href="ulysses-compass.html#cb651-18" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(influ, <span class="fu">aes</span>(<span class="at">x =</span> pareto_k, <span class="at">y =</span> p_waic)) <span class="sc">+</span></span>
<span id="cb651-19"><a href="ulysses-compass.html#cb651-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>type, <span class="at">ncol =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb651-20"><a href="ulysses-compass.html#cb651-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fl">0.7</span>, <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>) <span class="sc">+</span></span>
<span id="cb651-21"><a href="ulysses-compass.html#cb651-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="fl">0.4</span>, <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>) <span class="sc">+</span></span>
<span id="cb651-22"><a href="ulysses-compass.html#cb651-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb651-23"><a href="ulysses-compass.html#cb651-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gghighlight</span>(pareto_k <span class="sc">&gt;</span> <span class="fl">0.7</span> <span class="sc">|</span> p_waic <span class="sc">&gt;</span> <span class="fl">0.4</span>, <span class="at">n =</span> <span class="dv">1</span>, <span class="at">label_key =</span> obs,</span>
<span id="cb651-24"><a href="ulysses-compass.html#cb651-24" aria-hidden="true" tabindex="-1"></a>              <span class="at">label_params =</span> <span class="fu">list</span>(<span class="at">size =</span> <span class="dv">3</span>)) <span class="sc">+</span></span>
<span id="cb651-25"><a href="ulysses-compass.html#cb651-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="fu">expression</span>(Pareto<span class="sc">~</span><span class="fu">italic</span>(k)), <span class="at">y =</span> <span class="fu">expression</span>(p[WAIC])) <span class="sc">+</span></span>
<span id="cb651-26"><a href="ulysses-compass.html#cb651-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.border =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="cn">NA</span>))</span></code></pre></div>
<p><img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-299-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>Student_tでより頑強なモデルをフィットさせる。</p>
<div class="sourceCode" id="cb652"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb652-1"><a href="ulysses-compass.html#cb652-1" aria-hidden="true" tabindex="-1"></a>laf_line_st <span class="ot">&lt;-</span> </span>
<span id="cb652-2"><a href="ulysses-compass.html#cb652-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">brm</span>(<span class="at">data =</span> d,</span>
<span id="cb652-3"><a href="ulysses-compass.html#cb652-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> student,</span>
<span id="cb652-4"><a href="ulysses-compass.html#cb652-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">formula =</span> <span class="fu">bf</span>(tax_revenue <span class="sc">~</span> tax_rate,<span class="at">nu=</span><span class="dv">2</span>),</span>
<span id="cb652-5"><a href="ulysses-compass.html#cb652-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>,<span class="fl">0.2</span>),<span class="at">class =</span> Intercept),</span>
<span id="cb652-6"><a href="ulysses-compass.html#cb652-6" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">0.5</span>), <span class="at">class =</span> b),</span>
<span id="cb652-7"><a href="ulysses-compass.html#cb652-7" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>), <span class="at">class =</span> sigma)),</span>
<span id="cb652-8"><a href="ulysses-compass.html#cb652-8" aria-hidden="true" tabindex="-1"></a>                <span class="at">iter =</span> <span class="dv">4000</span>, <span class="at">warmup =</span> <span class="dv">2000</span>,<span class="at">seed =</span> <span class="dv">1234</span>,</span>
<span id="cb652-9"><a href="ulysses-compass.html#cb652-9" aria-hidden="true" tabindex="-1"></a>      　　　　　<span class="at">backend =</span> <span class="st">&quot;cmdstanr&quot;</span>,</span>
<span id="cb652-10"><a href="ulysses-compass.html#cb652-10" aria-hidden="true" tabindex="-1"></a>                <span class="at">file =</span> <span class="st">&quot;output/Chapter7/laf_line_st&quot;</span>)</span>
<span id="cb652-11"><a href="ulysses-compass.html#cb652-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb652-12"><a href="ulysses-compass.html#cb652-12" aria-hidden="true" tabindex="-1"></a>laf_curve_st <span class="ot">&lt;-</span> </span>
<span id="cb652-13"><a href="ulysses-compass.html#cb652-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">brm</span>(<span class="at">data =</span> d,</span>
<span id="cb652-14"><a href="ulysses-compass.html#cb652-14" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> student,</span>
<span id="cb652-15"><a href="ulysses-compass.html#cb652-15" aria-hidden="true" tabindex="-1"></a>      <span class="at">formula =</span> <span class="fu">bf</span>(tax_revenue <span class="sc">~</span> <span class="dv">1</span><span class="sc">+</span>tax_rate <span class="sc">+</span> tax_rate2,<span class="at">nu=</span><span class="dv">2</span>),</span>
<span id="cb652-16"><a href="ulysses-compass.html#cb652-16" aria-hidden="true" tabindex="-1"></a>      <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>,<span class="fl">0.2</span>),<span class="at">class =</span> Intercept),</span>
<span id="cb652-17"><a href="ulysses-compass.html#cb652-17" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">0.5</span>), <span class="at">class =</span> b),</span>
<span id="cb652-18"><a href="ulysses-compass.html#cb652-18" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>), <span class="at">class =</span> sigma)),</span>
<span id="cb652-19"><a href="ulysses-compass.html#cb652-19" aria-hidden="true" tabindex="-1"></a>                <span class="at">iter =</span> <span class="dv">4000</span>, <span class="at">warmup =</span> <span class="dv">2000</span>,<span class="at">seed =</span> <span class="dv">1234</span>,</span>
<span id="cb652-20"><a href="ulysses-compass.html#cb652-20" aria-hidden="true" tabindex="-1"></a>      　　　　　<span class="at">backend =</span> <span class="st">&quot;cmdstanr&quot;</span>,</span>
<span id="cb652-21"><a href="ulysses-compass.html#cb652-21" aria-hidden="true" tabindex="-1"></a>                <span class="at">file =</span> <span class="st">&quot;output/Chapter7/laf_curve_st&quot;</span>)</span>
<span id="cb652-22"><a href="ulysses-compass.html#cb652-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb652-23"><a href="ulysses-compass.html#cb652-23" aria-hidden="true" tabindex="-1"></a>laf_spline_st <span class="ot">&lt;-</span> </span>
<span id="cb652-24"><a href="ulysses-compass.html#cb652-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">brm</span>(<span class="at">data =</span> d,</span>
<span id="cb652-25"><a href="ulysses-compass.html#cb652-25" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> student,</span>
<span id="cb652-26"><a href="ulysses-compass.html#cb652-26" aria-hidden="true" tabindex="-1"></a>      <span class="at">formula =</span> <span class="fu">bf</span>(tax_revenue <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> <span class="fu">s</span>(tax_rate),<span class="at">nu=</span><span class="dv">2</span>),</span>
<span id="cb652-27"><a href="ulysses-compass.html#cb652-27" aria-hidden="true" tabindex="-1"></a>      <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>,<span class="fl">0.2</span>),<span class="at">class =</span> Intercept),</span>
<span id="cb652-28"><a href="ulysses-compass.html#cb652-28" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">0.5</span>), <span class="at">class =</span> b),</span>
<span id="cb652-29"><a href="ulysses-compass.html#cb652-29" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>), <span class="at">class =</span> sigma)),</span>
<span id="cb652-30"><a href="ulysses-compass.html#cb652-30" aria-hidden="true" tabindex="-1"></a>              <span class="at">iter =</span> <span class="dv">50000</span>, <span class="at">warmup =</span><span class="dv">40000</span>,<span class="at">seed =</span> <span class="dv">1234</span>,</span>
<span id="cb652-31"><a href="ulysses-compass.html#cb652-31" aria-hidden="true" tabindex="-1"></a>              <span class="at">thin =</span> <span class="dv">5</span>,</span>
<span id="cb652-32"><a href="ulysses-compass.html#cb652-32" aria-hidden="true" tabindex="-1"></a>      　　　　<span class="at">backend =</span> <span class="st">&quot;cmdstanr&quot;</span>,</span>
<span id="cb652-33"><a href="ulysses-compass.html#cb652-33" aria-hidden="true" tabindex="-1"></a>                <span class="at">file =</span> <span class="st">&quot;output/Chapter7/laf_spline_st&quot;</span>)</span>
<span id="cb652-34"><a href="ulysses-compass.html#cb652-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb652-35"><a href="ulysses-compass.html#cb652-35" aria-hidden="true" tabindex="-1"></a><span class="fu">conditional_effects</span>(laf_line_st, <span class="at">method =</span> <span class="st">&quot;fitted&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb652-36"><a href="ulysses-compass.html#cb652-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>(<span class="at">points =</span> <span class="cn">TRUE</span>, <span class="at">theme=</span><span class="fu">theme</span>(<span class="at">aspect.ratio=</span><span class="dv">1</span>)) <span class="ot">-&gt;</span> pline_st</span></code></pre></div>
<p><img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-300-1.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb653"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb653-1"><a href="ulysses-compass.html#cb653-1" aria-hidden="true" tabindex="-1"></a><span class="fu">conditional_effects</span>(laf_curve_st, <span class="at">method =</span> <span class="st">&quot;fitted&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb653-2"><a href="ulysses-compass.html#cb653-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>(<span class="at">points =</span> <span class="cn">TRUE</span>) <span class="ot">-&gt;</span> pcurve_st</span></code></pre></div>
<p><img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-300-2.png" width="672" style="display: block; margin: auto;" /><img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-300-3.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb654"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb654-1"><a href="ulysses-compass.html#cb654-1" aria-hidden="true" tabindex="-1"></a><span class="fu">conditional_effects</span>(laf_spline_st, <span class="at">method =</span> <span class="st">&quot;fitted&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb654-2"><a href="ulysses-compass.html#cb654-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>(<span class="at">points =</span> <span class="cn">TRUE</span>) <span class="ot">-&gt;</span>pspline_st</span></code></pre></div>
<p><img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-300-4.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb655"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb655-1"><a href="ulysses-compass.html#cb655-1" aria-hidden="true" tabindex="-1"></a>pline_st<span class="sc">$</span>tax_rate<span class="sc">+</span>pcurve_st<span class="sc">$</span>tax_rate<span class="sc">+</span>pspline_st<span class="sc">$</span>tax_rate</span></code></pre></div>
<p><img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-300-5.png" width="672" style="display: block; margin: auto;" />
<br/></p>
<p>WAICとPSISを計算しても、エラーは出ない。
また、WAICとPSISの値もほぼ一致した。</p>
<div class="sourceCode" id="cb656"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb656-1"><a href="ulysses-compass.html#cb656-1" aria-hidden="true" tabindex="-1"></a>laf_line_st <span class="ot">&lt;-</span> <span class="fu">add_criterion</span>(laf_line_st,</span>
<span id="cb656-2"><a href="ulysses-compass.html#cb656-2" aria-hidden="true" tabindex="-1"></a>                          <span class="at">criterion =</span> <span class="fu">c</span>(<span class="st">&quot;waic&quot;</span>,<span class="st">&quot;loo&quot;</span>))</span>
<span id="cb656-3"><a href="ulysses-compass.html#cb656-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb656-4"><a href="ulysses-compass.html#cb656-4" aria-hidden="true" tabindex="-1"></a>laf_curve_st <span class="ot">&lt;-</span> <span class="fu">add_criterion</span>(laf_curve_st,</span>
<span id="cb656-5"><a href="ulysses-compass.html#cb656-5" aria-hidden="true" tabindex="-1"></a>                          <span class="at">criterion =</span> <span class="fu">c</span>(<span class="st">&quot;waic&quot;</span>,<span class="st">&quot;loo&quot;</span>))</span>
<span id="cb656-6"><a href="ulysses-compass.html#cb656-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb656-7"><a href="ulysses-compass.html#cb656-7" aria-hidden="true" tabindex="-1"></a>laf_spline_st <span class="ot">&lt;-</span> <span class="fu">add_criterion</span>(laf_spline_st,</span>
<span id="cb656-8"><a href="ulysses-compass.html#cb656-8" aria-hidden="true" tabindex="-1"></a>                          <span class="at">criterion =</span> <span class="fu">c</span>(<span class="st">&quot;waic&quot;</span>,<span class="st">&quot;loo&quot;</span>))</span>
<span id="cb656-9"><a href="ulysses-compass.html#cb656-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb656-10"><a href="ulysses-compass.html#cb656-10" aria-hidden="true" tabindex="-1"></a><span class="co">#waic</span></span>
<span id="cb656-11"><a href="ulysses-compass.html#cb656-11" aria-hidden="true" tabindex="-1"></a><span class="fu">loo_compare</span>(laf_line_st, laf_curve_st, laf_spline_st, <span class="at">criterion =</span> <span class="st">&quot;waic&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb656-12"><a href="ulysses-compass.html#cb656-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="at">simplify=</span>F)</span></code></pre></div>
<pre><code>##               elpd_diff se_diff elpd_waic se_elpd_waic p_waic se_p_waic waic 
## laf_spline_st   0.0       0.0   -35.9       6.3          5.0    1.0      71.7
## laf_curve_st   -0.6       0.8   -36.5       6.3          3.6    0.8      72.9
## laf_line_st    -0.9       1.1   -36.8       6.2          3.1    0.6      73.6
##               se_waic
## laf_spline_st  12.5  
## laf_curve_st   12.5  
## laf_line_st    12.5</code></pre>
<div class="sourceCode" id="cb658"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb658-1"><a href="ulysses-compass.html#cb658-1" aria-hidden="true" tabindex="-1"></a><span class="co">#loo</span></span>
<span id="cb658-2"><a href="ulysses-compass.html#cb658-2" aria-hidden="true" tabindex="-1"></a><span class="fu">loo_compare</span>(laf_line_st, laf_curve_st, laf_spline_st, <span class="at">criterion =</span> <span class="st">&quot;loo&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb658-3"><a href="ulysses-compass.html#cb658-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="at">simplify=</span>F)</span></code></pre></div>
<pre><code>##               elpd_diff se_diff elpd_loo se_elpd_loo p_loo se_p_loo looic
## laf_spline_st   0.0       0.0   -35.8      6.3         4.9   1.0     71.7
## laf_curve_st   -0.6       0.8   -36.4      6.3         3.6   0.8     72.8
## laf_line_st    -0.9       1.1   -36.8      6.2         3.1   0.6     73.6
##               se_looic
## laf_spline_st  12.5   
## laf_curve_st   12.5   
## laf_line_st    12.5</code></pre>
<p><br/></p>
<p>pwaicは高い点があるものの、かなり改善している。</p>
<div class="sourceCode" id="cb660"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb660-1"><a href="ulysses-compass.html#cb660-1" aria-hidden="true" tabindex="-1"></a>influ <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(</span>
<span id="cb660-2"><a href="ulysses-compass.html#cb660-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">criteria_influence</span>(laf_line_st) <span class="sc">%&gt;%</span></span>
<span id="cb660-3"><a href="ulysses-compass.html#cb660-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">type =</span> <span class="st">&quot;Linear&quot;</span>),</span>
<span id="cb660-4"><a href="ulysses-compass.html#cb660-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">criteria_influence</span>(laf_curve_st) <span class="sc">%&gt;%</span></span>
<span id="cb660-5"><a href="ulysses-compass.html#cb660-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">type =</span> <span class="st">&quot;Curve&quot;</span>),</span>
<span id="cb660-6"><a href="ulysses-compass.html#cb660-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">criteria_influence</span>(laf_spline_st) <span class="sc">%&gt;%</span></span>
<span id="cb660-7"><a href="ulysses-compass.html#cb660-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">type =</span> <span class="st">&quot;Spline&quot;</span>)</span>
<span id="cb660-8"><a href="ulysses-compass.html#cb660-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb660-9"><a href="ulysses-compass.html#cb660-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb660-10"><a href="ulysses-compass.html#cb660-10" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(influ, <span class="fu">aes</span>(<span class="at">x =</span> pareto_k, <span class="at">y =</span> p_waic)) <span class="sc">+</span></span>
<span id="cb660-11"><a href="ulysses-compass.html#cb660-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>type, <span class="at">ncol =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb660-12"><a href="ulysses-compass.html#cb660-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fl">0.7</span>, <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>) <span class="sc">+</span></span>
<span id="cb660-13"><a href="ulysses-compass.html#cb660-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="fl">0.4</span>, <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>) <span class="sc">+</span></span>
<span id="cb660-14"><a href="ulysses-compass.html#cb660-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb660-15"><a href="ulysses-compass.html#cb660-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gghighlight</span>(pareto_k <span class="sc">&gt;</span> <span class="fl">0.7</span> <span class="sc">|</span> p_waic <span class="sc">&gt;</span> <span class="fl">0.4</span>, <span class="at">n =</span> <span class="dv">1</span>, <span class="at">label_key =</span> obs,</span>
<span id="cb660-16"><a href="ulysses-compass.html#cb660-16" aria-hidden="true" tabindex="-1"></a>              <span class="at">label_params =</span> <span class="fu">list</span>(<span class="at">size =</span> <span class="dv">3</span>)) <span class="sc">+</span></span>
<span id="cb660-17"><a href="ulysses-compass.html#cb660-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="fu">expression</span>(Pareto<span class="sc">~</span><span class="fu">italic</span>(k)), <span class="at">y =</span> <span class="fu">expression</span>(p[WAIC])) <span class="sc">+</span></span>
<span id="cb660-18"><a href="ulysses-compass.html#cb660-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.border =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="cn">NA</span>))</span></code></pre></div>
<p><img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-302-1.png" width="672" style="display: block; margin: auto;" />
<br/></p>
</div>
<div id="h3-5" class="section level3 hasAnchor" number="7.6.7">
<h3><span class="header-section-number">7.6.7</span> 7H3<a href="ulysses-compass.html#h3-5" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<blockquote>
<p>Consider three fictional Polynesian islands. On each there is a Royal Ornithologist charged by the king with surveying the bird population. They have each found the following proportions of 5 important bird species:</p>
</blockquote>
<div class="sourceCode" id="cb661"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb661-1"><a href="ulysses-compass.html#cb661-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">island =</span> <span class="fu">paste</span>(<span class="st">&quot;Island&quot;</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>),</span>
<span id="cb661-2"><a href="ulysses-compass.html#cb661-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">speciesA =</span> <span class="fu">c</span>(<span class="fl">0.2</span>, <span class="fl">0.8</span>, <span class="fl">0.05</span>),</span>
<span id="cb661-3"><a href="ulysses-compass.html#cb661-3" aria-hidden="true" tabindex="-1"></a>       <span class="at">speciesB =</span> <span class="fu">c</span>(<span class="fl">0.2</span>, <span class="fl">0.1</span>, <span class="fl">0.15</span>),</span>
<span id="cb661-4"><a href="ulysses-compass.html#cb661-4" aria-hidden="true" tabindex="-1"></a>       <span class="at">speciesC =</span> <span class="fu">c</span>(<span class="fl">0.2</span>, <span class="fl">0.05</span>, <span class="fl">0.7</span>),</span>
<span id="cb661-5"><a href="ulysses-compass.html#cb661-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">speciesD =</span> <span class="fu">c</span>(<span class="fl">0.2</span>, <span class="fl">0.025</span>, <span class="fl">0.05</span>),</span>
<span id="cb661-6"><a href="ulysses-compass.html#cb661-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">speciesE =</span> <span class="fu">c</span>(<span class="fl">0.2</span>, <span class="fl">0.025</span>, <span class="fl">0.05</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb661-7"><a href="ulysses-compass.html#cb661-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">datatable</span>()</span></code></pre></div>
<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-64251d29c2b0c0a3dd01" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-64251d29c2b0c0a3dd01">{"x":{"filter":"none","vertical":false,"data":[["1","2","3"],["Island 1","Island 2","Island 3"],[0.2,0.8,0.05],[0.2,0.1,0.15],[0.2,0.05,0.7],[0.2,0.025,0.05],[0.2,0.025,0.05]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>island<\/th>\n      <th>speciesA<\/th>\n      <th>speciesB<\/th>\n      <th>speciesC<\/th>\n      <th>speciesD<\/th>\n      <th>speciesE<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[2,3,4,5,6]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false},"selection":{"mode":"multiple","selected":null,"target":"row","selectable":null}},"evals":[],"jsHooks":[]}</script>
<blockquote>
<p>Notice that each row sums to 1, all the birds. This problem has two parts. It is not computationally complicated. But it is conceptually tricky. First, compute the entropy of each island’s bird distribution. Interpret these entropy values. Second, use each island’s bird distribution to predict the other two. This means to compute the KL divergence of each island from the others, treating each island as if it were a statistical model of the other islands. You should end up with 6 different KL divergence values. Which island predicts the others best? Why?</p>
</blockquote>
<p>Island1ではもっともエントロピーが大きい。<br />
よって、Island1で他のデータを予測するときに最もKLdivergenceが小さくなる。</p>
<div class="sourceCode" id="cb662"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb662-1"><a href="ulysses-compass.html#cb662-1" aria-hidden="true" tabindex="-1"></a>islands <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">island =</span> <span class="fu">paste</span>(<span class="st">&quot;Island&quot;</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>),</span>
<span id="cb662-2"><a href="ulysses-compass.html#cb662-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">a =</span> <span class="fu">c</span>(<span class="fl">0.2</span>, <span class="fl">0.8</span>, <span class="fl">0.05</span>),</span>
<span id="cb662-3"><a href="ulysses-compass.html#cb662-3" aria-hidden="true" tabindex="-1"></a>       <span class="at">b =</span> <span class="fu">c</span>(<span class="fl">0.2</span>, <span class="fl">0.1</span>, <span class="fl">0.15</span>),</span>
<span id="cb662-4"><a href="ulysses-compass.html#cb662-4" aria-hidden="true" tabindex="-1"></a>       <span class="at">c =</span> <span class="fu">c</span>(<span class="fl">0.2</span>, <span class="fl">0.05</span>, <span class="fl">0.7</span>),</span>
<span id="cb662-5"><a href="ulysses-compass.html#cb662-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">d =</span> <span class="fu">c</span>(<span class="fl">0.2</span>, <span class="fl">0.025</span>, <span class="fl">0.05</span>),</span>
<span id="cb662-6"><a href="ulysses-compass.html#cb662-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">e =</span> <span class="fu">c</span>(<span class="fl">0.2</span>, <span class="fl">0.025</span>, <span class="fl">0.05</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb662-7"><a href="ulysses-compass.html#cb662-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span>island, <span class="at">names_to =</span> <span class="st">&quot;species&quot;</span>, <span class="at">values_to =</span> <span class="st">&quot;prop&quot;</span>)</span>
<span id="cb662-8"><a href="ulysses-compass.html#cb662-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb662-9"><a href="ulysses-compass.html#cb662-9" aria-hidden="true" tabindex="-1"></a>islands <span class="sc">%&gt;%</span> </span>
<span id="cb662-10"><a href="ulysses-compass.html#cb662-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(island) <span class="sc">%&gt;%</span> </span>
<span id="cb662-11"><a href="ulysses-compass.html#cb662-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">prop=</span><span class="fu">list</span>(prop),<span class="at">.groups=</span><span class="st">&quot;drop&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb662-12"><a href="ulysses-compass.html#cb662-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">entropy =</span> purrr<span class="sc">::</span><span class="fu">map</span>(prop,ent)) <span class="sc">%&gt;%</span> </span>
<span id="cb662-13"><a href="ulysses-compass.html#cb662-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(entropy) <span class="ot">-&gt;</span> islands</span></code></pre></div>
<pre><code>## # A tibble: 1 × 1
##   entropy
##     &lt;dbl&gt;
## 1    1.61
## # A tibble: 1 × 1
##   entropy
##     &lt;dbl&gt;
## 1   0.743
## # A tibble: 1 × 1
##   entropy
##     &lt;dbl&gt;
## 1   0.984</code></pre>
<div class="sourceCode" id="cb664"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb664-1"><a href="ulysses-compass.html#cb664-1" aria-hidden="true" tabindex="-1"></a>islands</span></code></pre></div>
<pre><code>## # A tibble: 3 × 3
##   island   prop      entropy
##   &lt;chr&gt;    &lt;list&gt;      &lt;dbl&gt;
## 1 Island 1 &lt;dbl [5]&gt;   1.61 
## 2 Island 2 &lt;dbl [5]&gt;   0.743
## 3 Island 3 &lt;dbl [5]&gt;   0.984</code></pre>
<div class="sourceCode" id="cb666"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb666-1"><a href="ulysses-compass.html#cb666-1" aria-hidden="true" tabindex="-1"></a><span class="do">##KL divergence</span></span>
<span id="cb666-2"><a href="ulysses-compass.html#cb666-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb666-3"><a href="ulysses-compass.html#cb666-3" aria-hidden="true" tabindex="-1"></a>d_KL <span class="ot">&lt;-</span> <span class="cf">function</span>(p,q){</span>
<span id="cb666-4"><a href="ulysses-compass.html#cb666-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sum</span>(p<span class="sc">*</span>(<span class="fu">log</span>(p)<span class="sc">-</span><span class="fu">log</span>(q)))</span>
<span id="cb666-5"><a href="ulysses-compass.html#cb666-5" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb666-6"><a href="ulysses-compass.html#cb666-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb666-7"><a href="ulysses-compass.html#cb666-7" aria-hidden="true" tabindex="-1"></a><span class="fu">crossing</span>(<span class="at">model =</span> <span class="fu">paste</span>(<span class="st">&quot;Island&quot;</span>,<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>),</span>
<span id="cb666-8"><a href="ulysses-compass.html#cb666-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">predicts =</span> <span class="fu">paste</span>(<span class="st">&quot;Island&quot;</span>,<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb666-9"><a href="ulysses-compass.html#cb666-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(model<span class="sc">!=</span>predicts) <span class="sc">%&gt;%</span> </span>
<span id="cb666-10"><a href="ulysses-compass.html#cb666-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(islands, <span class="at">by=</span><span class="fu">c</span>(<span class="st">&quot;model&quot;</span><span class="ot">=</span><span class="st">&quot;island&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb666-11"><a href="ulysses-compass.html#cb666-11" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>entropy) <span class="sc">%&gt;%</span> </span>
<span id="cb666-12"><a href="ulysses-compass.html#cb666-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">model_prop =</span> prop) <span class="sc">%&gt;%</span> </span>
<span id="cb666-13"><a href="ulysses-compass.html#cb666-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(islands, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;predicts&quot;</span><span class="ot">=</span><span class="st">&quot;island&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb666-14"><a href="ulysses-compass.html#cb666-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">predict_prop =</span> prop) <span class="sc">%&gt;%</span> </span>
<span id="cb666-15"><a href="ulysses-compass.html#cb666-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">d_KL =</span> <span class="fu">map2</span>(predict_prop, model_prop,d_KL)) <span class="sc">%&gt;%</span> </span>
<span id="cb666-16"><a href="ulysses-compass.html#cb666-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(d_KL)</span></code></pre></div>
<pre><code>## # A tibble: 6 × 6
##   model    predicts model_prop predict_prop entropy  d_KL
##   &lt;chr&gt;    &lt;chr&gt;    &lt;list&gt;     &lt;list&gt;         &lt;dbl&gt; &lt;dbl&gt;
## 1 Island 1 Island 2 &lt;dbl [5]&gt;  &lt;dbl [5]&gt;      0.743 0.866
## 2 Island 1 Island 3 &lt;dbl [5]&gt;  &lt;dbl [5]&gt;      0.984 0.626
## 3 Island 2 Island 1 &lt;dbl [5]&gt;  &lt;dbl [5]&gt;      1.61  0.970
## 4 Island 2 Island 3 &lt;dbl [5]&gt;  &lt;dbl [5]&gt;      0.984 1.84 
## 5 Island 3 Island 1 &lt;dbl [5]&gt;  &lt;dbl [5]&gt;      1.61  0.639
## 6 Island 3 Island 2 &lt;dbl [5]&gt;  &lt;dbl [5]&gt;      0.743 2.01</code></pre>
</div>
<div id="h4-5" class="section level3 hasAnchor" number="7.6.8">
<h3><span class="header-section-number">7.6.8</span> 7H4<a href="ulysses-compass.html#h4-5" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<blockquote>
<p>Recall the marriage, age, and happiness collider bias example from Chapter 6. Run models m6.9 and m6.10 again (page 178). Compare these two models using WAIC (or PSIS, they will produce identical results). Which model is expected to make better predictions? Which model provides the correct causal inference about the influence of age on happiness? Can you explain why the answers to these two questions disagree?</p>
</blockquote>
<p>Chapter6の結婚と年齢が幸福度に与える影響についてもモデルを再度考える。<br />
b6.4の方がWAICもPSISも小さいが、このモデルでは因果関係は推論できない。</p>
<div class="sourceCode" id="cb668"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb668-1"><a href="ulysses-compass.html#cb668-1" aria-hidden="true" tabindex="-1"></a>b6<span class="fl">.4</span> <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;output/Chapter6/b6.4.rds&quot;</span>)</span>
<span id="cb668-2"><a href="ulysses-compass.html#cb668-2" aria-hidden="true" tabindex="-1"></a>b6<span class="fl">.4</span>_2 <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;output/Chapter6/b6.4_2.rds&quot;</span>)</span>
<span id="cb668-3"><a href="ulysses-compass.html#cb668-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb668-4"><a href="ulysses-compass.html#cb668-4" aria-hidden="true" tabindex="-1"></a>b6<span class="fl">.4</span> <span class="ot">&lt;-</span> <span class="fu">add_criterion</span>(b6<span class="fl">.4</span>, <span class="at">criterio =</span><span class="fu">c</span>(<span class="st">&quot;waic&quot;</span>,<span class="st">&quot;loo&quot;</span>))</span>
<span id="cb668-5"><a href="ulysses-compass.html#cb668-5" aria-hidden="true" tabindex="-1"></a>b6<span class="fl">.4</span>_2 <span class="ot">&lt;-</span> <span class="fu">add_criterion</span>(b6<span class="fl">.4</span>_2, <span class="at">criterio =</span><span class="fu">c</span>(<span class="st">&quot;waic&quot;</span>,<span class="st">&quot;loo&quot;</span>))</span>
<span id="cb668-6"><a href="ulysses-compass.html#cb668-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb668-7"><a href="ulysses-compass.html#cb668-7" aria-hidden="true" tabindex="-1"></a><span class="fu">loo_compare</span>(b6<span class="fl">.4</span>,b6<span class="fl">.4</span>_2) <span class="sc">%&gt;%</span> </span>
<span id="cb668-8"><a href="ulysses-compass.html#cb668-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="at">simplify=</span>F)</span></code></pre></div>
<pre><code>##        elpd_diff se_diff elpd_loo se_elpd_loo p_loo   se_p_loo looic   se_looic
## b6.4       0.0       0.0 -1356.9     18.6         3.7     0.2   2713.9    37.3 
## b6.4_2  -194.0      17.6 -1551.0     13.8         2.3     0.1   3101.9    27.6</code></pre>
<p><br /></p>
</div>
<div id="h5-3" class="section level3 hasAnchor" number="7.6.9">
<h3><span class="header-section-number">7.6.9</span> 7H5<a href="ulysses-compass.html#h5-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<blockquote>
<p>Revisit the urban fox data, data(foxes), from the previous chapter’s practice problems. Use WAIC or PSIS based model comparison on five different models, each using weight as the outcome, and containing these sets of predictor variables:</p>
</blockquote>
<ol style="list-style-type: decimal">
<li>avgfood + groupsize + area</li>
<li>avgfood + groupsize</li>
<li>groupsize + area</li>
<li>avgfood</li>
<li>area</li>
</ol>
<blockquote>
<p>Can you explain the relative differences in WAIC scores, using the fox DAG from the previous chapter? Be sure to pay attention to the standard error of the score differences (dSE).</p>
</blockquote>
<div class="sourceCode" id="cb670"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb670-1"><a href="ulysses-compass.html#cb670-1" aria-hidden="true" tabindex="-1"></a>b7H5_5 <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;output/Chapter6/b6H3.rds&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb670-2"><a href="ulysses-compass.html#cb670-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_criterion</span>(<span class="fu">c</span>(<span class="st">&quot;waic&quot;</span>))</span>
<span id="cb670-3"><a href="ulysses-compass.html#cb670-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb670-4"><a href="ulysses-compass.html#cb670-4" aria-hidden="true" tabindex="-1"></a>b7H5_4 <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;output/Chapter6/b6H4.rds&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb670-5"><a href="ulysses-compass.html#cb670-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_criterion</span>(<span class="fu">c</span>(<span class="st">&quot;waic&quot;</span>))</span>
<span id="cb670-6"><a href="ulysses-compass.html#cb670-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb670-7"><a href="ulysses-compass.html#cb670-7" aria-hidden="true" tabindex="-1"></a>b7H5_2 <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;output/Chapter6/b6H5.rds&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb670-8"><a href="ulysses-compass.html#cb670-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_criterion</span>(<span class="fu">c</span>(<span class="st">&quot;waic&quot;</span>))</span>
<span id="cb670-9"><a href="ulysses-compass.html#cb670-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb670-10"><a href="ulysses-compass.html#cb670-10" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(foxes)</span>
<span id="cb670-11"><a href="ulysses-compass.html#cb670-11" aria-hidden="true" tabindex="-1"></a>dat3 <span class="ot">&lt;-</span> foxes <span class="sc">%&gt;%</span> </span>
<span id="cb670-12"><a href="ulysses-compass.html#cb670-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb670-13"><a href="ulysses-compass.html#cb670-13" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(area, avgfood, weight, groupsize) <span class="sc">%&gt;%</span> </span>
<span id="cb670-14"><a href="ulysses-compass.html#cb670-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">everything</span>(),standardize))</span>
<span id="cb670-15"><a href="ulysses-compass.html#cb670-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb670-16"><a href="ulysses-compass.html#cb670-16" aria-hidden="true" tabindex="-1"></a><span class="do">## 1</span></span>
<span id="cb670-17"><a href="ulysses-compass.html#cb670-17" aria-hidden="true" tabindex="-1"></a>b7H5_1 <span class="ot">&lt;-</span> </span>
<span id="cb670-18"><a href="ulysses-compass.html#cb670-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">brm</span>(<span class="at">data =</span> dat3,</span>
<span id="cb670-19"><a href="ulysses-compass.html#cb670-19" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> gaussian,</span>
<span id="cb670-20"><a href="ulysses-compass.html#cb670-20" aria-hidden="true" tabindex="-1"></a>      <span class="at">formula =</span> weight <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> area <span class="sc">+</span> groupsize <span class="sc">+</span> avgfood,</span>
<span id="cb670-21"><a href="ulysses-compass.html#cb670-21" aria-hidden="true" tabindex="-1"></a>      <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">0.2</span>),<span class="at">class=</span>Intercept),</span>
<span id="cb670-22"><a href="ulysses-compass.html#cb670-22" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">0.5</span>), <span class="at">class =</span> b,),</span>
<span id="cb670-23"><a href="ulysses-compass.html#cb670-23" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>), <span class="at">class =</span> sigma)),</span>
<span id="cb670-24"><a href="ulysses-compass.html#cb670-24" aria-hidden="true" tabindex="-1"></a>                <span class="at">iter =</span> <span class="dv">4000</span>, <span class="at">warmup =</span> <span class="dv">2000</span>, <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>, <span class="at">seed =</span> <span class="dv">1234</span>,</span>
<span id="cb670-25"><a href="ulysses-compass.html#cb670-25" aria-hidden="true" tabindex="-1"></a>      <span class="at">backend =</span> <span class="st">&quot;cmdstanr&quot;</span>,</span>
<span id="cb670-26"><a href="ulysses-compass.html#cb670-26" aria-hidden="true" tabindex="-1"></a>      <span class="at">file =</span> <span class="st">&quot;output/Chapter6/b7H5_1&quot;</span>)</span>
<span id="cb670-27"><a href="ulysses-compass.html#cb670-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb670-28"><a href="ulysses-compass.html#cb670-28" aria-hidden="true" tabindex="-1"></a>b7H5_1 <span class="ot">&lt;-</span> <span class="fu">add_criterion</span>(b7H5_1, <span class="st">&quot;waic&quot;</span>)</span>
<span id="cb670-29"><a href="ulysses-compass.html#cb670-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb670-30"><a href="ulysses-compass.html#cb670-30" aria-hidden="true" tabindex="-1"></a><span class="do">## 3</span></span>
<span id="cb670-31"><a href="ulysses-compass.html#cb670-31" aria-hidden="true" tabindex="-1"></a>b7H5_3 <span class="ot">&lt;-</span> </span>
<span id="cb670-32"><a href="ulysses-compass.html#cb670-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">brm</span>(<span class="at">data =</span> dat3,</span>
<span id="cb670-33"><a href="ulysses-compass.html#cb670-33" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> gaussian,</span>
<span id="cb670-34"><a href="ulysses-compass.html#cb670-34" aria-hidden="true" tabindex="-1"></a>      <span class="at">formula =</span> weight <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> area <span class="sc">+</span> groupsize <span class="sc">+</span> avgfood,</span>
<span id="cb670-35"><a href="ulysses-compass.html#cb670-35" aria-hidden="true" tabindex="-1"></a>      <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">0.2</span>),<span class="at">class=</span>Intercept),</span>
<span id="cb670-36"><a href="ulysses-compass.html#cb670-36" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">0.5</span>), <span class="at">class =</span> b,),</span>
<span id="cb670-37"><a href="ulysses-compass.html#cb670-37" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>), <span class="at">class =</span> sigma)),</span>
<span id="cb670-38"><a href="ulysses-compass.html#cb670-38" aria-hidden="true" tabindex="-1"></a>                <span class="at">iter =</span> <span class="dv">4000</span>, <span class="at">warmup =</span> <span class="dv">2000</span>, <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>, <span class="at">seed =</span> <span class="dv">1234</span>,</span>
<span id="cb670-39"><a href="ulysses-compass.html#cb670-39" aria-hidden="true" tabindex="-1"></a>      <span class="at">backend =</span> <span class="st">&quot;cmdstanr&quot;</span>,</span>
<span id="cb670-40"><a href="ulysses-compass.html#cb670-40" aria-hidden="true" tabindex="-1"></a>      <span class="at">file =</span> <span class="st">&quot;output/Chapter6/b7H5_3&quot;</span>)</span>
<span id="cb670-41"><a href="ulysses-compass.html#cb670-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb670-42"><a href="ulysses-compass.html#cb670-42" aria-hidden="true" tabindex="-1"></a>b7H5_3 <span class="ot">&lt;-</span> <span class="fu">add_criterion</span>(b7H5_3, <span class="st">&quot;waic&quot;</span>)</span></code></pre></div>
<p>1,2,3はほとんど変わらない。<br />
areaがweightに与える影響はすべてavgfoodを経由しているため、１と2は全く同じとなる。また、3も同様の理由でほとんど変わらない。<br />
4と5も同様である。</p>
<div class="sourceCode" id="cb671"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb671-1"><a href="ulysses-compass.html#cb671-1" aria-hidden="true" tabindex="-1"></a><span class="fu">loo_compare</span>(b7H5_1, b7H5_2, b7H5_3,b7H5_4,b7H5_5,</span>
<span id="cb671-2"><a href="ulysses-compass.html#cb671-2" aria-hidden="true" tabindex="-1"></a>            <span class="at">criterion=</span><span class="st">&quot;waic&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb671-3"><a href="ulysses-compass.html#cb671-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="at">simplify=</span>F)</span></code></pre></div>
<pre><code>##        elpd_diff se_diff elpd_waic se_elpd_waic p_waic se_p_waic waic   se_waic
## b7H5_1    0.0       0.0  -161.4       7.7          4.4    0.7     322.8   15.5 
## b7H5_3    0.0       0.0  -161.4       7.7          4.4    0.7     322.8   15.5 
## b7H5_2   -0.4       1.7  -161.8       7.7          3.5    0.6     323.6   15.4 
## b7H5_4   -5.3       3.4  -166.7       6.7          2.3    0.3     333.3   13.4 
## b7H5_5   -5.3       3.4  -166.7       6.7          2.4    0.4     333.4   13.3</code></pre>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="the-haunted-dag-the-causal-terror.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="conditional-manatees.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
