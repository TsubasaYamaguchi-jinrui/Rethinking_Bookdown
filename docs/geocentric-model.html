<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>4 Geocentric Model | Statistical Rethinking Second Edition</title>
  <meta name="description" content="4 Geocentric Model | Statistical Rethinking Second Edition" />
  <meta name="generator" content="bookdown 0.31 and GitBook 2.6.7" />

  <meta property="og:title" content="4 Geocentric Model | Statistical Rethinking Second Edition" />
  <meta property="og:type" content="book" />
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="4 Geocentric Model | Statistical Rethinking Second Edition" />
  
  
  

<meta name="author" content="Tsubasa Yamaguchi" />


<meta name="date" content="2023-02-01" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="sampling-the-imaginary.html"/>
<link rel="next" href="the-many-variables-the-spurious-waffles.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<script src="libs/htmlwidgets-1.6.1/htmlwidgets.js"></script>
<link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet" />
<script src="libs/datatables-binding-0.27/datatables.js"></script>
<link href="libs/dt-core-1.12.1/css/jquery.dataTables.min.css" rel="stylesheet" />
<link href="libs/dt-core-1.12.1/css/jquery.dataTables.extra.css" rel="stylesheet" />
<script src="libs/dt-core-1.12.1/js/jquery.dataTables.min.js"></script>
<link href="libs/crosstalk-1.2.0/css/crosstalk.min.css" rel="stylesheet" />
<script src="libs/crosstalk-1.2.0/js/crosstalk.min.js"></script>
<link href="libs/tabwid-1.1.2/tabwid.css" rel="stylesheet" />
<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="custom_style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>本稿の目的</a></li>
<li class="chapter" data-level="" data-path="パッケージの読み込み.html"><a href="パッケージの読み込み.html"><i class="fa fa-check"></i>パッケージの読み込み</a></li>
<li class="chapter" data-level="1" data-path="the-golem-of-prague.html"><a href="the-golem-of-prague.html"><i class="fa fa-check"></i><b>1</b> The Golem of Prague 　</a></li>
<li class="chapter" data-level="2" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html"><i class="fa fa-check"></i><b>2</b> Small Worlds and Large Worlds</a>
<ul>
<li class="chapter" data-level="2.1" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#byesian-updating"><i class="fa fa-check"></i><b>2.1</b> Byesian Updating</a></li>
<li class="chapter" data-level="2.2" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#making-th-model"><i class="fa fa-check"></i><b>2.2</b> Making th model</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#grid-approximation"><i class="fa fa-check"></i><b>2.2.1</b> Grid approximation</a></li>
<li class="chapter" data-level="2.2.2" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#quadratic-approximation"><i class="fa fa-check"></i><b>2.2.2</b> Quadratic approximation</a></li>
<li class="chapter" data-level="2.2.3" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#mcmc"><i class="fa fa-check"></i><b>2.2.3</b> MCMC</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#practice"><i class="fa fa-check"></i><b>2.3</b> Practice</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#m1"><i class="fa fa-check"></i><b>2.3.1</b> 2M1</a></li>
<li class="chapter" data-level="2.3.2" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#m2"><i class="fa fa-check"></i><b>2.3.2</b> 2M2</a></li>
<li class="chapter" data-level="2.3.3" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#m3"><i class="fa fa-check"></i><b>2.3.3</b> 2M3</a></li>
<li class="chapter" data-level="2.3.4" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#m4"><i class="fa fa-check"></i><b>2.3.4</b> 2M4</a></li>
<li class="chapter" data-level="2.3.5" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#m5"><i class="fa fa-check"></i><b>2.3.5</b> 2M5</a></li>
<li class="chapter" data-level="2.3.6" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#m7"><i class="fa fa-check"></i><b>2.3.6</b> 2M7</a></li>
<li class="chapter" data-level="2.3.7" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#h1"><i class="fa fa-check"></i><b>2.3.7</b> 2H1</a></li>
<li class="chapter" data-level="2.3.8" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#h2"><i class="fa fa-check"></i><b>2.3.8</b> 2H2</a></li>
<li class="chapter" data-level="2.3.9" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#h3"><i class="fa fa-check"></i><b>2.3.9</b> 2H3</a></li>
<li class="chapter" data-level="2.3.10" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#h4"><i class="fa fa-check"></i><b>2.3.10</b> 2H4</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html"><i class="fa fa-check"></i><b>3</b> Sampling the Imaginary</a>
<ul>
<li class="chapter" data-level="3.1" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#sampling-from-a-grid-aproximate-posterior"><i class="fa fa-check"></i><b>3.1</b> Sampling from a grid-aproximate posterior</a></li>
<li class="chapter" data-level="3.2" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#sampling-to-summarize"><i class="fa fa-check"></i><b>3.2</b> Sampling to summarize</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#intervals-of-defined-mass"><i class="fa fa-check"></i><b>3.2.1</b> Intervals of defined mass</a></li>
<li class="chapter" data-level="3.2.2" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#highly-skewed-example"><i class="fa fa-check"></i><b>3.2.2</b> highly skewed example</a></li>
<li class="chapter" data-level="3.2.3" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#point-estimate"><i class="fa fa-check"></i><b>3.2.3</b> Point estimate　　</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#sampling-to-simulate-prediction"><i class="fa fa-check"></i><b>3.3</b> Sampling to simulate prediction</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#model-checking"><i class="fa fa-check"></i><b>3.3.1</b> Model checking</a></li>
<li class="chapter" data-level="3.3.2" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#practice-with-brms"><i class="fa fa-check"></i><b>3.3.2</b> Practice with brms</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#practice-1"><i class="fa fa-check"></i><b>3.4</b> Practice</a>
<ul>
<li class="chapter" data-level="3.4.1" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#e"><i class="fa fa-check"></i><b>3.4.1</b> 3E</a></li>
<li class="chapter" data-level="3.4.2" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#m"><i class="fa fa-check"></i><b>3.4.2</b> 3M</a></li>
<li class="chapter" data-level="3.4.3" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#h"><i class="fa fa-check"></i><b>3.4.3</b> 3H</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="geocentric-model.html"><a href="geocentric-model.html"><i class="fa fa-check"></i><b>4</b> Geocentric Model</a>
<ul>
<li class="chapter" data-level="4.1" data-path="geocentric-model.html"><a href="geocentric-model.html#why-normal-distributions-are-normal"><i class="fa fa-check"></i><b>4.1</b> Why normal distributions are normal</a></li>
<li class="chapter" data-level="4.2" data-path="geocentric-model.html"><a href="geocentric-model.html#normal-by-multiplication"><i class="fa fa-check"></i><b>4.2</b> Normal by multiplication</a></li>
<li class="chapter" data-level="4.3" data-path="geocentric-model.html"><a href="geocentric-model.html#gaussian-model-of-height"><i class="fa fa-check"></i><b>4.3</b> Gaussian model of height</a></li>
<li class="chapter" data-level="4.4" data-path="geocentric-model.html"><a href="geocentric-model.html#grid-approximationで事後分布を描く"><i class="fa fa-check"></i><b>4.4</b> Grid approximationで事後分布を描く</a>
<ul>
<li class="chapter" data-level="4.4.1" data-path="geocentric-model.html"><a href="geocentric-model.html#事後分布からサンプリングする"><i class="fa fa-check"></i><b>4.4.1</b> 事後分布からサンプリングする</a></li>
<li class="chapter" data-level="4.4.2" data-path="geocentric-model.html"><a href="geocentric-model.html#rethinking"><i class="fa fa-check"></i><b>4.4.2</b> rethinking</a></li>
<li class="chapter" data-level="4.4.3" data-path="geocentric-model.html"><a href="geocentric-model.html#finding-posterior-with-brms"><i class="fa fa-check"></i><b>4.4.3</b> Finding posterior with brms</a></li>
<li class="chapter" data-level="4.4.4" data-path="geocentric-model.html"><a href="geocentric-model.html#事後分布からのサンプリング"><i class="fa fa-check"></i><b>4.4.4</b> 事後分布からのサンプリング</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="geocentric-model.html"><a href="geocentric-model.html#linear-prediction"><i class="fa fa-check"></i><b>4.5</b> Linear prediction</a>
<ul>
<li class="chapter" data-level="4.5.1" data-path="geocentric-model.html"><a href="geocentric-model.html#finding-the-posterior-distribution"><i class="fa fa-check"></i><b>4.5.1</b> Finding the posterior distribution</a></li>
<li class="chapter" data-level="4.5.2" data-path="geocentric-model.html"><a href="geocentric-model.html#plotting-posterior-inference-agaist-the-data"><i class="fa fa-check"></i><b>4.5.2</b> Plotting posterior inference agaist the data</a></li>
<li class="chapter" data-level="4.5.3" data-path="geocentric-model.html"><a href="geocentric-model.html#plotting-regression-intervals-and-contours"><i class="fa fa-check"></i><b>4.5.3</b> Plotting regression intervals and contours</a></li>
<li class="chapter" data-level="4.5.4" data-path="geocentric-model.html"><a href="geocentric-model.html#prediction-intervals"><i class="fa fa-check"></i><b>4.5.4</b> Prediction intervals</a></li>
</ul></li>
<li class="chapter" data-level="4.6" data-path="geocentric-model.html"><a href="geocentric-model.html#curves-from-lines"><i class="fa fa-check"></i><b>4.6</b> Curves from lines</a>
<ul>
<li class="chapter" data-level="4.6.1" data-path="geocentric-model.html"><a href="geocentric-model.html#polynomial-regression"><i class="fa fa-check"></i><b>4.6.1</b> Polynomial regression</a></li>
<li class="chapter" data-level="4.6.2" data-path="geocentric-model.html"><a href="geocentric-model.html#overthinking"><i class="fa fa-check"></i><b>4.6.2</b> overthinking</a></li>
<li class="chapter" data-level="4.6.3" data-path="geocentric-model.html"><a href="geocentric-model.html#splines"><i class="fa fa-check"></i><b>4.6.3</b> Splines</a></li>
</ul></li>
<li class="chapter" data-level="4.7" data-path="geocentric-model.html"><a href="geocentric-model.html#practice-2"><i class="fa fa-check"></i><b>4.7</b> Practice</a>
<ul>
<li class="chapter" data-level="4.7.1" data-path="geocentric-model.html"><a href="geocentric-model.html#m1-2"><i class="fa fa-check"></i><b>4.7.1</b> 4M1</a></li>
<li class="chapter" data-level="4.7.2" data-path="geocentric-model.html"><a href="geocentric-model.html#m2-2"><i class="fa fa-check"></i><b>4.7.2</b> 4M2</a></li>
<li class="chapter" data-level="4.7.3" data-path="geocentric-model.html"><a href="geocentric-model.html#m4-2"><i class="fa fa-check"></i><b>4.7.3</b> 4M4</a></li>
<li class="chapter" data-level="4.7.4" data-path="geocentric-model.html"><a href="geocentric-model.html#m5-2"><i class="fa fa-check"></i><b>4.7.4</b> 4M5</a></li>
<li class="chapter" data-level="4.7.5" data-path="geocentric-model.html"><a href="geocentric-model.html#m6-1"><i class="fa fa-check"></i><b>4.7.5</b> 4M6</a></li>
<li class="chapter" data-level="4.7.6" data-path="geocentric-model.html"><a href="geocentric-model.html#m7-1"><i class="fa fa-check"></i><b>4.7.6</b> 4M7</a></li>
<li class="chapter" data-level="4.7.7" data-path="geocentric-model.html"><a href="geocentric-model.html#m8"><i class="fa fa-check"></i><b>4.7.7</b> 4M8</a></li>
<li class="chapter" data-level="4.7.8" data-path="geocentric-model.html"><a href="geocentric-model.html#h1-2"><i class="fa fa-check"></i><b>4.7.8</b> 4H1</a></li>
<li class="chapter" data-level="4.7.9" data-path="geocentric-model.html"><a href="geocentric-model.html#h2-2"><i class="fa fa-check"></i><b>4.7.9</b> 4H2</a></li>
<li class="chapter" data-level="4.7.10" data-path="geocentric-model.html"><a href="geocentric-model.html#h3-2"><i class="fa fa-check"></i><b>4.7.10</b> 4H3</a></li>
<li class="chapter" data-level="4.7.11" data-path="geocentric-model.html"><a href="geocentric-model.html#h4-2"><i class="fa fa-check"></i><b>4.7.11</b> 4H4</a></li>
<li class="chapter" data-level="4.7.12" data-path="geocentric-model.html"><a href="geocentric-model.html#h5-1"><i class="fa fa-check"></i><b>4.7.12</b> 4H5</a></li>
<li class="chapter" data-level="4.7.13" data-path="geocentric-model.html"><a href="geocentric-model.html#h6"><i class="fa fa-check"></i><b>4.7.13</b> 4H6</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html"><i class="fa fa-check"></i><b>5</b> The many variables &amp; the spurious waffles</a>
<ul>
<li class="chapter" data-level="5.1" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#spurious-association"><i class="fa fa-check"></i><b>5.1</b> Spurious association</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#グラフを用いて因果モデルを考える"><i class="fa fa-check"></i><b>5.1.1</b> グラフを用いて因果モデルを考える</a></li>
<li class="chapter" data-level="5.1.2" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#predictor-residual-plots"><i class="fa fa-check"></i><b>5.1.2</b> Predictor residual plots</a></li>
<li class="chapter" data-level="5.1.3" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#posterior-prediction-plots"><i class="fa fa-check"></i><b>5.1.3</b> Posterior prediction plots</a></li>
<li class="chapter" data-level="5.1.4" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#counterfactual-plot"><i class="fa fa-check"></i><b>5.1.4</b> Counterfactual plot</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#masked-relationship"><i class="fa fa-check"></i><b>5.2</b> Masked relationship</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#k-nモデル"><i class="fa fa-check"></i><b>5.2.1</b> K ~ Nモデル</a></li>
<li class="chapter" data-level="5.2.2" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#k-mモデル"><i class="fa fa-check"></i><b>5.2.2</b> K ~ Mモデル</a></li>
<li class="chapter" data-level="5.2.3" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#k-n-mモデル"><i class="fa fa-check"></i><b>5.2.3</b> K ~ N + Mモデル</a></li>
<li class="chapter" data-level="5.2.4" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#counterfactual-plot-を描く"><i class="fa fa-check"></i><b>5.2.4</b> Counterfactual plot を描く</a></li>
<li class="chapter" data-level="5.2.5" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#overthinking-1"><i class="fa fa-check"></i><b>5.2.5</b> Overthinking</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#categorical-variables"><i class="fa fa-check"></i><b>5.3</b> Categorical variables</a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#two-categories"><i class="fa fa-check"></i><b>5.3.1</b> Two categories</a></li>
<li class="chapter" data-level="5.3.2" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#many-categories"><i class="fa fa-check"></i><b>5.3.2</b> Many Categories</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#practice-3"><i class="fa fa-check"></i><b>5.4</b> Practice</a>
<ul>
<li class="chapter" data-level="5.4.1" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#m1-3"><i class="fa fa-check"></i><b>5.4.1</b> 5M1</a></li>
<li class="chapter" data-level="5.4.2" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#m2-3"><i class="fa fa-check"></i><b>5.4.2</b> 5M2</a></li>
<li class="chapter" data-level="5.4.3" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#m4-3"><i class="fa fa-check"></i><b>5.4.3</b> 5M4</a></li>
<li class="chapter" data-level="5.4.4" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#h1-3"><i class="fa fa-check"></i><b>5.4.4</b> 5H1</a></li>
<li class="chapter" data-level="5.4.5" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#h2-3"><i class="fa fa-check"></i><b>5.4.5</b> 5H2</a></li>
<li class="chapter" data-level="5.4.6" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#h3-3"><i class="fa fa-check"></i><b>5.4.6</b> 5H3</a></li>
<li class="chapter" data-level="5.4.7" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#h4-3"><i class="fa fa-check"></i><b>5.4.7</b> 5H4</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html"><i class="fa fa-check"></i><b>6</b> The Haunted DAG &amp; the Causal Terror</a>
<ul>
<li class="chapter" data-level="6.1" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#multicollinearity"><i class="fa fa-check"></i><b>6.1</b> Multicollinearity</a>
<ul>
<li class="chapter" data-level="6.1.1" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#multicollinear-milk"><i class="fa fa-check"></i><b>6.1.1</b> Multicollinear milk</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#post-treatment-bias"><i class="fa fa-check"></i><b>6.2</b> Post-treatment bias</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#blocked-by-consequence"><i class="fa fa-check"></i><b>6.2.1</b> Blocked by consequence</a></li>
<li class="chapter" data-level="6.2.2" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#fungus-and-d-separation"><i class="fa fa-check"></i><b>6.2.2</b> Fungus and d-separation</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#collider-bias"><i class="fa fa-check"></i><b>6.3</b> Collider bias</a>
<ul>
<li class="chapter" data-level="6.3.1" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#collider-of-false-sorrow"><i class="fa fa-check"></i><b>6.3.1</b> Collider of false sorrow</a></li>
<li class="chapter" data-level="6.3.2" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#the-haunted-dag"><i class="fa fa-check"></i><b>6.3.2</b> The haunted DAG</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#confronting-confoundings"><i class="fa fa-check"></i><b>6.4</b> Confronting confoundings</a>
<ul>
<li class="chapter" data-level="6.4.1" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#two-roads"><i class="fa fa-check"></i><b>6.4.1</b> Two roads</a></li>
<li class="chapter" data-level="6.4.2" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#backdoor-waffles"><i class="fa fa-check"></i><b>6.4.2</b> Backdoor Waffles</a></li>
</ul></li>
<li class="chapter" data-level="6.5" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#practice-4"><i class="fa fa-check"></i><b>6.5</b> Practice</a>
<ul>
<li class="chapter" data-level="6.5.1" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#m1-4"><i class="fa fa-check"></i><b>6.5.1</b> 6M1</a></li>
<li class="chapter" data-level="6.5.2" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#m2-4"><i class="fa fa-check"></i><b>6.5.2</b> 6M2</a></li>
<li class="chapter" data-level="6.5.3" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#h1-4"><i class="fa fa-check"></i><b>6.5.3</b> 6H1</a></li>
<li class="chapter" data-level="6.5.4" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#h2-4"><i class="fa fa-check"></i><b>6.5.4</b> 6H2</a></li>
<li class="chapter" data-level="6.5.5" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#h3-4"><i class="fa fa-check"></i><b>6.5.5</b> 6H3</a></li>
<li class="chapter" data-level="6.5.6" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#h4-4"><i class="fa fa-check"></i><b>6.5.6</b> 6H4</a></li>
<li class="chapter" data-level="6.5.7" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#h5-2"><i class="fa fa-check"></i><b>6.5.7</b> 6H5</a></li>
</ul></li>
<li class="chapter" data-level="6.6" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#おまけ-ランダム効果を入れてみる"><i class="fa fa-check"></i><b>6.6</b> おまけ　ランダム効果を入れてみる</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="ulysses-compass.html"><a href="ulysses-compass.html"><i class="fa fa-check"></i><b>7</b> Ulysses’ Compass</a>
<ul>
<li class="chapter" data-level="7.1" data-path="ulysses-compass.html"><a href="ulysses-compass.html#the-problems-with-parameters"><i class="fa fa-check"></i><b>7.1</b> The problems with parameters</a>
<ul>
<li class="chapter" data-level="7.1.1" data-path="ulysses-compass.html"><a href="ulysses-compass.html#more-parameters-always-improve-fit"><i class="fa fa-check"></i><b>7.1.1</b> More parameters always improve fit</a></li>
<li class="chapter" data-level="7.1.2" data-path="ulysses-compass.html"><a href="ulysses-compass.html#too-few-parameters-hurts-too"><i class="fa fa-check"></i><b>7.1.2</b> Too few parameters hurts too</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="ulysses-compass.html"><a href="ulysses-compass.html#entropy-and-accuracy"><i class="fa fa-check"></i><b>7.2</b> Entropy and accuracy</a>
<ul>
<li class="chapter" data-level="7.2.1" data-path="ulysses-compass.html"><a href="ulysses-compass.html#information-and-uncertainty"><i class="fa fa-check"></i><b>7.2.1</b> Information and uncertainty</a></li>
<li class="chapter" data-level="7.2.2" data-path="ulysses-compass.html"><a href="ulysses-compass.html#from-entropy-to-acculacy"><i class="fa fa-check"></i><b>7.2.2</b> From entropy to acculacy</a></li>
<li class="chapter" data-level="7.2.3" data-path="ulysses-compass.html"><a href="ulysses-compass.html#estimating-divergence"><i class="fa fa-check"></i><b>7.2.3</b> Estimating divergence</a></li>
<li class="chapter" data-level="7.2.4" data-path="ulysses-compass.html"><a href="ulysses-compass.html#scoring-the-right-data"><i class="fa fa-check"></i><b>7.2.4</b> Scoring the right data</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="ulysses-compass.html"><a href="ulysses-compass.html#golem-taming-regularization"><i class="fa fa-check"></i><b>7.3</b> Golem taming: regularization</a></li>
<li class="chapter" data-level="7.4" data-path="ulysses-compass.html"><a href="ulysses-compass.html#predicting-predictive-accuracy"><i class="fa fa-check"></i><b>7.4</b> Predicting predictive accuracy</a>
<ul>
<li class="chapter" data-level="7.4.1" data-path="ulysses-compass.html"><a href="ulysses-compass.html#cross-validation"><i class="fa fa-check"></i><b>7.4.1</b> Cross validation</a></li>
<li class="chapter" data-level="7.4.2" data-path="ulysses-compass.html"><a href="ulysses-compass.html#information-criteria"><i class="fa fa-check"></i><b>7.4.2</b> Information criteria</a></li>
<li class="chapter" data-level="7.4.3" data-path="ulysses-compass.html"><a href="ulysses-compass.html#overthinking-waic-calculation"><i class="fa fa-check"></i><b>7.4.3</b> overthinking: WAIC calculation</a></li>
<li class="chapter" data-level="7.4.4" data-path="ulysses-compass.html"><a href="ulysses-compass.html#comparing-cv-psis-and-waic"><i class="fa fa-check"></i><b>7.4.4</b> Comparing CV, PSIS, and WAIC</a></li>
</ul></li>
<li class="chapter" data-level="7.5" data-path="ulysses-compass.html"><a href="ulysses-compass.html#model-comparison"><i class="fa fa-check"></i><b>7.5</b> Model comparison</a>
<ul>
<li class="chapter" data-level="7.5.1" data-path="ulysses-compass.html"><a href="ulysses-compass.html#model-mis-selection"><i class="fa fa-check"></i><b>7.5.1</b> Model mis-selection</a></li>
<li class="chapter" data-level="7.5.2" data-path="ulysses-compass.html"><a href="ulysses-compass.html#outlier-and-other-illusions"><i class="fa fa-check"></i><b>7.5.2</b> Outlier and other illusions</a></li>
</ul></li>
<li class="chapter" data-level="7.6" data-path="ulysses-compass.html"><a href="ulysses-compass.html#practice-5"><i class="fa fa-check"></i><b>7.6</b> Practice</a>
<ul>
<li class="chapter" data-level="7.6.1" data-path="ulysses-compass.html"><a href="ulysses-compass.html#e2"><i class="fa fa-check"></i><b>7.6.1</b> 7E2</a></li>
<li class="chapter" data-level="7.6.2" data-path="ulysses-compass.html"><a href="ulysses-compass.html#e3"><i class="fa fa-check"></i><b>7.6.2</b> 7E3</a></li>
<li class="chapter" data-level="7.6.3" data-path="ulysses-compass.html"><a href="ulysses-compass.html#e4"><i class="fa fa-check"></i><b>7.6.3</b> 7E4</a></li>
<li class="chapter" data-level="7.6.4" data-path="ulysses-compass.html"><a href="ulysses-compass.html#m4-4"><i class="fa fa-check"></i><b>7.6.4</b> 7M4</a></li>
<li class="chapter" data-level="7.6.5" data-path="ulysses-compass.html"><a href="ulysses-compass.html#h1-5"><i class="fa fa-check"></i><b>7.6.5</b> 7H1</a></li>
<li class="chapter" data-level="7.6.6" data-path="ulysses-compass.html"><a href="ulysses-compass.html#h2-5"><i class="fa fa-check"></i><b>7.6.6</b> 7H2</a></li>
<li class="chapter" data-level="7.6.7" data-path="ulysses-compass.html"><a href="ulysses-compass.html#h3-5"><i class="fa fa-check"></i><b>7.6.7</b> 7H3</a></li>
<li class="chapter" data-level="7.6.8" data-path="ulysses-compass.html"><a href="ulysses-compass.html#h4-5"><i class="fa fa-check"></i><b>7.6.8</b> 7H4</a></li>
<li class="chapter" data-level="7.6.9" data-path="ulysses-compass.html"><a href="ulysses-compass.html#h5-3"><i class="fa fa-check"></i><b>7.6.9</b> 7H5</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="conditional-manatees.html"><a href="conditional-manatees.html"><i class="fa fa-check"></i><b>8</b> Conditional Manatees</a>
<ul>
<li class="chapter" data-level="8.1" data-path="conditional-manatees.html"><a href="conditional-manatees.html#building-an-interaction"><i class="fa fa-check"></i><b>8.1</b> Building an interaction</a>
<ul>
<li class="chapter" data-level="8.1.1" data-path="conditional-manatees.html"><a href="conditional-manatees.html#making-a-rugged-model"><i class="fa fa-check"></i><b>8.1.1</b> Making a rugged model</a></li>
<li class="chapter" data-level="8.1.2" data-path="conditional-manatees.html"><a href="conditional-manatees.html#adding-an-indicator-variable-isnt-enough"><i class="fa fa-check"></i><b>8.1.2</b> Adding an indicator variable isn’t enough</a></li>
<li class="chapter" data-level="8.1.3" data-path="conditional-manatees.html"><a href="conditional-manatees.html#adding-interaction-does-work"><i class="fa fa-check"></i><b>8.1.3</b> Adding interaction does work</a></li>
<li class="chapter" data-level="8.1.4" data-path="conditional-manatees.html"><a href="conditional-manatees.html#plotting-the-interaction"><i class="fa fa-check"></i><b>8.1.4</b> Plotting the interaction</a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="conditional-manatees.html"><a href="conditional-manatees.html#symmetry-of-interaction"><i class="fa fa-check"></i><b>8.2</b> Symmetry of interaction</a></li>
<li class="chapter" data-level="8.3" data-path="conditional-manatees.html"><a href="conditional-manatees.html#continuous-interaction"><i class="fa fa-check"></i><b>8.3</b> Continuous interaction</a>
<ul>
<li class="chapter" data-level="8.3.1" data-path="conditional-manatees.html"><a href="conditional-manatees.html#a-winter-flower"><i class="fa fa-check"></i><b>8.3.1</b> A winter flower</a></li>
<li class="chapter" data-level="8.3.2" data-path="conditional-manatees.html"><a href="conditional-manatees.html#the-models"><i class="fa fa-check"></i><b>8.3.2</b> The models</a></li>
<li class="chapter" data-level="8.3.3" data-path="conditional-manatees.html"><a href="conditional-manatees.html#plotting-posterior-predictions"><i class="fa fa-check"></i><b>8.3.3</b> Plotting posterior predictions</a></li>
<li class="chapter" data-level="8.3.4" data-path="conditional-manatees.html"><a href="conditional-manatees.html#plotting-prior-predictions"><i class="fa fa-check"></i><b>8.3.4</b> Plotting prior predictions</a></li>
</ul></li>
<li class="chapter" data-level="8.4" data-path="conditional-manatees.html"><a href="conditional-manatees.html#practice-6"><i class="fa fa-check"></i><b>8.4</b> Practice</a>
<ul>
<li class="chapter" data-level="8.4.1" data-path="conditional-manatees.html"><a href="conditional-manatees.html#m4-5"><i class="fa fa-check"></i><b>8.4.1</b> 8M4</a></li>
<li class="chapter" data-level="8.4.2" data-path="conditional-manatees.html"><a href="conditional-manatees.html#h1-6"><i class="fa fa-check"></i><b>8.4.2</b> 8H1</a></li>
<li class="chapter" data-level="8.4.3" data-path="conditional-manatees.html"><a href="conditional-manatees.html#h2-6"><i class="fa fa-check"></i><b>8.4.3</b> 8H2</a></li>
<li class="chapter" data-level="8.4.4" data-path="conditional-manatees.html"><a href="conditional-manatees.html#h3-6"><i class="fa fa-check"></i><b>8.4.4</b> 8H3</a></li>
<li class="chapter" data-level="8.4.5" data-path="conditional-manatees.html"><a href="conditional-manatees.html#h4-6"><i class="fa fa-check"></i><b>8.4.5</b> 8H4</a></li>
<li class="chapter" data-level="8.4.6" data-path="conditional-manatees.html"><a href="conditional-manatees.html#h5-4"><i class="fa fa-check"></i><b>8.4.6</b> 8H5</a></li>
<li class="chapter" data-level="8.4.7" data-path="conditional-manatees.html"><a href="conditional-manatees.html#h6-1"><i class="fa fa-check"></i><b>8.4.7</b> 8H6</a></li>
<li class="chapter" data-level="8.4.8" data-path="conditional-manatees.html"><a href="conditional-manatees.html#h7"><i class="fa fa-check"></i><b>8.4.8</b> 8H7</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="9" data-path="marcov-chain-monte-carlo.html"><a href="marcov-chain-monte-carlo.html"><i class="fa fa-check"></i><b>9</b> Marcov Chain Monte Carlo</a>
<ul>
<li class="chapter" data-level="9.1" data-path="marcov-chain-monte-carlo.html"><a href="marcov-chain-monte-carlo.html#good-king-marcov-and-his-island-kingdom"><i class="fa fa-check"></i><b>9.1</b> Good King Marcov and his island kingdom</a></li>
<li class="chapter" data-level="9.2" data-path="marcov-chain-monte-carlo.html"><a href="marcov-chain-monte-carlo.html#metropolis-algorythm"><i class="fa fa-check"></i><b>9.2</b> Metropolis algorythm</a>
<ul>
<li class="chapter" data-level="9.2.1" data-path="marcov-chain-monte-carlo.html"><a href="marcov-chain-monte-carlo.html#gibbs-sampling"><i class="fa fa-check"></i><b>9.2.1</b> Gibbs sampling</a></li>
<li class="chapter" data-level="9.2.2" data-path="marcov-chain-monte-carlo.html"><a href="marcov-chain-monte-carlo.html#high-dimentional-problem"><i class="fa fa-check"></i><b>9.2.2</b> High-dimentional problem</a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="marcov-chain-monte-carlo.html"><a href="marcov-chain-monte-carlo.html#hamiltonian-monte-carlo"><i class="fa fa-check"></i><b>9.3</b> Hamiltonian Monte Carlo</a>
<ul>
<li class="chapter" data-level="9.3.1" data-path="marcov-chain-monte-carlo.html"><a href="marcov-chain-monte-carlo.html#another-probable"><i class="fa fa-check"></i><b>9.3.1</b> Another probable</a></li>
<li class="chapter" data-level="9.3.2" data-path="marcov-chain-monte-carlo.html"><a href="marcov-chain-monte-carlo.html#limitations"><i class="fa fa-check"></i><b>9.3.2</b> Limitations</a></li>
</ul></li>
<li class="chapter" data-level="9.4" data-path="marcov-chain-monte-carlo.html"><a href="marcov-chain-monte-carlo.html#easy-hmc-ulam-brm"><i class="fa fa-check"></i><b>9.4</b> Easy HMC: <del>ulam</del> <code>brm()</code></a>
<ul>
<li class="chapter" data-level="9.4.1" data-path="marcov-chain-monte-carlo.html"><a href="marcov-chain-monte-carlo.html#preparation"><i class="fa fa-check"></i><b>9.4.1</b> Preparation</a></li>
<li class="chapter" data-level="9.4.2" data-path="marcov-chain-monte-carlo.html"><a href="marcov-chain-monte-carlo.html#sampling-from-posterior"><i class="fa fa-check"></i><b>9.4.2</b> Sampling from posterior</a></li>
<li class="chapter" data-level="9.4.3" data-path="marcov-chain-monte-carlo.html"><a href="marcov-chain-monte-carlo.html#sampling-again-in-parallel"><i class="fa fa-check"></i><b>9.4.3</b> Sampling again in parallel</a></li>
<li class="chapter" data-level="9.4.4" data-path="marcov-chain-monte-carlo.html"><a href="marcov-chain-monte-carlo.html#visualization"><i class="fa fa-check"></i><b>9.4.4</b> Visualization</a></li>
<li class="chapter" data-level="9.4.5" data-path="marcov-chain-monte-carlo.html"><a href="marcov-chain-monte-carlo.html#checking-the-chain"><i class="fa fa-check"></i><b>9.4.5</b> Checking the chain</a></li>
</ul></li>
<li class="chapter" data-level="9.5" data-path="marcov-chain-monte-carlo.html"><a href="marcov-chain-monte-carlo.html#care-and-feeding-of-your-marcov-chain"><i class="fa fa-check"></i><b>9.5</b> Care and feeding of your Marcov chain</a>
<ul>
<li class="chapter" data-level="9.5.1" data-path="marcov-chain-monte-carlo.html"><a href="marcov-chain-monte-carlo.html#how-many-samples-do-you-need"><i class="fa fa-check"></i><b>9.5.1</b> How many samples do you need</a></li>
<li class="chapter" data-level="9.5.2" data-path="marcov-chain-monte-carlo.html"><a href="marcov-chain-monte-carlo.html#how-many-chains-do-we-need"><i class="fa fa-check"></i><b>9.5.2</b> How many chains do we need</a></li>
<li class="chapter" data-level="9.5.3" data-path="marcov-chain-monte-carlo.html"><a href="marcov-chain-monte-carlo.html#taming-and-wild-chain"><i class="fa fa-check"></i><b>9.5.3</b> Taming and wild chain</a></li>
<li class="chapter" data-level="9.5.4" data-path="marcov-chain-monte-carlo.html"><a href="marcov-chain-monte-carlo.html#non-identifiable-parameters"><i class="fa fa-check"></i><b>9.5.4</b> Non-identifiable parameters</a></li>
</ul></li>
<li class="chapter" data-level="9.6" data-path="marcov-chain-monte-carlo.html"><a href="marcov-chain-monte-carlo.html#practice-7"><i class="fa fa-check"></i><b>9.6</b> Practice</a>
<ul>
<li class="chapter" data-level="9.6.1" data-path="marcov-chain-monte-carlo.html"><a href="marcov-chain-monte-carlo.html#m1-5"><i class="fa fa-check"></i><b>9.6.1</b> 9M1</a></li>
<li class="chapter" data-level="9.6.2" data-path="marcov-chain-monte-carlo.html"><a href="marcov-chain-monte-carlo.html#m2-5"><i class="fa fa-check"></i><b>9.6.2</b> 9M2</a></li>
<li class="chapter" data-level="9.6.3" data-path="marcov-chain-monte-carlo.html"><a href="marcov-chain-monte-carlo.html#m3-2"><i class="fa fa-check"></i><b>9.6.3</b> 9M3</a></li>
<li class="chapter" data-level="9.6.4" data-path="marcov-chain-monte-carlo.html"><a href="marcov-chain-monte-carlo.html#h1-7"><i class="fa fa-check"></i><b>9.6.4</b> 9H1</a></li>
<li class="chapter" data-level="9.6.5" data-path="marcov-chain-monte-carlo.html"><a href="marcov-chain-monte-carlo.html#h2-7"><i class="fa fa-check"></i><b>9.6.5</b> 9H2</a></li>
<li class="chapter" data-level="9.6.6" data-path="marcov-chain-monte-carlo.html"><a href="marcov-chain-monte-carlo.html#h3-7"><i class="fa fa-check"></i><b>9.6.6</b> 9H3</a></li>
<li class="chapter" data-level="9.6.7" data-path="marcov-chain-monte-carlo.html"><a href="marcov-chain-monte-carlo.html#h4-7"><i class="fa fa-check"></i><b>9.6.7</b> 9H4</a></li>
<li class="chapter" data-level="9.6.8" data-path="marcov-chain-monte-carlo.html"><a href="marcov-chain-monte-carlo.html#h5-5"><i class="fa fa-check"></i><b>9.6.8</b> 9H5</a></li>
<li class="chapter" data-level="9.6.9" data-path="marcov-chain-monte-carlo.html"><a href="marcov-chain-monte-carlo.html#h6-2"><i class="fa fa-check"></i><b>9.6.9</b> 9H6</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="10" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html"><i class="fa fa-check"></i><b>10</b> Big Entropy and the Generalized Linear Model</a>
<ul>
<li class="chapter" data-level="10.1" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html#maximum-entropy"><i class="fa fa-check"></i><b>10.1</b> Maximum entropy</a>
<ul>
<li class="chapter" data-level="10.1.1" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html#gaussian"><i class="fa fa-check"></i><b>10.1.1</b> Gaussian</a></li>
<li class="chapter" data-level="10.1.2" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html#binomial"><i class="fa fa-check"></i><b>10.1.2</b> Binomial</a></li>
</ul></li>
<li class="chapter" data-level="10.2" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html#generalized-linear-models"><i class="fa fa-check"></i><b>10.2</b> Generalized linear models</a>
<ul>
<li class="chapter" data-level="10.2.1" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html#meet-the-family"><i class="fa fa-check"></i><b>10.2.1</b> Meet the family</a></li>
<li class="chapter" data-level="10.2.2" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html#linking-linear-models-to-distributions"><i class="fa fa-check"></i><b>10.2.2</b> Linking linear models to distributions</a></li>
<li class="chapter" data-level="10.2.3" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html#overthinking-2"><i class="fa fa-check"></i><b>10.2.3</b> Overthinking</a></li>
<li class="chapter" data-level="10.2.4" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html#omitted-variable-bias-again"><i class="fa fa-check"></i><b>10.2.4</b> Omitted variable bias again</a></li>
<li class="chapter" data-level="10.2.5" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html#absolute-and-relative-differences"><i class="fa fa-check"></i><b>10.2.5</b> Absolute and relative differences</a></li>
<li class="chapter" data-level="10.2.6" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html#glms-and-information-criteria"><i class="fa fa-check"></i><b>10.2.6</b> GLMs and information criteria</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="11" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html"><i class="fa fa-check"></i><b>11</b> God Spiked the Integers</a>
<ul>
<li class="chapter" data-level="11.1" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#binomial-regression"><i class="fa fa-check"></i><b>11.1</b> Binomial regression</a>
<ul>
<li class="chapter" data-level="11.1.1" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#logistic-regression"><i class="fa fa-check"></i><b>11.1.1</b> Logistic regression</a></li>
<li class="chapter" data-level="11.1.2" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#relative-shark-and-absolute-deer"><i class="fa fa-check"></i><b>11.1.2</b> Relative shark and absolute deer</a></li>
<li class="chapter" data-level="11.1.3" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#aggregated-binomial-chimpanzees-again-condensed"><i class="fa fa-check"></i><b>11.1.3</b> Aggregated binomial: Chimpanzees again, condensed</a></li>
</ul></li>
<li class="chapter" data-level="11.2" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#aggregated-binomial-graduate-school-admittions."><i class="fa fa-check"></i><b>11.2</b> Aggregated binomial: Graduate school admittions.</a></li>
<li class="chapter" data-level="11.3" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#poisson-regression"><i class="fa fa-check"></i><b>11.3</b> Poisson regression</a>
<ul>
<li class="chapter" data-level="11.3.1" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#oceanic-tool-complexity"><i class="fa fa-check"></i><b>11.3.1</b> Oceanic tool complexity</a></li>
<li class="chapter" data-level="11.3.2" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#negative-binomial-gamma-poisson-models."><i class="fa fa-check"></i><b>11.3.2</b> Negative binomial (Gamma-Poisson) models.</a></li>
<li class="chapter" data-level="11.3.3" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#example-exposure-and-the-offset"><i class="fa fa-check"></i><b>11.3.3</b> Example: Exposure and the offset</a></li>
</ul></li>
<li class="chapter" data-level="11.4" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#multinomial-and-categorical-models"><i class="fa fa-check"></i><b>11.4</b> Multinomial and categorical models</a>
<ul>
<li class="chapter" data-level="11.4.1" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#predictors-matched-to-outcomes"><i class="fa fa-check"></i><b>11.4.1</b> Predictors matched to outcomes</a></li>
<li class="chapter" data-level="11.4.2" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#predictor-matched-to-observations"><i class="fa fa-check"></i><b>11.4.2</b> Predictor matched to observations</a></li>
<li class="chapter" data-level="11.4.3" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#multinomial-in-disguise-as-poisson"><i class="fa fa-check"></i><b>11.4.3</b> Multinomial in disguise as Poisson</a></li>
</ul></li>
<li class="chapter" data-level="11.5" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#practice-8"><i class="fa fa-check"></i><b>11.5</b> Practice</a>
<ul>
<li class="chapter" data-level="11.5.1" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#e1"><i class="fa fa-check"></i><b>11.5.1</b> 11E1</a></li>
<li class="chapter" data-level="11.5.2" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#e2-1"><i class="fa fa-check"></i><b>11.5.2</b> 11E2</a></li>
<li class="chapter" data-level="11.5.3" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#e3-1"><i class="fa fa-check"></i><b>11.5.3</b> 11E3</a></li>
<li class="chapter" data-level="11.5.4" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#e4-1"><i class="fa fa-check"></i><b>11.5.4</b> 11E4</a></li>
<li class="chapter" data-level="11.5.5" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#m7-2"><i class="fa fa-check"></i><b>11.5.5</b> 11M7</a></li>
<li class="chapter" data-level="11.5.6" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#m8-1"><i class="fa fa-check"></i><b>11.5.6</b> 11M8</a></li>
<li class="chapter" data-level="11.5.7" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#h1-8"><i class="fa fa-check"></i><b>11.5.7</b> 11H1</a></li>
<li class="chapter" data-level="11.5.8" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#h2-8"><i class="fa fa-check"></i><b>11.5.8</b> 11H2</a></li>
<li class="chapter" data-level="11.5.9" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#h3-8"><i class="fa fa-check"></i><b>11.5.9</b> 11H3</a></li>
<li class="chapter" data-level="11.5.10" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#h4-8"><i class="fa fa-check"></i><b>11.5.10</b> 11H4</a></li>
<li class="chapter" data-level="11.5.11" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#h5-6"><i class="fa fa-check"></i><b>11.5.11</b> 11H5</a></li>
<li class="chapter" data-level="11.5.12" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#h6-3"><i class="fa fa-check"></i><b>11.5.12</b> 11H6</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="12" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html"><i class="fa fa-check"></i><b>12</b> Monsters and Mixtures</a>
<ul>
<li class="chapter" data-level="12.1" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#over-dispersed-counts"><i class="fa fa-check"></i><b>12.1</b> Over-dispersed counts</a>
<ul>
<li class="chapter" data-level="12.1.1" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#beta-binomial."><i class="fa fa-check"></i><b>12.1.1</b> Beta binomial.</a></li>
<li class="chapter" data-level="12.1.2" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#negative-binomial-or-gamma-poisson."><i class="fa fa-check"></i><b>12.1.2</b> Negative binomial or gamma-Poisson.</a></li>
<li class="chapter" data-level="12.1.3" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#over-dispersion-entropy-and-information-criteria."><i class="fa fa-check"></i><b>12.1.3</b> Over-dispersion, entropy, and information criteria.</a></li>
</ul></li>
<li class="chapter" data-level="12.2" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#zero-inflated-outcomes"><i class="fa fa-check"></i><b>12.2</b> Zero-inflated outcomes</a>
<ul>
<li class="chapter" data-level="12.2.1" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#example-zero-inflated-poisson."><i class="fa fa-check"></i><b>12.2.1</b> Example: Zero-inflated Poisson.</a></li>
</ul></li>
<li class="chapter" data-level="12.3" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#ordered-categorical-outcomes"><i class="fa fa-check"></i><b>12.3</b> Ordered categorical outcomes</a>
<ul>
<li class="chapter" data-level="12.3.1" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#example-moral-intuition."><i class="fa fa-check"></i><b>12.3.1</b> Example: Moral intuition.</a></li>
<li class="chapter" data-level="12.3.2" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#adding-predictor-variables."><i class="fa fa-check"></i><b>12.3.2</b> Adding predictor variables.</a></li>
</ul></li>
<li class="chapter" data-level="12.4" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#ordered-categorical-predictors"><i class="fa fa-check"></i><b>12.4</b> Ordered categorical predictors</a></li>
<li class="chapter" data-level="12.5" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#practice-9"><i class="fa fa-check"></i><b>12.5</b> Practice</a>
<ul>
<li class="chapter" data-level="12.5.1" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#m1-6"><i class="fa fa-check"></i><b>12.5.1</b> 12M1</a></li>
<li class="chapter" data-level="12.5.2" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#m2-6"><i class="fa fa-check"></i><b>12.5.2</b> 12M2</a></li>
<li class="chapter" data-level="12.5.3" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#m3-3"><i class="fa fa-check"></i><b>12.5.3</b> 12M3</a></li>
<li class="chapter" data-level="12.5.4" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#h1-9"><i class="fa fa-check"></i><b>12.5.4</b> 12H1</a></li>
<li class="chapter" data-level="12.5.5" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#h2-9"><i class="fa fa-check"></i><b>12.5.5</b> 12H2</a></li>
<li class="chapter" data-level="12.5.6" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#h3-9"><i class="fa fa-check"></i><b>12.5.6</b> 12H3</a></li>
<li class="chapter" data-level="12.5.7" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#h4-9"><i class="fa fa-check"></i><b>12.5.7</b> 12H4</a></li>
<li class="chapter" data-level="12.5.8" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#h5-7"><i class="fa fa-check"></i><b>12.5.8</b> 12H5</a></li>
<li class="chapter" data-level="12.5.9" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#h6-4"><i class="fa fa-check"></i><b>12.5.9</b> 12H6</a></li>
<li class="chapter" data-level="12.5.10" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#h7-1"><i class="fa fa-check"></i><b>12.5.10</b> 12H7</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="13" data-path="models-with-memory.html"><a href="models-with-memory.html"><i class="fa fa-check"></i><b>13</b> Models with Memory</a>
<ul>
<li class="chapter" data-level="13.1" data-path="models-with-memory.html"><a href="models-with-memory.html#multilevel-tadpoles"><i class="fa fa-check"></i><b>13.1</b> Multilevel tadpoles</a></li>
<li class="chapter" data-level="13.2" data-path="models-with-memory.html"><a href="models-with-memory.html#varying-effects-and-the-underfittingoverfitting-trade-off"><i class="fa fa-check"></i><b>13.2</b> Varying effects and the underfitting/overfitting trade-off 　</a>
<ul>
<li class="chapter" data-level="13.2.1" data-path="models-with-memory.html"><a href="models-with-memory.html#the-model"><i class="fa fa-check"></i><b>13.2.1</b> The model</a></li>
<li class="chapter" data-level="13.2.2" data-path="models-with-memory.html"><a href="models-with-memory.html#simulate-survivors"><i class="fa fa-check"></i><b>13.2.2</b> Simulate survivors</a></li>
</ul></li>
<li class="chapter" data-level="13.3" data-path="models-with-memory.html"><a href="models-with-memory.html#more-than-one-type-of-cluster"><i class="fa fa-check"></i><b>13.3</b> More than one type of cluster</a>
<ul>
<li class="chapter" data-level="13.3.1" data-path="models-with-memory.html"><a href="models-with-memory.html#even-more-clusters"><i class="fa fa-check"></i><b>13.3.1</b> Even more clusters</a></li>
</ul></li>
<li class="chapter" data-level="13.4" data-path="models-with-memory.html"><a href="models-with-memory.html#divergent-transitions-and-non-centered-priors"><i class="fa fa-check"></i><b>13.4</b> Divergent transitions and non-centered priors</a>
<ul>
<li class="chapter" data-level="13.4.1" data-path="models-with-memory.html"><a href="models-with-memory.html#the-devils-funnel"><i class="fa fa-check"></i><b>13.4.1</b> The Devil’s Funnel</a></li>
<li class="chapter" data-level="13.4.2" data-path="models-with-memory.html"><a href="models-with-memory.html#non-centered-chimpanzees"><i class="fa fa-check"></i><b>13.4.2</b> Non-centered chimpanzees</a></li>
</ul></li>
<li class="chapter" data-level="13.5" data-path="models-with-memory.html"><a href="models-with-memory.html#multilevel-posterior-predictions"><i class="fa fa-check"></i><b>13.5</b> Multilevel posterior predictions</a>
<ul>
<li class="chapter" data-level="13.5.1" data-path="models-with-memory.html"><a href="models-with-memory.html#posterior-prediction-for-same-clusters"><i class="fa fa-check"></i><b>13.5.1</b> Posterior prediction for same clusters</a></li>
<li class="chapter" data-level="13.5.2" data-path="models-with-memory.html"><a href="models-with-memory.html#posterior-prediction-for-new-clusters"><i class="fa fa-check"></i><b>13.5.2</b> Posterior prediction for new clusters</a></li>
</ul></li>
<li class="chapter" data-level="13.6" data-path="models-with-memory.html"><a href="models-with-memory.html#post-stratification"><i class="fa fa-check"></i><b>13.6</b> Post stratification</a>
<ul>
<li class="chapter" data-level="13.6.1" data-path="models-with-memory.html"><a href="models-with-memory.html#meet-the-data"><i class="fa fa-check"></i><b>13.6.1</b> Meet the data</a></li>
<li class="chapter" data-level="13.6.2" data-path="models-with-memory.html"><a href="models-with-memory.html#settle-the-mr-part-of-mrp."><i class="fa fa-check"></i><b>13.6.2</b> Settle the MR part of MRP.</a></li>
<li class="chapter" data-level="13.6.3" data-path="models-with-memory.html"><a href="models-with-memory.html#post-stratify-to-put-the-p-in-mrp."><i class="fa fa-check"></i><b>13.6.3</b> Post-stratify to put the P in MRP.</a></li>
</ul></li>
<li class="chapter" data-level="13.7" data-path="models-with-memory.html"><a href="models-with-memory.html#practice-10"><i class="fa fa-check"></i><b>13.7</b> Practice</a>
<ul>
<li class="chapter" data-level="13.7.1" data-path="models-with-memory.html"><a href="models-with-memory.html#m1-7"><i class="fa fa-check"></i><b>13.7.1</b> 13M1</a></li>
<li class="chapter" data-level="13.7.2" data-path="models-with-memory.html"><a href="models-with-memory.html#m2-7"><i class="fa fa-check"></i><b>13.7.2</b> 13M2</a></li>
<li class="chapter" data-level="13.7.3" data-path="models-with-memory.html"><a href="models-with-memory.html#m3-4"><i class="fa fa-check"></i><b>13.7.3</b> 13M3</a></li>
<li class="chapter" data-level="13.7.4" data-path="models-with-memory.html"><a href="models-with-memory.html#m4-6"><i class="fa fa-check"></i><b>13.7.4</b> 13M4</a></li>
<li class="chapter" data-level="13.7.5" data-path="models-with-memory.html"><a href="models-with-memory.html#m5-3"><i class="fa fa-check"></i><b>13.7.5</b> 13M5</a></li>
<li class="chapter" data-level="13.7.6" data-path="models-with-memory.html"><a href="models-with-memory.html#m6-2"><i class="fa fa-check"></i><b>13.7.6</b> 13M6</a></li>
<li class="chapter" data-level="13.7.7" data-path="models-with-memory.html"><a href="models-with-memory.html#h1-10"><i class="fa fa-check"></i><b>13.7.7</b> 13H1</a></li>
<li class="chapter" data-level="13.7.8" data-path="models-with-memory.html"><a href="models-with-memory.html#h2-10"><i class="fa fa-check"></i><b>13.7.8</b> 13H2</a></li>
<li class="chapter" data-level="13.7.9" data-path="models-with-memory.html"><a href="models-with-memory.html#h3-10"><i class="fa fa-check"></i><b>13.7.9</b> 13H3</a></li>
<li class="chapter" data-level="13.7.10" data-path="models-with-memory.html"><a href="models-with-memory.html#h4-10"><i class="fa fa-check"></i><b>13.7.10</b> 13H4</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="14" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html"><i class="fa fa-check"></i><b>14</b> Adventures in Covariance</a>
<ul>
<li class="chapter" data-level="14.1" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#varying-slopes-by-construction"><i class="fa fa-check"></i><b>14.1</b> Varying slopes by construction</a>
<ul>
<li class="chapter" data-level="14.1.1" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#simulate-and-population"><i class="fa fa-check"></i><b>14.1.1</b> Simulate and population</a></li>
<li class="chapter" data-level="14.1.2" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#simulate-observation"><i class="fa fa-check"></i><b>14.1.2</b> Simulate observation</a></li>
<li class="chapter" data-level="14.1.3" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#the-varying-slope-model"><i class="fa fa-check"></i><b>14.1.3</b> The varying slope model</a></li>
</ul></li>
<li class="chapter" data-level="14.2" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#advanced-varing-slopes"><i class="fa fa-check"></i><b>14.2</b> Advanced varing slopes</a></li>
<li class="chapter" data-level="14.3" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#instruments-and-causal-designs"><i class="fa fa-check"></i><b>14.3</b> Instruments and causal designs</a>
<ul>
<li class="chapter" data-level="14.3.1" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#instrumental-variables"><i class="fa fa-check"></i><b>14.3.1</b> Instrumental variables</a></li>
<li class="chapter" data-level="14.3.2" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#other-designs"><i class="fa fa-check"></i><b>14.3.2</b> Other designs</a></li>
</ul></li>
<li class="chapter" data-level="14.4" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#social-relations-as-correlated-varying-effects"><i class="fa fa-check"></i><b>14.4</b> Social relations as correlated varying effects</a></li>
<li class="chapter" data-level="14.5" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#continuous-categories-and-the-gaussian-process"><i class="fa fa-check"></i><b>14.5</b> Continuous categories and the Gaussian process</a>
<ul>
<li class="chapter" data-level="14.5.1" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#example-spatial-autocorrelation-in-oceanic-tools"><i class="fa fa-check"></i><b>14.5.1</b> Example: Spatial autocorrelation in Oceanic tools</a></li>
<li class="chapter" data-level="14.5.2" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#example-phylogenetic-distance"><i class="fa fa-check"></i><b>14.5.2</b> Example: Phylogenetic distance</a></li>
</ul></li>
<li class="chapter" data-level="14.6" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#practice-11"><i class="fa fa-check"></i><b>14.6</b> Practice</a>
<ul>
<li class="chapter" data-level="14.6.1" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#m1-8"><i class="fa fa-check"></i><b>14.6.1</b> 14M1</a></li>
<li class="chapter" data-level="14.6.2" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#m2-8"><i class="fa fa-check"></i><b>14.6.2</b> 14M2</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="実行環境.html"><a href="実行環境.html"><i class="fa fa-check"></i>実行環境</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Statistical Rethinking Second Edition</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="geocentric-model" class="section level1 hasAnchor" number="4">
<h1><span class="header-section-number">4</span> Geocentric Model<a href="geocentric-model.html#geocentric-model" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div id="why-normal-distributions-are-normal" class="section level2 hasAnchor" number="4.1">
<h2><span class="header-section-number">4.1</span> Why normal distributions are normal<a href="geocentric-model.html#why-normal-distributions-are-normal" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>ランダムウォークを繰り返すと、分布が正規分布にちかづいていく。</p>
<div class="sourceCode" id="cb124"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb124-1"><a href="geocentric-model.html#cb124-1" aria-hidden="true" tabindex="-1"></a>pos <span class="ot">&lt;-</span> </span>
<span id="cb124-2"><a href="geocentric-model.html#cb124-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">crossing</span>(<span class="at">person =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>,</span>
<span id="cb124-3"><a href="geocentric-model.html#cb124-3" aria-hidden="true" tabindex="-1"></a>           <span class="at">step =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">16</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb124-4"><a href="geocentric-model.html#cb124-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">dev =</span> <span class="fu">map_dbl</span>(step, <span class="sc">~</span><span class="fu">ifelse</span>(.<span class="sc">==</span><span class="dv">0</span>,<span class="dv">0</span>,<span class="fu">runif</span>(<span class="dv">1</span>,<span class="sc">-</span><span class="dv">1</span>,<span class="dv">1</span>)))) </span>
<span id="cb124-5"><a href="geocentric-model.html#cb124-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb124-6"><a href="geocentric-model.html#cb124-6" aria-hidden="true" tabindex="-1"></a>pos <span class="ot">&lt;-</span> pos <span class="sc">%&gt;%</span> </span>
<span id="cb124-7"><a href="geocentric-model.html#cb124-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(person) <span class="sc">%&gt;%</span> </span>
<span id="cb124-8"><a href="geocentric-model.html#cb124-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">sum_dev =</span> <span class="fu">cumsum</span>(dev)) <span class="sc">%&gt;%</span> </span>
<span id="cb124-9"><a href="geocentric-model.html#cb124-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb124-10"><a href="geocentric-model.html#cb124-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb124-11"><a href="geocentric-model.html#cb124-11" aria-hidden="true" tabindex="-1"></a><span class="co">#Figure4.2</span></span>
<span id="cb124-12"><a href="geocentric-model.html#cb124-12" aria-hidden="true" tabindex="-1"></a><span class="do">##above</span></span>
<span id="cb124-13"><a href="geocentric-model.html#cb124-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb124-14"><a href="geocentric-model.html#cb124-14" aria-hidden="true" tabindex="-1"></a>pos <span class="sc">%&gt;%</span> </span>
<span id="cb124-15"><a href="geocentric-model.html#cb124-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>step,<span class="at">y=</span>sum_dev,<span class="at">group=</span>person))<span class="sc">+</span></span>
<span id="cb124-16"><a href="geocentric-model.html#cb124-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">color =</span> person <span class="sc">&lt;</span> <span class="dv">2</span>, </span>
<span id="cb124-17"><a href="geocentric-model.html#cb124-17" aria-hidden="true" tabindex="-1"></a>                <span class="at">alpha  =</span> person <span class="sc">&lt;</span> <span class="dv">2</span>))<span class="sc">+</span></span>
<span id="cb124-18"><a href="geocentric-model.html#cb124-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept=</span><span class="fu">c</span>(<span class="dv">4</span>,<span class="dv">8</span>,<span class="dv">16</span>), <span class="at">linetype=</span><span class="dv">2</span>)<span class="sc">+</span></span>
<span id="cb124-19"><a href="geocentric-model.html#cb124-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;skyblue4&quot;</span>, <span class="st">&quot;black&quot;</span>))<span class="sc">+</span></span>
<span id="cb124-20"><a href="geocentric-model.html#cb124-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_alpha_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">5</span>, <span class="dv">1</span>))<span class="sc">+</span></span>
<span id="cb124-21"><a href="geocentric-model.html#cb124-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="st">&quot;step number&quot;</span>, <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">16</span>,<span class="dv">2</span>))<span class="sc">+</span></span>
<span id="cb124-22"><a href="geocentric-model.html#cb124-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>) </span></code></pre></div>
<p><img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-51-1.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb125"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb125-1"><a href="geocentric-model.html#cb125-1" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> pos <span class="sc">%&gt;%</span> </span>
<span id="cb125-2"><a href="geocentric-model.html#cb125-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(step<span class="sc">==</span><span class="dv">4</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb125-3"><a href="geocentric-model.html#cb125-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>sum_dev))<span class="sc">+</span></span>
<span id="cb125-4"><a href="geocentric-model.html#cb125-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">stat =</span> <span class="st">&quot;density&quot;</span>)<span class="sc">+</span></span>
<span id="cb125-5"><a href="geocentric-model.html#cb125-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="st">&quot;4 steps&quot;</span>)</span>
<span id="cb125-6"><a href="geocentric-model.html#cb125-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb125-7"><a href="geocentric-model.html#cb125-7" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> pos <span class="sc">%&gt;%</span> </span>
<span id="cb125-8"><a href="geocentric-model.html#cb125-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(step<span class="sc">==</span><span class="dv">8</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb125-9"><a href="geocentric-model.html#cb125-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>sum_dev))<span class="sc">+</span></span>
<span id="cb125-10"><a href="geocentric-model.html#cb125-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">stat =</span> <span class="st">&quot;density&quot;</span>)<span class="sc">+</span></span>
<span id="cb125-11"><a href="geocentric-model.html#cb125-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="st">&quot;8 steps&quot;</span>)</span>
<span id="cb125-12"><a href="geocentric-model.html#cb125-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb125-13"><a href="geocentric-model.html#cb125-13" aria-hidden="true" tabindex="-1"></a>pos <span class="sc">%&gt;%</span> </span>
<span id="cb125-14"><a href="geocentric-model.html#cb125-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(step<span class="sc">==</span><span class="dv">16</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb125-15"><a href="geocentric-model.html#cb125-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">sd =</span> <span class="fu">sd</span>(sum_dev)) <span class="ot">-&gt;</span>sd</span>
<span id="cb125-16"><a href="geocentric-model.html#cb125-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb125-17"><a href="geocentric-model.html#cb125-17" aria-hidden="true" tabindex="-1"></a>p3 <span class="ot">&lt;-</span> pos <span class="sc">%&gt;%</span> </span>
<span id="cb125-18"><a href="geocentric-model.html#cb125-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(step<span class="sc">==</span><span class="dv">16</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb125-19"><a href="geocentric-model.html#cb125-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>sum_dev))<span class="sc">+</span></span>
<span id="cb125-20"><a href="geocentric-model.html#cb125-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_function</span>(<span class="at">fun =</span> dnorm, </span>
<span id="cb125-21"><a href="geocentric-model.html#cb125-21" aria-hidden="true" tabindex="-1"></a>                <span class="at">args =</span> <span class="fu">list</span>(<span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> sd[[<span class="dv">1</span>]]),</span>
<span id="cb125-22"><a href="geocentric-model.html#cb125-22" aria-hidden="true" tabindex="-1"></a>                <span class="at">linetype =</span> <span class="dv">2</span>)<span class="sc">+</span></span>
<span id="cb125-23"><a href="geocentric-model.html#cb125-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">color =</span> <span class="st">&quot;transparent&quot;</span>, <span class="at">fill =</span> <span class="st">&quot;dodgerblue3&quot;</span>, <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb125-24"><a href="geocentric-model.html#cb125-24" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb125-25"><a href="geocentric-model.html#cb125-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="st">&quot;16 steps&quot;</span>)</span>
<span id="cb125-26"><a href="geocentric-model.html#cb125-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb125-27"><a href="geocentric-model.html#cb125-27" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb125-28"><a href="geocentric-model.html#cb125-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb125-29"><a href="geocentric-model.html#cb125-29" aria-hidden="true" tabindex="-1"></a>p1<span class="sc">|</span>p2<span class="sc">|</span>p3 <span class="sc">&amp;</span> <span class="fu">coord_cartesian</span>(<span class="at">xlim=</span><span class="fu">c</span>(<span class="sc">-</span><span class="dv">6</span>,<span class="dv">6</span>))</span></code></pre></div>
<p><img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-51-2.png" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="normal-by-multiplication" class="section level2 hasAnchor" number="4.2">
<h2><span class="header-section-number">4.2</span> Normal by multiplication<a href="geocentric-model.html#normal-by-multiplication" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>掛け算になる場合でも、変化が小さければ正規分布に近づくことがある。</p>
<div class="sourceCode" id="cb126"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb126-1"><a href="geocentric-model.html#cb126-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">4</span>)</span>
<span id="cb126-2"><a href="geocentric-model.html#cb126-2" aria-hidden="true" tabindex="-1"></a><span class="fu">prod</span>(<span class="dv">1</span> <span class="sc">+</span> <span class="fu">runif</span>(<span class="dv">12</span>, <span class="dv">0</span>, <span class="fl">0.1</span>))</span></code></pre></div>
<pre><code>## [1] 1.774719</code></pre>
<div class="sourceCode" id="cb128"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb128-1"><a href="geocentric-model.html#cb128-1" aria-hidden="true" tabindex="-1"></a>growth <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">growth =</span> <span class="fu">map_dbl</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10000</span>, <span class="sc">~</span> <span class="fu">prod</span>(<span class="dv">1</span> <span class="sc">+</span> <span class="fu">runif</span>(<span class="dv">12</span>, <span class="dv">0</span>, <span class="fl">0.1</span>))))</span>
<span id="cb128-2"><a href="geocentric-model.html#cb128-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-3"><a href="geocentric-model.html#cb128-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> growth, <span class="fu">aes</span>(<span class="at">x =</span> growth)) <span class="sc">+</span></span>
<span id="cb128-4"><a href="geocentric-model.html#cb128-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>()</span></code></pre></div>
<p><img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-52-1.png" width="672" style="display: block; margin: auto;" />
<br /></p>
<p>成長にもたらす効果が小さいほど、効果の積が効果の和に近づくので、正規分布に近づく。</p>
<div class="sourceCode" id="cb129"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb129-1"><a href="geocentric-model.html#cb129-1" aria-hidden="true" tabindex="-1"></a>growth_big <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">growth =</span> <span class="fu">map_dbl</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10000</span>, <span class="sc">~</span> <span class="fu">prod</span>(<span class="dv">1</span> <span class="sc">+</span> <span class="fu">runif</span>(<span class="dv">12</span>, <span class="dv">0</span>, <span class="fl">0.5</span>))))</span>
<span id="cb129-2"><a href="geocentric-model.html#cb129-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-3"><a href="geocentric-model.html#cb129-3" aria-hidden="true" tabindex="-1"></a>growth_small <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">growth =</span> <span class="fu">map_dbl</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10000</span>, <span class="sc">~</span> <span class="fu">prod</span>(<span class="dv">1</span> <span class="sc">+</span> <span class="fu">runif</span>(<span class="dv">12</span>, <span class="dv">0</span>, <span class="fl">0.01</span>))))</span>
<span id="cb129-4"><a href="geocentric-model.html#cb129-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-5"><a href="geocentric-model.html#cb129-5" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> growth_big, <span class="fu">aes</span>(<span class="at">x =</span> growth)) <span class="sc">+</span></span>
<span id="cb129-6"><a href="geocentric-model.html#cb129-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>()</span></code></pre></div>
<p><img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-53-1.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb130"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb130-1"><a href="geocentric-model.html#cb130-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> growth_small, <span class="fu">aes</span>(<span class="at">x =</span> growth)) <span class="sc">+</span></span>
<span id="cb130-2"><a href="geocentric-model.html#cb130-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>()</span></code></pre></div>
<p><img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-53-2.png" width="672" style="display: block; margin: auto;" />
<br /></p>
<p>効果が大きいときも、対数をとると正規分布に近づく。これは、対数では積と和が等しくなることによる。</p>
<div class="sourceCode" id="cb131"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb131-1"><a href="geocentric-model.html#cb131-1" aria-hidden="true" tabindex="-1"></a>log_growth_big <span class="ot">&lt;-</span> <span class="fu">log</span>(growth_big)</span>
<span id="cb131-2"><a href="geocentric-model.html#cb131-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> log_growth_big, <span class="fu">aes</span>(<span class="at">x =</span> growth)) <span class="sc">+</span></span>
<span id="cb131-3"><a href="geocentric-model.html#cb131-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>()</span></code></pre></div>
<p><img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-54-1.png" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="gaussian-model-of-height" class="section level2 hasAnchor" number="4.3">
<h2><span class="header-section-number">4.3</span> Gaussian model of height<a href="geocentric-model.html#gaussian-model-of-height" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>クンサン族の身長データでモデリングを行う。<br />
データは、Howellらが収集したデータ。身長は18歳以下では年齢と強く相関するので、ひとまず18歳以上を考える。</p>
<div class="sourceCode" id="cb132"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb132-1"><a href="geocentric-model.html#cb132-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(Howell1)</span>
<span id="cb132-2"><a href="geocentric-model.html#cb132-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb132-3"><a href="geocentric-model.html#cb132-3" aria-hidden="true" tabindex="-1"></a>(d <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(Howell1))</span></code></pre></div>
<pre><code>## # A tibble: 544 × 4
##    height weight   age  male
##     &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt;
##  1   152.   47.8    63     1
##  2   140.   36.5    63     0
##  3   137.   31.9    65     0
##  4   157.   53.0    41     1
##  5   145.   41.3    51     0
##  6   164.   63.0    35     1
##  7   149.   38.2    32     0
##  8   169.   55.5    27     1
##  9   148.   34.9    19     0
## 10   165.   54.5    54     1
## # … with 534 more rows</code></pre>
<div class="sourceCode" id="cb134"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb134-1"><a href="geocentric-model.html#cb134-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(d)</span></code></pre></div>
<pre><code>## tibble [544 × 4] (S3: tbl_df/tbl/data.frame)
##  $ height: num [1:544] 152 140 137 157 145 ...
##  $ weight: num [1:544] 47.8 36.5 31.9 53 41.3 ...
##  $ age   : num [1:544] 63 63 65 41 51 35 32 27 19 54 ...
##  $ male  : int [1:544] 1 0 0 1 0 1 0 1 0 1 ...</code></pre>
<div class="sourceCode" id="cb136"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb136-1"><a href="geocentric-model.html#cb136-1" aria-hidden="true" tabindex="-1"></a><span class="fu">precis</span>(d, <span class="at">hist =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<pre><code>##               mean         sd      5.5%     94.5%
## height 138.2635963 27.6024476 81.108550 165.73500
## weight  35.6106176 14.7191782  9.360721  54.50289
## age     29.3443934 20.7468882  1.000000  66.13500
## male     0.4724265  0.4996986  0.000000   1.00000</code></pre>
<div class="sourceCode" id="cb138"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb138-1"><a href="geocentric-model.html#cb138-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 18歳以下に限定</span></span>
<span id="cb138-2"><a href="geocentric-model.html#cb138-2" aria-hidden="true" tabindex="-1"></a>d2 <span class="ot">&lt;-</span> d <span class="sc">%&gt;%</span> </span>
<span id="cb138-3"><a href="geocentric-model.html#cb138-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(age <span class="sc">&gt;=</span> <span class="dv">18</span>)</span></code></pre></div>
<p><br /></p>
<p>身長についてモデリングを行う。</p>
<div class="sourceCode" id="cb139"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb139-1"><a href="geocentric-model.html#cb139-1" aria-hidden="true" tabindex="-1"></a>d2 <span class="sc">%&gt;%</span> </span>
<span id="cb139-2"><a href="geocentric-model.html#cb139-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>height))<span class="sc">+</span></span>
<span id="cb139-3"><a href="geocentric-model.html#cb139-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">binwidth =</span><span class="dv">5</span>, <span class="at">fill=</span><span class="st">&quot;grey92&quot;</span>,<span class="at">color=</span><span class="st">&quot;black&quot;</span>)<span class="sc">+</span></span>
<span id="cb139-4"><a href="geocentric-model.html#cb139-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code></pre></div>
<p><img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-56-1.png" width="672" style="display: block; margin: auto;" />
<br /></p>
<p>身長は正規分布していると思われるため、モデル式は以下の通りとする。</p>
<p><span class="math inline">\(h_{i} \sim Normal(\mu, \sigma)\)</span>
<br /></p>
<p>事前分布は以下のとおりとする。<br />
<span class="math inline">\(\mu \sim Normal(178, 20)\)</span><br />
<span class="math inline">\(\sigma \sim Uniform(0,50)\)</span></p>
<p><br /></p>
<p>事前分布を確認する。</p>
<div class="sourceCode" id="cb140"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb140-1"><a href="geocentric-model.html#cb140-1" aria-hidden="true" tabindex="-1"></a><span class="co"># mu</span></span>
<span id="cb140-2"><a href="geocentric-model.html#cb140-2" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">x =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">100</span>, <span class="at">to =</span> <span class="dv">250</span>, <span class="at">by =</span> .<span class="dv">1</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb140-3"><a href="geocentric-model.html#cb140-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> <span class="fu">dnorm</span>(x, <span class="at">mean =</span> <span class="dv">178</span>, <span class="at">sd =</span> <span class="dv">20</span>))) <span class="sc">+</span></span>
<span id="cb140-4"><a href="geocentric-model.html#cb140-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb140-5"><a href="geocentric-model.html#cb140-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">100</span>, <span class="at">to =</span> <span class="dv">250</span>, <span class="at">by =</span> <span class="dv">75</span>)) <span class="sc">+</span></span>
<span id="cb140-6"><a href="geocentric-model.html#cb140-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;mu ~ dnorm(178, 20)&quot;</span>,<span class="at">y =</span> <span class="st">&quot;density&quot;</span>)</span>
<span id="cb140-7"><a href="geocentric-model.html#cb140-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb140-8"><a href="geocentric-model.html#cb140-8" aria-hidden="true" tabindex="-1"></a>p1</span></code></pre></div>
<p><img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-57-1.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb141"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb141-1"><a href="geocentric-model.html#cb141-1" aria-hidden="true" tabindex="-1"></a><span class="co">#sigma</span></span>
<span id="cb141-2"><a href="geocentric-model.html#cb141-2" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">x =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="sc">-</span><span class="dv">10</span>, <span class="at">to =</span> <span class="dv">60</span>, <span class="at">by =</span> .<span class="dv">1</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb141-3"><a href="geocentric-model.html#cb141-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> <span class="fu">dunif</span>(x, <span class="at">min=</span><span class="dv">0</span>,<span class="at">max=</span><span class="dv">50</span>))) <span class="sc">+</span></span>
<span id="cb141-4"><a href="geocentric-model.html#cb141-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb141-5"><a href="geocentric-model.html#cb141-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">0</span>, <span class="at">to =</span> <span class="dv">50</span>, <span class="at">by =</span> <span class="dv">10</span>)) <span class="sc">+</span></span>
<span id="cb141-6"><a href="geocentric-model.html#cb141-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;sigma ~ dunif(0,50)&quot;</span>,<span class="at">y =</span> <span class="st">&quot;density&quot;</span>)</span>
<span id="cb141-7"><a href="geocentric-model.html#cb141-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb141-8"><a href="geocentric-model.html#cb141-8" aria-hidden="true" tabindex="-1"></a>p2</span></code></pre></div>
<p><img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-57-2.png" width="672" style="display: block; margin: auto;" />
<br /></p>
<p>事前分布からサンプリングをしてみる。</p>
<div class="sourceCode" id="cb142"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb142-1"><a href="geocentric-model.html#cb142-1" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="fl">1e4</span></span>
<span id="cb142-2"><a href="geocentric-model.html#cb142-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">4</span>)</span>
<span id="cb142-3"><a href="geocentric-model.html#cb142-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-4"><a href="geocentric-model.html#cb142-4" aria-hidden="true" tabindex="-1"></a>sim <span class="ot">&lt;-</span> </span>
<span id="cb142-5"><a href="geocentric-model.html#cb142-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="at">sample_mu =</span> <span class="fu">rnorm</span>(n,<span class="dv">178</span>,<span class="dv">20</span>),</span>
<span id="cb142-6"><a href="geocentric-model.html#cb142-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">sample_sigma =</span> <span class="fu">runif</span>(n,<span class="dv">0</span>,<span class="dv">50</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb142-7"><a href="geocentric-model.html#cb142-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">height =</span> <span class="fu">rnorm</span>(n, sample_mu, sample_sigma))</span>
<span id="cb142-8"><a href="geocentric-model.html#cb142-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-9"><a href="geocentric-model.html#cb142-9" aria-hidden="true" tabindex="-1"></a>p3 <span class="ot">&lt;-</span> </span>
<span id="cb142-10"><a href="geocentric-model.html#cb142-10" aria-hidden="true" tabindex="-1"></a>sim <span class="sc">%&gt;%</span> </span>
<span id="cb142-11"><a href="geocentric-model.html#cb142-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>height))<span class="sc">+</span></span>
<span id="cb142-12"><a href="geocentric-model.html#cb142-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">fill=</span><span class="st">&quot;grey33&quot;</span>)<span class="sc">+</span></span>
<span id="cb142-13"><a href="geocentric-model.html#cb142-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">73</span>, <span class="dv">178</span>, <span class="dv">283</span>)) <span class="sc">+</span></span>
<span id="cb142-14"><a href="geocentric-model.html#cb142-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="cn">NULL</span>, <span class="at">breaks =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb142-15"><a href="geocentric-model.html#cb142-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;height ~ dnorm(mu, sigma)&quot;</span>) <span class="sc">+</span></span>
<span id="cb142-16"><a href="geocentric-model.html#cb142-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>())</span>
<span id="cb142-17"><a href="geocentric-model.html#cb142-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-18"><a href="geocentric-model.html#cb142-18" aria-hidden="true" tabindex="-1"></a>p3</span></code></pre></div>
<p><img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-58-1.png" width="672" style="display: block; margin: auto;" />
<br /></p>
<p><span class="math inline">\(\mu \sim Normal(178, 100)\)</span> が事前分布だとすると…</p>
<div class="sourceCode" id="cb143"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb143-1"><a href="geocentric-model.html#cb143-1" aria-hidden="true" tabindex="-1"></a>sim2 <span class="ot">&lt;-</span></span>
<span id="cb143-2"><a href="geocentric-model.html#cb143-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="at">sample_mu    =</span> <span class="fu">rnorm</span>(n, <span class="at">mean =</span> <span class="dv">178</span>, <span class="at">sd =</span> <span class="dv">100</span>),</span>
<span id="cb143-3"><a href="geocentric-model.html#cb143-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">sample_sigma =</span> <span class="fu">runif</span>(n, <span class="at">min =</span> <span class="dv">0</span>, <span class="at">max =</span> <span class="dv">50</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb143-4"><a href="geocentric-model.html#cb143-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">height =</span> <span class="fu">rnorm</span>(n, <span class="at">mean =</span> sample_mu, <span class="at">sd =</span> sample_sigma))</span>
<span id="cb143-5"><a href="geocentric-model.html#cb143-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-6"><a href="geocentric-model.html#cb143-6" aria-hidden="true" tabindex="-1"></a><span class="co"># compute the values we&#39;ll use to break on our x axis</span></span>
<span id="cb143-7"><a href="geocentric-model.html#cb143-7" aria-hidden="true" tabindex="-1"></a>breaks <span class="ot">&lt;-</span></span>
<span id="cb143-8"><a href="geocentric-model.html#cb143-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="fu">mean</span>(sim2<span class="sc">$</span>height) <span class="sc">-</span> <span class="dv">3</span> <span class="sc">*</span> <span class="fu">sd</span>(sim2<span class="sc">$</span>height), <span class="dv">0</span>, <span class="fu">mean</span>(sim2<span class="sc">$</span>height), <span class="fu">mean</span>(sim2<span class="sc">$</span>height) <span class="sc">+</span> <span class="dv">3</span> <span class="sc">*</span> <span class="fu">sd</span>(sim2<span class="sc">$</span>height)) <span class="sc">%&gt;%</span> </span>
<span id="cb143-9"><a href="geocentric-model.html#cb143-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">round</span>(<span class="at">digits =</span> <span class="dv">0</span>)</span>
<span id="cb143-10"><a href="geocentric-model.html#cb143-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-11"><a href="geocentric-model.html#cb143-11" aria-hidden="true" tabindex="-1"></a>text <span class="ot">&lt;-</span></span>
<span id="cb143-12"><a href="geocentric-model.html#cb143-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="at">height =</span> <span class="dv">272-25</span> ,</span>
<span id="cb143-13"><a href="geocentric-model.html#cb143-13" aria-hidden="true" tabindex="-1"></a>         <span class="at">y      =</span> .<span class="dv">0013</span>,</span>
<span id="cb143-14"><a href="geocentric-model.html#cb143-14" aria-hidden="true" tabindex="-1"></a>         <span class="at">label  =</span> <span class="st">&quot;tallest man&quot;</span>,</span>
<span id="cb143-15"><a href="geocentric-model.html#cb143-15" aria-hidden="true" tabindex="-1"></a>         <span class="at">angle  =</span> <span class="dv">90</span>)</span>
<span id="cb143-16"><a href="geocentric-model.html#cb143-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-17"><a href="geocentric-model.html#cb143-17" aria-hidden="true" tabindex="-1"></a>p4 <span class="ot">&lt;-</span></span>
<span id="cb143-18"><a href="geocentric-model.html#cb143-18" aria-hidden="true" tabindex="-1"></a>  sim2 <span class="sc">%&gt;%</span> </span>
<span id="cb143-19"><a href="geocentric-model.html#cb143-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> height)) <span class="sc">+</span></span>
<span id="cb143-20"><a href="geocentric-model.html#cb143-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">fill =</span> <span class="st">&quot;black&quot;</span>, <span class="at">size =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb143-21"><a href="geocentric-model.html#cb143-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">color =</span> <span class="st">&quot;grey92&quot;</span>) <span class="sc">+</span></span>
<span id="cb143-22"><a href="geocentric-model.html#cb143-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">272</span>, <span class="at">color =</span> <span class="st">&quot;grey92&quot;</span>, <span class="at">linetype =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb143-23"><a href="geocentric-model.html#cb143-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">data =</span> text,</span>
<span id="cb143-24"><a href="geocentric-model.html#cb143-24" aria-hidden="true" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">y =</span> y, <span class="at">label =</span> label, <span class="at">angle =</span> angle),</span>
<span id="cb143-25"><a href="geocentric-model.html#cb143-25" aria-hidden="true" tabindex="-1"></a>            <span class="at">color =</span> <span class="st">&quot;grey92&quot;</span>, <span class="at">size =</span> <span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb143-26"><a href="geocentric-model.html#cb143-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> breaks) <span class="sc">+</span></span>
<span id="cb143-27"><a href="geocentric-model.html#cb143-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="cn">NULL</span>, <span class="at">breaks =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb143-28"><a href="geocentric-model.html#cb143-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;height ~ dnorm(mu, sigma)</span><span class="sc">\n</span><span class="st">mu ~ dnorm(178, 100)&quot;</span>) <span class="sc">+</span></span>
<span id="cb143-29"><a href="geocentric-model.html#cb143-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>())</span>
<span id="cb143-30"><a href="geocentric-model.html#cb143-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-31"><a href="geocentric-model.html#cb143-31" aria-hidden="true" tabindex="-1"></a>p4</span></code></pre></div>
<p><img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-59-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>全部並べてみると…。<br />
<span class="math inline">\(\mu\)</span>の事前分布の標準偏差が大きすぎると、身長の事前分布もかなり広くなってしまうことが分かる。身長が負の人や、250cmを越えるような人がいることを仮定していることになる。</p>
<div class="sourceCode" id="cb144"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb144-1"><a href="geocentric-model.html#cb144-1" aria-hidden="true" tabindex="-1"></a>(p1<span class="sc">+</span><span class="fu">xlab</span>(<span class="st">&quot;mu&quot;</span>)<span class="sc">|</span>p2<span class="sc">+</span><span class="fu">xlab</span>(<span class="st">&quot;sigma&quot;</span>))<span class="sc">/</span>(p3<span class="sc">|</span>p4)</span></code></pre></div>
<p><img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-60-1.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb145"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb145-1"><a href="geocentric-model.html#cb145-1" aria-hidden="true" tabindex="-1"></a><span class="co">#身長0未満</span></span>
<span id="cb145-2"><a href="geocentric-model.html#cb145-2" aria-hidden="true" tabindex="-1"></a>sim2 <span class="sc">%&gt;%</span> </span>
<span id="cb145-3"><a href="geocentric-model.html#cb145-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(height <span class="sc">&lt;</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb145-4"><a href="geocentric-model.html#cb145-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">percent =</span> <span class="dv">100</span> <span class="sc">*</span> n <span class="sc">/</span> <span class="fu">sum</span>(n))</span></code></pre></div>
<pre><code>## # A tibble: 2 × 3
##   `height &lt; 0`     n percent
##   &lt;lgl&gt;        &lt;int&gt;   &lt;dbl&gt;
## 1 FALSE         9587   95.9 
## 2 TRUE           413    4.13</code></pre>
<div class="sourceCode" id="cb147"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb147-1"><a href="geocentric-model.html#cb147-1" aria-hidden="true" tabindex="-1"></a><span class="co">#身長250以上</span></span>
<span id="cb147-2"><a href="geocentric-model.html#cb147-2" aria-hidden="true" tabindex="-1"></a>sim2 <span class="sc">%&gt;%</span> </span>
<span id="cb147-3"><a href="geocentric-model.html#cb147-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(height <span class="sc">&gt;=</span><span class="dv">250</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb147-4"><a href="geocentric-model.html#cb147-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">percent =</span> <span class="dv">100</span> <span class="sc">*</span> n <span class="sc">/</span> <span class="fu">sum</span>(n))</span></code></pre></div>
<pre><code>## # A tibble: 2 × 3
##   `height &gt;= 250`     n percent
##   &lt;lgl&gt;           &lt;int&gt;   &lt;dbl&gt;
## 1 FALSE            7443    74.4
## 2 TRUE             2557    25.6</code></pre>
<p><br /></p>
</div>
<div id="grid-approximationで事後分布を描く" class="section level2 hasAnchor" number="4.4">
<h2><span class="header-section-number">4.4</span> Grid approximationで事後分布を描く<a href="geocentric-model.html#grid-approximationで事後分布を描く" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>計算には対数尤度を用い、その後戻す。</p>
<div class="sourceCode" id="cb149"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb149-1"><a href="geocentric-model.html#cb149-1" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">200</span></span>
<span id="cb149-2"><a href="geocentric-model.html#cb149-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-3"><a href="geocentric-model.html#cb149-3" aria-hidden="true" tabindex="-1"></a>d_grid <span class="ot">&lt;-</span> </span>
<span id="cb149-4"><a href="geocentric-model.html#cb149-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">crossing</span>(<span class="at">mu =</span> <span class="fu">seq</span>(<span class="dv">140</span>,<span class="dv">160</span>,<span class="at">length.out=</span>n),</span>
<span id="cb149-5"><a href="geocentric-model.html#cb149-5" aria-hidden="true" tabindex="-1"></a>           <span class="at">sigma =</span> <span class="fu">seq</span>(<span class="dv">4</span>,<span class="dv">9</span>,<span class="at">length.out=</span>n))</span>
<span id="cb149-6"><a href="geocentric-model.html#cb149-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-7"><a href="geocentric-model.html#cb149-7" aria-hidden="true" tabindex="-1"></a>grid_function <span class="ot">&lt;-</span> <span class="cf">function</span>(mu,sigma){</span>
<span id="cb149-8"><a href="geocentric-model.html#cb149-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dnorm</span>(d2<span class="sc">$</span>height, <span class="at">mean =</span> mu, <span class="at">sd =</span> sigma, <span class="at">log =</span> T) <span class="sc">%&gt;%</span> </span>
<span id="cb149-9"><a href="geocentric-model.html#cb149-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sum</span>()</span>
<span id="cb149-10"><a href="geocentric-model.html#cb149-10" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb149-11"><a href="geocentric-model.html#cb149-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-12"><a href="geocentric-model.html#cb149-12" aria-hidden="true" tabindex="-1"></a>d_grid <span class="ot">&lt;-</span></span>
<span id="cb149-13"><a href="geocentric-model.html#cb149-13" aria-hidden="true" tabindex="-1"></a>  d_grid <span class="sc">%&gt;%</span> </span>
<span id="cb149-14"><a href="geocentric-model.html#cb149-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">LL =</span> <span class="fu">map2</span>(mu, sigma, grid_function)) <span class="sc">%&gt;%</span> </span>
<span id="cb149-15"><a href="geocentric-model.html#cb149-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(LL) <span class="sc">%&gt;%</span> </span>
<span id="cb149-16"><a href="geocentric-model.html#cb149-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prod =</span> LL <span class="sc">+</span> <span class="fu">dnorm</span>(mu, <span class="dv">178</span>,<span class="dv">20</span>,<span class="cn">TRUE</span>)<span class="sc">+</span></span>
<span id="cb149-17"><a href="geocentric-model.html#cb149-17" aria-hidden="true" tabindex="-1"></a>           <span class="fu">dunif</span>(sigma,<span class="dv">0</span>,<span class="dv">50</span>,<span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb149-18"><a href="geocentric-model.html#cb149-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">prob =</span> <span class="fu">exp</span>(prod<span class="sc">-</span><span class="fu">max</span>(prod)))</span></code></pre></div>
<p><br /></p>
<p>事後同時分布を表すと以下のようになる。</p>
<div class="sourceCode" id="cb150"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb150-1"><a href="geocentric-model.html#cb150-1" aria-hidden="true" tabindex="-1"></a>d_grid <span class="sc">%&gt;%</span> </span>
<span id="cb150-2"><a href="geocentric-model.html#cb150-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>mu, <span class="at">y=</span>sigma, <span class="at">z =</span> prob))<span class="sc">+</span></span>
<span id="cb150-3"><a href="geocentric-model.html#cb150-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_contour</span>()<span class="sc">+</span></span>
<span id="cb150-4"><a href="geocentric-model.html#cb150-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x=</span><span class="fu">expression</span>(mu),<span class="at">y=</span><span class="fu">expression</span>(sigma))<span class="sc">+</span></span>
<span id="cb150-5"><a href="geocentric-model.html#cb150-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">range</span>(d_grid<span class="sc">$</span>mu),</span>
<span id="cb150-6"><a href="geocentric-model.html#cb150-6" aria-hidden="true" tabindex="-1"></a>                  <span class="at">ylim=</span><span class="fu">range</span>(d_grid<span class="sc">$</span>sigma))<span class="sc">+</span></span>
<span id="cb150-7"><a href="geocentric-model.html#cb150-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>())</span></code></pre></div>
<p><img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-63-1.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb151"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb151-1"><a href="geocentric-model.html#cb151-1" aria-hidden="true" tabindex="-1"></a>d_grid <span class="sc">%&gt;%</span> </span>
<span id="cb151-2"><a href="geocentric-model.html#cb151-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> mu, <span class="at">y =</span> sigma, <span class="at">fill =</span> prob)) <span class="sc">+</span> </span>
<span id="cb151-3"><a href="geocentric-model.html#cb151-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_raster</span>(<span class="at">interpolate =</span> F) <span class="sc">+</span></span>
<span id="cb151-4"><a href="geocentric-model.html#cb151-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_c</span>(<span class="at">option =</span> <span class="st">&quot;B&quot;</span>) <span class="sc">+</span></span>
<span id="cb151-5"><a href="geocentric-model.html#cb151-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="fu">expression</span>(mu),</span>
<span id="cb151-6"><a href="geocentric-model.html#cb151-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="fu">expression</span>(sigma)) <span class="sc">+</span></span>
<span id="cb151-7"><a href="geocentric-model.html#cb151-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>())</span></code></pre></div>
<p><img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-63-2.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb152"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb152-1"><a href="geocentric-model.html#cb152-1" aria-hidden="true" tabindex="-1"></a><span class="co">#ちなみに</span></span>
<span id="cb152-2"><a href="geocentric-model.html#cb152-2" aria-hidden="true" tabindex="-1"></a>d_grid <span class="sc">%&gt;%</span> </span>
<span id="cb152-3"><a href="geocentric-model.html#cb152-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(prob<span class="sc">==</span><span class="fu">max</span>(prob))</span></code></pre></div>
<pre><code>## # A tibble: 1 × 5
##      mu sigma     LL   prod  prob
##   &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;
## 1  155.  7.74 -1219. -1228.     1</code></pre>
<div id="事後分布からサンプリングする" class="section level3 hasAnchor" number="4.4.1">
<h3><span class="header-section-number">4.4.1</span> 事後分布からサンプリングする<a href="geocentric-model.html#事後分布からサンプリングする" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb154"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb154-1"><a href="geocentric-model.html#cb154-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">4</span>)</span>
<span id="cb154-2"><a href="geocentric-model.html#cb154-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb154-3"><a href="geocentric-model.html#cb154-3" aria-hidden="true" tabindex="-1"></a>samples_d <span class="ot">&lt;-</span> </span>
<span id="cb154-4"><a href="geocentric-model.html#cb154-4" aria-hidden="true" tabindex="-1"></a>  d_grid <span class="sc">%&gt;%</span> </span>
<span id="cb154-5"><a href="geocentric-model.html#cb154-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_sample</span>(<span class="at">n=</span><span class="fl">1e4</span>, <span class="at">weight_by =</span> prob, <span class="at">replace=</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p><span class="math inline">\(\mu\)</span>と<span class="math inline">\(\sigma\)</span>の事後分布からのサンプルより</p>
<div class="sourceCode" id="cb155"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb155-1"><a href="geocentric-model.html#cb155-1" aria-hidden="true" tabindex="-1"></a><span class="co"># muの区間推定</span></span>
<span id="cb155-2"><a href="geocentric-model.html#cb155-2" aria-hidden="true" tabindex="-1"></a><span class="fu">bind_rows</span>(<span class="fu">median_hdi</span>(samples_d<span class="sc">$</span>mu, <span class="at">.width=</span><span class="fl">0.95</span>),</span>
<span id="cb155-3"><a href="geocentric-model.html#cb155-3" aria-hidden="true" tabindex="-1"></a>          <span class="fu">mean_qi</span>(samples_d<span class="sc">$</span>mu, <span class="at">.width=</span><span class="fl">0.95</span>))</span></code></pre></div>
<pre><code>##          y     ymin     ymax .width .point .interval
## 1 154.5729 153.6683 155.2764   0.95 median       hdi
## 2 154.6041 153.7688 155.3769   0.95   mean        qi</code></pre>
<div class="sourceCode" id="cb157"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb157-1"><a href="geocentric-model.html#cb157-1" aria-hidden="true" tabindex="-1"></a><span class="co">#sigmaの区間推定</span></span>
<span id="cb157-2"><a href="geocentric-model.html#cb157-2" aria-hidden="true" tabindex="-1"></a><span class="fu">bind_rows</span>(<span class="fu">median_hdi</span>(samples_d<span class="sc">$</span>sigma, <span class="at">.width=</span><span class="fl">0.95</span>),</span>
<span id="cb157-3"><a href="geocentric-model.html#cb157-3" aria-hidden="true" tabindex="-1"></a>          <span class="fu">mean_qi</span>(samples_d<span class="sc">$</span>sigma, <span class="at">.width=</span><span class="fl">0.95</span>))</span></code></pre></div>
<pre><code>##          y     ymin     ymax .width .point .interval
## 1 7.768844 7.140704 8.296482   0.95 median       hdi
## 2 7.769450 7.216080 8.371859   0.95   mean        qi</code></pre>
<div class="sourceCode" id="cb159"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb159-1"><a href="geocentric-model.html#cb159-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 同時分布</span></span>
<span id="cb159-2"><a href="geocentric-model.html#cb159-2" aria-hidden="true" tabindex="-1"></a>samples_d <span class="sc">%&gt;%</span> </span>
<span id="cb159-3"><a href="geocentric-model.html#cb159-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>mu, <span class="at">y=</span>sigma))<span class="sc">+</span></span>
<span id="cb159-4"><a href="geocentric-model.html#cb159-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size=</span><span class="fl">0.9</span>,<span class="at">alpha=</span><span class="dv">1</span><span class="sc">/</span><span class="dv">30</span>)<span class="sc">+</span></span>
<span id="cb159-5"><a href="geocentric-model.html#cb159-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x=</span><span class="fu">expression</span>(mu[samples]),<span class="at">y=</span><span class="fu">expression</span>(sigma[samples]))<span class="sc">+</span></span>
<span id="cb159-6"><a href="geocentric-model.html#cb159-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>())</span></code></pre></div>
<p><img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-65-1.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb160"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb160-1"><a href="geocentric-model.html#cb160-1" aria-hidden="true" tabindex="-1"></a><span class="co"># それぞれの周辺事後分布</span></span>
<span id="cb160-2"><a href="geocentric-model.html#cb160-2" aria-hidden="true" tabindex="-1"></a>samples_d <span class="sc">%&gt;%</span> </span>
<span id="cb160-3"><a href="geocentric-model.html#cb160-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> mu<span class="sc">:</span>sigma, <span class="at">names_to =</span> <span class="st">&quot;param&quot;</span>, <span class="at">values_to =</span> <span class="st">&quot;value&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb160-4"><a href="geocentric-model.html#cb160-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>value))<span class="sc">+</span></span>
<span id="cb160-5"><a href="geocentric-model.html#cb160-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">binwidth=</span><span class="fl">0.1</span>,<span class="at">fill=</span><span class="st">&quot;grey33&quot;</span>)<span class="sc">+</span></span>
<span id="cb160-6"><a href="geocentric-model.html#cb160-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="cn">NULL</span>, <span class="at">breaks =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb160-7"><a href="geocentric-model.html#cb160-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb160-8"><a href="geocentric-model.html#cb160-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>())<span class="sc">+</span></span>
<span id="cb160-9"><a href="geocentric-model.html#cb160-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>param, <span class="at">scale=</span><span class="st">&quot;free&quot;</span>,<span class="at">labeller =</span> label_parsed)</span></code></pre></div>
<p><img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-65-2.png" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="rethinking" class="section level3 hasAnchor" number="4.4.2">
<h3><span class="header-section-number">4.4.2</span> rethinking<a href="geocentric-model.html#rethinking" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb161"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb161-1"><a href="geocentric-model.html#cb161-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">4</span>)</span>
<span id="cb161-2"><a href="geocentric-model.html#cb161-2" aria-hidden="true" tabindex="-1"></a>(d3 <span class="ot">&lt;-</span> <span class="fu">sample</span>(d2<span class="sc">$</span>height, <span class="at">size =</span> <span class="dv">20</span>))</span></code></pre></div>
<pre><code>##  [1] 147.3200 154.9400 168.9100 156.8450 165.7350 151.7650 165.7350 156.2100
##  [9] 144.7800 154.9400 151.1300 147.9550 149.8600 162.5600 161.9250 164.4650
## [17] 160.9852 151.7650 163.8300 149.8600</code></pre>
<div class="sourceCode" id="cb163"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb163-1"><a href="geocentric-model.html#cb163-1" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">200</span></span>
<span id="cb163-2"><a href="geocentric-model.html#cb163-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-3"><a href="geocentric-model.html#cb163-3" aria-hidden="true" tabindex="-1"></a><span class="co"># note we&#39;ve redefined the ranges of `mu` and `sigma`</span></span>
<span id="cb163-4"><a href="geocentric-model.html#cb163-4" aria-hidden="true" tabindex="-1"></a>d_grid <span class="ot">&lt;-</span></span>
<span id="cb163-5"><a href="geocentric-model.html#cb163-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">crossing</span>(<span class="at">mu=</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">150</span>,<span class="at">to =</span> <span class="dv">170</span>,<span class="at">length.out=</span> n),</span>
<span id="cb163-6"><a href="geocentric-model.html#cb163-6" aria-hidden="true" tabindex="-1"></a>           <span class="at">sigma =</span><span class="fu">seq</span>(<span class="at">from =</span><span class="dv">4</span>, <span class="at">to =</span> <span class="dv">20</span>,<span class="at">length.out=</span> n))</span>
<span id="cb163-7"><a href="geocentric-model.html#cb163-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-8"><a href="geocentric-model.html#cb163-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-9"><a href="geocentric-model.html#cb163-9" aria-hidden="true" tabindex="-1"></a>grid_function <span class="ot">&lt;-</span> <span class="cf">function</span>(mu, sigma) {</span>
<span id="cb163-10"><a href="geocentric-model.html#cb163-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb163-11"><a href="geocentric-model.html#cb163-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dnorm</span>(d3, <span class="at">mean =</span> mu, <span class="at">sd =</span> sigma, <span class="at">log =</span> T) <span class="sc">%&gt;%</span> </span>
<span id="cb163-12"><a href="geocentric-model.html#cb163-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sum</span>()</span>
<span id="cb163-13"><a href="geocentric-model.html#cb163-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb163-14"><a href="geocentric-model.html#cb163-14" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb163-15"><a href="geocentric-model.html#cb163-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-16"><a href="geocentric-model.html#cb163-16" aria-hidden="true" tabindex="-1"></a>d_grid <span class="ot">&lt;-</span></span>
<span id="cb163-17"><a href="geocentric-model.html#cb163-17" aria-hidden="true" tabindex="-1"></a>  d_grid <span class="sc">%&gt;%</span> </span>
<span id="cb163-18"><a href="geocentric-model.html#cb163-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">log_likelihood =</span> <span class="fu">map2_dbl</span>(mu, sigma, grid_function)) <span class="sc">%&gt;%</span> </span>
<span id="cb163-19"><a href="geocentric-model.html#cb163-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prior_mu    =</span> <span class="fu">dnorm</span>(mu, <span class="at">mean =</span> <span class="dv">178</span>, <span class="at">sd =</span> <span class="dv">20</span>, <span class="at">log =</span> T),</span>
<span id="cb163-20"><a href="geocentric-model.html#cb163-20" aria-hidden="true" tabindex="-1"></a>         <span class="at">prior_sigma =</span> <span class="fu">dunif</span>(sigma, <span class="at">min =</span> <span class="dv">0</span>, <span class="at">max =</span> <span class="dv">50</span>, <span class="at">log =</span> T)) <span class="sc">%&gt;%</span> </span>
<span id="cb163-21"><a href="geocentric-model.html#cb163-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">product =</span> log_likelihood <span class="sc">+</span> prior_mu <span class="sc">+</span> prior_sigma) <span class="sc">%&gt;%</span> </span>
<span id="cb163-22"><a href="geocentric-model.html#cb163-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">probability =</span> <span class="fu">exp</span>(product <span class="sc">-</span> <span class="fu">max</span>(product)))</span>
<span id="cb163-23"><a href="geocentric-model.html#cb163-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-24"><a href="geocentric-model.html#cb163-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-25"><a href="geocentric-model.html#cb163-25" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">4</span>)</span>
<span id="cb163-26"><a href="geocentric-model.html#cb163-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-27"><a href="geocentric-model.html#cb163-27" aria-hidden="true" tabindex="-1"></a>d_grid_samples <span class="ot">&lt;-</span> </span>
<span id="cb163-28"><a href="geocentric-model.html#cb163-28" aria-hidden="true" tabindex="-1"></a>  d_grid <span class="sc">%&gt;%</span> </span>
<span id="cb163-29"><a href="geocentric-model.html#cb163-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sample_n</span>(<span class="at">size =</span> <span class="fl">1e4</span>, <span class="at">replace =</span> <span class="cn">TRUE</span>, <span class="at">weight =</span> probability)</span>
<span id="cb163-30"><a href="geocentric-model.html#cb163-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-31"><a href="geocentric-model.html#cb163-31" aria-hidden="true" tabindex="-1"></a>d_grid_samples <span class="sc">%&gt;%</span> </span>
<span id="cb163-32"><a href="geocentric-model.html#cb163-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> mu, <span class="at">y =</span> sigma)) <span class="sc">+</span> </span>
<span id="cb163-33"><a href="geocentric-model.html#cb163-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> .<span class="dv">9</span>, <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">15</span>) <span class="sc">+</span></span>
<span id="cb163-34"><a href="geocentric-model.html#cb163-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="fu">expression</span>(mu[samples]),</span>
<span id="cb163-35"><a href="geocentric-model.html#cb163-35" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="fu">expression</span>(sigma[samples])) <span class="sc">+</span></span>
<span id="cb163-36"><a href="geocentric-model.html#cb163-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>())</span></code></pre></div>
<p><img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-66-1.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb164"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb164-1"><a href="geocentric-model.html#cb164-1" aria-hidden="true" tabindex="-1"></a>d_grid_samples <span class="sc">%&gt;%</span> </span>
<span id="cb164-2"><a href="geocentric-model.html#cb164-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(mu<span class="sc">:</span>sigma) <span class="sc">%&gt;%</span> </span>
<span id="cb164-3"><a href="geocentric-model.html#cb164-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb164-4"><a href="geocentric-model.html#cb164-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> value)) <span class="sc">+</span> </span>
<span id="cb164-5"><a href="geocentric-model.html#cb164-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">fill =</span> <span class="st">&quot;grey33&quot;</span>, <span class="at">size =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb164-6"><a href="geocentric-model.html#cb164-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="cn">NULL</span>, <span class="at">breaks =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb164-7"><a href="geocentric-model.html#cb164-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb164-8"><a href="geocentric-model.html#cb164-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb164-9"><a href="geocentric-model.html#cb164-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> name, <span class="at">scales =</span> <span class="st">&quot;free&quot;</span>, <span class="at">labeller =</span> label_parsed)</span></code></pre></div>
<p><img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-66-2.png" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="finding-posterior-with-brms" class="section level3 hasAnchor" number="4.4.3">
<h3><span class="header-section-number">4.4.3</span> Finding posterior with brms<a href="geocentric-model.html#finding-posterior-with-brms" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>quapとbrmsを用いてモデリングを行う。</p>
<div class="sourceCode" id="cb165"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb165-1"><a href="geocentric-model.html#cb165-1" aria-hidden="true" tabindex="-1"></a><span class="co"># quap</span></span>
<span id="cb165-2"><a href="geocentric-model.html#cb165-2" aria-hidden="true" tabindex="-1"></a><span class="co">#flist &lt;- alist(</span></span>
<span id="cb165-3"><a href="geocentric-model.html#cb165-3" aria-hidden="true" tabindex="-1"></a>  <span class="co">#height ~ dnorm(mu,sigma),</span></span>
<span id="cb165-4"><a href="geocentric-model.html#cb165-4" aria-hidden="true" tabindex="-1"></a>  <span class="co">#mu ~ dnorm(178,20),</span></span>
<span id="cb165-5"><a href="geocentric-model.html#cb165-5" aria-hidden="true" tabindex="-1"></a>  <span class="co">#sigma ~ dunif(0,50)</span></span>
<span id="cb165-6"><a href="geocentric-model.html#cb165-6" aria-hidden="true" tabindex="-1"></a><span class="co">#)</span></span>
<span id="cb165-7"><a href="geocentric-model.html#cb165-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb165-8"><a href="geocentric-model.html#cb165-8" aria-hidden="true" tabindex="-1"></a><span class="co">#m4.1 &lt;- quap(flist, data=d2)</span></span>
<span id="cb165-9"><a href="geocentric-model.html#cb165-9" aria-hidden="true" tabindex="-1"></a><span class="co">#precis(m4.1, prob=.95)</span></span>
<span id="cb165-10"><a href="geocentric-model.html#cb165-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb165-11"><a href="geocentric-model.html#cb165-11" aria-hidden="true" tabindex="-1"></a><span class="co"># brms</span></span>
<span id="cb165-12"><a href="geocentric-model.html#cb165-12" aria-hidden="true" tabindex="-1"></a>b4<span class="fl">.1</span> <span class="ot">&lt;-</span> </span>
<span id="cb165-13"><a href="geocentric-model.html#cb165-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">brm</span>(</span>
<span id="cb165-14"><a href="geocentric-model.html#cb165-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> d2,</span>
<span id="cb165-15"><a href="geocentric-model.html#cb165-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">family =</span> gaussian,</span>
<span id="cb165-16"><a href="geocentric-model.html#cb165-16" aria-hidden="true" tabindex="-1"></a>    height <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb165-17"><a href="geocentric-model.html#cb165-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">178</span>,<span class="dv">20</span>),<span class="at">class=</span>Intercept),</span>
<span id="cb165-18"><a href="geocentric-model.html#cb165-18" aria-hidden="true" tabindex="-1"></a>              <span class="fu">prior</span>(<span class="fu">cauchy</span>(<span class="dv">0</span>,<span class="dv">1</span>), <span class="at">class=</span>sigma)),</span>
<span id="cb165-19"><a href="geocentric-model.html#cb165-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">iter=</span><span class="dv">2000</span>,<span class="at">warmup=</span><span class="dv">1000</span>,<span class="at">chains =</span><span class="dv">4</span>,</span>
<span id="cb165-20"><a href="geocentric-model.html#cb165-20" aria-hidden="true" tabindex="-1"></a>      <span class="at">backend =</span> <span class="st">&quot;cmdstanr&quot;</span>,</span>
<span id="cb165-21"><a href="geocentric-model.html#cb165-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">file =</span> <span class="st">&quot;output/Chapter4/b4.1&quot;</span>)</span>
<span id="cb165-22"><a href="geocentric-model.html#cb165-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb165-23"><a href="geocentric-model.html#cb165-23" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(b4<span class="fl">.1</span>)</span></code></pre></div>
<p><img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-67-1.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb166"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb166-1"><a href="geocentric-model.html#cb166-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(b4<span class="fl">.1</span>)</span></code></pre></div>
<pre><code>##  Family: gaussian 
##   Links: mu = identity; sigma = identity 
## Formula: height ~ 1 
##    Data: d2 (Number of observations: 352) 
##   Draws: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
##          total post-warmup draws = 4000
## 
## Population-Level Effects: 
##           Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## Intercept   154.61      0.41   153.79   155.40 1.00     2887     2135
## 
## Family Specific Parameters: 
##       Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## sigma     7.76      0.29     7.21     8.33 1.00     3084     2478
## 
## Draws were sampled using sample(hmc). For each parameter, Bulk_ESS
## and Tail_ESS are effective sample size measures, and Rhat is the potential
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<div class="sourceCode" id="cb168"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb168-1"><a href="geocentric-model.html#cb168-1" aria-hidden="true" tabindex="-1"></a>b4<span class="fl">.1</span><span class="sc">$</span>fit</span></code></pre></div>
<pre><code>## Inference for Stan model: model_c19008bf3f2b9c2a33b512b5e1155c58-202301301453-1-5f89bc.
## 4 chains, each with iter=2000; warmup=1000; thin=1; 
## post-warmup draws per chain=1000, total post-warmup draws=4000.
## 
##                 mean se_mean   sd     2.5%      25%      50%      75%    97.5%
## b_Intercept   154.61    0.01 0.41   153.79   154.34   154.61   154.88   155.40
## sigma           7.76    0.01 0.29     7.21     7.56     7.75     7.94     8.33
## lprior         -9.16    0.00 0.08    -9.31    -9.21    -9.16    -9.11    -9.01
## lp__        -1227.48    0.02 0.99 -1230.19 -1227.83 -1227.16 -1226.80 -1226.55
##             n_eff Rhat
## b_Intercept  2844    1
## sigma        2963    1
## lprior       2886    1
## lp__         1685    1
## 
## Samples were drawn using NUTS(diag_e) at 月 1 30 14:53:45 2023.
## For each parameter, n_eff is a crude measure of effective sample size,
## and Rhat is the potential scale reduction factor on split chains (at 
## convergence, Rhat=1).</code></pre>
<p><br /></p>
<p>続いて、<span class="math inline">\(\mu\)</span>の事前分布の標準偏差を0.1にしてみる。<br />
かなり事前分布に引っ張られていることが分かる。</p>
<div class="sourceCode" id="cb170"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb170-1"><a href="geocentric-model.html#cb170-1" aria-hidden="true" tabindex="-1"></a>b4<span class="fl">.1</span>_2 <span class="ot">&lt;-</span> </span>
<span id="cb170-2"><a href="geocentric-model.html#cb170-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">brm</span>(</span>
<span id="cb170-3"><a href="geocentric-model.html#cb170-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> d2,</span>
<span id="cb170-4"><a href="geocentric-model.html#cb170-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">family =</span> gaussian,</span>
<span id="cb170-5"><a href="geocentric-model.html#cb170-5" aria-hidden="true" tabindex="-1"></a>    height <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb170-6"><a href="geocentric-model.html#cb170-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">178</span>,<span class="fl">0.1</span>),<span class="at">class=</span>Intercept),</span>
<span id="cb170-7"><a href="geocentric-model.html#cb170-7" aria-hidden="true" tabindex="-1"></a>              <span class="fu">prior</span>(<span class="fu">cauchy</span>(<span class="dv">0</span>,<span class="dv">1</span>), <span class="at">class=</span>sigma)),</span>
<span id="cb170-8"><a href="geocentric-model.html#cb170-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">iter=</span><span class="dv">2000</span>,<span class="at">warmup=</span><span class="dv">1000</span>,<span class="at">chains =</span><span class="dv">4</span>,</span>
<span id="cb170-9"><a href="geocentric-model.html#cb170-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">backend =</span> <span class="st">&quot;cmdstanr&quot;</span>,</span>
<span id="cb170-10"><a href="geocentric-model.html#cb170-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">file =</span> <span class="st">&quot;output/Chapter4/b4.1_2&quot;</span></span>
<span id="cb170-11"><a href="geocentric-model.html#cb170-11" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb170-12"><a href="geocentric-model.html#cb170-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-13"><a href="geocentric-model.html#cb170-13" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(b4<span class="fl">.1</span>_2)</span></code></pre></div>
<p><img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-68-1.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb171"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb171-1"><a href="geocentric-model.html#cb171-1" aria-hidden="true" tabindex="-1"></a>b4<span class="fl">.1</span>_2<span class="sc">$</span>fit</span></code></pre></div>
<pre><code>## Inference for Stan model: model_103b53ece11c4e90bdd855611995b123-202301301453-1-4680b3.
## 4 chains, each with iter=2000; warmup=1000; thin=1; 
## post-warmup draws per chain=1000, total post-warmup draws=4000.
## 
##                 mean se_mean   sd     2.5%      25%      50%      75%    97.5%
## b_Intercept   177.86    0.00 0.10   177.67   177.80   177.86   177.93   178.06
## sigma          24.56    0.02 0.94    22.83    23.91    24.54    25.19    26.50
## lprior         -6.89    0.03 1.50   -10.98    -7.54    -6.41    -5.76    -5.44
## lp__        -1629.83    0.02 0.97 -1632.47 -1630.21 -1629.54 -1629.14 -1628.88
##             n_eff Rhat
## b_Intercept  3304    1
## sigma        3542    1
## lprior       2965    1
## lp__         1597    1
## 
## Samples were drawn using NUTS(diag_e) at 月 1 30 14:53:56 2023.
## For each parameter, n_eff is a crude measure of effective sample size,
## and Rhat is the potential scale reduction factor on split chains (at 
## convergence, Rhat=1).</code></pre>
<div class="sourceCode" id="cb173"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb173-1"><a href="geocentric-model.html#cb173-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 比較</span></span>
<span id="cb173-2"><a href="geocentric-model.html#cb173-2" aria-hidden="true" tabindex="-1"></a><span class="fu">rbind</span>(<span class="fu">summary</span>(b4<span class="fl">.1</span>)<span class="sc">$</span>fixed,</span>
<span id="cb173-3"><a href="geocentric-model.html#cb173-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">summary</span>(b4<span class="fl">.1</span>_2)<span class="sc">$</span>fixed)</span></code></pre></div>
<pre><code>##            Estimate  Est.Error l-95% CI u-95% CI     Rhat Bulk_ESS Tail_ESS
## Intercept  154.6066 0.40866177  153.789  155.398 1.001184 2887.360 2135.154
## Intercept1 177.8636 0.09863163  177.668  178.055 1.001800 3314.509 2476.818</code></pre>
</div>
<div id="事後分布からのサンプリング" class="section level3 hasAnchor" number="4.4.4">
<h3><span class="header-section-number">4.4.4</span> 事後分布からのサンプリング<a href="geocentric-model.html#事後分布からのサンプリング" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>MCMCではすでにサンプリングを行っている。</p>
<div class="sourceCode" id="cb175"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb175-1"><a href="geocentric-model.html#cb175-1" aria-hidden="true" tabindex="-1"></a>post <span class="ot">&lt;-</span> <span class="fu">posterior_samples</span>(b4<span class="fl">.1</span>)</span>
<span id="cb175-2"><a href="geocentric-model.html#cb175-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-3"><a href="geocentric-model.html#cb175-3" aria-hidden="true" tabindex="-1"></a><span class="co"># 分散・共分散行列</span></span>
<span id="cb175-4"><a href="geocentric-model.html#cb175-4" aria-hidden="true" tabindex="-1"></a>post <span class="sc">%&gt;%</span> </span>
<span id="cb175-5"><a href="geocentric-model.html#cb175-5" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(b_Intercept, sigma) <span class="sc">%&gt;%</span> </span>
<span id="cb175-6"><a href="geocentric-model.html#cb175-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cov</span>()</span></code></pre></div>
<pre><code>##              b_Intercept        sigma
## b_Intercept  0.167004444 -0.002765798
## sigma       -0.002765798  0.081405458</code></pre>
<div class="sourceCode" id="cb177"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb177-1"><a href="geocentric-model.html#cb177-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 相関行列</span></span>
<span id="cb177-2"><a href="geocentric-model.html#cb177-2" aria-hidden="true" tabindex="-1"></a>post <span class="sc">%&gt;%</span> </span>
<span id="cb177-3"><a href="geocentric-model.html#cb177-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(b_Intercept, sigma) <span class="sc">%&gt;%</span> </span>
<span id="cb177-4"><a href="geocentric-model.html#cb177-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cor</span>()</span></code></pre></div>
<pre><code>##             b_Intercept       sigma
## b_Intercept  1.00000000 -0.02372082
## sigma       -0.02372082  1.00000000</code></pre>
<div class="sourceCode" id="cb179"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb179-1"><a href="geocentric-model.html#cb179-1" aria-hidden="true" tabindex="-1"></a><span class="co"># summary of the samples</span></span>
<span id="cb179-2"><a href="geocentric-model.html#cb179-2" aria-hidden="true" tabindex="-1"></a>post <span class="sc">%&gt;%</span></span>
<span id="cb179-3"><a href="geocentric-model.html#cb179-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span>lp__) <span class="sc">%&gt;%</span> </span>
<span id="cb179-4"><a href="geocentric-model.html#cb179-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(name) <span class="sc">%&gt;%</span></span>
<span id="cb179-5"><a href="geocentric-model.html#cb179-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean =</span> <span class="fu">mean</span>(value),</span>
<span id="cb179-6"><a href="geocentric-model.html#cb179-6" aria-hidden="true" tabindex="-1"></a>            <span class="at">sd   =</span> <span class="fu">sd</span>(value),</span>
<span id="cb179-7"><a href="geocentric-model.html#cb179-7" aria-hidden="true" tabindex="-1"></a>            <span class="st">`</span><span class="at">2.5%</span><span class="st">`</span>  <span class="ot">=</span> <span class="fu">quantile</span>(value, <span class="at">probs =</span> .<span class="dv">025</span>),</span>
<span id="cb179-8"><a href="geocentric-model.html#cb179-8" aria-hidden="true" tabindex="-1"></a>            <span class="st">`</span><span class="at">97.5%</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">quantile</span>(value, <span class="at">probs =</span> .<span class="dv">975</span>))</span></code></pre></div>
<pre><code>## # A tibble: 3 × 5
##   name          mean     sd `2.5%` `97.5%`
##   &lt;chr&gt;        &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;
## 1 b_Intercept 155.   0.409  154.    155.  
## 2 lprior       -9.16 0.0767  -9.31   -9.01
## 3 sigma         7.76 0.285    7.21    8.33</code></pre>
</div>
</div>
<div id="linear-prediction" class="section level2 hasAnchor" number="4.5">
<h2><span class="header-section-number">4.5</span> Linear prediction<a href="geocentric-model.html#linear-prediction" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>身長と体重の関係をモデリングする。<br />
両者の間には強い相関がある。</p>
<div class="sourceCode" id="cb181"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb181-1"><a href="geocentric-model.html#cb181-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(d2,<span class="fu">aes</span>(<span class="at">x=</span>weight,<span class="at">y=</span>height))<span class="sc">+</span></span>
<span id="cb181-2"><a href="geocentric-model.html#cb181-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">shape=</span><span class="dv">1</span>,<span class="at">size=</span><span class="dv">2</span>)<span class="sc">+</span></span>
<span id="cb181-3"><a href="geocentric-model.html#cb181-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb181-4"><a href="geocentric-model.html#cb181-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>())</span></code></pre></div>
<p><img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-70-1.png" width="672" style="display: block; margin: auto;" />
<br /></p>
<p>以下のモデルを考える。<br />
<span class="math inline">\(h_{i} \sim Normal(\mu_{i}, \sigma)\)</span><br />
<span class="math inline">\(\mu_{i} = \alpha + \beta(x_{i}-\bar{x})\)</span><br />
<span class="math inline">\(\alpha \sim Normal(172, 20)\)</span><br />
<span class="math inline">\(\beta \sim Normal(0, 10)\)</span><br />
<span class="math inline">\(\sigma \sim Uniform(0, 50)\)</span><br />
<br /></p>
<p>事前分布からサンプリングした<span class="math inline">\(\alpha\)</span>と<span class="math inline">\(\beta\)</span>について回帰直線を引いてみる。</p>
<div class="sourceCode" id="cb182"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb182-1"><a href="geocentric-model.html#cb182-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">2971</span>)</span>
<span id="cb182-2"><a href="geocentric-model.html#cb182-2" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb182-3"><a href="geocentric-model.html#cb182-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb182-4"><a href="geocentric-model.html#cb182-4" aria-hidden="true" tabindex="-1"></a>lines <span class="ot">&lt;-</span></span>
<span id="cb182-5"><a href="geocentric-model.html#cb182-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="at">n =</span> <span class="dv">1</span><span class="sc">:</span>n,</span>
<span id="cb182-6"><a href="geocentric-model.html#cb182-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">a =</span> <span class="fu">rnorm</span>(n, <span class="at">mean =</span> <span class="dv">178</span>, <span class="at">sd =</span> <span class="dv">20</span>),</span>
<span id="cb182-7"><a href="geocentric-model.html#cb182-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">b =</span> <span class="fu">rnorm</span>(n, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="dv">10</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb182-8"><a href="geocentric-model.html#cb182-8" aria-hidden="true" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">expand</span>(<span class="fu">nesting</span>(n, a, b), <span class="at">weight =</span> <span class="fu">range</span>(d2<span class="sc">$</span>weight)) <span class="sc">%&gt;%</span> </span>
<span id="cb182-9"><a href="geocentric-model.html#cb182-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">height =</span> a <span class="sc">+</span> b <span class="sc">*</span> (weight <span class="sc">-</span> <span class="fu">mean</span>(d2<span class="sc">$</span>weight)))</span>
<span id="cb182-10"><a href="geocentric-model.html#cb182-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb182-11"><a href="geocentric-model.html#cb182-11" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(lines)</span></code></pre></div>
<pre><code>## # A tibble: 6 × 5
##       n     a      b weight height
##   &lt;int&gt; &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;
## 1     1  191. -7.06    31.1  289. 
## 2     1  191. -7.06    63.0   63.5
## 3     2  199.  0.839   31.1  187. 
## 4     2  199.  0.839   63.0  214. 
## 5     3  202.  3.93    31.1  147. 
## 6     3  202.  3.93    63.0  272.</code></pre>
<div class="sourceCode" id="cb184"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb184-1"><a href="geocentric-model.html#cb184-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 直線を引く</span></span>
<span id="cb184-2"><a href="geocentric-model.html#cb184-2" aria-hidden="true" tabindex="-1"></a>lines <span class="sc">%&gt;%</span> </span>
<span id="cb184-3"><a href="geocentric-model.html#cb184-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>weight, <span class="at">y=</span>height, <span class="at">group =</span> n))<span class="sc">+</span></span>
<span id="cb184-4"><a href="geocentric-model.html#cb184-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">alpha=</span><span class="dv">1</span><span class="sc">/</span><span class="dv">4</span>)<span class="sc">+</span></span>
<span id="cb184-5"><a href="geocentric-model.html#cb184-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">272</span>), <span class="at">linetype =</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">1</span>), <span class="at">size =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">3</span>)<span class="sc">+</span></span>
<span id="cb184-6"><a href="geocentric-model.html#cb184-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="st">&quot;weight&quot;</span>, <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">30</span>,<span class="dv">60</span>,<span class="dv">10</span>))<span class="sc">+</span></span>
<span id="cb184-7"><a href="geocentric-model.html#cb184-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="st">&quot;height&quot;</span>, <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">100</span>,<span class="dv">400</span>,<span class="dv">100</span>))<span class="sc">+</span></span>
<span id="cb184-8"><a href="geocentric-model.html#cb184-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">100</span>,<span class="dv">400</span>))<span class="sc">+</span></span>
<span id="cb184-9"><a href="geocentric-model.html#cb184-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;b ~ dnorm(0,10)&quot;</span>)<span class="sc">+</span></span>
<span id="cb184-10"><a href="geocentric-model.html#cb184-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()<span class="sc">+</span></span>
<span id="cb184-11"><a href="geocentric-model.html#cb184-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">aspect.ratio=</span><span class="dv">1</span>)</span></code></pre></div>
<p><img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-71-1.png" width="672" style="display: block; margin: auto;" />
<br /></p>
<p>身長と体重の関係はマイナスではないと分かっている場合、不適切である。<br />
そこで、Log-Normalを用いる。
$ Log-Normal(0, 1)$</p>
<div class="sourceCode" id="cb185"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb185-1"><a href="geocentric-model.html#cb185-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">4</span>)</span>
<span id="cb185-2"><a href="geocentric-model.html#cb185-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb185-3"><a href="geocentric-model.html#cb185-3" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">b =</span> <span class="fu">rlnorm</span>(<span class="fl">1e4</span>, <span class="at">mean =</span><span class="dv">0</span>, <span class="at">sd =</span><span class="dv">1</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb185-4"><a href="geocentric-model.html#cb185-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>b))<span class="sc">+</span></span>
<span id="cb185-5"><a href="geocentric-model.html#cb185-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">fill=</span><span class="st">&quot;grey92&quot;</span>)<span class="sc">+</span></span>
<span id="cb185-6"><a href="geocentric-model.html#cb185-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">5</span>))<span class="sc">+</span></span>
<span id="cb185-7"><a href="geocentric-model.html#cb185-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()<span class="sc">+</span></span>
<span id="cb185-8"><a href="geocentric-model.html#cb185-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">aspect.ratio=</span><span class="fl">0.8</span>)</span></code></pre></div>
<p><img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-72-1.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb186"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb186-1"><a href="geocentric-model.html#cb186-1" aria-hidden="true" tabindex="-1"></a><span class="co"># シミュレーション</span></span>
<span id="cb186-2"><a href="geocentric-model.html#cb186-2" aria-hidden="true" tabindex="-1"></a>lines_2 <span class="ot">&lt;-</span></span>
<span id="cb186-3"><a href="geocentric-model.html#cb186-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="at">n =</span> <span class="dv">1</span><span class="sc">:</span>n,</span>
<span id="cb186-4"><a href="geocentric-model.html#cb186-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">a =</span> <span class="fu">rnorm</span>(n, <span class="at">mean =</span> <span class="dv">178</span>, <span class="at">sd =</span> <span class="dv">20</span>),</span>
<span id="cb186-5"><a href="geocentric-model.html#cb186-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">b =</span> <span class="fu">rlnorm</span>(n, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="dv">1</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb186-6"><a href="geocentric-model.html#cb186-6" aria-hidden="true" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">expand</span>(<span class="fu">nesting</span>(n, a, b), <span class="at">weight =</span> <span class="fu">range</span>(d2<span class="sc">$</span>weight)) <span class="sc">%&gt;%</span> </span>
<span id="cb186-7"><a href="geocentric-model.html#cb186-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">height =</span> a <span class="sc">+</span> b <span class="sc">*</span> (weight <span class="sc">-</span> <span class="fu">mean</span>(d2<span class="sc">$</span>weight)))</span>
<span id="cb186-8"><a href="geocentric-model.html#cb186-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-9"><a href="geocentric-model.html#cb186-9" aria-hidden="true" tabindex="-1"></a>text <span class="ot">&lt;-</span></span>
<span id="cb186-10"><a href="geocentric-model.html#cb186-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="at">weight =</span> <span class="fu">c</span>(<span class="dv">34</span>, <span class="dv">43</span>),</span>
<span id="cb186-11"><a href="geocentric-model.html#cb186-11" aria-hidden="true" tabindex="-1"></a>         <span class="at">height =</span> <span class="fu">c</span>(<span class="dv">0</span> <span class="sc">-</span> <span class="dv">25</span>, <span class="dv">272</span> <span class="sc">+</span> <span class="dv">25</span>),</span>
<span id="cb186-12"><a href="geocentric-model.html#cb186-12" aria-hidden="true" tabindex="-1"></a>         <span class="at">label  =</span> <span class="fu">c</span>(<span class="st">&quot;Embryo&quot;</span>, <span class="st">&quot;World&#39;s tallest person (272 cm)&quot;</span>))</span>
<span id="cb186-13"><a href="geocentric-model.html#cb186-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-14"><a href="geocentric-model.html#cb186-14" aria-hidden="true" tabindex="-1"></a>lines_2 <span class="sc">%&gt;%</span> </span>
<span id="cb186-15"><a href="geocentric-model.html#cb186-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>weight, <span class="at">y=</span>height, <span class="at">group =</span> n))<span class="sc">+</span></span>
<span id="cb186-16"><a href="geocentric-model.html#cb186-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">alpha=</span><span class="dv">1</span><span class="sc">/</span><span class="dv">4</span>)<span class="sc">+</span></span>
<span id="cb186-17"><a href="geocentric-model.html#cb186-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">272</span>), <span class="at">linetype =</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">1</span>), <span class="at">size =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">3</span>)<span class="sc">+</span></span>
<span id="cb186-18"><a href="geocentric-model.html#cb186-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="st">&quot;weight&quot;</span>, <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">30</span>,<span class="dv">60</span>,<span class="dv">10</span>))<span class="sc">+</span></span>
<span id="cb186-19"><a href="geocentric-model.html#cb186-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="st">&quot;height&quot;</span>, <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">100</span>,<span class="dv">400</span>,<span class="dv">100</span>))<span class="sc">+</span></span>
<span id="cb186-20"><a href="geocentric-model.html#cb186-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">100</span>,<span class="dv">400</span>))<span class="sc">+</span></span>
<span id="cb186-21"><a href="geocentric-model.html#cb186-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;b ~ dnorm(0,10)&quot;</span>)<span class="sc">+</span></span>
<span id="cb186-22"><a href="geocentric-model.html#cb186-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()<span class="sc">+</span></span>
<span id="cb186-23"><a href="geocentric-model.html#cb186-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">data =</span> text,</span>
<span id="cb186-24"><a href="geocentric-model.html#cb186-24" aria-hidden="true" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">label =</span> label),</span>
<span id="cb186-25"><a href="geocentric-model.html#cb186-25" aria-hidden="true" tabindex="-1"></a>            <span class="at">size =</span> <span class="dv">3</span>)<span class="sc">+</span></span>
<span id="cb186-26"><a href="geocentric-model.html#cb186-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">aspect.ratio=</span><span class="dv">1</span>)</span></code></pre></div>
<p><img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-72-2.png" width="672" style="display: block; margin: auto;" />
<br /></p>
<div id="finding-the-posterior-distribution" class="section level3 hasAnchor" number="4.5.1">
<h3><span class="header-section-number">4.5.1</span> Finding the posterior distribution<a href="geocentric-model.html#finding-the-posterior-distribution" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>brmsで事後分布を求める。<br />
quapとほとんど同じ結果が得られた。
<br /></p>
<div class="sourceCode" id="cb187"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb187-1"><a href="geocentric-model.html#cb187-1" aria-hidden="true" tabindex="-1"></a>d2 <span class="ot">&lt;-</span></span>
<span id="cb187-2"><a href="geocentric-model.html#cb187-2" aria-hidden="true" tabindex="-1"></a>  d2 <span class="sc">%&gt;%</span> </span>
<span id="cb187-3"><a href="geocentric-model.html#cb187-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">weight_c =</span> weight <span class="sc">-</span> <span class="fu">mean</span>(weight))</span>
<span id="cb187-4"><a href="geocentric-model.html#cb187-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb187-5"><a href="geocentric-model.html#cb187-5" aria-hidden="true" tabindex="-1"></a>b4<span class="fl">.3</span> <span class="ot">&lt;-</span> </span>
<span id="cb187-6"><a href="geocentric-model.html#cb187-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">brm</span>(<span class="at">data =</span> d2, </span>
<span id="cb187-7"><a href="geocentric-model.html#cb187-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> gaussian,</span>
<span id="cb187-8"><a href="geocentric-model.html#cb187-8" aria-hidden="true" tabindex="-1"></a>      height <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> weight_c,</span>
<span id="cb187-9"><a href="geocentric-model.html#cb187-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">178</span>, <span class="dv">20</span>),<span class="at">clas =</span>Intercept),</span>
<span id="cb187-10"><a href="geocentric-model.html#cb187-10" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">lognormal</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">class =</span> b,<span class="at">lb=</span><span class="dv">0</span>),</span>
<span id="cb187-11"><a href="geocentric-model.html#cb187-11" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">cauchy</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">class =</span> sigma)),</span>
<span id="cb187-12"><a href="geocentric-model.html#cb187-12" aria-hidden="true" tabindex="-1"></a>      <span class="at">iter =</span> <span class="dv">28000</span>, <span class="at">warmup =</span> <span class="dv">27000</span>, <span class="at">chains =</span> <span class="dv">4</span>, </span>
<span id="cb187-13"><a href="geocentric-model.html#cb187-13" aria-hidden="true" tabindex="-1"></a>      <span class="at">cores =</span> <span class="dv">4</span>, <span class="at">seed =</span> <span class="dv">4</span>,</span>
<span id="cb187-14"><a href="geocentric-model.html#cb187-14" aria-hidden="true" tabindex="-1"></a>      <span class="at">backend =</span> <span class="st">&quot;cmdstanr&quot;</span>,</span>
<span id="cb187-15"><a href="geocentric-model.html#cb187-15" aria-hidden="true" tabindex="-1"></a>      <span class="at">file=</span><span class="st">&quot;output/Chapter4/b4.3&quot;</span>)</span>
<span id="cb187-16"><a href="geocentric-model.html#cb187-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb187-17"><a href="geocentric-model.html#cb187-17" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(b4<span class="fl">.3</span>)<span class="sc">$</span>fixed</span></code></pre></div>
<pre><code>##              Estimate  Est.Error    l-95% CI    u-95% CI     Rhat Bulk_ESS
## Intercept 154.5946177 0.27665537 154.0470000 155.1260250 1.000155 4416.690
## weight_c    0.9026185 0.04256141   0.8202094   0.9849504 1.000944 4799.085
##           Tail_ESS
## Intercept 3229.642
## weight_c  3261.045</code></pre>
<div class="sourceCode" id="cb189"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb189-1"><a href="geocentric-model.html#cb189-1" aria-hidden="true" tabindex="-1"></a>sample <span class="ot">&lt;-</span> <span class="fu">posterior_samples</span>(b4<span class="fl">.3</span>) </span>
<span id="cb189-2"><a href="geocentric-model.html#cb189-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb189-3"><a href="geocentric-model.html#cb189-3" aria-hidden="true" tabindex="-1"></a>sample <span class="sc">%&gt;%</span> </span>
<span id="cb189-4"><a href="geocentric-model.html#cb189-4" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>lp__) <span class="sc">%&gt;%</span> </span>
<span id="cb189-5"><a href="geocentric-model.html#cb189-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb189-6"><a href="geocentric-model.html#cb189-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(name) <span class="sc">%&gt;%</span> </span>
<span id="cb189-7"><a href="geocentric-model.html#cb189-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean =</span> <span class="fu">mean</span>(value),</span>
<span id="cb189-8"><a href="geocentric-model.html#cb189-8" aria-hidden="true" tabindex="-1"></a>            <span class="at">sd   =</span> <span class="fu">sd</span>(value),</span>
<span id="cb189-9"><a href="geocentric-model.html#cb189-9" aria-hidden="true" tabindex="-1"></a>            <span class="st">`</span><span class="at">2.5%</span><span class="st">`</span>  <span class="ot">=</span> <span class="fu">quantile</span>(value, <span class="at">probs =</span> .<span class="dv">055</span>),</span>
<span id="cb189-10"><a href="geocentric-model.html#cb189-10" aria-hidden="true" tabindex="-1"></a>            <span class="st">`</span><span class="at">97.5%</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">quantile</span>(value, <span class="at">probs =</span> .<span class="dv">945</span>))</span></code></pre></div>
<pre><code>## # A tibble: 3 × 5
##   name           mean     sd  `2.5%` `97.5%`
##   &lt;chr&gt;         &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;
## 1 b_Intercept 155.    0.277  154.    155.   
## 2 b_weight_c    0.903 0.0426   0.834   0.970
## 3 sigma         5.09  0.195    4.80    5.41</code></pre>
<p><br /></p>
<p>パラメータ間の相関はなさそう。</p>
<div class="sourceCode" id="cb191"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb191-1"><a href="geocentric-model.html#cb191-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 共分散</span></span>
<span id="cb191-2"><a href="geocentric-model.html#cb191-2" aria-hidden="true" tabindex="-1"></a>sample <span class="sc">%&gt;%</span> </span>
<span id="cb191-3"><a href="geocentric-model.html#cb191-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>lp__) <span class="sc">%&gt;%</span> </span>
<span id="cb191-4"><a href="geocentric-model.html#cb191-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cov</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb191-5"><a href="geocentric-model.html#cb191-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">round</span>(<span class="at">digits=</span><span class="dv">3</span>)</span></code></pre></div>
<pre><code>##             b_Intercept b_weight_c  sigma lprior
## b_Intercept       0.077      0.000  0.000  0.004
## b_weight_c        0.000      0.002  0.000 -0.002
## sigma             0.000      0.000  0.038 -0.014
## lprior            0.004     -0.002 -0.014  0.007</code></pre>
<div class="sourceCode" id="cb193"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb193-1"><a href="geocentric-model.html#cb193-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ヒストグラムと散布図</span></span>
<span id="cb193-2"><a href="geocentric-model.html#cb193-2" aria-hidden="true" tabindex="-1"></a><span class="fu">pairs</span>(b4<span class="fl">.3</span>)</span></code></pre></div>
<p><img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-74-1.png" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="plotting-posterior-inference-agaist-the-data" class="section level3 hasAnchor" number="4.5.2">
<h3><span class="header-section-number">4.5.2</span> Plotting posterior inference agaist the data<a href="geocentric-model.html#plotting-posterior-inference-agaist-the-data" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>事後分布の平均を用いて回帰直線を引く。</p>
<div class="sourceCode" id="cb194"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb194-1"><a href="geocentric-model.html#cb194-1" aria-hidden="true" tabindex="-1"></a>d2 <span class="sc">%&gt;%</span> </span>
<span id="cb194-2"><a href="geocentric-model.html#cb194-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>weight_c,<span class="at">y=</span>height))<span class="sc">+</span></span>
<span id="cb194-3"><a href="geocentric-model.html#cb194-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size=</span><span class="dv">2</span>,<span class="at">shape=</span><span class="dv">1</span>, <span class="at">color=</span><span class="st">&quot;royalblue&quot;</span>)<span class="sc">+</span></span>
<span id="cb194-4"><a href="geocentric-model.html#cb194-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">intercept =</span> <span class="fu">mean</span>(sample<span class="sc">$</span>b_Intercept),</span>
<span id="cb194-5"><a href="geocentric-model.html#cb194-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">slope =</span> <span class="fu">mean</span>(sample<span class="sc">$</span>b_weight_c))<span class="sc">+</span></span>
<span id="cb194-6"><a href="geocentric-model.html#cb194-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()<span class="sc">+</span></span>
<span id="cb194-7"><a href="geocentric-model.html#cb194-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">aspect.ratio=</span><span class="dv">1</span>)</span></code></pre></div>
<p><img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-75-1.png" width="672" style="display: block; margin: auto;" />
<br /></p>
<p>最初のN行だけを用いてモデリングしてみる。</p>
<div class="sourceCode" id="cb195"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb195-1"><a href="geocentric-model.html#cb195-1" aria-hidden="true" tabindex="-1"></a>N <span class="ot">&lt;-</span> <span class="dv">10</span></span>
<span id="cb195-2"><a href="geocentric-model.html#cb195-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb195-3"><a href="geocentric-model.html#cb195-3" aria-hidden="true" tabindex="-1"></a>b4<span class="fl">.3</span>_10 <span class="ot">&lt;-</span> </span>
<span id="cb195-4"><a href="geocentric-model.html#cb195-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">brm</span>(<span class="at">data =</span> d2 <span class="sc">%&gt;%</span> </span>
<span id="cb195-5"><a href="geocentric-model.html#cb195-5" aria-hidden="true" tabindex="-1"></a>        <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span>N), </span>
<span id="cb195-6"><a href="geocentric-model.html#cb195-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> gaussian,</span>
<span id="cb195-7"><a href="geocentric-model.html#cb195-7" aria-hidden="true" tabindex="-1"></a>      height <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> weight_c,</span>
<span id="cb195-8"><a href="geocentric-model.html#cb195-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">178</span>, <span class="dv">20</span>),<span class="at">class=</span>Intercept),</span>
<span id="cb195-9"><a href="geocentric-model.html#cb195-9" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">lognormal</span>(<span class="dv">0</span>,<span class="dv">1</span>),<span class="at">class =</span>b,<span class="at">lb=</span><span class="dv">0</span>),</span>
<span id="cb195-10"><a href="geocentric-model.html#cb195-10" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">cauchy</span>(<span class="dv">0</span>, <span class="dv">1</span>),<span class="at">class =</span> sigma)),</span>
<span id="cb195-11"><a href="geocentric-model.html#cb195-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">iter =</span> <span class="dv">11000</span>, <span class="at">warmup =</span> <span class="dv">10000</span>, <span class="at">chains =</span> <span class="dv">4</span>, </span>
<span id="cb195-12"><a href="geocentric-model.html#cb195-12" aria-hidden="true" tabindex="-1"></a>      <span class="at">backend =</span> <span class="st">&quot;cmdstanr&quot;</span>,</span>
<span id="cb195-13"><a href="geocentric-model.html#cb195-13" aria-hidden="true" tabindex="-1"></a>      <span class="at">file =</span> <span class="st">&quot;output/Chapter4/b4.3_10&quot;</span>,</span>
<span id="cb195-14"><a href="geocentric-model.html#cb195-14" aria-hidden="true" tabindex="-1"></a>      <span class="at">cores =</span> <span class="dv">4</span>, <span class="at">seed =</span> <span class="dv">4</span>)</span>
<span id="cb195-15"><a href="geocentric-model.html#cb195-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb195-16"><a href="geocentric-model.html#cb195-16" aria-hidden="true" tabindex="-1"></a>N <span class="ot">&lt;-</span> <span class="dv">50</span></span>
<span id="cb195-17"><a href="geocentric-model.html#cb195-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb195-18"><a href="geocentric-model.html#cb195-18" aria-hidden="true" tabindex="-1"></a>b4<span class="fl">.3</span>_50 <span class="ot">&lt;-</span> </span>
<span id="cb195-19"><a href="geocentric-model.html#cb195-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">brm</span>(<span class="at">data =</span> d2 <span class="sc">%&gt;%</span> </span>
<span id="cb195-20"><a href="geocentric-model.html#cb195-20" aria-hidden="true" tabindex="-1"></a>        <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span>N), </span>
<span id="cb195-21"><a href="geocentric-model.html#cb195-21" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> gaussian,</span>
<span id="cb195-22"><a href="geocentric-model.html#cb195-22" aria-hidden="true" tabindex="-1"></a>      height <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> weight_c,</span>
<span id="cb195-23"><a href="geocentric-model.html#cb195-23" aria-hidden="true" tabindex="-1"></a>      <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">178</span>, <span class="dv">20</span>),<span class="at">class=</span>Intercept),</span>
<span id="cb195-24"><a href="geocentric-model.html#cb195-24" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">lognormal</span>(<span class="dv">0</span>,<span class="dv">1</span>),<span class="at">class =</span>b,<span class="at">lb=</span><span class="dv">0</span>),</span>
<span id="cb195-25"><a href="geocentric-model.html#cb195-25" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">cauchy</span>(<span class="dv">0</span>, <span class="dv">1</span>),<span class="at">class =</span> sigma)),</span>
<span id="cb195-26"><a href="geocentric-model.html#cb195-26" aria-hidden="true" tabindex="-1"></a>      <span class="at">iter =</span> <span class="dv">11000</span>, <span class="at">warmup =</span> <span class="dv">10000</span>, <span class="at">chains =</span> <span class="dv">4</span>, </span>
<span id="cb195-27"><a href="geocentric-model.html#cb195-27" aria-hidden="true" tabindex="-1"></a>      <span class="at">backend =</span> <span class="st">&quot;cmdstanr&quot;</span>,</span>
<span id="cb195-28"><a href="geocentric-model.html#cb195-28" aria-hidden="true" tabindex="-1"></a>      <span class="at">file =</span> <span class="st">&quot;output/Chapter4/b4.3_50&quot;</span>,</span>
<span id="cb195-29"><a href="geocentric-model.html#cb195-29" aria-hidden="true" tabindex="-1"></a>      <span class="at">cores =</span> <span class="dv">4</span>, <span class="at">seed =</span> <span class="dv">4</span>)</span>
<span id="cb195-30"><a href="geocentric-model.html#cb195-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb195-31"><a href="geocentric-model.html#cb195-31" aria-hidden="true" tabindex="-1"></a>N <span class="ot">&lt;-</span> <span class="dv">150</span></span>
<span id="cb195-32"><a href="geocentric-model.html#cb195-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb195-33"><a href="geocentric-model.html#cb195-33" aria-hidden="true" tabindex="-1"></a>b4<span class="fl">.3</span>_150 <span class="ot">&lt;-</span> </span>
<span id="cb195-34"><a href="geocentric-model.html#cb195-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">brm</span>(<span class="at">data =</span> d2 <span class="sc">%&gt;%</span> </span>
<span id="cb195-35"><a href="geocentric-model.html#cb195-35" aria-hidden="true" tabindex="-1"></a>        <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span>N), </span>
<span id="cb195-36"><a href="geocentric-model.html#cb195-36" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> gaussian,</span>
<span id="cb195-37"><a href="geocentric-model.html#cb195-37" aria-hidden="true" tabindex="-1"></a>      height <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> weight_c,</span>
<span id="cb195-38"><a href="geocentric-model.html#cb195-38" aria-hidden="true" tabindex="-1"></a>      <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">178</span>, <span class="dv">20</span>),<span class="at">class=</span>Intercept),</span>
<span id="cb195-39"><a href="geocentric-model.html#cb195-39" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">lognormal</span>(<span class="dv">0</span>,<span class="dv">1</span>),<span class="at">class =</span>b,<span class="at">lb=</span><span class="dv">0</span>),</span>
<span id="cb195-40"><a href="geocentric-model.html#cb195-40" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">cauchy</span>(<span class="dv">0</span>, <span class="dv">1</span>),<span class="at">class =</span> sigma)),</span>
<span id="cb195-41"><a href="geocentric-model.html#cb195-41" aria-hidden="true" tabindex="-1"></a>      <span class="at">iter =</span> <span class="dv">11000</span>, <span class="at">warmup =</span> <span class="dv">10000</span>, <span class="at">chains =</span> <span class="dv">4</span>, </span>
<span id="cb195-42"><a href="geocentric-model.html#cb195-42" aria-hidden="true" tabindex="-1"></a>      <span class="at">backend =</span> <span class="st">&quot;cmdstanr&quot;</span>,</span>
<span id="cb195-43"><a href="geocentric-model.html#cb195-43" aria-hidden="true" tabindex="-1"></a>      <span class="at">file =</span> <span class="st">&quot;output/Chapter4/b4.3_150&quot;</span>,</span>
<span id="cb195-44"><a href="geocentric-model.html#cb195-44" aria-hidden="true" tabindex="-1"></a>      <span class="at">cores =</span> <span class="dv">4</span>, <span class="at">seed =</span> <span class="dv">4</span>)</span></code></pre></div>
<p><br /></p>
<p>それぞれの事後分布から20サンプルずつを抽出して回帰直線を書く。もともとのN数が多いほど、回帰直線のばらつきは小さくなっていることが分かる。</p>
<div class="sourceCode" id="cb196"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb196-1"><a href="geocentric-model.html#cb196-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 20サンプルを抽出</span></span>
<span id="cb196-2"><a href="geocentric-model.html#cb196-2" aria-hidden="true" tabindex="-1"></a>sample_10 <span class="ot">&lt;-</span> <span class="fu">sample_n</span>(<span class="fu">posterior_samples</span>(b4<span class="fl">.3</span>_10),</span>
<span id="cb196-3"><a href="geocentric-model.html#cb196-3" aria-hidden="true" tabindex="-1"></a>                      <span class="at">size=</span><span class="dv">20</span>, <span class="at">replace=</span><span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb196-4"><a href="geocentric-model.html#cb196-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">n=</span><span class="fu">rep</span>(<span class="dv">10</span>,<span class="dv">20</span>))</span>
<span id="cb196-5"><a href="geocentric-model.html#cb196-5" aria-hidden="true" tabindex="-1"></a>sample_50 <span class="ot">&lt;-</span> <span class="fu">sample_n</span>(<span class="fu">posterior_samples</span>(b4<span class="fl">.3</span>_50),</span>
<span id="cb196-6"><a href="geocentric-model.html#cb196-6" aria-hidden="true" tabindex="-1"></a>                      <span class="at">size=</span><span class="dv">20</span>, <span class="at">replace=</span><span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb196-7"><a href="geocentric-model.html#cb196-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">n=</span><span class="fu">rep</span>(<span class="dv">50</span>,<span class="dv">20</span>))</span>
<span id="cb196-8"><a href="geocentric-model.html#cb196-8" aria-hidden="true" tabindex="-1"></a>sample_150 <span class="ot">&lt;-</span> <span class="fu">sample_n</span>(<span class="fu">posterior_samples</span>(b4<span class="fl">.3</span>_150),</span>
<span id="cb196-9"><a href="geocentric-model.html#cb196-9" aria-hidden="true" tabindex="-1"></a>                      <span class="at">size=</span><span class="dv">20</span>, <span class="at">replace=</span><span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb196-10"><a href="geocentric-model.html#cb196-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">n=</span><span class="fu">rep</span>(<span class="dv">150</span>,<span class="dv">20</span>))</span>
<span id="cb196-11"><a href="geocentric-model.html#cb196-11" aria-hidden="true" tabindex="-1"></a>sample_392 <span class="ot">&lt;-</span> <span class="fu">sample_n</span>(sample,<span class="at">size=</span><span class="dv">20</span>,<span class="at">replace=</span><span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb196-12"><a href="geocentric-model.html#cb196-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">n=</span><span class="fu">rep</span>(<span class="dv">392</span>,<span class="dv">20</span>))</span>
<span id="cb196-13"><a href="geocentric-model.html#cb196-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb196-14"><a href="geocentric-model.html#cb196-14" aria-hidden="true" tabindex="-1"></a>sample_all <span class="ot">&lt;-</span> <span class="fu">rbind</span>(sample_10,sample_50,sample_150,sample_392) <span class="sc">%&gt;%</span> </span>
<span id="cb196-15"><a href="geocentric-model.html#cb196-15" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>lp__,<span class="sc">-</span>sigma) <span class="sc">%&gt;%</span> </span>
<span id="cb196-16"><a href="geocentric-model.html#cb196-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">alpha =</span> b_Intercept, <span class="at">beta =</span> b_weight_c)</span>
<span id="cb196-17"><a href="geocentric-model.html#cb196-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb196-18"><a href="geocentric-model.html#cb196-18" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="fu">c</span>(<span class="dv">10</span>,<span class="dv">50</span>,<span class="dv">150</span>,<span class="dv">392</span>)){</span>
<span id="cb196-19"><a href="geocentric-model.html#cb196-19" aria-hidden="true" tabindex="-1"></a>sample_n <span class="ot">&lt;-</span> sample_all <span class="sc">%&gt;%</span> </span>
<span id="cb196-20"><a href="geocentric-model.html#cb196-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(n<span class="sc">==</span>i)</span>
<span id="cb196-21"><a href="geocentric-model.html#cb196-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb196-22"><a href="geocentric-model.html#cb196-22" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> </span>
<span id="cb196-23"><a href="geocentric-model.html#cb196-23" aria-hidden="true" tabindex="-1"></a>  d2 <span class="sc">%&gt;%</span> </span>
<span id="cb196-24"><a href="geocentric-model.html#cb196-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span>i) <span class="sc">%&gt;%</span> </span>
<span id="cb196-25"><a href="geocentric-model.html#cb196-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>weight_c,<span class="at">y=</span>height))<span class="sc">+</span></span>
<span id="cb196-26"><a href="geocentric-model.html#cb196-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size=</span><span class="dv">2</span>,<span class="at">shape=</span><span class="dv">1</span>, <span class="at">color=</span><span class="st">&quot;royalblue&quot;</span>)<span class="sc">+</span></span>
<span id="cb196-27"><a href="geocentric-model.html#cb196-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">intercept =</span> sample_n<span class="sc">$</span>alpha,</span>
<span id="cb196-28"><a href="geocentric-model.html#cb196-28" aria-hidden="true" tabindex="-1"></a>              <span class="at">slope =</span> sample_n<span class="sc">$</span>beta,</span>
<span id="cb196-29"><a href="geocentric-model.html#cb196-29" aria-hidden="true" tabindex="-1"></a>              <span class="at">size=</span><span class="dv">1</span><span class="sc">/</span><span class="dv">3</span>, <span class="at">alpha=</span><span class="dv">1</span><span class="sc">/</span><span class="dv">3</span>)<span class="sc">+</span></span>
<span id="cb196-30"><a href="geocentric-model.html#cb196-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()<span class="sc">+</span></span>
<span id="cb196-31"><a href="geocentric-model.html#cb196-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">aspect.ratio=</span><span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb196-32"><a href="geocentric-model.html#cb196-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="fu">str_c</span>(<span class="st">&quot;N =&quot;</span>, i))</span>
<span id="cb196-33"><a href="geocentric-model.html#cb196-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb196-34"><a href="geocentric-model.html#cb196-34" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(p)</span>
<span id="cb196-35"><a href="geocentric-model.html#cb196-35" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p><img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-77-1.png" width="672" style="display: block; margin: auto;" /><img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-77-2.png" width="672" style="display: block; margin: auto;" /><img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-77-3.png" width="672" style="display: block; margin: auto;" /><img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-77-4.png" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="plotting-regression-intervals-and-contours" class="section level3 hasAnchor" number="4.5.3">
<h3><span class="header-section-number">4.5.3</span> Plotting regression intervals and contours<a href="geocentric-model.html#plotting-regression-intervals-and-contours" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><span class="math inline">\(\mu\)</span>についての事後分布を確認する。<br />
それぞれの体重（<span class="math inline">\(x_{i}\)</span>）における<span class="math inline">\(\mu\)</span>の事後分布をサンプリングする。</p>
<div class="sourceCode" id="cb197"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb197-1"><a href="geocentric-model.html#cb197-1" aria-hidden="true" tabindex="-1"></a>sample <span class="ot">&lt;-</span> <span class="fu">rename</span>(sample,<span class="at">alpha=</span>b_Intercept, </span>
<span id="cb197-2"><a href="geocentric-model.html#cb197-2" aria-hidden="true" tabindex="-1"></a>                 <span class="at">beta =</span> b_weight_c)</span>
<span id="cb197-3"><a href="geocentric-model.html#cb197-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb197-4"><a href="geocentric-model.html#cb197-4" aria-hidden="true" tabindex="-1"></a>xbar <span class="ot">&lt;-</span> <span class="fu">mean</span>(d2<span class="sc">$</span>weight)</span>
<span id="cb197-5"><a href="geocentric-model.html#cb197-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb197-6"><a href="geocentric-model.html#cb197-6" aria-hidden="true" tabindex="-1"></a><span class="co"># xi = 50におけるmuの事後分布からのサンプル</span></span>
<span id="cb197-7"><a href="geocentric-model.html#cb197-7" aria-hidden="true" tabindex="-1"></a>mu_at_50 <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">mu_50 =</span> sample<span class="sc">$</span>alpha <span class="sc">+</span> sample<span class="sc">$</span>beta<span class="sc">*</span>(<span class="dv">50</span><span class="sc">-</span>xbar))</span>
<span id="cb197-8"><a href="geocentric-model.html#cb197-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb197-9"><a href="geocentric-model.html#cb197-9" aria-hidden="true" tabindex="-1"></a>(qi <span class="ot">&lt;-</span> <span class="fu">mean_qi</span>(mu_at_50, <span class="at">.width=</span>.<span class="dv">89</span>))</span></code></pre></div>
<pre><code>## # A tibble: 1 × 6
##   mu_50 .lower .upper .width .point .interval
##   &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;    
## 1  159.   159.   160.   0.89 mean   qi</code></pre>
<div class="sourceCode" id="cb199"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb199-1"><a href="geocentric-model.html#cb199-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(mu_at_50,<span class="fu">aes</span>(<span class="at">x=</span>mu_50))<span class="sc">+</span></span>
<span id="cb199-2"><a href="geocentric-model.html#cb199-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>()</span></code></pre></div>
<p><img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-78-1.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb200"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb200-1"><a href="geocentric-model.html#cb200-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 全てのxiについてmuの事後分布を算出</span></span>
<span id="cb200-2"><a href="geocentric-model.html#cb200-2" aria-hidden="true" tabindex="-1"></a>mu <span class="ot">&lt;-</span> <span class="fu">fitted</span>(b4<span class="fl">.3</span>, <span class="at">summary=</span>F)</span>
<span id="cb200-3"><a href="geocentric-model.html#cb200-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb200-4"><a href="geocentric-model.html#cb200-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 任意のxiについても作成できる</span></span>
<span id="cb200-5"><a href="geocentric-model.html#cb200-5" aria-hidden="true" tabindex="-1"></a>weight_seq <span class="ot">&lt;-</span> </span>
<span id="cb200-6"><a href="geocentric-model.html#cb200-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="at">weight =</span> <span class="dv">25</span><span class="sc">:</span><span class="dv">75</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb200-7"><a href="geocentric-model.html#cb200-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">weight_c =</span> weight <span class="sc">-</span> <span class="fu">mean</span>(d2<span class="sc">$</span>weight))</span>
<span id="cb200-8"><a href="geocentric-model.html#cb200-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb200-9"><a href="geocentric-model.html#cb200-9" aria-hidden="true" tabindex="-1"></a>mu <span class="ot">&lt;-</span> <span class="fu">fitted</span>(b4<span class="fl">.3</span>,</span>
<span id="cb200-10"><a href="geocentric-model.html#cb200-10" aria-hidden="true" tabindex="-1"></a>             <span class="at">summary=</span>F,</span>
<span id="cb200-11"><a href="geocentric-model.html#cb200-11" aria-hidden="true" tabindex="-1"></a>             <span class="at">newdata =</span> weight_seq) <span class="sc">%&gt;%</span> </span>
<span id="cb200-12"><a href="geocentric-model.html#cb200-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb200-13"><a href="geocentric-model.html#cb200-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_names</span>(<span class="dv">25</span><span class="sc">:</span><span class="dv">75</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb200-14"><a href="geocentric-model.html#cb200-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">iter=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">4000</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb200-15"><a href="geocentric-model.html#cb200-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span>iter, </span>
<span id="cb200-16"><a href="geocentric-model.html#cb200-16" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">&quot;weight&quot;</span>,</span>
<span id="cb200-17"><a href="geocentric-model.html#cb200-17" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">&quot;height&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb200-18"><a href="geocentric-model.html#cb200-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">weight =</span> <span class="fu">as.numeric</span>(weight))</span></code></pre></div>
<p><br /></p>
<p>全サンプルをグラフ上に表すと、以下のようになる。</p>
<div class="sourceCode" id="cb201"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb201-1"><a href="geocentric-model.html#cb201-1" aria-hidden="true" tabindex="-1"></a>d2 <span class="sc">%&gt;%</span> </span>
<span id="cb201-2"><a href="geocentric-model.html#cb201-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>weight, <span class="at">y=</span>height))<span class="sc">+</span></span>
<span id="cb201-3"><a href="geocentric-model.html#cb201-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data=</span>mu <span class="sc">%&gt;%</span> <span class="fu">filter</span>(iter<span class="sc">&lt;</span><span class="dv">101</span>),</span>
<span id="cb201-4"><a href="geocentric-model.html#cb201-4" aria-hidden="true" tabindex="-1"></a>             <span class="at">alpha=</span><span class="dv">1</span><span class="sc">/</span><span class="dv">20</span>, <span class="at">color=</span><span class="st">&quot;navyblue&quot;</span>)<span class="sc">+</span></span>
<span id="cb201-5"><a href="geocentric-model.html#cb201-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim=</span><span class="fu">c</span>(<span class="dv">30</span>,<span class="dv">60</span>))<span class="sc">+</span></span>
<span id="cb201-6"><a href="geocentric-model.html#cb201-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid=</span><span class="fu">element_blank</span>(),</span>
<span id="cb201-7"><a href="geocentric-model.html#cb201-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">aspect.ratio =</span><span class="dv">1</span>)</span></code></pre></div>
<p><img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-79-1.png" width="672" style="display: block; margin: auto;" />
<br /></p>
<p>89%信用区間の作図をすると</p>
<div class="sourceCode" id="cb202"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb202-1"><a href="geocentric-model.html#cb202-1" aria-hidden="true" tabindex="-1"></a>mu_fit <span class="ot">&lt;-</span> </span>
<span id="cb202-2"><a href="geocentric-model.html#cb202-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fitted</span>(b4<span class="fl">.3</span>,</span>
<span id="cb202-3"><a href="geocentric-model.html#cb202-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">newdata =</span> weight_seq,</span>
<span id="cb202-4"><a href="geocentric-model.html#cb202-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">prob =</span> <span class="fu">c</span>(.<span class="dv">055</span>, .<span class="dv">5</span>,.<span class="dv">945</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb202-5"><a href="geocentric-model.html#cb202-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb202-6"><a href="geocentric-model.html#cb202-6" aria-hidden="true" tabindex="-1"></a>   <span class="fu">mutate</span>(<span class="at">weight =</span> <span class="dv">25</span><span class="sc">:</span><span class="dv">75</span>)</span>
<span id="cb202-7"><a href="geocentric-model.html#cb202-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb202-8"><a href="geocentric-model.html#cb202-8" aria-hidden="true" tabindex="-1"></a><span class="fu">datatable</span>(mu_fit)</span></code></pre></div>
<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-1334ff14a56cbcbf0af8" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-1334ff14a56cbcbf0af8">{"x":{"filter":"none","vertical":false,"data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47","48","49","50","51"],[136.550834736225,137.453453284225,138.356071832225,139.258690380225,140.161308928225,141.063927476225,141.966546024225,142.869164572225,143.771783120225,144.674401668225,145.577020216225,146.479638764225,147.382257312225,148.284875860225,149.187494408225,150.090112956225,150.992731504225,151.895350052225,152.797968600225,153.700587148225,154.603205696225,155.505824244225,156.408442792225,157.311061340225,158.213679888225,159.116298436225,160.018916984225,160.921535532225,161.824154080225,162.726772628225,163.629391176225,164.532009724225,165.434628272225,166.337246820225,167.239865368225,168.142483916225,169.045102464225,169.947721012225,170.850339560225,171.752958108225,172.655576656225,173.558195204225,174.460813752225,175.363432300225,176.266050848225,177.168669396225,178.071287944225,178.973906492225,179.876525040225,180.779143588225,181.681762136225],[0.891410330690216,0.851052769486326,0.810920589510913,0.771048984039525,0.731480564565674,0.692267321299746,0.653473196998171,0.615177487806381,0.57747935986129,0.540503864816078,0.504409944340617,0.469401004761991,0.435738639377673,0.403759789571869,0.373896671229914,0.346696439398757,0.322832880419602,0.30309513938949,0.288331763106889,0.279332588439652,0.276660679471695,0.280496908040642,0.2905836308677,0.306303974654962,0.326846065455704,0.351365227892,0.37909054788084,0.409371116307526,0.441681701561679,0.475608754519138,0.510830301087697,0.547096383552957,0.584212509740571,0.622026532739003,0.660418583610811,0.699293465562913,0.73857494110804,0.778201441491711,0.818122833503676,0.858297969887886,0.89869282114665,0.939279040381856,0.980032852446319,1.02093418754627,1.0619660003883,1.10311373117823,1.1443648758593,1.18570864108357,1.22713566537417,1.26863779235038,1.31020788517673],[135.136555248929,136.105586920011,137.075117853765,138.042104575152,139.002418455164,139.963909991958,140.927057155354,141.889895841679,142.852800970851,143.813454846565,144.772140478074,145.72622364507,146.688998959225,147.645479460762,148.588471795116,149.533834614253,150.470289673104,151.407911034734,152.334637008143,153.254266106816,154.164679380255,155.071858805103,155.950411629723,156.825497426458,157.700065982166,158.558827985289,159.42211116551,160.279757706627,161.123459671561,161.969490418756,162.819896242303,163.666346692407,164.512381090382,165.364516415392,166.203117862393,167.048081183636,167.883827969849,168.718052471782,169.551446549115,170.38680650263,171.229999502015,172.06491361206,172.90342167247,173.738591260487,174.577253518305,175.416151849086,176.249631632172,177.089809488487,177.928156965137,178.76226598519,179.598590613132],[136.552538228952,137.453545797617,138.355816471441,139.259070308022,140.163410920997,141.067596307814,141.973315973906,142.872628029153,143.776590609011,144.679695070807,145.580703131556,146.481861208948,147.387172370851,148.295358888666,149.198533076622,150.095846402251,150.995691824629,151.897160632077,152.799194750804,153.698756541091,154.602394359399,155.50354214756,156.406452591612,157.310025649836,158.215549560087,159.11786637799,160.018177461228,160.922473641154,161.823093621209,162.730601129956,163.633345738576,164.530401354834,165.430483489912,166.330230355126,167.232119222673,168.134993774429,169.038835885018,169.946296191514,170.853791303812,171.757958328155,172.660763263237,173.56452451559,174.461969721355,175.370301865041,176.271496687877,177.177842866782,178.077886275425,178.979875806902,179.882098839556,180.787901569457,181.690421298216],[137.967725253084,138.800229914698,139.644368503846,140.481241932041,141.318946510755,142.156015178713,142.998483589384,143.843725934314,144.690843556489,145.534471421137,146.382340464599,147.235167385999,148.078598207599,148.929010814553,149.785095694023,150.644150757914,151.503704895209,152.370023181415,153.248089569211,154.142604984731,155.050150597371,155.955893355702,156.872181720015,157.803327870944,158.737597658077,159.685597854947,160.639626339276,161.585367205313,162.544270556883,163.50717690163,164.46660595559,165.423375850784,166.387585459673,167.349506169356,168.312259325438,169.274985306831,170.244478094191,171.203739871612,172.17160987489,173.144243465033,174.108272030767,175.075575885173,176.046739224116,177.010505246585,177.97861479988,178.944474678161,179.914336370159,180.881568210986,181.8473960677,182.819827907652,183.793132400784],[25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>Estimate<\/th>\n      <th>Est.Error<\/th>\n      <th>Q5.5<\/th>\n      <th>Q50<\/th>\n      <th>Q94.5<\/th>\n      <th>weight<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[1,2,3,4,5,6]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false},"selection":{"mode":"multiple","selected":null,"target":"row","selectable":null}},"evals":[],"jsHooks":[]}</script>
<div class="sourceCode" id="cb203"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb203-1"><a href="geocentric-model.html#cb203-1" aria-hidden="true" tabindex="-1"></a>d2 <span class="sc">%&gt;%</span> </span>
<span id="cb203-2"><a href="geocentric-model.html#cb203-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>weight,<span class="at">y=</span>height))<span class="sc">+</span></span>
<span id="cb203-3"><a href="geocentric-model.html#cb203-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">color=</span><span class="st">&quot;navyblue&quot;</span>, <span class="at">shape=</span><span class="dv">1</span>,<span class="at">size=</span><span class="dv">3</span>)<span class="sc">+</span></span>
<span id="cb203-4"><a href="geocentric-model.html#cb203-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="at">data=</span>mu_fit, </span>
<span id="cb203-5"><a href="geocentric-model.html#cb203-5" aria-hidden="true" tabindex="-1"></a>              <span class="fu">aes</span>(<span class="at">y=</span>Q50, <span class="at">ymin=</span>Q5<span class="fl">.5</span>, <span class="at">ymax=</span>Q94<span class="fl">.5</span>), </span>
<span id="cb203-6"><a href="geocentric-model.html#cb203-6" aria-hidden="true" tabindex="-1"></a>              <span class="at">fill=</span><span class="st">&#39;black&#39;</span>, <span class="at">alpha=</span><span class="dv">1</span><span class="sc">/</span><span class="dv">5</span>)<span class="sc">+</span></span>
<span id="cb203-7"><a href="geocentric-model.html#cb203-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data=</span>mu_fit, <span class="fu">aes</span>(<span class="at">x=</span>weight,<span class="at">y=</span>Estimate),<span class="at">size=</span><span class="fl">0.5</span>)<span class="sc">+</span></span>
<span id="cb203-8"><a href="geocentric-model.html#cb203-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim=</span><span class="fu">c</span>(<span class="dv">30</span>,<span class="dv">65</span>))<span class="sc">+</span></span>
<span id="cb203-9"><a href="geocentric-model.html#cb203-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb203-10"><a href="geocentric-model.html#cb203-10" aria-hidden="true" tabindex="-1"></a>        <span class="at">aspect.ratio =</span><span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb203-11"><a href="geocentric-model.html#cb203-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title=</span><span class="st">&quot;89%信用区間&quot;</span>)</span></code></pre></div>
<p><img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-81-1.png" width="672" style="display: block; margin: auto;" />
<br /></p>
</div>
<div id="prediction-intervals" class="section level3 hasAnchor" number="4.5.4">
<h3><span class="header-section-number">4.5.4</span> Prediction intervals<a href="geocentric-model.html#prediction-intervals" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>事後分布から、新たにデータをシミュレートする。</p>
<div class="sourceCode" id="cb204"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb204-1"><a href="geocentric-model.html#cb204-1" aria-hidden="true" tabindex="-1"></a>pred <span class="ot">&lt;-</span> </span>
<span id="cb204-2"><a href="geocentric-model.html#cb204-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">predict</span>(b4<span class="fl">.3</span>, </span>
<span id="cb204-3"><a href="geocentric-model.html#cb204-3" aria-hidden="true" tabindex="-1"></a>          <span class="at">newdata =</span> weight_seq,</span>
<span id="cb204-4"><a href="geocentric-model.html#cb204-4" aria-hidden="true" tabindex="-1"></a>          <span class="at">prob =</span> <span class="fu">c</span>(<span class="fl">0.055</span>,<span class="fl">0.5</span>,<span class="fl">0.945</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb204-5"><a href="geocentric-model.html#cb204-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb204-6"><a href="geocentric-model.html#cb204-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(weight_seq)</span>
<span id="cb204-7"><a href="geocentric-model.html#cb204-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb204-8"><a href="geocentric-model.html#cb204-8" aria-hidden="true" tabindex="-1"></a><span class="co"># 作図</span></span>
<span id="cb204-9"><a href="geocentric-model.html#cb204-9" aria-hidden="true" tabindex="-1"></a>d2 <span class="sc">%&gt;%</span> </span>
<span id="cb204-10"><a href="geocentric-model.html#cb204-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>weight,<span class="at">y=</span>height))<span class="sc">+</span></span>
<span id="cb204-11"><a href="geocentric-model.html#cb204-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">color=</span><span class="st">&quot;navyblue&quot;</span>, <span class="at">shape=</span><span class="dv">1</span>,<span class="at">size=</span><span class="dv">3</span>)<span class="sc">+</span></span>
<span id="cb204-12"><a href="geocentric-model.html#cb204-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="at">data=</span>pred, </span>
<span id="cb204-13"><a href="geocentric-model.html#cb204-13" aria-hidden="true" tabindex="-1"></a>              <span class="fu">aes</span>(<span class="at">y=</span>Q50, <span class="at">ymin=</span>Q5<span class="fl">.5</span>, <span class="at">ymax=</span>Q94<span class="fl">.5</span>), </span>
<span id="cb204-14"><a href="geocentric-model.html#cb204-14" aria-hidden="true" tabindex="-1"></a>              <span class="at">fill=</span><span class="st">&#39;black&#39;</span>, <span class="at">alpha=</span><span class="dv">1</span><span class="sc">/</span><span class="dv">8</span>)<span class="sc">+</span></span>
<span id="cb204-15"><a href="geocentric-model.html#cb204-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="at">data=</span>mu_fit, </span>
<span id="cb204-16"><a href="geocentric-model.html#cb204-16" aria-hidden="true" tabindex="-1"></a>              <span class="fu">aes</span>(<span class="at">y=</span>Q50, <span class="at">ymin=</span>Q5<span class="fl">.5</span>, <span class="at">ymax=</span>Q94<span class="fl">.5</span>), </span>
<span id="cb204-17"><a href="geocentric-model.html#cb204-17" aria-hidden="true" tabindex="-1"></a>              <span class="at">fill=</span><span class="st">&#39;black&#39;</span>, <span class="at">alpha=</span><span class="dv">1</span><span class="sc">/</span><span class="dv">5</span>)<span class="sc">+</span></span>
<span id="cb204-18"><a href="geocentric-model.html#cb204-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data=</span>pred, <span class="fu">aes</span>(<span class="at">x=</span>weight,<span class="at">y=</span>Estimate),<span class="at">size=</span><span class="fl">0.5</span>)<span class="sc">+</span></span>
<span id="cb204-19"><a href="geocentric-model.html#cb204-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim=</span><span class="fu">c</span>(<span class="dv">30</span>,<span class="dv">65</span>))<span class="sc">+</span></span>
<span id="cb204-20"><a href="geocentric-model.html#cb204-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb204-21"><a href="geocentric-model.html#cb204-21" aria-hidden="true" tabindex="-1"></a>        <span class="at">aspect.ratio =</span><span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb204-22"><a href="geocentric-model.html#cb204-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title=</span><span class="st">&quot;89%予測区間&quot;</span>)</span></code></pre></div>
<p><img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-82-1.png" width="672" style="display: block; margin: auto;" />
<br /></p>
</div>
</div>
<div id="curves-from-lines" class="section level2 hasAnchor" number="4.6">
<h2><span class="header-section-number">4.6</span> Curves from lines<a href="geocentric-model.html#curves-from-lines" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>多項回帰やB-スプラインによって曲線回帰する方法を学ぶ。</p>
<div id="polynomial-regression" class="section level3 hasAnchor" number="4.6.1">
<h3><span class="header-section-number">4.6.1</span> Polynomial regression<a href="geocentric-model.html#polynomial-regression" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>クンサン属の18歳以下も含めた身長・体重データを見てみると、曲線を描いていることが分かる。</p>
<div class="sourceCode" id="cb205"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb205-1"><a href="geocentric-model.html#cb205-1" aria-hidden="true" tabindex="-1"></a>(d)</span></code></pre></div>
<pre><code>## # A tibble: 544 × 4
##    height weight   age  male
##     &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt;
##  1   152.   47.8    63     1
##  2   140.   36.5    63     0
##  3   137.   31.9    65     0
##  4   157.   53.0    41     1
##  5   145.   41.3    51     0
##  6   164.   63.0    35     1
##  7   149.   38.2    32     0
##  8   169.   55.5    27     1
##  9   148.   34.9    19     0
## 10   165.   54.5    54     1
## # … with 534 more rows</code></pre>
<div class="sourceCode" id="cb207"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb207-1"><a href="geocentric-model.html#cb207-1" aria-hidden="true" tabindex="-1"></a>d <span class="sc">%&gt;%</span> </span>
<span id="cb207-2"><a href="geocentric-model.html#cb207-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>weight,<span class="at">y=</span>height))<span class="sc">+</span></span>
<span id="cb207-3"><a href="geocentric-model.html#cb207-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">color=</span><span class="st">&quot;navyblue&quot;</span>,<span class="at">size=</span><span class="dv">3</span>,<span class="at">shape=</span><span class="dv">1</span>,<span class="at">alpha=</span><span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>)<span class="sc">+</span> <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">&quot;text&quot;</span>,</span>
<span id="cb207-4"><a href="geocentric-model.html#cb207-4" aria-hidden="true" tabindex="-1"></a>           <span class="at">x =</span> <span class="dv">42</span>, <span class="at">y =</span> <span class="dv">115</span>,</span>
<span id="cb207-5"><a href="geocentric-model.html#cb207-5" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> <span class="st">&quot;This relation is</span><span class="sc">\n</span><span class="st">visibly curved.&quot;</span>,</span>
<span id="cb207-6"><a href="geocentric-model.html#cb207-6" aria-hidden="true" tabindex="-1"></a>           <span class="at">family =</span> <span class="st">&quot;Times&quot;</span>)<span class="sc">+</span></span>
<span id="cb207-7"><a href="geocentric-model.html#cb207-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb207-8"><a href="geocentric-model.html#cb207-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">aspect.ratio=</span><span class="dv">1</span>)</span></code></pre></div>
<p><img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-83-1.png" width="672" style="display: block; margin: auto;" />
<br /></p>
<p>そこで、<span class="math inline">\(x^2\)</span>項を含めたモデリングを行う。<br />
モデル式は以下の通り。</p>
<p><span class="math inline">\(h_{i} \sim Normal(\mu_{i}, \sigma)\)</span><br />
<span class="math inline">\(\mu_{i} = \alpha + \beta_{1}x_{i} + \beta_{2}x^2_{i}\)</span><br />
<span class="math inline">\(\alpha \sim Normal(178, 20)\)</span><br />
<span class="math inline">\(\beta_{1} \sim LogNormal(0,1)\)</span><br />
<span class="math inline">\(\beta_{2} \sim Normal(0,1)\)</span><br />
<span class="math inline">\(\sigma \sim Uniform(0,50)\)</span></p>
<p>標準化を施してからモデル化をする。</p>
<div class="sourceCode" id="cb208"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb208-1"><a href="geocentric-model.html#cb208-1" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> </span>
<span id="cb208-2"><a href="geocentric-model.html#cb208-2" aria-hidden="true" tabindex="-1"></a>d <span class="sc">%&gt;%</span> </span>
<span id="cb208-3"><a href="geocentric-model.html#cb208-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">weight_s =</span> <span class="fu">scale</span>(weight),</span>
<span id="cb208-4"><a href="geocentric-model.html#cb208-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">weight_s2 =</span> weight_s<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb208-5"><a href="geocentric-model.html#cb208-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb208-6"><a href="geocentric-model.html#cb208-6" aria-hidden="true" tabindex="-1"></a>b4<span class="fl">.5</span> <span class="ot">&lt;-</span> </span>
<span id="cb208-7"><a href="geocentric-model.html#cb208-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">brm</span>(<span class="at">data =</span> d,</span>
<span id="cb208-8"><a href="geocentric-model.html#cb208-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> gaussian,</span>
<span id="cb208-9"><a href="geocentric-model.html#cb208-9" aria-hidden="true" tabindex="-1"></a>      height <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> weight_s <span class="sc">+</span> weight_s2,</span>
<span id="cb208-10"><a href="geocentric-model.html#cb208-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">set_prior</span>(<span class="st">&quot;normal(178, 20)&quot;</span>,<span class="at">class=</span><span class="st">&quot;Intercept&quot;</span>),</span>
<span id="cb208-11"><a href="geocentric-model.html#cb208-11" aria-hidden="true" tabindex="-1"></a>                <span class="fu">set_prior</span>(<span class="st">&quot;lognormal(0, 1)&quot;</span>,<span class="at">class=</span><span class="st">&quot;b&quot;</span>,</span>
<span id="cb208-12"><a href="geocentric-model.html#cb208-12" aria-hidden="true" tabindex="-1"></a>                      <span class="at">coef =</span> <span class="st">&quot;weight_s&quot;</span>),</span>
<span id="cb208-13"><a href="geocentric-model.html#cb208-13" aria-hidden="true" tabindex="-1"></a>                <span class="fu">set_prior</span>(<span class="st">&quot;normal(0, 1)&quot;</span>, <span class="at">class =</span> <span class="st">&quot;b&quot;</span>, </span>
<span id="cb208-14"><a href="geocentric-model.html#cb208-14" aria-hidden="true" tabindex="-1"></a>                      <span class="at">coef =</span> <span class="st">&quot;weight_s2&quot;</span>),</span>
<span id="cb208-15"><a href="geocentric-model.html#cb208-15" aria-hidden="true" tabindex="-1"></a>                <span class="fu">set_prior</span>(<span class="st">&quot;&quot;</span>, <span class="at">class =</span> <span class="st">&quot;sigma&quot;</span>)),</span>
<span id="cb208-16"><a href="geocentric-model.html#cb208-16" aria-hidden="true" tabindex="-1"></a>      <span class="at">iter =</span> <span class="dv">10000</span>, <span class="at">warmup =</span> <span class="dv">9000</span>, <span class="at">chains =</span><span class="dv">4</span>,<span class="at">seed=</span><span class="dv">4</span>,</span>
<span id="cb208-17"><a href="geocentric-model.html#cb208-17" aria-hidden="true" tabindex="-1"></a>      <span class="at">backend =</span> <span class="st">&quot;cmdstanr&quot;</span>,</span>
<span id="cb208-18"><a href="geocentric-model.html#cb208-18" aria-hidden="true" tabindex="-1"></a>      <span class="at">file =</span> <span class="st">&quot;output/Chapter4/b4.5&quot;</span>)</span>
<span id="cb208-19"><a href="geocentric-model.html#cb208-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb208-20"><a href="geocentric-model.html#cb208-20" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(b4<span class="fl">.5</span>)</span></code></pre></div>
<p><img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-84-1.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb209"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb209-1"><a href="geocentric-model.html#cb209-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(b4<span class="fl">.5</span>)</span></code></pre></div>
<pre><code>##  Family: gaussian 
##   Links: mu = identity; sigma = identity 
## Formula: height ~ 1 + weight_s + weight_s2 
##    Data: d (Number of observations: 544) 
##   Draws: 4 chains, each with iter = 10000; warmup = 9000; thin = 1;
##          total post-warmup draws = 4000
## 
## Population-Level Effects: 
##           Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## Intercept   146.05      0.37   145.30   146.77 1.00     3555     3213
## weight_s     21.74      0.29    21.17    22.32 1.00     3211     2831
## weight_s2    -7.79      0.28    -8.33    -7.24 1.00     3288     3067
## 
## Family Specific Parameters: 
##       Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## sigma     5.81      0.18     5.47     6.17 1.00     3794     2663
## 
## Draws were sampled using sample(hmc). For each parameter, Bulk_ESS
## and Tail_ESS are effective sample size measures, and Rhat is the potential
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<p>パラメータ間の相関はありそう。</p>
<div class="sourceCode" id="cb211"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb211-1"><a href="geocentric-model.html#cb211-1" aria-hidden="true" tabindex="-1"></a>samples_b45 <span class="ot">&lt;-</span> <span class="fu">posterior_samples</span>(b4<span class="fl">.5</span>)</span>
<span id="cb211-2"><a href="geocentric-model.html#cb211-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-3"><a href="geocentric-model.html#cb211-3" aria-hidden="true" tabindex="-1"></a><span class="fu">pairs</span>(b4<span class="fl">.5</span>)</span></code></pre></div>
<p><img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-85-1.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb212"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb212-1"><a href="geocentric-model.html#cb212-1" aria-hidden="true" tabindex="-1"></a><span class="fu">bind_rows</span>(<span class="fu">mean_qi</span>(samples_b45),</span>
<span id="cb212-2"><a href="geocentric-model.html#cb212-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">median_hdi</span>(samples_b45)) <span class="sc">%&gt;%</span> </span>
<span id="cb212-3"><a href="geocentric-model.html#cb212-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>()</span></code></pre></div>
<pre><code>##   b_Intercept b_Intercept.lower b_Intercept.upper b_weight_s b_weight_s.lower
## 1    146.0455           145.304           146.773   21.74105         21.16601
## 2    146.0455           145.298           146.760   21.74145         21.19660
##   b_weight_s.upper b_weight_s2 b_weight_s2.lower b_weight_s2.upper    sigma
## 1         22.31633   -7.787424         -8.330521         -7.236676 5.809241
## 2         22.34100   -7.786660         -8.330830         -7.238070 5.801040
##   sigma.lower sigma.upper    lprior lprior.lower lprior.upper      lp__
## 1    5.465192    6.174071 -45.90548     -50.1711     -41.7887 -1772.039
## 2    5.471860    6.178080 -45.84730     -50.1372     -41.7841 -1771.720
##   lp__.lower lp__.upper .width .point .interval
## 1   -1775.66   -1770.24   0.95   mean        qi
## 2   -1774.84   -1770.07   0.95 median       hdi</code></pre>
<div class="sourceCode" id="cb214"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb214-1"><a href="geocentric-model.html#cb214-1" aria-hidden="true" tabindex="-1"></a>samples_b45 <span class="sc">%&gt;%</span> </span>
<span id="cb214-2"><a href="geocentric-model.html#cb214-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>lp__) <span class="sc">%&gt;%</span> </span>
<span id="cb214-3"><a href="geocentric-model.html#cb214-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cov</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb214-4"><a href="geocentric-model.html#cb214-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">round</span>(<span class="at">digits=</span><span class="dv">3</span>)</span></code></pre></div>
<pre><code>##             b_Intercept b_weight_s b_weight_s2  sigma lprior
## b_Intercept       0.137     -0.045      -0.077 -0.006 -0.581
## b_weight_s       -0.045      0.086       0.043  0.002  0.321
## b_weight_s2      -0.077      0.043       0.077  0.006  0.589
## sigma            -0.006      0.002       0.006  0.033  0.045
## lprior           -0.581      0.321       0.589  0.045  4.529</code></pre>
<p><br /></p>
<p>信用区間と予測区間を作図する。</p>
<div class="sourceCode" id="cb216"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb216-1"><a href="geocentric-model.html#cb216-1" aria-hidden="true" tabindex="-1"></a>weight_seq <span class="ot">&lt;-</span> </span>
<span id="cb216-2"><a href="geocentric-model.html#cb216-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="at">weight_s =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="sc">-</span><span class="fl">2.5</span>, <span class="at">to =</span> <span class="fl">2.5</span>, <span class="at">length.out =</span> <span class="dv">30</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb216-3"><a href="geocentric-model.html#cb216-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">weight_s2 =</span> weight_s<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb216-4"><a href="geocentric-model.html#cb216-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb216-5"><a href="geocentric-model.html#cb216-5" aria-hidden="true" tabindex="-1"></a>fit_b45 <span class="ot">&lt;-</span> <span class="fu">fitted</span>(b4<span class="fl">.5</span>,</span>
<span id="cb216-6"><a href="geocentric-model.html#cb216-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">newdata =</span> weight_seq,</span>
<span id="cb216-7"><a href="geocentric-model.html#cb216-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">prob =</span><span class="fu">c</span>(.<span class="dv">055</span>,<span class="fl">0.5</span>,.<span class="dv">945</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb216-8"><a href="geocentric-model.html#cb216-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb216-9"><a href="geocentric-model.html#cb216-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(weight_seq)</span>
<span id="cb216-10"><a href="geocentric-model.html#cb216-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb216-11"><a href="geocentric-model.html#cb216-11" aria-hidden="true" tabindex="-1"></a>predict_b45 <span class="ot">&lt;-</span> <span class="fu">predict</span>(b4<span class="fl">.5</span>,</span>
<span id="cb216-12"><a href="geocentric-model.html#cb216-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">newdata =</span> weight_seq,</span>
<span id="cb216-13"><a href="geocentric-model.html#cb216-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">prob =</span><span class="fu">c</span>(.<span class="dv">055</span>,<span class="fl">0.5</span>,.<span class="dv">945</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb216-14"><a href="geocentric-model.html#cb216-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb216-15"><a href="geocentric-model.html#cb216-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(weight_seq)</span>
<span id="cb216-16"><a href="geocentric-model.html#cb216-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb216-17"><a href="geocentric-model.html#cb216-17" aria-hidden="true" tabindex="-1"></a>  d <span class="sc">%&gt;%</span> </span>
<span id="cb216-18"><a href="geocentric-model.html#cb216-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>weight_s,<span class="at">y=</span>height))<span class="sc">+</span></span>
<span id="cb216-19"><a href="geocentric-model.html#cb216-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">color=</span><span class="st">&quot;navyblue&quot;</span>, <span class="at">shape=</span><span class="dv">1</span>,<span class="at">size=</span><span class="dv">3</span>,</span>
<span id="cb216-20"><a href="geocentric-model.html#cb216-20" aria-hidden="true" tabindex="-1"></a>               <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">5</span>)<span class="sc">+</span></span>
<span id="cb216-21"><a href="geocentric-model.html#cb216-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_ribbon</span>(<span class="at">data=</span>predict_b45, </span>
<span id="cb216-22"><a href="geocentric-model.html#cb216-22" aria-hidden="true" tabindex="-1"></a>                <span class="fu">aes</span>(<span class="at">y=</span>Q50, <span class="at">ymin=</span>Q5<span class="fl">.5</span>, <span class="at">ymax=</span>Q94<span class="fl">.5</span>), </span>
<span id="cb216-23"><a href="geocentric-model.html#cb216-23" aria-hidden="true" tabindex="-1"></a>                <span class="at">fill=</span><span class="st">&#39;black&#39;</span>, <span class="at">alpha=</span><span class="dv">1</span><span class="sc">/</span><span class="dv">8</span>)<span class="sc">+</span></span>
<span id="cb216-24"><a href="geocentric-model.html#cb216-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_ribbon</span>(<span class="at">data=</span>fit_b45, </span>
<span id="cb216-25"><a href="geocentric-model.html#cb216-25" aria-hidden="true" tabindex="-1"></a>                <span class="fu">aes</span>(<span class="at">y=</span>Q50, <span class="at">ymin=</span>Q5<span class="fl">.5</span>, <span class="at">ymax=</span>Q94<span class="fl">.5</span>), </span>
<span id="cb216-26"><a href="geocentric-model.html#cb216-26" aria-hidden="true" tabindex="-1"></a>                <span class="at">fill=</span><span class="st">&#39;black&#39;</span>, <span class="at">alpha=</span><span class="dv">1</span><span class="sc">/</span><span class="dv">5</span>)<span class="sc">+</span></span>
<span id="cb216-27"><a href="geocentric-model.html#cb216-27" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="at">data=</span>predict_b45, <span class="fu">aes</span>(<span class="at">x=</span>weight_s,<span class="at">y=</span>Estimate),<span class="at">size=</span><span class="fl">0.5</span>)<span class="sc">+</span></span>
<span id="cb216-28"><a href="geocentric-model.html#cb216-28" aria-hidden="true" tabindex="-1"></a>    <span class="fu">coord_cartesian</span>(<span class="at">xlim=</span><span class="fu">c</span>(<span class="sc">-</span><span class="dv">2</span>,<span class="dv">2</span>))<span class="sc">+</span></span>
<span id="cb216-29"><a href="geocentric-model.html#cb216-29" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb216-30"><a href="geocentric-model.html#cb216-30" aria-hidden="true" tabindex="-1"></a>          <span class="at">aspect.ratio =</span><span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb216-31"><a href="geocentric-model.html#cb216-31" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">title=</span><span class="st">&quot;quadratic&quot;</span>) <span class="ot">-&gt;</span>p1</span>
<span id="cb216-32"><a href="geocentric-model.html#cb216-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb216-33"><a href="geocentric-model.html#cb216-33" aria-hidden="true" tabindex="-1"></a>p1</span></code></pre></div>
<p><img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-86-1.png" width="672" style="display: block; margin: auto;" />
<br /></p>
<p>続いて、3乗項を含めたモデルを考えてみる。</p>
<div class="sourceCode" id="cb217"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb217-1"><a href="geocentric-model.html#cb217-1" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> </span>
<span id="cb217-2"><a href="geocentric-model.html#cb217-2" aria-hidden="true" tabindex="-1"></a>d <span class="sc">%&gt;%</span> </span>
<span id="cb217-3"><a href="geocentric-model.html#cb217-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">weight_s =</span> <span class="fu">scale</span>(weight),</span>
<span id="cb217-4"><a href="geocentric-model.html#cb217-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">weight_s2 =</span> weight_s<span class="sc">^</span><span class="dv">2</span>,</span>
<span id="cb217-5"><a href="geocentric-model.html#cb217-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">weight_s3 =</span> weight_s<span class="sc">^</span><span class="dv">3</span>)</span>
<span id="cb217-6"><a href="geocentric-model.html#cb217-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb217-7"><a href="geocentric-model.html#cb217-7" aria-hidden="true" tabindex="-1"></a>b4<span class="fl">.5</span>_2 <span class="ot">&lt;-</span> </span>
<span id="cb217-8"><a href="geocentric-model.html#cb217-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">brm</span>(<span class="at">data =</span> d,</span>
<span id="cb217-9"><a href="geocentric-model.html#cb217-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> gaussian,</span>
<span id="cb217-10"><a href="geocentric-model.html#cb217-10" aria-hidden="true" tabindex="-1"></a>      height <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> weight_s <span class="sc">+</span> weight_s2 <span class="sc">+</span> weight_s3,</span>
<span id="cb217-11"><a href="geocentric-model.html#cb217-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">set_prior</span>(<span class="st">&quot;normal(178, 20)&quot;</span>,<span class="at">class=</span><span class="st">&quot;Intercept&quot;</span>),</span>
<span id="cb217-12"><a href="geocentric-model.html#cb217-12" aria-hidden="true" tabindex="-1"></a>                <span class="fu">set_prior</span>(<span class="st">&quot;lognormal(0, 1)&quot;</span>,<span class="at">class=</span><span class="st">&quot;b&quot;</span>,</span>
<span id="cb217-13"><a href="geocentric-model.html#cb217-13" aria-hidden="true" tabindex="-1"></a>                      <span class="at">coef =</span> <span class="st">&quot;weight_s&quot;</span>),</span>
<span id="cb217-14"><a href="geocentric-model.html#cb217-14" aria-hidden="true" tabindex="-1"></a>                <span class="fu">set_prior</span>(<span class="st">&quot;normal(0, 1)&quot;</span>, <span class="at">class =</span> <span class="st">&quot;b&quot;</span>, </span>
<span id="cb217-15"><a href="geocentric-model.html#cb217-15" aria-hidden="true" tabindex="-1"></a>                      <span class="at">coef =</span> <span class="st">&quot;weight_s2&quot;</span>),</span>
<span id="cb217-16"><a href="geocentric-model.html#cb217-16" aria-hidden="true" tabindex="-1"></a>                <span class="fu">set_prior</span>(<span class="st">&quot;normal(0, 1)&quot;</span>, <span class="at">class =</span> <span class="st">&quot;b&quot;</span>, </span>
<span id="cb217-17"><a href="geocentric-model.html#cb217-17" aria-hidden="true" tabindex="-1"></a>                      <span class="at">coef =</span> <span class="st">&quot;weight_s3&quot;</span>),</span>
<span id="cb217-18"><a href="geocentric-model.html#cb217-18" aria-hidden="true" tabindex="-1"></a>                <span class="fu">set_prior</span>(<span class="st">&quot;&quot;</span>, <span class="at">class =</span> <span class="st">&quot;sigma&quot;</span>)),</span>
<span id="cb217-19"><a href="geocentric-model.html#cb217-19" aria-hidden="true" tabindex="-1"></a>      <span class="at">iter =</span> <span class="dv">10000</span>, <span class="at">warmup =</span> <span class="dv">9000</span>, <span class="at">chains =</span><span class="dv">4</span>,<span class="at">seed=</span><span class="dv">4</span>,</span>
<span id="cb217-20"><a href="geocentric-model.html#cb217-20" aria-hidden="true" tabindex="-1"></a>      <span class="at">backend =</span> <span class="st">&quot;cmdstanr&quot;</span>,</span>
<span id="cb217-21"><a href="geocentric-model.html#cb217-21" aria-hidden="true" tabindex="-1"></a>      <span class="at">file =</span> <span class="st">&quot;output/Chapter4/b4.5_2&quot;</span>)</span>
<span id="cb217-22"><a href="geocentric-model.html#cb217-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb217-23"><a href="geocentric-model.html#cb217-23" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(b4<span class="fl">.5</span>_2)</span></code></pre></div>
<p><img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-87-1.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb218"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb218-1"><a href="geocentric-model.html#cb218-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(b4<span class="fl">.5</span>_2)</span></code></pre></div>
<pre><code>##  Family: gaussian 
##   Links: mu = identity; sigma = identity 
## Formula: height ~ 1 + weight_s + weight_s2 + weight_s3 
##    Data: d (Number of observations: 544) 
##   Draws: 4 chains, each with iter = 10000; warmup = 9000; thin = 1;
##          total post-warmup draws = 4000
## 
## Population-Level Effects: 
##           Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## Intercept   146.39      0.31   145.78   146.99 1.00     4030     2627
## weight_s     15.22      0.48    14.30    16.13 1.00     2750     2476
## weight_s2    -6.19      0.26    -6.69    -5.69 1.00     3518     2604
## weight_s3     3.58      0.22     3.15     4.03 1.00     2649     2367
## 
## Family Specific Parameters: 
##       Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## sigma     4.86      0.15     4.58     5.15 1.00     4420     2881
## 
## Draws were sampled using sample(hmc). For each parameter, Bulk_ESS
## and Tail_ESS are effective sample size measures, and Rhat is the potential
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<p><br /></p>
<p>回帰曲線を描いてみる。</p>
<div class="sourceCode" id="cb220"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb220-1"><a href="geocentric-model.html#cb220-1" aria-hidden="true" tabindex="-1"></a>weight_seq <span class="ot">&lt;-</span> </span>
<span id="cb220-2"><a href="geocentric-model.html#cb220-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="at">weight_s =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="sc">-</span><span class="fl">2.5</span>, <span class="at">to =</span> <span class="fl">2.5</span>, <span class="at">length.out =</span> <span class="dv">30</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb220-3"><a href="geocentric-model.html#cb220-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">weight_s2 =</span> weight_s<span class="sc">^</span><span class="dv">2</span>,</span>
<span id="cb220-4"><a href="geocentric-model.html#cb220-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">weight_s3 =</span> weight_s<span class="sc">^</span><span class="dv">3</span>)</span>
<span id="cb220-5"><a href="geocentric-model.html#cb220-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb220-6"><a href="geocentric-model.html#cb220-6" aria-hidden="true" tabindex="-1"></a>fit_b45_2 <span class="ot">&lt;-</span> <span class="fu">fitted</span>(b4<span class="fl">.5</span>_2,</span>
<span id="cb220-7"><a href="geocentric-model.html#cb220-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">newdata =</span> weight_seq,</span>
<span id="cb220-8"><a href="geocentric-model.html#cb220-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">prob =</span><span class="fu">c</span>(.<span class="dv">055</span>,<span class="fl">0.5</span>,.<span class="dv">945</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb220-9"><a href="geocentric-model.html#cb220-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb220-10"><a href="geocentric-model.html#cb220-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(weight_seq)</span>
<span id="cb220-11"><a href="geocentric-model.html#cb220-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb220-12"><a href="geocentric-model.html#cb220-12" aria-hidden="true" tabindex="-1"></a>predict_b45_2 <span class="ot">&lt;-</span> <span class="fu">predict</span>(b4<span class="fl">.5</span>_2,</span>
<span id="cb220-13"><a href="geocentric-model.html#cb220-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">newdata =</span> weight_seq,</span>
<span id="cb220-14"><a href="geocentric-model.html#cb220-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">prob =</span><span class="fu">c</span>(.<span class="dv">055</span>,<span class="fl">0.5</span>,.<span class="dv">945</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb220-15"><a href="geocentric-model.html#cb220-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb220-16"><a href="geocentric-model.html#cb220-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(weight_seq)</span>
<span id="cb220-17"><a href="geocentric-model.html#cb220-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb220-18"><a href="geocentric-model.html#cb220-18" aria-hidden="true" tabindex="-1"></a>  d <span class="sc">%&gt;%</span> </span>
<span id="cb220-19"><a href="geocentric-model.html#cb220-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>weight_s,<span class="at">y=</span>height))<span class="sc">+</span></span>
<span id="cb220-20"><a href="geocentric-model.html#cb220-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">color=</span><span class="st">&quot;navyblue&quot;</span>, <span class="at">shape=</span><span class="dv">1</span>,<span class="at">size=</span><span class="dv">3</span>,</span>
<span id="cb220-21"><a href="geocentric-model.html#cb220-21" aria-hidden="true" tabindex="-1"></a>               <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">5</span>)<span class="sc">+</span></span>
<span id="cb220-22"><a href="geocentric-model.html#cb220-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_ribbon</span>(<span class="at">data=</span>predict_b45_2, </span>
<span id="cb220-23"><a href="geocentric-model.html#cb220-23" aria-hidden="true" tabindex="-1"></a>                <span class="fu">aes</span>(<span class="at">y=</span>Q50, <span class="at">ymin=</span>Q5<span class="fl">.5</span>, <span class="at">ymax=</span>Q94<span class="fl">.5</span>), </span>
<span id="cb220-24"><a href="geocentric-model.html#cb220-24" aria-hidden="true" tabindex="-1"></a>                <span class="at">fill=</span><span class="st">&#39;black&#39;</span>, <span class="at">alpha=</span><span class="dv">1</span><span class="sc">/</span><span class="dv">8</span>)<span class="sc">+</span></span>
<span id="cb220-25"><a href="geocentric-model.html#cb220-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_ribbon</span>(<span class="at">data=</span>fit_b45_2, </span>
<span id="cb220-26"><a href="geocentric-model.html#cb220-26" aria-hidden="true" tabindex="-1"></a>                <span class="fu">aes</span>(<span class="at">y=</span>Q50, <span class="at">ymin=</span>Q5<span class="fl">.5</span>, <span class="at">ymax=</span>Q94<span class="fl">.5</span>), </span>
<span id="cb220-27"><a href="geocentric-model.html#cb220-27" aria-hidden="true" tabindex="-1"></a>                <span class="at">fill=</span><span class="st">&#39;black&#39;</span>, <span class="at">alpha=</span><span class="dv">1</span><span class="sc">/</span><span class="dv">5</span>)<span class="sc">+</span></span>
<span id="cb220-28"><a href="geocentric-model.html#cb220-28" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="at">data=</span>predict_b45_2, <span class="fu">aes</span>(<span class="at">x=</span>weight_s,<span class="at">y=</span>Estimate),<span class="at">size=</span><span class="fl">0.5</span>)<span class="sc">+</span></span>
<span id="cb220-29"><a href="geocentric-model.html#cb220-29" aria-hidden="true" tabindex="-1"></a>    <span class="fu">coord_cartesian</span>(<span class="at">xlim=</span><span class="fu">c</span>(<span class="sc">-</span><span class="dv">2</span>,<span class="dv">2</span>))<span class="sc">+</span></span>
<span id="cb220-30"><a href="geocentric-model.html#cb220-30" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb220-31"><a href="geocentric-model.html#cb220-31" aria-hidden="true" tabindex="-1"></a>          <span class="at">aspect.ratio =</span><span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb220-32"><a href="geocentric-model.html#cb220-32" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">title=</span><span class="st">&quot;cubic&quot;</span>) <span class="ot">-&gt;</span>p2</span>
<span id="cb220-33"><a href="geocentric-model.html#cb220-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb220-34"><a href="geocentric-model.html#cb220-34" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb220-35"><a href="geocentric-model.html#cb220-35" aria-hidden="true" tabindex="-1"></a>p1<span class="sc">|</span>p2</span></code></pre></div>
<p><img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-88-1.png" width="672" style="display: block; margin: auto;" />
3乗項を含んだ方が当てはまりは良くなるが、解釈は難しい。
<br /></p>
</div>
<div id="overthinking" class="section level3 hasAnchor" number="4.6.2">
<h3><span class="header-section-number">4.6.2</span> overthinking<a href="geocentric-model.html#overthinking" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>元のスケールに戻すには？</p>
<div class="sourceCode" id="cb221"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb221-1"><a href="geocentric-model.html#cb221-1" aria-hidden="true" tabindex="-1"></a>at <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">2</span>, <span class="sc">-</span><span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>)</span>
<span id="cb221-2"><a href="geocentric-model.html#cb221-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb221-3"><a href="geocentric-model.html#cb221-3" aria-hidden="true" tabindex="-1"></a>d <span class="sc">%&gt;%</span> </span>
<span id="cb221-4"><a href="geocentric-model.html#cb221-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>weight_s,<span class="at">y=</span>height))<span class="sc">+</span></span>
<span id="cb221-5"><a href="geocentric-model.html#cb221-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">color=</span><span class="st">&quot;navyblue&quot;</span>, <span class="at">shape=</span><span class="dv">1</span>,<span class="at">size=</span><span class="dv">3</span>,</span>
<span id="cb221-6"><a href="geocentric-model.html#cb221-6" aria-hidden="true" tabindex="-1"></a>               <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">5</span>)<span class="sc">+</span></span>
<span id="cb221-7"><a href="geocentric-model.html#cb221-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_ribbon</span>(<span class="at">data=</span>predict_b45_2, </span>
<span id="cb221-8"><a href="geocentric-model.html#cb221-8" aria-hidden="true" tabindex="-1"></a>                <span class="fu">aes</span>(<span class="at">y=</span>Q50, <span class="at">ymin=</span>Q5<span class="fl">.5</span>, <span class="at">ymax=</span>Q94<span class="fl">.5</span>), </span>
<span id="cb221-9"><a href="geocentric-model.html#cb221-9" aria-hidden="true" tabindex="-1"></a>                <span class="at">fill=</span><span class="st">&#39;black&#39;</span>, <span class="at">alpha=</span><span class="dv">1</span><span class="sc">/</span><span class="dv">8</span>)<span class="sc">+</span></span>
<span id="cb221-10"><a href="geocentric-model.html#cb221-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_ribbon</span>(<span class="at">data=</span>fit_b45_2, </span>
<span id="cb221-11"><a href="geocentric-model.html#cb221-11" aria-hidden="true" tabindex="-1"></a>                <span class="fu">aes</span>(<span class="at">y=</span>Q50, <span class="at">ymin=</span>Q5<span class="fl">.5</span>, <span class="at">ymax=</span>Q94<span class="fl">.5</span>), </span>
<span id="cb221-12"><a href="geocentric-model.html#cb221-12" aria-hidden="true" tabindex="-1"></a>                <span class="at">fill=</span><span class="st">&#39;black&#39;</span>, <span class="at">alpha=</span><span class="dv">1</span><span class="sc">/</span><span class="dv">5</span>)<span class="sc">+</span></span>
<span id="cb221-13"><a href="geocentric-model.html#cb221-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="at">data=</span>predict_b45_2, <span class="fu">aes</span>(<span class="at">x=</span>weight_s,<span class="at">y=</span>Estimate),<span class="at">size=</span><span class="fl">0.5</span>)<span class="sc">+</span></span>
<span id="cb221-14"><a href="geocentric-model.html#cb221-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">coord_cartesian</span>(<span class="at">xlim=</span><span class="fu">c</span>(<span class="sc">-</span><span class="dv">2</span>,<span class="dv">2</span>))<span class="sc">+</span></span>
<span id="cb221-15"><a href="geocentric-model.html#cb221-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb221-16"><a href="geocentric-model.html#cb221-16" aria-hidden="true" tabindex="-1"></a>          <span class="at">aspect.ratio =</span><span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb221-17"><a href="geocentric-model.html#cb221-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="st">&quot;元のスケールに変換&quot;</span>,</span>
<span id="cb221-18"><a href="geocentric-model.html#cb221-18" aria-hidden="true" tabindex="-1"></a>                     <span class="at">breaks =</span> at,</span>
<span id="cb221-19"><a href="geocentric-model.html#cb221-19" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels =</span> <span class="fu">round</span>(at<span class="sc">*</span><span class="fu">sd</span>(d<span class="sc">$</span>weight) <span class="sc">+</span> <span class="fu">mean</span>(d<span class="sc">$</span>weight), <span class="dv">1</span>))</span></code></pre></div>
<p><img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-89-1.png" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="splines" class="section level3 hasAnchor" number="4.6.3">
<h3><span class="header-section-number">4.6.3</span> Splines<a href="geocentric-model.html#splines" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>サクラの開花データを用いて学習する。</p>
<div class="sourceCode" id="cb222"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb222-1"><a href="geocentric-model.html#cb222-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;cherry_blossoms&quot;</span>)</span>
<span id="cb222-2"><a href="geocentric-model.html#cb222-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb222-3"><a href="geocentric-model.html#cb222-3" aria-hidden="true" tabindex="-1"></a>d3 <span class="ot">&lt;-</span> cherry_blossoms</span>
<span id="cb222-4"><a href="geocentric-model.html#cb222-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb222-5"><a href="geocentric-model.html#cb222-5" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(d3)</span></code></pre></div>
<pre><code>##   year doy temp temp_upper temp_lower
## 1  801  NA   NA         NA         NA
## 2  802  NA   NA         NA         NA
## 3  803  NA   NA         NA         NA
## 4  804  NA   NA         NA         NA
## 5  805  NA   NA         NA         NA
## 6  806  NA   NA         NA         NA</code></pre>
<div class="sourceCode" id="cb224"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb224-1"><a href="geocentric-model.html#cb224-1" aria-hidden="true" tabindex="-1"></a><span class="fu">precis</span>(d3, <span class="at">hist =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<pre><code>##                   mean          sd      5.5%      94.5%
## year       1408.000000 350.8845964 867.77000 1948.23000
## doy         104.540508   6.4070362  94.43000  115.00000
## temp          6.141886   0.6636479   5.15000    7.29470
## temp_upper    7.185151   0.9929206   5.89765    8.90235
## temp_lower    5.098941   0.8503496   3.78765    6.37000</code></pre>
<div class="sourceCode" id="cb226"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb226-1"><a href="geocentric-model.html#cb226-1" aria-hidden="true" tabindex="-1"></a>d3 <span class="sc">%&gt;%</span> </span>
<span id="cb226-2"><a href="geocentric-model.html#cb226-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>year, <span class="at">y=</span>doy))<span class="sc">+</span></span>
<span id="cb226-3"><a href="geocentric-model.html#cb226-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size=</span><span class="dv">3</span>,<span class="at">shape=</span><span class="dv">1</span>,<span class="at">color=</span><span class="st">&quot;#ffb7c5&quot;</span>,</span>
<span id="cb226-4"><a href="geocentric-model.html#cb226-4" aria-hidden="true" tabindex="-1"></a>             <span class="at">alpha=</span><span class="dv">2</span><span class="sc">/</span><span class="dv">3</span>)<span class="sc">+</span></span>
<span id="cb226-5"><a href="geocentric-model.html#cb226-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb226-6"><a href="geocentric-model.html#cb226-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">&quot;#4f455c&quot;</span>))</span></code></pre></div>
<p><img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-91-1.png" width="672" style="display: block; margin: auto;" />
<br /></p>
<p>ノットを15個とし、区間を16個に分割する。</p>
<div class="sourceCode" id="cb227"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb227-1"><a href="geocentric-model.html#cb227-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(cherry_blossoms)</span>
<span id="cb227-2"><a href="geocentric-model.html#cb227-2" aria-hidden="true" tabindex="-1"></a><span class="fu">detach</span>(package<span class="sc">:</span>rethinking, <span class="at">unload =</span> T)</span>
<span id="cb227-3"><a href="geocentric-model.html#cb227-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb227-4"><a href="geocentric-model.html#cb227-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 欠損値を除く</span></span>
<span id="cb227-5"><a href="geocentric-model.html#cb227-5" aria-hidden="true" tabindex="-1"></a>d4 <span class="ot">&lt;-</span></span>
<span id="cb227-6"><a href="geocentric-model.html#cb227-6" aria-hidden="true" tabindex="-1"></a>  d3 <span class="sc">%&gt;%</span> </span>
<span id="cb227-7"><a href="geocentric-model.html#cb227-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drop_na</span>(doy)</span>
<span id="cb227-8"><a href="geocentric-model.html#cb227-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb227-9"><a href="geocentric-model.html#cb227-9" aria-hidden="true" tabindex="-1"></a><span class="co"># knot数</span></span>
<span id="cb227-10"><a href="geocentric-model.html#cb227-10" aria-hidden="true" tabindex="-1"></a>n_knots <span class="ot">&lt;-</span> <span class="dv">15</span></span>
<span id="cb227-11"><a href="geocentric-model.html#cb227-11" aria-hidden="true" tabindex="-1"></a>knot_list <span class="ot">&lt;-</span> <span class="fu">quantile</span>(d4<span class="sc">$</span>year, </span>
<span id="cb227-12"><a href="geocentric-model.html#cb227-12" aria-hidden="true" tabindex="-1"></a>                      <span class="at">probs =</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="at">length.out=</span><span class="dv">15</span>))</span>
<span id="cb227-13"><a href="geocentric-model.html#cb227-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb227-14"><a href="geocentric-model.html#cb227-14" aria-hidden="true" tabindex="-1"></a>d4 <span class="sc">%&gt;%</span> </span>
<span id="cb227-15"><a href="geocentric-model.html#cb227-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> doy)) <span class="sc">+</span></span>
<span id="cb227-16"><a href="geocentric-model.html#cb227-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> knot_list, <span class="at">color =</span> <span class="st">&quot;white&quot;</span>, <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb227-17"><a href="geocentric-model.html#cb227-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">color =</span> <span class="st">&quot;#ffb7c5&quot;</span>, <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb227-18"><a href="geocentric-model.html#cb227-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb227-19"><a href="geocentric-model.html#cb227-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">&quot;#4f455c&quot;</span>),</span>
<span id="cb227-20"><a href="geocentric-model.html#cb227-20" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid =</span> <span class="fu">element_blank</span>())</span></code></pre></div>
<p><img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-92-1.png" width="672" style="display: block; margin: auto;" />
<br /></p>
<p>基底関数を求める。
自由度は3（3次のスプライン回帰）。</p>
<div class="sourceCode" id="cb228"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb228-1"><a href="geocentric-model.html#cb228-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(splines)</span>
<span id="cb228-2"><a href="geocentric-model.html#cb228-2" aria-hidden="true" tabindex="-1"></a>B <span class="ot">&lt;-</span> <span class="fu">bs</span>(d4<span class="sc">$</span>year,</span>
<span id="cb228-3"><a href="geocentric-model.html#cb228-3" aria-hidden="true" tabindex="-1"></a>        <span class="at">knots =</span> knot_list[<span class="sc">-</span><span class="fu">c</span>(<span class="dv">1</span>,n_knots)],</span>
<span id="cb228-4"><a href="geocentric-model.html#cb228-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">degree=</span><span class="dv">3</span>,</span>
<span id="cb228-5"><a href="geocentric-model.html#cb228-5" aria-hidden="true" tabindex="-1"></a>        <span class="at">intercept =</span> <span class="cn">TRUE</span>)</span>
<span id="cb228-6"><a href="geocentric-model.html#cb228-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb228-7"><a href="geocentric-model.html#cb228-7" aria-hidden="true" tabindex="-1"></a>b <span class="ot">&lt;-</span> </span>
<span id="cb228-8"><a href="geocentric-model.html#cb228-8" aria-hidden="true" tabindex="-1"></a>  B <span class="sc">%&gt;%</span> </span>
<span id="cb228-9"><a href="geocentric-model.html#cb228-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb228-10"><a href="geocentric-model.html#cb228-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_names</span>(<span class="fu">str_c</span>(<span class="dv">0</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">9</span>), <span class="dv">10</span><span class="sc">:</span><span class="dv">17</span>) <span class="sc">%&gt;%</span>  </span>
<span id="cb228-11"><a href="geocentric-model.html#cb228-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(dplyr<span class="sc">::</span><span class="fu">select</span>(d4, year)) <span class="sc">%&gt;%</span> </span>
<span id="cb228-12"><a href="geocentric-model.html#cb228-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span>year,</span>
<span id="cb228-13"><a href="geocentric-model.html#cb228-13" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">&quot;basis_function&quot;</span>,</span>
<span id="cb228-14"><a href="geocentric-model.html#cb228-14" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">&quot;basis&quot;</span>)</span>
<span id="cb228-15"><a href="geocentric-model.html#cb228-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb228-16"><a href="geocentric-model.html#cb228-16" aria-hidden="true" tabindex="-1"></a>b <span class="sc">%&gt;%</span> </span>
<span id="cb228-17"><a href="geocentric-model.html#cb228-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>year,<span class="at">y=</span>basis,<span class="at">group=</span>basis_function))<span class="sc">+</span></span>
<span id="cb228-18"><a href="geocentric-model.html#cb228-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">color =</span> <span class="st">&quot;#ffb7c5&quot;</span>, <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>, <span class="at">size =</span> <span class="fl">1.5</span>)<span class="sc">+</span></span>
<span id="cb228-19"><a href="geocentric-model.html#cb228-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept=</span>knot_list, <span class="at">color =</span> <span class="st">&quot;white&quot;</span>,</span>
<span id="cb228-20"><a href="geocentric-model.html#cb228-20" aria-hidden="true" tabindex="-1"></a>             <span class="at">alpha=</span><span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>)<span class="sc">+</span></span>
<span id="cb228-21"><a href="geocentric-model.html#cb228-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;basis value&quot;</span>)<span class="sc">+</span></span>
<span id="cb228-22"><a href="geocentric-model.html#cb228-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb228-23"><a href="geocentric-model.html#cb228-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">&quot;#4f455c&quot;</span>),</span>
<span id="cb228-24"><a href="geocentric-model.html#cb228-24" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb228-25"><a href="geocentric-model.html#cb228-25" aria-hidden="true" tabindex="-1"></a>         <span class="at">strip.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> scales<span class="sc">::</span><span class="fu">alpha</span>(<span class="st">&quot;#ffb7c5&quot;</span>, .<span class="dv">25</span>), <span class="at">color =</span> <span class="st">&quot;transparent&quot;</span>),</span>
<span id="cb228-26"><a href="geocentric-model.html#cb228-26" aria-hidden="true" tabindex="-1"></a>        <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>, <span class="at">margin =</span> <span class="fu">margin</span>(<span class="fl">0.1</span>, <span class="dv">0</span>, <span class="fl">0.1</span>, <span class="dv">0</span>, <span class="st">&quot;cm&quot;</span>)))<span class="sc">+</span></span>
<span id="cb228-27"><a href="geocentric-model.html#cb228-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>basis_function,<span class="at">ncol=</span><span class="dv">1</span>)</span></code></pre></div>
<p><img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-93-1.png" width="672" style="display: block; margin: auto;" />
モデル式は以下を考える。
<br /></p>
<p><span class="math inline">\(D_{i} \sim Normal(\mu_{i}, \sigma)\)</span><br />
<span class="math inline">\(\mu_{i} = \alpha + \sum_{k=1}^K w_{k}B_{k,j}\)</span><br />
<span class="math inline">\(\alpha \sim Normal(100, 10)\)</span><br />
<span class="math inline">\(w_{j} \sim Normal(0, 10)\)</span><br />
<span class="math inline">\(\sigma \sim Exponential(1)\)</span><br />
<br /></p>
<p>brmsでモデリングを行う。</p>
<div class="sourceCode" id="cb229"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb229-1"><a href="geocentric-model.html#cb229-1" aria-hidden="true" tabindex="-1"></a>d5 <span class="ot">&lt;-</span> </span>
<span id="cb229-2"><a href="geocentric-model.html#cb229-2" aria-hidden="true" tabindex="-1"></a>  d4 <span class="sc">%&gt;%</span> </span>
<span id="cb229-3"><a href="geocentric-model.html#cb229-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">B=</span>B)</span>
<span id="cb229-4"><a href="geocentric-model.html#cb229-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb229-5"><a href="geocentric-model.html#cb229-5" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(d5)  </span></code></pre></div>
<pre><code>## Rows: 827
## Columns: 6
## $ year       &lt;int&gt; 812, 815, 831, 851, 853, 864, 866, 869, 889, 891, 892, 894,…
## $ doy        &lt;int&gt; 92, 105, 96, 108, 104, 100, 106, 95, 104, 109, 108, 106, 10…
## $ temp       &lt;dbl&gt; NA, NA, NA, 7.38, NA, 6.42, 6.44, NA, 6.83, 6.98, 7.11, 6.9…
## $ temp_upper &lt;dbl&gt; NA, NA, NA, 12.10, NA, 8.69, 8.11, NA, 8.48, 8.96, 9.11, 8.…
## $ temp_lower &lt;dbl&gt; NA, NA, NA, 2.66, NA, 4.14, 4.77, NA, 5.19, 5.00, 5.11, 5.5…
## $ B          &lt;bs[,17]&gt; &lt;bs[26 x 17]&gt;</code></pre>
<div class="sourceCode" id="cb231"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb231-1"><a href="geocentric-model.html#cb231-1" aria-hidden="true" tabindex="-1"></a>b4<span class="fl">.8</span> <span class="ot">&lt;-</span> </span>
<span id="cb231-2"><a href="geocentric-model.html#cb231-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">brm</span>(<span class="at">data =</span> d5,</span>
<span id="cb231-3"><a href="geocentric-model.html#cb231-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> gaussian, </span>
<span id="cb231-4"><a href="geocentric-model.html#cb231-4" aria-hidden="true" tabindex="-1"></a>      doy <span class="sc">~</span> <span class="dv">1</span><span class="sc">+</span>B,</span>
<span id="cb231-5"><a href="geocentric-model.html#cb231-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">100</span>, <span class="dv">10</span>), </span>
<span id="cb231-6"><a href="geocentric-model.html#cb231-6" aria-hidden="true" tabindex="-1"></a>                      <span class="at">class =</span> Intercept),</span>
<span id="cb231-7"><a href="geocentric-model.html#cb231-7" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">10</span>), <span class="at">class =</span> b),</span>
<span id="cb231-8"><a href="geocentric-model.html#cb231-8" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>), <span class="at">class =</span> sigma)),</span>
<span id="cb231-9"><a href="geocentric-model.html#cb231-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>, <span class="at">chains =</span> <span class="dv">4</span>, </span>
<span id="cb231-10"><a href="geocentric-model.html#cb231-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb231-11"><a href="geocentric-model.html#cb231-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">seed =</span> <span class="dv">4</span>,</span>
<span id="cb231-12"><a href="geocentric-model.html#cb231-12" aria-hidden="true" tabindex="-1"></a>      <span class="at">backend =</span> <span class="st">&quot;cmdstanr&quot;</span>,</span>
<span id="cb231-13"><a href="geocentric-model.html#cb231-13" aria-hidden="true" tabindex="-1"></a>      <span class="at">file =</span> <span class="st">&quot;output/Chapter4/b4.8&quot;</span>)</span>
<span id="cb231-14"><a href="geocentric-model.html#cb231-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb231-15"><a href="geocentric-model.html#cb231-15" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(b4<span class="fl">.8</span>)</span></code></pre></div>
<pre><code>##  Family: gaussian 
##   Links: mu = identity; sigma = identity 
## Formula: doy ~ 1 + B 
##    Data: d5 (Number of observations: 827) 
##   Draws: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
##          total post-warmup draws = 4000
## 
## Population-Level Effects: 
##           Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## Intercept   103.41      2.41    98.60   108.27 1.01      615     1127
## B1           -3.00      3.88   -10.44     4.74 1.00     1382     2369
## B2           -0.89      3.86    -8.39     6.76 1.01     1361     2409
## B3           -1.09      3.58    -8.41     5.99 1.01     1283     2343
## B4            4.74      2.89    -1.00    10.52 1.01      806     1660
## B5           -0.85      2.92    -6.77     5.05 1.01      913     1603
## B6            4.26      2.97    -1.68    10.13 1.01      821     1801
## B7           -5.33      2.86   -11.24     0.29 1.01      867     1560
## B8            7.76      2.84     2.25    13.26 1.01      779     1783
## B9           -1.04      2.92    -6.87     4.67 1.01      867     1611
## B10           2.96      3.00    -2.89     8.95 1.01      821     1754
## B11           4.63      2.92    -1.37    10.26 1.01      877     1664
## B12          -0.24      2.96    -5.87     5.50 1.01      937     1573
## B13           5.52      2.90    -0.17    11.21 1.01      873     1815
## B14           0.62      3.06    -5.36     6.62 1.01     1046     1674
## B15          -0.86      3.36    -7.36     5.66 1.01     1106     1963
## B16          -7.05      3.44   -13.60    -0.31 1.01     1146     2288
## B17          -7.70      3.26   -14.17    -1.33 1.01     1117     1968
## 
## Family Specific Parameters: 
##       Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## sigma     5.94      0.14     5.68     6.23 1.00     4215     2985
## 
## Draws were sampled using sample(hmc). For each parameter, Bulk_ESS
## and Tail_ESS are effective sample size measures, and Rhat is the potential
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<div class="sourceCode" id="cb233"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb233-1"><a href="geocentric-model.html#cb233-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(b4<span class="fl">.8</span>)</span></code></pre></div>
<p><img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-94-1.png" width="672" style="display: block; margin: auto;" /><img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-94-2.png" width="672" style="display: block; margin: auto;" /><img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-94-3.png" width="672" style="display: block; margin: auto;" /><img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-94-4.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb234"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb234-1"><a href="geocentric-model.html#cb234-1" aria-hidden="true" tabindex="-1"></a>samples_b48 <span class="ot">&lt;-</span> <span class="fu">posterior_samples</span>(b4<span class="fl">.8</span>)  </span></code></pre></div>
<p><br /></p>
<p>それぞれの基底関数に重みづけしたものを作図してみる。</p>
<div class="sourceCode" id="cb235"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb235-1"><a href="geocentric-model.html#cb235-1" aria-hidden="true" tabindex="-1"></a>samples_b48 <span class="sc">%&gt;%</span> </span>
<span id="cb235-2"><a href="geocentric-model.html#cb235-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>lp__, <span class="sc">-</span>sigma,<span class="sc">-</span>b_Intercept,<span class="sc">-</span>lprior) <span class="sc">%&gt;%</span> </span>
<span id="cb235-3"><a href="geocentric-model.html#cb235-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_names</span>(<span class="fu">c</span>(<span class="fu">str_c</span>(<span class="dv">0</span>,<span class="dv">1</span><span class="sc">:</span><span class="dv">9</span>),<span class="dv">10</span><span class="sc">:</span><span class="dv">17</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb235-4"><a href="geocentric-model.html#cb235-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">17</span>,</span>
<span id="cb235-5"><a href="geocentric-model.html#cb235-5" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">&quot;basis_function&quot;</span>,</span>
<span id="cb235-6"><a href="geocentric-model.html#cb235-6" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">&quot;basis_value&quot;</span>) <span class="ot">-&gt;</span>  samples_b48</span>
<span id="cb235-7"><a href="geocentric-model.html#cb235-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb235-8"><a href="geocentric-model.html#cb235-8" aria-hidden="true" tabindex="-1"></a>samples_b48 <span class="sc">%&gt;%</span> </span>
<span id="cb235-9"><a href="geocentric-model.html#cb235-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(basis_function) <span class="sc">%&gt;%</span> </span>
<span id="cb235-10"><a href="geocentric-model.html#cb235-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">weight =</span> <span class="fu">mean</span>(basis_value)) <span class="sc">%&gt;%</span> </span>
<span id="cb235-11"><a href="geocentric-model.html#cb235-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">full_join</span>(b, <span class="at">by =</span> <span class="st">&quot;basis_function&quot;</span>) <span class="ot">-&gt;</span> post_mean</span>
<span id="cb235-12"><a href="geocentric-model.html#cb235-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb235-13"><a href="geocentric-model.html#cb235-13" aria-hidden="true" tabindex="-1"></a>post_mean <span class="sc">%&gt;%</span> </span>
<span id="cb235-14"><a href="geocentric-model.html#cb235-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>year, <span class="at">y =</span> basis<span class="sc">*</span>weight, <span class="at">group=</span>basis_function))<span class="sc">+</span></span>
<span id="cb235-15"><a href="geocentric-model.html#cb235-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">color =</span> <span class="st">&quot;#ffb7c5&quot;</span>, <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>, </span>
<span id="cb235-16"><a href="geocentric-model.html#cb235-16" aria-hidden="true" tabindex="-1"></a>            <span class="at">size =</span> <span class="fl">1.5</span>)<span class="sc">+</span></span>
<span id="cb235-17"><a href="geocentric-model.html#cb235-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> knot_list, <span class="at">color =</span> <span class="st">&quot;white&quot;</span>,</span>
<span id="cb235-18"><a href="geocentric-model.html#cb235-18" aria-hidden="true" tabindex="-1"></a>             <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>)<span class="sc">+</span></span>
<span id="cb235-19"><a href="geocentric-model.html#cb235-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb235-20"><a href="geocentric-model.html#cb235-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">&quot;#4f455c&quot;</span>),</span>
<span id="cb235-21"><a href="geocentric-model.html#cb235-21" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid =</span> <span class="fu">element_blank</span>()) </span></code></pre></div>
<p><img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-95-1.png" width="672" style="display: block; margin: auto;" />
<br /></p>
<p>すべてを合計して信用区間付きで図示する。</p>
<div class="sourceCode" id="cb236"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb236-1"><a href="geocentric-model.html#cb236-1" aria-hidden="true" tabindex="-1"></a>f_b48 <span class="ot">&lt;-</span> <span class="fu">fitted</span>(b4<span class="fl">.8</span>, <span class="at">prob =</span> <span class="fu">c</span>(<span class="fl">0.015</span>,<span class="fl">0.5</span>,<span class="fl">0.985</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb236-2"><a href="geocentric-model.html#cb236-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb236-3"><a href="geocentric-model.html#cb236-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(d4)</span>
<span id="cb236-4"><a href="geocentric-model.html#cb236-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb236-5"><a href="geocentric-model.html#cb236-5" aria-hidden="true" tabindex="-1"></a>f_b48 <span class="sc">%&gt;%</span> </span>
<span id="cb236-6"><a href="geocentric-model.html#cb236-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>year, <span class="at">y =</span> doy, </span>
<span id="cb236-7"><a href="geocentric-model.html#cb236-7" aria-hidden="true" tabindex="-1"></a>             <span class="at">ymin =</span> Q1<span class="fl">.5</span>, <span class="at">ymax =</span> Q98<span class="fl">.5</span>))<span class="sc">+</span></span>
<span id="cb236-8"><a href="geocentric-model.html#cb236-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size=</span><span class="dv">3</span>, <span class="at">color =</span> <span class="st">&quot;#ffb7c5&quot;</span>, <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>)<span class="sc">+</span></span>
<span id="cb236-9"><a href="geocentric-model.html#cb236-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> knot_list, </span>
<span id="cb236-10"><a href="geocentric-model.html#cb236-10" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> <span class="st">&quot;white&quot;</span>, <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>)<span class="sc">+</span></span>
<span id="cb236-11"><a href="geocentric-model.html#cb236-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="fu">fixef</span>(b4<span class="fl">.8</span>)[<span class="dv">1</span>, <span class="dv">1</span>], </span>
<span id="cb236-12"><a href="geocentric-model.html#cb236-12" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> <span class="st">&quot;white&quot;</span>, <span class="at">linetype =</span> <span class="dv">2</span>)<span class="sc">+</span></span>
<span id="cb236-13"><a href="geocentric-model.html#cb236-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="at">fill =</span> <span class="st">&quot;white&quot;</span>, <span class="at">alpha =</span> <span class="dv">2</span><span class="sc">/</span><span class="dv">3</span>)<span class="sc">+</span></span>
<span id="cb236-14"><a href="geocentric-model.html#cb236-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;year&quot;</span>,</span>
<span id="cb236-15"><a href="geocentric-model.html#cb236-15" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;day in year&quot;</span>) <span class="sc">+</span></span>
<span id="cb236-16"><a href="geocentric-model.html#cb236-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb236-17"><a href="geocentric-model.html#cb236-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">&quot;#4f455c&quot;</span>),</span>
<span id="cb236-18"><a href="geocentric-model.html#cb236-18" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid =</span> <span class="fu">element_blank</span>())</span></code></pre></div>
<p><img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-96-1.png" width="672" style="display: block; margin: auto;" />
<br /></p>
</div>
</div>
<div id="practice-2" class="section level2 hasAnchor" number="4.7">
<h2><span class="header-section-number">4.7</span> Practice<a href="geocentric-model.html#practice-2" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="m1-2" class="section level3 hasAnchor" number="4.7.1">
<h3><span class="header-section-number">4.7.1</span> 4M1<a href="geocentric-model.html#m1-2" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<blockquote>
<p>For the model definition below, simulate observed y values from the prior (not the posterior).</p>
</blockquote>
$$
<span class="math display">\[\begin{aligned}

y_i &amp;\sim Normal(\mu, \sigma)\\
\mu &amp;\sim Normal(0,10)\\
\sigma &amp;\sim Exponential(1)

\end{aligned}\]</span>
<p>$$</p>
<div class="sourceCode" id="cb237"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb237-1"><a href="geocentric-model.html#cb237-1" aria-hidden="true" tabindex="-1"></a>n_sim <span class="ot">&lt;-</span> <span class="dv">10000</span></span>
<span id="cb237-2"><a href="geocentric-model.html#cb237-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb237-3"><a href="geocentric-model.html#cb237-3" aria-hidden="true" tabindex="-1"></a>sim <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">sigma_sim =</span> <span class="fu">rexp</span>(<span class="at">n=</span>n_sim, <span class="dv">1</span>),</span>
<span id="cb237-4"><a href="geocentric-model.html#cb237-4" aria-hidden="true" tabindex="-1"></a>              <span class="at">mu_sim =</span> <span class="fu">rnorm</span>(n_sim, <span class="dv">0</span>, <span class="dv">10</span>),</span>
<span id="cb237-5"><a href="geocentric-model.html#cb237-5" aria-hidden="true" tabindex="-1"></a>              <span class="at">y_sim =</span> <span class="fu">rnorm</span>(n_sim, mu_sim,sigma_sim))</span></code></pre></div>
</div>
<div id="m2-2" class="section level3 hasAnchor" number="4.7.2">
<h3><span class="header-section-number">4.7.2</span> 4M2<a href="geocentric-model.html#m2-2" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<blockquote>
<p>Trasnlate the model just above into a brms formula.</p>
</blockquote>
<div class="sourceCode" id="cb238"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb238-1"><a href="geocentric-model.html#cb238-1" aria-hidden="true" tabindex="-1"></a>b4M2 <span class="ot">&lt;-</span> <span class="fu">brm</span>(<span class="at">data =</span> sim,</span>
<span id="cb238-2"><a href="geocentric-model.html#cb238-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">family =</span> gaussian,</span>
<span id="cb238-3"><a href="geocentric-model.html#cb238-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">formula =</span> y_sim <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb238-4"><a href="geocentric-model.html#cb238-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>,<span class="dv">10</span>),<span class="at">class =</span> Intercept),</span>
<span id="cb238-5"><a href="geocentric-model.html#cb238-5" aria-hidden="true" tabindex="-1"></a>              <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>), <span class="at">class =</span> sigma)),</span>
<span id="cb238-6"><a href="geocentric-model.html#cb238-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">file =</span> <span class="st">&quot;output/Chapter4/b4M2&quot;</span>, </span>
<span id="cb238-7"><a href="geocentric-model.html#cb238-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">backend =</span> <span class="st">&quot;cmdstanr&quot;</span>)  </span></code></pre></div>
</div>
<div id="m4-2" class="section level3 hasAnchor" number="4.7.3">
<h3><span class="header-section-number">4.7.3</span> 4M4<a href="geocentric-model.html#m4-2" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<blockquote>
<p>A sample of students is measured for height each year for 3 years. After the third year, you want to fit a linear regression predicting height using year as a predictor. Write down the mathematical model definition for this regression, using any variable names and priors you choose. Be prepared to defend your choice of priors.</p>
</blockquote>
$$
<span class="math display">\[\begin{aligned}

h_{ij} &amp;\sim Normal(\mu_{ij},\sigma)\\
\mu_{ij} &amp;\sim \alpha + \beta(y_j - \bar{y})\\
\alpha &amp;\sim Normal(100,10)\\
\beta &amp;\sim Normal(0,10)\\
\sigma &amp;\sim Exponential(1)  

\end{aligned}\]</span>
<p>$$</p>
<p>身長は中央値なので，αは平均的な年（すなわち，2年目）の平均の身長を表す．身長はセンチメートルで測定され，標本はまだ成長過程にある子供たちであると仮定して，事前分布はNormal ( 100 , 10 ) を選んだ。 傾きは非常に曖昧である。ゼロを平均とし標準偏差を10とする事前分布は、成長（または縮小）の可能性の幅を表している。成長期には、身長の伸びは平均して6～13cm／年である。この標準偏差10は、成長速度が速い場合に予想される範囲を含んでいる。 最後に、σの指数事前分布は、平均0で標準偏差偏差を1と仮定している。事前の予測シミュレーションも、現在の仮定からすると、妥当な回帰直線を与えているように見える。</p>
<div class="sourceCode" id="cb239"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb239-1"><a href="geocentric-model.html#cb239-1" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">50</span></span>
<span id="cb239-2"><a href="geocentric-model.html#cb239-2" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">group =</span> <span class="fu">seq_len</span>(n),</span>
<span id="cb239-3"><a href="geocentric-model.html#cb239-3" aria-hidden="true" tabindex="-1"></a>       <span class="at">alpha =</span> <span class="fu">rnorm</span>(n, <span class="dv">100</span>, <span class="dv">10</span>),</span>
<span id="cb239-4"><a href="geocentric-model.html#cb239-4" aria-hidden="true" tabindex="-1"></a>       <span class="at">beta =</span> <span class="fu">rnorm</span>(n, <span class="dv">0</span>, <span class="dv">10</span>),</span>
<span id="cb239-5"><a href="geocentric-model.html#cb239-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">sigma =</span> <span class="fu">rexp</span>(n, <span class="dv">1</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb239-6"><a href="geocentric-model.html#cb239-6" aria-hidden="true" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">expand</span>(<span class="fu">nesting</span>(group, alpha, beta, sigma), <span class="at">year =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb239-7"><a href="geocentric-model.html#cb239-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">height =</span> <span class="fu">rnorm</span>(<span class="fu">n</span>(), alpha <span class="sc">+</span> beta <span class="sc">*</span> (year <span class="sc">-</span> <span class="fu">mean</span>(year)), sigma)) <span class="sc">%&gt;%</span></span>
<span id="cb239-8"><a href="geocentric-model.html#cb239-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> height, <span class="at">group =</span> group)) <span class="sc">+</span></span>
<span id="cb239-9"><a href="geocentric-model.html#cb239-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb239-10"><a href="geocentric-model.html#cb239-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Year&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Height&quot;</span>)</span></code></pre></div>
<p><img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-99-1.png" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="m5-2" class="section level3 hasAnchor" number="4.7.4">
<h3><span class="header-section-number">4.7.4</span> 4M5<a href="geocentric-model.html#m5-2" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<blockquote>
<p>Now suppose I remind you that every student got taller each year. Does this information lead you to change your choice of priors? How?</p>
</blockquote>
<p>年が増えると必ず身長も増加するので，βは正になることが分かっている．したがって，事前分布はこれを反映するように，例えば対数正規分布を用いるべきである。
この事前分布では，身長の伸びの期待値は年間約3cmになりえ，89％最高密度区間は年間0.87cmから5.18cmである。
<span class="math display">\[
\beta ∼ logNormal(1,0.5)
\]</span></p>
<div class="sourceCode" id="cb240"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb240-1"><a href="geocentric-model.html#cb240-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidybayes)</span>
<span id="cb240-2"><a href="geocentric-model.html#cb240-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb240-3"><a href="geocentric-model.html#cb240-3" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb240-4"><a href="geocentric-model.html#cb240-4" aria-hidden="true" tabindex="-1"></a>samples <span class="ot">&lt;-</span> <span class="fu">rlnorm</span>(<span class="fl">1e8</span>, <span class="dv">1</span>, <span class="fl">0.5</span>)</span>
<span id="cb240-5"><a href="geocentric-model.html#cb240-5" aria-hidden="true" tabindex="-1"></a>bounds <span class="ot">&lt;-</span> <span class="fu">mean_hdi</span>(samples, <span class="at">.width =</span> <span class="fl">0.89</span>)</span>
<span id="cb240-6"><a href="geocentric-model.html#cb240-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb240-7"><a href="geocentric-model.html#cb240-7" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb240-8"><a href="geocentric-model.html#cb240-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_function</span>(<span class="at">data =</span> <span class="fu">tibble</span>(<span class="at">x =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">10</span>)), <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> x),</span>
<span id="cb240-9"><a href="geocentric-model.html#cb240-9" aria-hidden="true" tabindex="-1"></a>                <span class="at">geom =</span> <span class="st">&quot;line&quot;</span>, <span class="at">fun =</span> dlnorm,</span>
<span id="cb240-10"><a href="geocentric-model.html#cb240-10" aria-hidden="true" tabindex="-1"></a>                <span class="at">args =</span> <span class="fu">list</span>(<span class="at">meanlog =</span> <span class="dv">1</span>, <span class="at">sdlog =</span> <span class="fl">0.5</span>)) <span class="sc">+</span></span>
<span id="cb240-11"><a href="geocentric-model.html#cb240-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="at">data =</span> <span class="fu">tibble</span>(<span class="at">x =</span> <span class="fu">seq</span>(bounds<span class="sc">$</span>ymin, bounds<span class="sc">$</span>ymax, <span class="fl">0.01</span>)),</span>
<span id="cb240-12"><a href="geocentric-model.html#cb240-12" aria-hidden="true" tabindex="-1"></a>              <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">ymin =</span> <span class="dv">0</span>, <span class="at">ymax =</span> <span class="fu">dlnorm</span>(x, <span class="dv">1</span>, <span class="fl">0.5</span>)),</span>
<span id="cb240-13"><a href="geocentric-model.html#cb240-13" aria-hidden="true" tabindex="-1"></a>              <span class="at">alpha =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb240-14"><a href="geocentric-model.html#cb240-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">10</span>, <span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb240-15"><a href="geocentric-model.html#cb240-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="fu">expression</span>(beta), <span class="at">y =</span> <span class="st">&quot;Density&quot;</span>)</span></code></pre></div>
<p><img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-100-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>対数正規事前分布を用いたもっともらしい直線の事前予測シミュレーションは、これらの事前分布が依然としてもっともらしい値を示していることを示している。ほとんどの線は、事前制約のために正である。しかし、平均値の周辺にばらつきがあるため、いくつかの線は低くなっている。もし、学生が身長を縮めることが本当に不可能であれば、このようなデータは測定誤差から生じるかもしれない。</p>
<div class="sourceCode" id="cb241"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb241-1"><a href="geocentric-model.html#cb241-1" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">50</span></span>
<span id="cb241-2"><a href="geocentric-model.html#cb241-2" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">group =</span> <span class="fu">seq_len</span>(n),</span>
<span id="cb241-3"><a href="geocentric-model.html#cb241-3" aria-hidden="true" tabindex="-1"></a>       <span class="at">alpha =</span> <span class="fu">rnorm</span>(n, <span class="dv">100</span>, <span class="dv">10</span>),</span>
<span id="cb241-4"><a href="geocentric-model.html#cb241-4" aria-hidden="true" tabindex="-1"></a>       <span class="at">beta =</span> <span class="fu">rlnorm</span>(n, <span class="dv">1</span>, <span class="fl">0.5</span>),</span>
<span id="cb241-5"><a href="geocentric-model.html#cb241-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">sigma =</span> <span class="fu">rexp</span>(n, <span class="dv">1</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb241-6"><a href="geocentric-model.html#cb241-6" aria-hidden="true" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">expand</span>(<span class="fu">nesting</span>(group, alpha, beta, sigma), <span class="at">year =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb241-7"><a href="geocentric-model.html#cb241-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">height =</span> <span class="fu">rnorm</span>(<span class="fu">n</span>(), alpha <span class="sc">+</span> beta <span class="sc">*</span> (year <span class="sc">-</span> <span class="fu">mean</span>(year)), sigma)) <span class="sc">%&gt;%</span> </span>
<span id="cb241-8"><a href="geocentric-model.html#cb241-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> height, <span class="at">group =</span> group)) <span class="sc">+</span></span>
<span id="cb241-9"><a href="geocentric-model.html#cb241-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb241-10"><a href="geocentric-model.html#cb241-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Year&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Height&quot;</span>)</span></code></pre></div>
<p><img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-101-1.png" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="m6-1" class="section level3 hasAnchor" number="4.7.5">
<h3><span class="header-section-number">4.7.5</span> 4M6<a href="geocentric-model.html#m6-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<blockquote>
<p>Now suppose I tell you that the variance among heights for students of the same age is never more than 64cm. How does this lead you to revise your priors?</p>
</blockquote>
<p>分散64cmは標準偏差8cmに相当する。現在の<span class="math inline">\(\sigma \sim Exponential(1)\)</span> の事前分布では、確率的に8より大きい値にはならない。しかし、理論的には可能である。もしこの方法で本当に分散を抑制したいのであれば、一様分布<span class="math inline">\(Uniform(0,8)\)</span>を事前分布を使用することができます。これは、64cmより大きい分散をもたらすすべての値を排除することになる。</p>
</div>
<div id="m7-1" class="section level3 hasAnchor" number="4.7.6">
<h3><span class="header-section-number">4.7.6</span> 4M7<a href="geocentric-model.html#m7-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<blockquote>
<p>Refit model m4.3 from the chapter, but omit the mean weight xbar this time. Compare the new model’s posterior to that of the original model. In particular, look at the covariance among the parameters. What is different? Then compare the posterior predictions of both models.</p>
</blockquote>
<p>b4.3で中心化を行わなかったら…。
結果はほとんど変わらない。</p>
<div class="sourceCode" id="cb242"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb242-1"><a href="geocentric-model.html#cb242-1" aria-hidden="true" tabindex="-1"></a>b4<span class="fl">.3</span>_p <span class="ot">&lt;-</span> </span>
<span id="cb242-2"><a href="geocentric-model.html#cb242-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">brm</span>(<span class="at">data =</span> d2, </span>
<span id="cb242-3"><a href="geocentric-model.html#cb242-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> gaussian,</span>
<span id="cb242-4"><a href="geocentric-model.html#cb242-4" aria-hidden="true" tabindex="-1"></a>      height <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> weight,</span>
<span id="cb242-5"><a href="geocentric-model.html#cb242-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">178</span>, <span class="dv">20</span>),<span class="at">clas =</span>Intercept),</span>
<span id="cb242-6"><a href="geocentric-model.html#cb242-6" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">lognormal</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">class =</span> b,<span class="at">lb=</span><span class="dv">0</span>),</span>
<span id="cb242-7"><a href="geocentric-model.html#cb242-7" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">cauchy</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">class =</span> sigma)),</span>
<span id="cb242-8"><a href="geocentric-model.html#cb242-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">iter =</span> <span class="dv">28000</span>, <span class="at">warmup =</span> <span class="dv">27000</span>, <span class="at">chains =</span> <span class="dv">4</span>, </span>
<span id="cb242-9"><a href="geocentric-model.html#cb242-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">cores =</span> <span class="dv">4</span>, <span class="at">seed =</span> <span class="dv">4</span>,</span>
<span id="cb242-10"><a href="geocentric-model.html#cb242-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">backend =</span> <span class="st">&quot;cmdstanr&quot;</span>,</span>
<span id="cb242-11"><a href="geocentric-model.html#cb242-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">file=</span><span class="st">&quot;output/Chapter4/b4.3_p&quot;</span>)</span></code></pre></div>
<p>結果</p>
<div class="sourceCode" id="cb243"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb243-1"><a href="geocentric-model.html#cb243-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(b4<span class="fl">.3</span>)</span></code></pre></div>
<pre><code>##  Family: gaussian 
##   Links: mu = identity; sigma = identity 
## Formula: height ~ 1 + weight_c 
##    Data: d2 (Number of observations: 352) 
##   Draws: 4 chains, each with iter = 28000; warmup = 27000; thin = 1;
##          total post-warmup draws = 4000
## 
## Population-Level Effects: 
##           Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## Intercept   154.59      0.28   154.05   155.13 1.00     4417     3230
## weight_c      0.90      0.04     0.82     0.98 1.00     4799     3261
## 
## Family Specific Parameters: 
##       Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## sigma     5.09      0.20     4.73     5.49 1.00     4592     3189
## 
## Draws were sampled using sample(hmc). For each parameter, Bulk_ESS
## and Tail_ESS are effective sample size measures, and Rhat is the potential
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<div class="sourceCode" id="cb245"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb245-1"><a href="geocentric-model.html#cb245-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(b4<span class="fl">.3</span>_p)</span></code></pre></div>
<pre><code>##  Family: gaussian 
##   Links: mu = identity; sigma = identity 
## Formula: height ~ 1 + weight 
##    Data: d2 (Number of observations: 352) 
##   Draws: 4 chains, each with iter = 28000; warmup = 27000; thin = 1;
##          total post-warmup draws = 4000
## 
## Population-Level Effects: 
##           Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## Intercept   114.02      1.92   110.30   117.83 1.00     3582     2723
## weight        0.90      0.04     0.82     0.98 1.00     3584     2867
## 
## Family Specific Parameters: 
##       Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## sigma     5.09      0.20     4.73     5.48 1.00     4119     2929
## 
## Draws were sampled using sample(hmc). For each parameter, Bulk_ESS
## and Tail_ESS are effective sample size measures, and Rhat is the potential
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<p>共分散</p>
<div class="sourceCode" id="cb247"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb247-1"><a href="geocentric-model.html#cb247-1" aria-hidden="true" tabindex="-1"></a><span class="fu">posterior_samples</span>(b4<span class="fl">.3</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb247-2"><a href="geocentric-model.html#cb247-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb247-3"><a href="geocentric-model.html#cb247-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>lp__) <span class="sc">%&gt;%</span> </span>
<span id="cb247-4"><a href="geocentric-model.html#cb247-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cov</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb247-5"><a href="geocentric-model.html#cb247-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">round</span>(<span class="dv">3</span>)</span></code></pre></div>
<pre><code>##             b_Intercept b_weight_c  sigma lprior
## b_Intercept       0.077      0.000  0.000  0.004
## b_weight_c        0.000      0.002  0.000 -0.002
## sigma             0.000      0.000  0.038 -0.014
## lprior            0.004     -0.002 -0.014  0.007</code></pre>
<div class="sourceCode" id="cb249"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb249-1"><a href="geocentric-model.html#cb249-1" aria-hidden="true" tabindex="-1"></a><span class="fu">posterior_samples</span>(b4<span class="fl">.3</span>_p) <span class="sc">%&gt;%</span> </span>
<span id="cb249-2"><a href="geocentric-model.html#cb249-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb249-3"><a href="geocentric-model.html#cb249-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>lp__) <span class="sc">%&gt;%</span> </span>
<span id="cb249-4"><a href="geocentric-model.html#cb249-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cov</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb249-5"><a href="geocentric-model.html#cb249-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">round</span>(<span class="dv">3</span>)</span></code></pre></div>
<pre><code>##             b_Intercept b_weight  sigma lprior
## b_Intercept       3.671   -0.080 -0.006  0.086
## b_weight         -0.080    0.002  0.000 -0.002
## sigma            -0.006    0.000  0.039 -0.015
## lprior            0.086   -0.002 -0.015  0.008</code></pre>
<p><br /></p>
<p>事後分布から回帰直線と信用区間、予測区間を作図。</p>
<div class="sourceCode" id="cb251"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb251-1"><a href="geocentric-model.html#cb251-1" aria-hidden="true" tabindex="-1"></a>weight_seq <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">weight =</span> <span class="fu">seq</span>(<span class="dv">25</span>,<span class="dv">75</span>,<span class="at">length.out=</span><span class="dv">100</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb251-2"><a href="geocentric-model.html#cb251-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">weight_c =</span> weight <span class="sc">-</span> <span class="fu">mean</span>(d2<span class="sc">$</span>weight))</span>
<span id="cb251-3"><a href="geocentric-model.html#cb251-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-4"><a href="geocentric-model.html#cb251-4" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(</span>
<span id="cb251-5"><a href="geocentric-model.html#cb251-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fitted</span>(b4<span class="fl">.3</span>, <span class="at">newdata =</span> weight_seq) <span class="sc">%&gt;%</span></span>
<span id="cb251-6"><a href="geocentric-model.html#cb251-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb251-7"><a href="geocentric-model.html#cb251-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(weight_seq) <span class="sc">%&gt;%</span> </span>
<span id="cb251-8"><a href="geocentric-model.html#cb251-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">type =</span> <span class="st">&quot;Centered&quot;</span>),</span>
<span id="cb251-9"><a href="geocentric-model.html#cb251-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fitted</span>(b4<span class="fl">.3</span>_p, <span class="at">newdata =</span> weight_seq) <span class="sc">%&gt;%</span></span>
<span id="cb251-10"><a href="geocentric-model.html#cb251-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb251-11"><a href="geocentric-model.html#cb251-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(weight_seq) <span class="sc">%&gt;%</span> </span>
<span id="cb251-12"><a href="geocentric-model.html#cb251-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">type =</span> <span class="st">&quot;Non-centered&quot;</span>)</span>
<span id="cb251-13"><a href="geocentric-model.html#cb251-13" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb251-14"><a href="geocentric-model.html#cb251-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-15"><a href="geocentric-model.html#cb251-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-16"><a href="geocentric-model.html#cb251-16" aria-hidden="true" tabindex="-1"></a>pred <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(</span>
<span id="cb251-17"><a href="geocentric-model.html#cb251-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">predict</span>(b4<span class="fl">.3</span>, <span class="at">newdata =</span> weight_seq) <span class="sc">%&gt;%</span></span>
<span id="cb251-18"><a href="geocentric-model.html#cb251-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb251-19"><a href="geocentric-model.html#cb251-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(weight_seq) <span class="sc">%&gt;%</span> </span>
<span id="cb251-20"><a href="geocentric-model.html#cb251-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">type =</span> <span class="st">&quot;Centered&quot;</span>),</span>
<span id="cb251-21"><a href="geocentric-model.html#cb251-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">predict</span>(b4<span class="fl">.3</span>_p, <span class="at">newdata =</span> weight_seq) <span class="sc">%&gt;%</span></span>
<span id="cb251-22"><a href="geocentric-model.html#cb251-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb251-23"><a href="geocentric-model.html#cb251-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(weight_seq) <span class="sc">%&gt;%</span> </span>
<span id="cb251-24"><a href="geocentric-model.html#cb251-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">type =</span> <span class="st">&quot;Non-centered&quot;</span>)</span>
<span id="cb251-25"><a href="geocentric-model.html#cb251-25" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb251-26"><a href="geocentric-model.html#cb251-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-27"><a href="geocentric-model.html#cb251-27" aria-hidden="true" tabindex="-1"></a>d2 <span class="sc">%&gt;%</span> </span>
<span id="cb251-28"><a href="geocentric-model.html#cb251-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> weight, <span class="at">y =</span> height))<span class="sc">+</span></span>
<span id="cb251-29"><a href="geocentric-model.html#cb251-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha=</span><span class="dv">2</span><span class="sc">/</span><span class="dv">3</span>,<span class="at">shape=</span><span class="dv">1</span>,<span class="at">color=</span><span class="st">&quot;navyblue&quot;</span>)<span class="sc">+</span></span>
<span id="cb251-30"><a href="geocentric-model.html#cb251-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="at">data=</span>pred, </span>
<span id="cb251-31"><a href="geocentric-model.html#cb251-31" aria-hidden="true" tabindex="-1"></a>              <span class="fu">aes</span>(<span class="at">y=</span>Estimate,<span class="at">ymin =</span> Q2<span class="fl">.5</span>, </span>
<span id="cb251-32"><a href="geocentric-model.html#cb251-32" aria-hidden="true" tabindex="-1"></a>                  <span class="at">ymax =</span>Q97<span class="fl">.5</span>),</span>
<span id="cb251-33"><a href="geocentric-model.html#cb251-33" aria-hidden="true" tabindex="-1"></a>              <span class="at">fill =</span> <span class="st">&quot;black&quot;</span>, <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">5</span>)<span class="sc">+</span></span>
<span id="cb251-34"><a href="geocentric-model.html#cb251-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="at">data=</span>fit, </span>
<span id="cb251-35"><a href="geocentric-model.html#cb251-35" aria-hidden="true" tabindex="-1"></a>              <span class="fu">aes</span>(<span class="at">y=</span>Estimate,</span>
<span id="cb251-36"><a href="geocentric-model.html#cb251-36" aria-hidden="true" tabindex="-1"></a>                  <span class="at">ymin =</span> Q2<span class="fl">.5</span>, <span class="at">ymax =</span>Q97<span class="fl">.5</span>),</span>
<span id="cb251-37"><a href="geocentric-model.html#cb251-37" aria-hidden="true" tabindex="-1"></a>              <span class="at">fill =</span> <span class="st">&quot;black&quot;</span>, <span class="at">alpha =</span> <span class="dv">3</span><span class="sc">/</span><span class="dv">5</span>)<span class="sc">+</span></span>
<span id="cb251-38"><a href="geocentric-model.html#cb251-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data=</span>pred, <span class="fu">aes</span>(<span class="at">x=</span>weight, <span class="at">y=</span> Estimate),</span>
<span id="cb251-39"><a href="geocentric-model.html#cb251-39" aria-hidden="true" tabindex="-1"></a>            <span class="at">size=</span><span class="fl">1.5</span>)<span class="sc">+</span></span>
<span id="cb251-40"><a href="geocentric-model.html#cb251-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb251-41"><a href="geocentric-model.html#cb251-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>)<span class="sc">+</span></span>
<span id="cb251-42"><a href="geocentric-model.html#cb251-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>type)</span></code></pre></div>
<p><img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-105-1.png" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="m8" class="section level3 hasAnchor" number="4.7.7">
<h3><span class="header-section-number">4.7.7</span> 4M8<a href="geocentric-model.html#m8" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<blockquote>
<p>In the chapter, we used 15 knots with the cherry blossom spline. Increase the number of knots and observe what happens to the resulting spline. Then adjust also the width of the prior on the weights—change the standard deviation of the prior and watch what happens. What do you think the combination of know number and the prior on the weights controls?</p>
</blockquote>
<p>まず、この章のノット15個のSplineモデルをもう一度作成する。　　</p>
<div class="sourceCode" id="cb252"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb252-1"><a href="geocentric-model.html#cb252-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(splines)</span>
<span id="cb252-2"><a href="geocentric-model.html#cb252-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb252-3"><a href="geocentric-model.html#cb252-3" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(cherry_blossoms)</span>
<span id="cb252-4"><a href="geocentric-model.html#cb252-4" aria-hidden="true" tabindex="-1"></a>cb_dat <span class="ot">&lt;-</span> cherry_blossoms <span class="sc">%&gt;%</span></span>
<span id="cb252-5"><a href="geocentric-model.html#cb252-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drop_na</span>(doy)</span>
<span id="cb252-6"><a href="geocentric-model.html#cb252-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb252-7"><a href="geocentric-model.html#cb252-7" aria-hidden="true" tabindex="-1"></a><span class="co"># original m4.7 model</span></span>
<span id="cb252-8"><a href="geocentric-model.html#cb252-8" aria-hidden="true" tabindex="-1"></a>knots_15 <span class="ot">&lt;-</span> <span class="fu">quantile</span>(cb_dat<span class="sc">$</span>year, <span class="at">probs =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="at">length.out =</span> <span class="dv">15</span>))</span>
<span id="cb252-9"><a href="geocentric-model.html#cb252-9" aria-hidden="true" tabindex="-1"></a>B_15 <span class="ot">&lt;-</span> <span class="fu">bs</span>(cb_dat<span class="sc">$</span>year, <span class="at">knots =</span> knots_15[<span class="sc">-</span><span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">15</span>)],</span>
<span id="cb252-10"><a href="geocentric-model.html#cb252-10" aria-hidden="true" tabindex="-1"></a>           <span class="at">degree =</span> <span class="dv">3</span>, <span class="at">intercept =</span> <span class="cn">TRUE</span>)</span>
<span id="cb252-11"><a href="geocentric-model.html#cb252-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb252-12"><a href="geocentric-model.html#cb252-12" aria-hidden="true" tabindex="-1"></a>cb_dat_15 <span class="ot">&lt;-</span> cb_dat <span class="sc">%&gt;%</span> </span>
<span id="cb252-13"><a href="geocentric-model.html#cb252-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">B =</span> B_15)</span>
<span id="cb252-14"><a href="geocentric-model.html#cb252-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb252-15"><a href="geocentric-model.html#cb252-15" aria-hidden="true" tabindex="-1"></a>b4M8 <span class="ot">&lt;-</span> <span class="fu">brm</span>(doy <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> B, <span class="at">data =</span> cb_dat_15, <span class="at">family =</span> gaussian,</span>
<span id="cb252-16"><a href="geocentric-model.html#cb252-16" aria-hidden="true" tabindex="-1"></a>            <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">100</span>, <span class="dv">10</span>), <span class="at">class =</span> Intercept),</span>
<span id="cb252-17"><a href="geocentric-model.html#cb252-17" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">10</span>), <span class="at">class =</span> b),</span>
<span id="cb252-18"><a href="geocentric-model.html#cb252-18" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>), <span class="at">class =</span> sigma)),</span>
<span id="cb252-19"><a href="geocentric-model.html#cb252-19" aria-hidden="true" tabindex="-1"></a>            <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>, <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>, <span class="at">seed =</span> <span class="dv">1234</span>,</span>
<span id="cb252-20"><a href="geocentric-model.html#cb252-20" aria-hidden="true" tabindex="-1"></a>            <span class="at">backend =</span> <span class="st">&quot;cmdstanr&quot;</span>,</span>
<span id="cb252-21"><a href="geocentric-model.html#cb252-21" aria-hidden="true" tabindex="-1"></a>            <span class="at">file =</span> <span class="st">&quot;output/Chapter4/b4M8&quot;</span>)  </span></code></pre></div>
<p>モデルの結果を可視化する。</p>
<div class="sourceCode" id="cb253"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb253-1"><a href="geocentric-model.html#cb253-1" aria-hidden="true" tabindex="-1"></a>original_draws <span class="ot">&lt;-</span> cb_dat_15 <span class="sc">%&gt;%</span> </span>
<span id="cb253-2"><a href="geocentric-model.html#cb253-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_epred_draws</span>(b4M8) <span class="sc">%&gt;%</span> </span>
<span id="cb253-3"><a href="geocentric-model.html#cb253-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="fu">mean_hdi</span>(.epred, <span class="at">.width =</span> <span class="fl">0.89</span>),</span>
<span id="cb253-4"><a href="geocentric-model.html#cb253-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">.groups =</span> <span class="st">&quot;drop&quot;</span>)</span>
<span id="cb253-5"><a href="geocentric-model.html#cb253-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb253-6"><a href="geocentric-model.html#cb253-6" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(original_draws, <span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> doy)) <span class="sc">+</span></span>
<span id="cb253-7"><a href="geocentric-model.html#cb253-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> knots_15, <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb253-8"><a href="geocentric-model.html#cb253-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="fu">fixef</span>(b4M8)[<span class="dv">1</span>, <span class="dv">1</span>], <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>) <span class="sc">+</span></span>
<span id="cb253-9"><a href="geocentric-model.html#cb253-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb253-10"><a href="geocentric-model.html#cb253-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> ymin, <span class="at">ymax =</span> ymax), <span class="at">fill =</span> <span class="st">&quot;#009FB7&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb253-11"><a href="geocentric-model.html#cb253-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Year&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Day in Year&quot;</span>)</span></code></pre></div>
<p><img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-107-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>次に2つ追加でモデリングする。一つは、ノット数を30にしたもの、もう一つは事前分布の標準偏差を狭くしたものである。</p>
<p><strong>30ノット</strong></p>
<div class="sourceCode" id="cb254"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb254-1"><a href="geocentric-model.html#cb254-1" aria-hidden="true" tabindex="-1"></a>knots_30 <span class="ot">&lt;-</span> <span class="fu">quantile</span>(cb_dat<span class="sc">$</span>year, <span class="at">probs =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="at">length.out =</span> <span class="dv">30</span>))</span>
<span id="cb254-2"><a href="geocentric-model.html#cb254-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb254-3"><a href="geocentric-model.html#cb254-3" aria-hidden="true" tabindex="-1"></a>B_30 <span class="ot">&lt;-</span> <span class="fu">bs</span>(cb_dat<span class="sc">$</span>year, <span class="at">knots =</span> knots_30[<span class="sc">-</span><span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">30</span>)],</span>
<span id="cb254-4"><a href="geocentric-model.html#cb254-4" aria-hidden="true" tabindex="-1"></a>           <span class="at">degree =</span> <span class="dv">3</span>, <span class="at">intercept =</span> <span class="cn">TRUE</span>)</span>
<span id="cb254-5"><a href="geocentric-model.html#cb254-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb254-6"><a href="geocentric-model.html#cb254-6" aria-hidden="true" tabindex="-1"></a>cb_dat_30 <span class="ot">&lt;-</span> cb_dat <span class="sc">%&gt;%</span> </span>
<span id="cb254-7"><a href="geocentric-model.html#cb254-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">B =</span> B_30)</span>
<span id="cb254-8"><a href="geocentric-model.html#cb254-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb254-9"><a href="geocentric-model.html#cb254-9" aria-hidden="true" tabindex="-1"></a>b4M8_b <span class="ot">&lt;-</span> <span class="fu">brm</span>(doy <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> B, <span class="at">data =</span> cb_dat_30, <span class="at">family =</span> gaussian,</span>
<span id="cb254-10"><a href="geocentric-model.html#cb254-10" aria-hidden="true" tabindex="-1"></a>               <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">100</span>, <span class="dv">10</span>), <span class="at">class =</span> Intercept),</span>
<span id="cb254-11"><a href="geocentric-model.html#cb254-11" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">10</span>), <span class="at">class =</span> b),</span>
<span id="cb254-12"><a href="geocentric-model.html#cb254-12" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>), <span class="at">class =</span> sigma)),</span>
<span id="cb254-13"><a href="geocentric-model.html#cb254-13" aria-hidden="true" tabindex="-1"></a>               <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>, <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>, <span class="at">seed =</span> <span class="dv">1234</span>,</span>
<span id="cb254-14"><a href="geocentric-model.html#cb254-14" aria-hidden="true" tabindex="-1"></a>               <span class="at">backend =</span> <span class="st">&quot;cmdstanr&quot;</span>,</span>
<span id="cb254-15"><a href="geocentric-model.html#cb254-15" aria-hidden="true" tabindex="-1"></a>               <span class="at">file =</span> <span class="st">&quot;output/Chapter4/b4M8_b&quot;</span>)</span></code></pre></div>
<p><strong>事前分布を狭く</strong></p>
<div class="sourceCode" id="cb255"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb255-1"><a href="geocentric-model.html#cb255-1" aria-hidden="true" tabindex="-1"></a>b4M8_c <span class="ot">&lt;-</span> <span class="fu">brm</span>(doy <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> B, <span class="at">data =</span> cb_dat_30, <span class="at">family =</span> gaussian,</span>
<span id="cb255-2"><a href="geocentric-model.html#cb255-2" aria-hidden="true" tabindex="-1"></a>                <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">100</span>, <span class="dv">10</span>), <span class="at">class =</span> Intercept),</span>
<span id="cb255-3"><a href="geocentric-model.html#cb255-3" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">2</span>), <span class="at">class =</span> b),</span>
<span id="cb255-4"><a href="geocentric-model.html#cb255-4" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>), <span class="at">class =</span> sigma)),</span>
<span id="cb255-5"><a href="geocentric-model.html#cb255-5" aria-hidden="true" tabindex="-1"></a>                <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>, <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>, <span class="at">seed =</span> <span class="dv">1234</span>,</span>
<span id="cb255-6"><a href="geocentric-model.html#cb255-6" aria-hidden="true" tabindex="-1"></a>              <span class="at">backend =</span> <span class="st">&quot;cmdstanr&quot;</span>,</span>
<span id="cb255-7"><a href="geocentric-model.html#cb255-7" aria-hidden="true" tabindex="-1"></a>                <span class="at">file =</span> <span class="st">&quot;output/Chapter4/b4M8_c&quot;</span>)</span></code></pre></div>
<p>それぞれのモデルを可視化して比較する。ノット数を増やすとより回帰曲線がくねくねになる。また、事前分布の幅が狭くなると、事後分布の信用区間も狭くなる。</p>
<div class="sourceCode" id="cb256"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb256-1"><a href="geocentric-model.html#cb256-1" aria-hidden="true" tabindex="-1"></a>spline_15 <span class="ot">&lt;-</span> original_draws <span class="sc">%&gt;%</span></span>
<span id="cb256-2"><a href="geocentric-model.html#cb256-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>B) <span class="sc">%&gt;%</span> </span>
<span id="cb256-3"><a href="geocentric-model.html#cb256-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">knots =</span> <span class="st">&quot;15 knots (original model)&quot;</span>)</span>
<span id="cb256-4"><a href="geocentric-model.html#cb256-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb256-5"><a href="geocentric-model.html#cb256-5" aria-hidden="true" tabindex="-1"></a>spline_30 <span class="ot">&lt;-</span> cb_dat_30 <span class="sc">%&gt;%</span> </span>
<span id="cb256-6"><a href="geocentric-model.html#cb256-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_epred_draws</span>(b4M8_b) <span class="sc">%&gt;%</span> </span>
<span id="cb256-7"><a href="geocentric-model.html#cb256-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="fu">mean_hdi</span>(.epred, <span class="at">.width =</span> <span class="fl">0.89</span>),</span>
<span id="cb256-8"><a href="geocentric-model.html#cb256-8" aria-hidden="true" tabindex="-1"></a>            <span class="at">.groups =</span> <span class="st">&quot;drop&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb256-9"><a href="geocentric-model.html#cb256-9" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>B) <span class="sc">%&gt;%</span> </span>
<span id="cb256-10"><a href="geocentric-model.html#cb256-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">knots =</span> <span class="st">&quot;30 knots&quot;</span>)</span>
<span id="cb256-11"><a href="geocentric-model.html#cb256-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb256-12"><a href="geocentric-model.html#cb256-12" aria-hidden="true" tabindex="-1"></a>spline_30p <span class="ot">&lt;-</span> cb_dat_30 <span class="sc">%&gt;%</span> </span>
<span id="cb256-13"><a href="geocentric-model.html#cb256-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_epred_draws</span>(b4M8_c) <span class="sc">%&gt;%</span> </span>
<span id="cb256-14"><a href="geocentric-model.html#cb256-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="fu">mean_hdi</span>(.epred, <span class="at">.width =</span> <span class="fl">0.89</span>),</span>
<span id="cb256-15"><a href="geocentric-model.html#cb256-15" aria-hidden="true" tabindex="-1"></a>            <span class="at">.groups =</span> <span class="st">&quot;drop&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb256-16"><a href="geocentric-model.html#cb256-16" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>B) <span class="sc">%&gt;%</span> </span>
<span id="cb256-17"><a href="geocentric-model.html#cb256-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">knots =</span> <span class="st">&quot;30 knots; Tight prior&quot;</span>)</span>
<span id="cb256-18"><a href="geocentric-model.html#cb256-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb256-19"><a href="geocentric-model.html#cb256-19" aria-hidden="true" tabindex="-1"></a>all_splines <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(spline_15, spline_30, spline_30p)</span>
<span id="cb256-20"><a href="geocentric-model.html#cb256-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb256-21"><a href="geocentric-model.html#cb256-21" aria-hidden="true" tabindex="-1"></a><span class="co"># make plot</span></span>
<span id="cb256-22"><a href="geocentric-model.html#cb256-22" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(all_splines, <span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> doy)) <span class="sc">+</span></span>
<span id="cb256-23"><a href="geocentric-model.html#cb256-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb256-24"><a href="geocentric-model.html#cb256-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> ymin, <span class="at">ymax =</span> ymax), <span class="at">fill =</span> <span class="st">&quot;#009FB7&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb256-25"><a href="geocentric-model.html#cb256-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>knots, <span class="at">ncol =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb256-26"><a href="geocentric-model.html#cb256-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Year&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Day in Year&quot;</span>)</span></code></pre></div>
<p><img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-110-1.png" width="768" style="display: block; margin: auto;" /></p>
</div>
<div id="h1-2" class="section level3 hasAnchor" number="4.7.8">
<h3><span class="header-section-number">4.7.8</span> 4H1<a href="geocentric-model.html#h1-2" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<blockquote>
<p>The weights listed below were recored in the !Kung census, but heights were not recorded for these individuals. Provide predicted heights and 89% intervals for each of these individuals. That is, fill in the table, below, using model-based predictions.</p>
</blockquote>
<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-734258c0580911c79421" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-734258c0580911c79421">{"x":{"filter":"none","vertical":false,"data":[["1","2","3","4","5"],[1,2,3,4,5],[46.95,43.72,64.78,32.59,54.63]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>individual<\/th>\n      <th>weight<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[1,2]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false},"selection":{"mode":"multiple","selected":null,"target":"row","selectable":null}},"evals":[],"jsHooks":[]}</script>
<div class="sourceCode" id="cb257"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb257-1"><a href="geocentric-model.html#cb257-1" aria-hidden="true" tabindex="-1"></a>weight_uk <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">weight =</span> <span class="fu">c</span>(<span class="fl">46.95</span>, <span class="fl">43.72</span>, <span class="fl">64.78</span>,</span>
<span id="cb257-2"><a href="geocentric-model.html#cb257-2" aria-hidden="true" tabindex="-1"></a>                               <span class="fl">32.59</span>, <span class="fl">54.63</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb257-3"><a href="geocentric-model.html#cb257-3" aria-hidden="true" tabindex="-1"></a>          <span class="fu">mutate</span>(<span class="at">weight_c =</span> weight <span class="sc">-</span> <span class="fu">mean</span>(d2<span class="sc">$</span>weight))</span>
<span id="cb257-4"><a href="geocentric-model.html#cb257-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb257-5"><a href="geocentric-model.html#cb257-5" aria-hidden="true" tabindex="-1"></a><span class="fu">predict</span>(b4<span class="fl">.3</span>, <span class="at">newdata =</span> weight_uk, <span class="at">prob=</span><span class="fu">c</span>(.<span class="dv">055</span>,.<span class="dv">945</span>)) </span></code></pre></div>
<pre><code>##      Estimate Est.Error     Q5.5    Q94.5
## [1,] 156.2997  5.088868 148.0915 164.4584
## [2,] 153.5451  5.034013 145.3749 161.6047
## [3,] 172.4895  5.224621 164.2048 180.7326
## [4,] 143.2987  5.066228 135.2979 151.3203
## [5,] 163.2367  5.133487 155.0562 171.2982</code></pre>
</div>
<div id="h2-2" class="section level3 hasAnchor" number="4.7.9">
<h3><span class="header-section-number">4.7.9</span> 4H2<a href="geocentric-model.html#h2-2" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<blockquote>
<p>Select out all the rows in the Howell1 data with ages below 18 years of age. If you do it right, you should end up with a new data frame with 192 rows in it.</p>
</blockquote>
<div id="a" class="section level4 hasAnchor" number="4.7.9.1">
<h4><span class="header-section-number">4.7.9.1</span> a<a href="geocentric-model.html#a" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<blockquote>
<p>Fit a linear regression to these data, using quap. Present and interpret the estimates. For every 10 units of increase in weight, how much taller does the model predict a child gets?</p>
</blockquote>
<div class="sourceCode" id="cb259"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb259-1"><a href="geocentric-model.html#cb259-1" aria-hidden="true" tabindex="-1"></a>d_y <span class="ot">&lt;-</span> d <span class="sc">%&gt;%</span> </span>
<span id="cb259-2"><a href="geocentric-model.html#cb259-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(age <span class="sc">&lt;</span> <span class="dv">18</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb259-3"><a href="geocentric-model.html#cb259-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">weight_c =</span> weight <span class="sc">-</span> <span class="fu">mean</span>(weight))</span>
<span id="cb259-4"><a href="geocentric-model.html#cb259-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb259-5"><a href="geocentric-model.html#cb259-5" aria-hidden="true" tabindex="-1"></a>b4<span class="fl">.3</span>_y <span class="ot">&lt;-</span> <span class="fu">brm</span>(</span>
<span id="cb259-6"><a href="geocentric-model.html#cb259-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span>d_y,</span>
<span id="cb259-7"><a href="geocentric-model.html#cb259-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> gaussian,</span>
<span id="cb259-8"><a href="geocentric-model.html#cb259-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">formula =</span> height <span class="sc">~</span> weight_c,</span>
<span id="cb259-9"><a href="geocentric-model.html#cb259-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">150</span>,<span class="dv">20</span>), <span class="at">class=</span> <span class="st">&quot;Intercept&quot;</span>),</span>
<span id="cb259-10"><a href="geocentric-model.html#cb259-10" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="fu">lognormal</span>(<span class="dv">0</span>,<span class="dv">1</span>), <span class="at">class =</span> <span class="st">&quot;b&quot;</span>),</span>
<span id="cb259-11"><a href="geocentric-model.html#cb259-11" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>), <span class="at">class =</span> <span class="st">&quot;sigma&quot;</span>)),</span>
<span id="cb259-12"><a href="geocentric-model.html#cb259-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter =</span> <span class="dv">10000</span>, <span class="at">warmup=</span><span class="dv">9000</span>, <span class="at">chains =</span> <span class="dv">4</span>,</span>
<span id="cb259-13"><a href="geocentric-model.html#cb259-13" aria-hidden="true" tabindex="-1"></a>      <span class="at">backend =</span> <span class="st">&quot;cmdstanr&quot;</span>,</span>
<span id="cb259-14"><a href="geocentric-model.html#cb259-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">file =</span> <span class="st">&quot;output/Chapter4/b4.3_y&quot;</span></span>
<span id="cb259-15"><a href="geocentric-model.html#cb259-15" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb259-16"><a href="geocentric-model.html#cb259-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb259-17"><a href="geocentric-model.html#cb259-17" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(b4<span class="fl">.3</span>_y)</span></code></pre></div>
<pre><code>##  Family: gaussian 
##   Links: mu = identity; sigma = identity 
## Formula: height ~ weight_c 
##    Data: d_y (Number of observations: 192) 
##   Draws: 4 chains, each with iter = 10000; warmup = 9000; thin = 1;
##          total post-warmup draws = 4000
## 
## Population-Level Effects: 
##           Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## Intercept   108.36      0.60   107.15   109.58 1.00     4077     3040
## weight_c      2.72      0.07     2.59     2.85 1.00     4093     2875
## 
## Family Specific Parameters: 
##       Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## sigma     8.35      0.42     7.60     9.23 1.00     3999     2705
## 
## Draws were sampled using sample(hmc). For each parameter, Bulk_ESS
## and Tail_ESS are effective sample size measures, and Rhat is the potential
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<div class="sourceCode" id="cb261"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb261-1"><a href="geocentric-model.html#cb261-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(b4<span class="fl">.3</span>)</span></code></pre></div>
<pre><code>##  Family: gaussian 
##   Links: mu = identity; sigma = identity 
## Formula: height ~ 1 + weight_c 
##    Data: d2 (Number of observations: 352) 
##   Draws: 4 chains, each with iter = 28000; warmup = 27000; thin = 1;
##          total post-warmup draws = 4000
## 
## Population-Level Effects: 
##           Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## Intercept   154.59      0.28   154.05   155.13 1.00     4417     3230
## weight_c      0.90      0.04     0.82     0.98 1.00     4799     3261
## 
## Family Specific Parameters: 
##       Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## sigma     5.09      0.20     4.73     5.49 1.00     4592     3189
## 
## Draws were sampled using sample(hmc). For each parameter, Bulk_ESS
## and Tail_ESS are effective sample size measures, and Rhat is the potential
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
</div>
<div id="b" class="section level4 hasAnchor" number="4.7.9.2">
<h4><span class="header-section-number">4.7.9.2</span> b<a href="geocentric-model.html#b" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<blockquote>
<p>Plot the raw data, with height on the vertical axis and weight on the horizontal axis. Superimpose the MAP regression line and 89% interval for the mean. Also superimpose the 89% interval for predicted heights.</p>
</blockquote>
<div class="sourceCode" id="cb263"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb263-1"><a href="geocentric-model.html#cb263-1" aria-hidden="true" tabindex="-1"></a><span class="fu">range</span>(d_y<span class="sc">$</span>weight)</span></code></pre></div>
<pre><code>## [1]  4.252425 44.735511</code></pre>
<div class="sourceCode" id="cb265"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb265-1"><a href="geocentric-model.html#cb265-1" aria-hidden="true" tabindex="-1"></a>seq_weighty <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">weight =</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">50</span>,<span class="at">length.out=</span><span class="dv">100</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb265-2"><a href="geocentric-model.html#cb265-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">weight_c =</span> weight<span class="sc">-</span><span class="fu">mean</span>(d_y<span class="sc">$</span>weight))</span>
<span id="cb265-3"><a href="geocentric-model.html#cb265-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb265-4"><a href="geocentric-model.html#cb265-4" aria-hidden="true" tabindex="-1"></a>predict_b42y <span class="ot">&lt;-</span> <span class="fu">predict</span>(b4<span class="fl">.3</span>_y, <span class="at">newdata =</span> seq_weighty,</span>
<span id="cb265-5"><a href="geocentric-model.html#cb265-5" aria-hidden="true" tabindex="-1"></a>                      <span class="at">prob =</span> <span class="fu">c</span>(.<span class="dv">055</span>,.<span class="dv">5</span>,.<span class="dv">945</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb265-6"><a href="geocentric-model.html#cb265-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb265-7"><a href="geocentric-model.html#cb265-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(seq_weighty)</span>
<span id="cb265-8"><a href="geocentric-model.html#cb265-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb265-9"><a href="geocentric-model.html#cb265-9" aria-hidden="true" tabindex="-1"></a>fit_b42y <span class="ot">&lt;-</span> <span class="fu">fitted</span>(b4<span class="fl">.3</span>_y, <span class="at">newdata =</span> seq_weighty,</span>
<span id="cb265-10"><a href="geocentric-model.html#cb265-10" aria-hidden="true" tabindex="-1"></a>                      <span class="at">prob =</span> <span class="fu">c</span>(.<span class="dv">055</span>,.<span class="dv">5</span>,.<span class="dv">945</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb265-11"><a href="geocentric-model.html#cb265-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb265-12"><a href="geocentric-model.html#cb265-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(seq_weighty)</span>
<span id="cb265-13"><a href="geocentric-model.html#cb265-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb265-14"><a href="geocentric-model.html#cb265-14" aria-hidden="true" tabindex="-1"></a>d_y <span class="sc">%&gt;%</span> </span>
<span id="cb265-15"><a href="geocentric-model.html#cb265-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>weight,<span class="at">y=</span>height))<span class="sc">+</span></span>
<span id="cb265-16"><a href="geocentric-model.html#cb265-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size=</span><span class="dv">3</span>,<span class="at">shape=</span><span class="dv">1</span>,<span class="at">alpha=</span><span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>,</span>
<span id="cb265-17"><a href="geocentric-model.html#cb265-17" aria-hidden="true" tabindex="-1"></a>             <span class="at">color=</span><span class="st">&quot;navyblue&quot;</span>)<span class="sc">+</span></span>
<span id="cb265-18"><a href="geocentric-model.html#cb265-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="at">data=</span>fit_b42y,<span class="fu">aes</span>(<span class="at">y=</span>Estimate,</span>
<span id="cb265-19"><a href="geocentric-model.html#cb265-19" aria-hidden="true" tabindex="-1"></a>                                <span class="at">ymin=</span>Q5<span class="fl">.5</span>,</span>
<span id="cb265-20"><a href="geocentric-model.html#cb265-20" aria-hidden="true" tabindex="-1"></a>                                <span class="at">ymax=</span>Q94<span class="fl">.5</span>),</span>
<span id="cb265-21"><a href="geocentric-model.html#cb265-21" aria-hidden="true" tabindex="-1"></a>              <span class="at">fill =</span> <span class="st">&quot;black&quot;</span>, <span class="at">alpha =</span> <span class="dv">3</span><span class="sc">/</span><span class="dv">8</span>)<span class="sc">+</span></span>
<span id="cb265-22"><a href="geocentric-model.html#cb265-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="at">data=</span>predict_b42y,<span class="fu">aes</span>(<span class="at">y=</span>Estimate,</span>
<span id="cb265-23"><a href="geocentric-model.html#cb265-23" aria-hidden="true" tabindex="-1"></a>                                <span class="at">ymin=</span>Q5<span class="fl">.5</span>,</span>
<span id="cb265-24"><a href="geocentric-model.html#cb265-24" aria-hidden="true" tabindex="-1"></a>                                <span class="at">ymax=</span>Q94<span class="fl">.5</span>),</span>
<span id="cb265-25"><a href="geocentric-model.html#cb265-25" aria-hidden="true" tabindex="-1"></a>              <span class="at">fill =</span> <span class="st">&quot;black&quot;</span>, <span class="at">alpha =</span> <span class="dv">3</span><span class="sc">/</span><span class="dv">8</span>)<span class="sc">+</span></span>
<span id="cb265-26"><a href="geocentric-model.html#cb265-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data=</span>predict_b42y,<span class="fu">aes</span>(<span class="at">x=</span>weight,<span class="at">y=</span>Estimate),</span>
<span id="cb265-27"><a href="geocentric-model.html#cb265-27" aria-hidden="true" tabindex="-1"></a>            <span class="at">size=</span><span class="fl">0.5</span>, <span class="at">color=</span><span class="st">&quot;black&quot;</span>)<span class="sc">+</span></span>
<span id="cb265-28"><a href="geocentric-model.html#cb265-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">50</span>))<span class="sc">+</span></span>
<span id="cb265-29"><a href="geocentric-model.html#cb265-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;below 18 years old&quot;</span>)<span class="sc">+</span></span>
<span id="cb265-30"><a href="geocentric-model.html#cb265-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb265-31"><a href="geocentric-model.html#cb265-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">aspect.ratio=</span><span class="dv">1</span>)</span></code></pre></div>
<p><img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-114-1.png" width="672" style="display: block; margin: auto;" /></p>
</div>
</div>
<div id="h3-2" class="section level3 hasAnchor" number="4.7.10">
<h3><span class="header-section-number">4.7.10</span> 4H3<a href="geocentric-model.html#h3-2" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<blockquote>
<p>Suppose a colleauge of yours, who works on allometry, glances at the practice problems just above. Your colleague exclaims, “That’s silly. Everyone knows that it’s only the logarithm of body weight that scales with height!” Let’s take your colleague’s advice and see what happens.</p>
</blockquote>
<div id="a-1" class="section level4 hasAnchor" number="4.7.10.1">
<h4><span class="header-section-number">4.7.10.1</span> a<a href="geocentric-model.html#a-1" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<blockquote>
<p>Model the relationship between height (cm) and the natural logarithm of weight (log-kg). Use the entire Howell1 data frame, all 544 rows, adults and non-adults. Can you interpret the resulting estimates?</p>
</blockquote>
<p>体重の自然対数をとってみる。<br />
直線に近いように見える。</p>
<div class="sourceCode" id="cb266"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb266-1"><a href="geocentric-model.html#cb266-1" aria-hidden="true" tabindex="-1"></a>d_log <span class="ot">&lt;-</span> d <span class="sc">%&gt;%</span> </span>
<span id="cb266-2"><a href="geocentric-model.html#cb266-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">weight_log =</span> <span class="fu">log</span>(weight))</span>
<span id="cb266-3"><a href="geocentric-model.html#cb266-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb266-4"><a href="geocentric-model.html#cb266-4" aria-hidden="true" tabindex="-1"></a>d_log <span class="sc">%&gt;%</span> </span>
<span id="cb266-5"><a href="geocentric-model.html#cb266-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>weight_log,<span class="at">y=</span>height))<span class="sc">+</span></span>
<span id="cb266-6"><a href="geocentric-model.html#cb266-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()</span></code></pre></div>
<p><img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-115-1.png" width="672" style="display: block; margin: auto;" />
<br /></p>
<p>モデリングする。</p>
<div class="sourceCode" id="cb267"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb267-1"><a href="geocentric-model.html#cb267-1" aria-hidden="true" tabindex="-1"></a>b4<span class="fl">.3</span>_log <span class="ot">&lt;-</span> <span class="fu">brm</span>(</span>
<span id="cb267-2"><a href="geocentric-model.html#cb267-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span>d_log,</span>
<span id="cb267-3"><a href="geocentric-model.html#cb267-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> gaussian,</span>
<span id="cb267-4"><a href="geocentric-model.html#cb267-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">formula =</span> height <span class="sc">~</span> weight_log,</span>
<span id="cb267-5"><a href="geocentric-model.html#cb267-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">150</span>,<span class="dv">20</span>), <span class="at">class=</span> <span class="st">&quot;Intercept&quot;</span>),</span>
<span id="cb267-6"><a href="geocentric-model.html#cb267-6" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="fu">lognormal</span>(<span class="dv">0</span>,<span class="dv">1</span>), <span class="at">class =</span> <span class="st">&quot;b&quot;</span>),</span>
<span id="cb267-7"><a href="geocentric-model.html#cb267-7" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>), <span class="at">class =</span> <span class="st">&quot;sigma&quot;</span>)),</span>
<span id="cb267-8"><a href="geocentric-model.html#cb267-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter =</span> <span class="dv">10000</span>, <span class="at">warmup=</span><span class="dv">9000</span>, <span class="at">chains =</span> <span class="dv">4</span>,</span>
<span id="cb267-9"><a href="geocentric-model.html#cb267-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">backend =</span> <span class="st">&quot;cmdstanr&quot;</span>,</span>
<span id="cb267-10"><a href="geocentric-model.html#cb267-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">file =</span> <span class="st">&quot;output/Chapter4/b4.3_log&quot;</span></span>
<span id="cb267-11"><a href="geocentric-model.html#cb267-11" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb267-12"><a href="geocentric-model.html#cb267-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb267-13"><a href="geocentric-model.html#cb267-13" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(b4<span class="fl">.3</span>_log)</span></code></pre></div>
<pre><code>##  Family: gaussian 
##   Links: mu = identity; sigma = identity 
## Formula: height ~ weight_log 
##    Data: d_log (Number of observations: 544) 
##   Draws: 4 chains, each with iter = 10000; warmup = 9000; thin = 1;
##          total post-warmup draws = 4000
## 
## Population-Level Effects: 
##            Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## Intercept    -23.77      1.33   -26.40   -21.22 1.00     3802     3125
## weight_log    47.07      0.38    46.34    47.85 1.00     3852     3044
## 
## Family Specific Parameters: 
##       Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## sigma     5.13      0.16     4.83     5.45 1.00     3977     2640
## 
## Draws were sampled using sample(hmc). For each parameter, Bulk_ESS
## and Tail_ESS are effective sample size measures, and Rhat is the potential
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
</div>
<div id="b-1" class="section level4 hasAnchor" number="4.7.10.2">
<h4><span class="header-section-number">4.7.10.2</span> b<a href="geocentric-model.html#b-1" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<blockquote>
<p>Begin with this plot: plot( height ~ weight , data = Howell1 ). Then use samples from the quadratic approximate posterior of the model in (a) to superimpose on the plot: (1) the predicted mean height as a function of weight, (2) the 97% interval for the mean, and (3) the 97% interval for predicted heights.</p>
</blockquote>
<p>作図する。</p>
<div class="sourceCode" id="cb269"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb269-1"><a href="geocentric-model.html#cb269-1" aria-hidden="true" tabindex="-1"></a><span class="fu">range</span>(d_log<span class="sc">$</span>weight)</span></code></pre></div>
<pre><code>## [1]  4.252425 62.992589</code></pre>
<div class="sourceCode" id="cb271"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb271-1"><a href="geocentric-model.html#cb271-1" aria-hidden="true" tabindex="-1"></a>seq_weightl <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">weight =</span> <span class="fu">seq</span>(<span class="dv">1</span>,<span class="dv">75</span>,<span class="at">length.out=</span><span class="dv">120</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb271-2"><a href="geocentric-model.html#cb271-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">weight_log =</span> <span class="fu">log</span>(weight))</span>
<span id="cb271-3"><a href="geocentric-model.html#cb271-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb271-4"><a href="geocentric-model.html#cb271-4" aria-hidden="true" tabindex="-1"></a>predict_b42l <span class="ot">&lt;-</span><span class="fu">predict</span>(b4<span class="fl">.3</span>_log,<span class="at">newdata =</span> seq_weightl,</span>
<span id="cb271-5"><a href="geocentric-model.html#cb271-5" aria-hidden="true" tabindex="-1"></a>                      <span class="at">prob =</span> <span class="fu">c</span>(.<span class="dv">015</span>,.<span class="dv">5</span>,.<span class="dv">985</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb271-6"><a href="geocentric-model.html#cb271-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb271-7"><a href="geocentric-model.html#cb271-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(seq_weightl)</span>
<span id="cb271-8"><a href="geocentric-model.html#cb271-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb271-9"><a href="geocentric-model.html#cb271-9" aria-hidden="true" tabindex="-1"></a>fit_b42l <span class="ot">&lt;-</span> <span class="fu">fitted</span>(b4<span class="fl">.3</span>_log, <span class="at">newdata =</span> seq_weightl,</span>
<span id="cb271-10"><a href="geocentric-model.html#cb271-10" aria-hidden="true" tabindex="-1"></a>                      <span class="at">prob =</span> <span class="fu">c</span>(.<span class="dv">015</span>,.<span class="dv">5</span>,.<span class="dv">985</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb271-11"><a href="geocentric-model.html#cb271-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb271-12"><a href="geocentric-model.html#cb271-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(seq_weightl)</span>
<span id="cb271-13"><a href="geocentric-model.html#cb271-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb271-14"><a href="geocentric-model.html#cb271-14" aria-hidden="true" tabindex="-1"></a>d_log <span class="sc">%&gt;%</span> </span>
<span id="cb271-15"><a href="geocentric-model.html#cb271-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>weight,<span class="at">y=</span>height))<span class="sc">+</span></span>
<span id="cb271-16"><a href="geocentric-model.html#cb271-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size=</span><span class="dv">1</span>,<span class="at">alpha=</span><span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>,</span>
<span id="cb271-17"><a href="geocentric-model.html#cb271-17" aria-hidden="true" tabindex="-1"></a>             <span class="at">color=</span><span class="st">&quot;navyblue&quot;</span>)<span class="sc">+</span></span>
<span id="cb271-18"><a href="geocentric-model.html#cb271-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="at">data=</span>fit_b42l,<span class="fu">aes</span>(<span class="at">y=</span>Estimate,</span>
<span id="cb271-19"><a href="geocentric-model.html#cb271-19" aria-hidden="true" tabindex="-1"></a>                                <span class="at">ymin=</span>Q1<span class="fl">.5</span>,</span>
<span id="cb271-20"><a href="geocentric-model.html#cb271-20" aria-hidden="true" tabindex="-1"></a>                                <span class="at">ymax=</span>Q98<span class="fl">.5</span>),</span>
<span id="cb271-21"><a href="geocentric-model.html#cb271-21" aria-hidden="true" tabindex="-1"></a>              <span class="at">fill =</span> <span class="st">&quot;black&quot;</span>, <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>)<span class="sc">+</span></span>
<span id="cb271-22"><a href="geocentric-model.html#cb271-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="at">data=</span>predict_b42l,<span class="fu">aes</span>(<span class="at">y=</span>Estimate,</span>
<span id="cb271-23"><a href="geocentric-model.html#cb271-23" aria-hidden="true" tabindex="-1"></a>                                <span class="at">ymin=</span>Q1<span class="fl">.5</span>,</span>
<span id="cb271-24"><a href="geocentric-model.html#cb271-24" aria-hidden="true" tabindex="-1"></a>                                <span class="at">ymax=</span>Q98<span class="fl">.5</span>),</span>
<span id="cb271-25"><a href="geocentric-model.html#cb271-25" aria-hidden="true" tabindex="-1"></a>              <span class="at">fill =</span> <span class="st">&quot;black&quot;</span>, <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">6</span>)<span class="sc">+</span></span>
<span id="cb271-26"><a href="geocentric-model.html#cb271-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data=</span>predict_b42l,<span class="fu">aes</span>(<span class="at">x=</span>weight,<span class="at">y=</span>Estimate),</span>
<span id="cb271-27"><a href="geocentric-model.html#cb271-27" aria-hidden="true" tabindex="-1"></a>            <span class="at">size=</span><span class="fl">0.5</span>, <span class="at">color=</span><span class="st">&quot;black&quot;</span>)<span class="sc">+</span></span>
<span id="cb271-28"><a href="geocentric-model.html#cb271-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">50</span>))<span class="sc">+</span></span>
<span id="cb271-29"><a href="geocentric-model.html#cb271-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;using logarithm of weight&quot;</span>)<span class="sc">+</span></span>
<span id="cb271-30"><a href="geocentric-model.html#cb271-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb271-31"><a href="geocentric-model.html#cb271-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">aspect.ratio=</span><span class="dv">1</span>)</span></code></pre></div>
<p><img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-117-1.png" width="672" style="display: block; margin: auto;" />
<br /></p>
</div>
</div>
<div id="h4-2" class="section level3 hasAnchor" number="4.7.11">
<h3><span class="header-section-number">4.7.11</span> 4H4<a href="geocentric-model.html#h4-2" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<blockquote>
<p>Plot the prior predictive distribution for the parabolic polynomial regression model in the chapter. You can modify the code that plots the linear regression prior predictive distribution. Can you modify the prior distributions of <span class="math inline">\(\alpha\)</span>, <span class="math inline">\(\beta_1\)</span>, and <span class="math inline">\(\beta_2\)</span> so that the prior predictions stay within the biologically reasonable outcome space? That is to say: Do not try to fit the data by hand. But do try to keep the curves consistent with what you know about height and weight, before seeing these exact data.</p>
</blockquote>
<p>教科書での多項式モデルは以下のように定義されている。</p>
$$
<span class="math display">\[\begin{aligned}

h_{i} &amp;\sim Normal(\mu, \sigma)\\
\mu_i &amp;\sim \alpha + \beta_1 x_i + \beta_2x_i^2\\
\alpha &amp;\sim Normal(178,20)\\
\beta_1 &amp;\sim Log-Normal(0,1)\\
\beta_2 &amp;\sim Normal(0,1)\\
\sigma &amp;\sim Uniform(0,50)

\end{aligned}\]</span>
<p>$$</p>
<p>このモデルでの事前分布からサンプリングを行って回帰曲線を描くと以下のようになる。明らかに、生態学的に妥当な範囲を超えてしまっている。</p>
<div class="sourceCode" id="cb272"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb272-1"><a href="geocentric-model.html#cb272-1" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">1000</span></span>
<span id="cb272-2"><a href="geocentric-model.html#cb272-2" aria-hidden="true" tabindex="-1"></a>sim_x <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">x =</span> <span class="fu">seq</span>(<span class="dv">25</span>,<span class="dv">75</span>,<span class="at">length.out=</span><span class="dv">100</span>)) </span>
<span id="cb272-3"><a href="geocentric-model.html#cb272-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb272-4"><a href="geocentric-model.html#cb272-4" aria-hidden="true" tabindex="-1"></a>param_prior <span class="ot">&lt;-</span>   </span>
<span id="cb272-5"><a href="geocentric-model.html#cb272-5" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">alpha =</span> <span class="fu">rnorm</span>(n, <span class="dv">178</span>,<span class="dv">20</span>),</span>
<span id="cb272-6"><a href="geocentric-model.html#cb272-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">beta_1 =</span> <span class="fu">rlnorm</span>(n,<span class="dv">0</span>,<span class="dv">1</span>),</span>
<span id="cb272-7"><a href="geocentric-model.html#cb272-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">beta_2 =</span> <span class="fu">rnorm</span>(n,<span class="dv">0</span>,<span class="dv">1</span>),</span>
<span id="cb272-8"><a href="geocentric-model.html#cb272-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">sigma =</span> <span class="fu">runif</span>(n,<span class="dv">0</span>,<span class="dv">50</span>))</span>
<span id="cb272-9"><a href="geocentric-model.html#cb272-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb272-10"><a href="geocentric-model.html#cb272-10" aria-hidden="true" tabindex="-1"></a>sim <span class="ot">&lt;-</span> <span class="fu">crossing</span>(sim_x,param_prior) <span class="sc">%&gt;%</span> </span>
<span id="cb272-11"><a href="geocentric-model.html#cb272-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">height =</span> alpha <span class="sc">+</span> beta_1<span class="sc">*</span>x <span class="sc">+</span> beta_2<span class="sc">*</span>x<span class="sc">^</span><span class="dv">2</span>,</span>
<span id="cb272-12"><a href="geocentric-model.html#cb272-12" aria-hidden="true" tabindex="-1"></a>         <span class="at">group =</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">1000</span>, <span class="at">times =</span> <span class="dv">100</span>))</span>
<span id="cb272-13"><a href="geocentric-model.html#cb272-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb272-14"><a href="geocentric-model.html#cb272-14" aria-hidden="true" tabindex="-1"></a>sim <span class="sc">%&gt;%</span> </span>
<span id="cb272-15"><a href="geocentric-model.html#cb272-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>x,<span class="at">y=</span>height, <span class="at">group =</span> group))<span class="sc">+</span></span>
<span id="cb272-16"><a href="geocentric-model.html#cb272-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">alpha=</span> <span class="fl">0.1</span>)<span class="sc">+</span></span>
<span id="cb272-17"><a href="geocentric-model.html#cb272-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">272</span>), <span class="at">linetype =</span> <span class="dv">2</span><span class="sc">:</span><span class="dv">1</span>, <span class="at">color =</span> <span class="st">&quot;red4&quot;</span>) <span class="sc">+</span></span>
<span id="cb272-18"><a href="geocentric-model.html#cb272-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">&quot;text&quot;</span>, <span class="at">x =</span> <span class="dv">25</span>, <span class="at">y =</span> <span class="dv">0</span>, <span class="at">hjust =</span> <span class="dv">0</span>, <span class="at">vjust =</span> <span class="dv">1</span>,</span>
<span id="cb272-19"><a href="geocentric-model.html#cb272-19" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> <span class="st">&quot;胚&quot;</span>,</span>
<span id="cb272-20"><a href="geocentric-model.html#cb272-20" aria-hidden="true" tabindex="-1"></a>           <span class="at">fontface =</span> <span class="st">&quot;bold&quot;</span>) <span class="sc">+</span></span>
<span id="cb272-21"><a href="geocentric-model.html#cb272-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">&quot;text&quot;</span>, <span class="at">x =</span> <span class="dv">25</span>, <span class="at">y =</span> <span class="dv">272</span>, <span class="at">hjust =</span> <span class="dv">0</span>, <span class="at">vjust =</span> <span class="dv">0</span>,</span>
<span id="cb272-22"><a href="geocentric-model.html#cb272-22" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> <span class="st">&quot;世界一身長が高い人 (272cm)&quot;</span>,</span>
<span id="cb272-23"><a href="geocentric-model.html#cb272-23" aria-hidden="true" tabindex="-1"></a>           <span class="at">fontface =</span> <span class="st">&quot;bold&quot;</span>) <span class="sc">+</span></span>
<span id="cb272-24"><a href="geocentric-model.html#cb272-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">25</span>, <span class="dv">300</span>)) <span class="sc">+</span></span>
<span id="cb272-25"><a href="geocentric-model.html#cb272-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Weight&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Height&quot;</span>)</span></code></pre></div>
<p><img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-118-1.png" width="672" style="display: block; margin: auto;" />
<br/></p>
<p>例えば以下のようなモデルにすると、生態学的に妥当な範囲に収まる。</p>
$$
<span class="math display">\[\begin{aligned}

h_{i} &amp;\sim Normal(\mu, \sigma)\\
\mu_i &amp;\sim \alpha + \beta_1 x_i + \beta_2x_i^2\\
\alpha &amp;\sim Normal(-190,5)\\
\beta_1 &amp;\sim Log-Normal(13,0.2)\\
\beta_2 &amp;\sim Normal(-0.13,0.1)\\
\sigma &amp;\sim Uniform(0,50)

\end{aligned}\]</span>
<p>$$</p>
<div class="sourceCode" id="cb273"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb273-1"><a href="geocentric-model.html#cb273-1" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">1000</span></span>
<span id="cb273-2"><a href="geocentric-model.html#cb273-2" aria-hidden="true" tabindex="-1"></a>sim_x <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">x =</span> <span class="fu">seq</span>(<span class="dv">25</span>,<span class="dv">75</span>,<span class="at">length.out=</span><span class="dv">100</span>)) </span>
<span id="cb273-3"><a href="geocentric-model.html#cb273-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb273-4"><a href="geocentric-model.html#cb273-4" aria-hidden="true" tabindex="-1"></a>param_prior <span class="ot">&lt;-</span>   </span>
<span id="cb273-5"><a href="geocentric-model.html#cb273-5" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">alpha =</span> <span class="fu">rnorm</span>(n, <span class="sc">-</span><span class="dv">190</span>, <span class="dv">5</span>),</span>
<span id="cb273-6"><a href="geocentric-model.html#cb273-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">beta_1 =</span> <span class="fu">rnorm</span>(n, <span class="dv">13</span>, <span class="fl">0.2</span>),</span>
<span id="cb273-7"><a href="geocentric-model.html#cb273-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">beta_2 =</span> <span class="fu">runif</span>(n, <span class="sc">-</span><span class="fl">0.13</span>, <span class="sc">-</span><span class="fl">0.1</span>),</span>
<span id="cb273-8"><a href="geocentric-model.html#cb273-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">sigma =</span> <span class="fu">runif</span>(n,<span class="dv">0</span>,<span class="dv">50</span>))</span>
<span id="cb273-9"><a href="geocentric-model.html#cb273-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb273-10"><a href="geocentric-model.html#cb273-10" aria-hidden="true" tabindex="-1"></a>sim <span class="ot">&lt;-</span> <span class="fu">crossing</span>(sim_x,param_prior) <span class="sc">%&gt;%</span> </span>
<span id="cb273-11"><a href="geocentric-model.html#cb273-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">height =</span> alpha <span class="sc">+</span> beta_1<span class="sc">*</span>x <span class="sc">+</span> beta_2<span class="sc">*</span>x<span class="sc">^</span><span class="dv">2</span>,</span>
<span id="cb273-12"><a href="geocentric-model.html#cb273-12" aria-hidden="true" tabindex="-1"></a>         <span class="at">group =</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">1000</span>, <span class="at">times =</span> <span class="dv">100</span>))</span>
<span id="cb273-13"><a href="geocentric-model.html#cb273-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb273-14"><a href="geocentric-model.html#cb273-14" aria-hidden="true" tabindex="-1"></a>sim <span class="sc">%&gt;%</span> </span>
<span id="cb273-15"><a href="geocentric-model.html#cb273-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>x,<span class="at">y=</span>height, <span class="at">group =</span> group))<span class="sc">+</span></span>
<span id="cb273-16"><a href="geocentric-model.html#cb273-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">alpha=</span> <span class="fl">0.1</span>)<span class="sc">+</span></span>
<span id="cb273-17"><a href="geocentric-model.html#cb273-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">272</span>), <span class="at">linetype =</span> <span class="dv">2</span><span class="sc">:</span><span class="dv">1</span>, <span class="at">color =</span> <span class="st">&quot;red4&quot;</span>) <span class="sc">+</span></span>
<span id="cb273-18"><a href="geocentric-model.html#cb273-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">&quot;text&quot;</span>, <span class="at">x =</span> <span class="dv">25</span>, <span class="at">y =</span> <span class="dv">0</span>, <span class="at">hjust =</span> <span class="dv">0</span>, <span class="at">vjust =</span> <span class="dv">1</span>,</span>
<span id="cb273-19"><a href="geocentric-model.html#cb273-19" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> <span class="st">&quot;胚&quot;</span>,</span>
<span id="cb273-20"><a href="geocentric-model.html#cb273-20" aria-hidden="true" tabindex="-1"></a>           <span class="at">fontface =</span> <span class="st">&quot;bold&quot;</span>) <span class="sc">+</span></span>
<span id="cb273-21"><a href="geocentric-model.html#cb273-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">&quot;text&quot;</span>, <span class="at">x =</span> <span class="dv">25</span>, <span class="at">y =</span> <span class="dv">272</span>, <span class="at">hjust =</span> <span class="dv">0</span>, <span class="at">vjust =</span> <span class="dv">0</span>,</span>
<span id="cb273-22"><a href="geocentric-model.html#cb273-22" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> <span class="st">&quot;世界一身長が高い人 (272cm)&quot;</span>,</span>
<span id="cb273-23"><a href="geocentric-model.html#cb273-23" aria-hidden="true" tabindex="-1"></a>           <span class="at">fontface =</span> <span class="st">&quot;bold&quot;</span>) <span class="sc">+</span></span>
<span id="cb273-24"><a href="geocentric-model.html#cb273-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">25</span>, <span class="dv">300</span>)) <span class="sc">+</span></span>
<span id="cb273-25"><a href="geocentric-model.html#cb273-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Weight&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Height&quot;</span>)</span></code></pre></div>
<p><img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-119-1.png" width="672" style="display: block; margin: auto;" />
<br/></p>
</div>
<div id="h5-1" class="section level3 hasAnchor" number="4.7.12">
<h3><span class="header-section-number">4.7.12</span> 4H5<a href="geocentric-model.html#h5-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<blockquote>
<p>Return to data(cherry_blossoms) and model the association between blossom date (doy) and March temperature (temp). Note that there are many missing values in both variables. You may consider a linear model, a polynomial, or a spline on temperature. How well does temperature trend predict the blossom trend?</p>
</blockquote>
<p>cherry_blossomのデータで、気温と開花日の関係を線形モデル、多項回帰、スプライン回帰してみる。
<br /></p>
<div class="sourceCode" id="cb274"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb274-1"><a href="geocentric-model.html#cb274-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;cherry_blossoms&quot;</span>)</span>
<span id="cb274-2"><a href="geocentric-model.html#cb274-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb274-3"><a href="geocentric-model.html#cb274-3" aria-hidden="true" tabindex="-1"></a>cb_temp <span class="ot">&lt;-</span> cherry_blossoms <span class="sc">%&gt;%</span></span>
<span id="cb274-4"><a href="geocentric-model.html#cb274-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drop_na</span>(doy, temp) <span class="sc">%&gt;%</span></span>
<span id="cb274-5"><a href="geocentric-model.html#cb274-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">temp_c =</span> temp <span class="sc">-</span> <span class="fu">mean</span>(temp),</span>
<span id="cb274-6"><a href="geocentric-model.html#cb274-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">temp_s =</span> temp_c <span class="sc">/</span> <span class="fu">sd</span>(temp),</span>
<span id="cb274-7"><a href="geocentric-model.html#cb274-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">temp_s2 =</span> temp_s <span class="sc">^</span> <span class="dv">2</span>,</span>
<span id="cb274-8"><a href="geocentric-model.html#cb274-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">temp_s3 =</span> temp_s <span class="sc">^</span> <span class="dv">3</span>)</span>
<span id="cb274-9"><a href="geocentric-model.html#cb274-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb274-10"><a href="geocentric-model.html#cb274-10" aria-hidden="true" tabindex="-1"></a><span class="co"># 線形モデル</span></span>
<span id="cb274-11"><a href="geocentric-model.html#cb274-11" aria-hidden="true" tabindex="-1"></a>lin_mod <span class="ot">&lt;-</span> </span>
<span id="cb274-12"><a href="geocentric-model.html#cb274-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">brm</span>(doy <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> temp_c, </span>
<span id="cb274-13"><a href="geocentric-model.html#cb274-13" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> cb_temp, </span>
<span id="cb274-14"><a href="geocentric-model.html#cb274-14" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> gaussian,</span>
<span id="cb274-15"><a href="geocentric-model.html#cb274-15" aria-hidden="true" tabindex="-1"></a>      <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">100</span>,<span class="dv">10</span>),<span class="at">class=</span>Intercept),</span>
<span id="cb274-16"><a href="geocentric-model.html#cb274-16" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">10</span>), <span class="at">class =</span> b),</span>
<span id="cb274-17"><a href="geocentric-model.html#cb274-17" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>), <span class="at">class =</span> sigma)),</span>
<span id="cb274-18"><a href="geocentric-model.html#cb274-18" aria-hidden="true" tabindex="-1"></a>               <span class="at">iter =</span> <span class="dv">4000</span>, <span class="at">warmup =</span> <span class="dv">2000</span>, </span>
<span id="cb274-19"><a href="geocentric-model.html#cb274-19" aria-hidden="true" tabindex="-1"></a>      <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>, <span class="at">seed =</span> <span class="dv">1234</span>,</span>
<span id="cb274-20"><a href="geocentric-model.html#cb274-20" aria-hidden="true" tabindex="-1"></a>      <span class="at">backend =</span> <span class="st">&quot;cmdstanr&quot;</span>,</span>
<span id="cb274-21"><a href="geocentric-model.html#cb274-21" aria-hidden="true" tabindex="-1"></a>               <span class="at">file =</span> (<span class="st">&quot;output/Chapter4/lin_mod&quot;</span>))</span>
<span id="cb274-22"><a href="geocentric-model.html#cb274-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb274-23"><a href="geocentric-model.html#cb274-23" aria-hidden="true" tabindex="-1"></a><span class="co"># 2項モデル</span></span>
<span id="cb274-24"><a href="geocentric-model.html#cb274-24" aria-hidden="true" tabindex="-1"></a>qad_mod <span class="ot">&lt;-</span> </span>
<span id="cb274-25"><a href="geocentric-model.html#cb274-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">brm</span>(doy <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> temp_s <span class="sc">+</span> temp_s2, </span>
<span id="cb274-26"><a href="geocentric-model.html#cb274-26" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> cb_temp, <span class="at">family =</span> gaussian,</span>
<span id="cb274-27"><a href="geocentric-model.html#cb274-27" aria-hidden="true" tabindex="-1"></a>      <span class="at">prior=</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">100</span>, <span class="dv">10</span>),<span class="at">class=</span>Intercept),</span>
<span id="cb274-28"><a href="geocentric-model.html#cb274-28" aria-hidden="true" tabindex="-1"></a>               <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">10</span>), </span>
<span id="cb274-29"><a href="geocentric-model.html#cb274-29" aria-hidden="true" tabindex="-1"></a>                     <span class="at">class =</span> b, <span class="at">coef =</span> <span class="st">&quot;temp_s&quot;</span>),</span>
<span id="cb274-30"><a href="geocentric-model.html#cb274-30" aria-hidden="true" tabindex="-1"></a>               <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">1</span>), </span>
<span id="cb274-31"><a href="geocentric-model.html#cb274-31" aria-hidden="true" tabindex="-1"></a>                     <span class="at">class =</span> b, <span class="at">coef =</span> <span class="st">&quot;temp_s2&quot;</span>),</span>
<span id="cb274-32"><a href="geocentric-model.html#cb274-32" aria-hidden="true" tabindex="-1"></a>               <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>), <span class="at">class =</span> sigma)),</span>
<span id="cb274-33"><a href="geocentric-model.html#cb274-33" aria-hidden="true" tabindex="-1"></a>      <span class="at">iter =</span> <span class="dv">4000</span>, <span class="at">warmup =</span> <span class="dv">2000</span>, </span>
<span id="cb274-34"><a href="geocentric-model.html#cb274-34" aria-hidden="true" tabindex="-1"></a>      <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>, <span class="at">seed =</span> <span class="dv">1234</span>,</span>
<span id="cb274-35"><a href="geocentric-model.html#cb274-35" aria-hidden="true" tabindex="-1"></a>      <span class="at">backend =</span> <span class="st">&quot;cmdstanr&quot;</span>,</span>
<span id="cb274-36"><a href="geocentric-model.html#cb274-36" aria-hidden="true" tabindex="-1"></a>               <span class="at">file =</span> <span class="st">&quot;output/Chapter4/qad_mod&quot;</span>)</span>
<span id="cb274-37"><a href="geocentric-model.html#cb274-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb274-38"><a href="geocentric-model.html#cb274-38" aria-hidden="true" tabindex="-1"></a><span class="co"># cubic model</span></span>
<span id="cb274-39"><a href="geocentric-model.html#cb274-39" aria-hidden="true" tabindex="-1"></a>cub_mod <span class="ot">&lt;-</span> </span>
<span id="cb274-40"><a href="geocentric-model.html#cb274-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">brm</span>(doy <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> temp_s <span class="sc">+</span> temp_s2 <span class="sc">+</span> temp_s3, </span>
<span id="cb274-41"><a href="geocentric-model.html#cb274-41" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> cb_temp,<span class="at">family =</span> gaussian,</span>
<span id="cb274-42"><a href="geocentric-model.html#cb274-42" aria-hidden="true" tabindex="-1"></a>      <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">100</span>,<span class="dv">10</span>),<span class="at">class=</span>Intercept),</span>
<span id="cb274-43"><a href="geocentric-model.html#cb274-43" aria-hidden="true" tabindex="-1"></a>              <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">10</span>), </span>
<span id="cb274-44"><a href="geocentric-model.html#cb274-44" aria-hidden="true" tabindex="-1"></a>                    <span class="at">class =</span> b, <span class="at">coef =</span> <span class="st">&quot;temp_s&quot;</span>),</span>
<span id="cb274-45"><a href="geocentric-model.html#cb274-45" aria-hidden="true" tabindex="-1"></a>              <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">1</span>), </span>
<span id="cb274-46"><a href="geocentric-model.html#cb274-46" aria-hidden="true" tabindex="-1"></a>                    <span class="at">class =</span> b, <span class="at">coef =</span> <span class="st">&quot;temp_s2&quot;</span>),</span>
<span id="cb274-47"><a href="geocentric-model.html#cb274-47" aria-hidden="true" tabindex="-1"></a>            　<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">1</span>), </span>
<span id="cb274-48"><a href="geocentric-model.html#cb274-48" aria-hidden="true" tabindex="-1"></a>            　       <span class="at">class =</span> b, <span class="at">coef =</span> <span class="st">&quot;temp_s3&quot;</span>),</span>
<span id="cb274-49"><a href="geocentric-model.html#cb274-49" aria-hidden="true" tabindex="-1"></a>              <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>), <span class="at">class =</span> sigma)),</span>
<span id="cb274-50"><a href="geocentric-model.html#cb274-50" aria-hidden="true" tabindex="-1"></a>    <span class="at">iter =</span> <span class="dv">4000</span>, <span class="at">warmup =</span> <span class="dv">2000</span>, </span>
<span id="cb274-51"><a href="geocentric-model.html#cb274-51" aria-hidden="true" tabindex="-1"></a>    <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>, <span class="at">seed =</span> <span class="dv">1234</span>,</span>
<span id="cb274-52"><a href="geocentric-model.html#cb274-52" aria-hidden="true" tabindex="-1"></a>      <span class="at">backend =</span> <span class="st">&quot;cmdstanr&quot;</span>,</span>
<span id="cb274-53"><a href="geocentric-model.html#cb274-53" aria-hidden="true" tabindex="-1"></a>    <span class="at">file =</span> <span class="st">&quot;output/Chapter4/cub_mod&quot;</span>)</span>
<span id="cb274-54"><a href="geocentric-model.html#cb274-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb274-55"><a href="geocentric-model.html#cb274-55" aria-hidden="true" tabindex="-1"></a><span class="co"># spline model</span></span>
<span id="cb274-56"><a href="geocentric-model.html#cb274-56" aria-hidden="true" tabindex="-1"></a>spl_mod <span class="ot">&lt;-</span> </span>
<span id="cb274-57"><a href="geocentric-model.html#cb274-57" aria-hidden="true" tabindex="-1"></a>  <span class="fu">brm</span>(doy <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> <span class="fu">s</span>(temp, <span class="at">bs =</span> <span class="st">&quot;bs&quot;</span>), </span>
<span id="cb274-58"><a href="geocentric-model.html#cb274-58" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> cb_temp, <span class="at">family =</span> gaussian,</span>
<span id="cb274-59"><a href="geocentric-model.html#cb274-59" aria-hidden="true" tabindex="-1"></a>  <span class="at">prior=</span><span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">100</span>,<span class="dv">10</span>),<span class="at">class=</span>Intercept),</span>
<span id="cb274-60"><a href="geocentric-model.html#cb274-60" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">10</span>), <span class="at">class =</span> b),</span>
<span id="cb274-61"><a href="geocentric-model.html#cb274-61" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">10</span>), <span class="at">class =</span> sds),</span>
<span id="cb274-62"><a href="geocentric-model.html#cb274-62" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>), <span class="at">class =</span> sigma)),</span>
<span id="cb274-63"><a href="geocentric-model.html#cb274-63" aria-hidden="true" tabindex="-1"></a>               <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>, </span>
<span id="cb274-64"><a href="geocentric-model.html#cb274-64" aria-hidden="true" tabindex="-1"></a>               <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>, <span class="at">seed =</span> <span class="dv">1234</span>,</span>
<span id="cb274-65"><a href="geocentric-model.html#cb274-65" aria-hidden="true" tabindex="-1"></a>               <span class="at">control =</span> <span class="fu">list</span>(<span class="at">adapt_delta =</span> <span class="fl">0.9999</span>),</span>
<span id="cb274-66"><a href="geocentric-model.html#cb274-66" aria-hidden="true" tabindex="-1"></a>               <span class="at">backend =</span> <span class="st">&quot;cmdstanr&quot;</span>,</span>
<span id="cb274-67"><a href="geocentric-model.html#cb274-67" aria-hidden="true" tabindex="-1"></a>               <span class="at">file =</span> <span class="st">&quot;output/Chapter4/spl_mod&quot;</span>)</span></code></pre></div>
<p>モデルの結果を作図すると以下のようになる。</p>
<div class="sourceCode" id="cb275"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb275-1"><a href="geocentric-model.html#cb275-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(modelr)</span>
<span id="cb275-2"><a href="geocentric-model.html#cb275-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb275-3"><a href="geocentric-model.html#cb275-3" aria-hidden="true" tabindex="-1"></a>grid <span class="ot">&lt;-</span> cb_temp <span class="sc">%&gt;%</span></span>
<span id="cb275-4"><a href="geocentric-model.html#cb275-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data_grid</span>(<span class="at">temp =</span> <span class="fu">seq_range</span>(temp, <span class="dv">100</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb275-5"><a href="geocentric-model.html#cb275-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">temp_c =</span> temp <span class="sc">-</span> <span class="fu">mean</span>(cb_temp<span class="sc">$</span>temp),</span>
<span id="cb275-6"><a href="geocentric-model.html#cb275-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">temp_s =</span> temp_c <span class="sc">/</span> <span class="fu">sd</span>(cb_temp<span class="sc">$</span>temp),</span>
<span id="cb275-7"><a href="geocentric-model.html#cb275-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">temp_s2 =</span> temp_s <span class="sc">^</span> <span class="dv">2</span>,</span>
<span id="cb275-8"><a href="geocentric-model.html#cb275-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">temp_s3 =</span> temp_s <span class="sc">^</span> <span class="dv">3</span>)</span>
<span id="cb275-9"><a href="geocentric-model.html#cb275-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb275-10"><a href="geocentric-model.html#cb275-10" aria-hidden="true" tabindex="-1"></a>fits <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(</span>
<span id="cb275-11"><a href="geocentric-model.html#cb275-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_epred_draws</span>(grid, lin_mod) <span class="sc">%&gt;%</span></span>
<span id="cb275-12"><a href="geocentric-model.html#cb275-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mean_qi</span>(<span class="at">.width =</span> <span class="fu">c</span>(<span class="fl">0.67</span>, <span class="fl">0.89</span>, <span class="fl">0.97</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb275-13"><a href="geocentric-model.html#cb275-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">model =</span> <span class="st">&quot;Linear&quot;</span>),</span>
<span id="cb275-14"><a href="geocentric-model.html#cb275-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_epred_draws</span>(grid, qad_mod) <span class="sc">%&gt;%</span></span>
<span id="cb275-15"><a href="geocentric-model.html#cb275-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mean_qi</span>(<span class="at">.width =</span> <span class="fu">c</span>(<span class="fl">0.67</span>, <span class="fl">0.89</span>, <span class="fl">0.97</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb275-16"><a href="geocentric-model.html#cb275-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">model =</span> <span class="st">&quot;Quadratic&quot;</span>),</span>
<span id="cb275-17"><a href="geocentric-model.html#cb275-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_epred_draws</span>(grid, cub_mod) <span class="sc">%&gt;%</span></span>
<span id="cb275-18"><a href="geocentric-model.html#cb275-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mean_qi</span>(<span class="at">.width =</span> <span class="fu">c</span>(<span class="fl">0.67</span>, <span class="fl">0.89</span>, <span class="fl">0.97</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb275-19"><a href="geocentric-model.html#cb275-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">model =</span> <span class="st">&quot;Cubic&quot;</span>),</span>
<span id="cb275-20"><a href="geocentric-model.html#cb275-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_epred_draws</span>(grid, spl_mod) <span class="sc">%&gt;%</span></span>
<span id="cb275-21"><a href="geocentric-model.html#cb275-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mean_qi</span>(<span class="at">.width =</span> <span class="fu">c</span>(<span class="fl">0.67</span>, <span class="fl">0.89</span>, <span class="fl">0.97</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb275-22"><a href="geocentric-model.html#cb275-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">model =</span> <span class="st">&quot;Spline&quot;</span>)</span>
<span id="cb275-23"><a href="geocentric-model.html#cb275-23" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb275-24"><a href="geocentric-model.html#cb275-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">model =</span> <span class="fu">factor</span>(model, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&quot;Linear&quot;</span>, <span class="st">&quot;Quadratic&quot;</span>, <span class="st">&quot;Cubic&quot;</span>,</span>
<span id="cb275-25"><a href="geocentric-model.html#cb275-25" aria-hidden="true" tabindex="-1"></a>                                          <span class="st">&quot;Spline&quot;</span>)))</span>
<span id="cb275-26"><a href="geocentric-model.html#cb275-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb275-27"><a href="geocentric-model.html#cb275-27" aria-hidden="true" tabindex="-1"></a>preds <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(</span>
<span id="cb275-28"><a href="geocentric-model.html#cb275-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_predicted_draws</span>(grid, lin_mod) <span class="sc">%&gt;%</span></span>
<span id="cb275-29"><a href="geocentric-model.html#cb275-29" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mean_qi</span>(<span class="at">.width =</span> <span class="fl">0.89</span>) <span class="sc">%&gt;%</span></span>
<span id="cb275-30"><a href="geocentric-model.html#cb275-30" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">model =</span> <span class="st">&quot;Linear&quot;</span>),</span>
<span id="cb275-31"><a href="geocentric-model.html#cb275-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_predicted_draws</span>(grid, qad_mod) <span class="sc">%&gt;%</span></span>
<span id="cb275-32"><a href="geocentric-model.html#cb275-32" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mean_qi</span>(<span class="at">.width =</span> <span class="fl">0.89</span>) <span class="sc">%&gt;%</span></span>
<span id="cb275-33"><a href="geocentric-model.html#cb275-33" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">model =</span> <span class="st">&quot;Quadratic&quot;</span>),</span>
<span id="cb275-34"><a href="geocentric-model.html#cb275-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_predicted_draws</span>(grid, cub_mod) <span class="sc">%&gt;%</span></span>
<span id="cb275-35"><a href="geocentric-model.html#cb275-35" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mean_qi</span>(<span class="at">.width =</span> <span class="fl">0.89</span>) <span class="sc">%&gt;%</span></span>
<span id="cb275-36"><a href="geocentric-model.html#cb275-36" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">model =</span> <span class="st">&quot;Cubic&quot;</span>),</span>
<span id="cb275-37"><a href="geocentric-model.html#cb275-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_predicted_draws</span>(grid, spl_mod) <span class="sc">%&gt;%</span></span>
<span id="cb275-38"><a href="geocentric-model.html#cb275-38" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mean_qi</span>(<span class="at">.width =</span> <span class="fl">0.89</span>) <span class="sc">%&gt;%</span></span>
<span id="cb275-39"><a href="geocentric-model.html#cb275-39" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">model =</span> <span class="st">&quot;Spline&quot;</span>)</span>
<span id="cb275-40"><a href="geocentric-model.html#cb275-40" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb275-41"><a href="geocentric-model.html#cb275-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">model =</span> <span class="fu">factor</span>(model, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&quot;Linear&quot;</span>, <span class="st">&quot;Quadratic&quot;</span>, <span class="st">&quot;Cubic&quot;</span>,</span>
<span id="cb275-42"><a href="geocentric-model.html#cb275-42" aria-hidden="true" tabindex="-1"></a>                                          <span class="st">&quot;Spline&quot;</span>)))</span>
<span id="cb275-43"><a href="geocentric-model.html#cb275-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb275-44"><a href="geocentric-model.html#cb275-44" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(cb_temp, <span class="fu">aes</span>(<span class="at">x =</span> temp)) <span class="sc">+</span></span>
<span id="cb275-45"><a href="geocentric-model.html#cb275-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>model, <span class="at">nrow =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb275-46"><a href="geocentric-model.html#cb275-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> doy), <span class="at">alpha =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb275-47"><a href="geocentric-model.html#cb275-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="at">data =</span> preds, <span class="fu">aes</span>(<span class="at">ymin =</span> .lower, <span class="at">ymax =</span> .upper),</span>
<span id="cb275-48"><a href="geocentric-model.html#cb275-48" aria-hidden="true" tabindex="-1"></a>              <span class="at">alpha =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb275-49"><a href="geocentric-model.html#cb275-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_lineribbon</span>(<span class="at">data =</span> fits, <span class="fu">aes</span>(<span class="at">y =</span> .epred, <span class="at">ymin =</span> .lower, <span class="at">ymax =</span> .upper),</span>
<span id="cb275-50"><a href="geocentric-model.html#cb275-50" aria-hidden="true" tabindex="-1"></a>                  <span class="at">size =</span> .<span class="dv">6</span>) <span class="sc">+</span></span>
<span id="cb275-51"><a href="geocentric-model.html#cb275-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_brewer</span>(<span class="at">palette =</span> <span class="st">&quot;Blues&quot;</span>, <span class="at">breaks =</span> <span class="fu">c</span>(<span class="fl">0.67</span>, <span class="fl">0.89</span>, <span class="fl">0.97</span>)) <span class="sc">+</span></span>
<span id="cb275-52"><a href="geocentric-model.html#cb275-52" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;March Temperature&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Day in Year&quot;</span>) <span class="sc">+</span></span>
<span id="cb275-53"><a href="geocentric-model.html#cb275-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>)</span></code></pre></div>
<p><img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-121-1.png" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="h6" class="section level3 hasAnchor" number="4.7.13">
<h3><span class="header-section-number">4.7.13</span> 4H6<a href="geocentric-model.html#h6" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<blockquote>
<p>Simulate the prior predictive distribution for the cherry blossom spline in the chapter. Adjust the prior on the weights and observe what happens. What do you think the prior on the weights is doing?</p>
</blockquote>
<div class="sourceCode" id="cb276"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb276-1"><a href="geocentric-model.html#cb276-1" aria-hidden="true" tabindex="-1"></a>cb_dat <span class="ot">&lt;-</span> cherry_blossoms <span class="sc">%&gt;%</span></span>
<span id="cb276-2"><a href="geocentric-model.html#cb276-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drop_na</span>(doy)</span>
<span id="cb276-3"><a href="geocentric-model.html#cb276-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb276-4"><a href="geocentric-model.html#cb276-4" aria-hidden="true" tabindex="-1"></a>knot_list <span class="ot">&lt;-</span> <span class="fu">quantile</span>(cb_dat<span class="sc">$</span>year, <span class="at">probs =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="at">length.out =</span> <span class="dv">15</span>))</span>
<span id="cb276-5"><a href="geocentric-model.html#cb276-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb276-6"><a href="geocentric-model.html#cb276-6" aria-hidden="true" tabindex="-1"></a>B <span class="ot">&lt;-</span> <span class="fu">bs</span>(cb_dat<span class="sc">$</span>year,</span>
<span id="cb276-7"><a href="geocentric-model.html#cb276-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">knots =</span> knot_list[<span class="sc">-</span><span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">15</span>)],</span>
<span id="cb276-8"><a href="geocentric-model.html#cb276-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">degree =</span> <span class="dv">3</span>, <span class="at">intercept =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p>教科書のモデルから事前予測分布を描画すると以下のようになる。</p>
<div class="sourceCode" id="cb277"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb277-1"><a href="geocentric-model.html#cb277-1" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">50</span></span>
<span id="cb277-2"><a href="geocentric-model.html#cb277-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb277-3"><a href="geocentric-model.html#cb277-3" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">.draw =</span> <span class="fu">seq_len</span>(n),</span>
<span id="cb277-4"><a href="geocentric-model.html#cb277-4" aria-hidden="true" tabindex="-1"></a>       <span class="at">alpha =</span> <span class="fu">rnorm</span>(n, <span class="dv">100</span>, <span class="dv">10</span>),</span>
<span id="cb277-5"><a href="geocentric-model.html#cb277-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">w =</span> purrr<span class="sc">::</span><span class="fu">map</span>(<span class="fu">seq_len</span>(n),</span>
<span id="cb277-6"><a href="geocentric-model.html#cb277-6" aria-hidden="true" tabindex="-1"></a>                      <span class="cf">function</span>(x, knots) {</span>
<span id="cb277-7"><a href="geocentric-model.html#cb277-7" aria-hidden="true" tabindex="-1"></a>                        w <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="at">n =</span> knots <span class="sc">+</span> <span class="dv">2</span>, <span class="dv">0</span>, <span class="dv">10</span>)</span>
<span id="cb277-8"><a href="geocentric-model.html#cb277-8" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">return</span>(w)</span>
<span id="cb277-9"><a href="geocentric-model.html#cb277-9" aria-hidden="true" tabindex="-1"></a>                      },</span>
<span id="cb277-10"><a href="geocentric-model.html#cb277-10" aria-hidden="true" tabindex="-1"></a>                      <span class="at">knots =</span> <span class="dv">15</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb277-11"><a href="geocentric-model.html#cb277-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">mu =</span> <span class="fu">map2</span>(alpha, w,</span>
<span id="cb277-12"><a href="geocentric-model.html#cb277-12" aria-hidden="true" tabindex="-1"></a>                   <span class="cf">function</span>(alpha, w, b) {</span>
<span id="cb277-13"><a href="geocentric-model.html#cb277-13" aria-hidden="true" tabindex="-1"></a>                     res <span class="ot">&lt;-</span> b <span class="sc">%*%</span> w</span>
<span id="cb277-14"><a href="geocentric-model.html#cb277-14" aria-hidden="true" tabindex="-1"></a>                     res <span class="ot">&lt;-</span> res <span class="sc">+</span> alpha</span>
<span id="cb277-15"><a href="geocentric-model.html#cb277-15" aria-hidden="true" tabindex="-1"></a>                     res <span class="ot">&lt;-</span> res <span class="sc">%&gt;%</span></span>
<span id="cb277-16"><a href="geocentric-model.html#cb277-16" aria-hidden="true" tabindex="-1"></a>                       <span class="fu">as_tibble</span>(<span class="at">.name_repair =</span> <span class="sc">~</span><span class="st">&quot;.value&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb277-17"><a href="geocentric-model.html#cb277-17" aria-hidden="true" tabindex="-1"></a>                       <span class="fu">mutate</span>(<span class="at">year =</span> cb_dat<span class="sc">$</span>year, <span class="at">.before =</span> <span class="dv">1</span>)</span>
<span id="cb277-18"><a href="geocentric-model.html#cb277-18" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">return</span>(res)</span>
<span id="cb277-19"><a href="geocentric-model.html#cb277-19" aria-hidden="true" tabindex="-1"></a>                   },</span>
<span id="cb277-20"><a href="geocentric-model.html#cb277-20" aria-hidden="true" tabindex="-1"></a>                   <span class="at">b =</span> B)) <span class="sc">%&gt;%</span></span>
<span id="cb277-21"><a href="geocentric-model.html#cb277-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(<span class="at">cols =</span> mu) <span class="sc">%&gt;%</span></span>
<span id="cb277-22"><a href="geocentric-model.html#cb277-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> .value)) <span class="sc">+</span></span>
<span id="cb277-23"><a href="geocentric-model.html#cb277-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> knot_list, <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb277-24"><a href="geocentric-model.html#cb277-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">group =</span> .draw)) <span class="sc">+</span></span>
<span id="cb277-25"><a href="geocentric-model.html#cb277-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expand_limits</span>(<span class="at">y =</span> <span class="fu">c</span>(<span class="dv">60</span>, <span class="dv">140</span>)) <span class="sc">+</span></span>
<span id="cb277-26"><a href="geocentric-model.html#cb277-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Year&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Day in Year&quot;</span>)</span></code></pre></div>
<p><img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-123-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>ここで、４M８でやったように<code>w</code>の事前分布を<span class="math inline">\(Normal(0,2)\)</span>にする。すると、うねうねが小さくなる。</p>
<div class="sourceCode" id="cb278"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb278-1"><a href="geocentric-model.html#cb278-1" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">50</span></span>
<span id="cb278-2"><a href="geocentric-model.html#cb278-2" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">.draw =</span> <span class="fu">seq_len</span>(n),</span>
<span id="cb278-3"><a href="geocentric-model.html#cb278-3" aria-hidden="true" tabindex="-1"></a>       <span class="at">alpha =</span> <span class="fu">rnorm</span>(n, <span class="dv">100</span>, <span class="dv">10</span>),</span>
<span id="cb278-4"><a href="geocentric-model.html#cb278-4" aria-hidden="true" tabindex="-1"></a>       <span class="at">w =</span> purrr<span class="sc">::</span><span class="fu">map</span>(<span class="fu">seq_len</span>(n),</span>
<span id="cb278-5"><a href="geocentric-model.html#cb278-5" aria-hidden="true" tabindex="-1"></a>                      <span class="cf">function</span>(x, knots) {</span>
<span id="cb278-6"><a href="geocentric-model.html#cb278-6" aria-hidden="true" tabindex="-1"></a>                        w <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="at">n =</span> knots <span class="sc">+</span> <span class="dv">2</span>, <span class="dv">0</span>, <span class="dv">1</span>)</span>
<span id="cb278-7"><a href="geocentric-model.html#cb278-7" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">return</span>(w)</span>
<span id="cb278-8"><a href="geocentric-model.html#cb278-8" aria-hidden="true" tabindex="-1"></a>                      },</span>
<span id="cb278-9"><a href="geocentric-model.html#cb278-9" aria-hidden="true" tabindex="-1"></a>                      <span class="at">knots =</span> <span class="dv">15</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb278-10"><a href="geocentric-model.html#cb278-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">mu =</span> <span class="fu">map2</span>(alpha, w,</span>
<span id="cb278-11"><a href="geocentric-model.html#cb278-11" aria-hidden="true" tabindex="-1"></a>                   <span class="cf">function</span>(alpha, w, b) {</span>
<span id="cb278-12"><a href="geocentric-model.html#cb278-12" aria-hidden="true" tabindex="-1"></a>                     res <span class="ot">&lt;-</span> b <span class="sc">%*%</span> w</span>
<span id="cb278-13"><a href="geocentric-model.html#cb278-13" aria-hidden="true" tabindex="-1"></a>                     res <span class="ot">&lt;-</span> res <span class="sc">+</span> alpha</span>
<span id="cb278-14"><a href="geocentric-model.html#cb278-14" aria-hidden="true" tabindex="-1"></a>                     res <span class="ot">&lt;-</span> res <span class="sc">%&gt;%</span></span>
<span id="cb278-15"><a href="geocentric-model.html#cb278-15" aria-hidden="true" tabindex="-1"></a>                       <span class="fu">as_tibble</span>(<span class="at">.name_repair =</span> <span class="sc">~</span><span class="st">&quot;.value&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb278-16"><a href="geocentric-model.html#cb278-16" aria-hidden="true" tabindex="-1"></a>                       <span class="fu">mutate</span>(<span class="at">year =</span> cb_dat<span class="sc">$</span>year, <span class="at">.before =</span> <span class="dv">1</span>)</span>
<span id="cb278-17"><a href="geocentric-model.html#cb278-17" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">return</span>(res)</span>
<span id="cb278-18"><a href="geocentric-model.html#cb278-18" aria-hidden="true" tabindex="-1"></a>                   },</span>
<span id="cb278-19"><a href="geocentric-model.html#cb278-19" aria-hidden="true" tabindex="-1"></a>                   <span class="at">b =</span> B)) <span class="sc">%&gt;%</span></span>
<span id="cb278-20"><a href="geocentric-model.html#cb278-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(<span class="at">cols =</span> mu) <span class="sc">%&gt;%</span></span>
<span id="cb278-21"><a href="geocentric-model.html#cb278-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> .value)) <span class="sc">+</span></span>
<span id="cb278-22"><a href="geocentric-model.html#cb278-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> knot_list, <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb278-23"><a href="geocentric-model.html#cb278-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">group =</span> .draw)) <span class="sc">+</span></span>
<span id="cb278-24"><a href="geocentric-model.html#cb278-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expand_limits</span>(<span class="at">y =</span> <span class="fu">c</span>(<span class="dv">60</span>, <span class="dv">140</span>)) <span class="sc">+</span></span>
<span id="cb278-25"><a href="geocentric-model.html#cb278-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Year&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Day in Year&quot;</span>)</span></code></pre></div>
<p><img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-124-1.png" width="672" style="display: block; margin: auto;" /></p>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="sampling-the-imaginary.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="the-many-variables-the-spurious-waffles.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
