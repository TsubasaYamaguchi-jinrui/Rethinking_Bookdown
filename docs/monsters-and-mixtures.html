<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>12 Monsters and Mixtures | Statistical Rethinking Second Edition</title>
  <meta name="description" content="12 Monsters and Mixtures | Statistical Rethinking Second Edition" />
  <meta name="generator" content="bookdown 0.31 and GitBook 2.6.7" />

  <meta property="og:title" content="12 Monsters and Mixtures | Statistical Rethinking Second Edition" />
  <meta property="og:type" content="book" />
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="12 Monsters and Mixtures | Statistical Rethinking Second Edition" />
  
  
  

<meta name="author" content="Tsubasa Yamaguchi" />


<meta name="date" content="2023-02-01" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="god-spiked-the-integers.html"/>
<link rel="next" href="models-with-memory.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<script src="libs/htmlwidgets-1.6.1/htmlwidgets.js"></script>
<link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet" />
<script src="libs/datatables-binding-0.27/datatables.js"></script>
<link href="libs/dt-core-1.12.1/css/jquery.dataTables.min.css" rel="stylesheet" />
<link href="libs/dt-core-1.12.1/css/jquery.dataTables.extra.css" rel="stylesheet" />
<script src="libs/dt-core-1.12.1/js/jquery.dataTables.min.js"></script>
<link href="libs/crosstalk-1.2.0/css/crosstalk.min.css" rel="stylesheet" />
<script src="libs/crosstalk-1.2.0/js/crosstalk.min.js"></script>
<link href="libs/tabwid-1.1.2/tabwid.css" rel="stylesheet" />
<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="custom_style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>本稿の目的</a></li>
<li class="chapter" data-level="" data-path="パッケージの読み込み.html"><a href="パッケージの読み込み.html"><i class="fa fa-check"></i>パッケージの読み込み</a></li>
<li class="chapter" data-level="1" data-path="the-golem-of-prague.html"><a href="the-golem-of-prague.html"><i class="fa fa-check"></i><b>1</b> The Golem of Prague 　</a></li>
<li class="chapter" data-level="2" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html"><i class="fa fa-check"></i><b>2</b> Small Worlds and Large Worlds</a>
<ul>
<li class="chapter" data-level="2.1" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#byesian-updating"><i class="fa fa-check"></i><b>2.1</b> Byesian Updating</a></li>
<li class="chapter" data-level="2.2" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#making-th-model"><i class="fa fa-check"></i><b>2.2</b> Making th model</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#grid-approximation"><i class="fa fa-check"></i><b>2.2.1</b> Grid approximation</a></li>
<li class="chapter" data-level="2.2.2" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#quadratic-approximation"><i class="fa fa-check"></i><b>2.2.2</b> Quadratic approximation</a></li>
<li class="chapter" data-level="2.2.3" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#mcmc"><i class="fa fa-check"></i><b>2.2.3</b> MCMC</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#practice"><i class="fa fa-check"></i><b>2.3</b> Practice</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#m1"><i class="fa fa-check"></i><b>2.3.1</b> 2M1</a></li>
<li class="chapter" data-level="2.3.2" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#m2"><i class="fa fa-check"></i><b>2.3.2</b> 2M2</a></li>
<li class="chapter" data-level="2.3.3" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#m3"><i class="fa fa-check"></i><b>2.3.3</b> 2M3</a></li>
<li class="chapter" data-level="2.3.4" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#m4"><i class="fa fa-check"></i><b>2.3.4</b> 2M4</a></li>
<li class="chapter" data-level="2.3.5" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#m5"><i class="fa fa-check"></i><b>2.3.5</b> 2M5</a></li>
<li class="chapter" data-level="2.3.6" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#m7"><i class="fa fa-check"></i><b>2.3.6</b> 2M7</a></li>
<li class="chapter" data-level="2.3.7" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#h1"><i class="fa fa-check"></i><b>2.3.7</b> 2H1</a></li>
<li class="chapter" data-level="2.3.8" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#h2"><i class="fa fa-check"></i><b>2.3.8</b> 2H2</a></li>
<li class="chapter" data-level="2.3.9" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#h3"><i class="fa fa-check"></i><b>2.3.9</b> 2H3</a></li>
<li class="chapter" data-level="2.3.10" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#h4"><i class="fa fa-check"></i><b>2.3.10</b> 2H4</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html"><i class="fa fa-check"></i><b>3</b> Sampling the Imaginary</a>
<ul>
<li class="chapter" data-level="3.1" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#sampling-from-a-grid-aproximate-posterior"><i class="fa fa-check"></i><b>3.1</b> Sampling from a grid-aproximate posterior</a></li>
<li class="chapter" data-level="3.2" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#sampling-to-summarize"><i class="fa fa-check"></i><b>3.2</b> Sampling to summarize</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#intervals-of-defined-mass"><i class="fa fa-check"></i><b>3.2.1</b> Intervals of defined mass</a></li>
<li class="chapter" data-level="3.2.2" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#highly-skewed-example"><i class="fa fa-check"></i><b>3.2.2</b> highly skewed example</a></li>
<li class="chapter" data-level="3.2.3" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#point-estimate"><i class="fa fa-check"></i><b>3.2.3</b> Point estimate　　</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#sampling-to-simulate-prediction"><i class="fa fa-check"></i><b>3.3</b> Sampling to simulate prediction</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#model-checking"><i class="fa fa-check"></i><b>3.3.1</b> Model checking</a></li>
<li class="chapter" data-level="3.3.2" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#practice-with-brms"><i class="fa fa-check"></i><b>3.3.2</b> Practice with brms</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#practice-1"><i class="fa fa-check"></i><b>3.4</b> Practice</a>
<ul>
<li class="chapter" data-level="3.4.1" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#e"><i class="fa fa-check"></i><b>3.4.1</b> 3E</a></li>
<li class="chapter" data-level="3.4.2" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#m"><i class="fa fa-check"></i><b>3.4.2</b> 3M</a></li>
<li class="chapter" data-level="3.4.3" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#h"><i class="fa fa-check"></i><b>3.4.3</b> 3H</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="geocentric-model.html"><a href="geocentric-model.html"><i class="fa fa-check"></i><b>4</b> Geocentric Model</a>
<ul>
<li class="chapter" data-level="4.1" data-path="geocentric-model.html"><a href="geocentric-model.html#why-normal-distributions-are-normal"><i class="fa fa-check"></i><b>4.1</b> Why normal distributions are normal</a></li>
<li class="chapter" data-level="4.2" data-path="geocentric-model.html"><a href="geocentric-model.html#normal-by-multiplication"><i class="fa fa-check"></i><b>4.2</b> Normal by multiplication</a></li>
<li class="chapter" data-level="4.3" data-path="geocentric-model.html"><a href="geocentric-model.html#gaussian-model-of-height"><i class="fa fa-check"></i><b>4.3</b> Gaussian model of height</a></li>
<li class="chapter" data-level="4.4" data-path="geocentric-model.html"><a href="geocentric-model.html#grid-approximationで事後分布を描く"><i class="fa fa-check"></i><b>4.4</b> Grid approximationで事後分布を描く</a>
<ul>
<li class="chapter" data-level="4.4.1" data-path="geocentric-model.html"><a href="geocentric-model.html#事後分布からサンプリングする"><i class="fa fa-check"></i><b>4.4.1</b> 事後分布からサンプリングする</a></li>
<li class="chapter" data-level="4.4.2" data-path="geocentric-model.html"><a href="geocentric-model.html#rethinking"><i class="fa fa-check"></i><b>4.4.2</b> rethinking</a></li>
<li class="chapter" data-level="4.4.3" data-path="geocentric-model.html"><a href="geocentric-model.html#finding-posterior-with-brms"><i class="fa fa-check"></i><b>4.4.3</b> Finding posterior with brms</a></li>
<li class="chapter" data-level="4.4.4" data-path="geocentric-model.html"><a href="geocentric-model.html#事後分布からのサンプリング"><i class="fa fa-check"></i><b>4.4.4</b> 事後分布からのサンプリング</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="geocentric-model.html"><a href="geocentric-model.html#linear-prediction"><i class="fa fa-check"></i><b>4.5</b> Linear prediction</a>
<ul>
<li class="chapter" data-level="4.5.1" data-path="geocentric-model.html"><a href="geocentric-model.html#finding-the-posterior-distribution"><i class="fa fa-check"></i><b>4.5.1</b> Finding the posterior distribution</a></li>
<li class="chapter" data-level="4.5.2" data-path="geocentric-model.html"><a href="geocentric-model.html#plotting-posterior-inference-agaist-the-data"><i class="fa fa-check"></i><b>4.5.2</b> Plotting posterior inference agaist the data</a></li>
<li class="chapter" data-level="4.5.3" data-path="geocentric-model.html"><a href="geocentric-model.html#plotting-regression-intervals-and-contours"><i class="fa fa-check"></i><b>4.5.3</b> Plotting regression intervals and contours</a></li>
<li class="chapter" data-level="4.5.4" data-path="geocentric-model.html"><a href="geocentric-model.html#prediction-intervals"><i class="fa fa-check"></i><b>4.5.4</b> Prediction intervals</a></li>
</ul></li>
<li class="chapter" data-level="4.6" data-path="geocentric-model.html"><a href="geocentric-model.html#curves-from-lines"><i class="fa fa-check"></i><b>4.6</b> Curves from lines</a>
<ul>
<li class="chapter" data-level="4.6.1" data-path="geocentric-model.html"><a href="geocentric-model.html#polynomial-regression"><i class="fa fa-check"></i><b>4.6.1</b> Polynomial regression</a></li>
<li class="chapter" data-level="4.6.2" data-path="geocentric-model.html"><a href="geocentric-model.html#overthinking"><i class="fa fa-check"></i><b>4.6.2</b> overthinking</a></li>
<li class="chapter" data-level="4.6.3" data-path="geocentric-model.html"><a href="geocentric-model.html#splines"><i class="fa fa-check"></i><b>4.6.3</b> Splines</a></li>
</ul></li>
<li class="chapter" data-level="4.7" data-path="geocentric-model.html"><a href="geocentric-model.html#practice-2"><i class="fa fa-check"></i><b>4.7</b> Practice</a>
<ul>
<li class="chapter" data-level="4.7.1" data-path="geocentric-model.html"><a href="geocentric-model.html#m1-2"><i class="fa fa-check"></i><b>4.7.1</b> 4M1</a></li>
<li class="chapter" data-level="4.7.2" data-path="geocentric-model.html"><a href="geocentric-model.html#m2-2"><i class="fa fa-check"></i><b>4.7.2</b> 4M2</a></li>
<li class="chapter" data-level="4.7.3" data-path="geocentric-model.html"><a href="geocentric-model.html#m4-2"><i class="fa fa-check"></i><b>4.7.3</b> 4M4</a></li>
<li class="chapter" data-level="4.7.4" data-path="geocentric-model.html"><a href="geocentric-model.html#m5-2"><i class="fa fa-check"></i><b>4.7.4</b> 4M5</a></li>
<li class="chapter" data-level="4.7.5" data-path="geocentric-model.html"><a href="geocentric-model.html#m6-1"><i class="fa fa-check"></i><b>4.7.5</b> 4M6</a></li>
<li class="chapter" data-level="4.7.6" data-path="geocentric-model.html"><a href="geocentric-model.html#m7-1"><i class="fa fa-check"></i><b>4.7.6</b> 4M7</a></li>
<li class="chapter" data-level="4.7.7" data-path="geocentric-model.html"><a href="geocentric-model.html#m8"><i class="fa fa-check"></i><b>4.7.7</b> 4M8</a></li>
<li class="chapter" data-level="4.7.8" data-path="geocentric-model.html"><a href="geocentric-model.html#h1-2"><i class="fa fa-check"></i><b>4.7.8</b> 4H1</a></li>
<li class="chapter" data-level="4.7.9" data-path="geocentric-model.html"><a href="geocentric-model.html#h2-2"><i class="fa fa-check"></i><b>4.7.9</b> 4H2</a></li>
<li class="chapter" data-level="4.7.10" data-path="geocentric-model.html"><a href="geocentric-model.html#h3-2"><i class="fa fa-check"></i><b>4.7.10</b> 4H3</a></li>
<li class="chapter" data-level="4.7.11" data-path="geocentric-model.html"><a href="geocentric-model.html#h4-2"><i class="fa fa-check"></i><b>4.7.11</b> 4H4</a></li>
<li class="chapter" data-level="4.7.12" data-path="geocentric-model.html"><a href="geocentric-model.html#h5-1"><i class="fa fa-check"></i><b>4.7.12</b> 4H5</a></li>
<li class="chapter" data-level="4.7.13" data-path="geocentric-model.html"><a href="geocentric-model.html#h6"><i class="fa fa-check"></i><b>4.7.13</b> 4H6</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html"><i class="fa fa-check"></i><b>5</b> The many variables &amp; the spurious waffles</a>
<ul>
<li class="chapter" data-level="5.1" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#spurious-association"><i class="fa fa-check"></i><b>5.1</b> Spurious association</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#グラフを用いて因果モデルを考える"><i class="fa fa-check"></i><b>5.1.1</b> グラフを用いて因果モデルを考える</a></li>
<li class="chapter" data-level="5.1.2" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#predictor-residual-plots"><i class="fa fa-check"></i><b>5.1.2</b> Predictor residual plots</a></li>
<li class="chapter" data-level="5.1.3" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#posterior-prediction-plots"><i class="fa fa-check"></i><b>5.1.3</b> Posterior prediction plots</a></li>
<li class="chapter" data-level="5.1.4" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#counterfactual-plot"><i class="fa fa-check"></i><b>5.1.4</b> Counterfactual plot</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#masked-relationship"><i class="fa fa-check"></i><b>5.2</b> Masked relationship</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#k-nモデル"><i class="fa fa-check"></i><b>5.2.1</b> K ~ Nモデル</a></li>
<li class="chapter" data-level="5.2.2" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#k-mモデル"><i class="fa fa-check"></i><b>5.2.2</b> K ~ Mモデル</a></li>
<li class="chapter" data-level="5.2.3" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#k-n-mモデル"><i class="fa fa-check"></i><b>5.2.3</b> K ~ N + Mモデル</a></li>
<li class="chapter" data-level="5.2.4" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#counterfactual-plot-を描く"><i class="fa fa-check"></i><b>5.2.4</b> Counterfactual plot を描く</a></li>
<li class="chapter" data-level="5.2.5" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#overthinking-1"><i class="fa fa-check"></i><b>5.2.5</b> Overthinking</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#categorical-variables"><i class="fa fa-check"></i><b>5.3</b> Categorical variables</a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#two-categories"><i class="fa fa-check"></i><b>5.3.1</b> Two categories</a></li>
<li class="chapter" data-level="5.3.2" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#many-categories"><i class="fa fa-check"></i><b>5.3.2</b> Many Categories</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#practice-3"><i class="fa fa-check"></i><b>5.4</b> Practice</a>
<ul>
<li class="chapter" data-level="5.4.1" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#m1-3"><i class="fa fa-check"></i><b>5.4.1</b> 5M1</a></li>
<li class="chapter" data-level="5.4.2" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#m2-3"><i class="fa fa-check"></i><b>5.4.2</b> 5M2</a></li>
<li class="chapter" data-level="5.4.3" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#m4-3"><i class="fa fa-check"></i><b>5.4.3</b> 5M4</a></li>
<li class="chapter" data-level="5.4.4" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#h1-3"><i class="fa fa-check"></i><b>5.4.4</b> 5H1</a></li>
<li class="chapter" data-level="5.4.5" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#h2-3"><i class="fa fa-check"></i><b>5.4.5</b> 5H2</a></li>
<li class="chapter" data-level="5.4.6" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#h3-3"><i class="fa fa-check"></i><b>5.4.6</b> 5H3</a></li>
<li class="chapter" data-level="5.4.7" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#h4-3"><i class="fa fa-check"></i><b>5.4.7</b> 5H4</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html"><i class="fa fa-check"></i><b>6</b> The Haunted DAG &amp; the Causal Terror</a>
<ul>
<li class="chapter" data-level="6.1" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#multicollinearity"><i class="fa fa-check"></i><b>6.1</b> Multicollinearity</a>
<ul>
<li class="chapter" data-level="6.1.1" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#multicollinear-milk"><i class="fa fa-check"></i><b>6.1.1</b> Multicollinear milk</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#post-treatment-bias"><i class="fa fa-check"></i><b>6.2</b> Post-treatment bias</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#blocked-by-consequence"><i class="fa fa-check"></i><b>6.2.1</b> Blocked by consequence</a></li>
<li class="chapter" data-level="6.2.2" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#fungus-and-d-separation"><i class="fa fa-check"></i><b>6.2.2</b> Fungus and d-separation</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#collider-bias"><i class="fa fa-check"></i><b>6.3</b> Collider bias</a>
<ul>
<li class="chapter" data-level="6.3.1" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#collider-of-false-sorrow"><i class="fa fa-check"></i><b>6.3.1</b> Collider of false sorrow</a></li>
<li class="chapter" data-level="6.3.2" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#the-haunted-dag"><i class="fa fa-check"></i><b>6.3.2</b> The haunted DAG</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#confronting-confoundings"><i class="fa fa-check"></i><b>6.4</b> Confronting confoundings</a>
<ul>
<li class="chapter" data-level="6.4.1" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#two-roads"><i class="fa fa-check"></i><b>6.4.1</b> Two roads</a></li>
<li class="chapter" data-level="6.4.2" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#backdoor-waffles"><i class="fa fa-check"></i><b>6.4.2</b> Backdoor Waffles</a></li>
</ul></li>
<li class="chapter" data-level="6.5" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#practice-4"><i class="fa fa-check"></i><b>6.5</b> Practice</a>
<ul>
<li class="chapter" data-level="6.5.1" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#m1-4"><i class="fa fa-check"></i><b>6.5.1</b> 6M1</a></li>
<li class="chapter" data-level="6.5.2" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#m2-4"><i class="fa fa-check"></i><b>6.5.2</b> 6M2</a></li>
<li class="chapter" data-level="6.5.3" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#h1-4"><i class="fa fa-check"></i><b>6.5.3</b> 6H1</a></li>
<li class="chapter" data-level="6.5.4" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#h2-4"><i class="fa fa-check"></i><b>6.5.4</b> 6H2</a></li>
<li class="chapter" data-level="6.5.5" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#h3-4"><i class="fa fa-check"></i><b>6.5.5</b> 6H3</a></li>
<li class="chapter" data-level="6.5.6" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#h4-4"><i class="fa fa-check"></i><b>6.5.6</b> 6H4</a></li>
<li class="chapter" data-level="6.5.7" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#h5-2"><i class="fa fa-check"></i><b>6.5.7</b> 6H5</a></li>
</ul></li>
<li class="chapter" data-level="6.6" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#おまけ-ランダム効果を入れてみる"><i class="fa fa-check"></i><b>6.6</b> おまけ　ランダム効果を入れてみる</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="ulysses-compass.html"><a href="ulysses-compass.html"><i class="fa fa-check"></i><b>7</b> Ulysses’ Compass</a>
<ul>
<li class="chapter" data-level="7.1" data-path="ulysses-compass.html"><a href="ulysses-compass.html#the-problems-with-parameters"><i class="fa fa-check"></i><b>7.1</b> The problems with parameters</a>
<ul>
<li class="chapter" data-level="7.1.1" data-path="ulysses-compass.html"><a href="ulysses-compass.html#more-parameters-always-improve-fit"><i class="fa fa-check"></i><b>7.1.1</b> More parameters always improve fit</a></li>
<li class="chapter" data-level="7.1.2" data-path="ulysses-compass.html"><a href="ulysses-compass.html#too-few-parameters-hurts-too"><i class="fa fa-check"></i><b>7.1.2</b> Too few parameters hurts too</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="ulysses-compass.html"><a href="ulysses-compass.html#entropy-and-accuracy"><i class="fa fa-check"></i><b>7.2</b> Entropy and accuracy</a>
<ul>
<li class="chapter" data-level="7.2.1" data-path="ulysses-compass.html"><a href="ulysses-compass.html#information-and-uncertainty"><i class="fa fa-check"></i><b>7.2.1</b> Information and uncertainty</a></li>
<li class="chapter" data-level="7.2.2" data-path="ulysses-compass.html"><a href="ulysses-compass.html#from-entropy-to-acculacy"><i class="fa fa-check"></i><b>7.2.2</b> From entropy to acculacy</a></li>
<li class="chapter" data-level="7.2.3" data-path="ulysses-compass.html"><a href="ulysses-compass.html#estimating-divergence"><i class="fa fa-check"></i><b>7.2.3</b> Estimating divergence</a></li>
<li class="chapter" data-level="7.2.4" data-path="ulysses-compass.html"><a href="ulysses-compass.html#scoring-the-right-data"><i class="fa fa-check"></i><b>7.2.4</b> Scoring the right data</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="ulysses-compass.html"><a href="ulysses-compass.html#golem-taming-regularization"><i class="fa fa-check"></i><b>7.3</b> Golem taming: regularization</a></li>
<li class="chapter" data-level="7.4" data-path="ulysses-compass.html"><a href="ulysses-compass.html#predicting-predictive-accuracy"><i class="fa fa-check"></i><b>7.4</b> Predicting predictive accuracy</a>
<ul>
<li class="chapter" data-level="7.4.1" data-path="ulysses-compass.html"><a href="ulysses-compass.html#cross-validation"><i class="fa fa-check"></i><b>7.4.1</b> Cross validation</a></li>
<li class="chapter" data-level="7.4.2" data-path="ulysses-compass.html"><a href="ulysses-compass.html#information-criteria"><i class="fa fa-check"></i><b>7.4.2</b> Information criteria</a></li>
<li class="chapter" data-level="7.4.3" data-path="ulysses-compass.html"><a href="ulysses-compass.html#overthinking-waic-calculation"><i class="fa fa-check"></i><b>7.4.3</b> overthinking: WAIC calculation</a></li>
<li class="chapter" data-level="7.4.4" data-path="ulysses-compass.html"><a href="ulysses-compass.html#comparing-cv-psis-and-waic"><i class="fa fa-check"></i><b>7.4.4</b> Comparing CV, PSIS, and WAIC</a></li>
</ul></li>
<li class="chapter" data-level="7.5" data-path="ulysses-compass.html"><a href="ulysses-compass.html#model-comparison"><i class="fa fa-check"></i><b>7.5</b> Model comparison</a>
<ul>
<li class="chapter" data-level="7.5.1" data-path="ulysses-compass.html"><a href="ulysses-compass.html#model-mis-selection"><i class="fa fa-check"></i><b>7.5.1</b> Model mis-selection</a></li>
<li class="chapter" data-level="7.5.2" data-path="ulysses-compass.html"><a href="ulysses-compass.html#outlier-and-other-illusions"><i class="fa fa-check"></i><b>7.5.2</b> Outlier and other illusions</a></li>
</ul></li>
<li class="chapter" data-level="7.6" data-path="ulysses-compass.html"><a href="ulysses-compass.html#practice-5"><i class="fa fa-check"></i><b>7.6</b> Practice</a>
<ul>
<li class="chapter" data-level="7.6.1" data-path="ulysses-compass.html"><a href="ulysses-compass.html#e2"><i class="fa fa-check"></i><b>7.6.1</b> 7E2</a></li>
<li class="chapter" data-level="7.6.2" data-path="ulysses-compass.html"><a href="ulysses-compass.html#e3"><i class="fa fa-check"></i><b>7.6.2</b> 7E3</a></li>
<li class="chapter" data-level="7.6.3" data-path="ulysses-compass.html"><a href="ulysses-compass.html#e4"><i class="fa fa-check"></i><b>7.6.3</b> 7E4</a></li>
<li class="chapter" data-level="7.6.4" data-path="ulysses-compass.html"><a href="ulysses-compass.html#m4-4"><i class="fa fa-check"></i><b>7.6.4</b> 7M4</a></li>
<li class="chapter" data-level="7.6.5" data-path="ulysses-compass.html"><a href="ulysses-compass.html#h1-5"><i class="fa fa-check"></i><b>7.6.5</b> 7H1</a></li>
<li class="chapter" data-level="7.6.6" data-path="ulysses-compass.html"><a href="ulysses-compass.html#h2-5"><i class="fa fa-check"></i><b>7.6.6</b> 7H2</a></li>
<li class="chapter" data-level="7.6.7" data-path="ulysses-compass.html"><a href="ulysses-compass.html#h3-5"><i class="fa fa-check"></i><b>7.6.7</b> 7H3</a></li>
<li class="chapter" data-level="7.6.8" data-path="ulysses-compass.html"><a href="ulysses-compass.html#h4-5"><i class="fa fa-check"></i><b>7.6.8</b> 7H4</a></li>
<li class="chapter" data-level="7.6.9" data-path="ulysses-compass.html"><a href="ulysses-compass.html#h5-3"><i class="fa fa-check"></i><b>7.6.9</b> 7H5</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="conditional-manatees.html"><a href="conditional-manatees.html"><i class="fa fa-check"></i><b>8</b> Conditional Manatees</a>
<ul>
<li class="chapter" data-level="8.1" data-path="conditional-manatees.html"><a href="conditional-manatees.html#building-an-interaction"><i class="fa fa-check"></i><b>8.1</b> Building an interaction</a>
<ul>
<li class="chapter" data-level="8.1.1" data-path="conditional-manatees.html"><a href="conditional-manatees.html#making-a-rugged-model"><i class="fa fa-check"></i><b>8.1.1</b> Making a rugged model</a></li>
<li class="chapter" data-level="8.1.2" data-path="conditional-manatees.html"><a href="conditional-manatees.html#adding-an-indicator-variable-isnt-enough"><i class="fa fa-check"></i><b>8.1.2</b> Adding an indicator variable isn’t enough</a></li>
<li class="chapter" data-level="8.1.3" data-path="conditional-manatees.html"><a href="conditional-manatees.html#adding-interaction-does-work"><i class="fa fa-check"></i><b>8.1.3</b> Adding interaction does work</a></li>
<li class="chapter" data-level="8.1.4" data-path="conditional-manatees.html"><a href="conditional-manatees.html#plotting-the-interaction"><i class="fa fa-check"></i><b>8.1.4</b> Plotting the interaction</a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="conditional-manatees.html"><a href="conditional-manatees.html#symmetry-of-interaction"><i class="fa fa-check"></i><b>8.2</b> Symmetry of interaction</a></li>
<li class="chapter" data-level="8.3" data-path="conditional-manatees.html"><a href="conditional-manatees.html#continuous-interaction"><i class="fa fa-check"></i><b>8.3</b> Continuous interaction</a>
<ul>
<li class="chapter" data-level="8.3.1" data-path="conditional-manatees.html"><a href="conditional-manatees.html#a-winter-flower"><i class="fa fa-check"></i><b>8.3.1</b> A winter flower</a></li>
<li class="chapter" data-level="8.3.2" data-path="conditional-manatees.html"><a href="conditional-manatees.html#the-models"><i class="fa fa-check"></i><b>8.3.2</b> The models</a></li>
<li class="chapter" data-level="8.3.3" data-path="conditional-manatees.html"><a href="conditional-manatees.html#plotting-posterior-predictions"><i class="fa fa-check"></i><b>8.3.3</b> Plotting posterior predictions</a></li>
<li class="chapter" data-level="8.3.4" data-path="conditional-manatees.html"><a href="conditional-manatees.html#plotting-prior-predictions"><i class="fa fa-check"></i><b>8.3.4</b> Plotting prior predictions</a></li>
</ul></li>
<li class="chapter" data-level="8.4" data-path="conditional-manatees.html"><a href="conditional-manatees.html#practice-6"><i class="fa fa-check"></i><b>8.4</b> Practice</a>
<ul>
<li class="chapter" data-level="8.4.1" data-path="conditional-manatees.html"><a href="conditional-manatees.html#m4-5"><i class="fa fa-check"></i><b>8.4.1</b> 8M4</a></li>
<li class="chapter" data-level="8.4.2" data-path="conditional-manatees.html"><a href="conditional-manatees.html#h1-6"><i class="fa fa-check"></i><b>8.4.2</b> 8H1</a></li>
<li class="chapter" data-level="8.4.3" data-path="conditional-manatees.html"><a href="conditional-manatees.html#h2-6"><i class="fa fa-check"></i><b>8.4.3</b> 8H2</a></li>
<li class="chapter" data-level="8.4.4" data-path="conditional-manatees.html"><a href="conditional-manatees.html#h3-6"><i class="fa fa-check"></i><b>8.4.4</b> 8H3</a></li>
<li class="chapter" data-level="8.4.5" data-path="conditional-manatees.html"><a href="conditional-manatees.html#h4-6"><i class="fa fa-check"></i><b>8.4.5</b> 8H4</a></li>
<li class="chapter" data-level="8.4.6" data-path="conditional-manatees.html"><a href="conditional-manatees.html#h5-4"><i class="fa fa-check"></i><b>8.4.6</b> 8H5</a></li>
<li class="chapter" data-level="8.4.7" data-path="conditional-manatees.html"><a href="conditional-manatees.html#h6-1"><i class="fa fa-check"></i><b>8.4.7</b> 8H6</a></li>
<li class="chapter" data-level="8.4.8" data-path="conditional-manatees.html"><a href="conditional-manatees.html#h7"><i class="fa fa-check"></i><b>8.4.8</b> 8H7</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="9" data-path="marcov-chain-monte-carlo.html"><a href="marcov-chain-monte-carlo.html"><i class="fa fa-check"></i><b>9</b> Marcov Chain Monte Carlo</a>
<ul>
<li class="chapter" data-level="9.1" data-path="marcov-chain-monte-carlo.html"><a href="marcov-chain-monte-carlo.html#good-king-marcov-and-his-island-kingdom"><i class="fa fa-check"></i><b>9.1</b> Good King Marcov and his island kingdom</a></li>
<li class="chapter" data-level="9.2" data-path="marcov-chain-monte-carlo.html"><a href="marcov-chain-monte-carlo.html#metropolis-algorythm"><i class="fa fa-check"></i><b>9.2</b> Metropolis algorythm</a>
<ul>
<li class="chapter" data-level="9.2.1" data-path="marcov-chain-monte-carlo.html"><a href="marcov-chain-monte-carlo.html#gibbs-sampling"><i class="fa fa-check"></i><b>9.2.1</b> Gibbs sampling</a></li>
<li class="chapter" data-level="9.2.2" data-path="marcov-chain-monte-carlo.html"><a href="marcov-chain-monte-carlo.html#high-dimentional-problem"><i class="fa fa-check"></i><b>9.2.2</b> High-dimentional problem</a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="marcov-chain-monte-carlo.html"><a href="marcov-chain-monte-carlo.html#hamiltonian-monte-carlo"><i class="fa fa-check"></i><b>9.3</b> Hamiltonian Monte Carlo</a>
<ul>
<li class="chapter" data-level="9.3.1" data-path="marcov-chain-monte-carlo.html"><a href="marcov-chain-monte-carlo.html#another-probable"><i class="fa fa-check"></i><b>9.3.1</b> Another probable</a></li>
<li class="chapter" data-level="9.3.2" data-path="marcov-chain-monte-carlo.html"><a href="marcov-chain-monte-carlo.html#limitations"><i class="fa fa-check"></i><b>9.3.2</b> Limitations</a></li>
</ul></li>
<li class="chapter" data-level="9.4" data-path="marcov-chain-monte-carlo.html"><a href="marcov-chain-monte-carlo.html#easy-hmc-ulam-brm"><i class="fa fa-check"></i><b>9.4</b> Easy HMC: <del>ulam</del> <code>brm()</code></a>
<ul>
<li class="chapter" data-level="9.4.1" data-path="marcov-chain-monte-carlo.html"><a href="marcov-chain-monte-carlo.html#preparation"><i class="fa fa-check"></i><b>9.4.1</b> Preparation</a></li>
<li class="chapter" data-level="9.4.2" data-path="marcov-chain-monte-carlo.html"><a href="marcov-chain-monte-carlo.html#sampling-from-posterior"><i class="fa fa-check"></i><b>9.4.2</b> Sampling from posterior</a></li>
<li class="chapter" data-level="9.4.3" data-path="marcov-chain-monte-carlo.html"><a href="marcov-chain-monte-carlo.html#sampling-again-in-parallel"><i class="fa fa-check"></i><b>9.4.3</b> Sampling again in parallel</a></li>
<li class="chapter" data-level="9.4.4" data-path="marcov-chain-monte-carlo.html"><a href="marcov-chain-monte-carlo.html#visualization"><i class="fa fa-check"></i><b>9.4.4</b> Visualization</a></li>
<li class="chapter" data-level="9.4.5" data-path="marcov-chain-monte-carlo.html"><a href="marcov-chain-monte-carlo.html#checking-the-chain"><i class="fa fa-check"></i><b>9.4.5</b> Checking the chain</a></li>
</ul></li>
<li class="chapter" data-level="9.5" data-path="marcov-chain-monte-carlo.html"><a href="marcov-chain-monte-carlo.html#care-and-feeding-of-your-marcov-chain"><i class="fa fa-check"></i><b>9.5</b> Care and feeding of your Marcov chain</a>
<ul>
<li class="chapter" data-level="9.5.1" data-path="marcov-chain-monte-carlo.html"><a href="marcov-chain-monte-carlo.html#how-many-samples-do-you-need"><i class="fa fa-check"></i><b>9.5.1</b> How many samples do you need</a></li>
<li class="chapter" data-level="9.5.2" data-path="marcov-chain-monte-carlo.html"><a href="marcov-chain-monte-carlo.html#how-many-chains-do-we-need"><i class="fa fa-check"></i><b>9.5.2</b> How many chains do we need</a></li>
<li class="chapter" data-level="9.5.3" data-path="marcov-chain-monte-carlo.html"><a href="marcov-chain-monte-carlo.html#taming-and-wild-chain"><i class="fa fa-check"></i><b>9.5.3</b> Taming and wild chain</a></li>
<li class="chapter" data-level="9.5.4" data-path="marcov-chain-monte-carlo.html"><a href="marcov-chain-monte-carlo.html#non-identifiable-parameters"><i class="fa fa-check"></i><b>9.5.4</b> Non-identifiable parameters</a></li>
</ul></li>
<li class="chapter" data-level="9.6" data-path="marcov-chain-monte-carlo.html"><a href="marcov-chain-monte-carlo.html#practice-7"><i class="fa fa-check"></i><b>9.6</b> Practice</a>
<ul>
<li class="chapter" data-level="9.6.1" data-path="marcov-chain-monte-carlo.html"><a href="marcov-chain-monte-carlo.html#m1-5"><i class="fa fa-check"></i><b>9.6.1</b> 9M1</a></li>
<li class="chapter" data-level="9.6.2" data-path="marcov-chain-monte-carlo.html"><a href="marcov-chain-monte-carlo.html#m2-5"><i class="fa fa-check"></i><b>9.6.2</b> 9M2</a></li>
<li class="chapter" data-level="9.6.3" data-path="marcov-chain-monte-carlo.html"><a href="marcov-chain-monte-carlo.html#m3-2"><i class="fa fa-check"></i><b>9.6.3</b> 9M3</a></li>
<li class="chapter" data-level="9.6.4" data-path="marcov-chain-monte-carlo.html"><a href="marcov-chain-monte-carlo.html#h1-7"><i class="fa fa-check"></i><b>9.6.4</b> 9H1</a></li>
<li class="chapter" data-level="9.6.5" data-path="marcov-chain-monte-carlo.html"><a href="marcov-chain-monte-carlo.html#h2-7"><i class="fa fa-check"></i><b>9.6.5</b> 9H2</a></li>
<li class="chapter" data-level="9.6.6" data-path="marcov-chain-monte-carlo.html"><a href="marcov-chain-monte-carlo.html#h3-7"><i class="fa fa-check"></i><b>9.6.6</b> 9H3</a></li>
<li class="chapter" data-level="9.6.7" data-path="marcov-chain-monte-carlo.html"><a href="marcov-chain-monte-carlo.html#h4-7"><i class="fa fa-check"></i><b>9.6.7</b> 9H4</a></li>
<li class="chapter" data-level="9.6.8" data-path="marcov-chain-monte-carlo.html"><a href="marcov-chain-monte-carlo.html#h5-5"><i class="fa fa-check"></i><b>9.6.8</b> 9H5</a></li>
<li class="chapter" data-level="9.6.9" data-path="marcov-chain-monte-carlo.html"><a href="marcov-chain-monte-carlo.html#h6-2"><i class="fa fa-check"></i><b>9.6.9</b> 9H6</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="10" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html"><i class="fa fa-check"></i><b>10</b> Big Entropy and the Generalized Linear Model</a>
<ul>
<li class="chapter" data-level="10.1" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html#maximum-entropy"><i class="fa fa-check"></i><b>10.1</b> Maximum entropy</a>
<ul>
<li class="chapter" data-level="10.1.1" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html#gaussian"><i class="fa fa-check"></i><b>10.1.1</b> Gaussian</a></li>
<li class="chapter" data-level="10.1.2" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html#binomial"><i class="fa fa-check"></i><b>10.1.2</b> Binomial</a></li>
</ul></li>
<li class="chapter" data-level="10.2" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html#generalized-linear-models"><i class="fa fa-check"></i><b>10.2</b> Generalized linear models</a>
<ul>
<li class="chapter" data-level="10.2.1" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html#meet-the-family"><i class="fa fa-check"></i><b>10.2.1</b> Meet the family</a></li>
<li class="chapter" data-level="10.2.2" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html#linking-linear-models-to-distributions"><i class="fa fa-check"></i><b>10.2.2</b> Linking linear models to distributions</a></li>
<li class="chapter" data-level="10.2.3" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html#overthinking-2"><i class="fa fa-check"></i><b>10.2.3</b> Overthinking</a></li>
<li class="chapter" data-level="10.2.4" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html#omitted-variable-bias-again"><i class="fa fa-check"></i><b>10.2.4</b> Omitted variable bias again</a></li>
<li class="chapter" data-level="10.2.5" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html#absolute-and-relative-differences"><i class="fa fa-check"></i><b>10.2.5</b> Absolute and relative differences</a></li>
<li class="chapter" data-level="10.2.6" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html#glms-and-information-criteria"><i class="fa fa-check"></i><b>10.2.6</b> GLMs and information criteria</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="11" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html"><i class="fa fa-check"></i><b>11</b> God Spiked the Integers</a>
<ul>
<li class="chapter" data-level="11.1" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#binomial-regression"><i class="fa fa-check"></i><b>11.1</b> Binomial regression</a>
<ul>
<li class="chapter" data-level="11.1.1" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#logistic-regression"><i class="fa fa-check"></i><b>11.1.1</b> Logistic regression</a></li>
<li class="chapter" data-level="11.1.2" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#relative-shark-and-absolute-deer"><i class="fa fa-check"></i><b>11.1.2</b> Relative shark and absolute deer</a></li>
<li class="chapter" data-level="11.1.3" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#aggregated-binomial-chimpanzees-again-condensed"><i class="fa fa-check"></i><b>11.1.3</b> Aggregated binomial: Chimpanzees again, condensed</a></li>
</ul></li>
<li class="chapter" data-level="11.2" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#aggregated-binomial-graduate-school-admittions."><i class="fa fa-check"></i><b>11.2</b> Aggregated binomial: Graduate school admittions.</a></li>
<li class="chapter" data-level="11.3" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#poisson-regression"><i class="fa fa-check"></i><b>11.3</b> Poisson regression</a>
<ul>
<li class="chapter" data-level="11.3.1" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#oceanic-tool-complexity"><i class="fa fa-check"></i><b>11.3.1</b> Oceanic tool complexity</a></li>
<li class="chapter" data-level="11.3.2" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#negative-binomial-gamma-poisson-models."><i class="fa fa-check"></i><b>11.3.2</b> Negative binomial (Gamma-Poisson) models.</a></li>
<li class="chapter" data-level="11.3.3" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#example-exposure-and-the-offset"><i class="fa fa-check"></i><b>11.3.3</b> Example: Exposure and the offset</a></li>
</ul></li>
<li class="chapter" data-level="11.4" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#multinomial-and-categorical-models"><i class="fa fa-check"></i><b>11.4</b> Multinomial and categorical models</a>
<ul>
<li class="chapter" data-level="11.4.1" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#predictors-matched-to-outcomes"><i class="fa fa-check"></i><b>11.4.1</b> Predictors matched to outcomes</a></li>
<li class="chapter" data-level="11.4.2" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#predictor-matched-to-observations"><i class="fa fa-check"></i><b>11.4.2</b> Predictor matched to observations</a></li>
<li class="chapter" data-level="11.4.3" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#multinomial-in-disguise-as-poisson"><i class="fa fa-check"></i><b>11.4.3</b> Multinomial in disguise as Poisson</a></li>
</ul></li>
<li class="chapter" data-level="11.5" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#practice-8"><i class="fa fa-check"></i><b>11.5</b> Practice</a>
<ul>
<li class="chapter" data-level="11.5.1" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#e1"><i class="fa fa-check"></i><b>11.5.1</b> 11E1</a></li>
<li class="chapter" data-level="11.5.2" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#e2-1"><i class="fa fa-check"></i><b>11.5.2</b> 11E2</a></li>
<li class="chapter" data-level="11.5.3" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#e3-1"><i class="fa fa-check"></i><b>11.5.3</b> 11E3</a></li>
<li class="chapter" data-level="11.5.4" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#e4-1"><i class="fa fa-check"></i><b>11.5.4</b> 11E4</a></li>
<li class="chapter" data-level="11.5.5" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#m7-2"><i class="fa fa-check"></i><b>11.5.5</b> 11M7</a></li>
<li class="chapter" data-level="11.5.6" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#m8-1"><i class="fa fa-check"></i><b>11.5.6</b> 11M8</a></li>
<li class="chapter" data-level="11.5.7" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#h1-8"><i class="fa fa-check"></i><b>11.5.7</b> 11H1</a></li>
<li class="chapter" data-level="11.5.8" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#h2-8"><i class="fa fa-check"></i><b>11.5.8</b> 11H2</a></li>
<li class="chapter" data-level="11.5.9" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#h3-8"><i class="fa fa-check"></i><b>11.5.9</b> 11H3</a></li>
<li class="chapter" data-level="11.5.10" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#h4-8"><i class="fa fa-check"></i><b>11.5.10</b> 11H4</a></li>
<li class="chapter" data-level="11.5.11" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#h5-6"><i class="fa fa-check"></i><b>11.5.11</b> 11H5</a></li>
<li class="chapter" data-level="11.5.12" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#h6-3"><i class="fa fa-check"></i><b>11.5.12</b> 11H6</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="12" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html"><i class="fa fa-check"></i><b>12</b> Monsters and Mixtures</a>
<ul>
<li class="chapter" data-level="12.1" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#over-dispersed-counts"><i class="fa fa-check"></i><b>12.1</b> Over-dispersed counts</a>
<ul>
<li class="chapter" data-level="12.1.1" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#beta-binomial."><i class="fa fa-check"></i><b>12.1.1</b> Beta binomial.</a></li>
<li class="chapter" data-level="12.1.2" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#negative-binomial-or-gamma-poisson."><i class="fa fa-check"></i><b>12.1.2</b> Negative binomial or gamma-Poisson.</a></li>
<li class="chapter" data-level="12.1.3" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#over-dispersion-entropy-and-information-criteria."><i class="fa fa-check"></i><b>12.1.3</b> Over-dispersion, entropy, and information criteria.</a></li>
</ul></li>
<li class="chapter" data-level="12.2" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#zero-inflated-outcomes"><i class="fa fa-check"></i><b>12.2</b> Zero-inflated outcomes</a>
<ul>
<li class="chapter" data-level="12.2.1" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#example-zero-inflated-poisson."><i class="fa fa-check"></i><b>12.2.1</b> Example: Zero-inflated Poisson.</a></li>
</ul></li>
<li class="chapter" data-level="12.3" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#ordered-categorical-outcomes"><i class="fa fa-check"></i><b>12.3</b> Ordered categorical outcomes</a>
<ul>
<li class="chapter" data-level="12.3.1" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#example-moral-intuition."><i class="fa fa-check"></i><b>12.3.1</b> Example: Moral intuition.</a></li>
<li class="chapter" data-level="12.3.2" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#adding-predictor-variables."><i class="fa fa-check"></i><b>12.3.2</b> Adding predictor variables.</a></li>
</ul></li>
<li class="chapter" data-level="12.4" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#ordered-categorical-predictors"><i class="fa fa-check"></i><b>12.4</b> Ordered categorical predictors</a></li>
<li class="chapter" data-level="12.5" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#practice-9"><i class="fa fa-check"></i><b>12.5</b> Practice</a>
<ul>
<li class="chapter" data-level="12.5.1" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#m1-6"><i class="fa fa-check"></i><b>12.5.1</b> 12M1</a></li>
<li class="chapter" data-level="12.5.2" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#m2-6"><i class="fa fa-check"></i><b>12.5.2</b> 12M2</a></li>
<li class="chapter" data-level="12.5.3" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#m3-3"><i class="fa fa-check"></i><b>12.5.3</b> 12M3</a></li>
<li class="chapter" data-level="12.5.4" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#h1-9"><i class="fa fa-check"></i><b>12.5.4</b> 12H1</a></li>
<li class="chapter" data-level="12.5.5" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#h2-9"><i class="fa fa-check"></i><b>12.5.5</b> 12H2</a></li>
<li class="chapter" data-level="12.5.6" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#h3-9"><i class="fa fa-check"></i><b>12.5.6</b> 12H3</a></li>
<li class="chapter" data-level="12.5.7" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#h4-9"><i class="fa fa-check"></i><b>12.5.7</b> 12H4</a></li>
<li class="chapter" data-level="12.5.8" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#h5-7"><i class="fa fa-check"></i><b>12.5.8</b> 12H5</a></li>
<li class="chapter" data-level="12.5.9" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#h6-4"><i class="fa fa-check"></i><b>12.5.9</b> 12H6</a></li>
<li class="chapter" data-level="12.5.10" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#h7-1"><i class="fa fa-check"></i><b>12.5.10</b> 12H7</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="13" data-path="models-with-memory.html"><a href="models-with-memory.html"><i class="fa fa-check"></i><b>13</b> Models with Memory</a>
<ul>
<li class="chapter" data-level="13.1" data-path="models-with-memory.html"><a href="models-with-memory.html#multilevel-tadpoles"><i class="fa fa-check"></i><b>13.1</b> Multilevel tadpoles</a></li>
<li class="chapter" data-level="13.2" data-path="models-with-memory.html"><a href="models-with-memory.html#varying-effects-and-the-underfittingoverfitting-trade-off"><i class="fa fa-check"></i><b>13.2</b> Varying effects and the underfitting/overfitting trade-off 　</a>
<ul>
<li class="chapter" data-level="13.2.1" data-path="models-with-memory.html"><a href="models-with-memory.html#the-model"><i class="fa fa-check"></i><b>13.2.1</b> The model</a></li>
<li class="chapter" data-level="13.2.2" data-path="models-with-memory.html"><a href="models-with-memory.html#simulate-survivors"><i class="fa fa-check"></i><b>13.2.2</b> Simulate survivors</a></li>
</ul></li>
<li class="chapter" data-level="13.3" data-path="models-with-memory.html"><a href="models-with-memory.html#more-than-one-type-of-cluster"><i class="fa fa-check"></i><b>13.3</b> More than one type of cluster</a>
<ul>
<li class="chapter" data-level="13.3.1" data-path="models-with-memory.html"><a href="models-with-memory.html#even-more-clusters"><i class="fa fa-check"></i><b>13.3.1</b> Even more clusters</a></li>
</ul></li>
<li class="chapter" data-level="13.4" data-path="models-with-memory.html"><a href="models-with-memory.html#divergent-transitions-and-non-centered-priors"><i class="fa fa-check"></i><b>13.4</b> Divergent transitions and non-centered priors</a>
<ul>
<li class="chapter" data-level="13.4.1" data-path="models-with-memory.html"><a href="models-with-memory.html#the-devils-funnel"><i class="fa fa-check"></i><b>13.4.1</b> The Devil’s Funnel</a></li>
<li class="chapter" data-level="13.4.2" data-path="models-with-memory.html"><a href="models-with-memory.html#non-centered-chimpanzees"><i class="fa fa-check"></i><b>13.4.2</b> Non-centered chimpanzees</a></li>
</ul></li>
<li class="chapter" data-level="13.5" data-path="models-with-memory.html"><a href="models-with-memory.html#multilevel-posterior-predictions"><i class="fa fa-check"></i><b>13.5</b> Multilevel posterior predictions</a>
<ul>
<li class="chapter" data-level="13.5.1" data-path="models-with-memory.html"><a href="models-with-memory.html#posterior-prediction-for-same-clusters"><i class="fa fa-check"></i><b>13.5.1</b> Posterior prediction for same clusters</a></li>
<li class="chapter" data-level="13.5.2" data-path="models-with-memory.html"><a href="models-with-memory.html#posterior-prediction-for-new-clusters"><i class="fa fa-check"></i><b>13.5.2</b> Posterior prediction for new clusters</a></li>
</ul></li>
<li class="chapter" data-level="13.6" data-path="models-with-memory.html"><a href="models-with-memory.html#post-stratification"><i class="fa fa-check"></i><b>13.6</b> Post stratification</a>
<ul>
<li class="chapter" data-level="13.6.1" data-path="models-with-memory.html"><a href="models-with-memory.html#meet-the-data"><i class="fa fa-check"></i><b>13.6.1</b> Meet the data</a></li>
<li class="chapter" data-level="13.6.2" data-path="models-with-memory.html"><a href="models-with-memory.html#settle-the-mr-part-of-mrp."><i class="fa fa-check"></i><b>13.6.2</b> Settle the MR part of MRP.</a></li>
<li class="chapter" data-level="13.6.3" data-path="models-with-memory.html"><a href="models-with-memory.html#post-stratify-to-put-the-p-in-mrp."><i class="fa fa-check"></i><b>13.6.3</b> Post-stratify to put the P in MRP.</a></li>
</ul></li>
<li class="chapter" data-level="13.7" data-path="models-with-memory.html"><a href="models-with-memory.html#practice-10"><i class="fa fa-check"></i><b>13.7</b> Practice</a>
<ul>
<li class="chapter" data-level="13.7.1" data-path="models-with-memory.html"><a href="models-with-memory.html#m1-7"><i class="fa fa-check"></i><b>13.7.1</b> 13M1</a></li>
<li class="chapter" data-level="13.7.2" data-path="models-with-memory.html"><a href="models-with-memory.html#m2-7"><i class="fa fa-check"></i><b>13.7.2</b> 13M2</a></li>
<li class="chapter" data-level="13.7.3" data-path="models-with-memory.html"><a href="models-with-memory.html#m3-4"><i class="fa fa-check"></i><b>13.7.3</b> 13M3</a></li>
<li class="chapter" data-level="13.7.4" data-path="models-with-memory.html"><a href="models-with-memory.html#m4-6"><i class="fa fa-check"></i><b>13.7.4</b> 13M4</a></li>
<li class="chapter" data-level="13.7.5" data-path="models-with-memory.html"><a href="models-with-memory.html#m5-3"><i class="fa fa-check"></i><b>13.7.5</b> 13M5</a></li>
<li class="chapter" data-level="13.7.6" data-path="models-with-memory.html"><a href="models-with-memory.html#m6-2"><i class="fa fa-check"></i><b>13.7.6</b> 13M6</a></li>
<li class="chapter" data-level="13.7.7" data-path="models-with-memory.html"><a href="models-with-memory.html#h1-10"><i class="fa fa-check"></i><b>13.7.7</b> 13H1</a></li>
<li class="chapter" data-level="13.7.8" data-path="models-with-memory.html"><a href="models-with-memory.html#h2-10"><i class="fa fa-check"></i><b>13.7.8</b> 13H2</a></li>
<li class="chapter" data-level="13.7.9" data-path="models-with-memory.html"><a href="models-with-memory.html#h3-10"><i class="fa fa-check"></i><b>13.7.9</b> 13H3</a></li>
<li class="chapter" data-level="13.7.10" data-path="models-with-memory.html"><a href="models-with-memory.html#h4-10"><i class="fa fa-check"></i><b>13.7.10</b> 13H4</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="14" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html"><i class="fa fa-check"></i><b>14</b> Adventures in Covariance</a>
<ul>
<li class="chapter" data-level="14.1" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#varying-slopes-by-construction"><i class="fa fa-check"></i><b>14.1</b> Varying slopes by construction</a>
<ul>
<li class="chapter" data-level="14.1.1" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#simulate-and-population"><i class="fa fa-check"></i><b>14.1.1</b> Simulate and population</a></li>
<li class="chapter" data-level="14.1.2" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#simulate-observation"><i class="fa fa-check"></i><b>14.1.2</b> Simulate observation</a></li>
<li class="chapter" data-level="14.1.3" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#the-varying-slope-model"><i class="fa fa-check"></i><b>14.1.3</b> The varying slope model</a></li>
</ul></li>
<li class="chapter" data-level="14.2" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#advanced-varing-slopes"><i class="fa fa-check"></i><b>14.2</b> Advanced varing slopes</a></li>
<li class="chapter" data-level="14.3" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#instruments-and-causal-designs"><i class="fa fa-check"></i><b>14.3</b> Instruments and causal designs</a>
<ul>
<li class="chapter" data-level="14.3.1" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#instrumental-variables"><i class="fa fa-check"></i><b>14.3.1</b> Instrumental variables</a></li>
<li class="chapter" data-level="14.3.2" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#other-designs"><i class="fa fa-check"></i><b>14.3.2</b> Other designs</a></li>
</ul></li>
<li class="chapter" data-level="14.4" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#social-relations-as-correlated-varying-effects"><i class="fa fa-check"></i><b>14.4</b> Social relations as correlated varying effects</a></li>
<li class="chapter" data-level="14.5" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#continuous-categories-and-the-gaussian-process"><i class="fa fa-check"></i><b>14.5</b> Continuous categories and the Gaussian process</a>
<ul>
<li class="chapter" data-level="14.5.1" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#example-spatial-autocorrelation-in-oceanic-tools"><i class="fa fa-check"></i><b>14.5.1</b> Example: Spatial autocorrelation in Oceanic tools</a></li>
<li class="chapter" data-level="14.5.2" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#example-phylogenetic-distance"><i class="fa fa-check"></i><b>14.5.2</b> Example: Phylogenetic distance</a></li>
</ul></li>
<li class="chapter" data-level="14.6" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#practice-11"><i class="fa fa-check"></i><b>14.6</b> Practice</a>
<ul>
<li class="chapter" data-level="14.6.1" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#m1-8"><i class="fa fa-check"></i><b>14.6.1</b> 14M1</a></li>
<li class="chapter" data-level="14.6.2" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#m2-8"><i class="fa fa-check"></i><b>14.6.2</b> 14M2</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="実行環境.html"><a href="実行環境.html"><i class="fa fa-check"></i>実行環境</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Statistical Rethinking Second Edition</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="monsters-and-mixtures" class="section level1 hasAnchor" number="12">
<h1><span class="header-section-number">12</span> Monsters and Mixtures<a href="monsters-and-mixtures.html#monsters-and-mixtures" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div id="over-dispersed-counts" class="section level2 hasAnchor" number="12.1">
<h2><span class="header-section-number">12.1</span> Over-dispersed counts<a href="monsters-and-mixtures.html#over-dispersed-counts" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>現実のデータは様々な過程がミックスされて生成されることがあるため、理想的な分布よりも幅が広くなることがある。二項分布やポワソン分布では平均と分散が1つのパラメータで表されるため、これがおきやすい。例えば、二項分布の期待値が<span class="math inline">\(Np\)</span>であれば、その分散は<span class="math inline">\(Np(1-p)\)</span>となり、ポワソン分布の平均と分散は同じ<span class="math inline">\(\lambda\)</span>である。
本節では、<em>continuous mixture</em>モデルと呼ばれるものを扱う。これでは、観察そのものではなく、観察の分布に対して線形モデルが適用される。実際上は、より柔軟なモデリングができる階層モデルを用いる方が過分散への対処は簡単である。</p>
<div id="beta-binomial." class="section level3 hasAnchor" number="12.1.1">
<h3><span class="header-section-number">12.1.1</span> Beta binomial.<a href="monsters-and-mixtures.html#beta-binomial." class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>ベータ二項分布は、二項分布の混合分布であり、それぞれのカウントに対する確率が推定される。また、それぞれのカウントが得られる確率も共通の<strong>ベータ分布</strong>から得られると仮定する。ここでは、UCバークレーの入試結果の例を再び用いて例を見ていく。<br />
ベータ分布は、平均確率<span class="math inline">\(\bar{p}\)</span>とshape parameterの<span class="math inline">\(\theta\)</span>の2つのパラメータで定義される。<span class="math inline">\(\theta\)</span>は分布の広さに関するパラメータで、<span class="math inline">\(\theta\)</span>が2のときに一様分布になる。<span class="math inline">\(\theta\)</span>が2以上になると分布は狭くなり、<span class="math inline">\(\theta\)</span>が2以下になると0と1に分布が集中していく。なお、通常ベータ分布は<span class="math inline">\(\alpha\)</span>と<span class="math inline">\(\beta\)</span>を用いて、
<br /></p>
<p><span class="math display">\[
Beta(y|\alpha, \beta) = \frac{y^{\alpha-1} (1-y)^{\beta-1}}{B(\alpha, \beta)}
\]</span>
<br/></p>
<p>で表される（テキストの<span class="math inline">\(\bar{p}\)</span>と<span class="math inline">\(\theta\)</span>は<span class="math inline">\(\alpha\)</span>と<span class="math inline">\(\beta\)</span>とは一致していない）。<span class="math inline">\(\bar{p} = \frac{\alpha}{\alpha + \beta}\)</span>、<span class="math inline">\(\theta = \alpha + \beta\)</span>であるので、<span class="math inline">\(\alpha = \bar{p} \theta\)</span>、<span class="math inline">\(\beta = \theta(1-\bar{p})\)</span> で表せる。</p>
<div class="sourceCode" id="cb1019"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1019-1"><a href="monsters-and-mixtures.html#cb1019-1" aria-hidden="true" tabindex="-1"></a><span class="do">## p,Θからα、βを得る関数。</span></span>
<span id="cb1019-2"><a href="monsters-and-mixtures.html#cb1019-2" aria-hidden="true" tabindex="-1"></a>transbeta <span class="ot">&lt;-</span> <span class="cf">function</span>(p, theta) {</span>
<span id="cb1019-3"><a href="monsters-and-mixtures.html#cb1019-3" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (p <span class="sc">&lt;=</span> <span class="dv">0</span> <span class="sc">|</span> p <span class="sc">&gt;=</span> <span class="dv">1</span>) <span class="fu">stop</span>(<span class="st">&quot;must have 0 &lt; p &lt; 1&quot;</span>)</span>
<span id="cb1019-4"><a href="monsters-and-mixtures.html#cb1019-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (theta <span class="sc">&lt;=</span> <span class="dv">0</span>) <span class="fu">stop</span>(<span class="st">&quot;theta must be &gt; 0&quot;</span>)</span>
<span id="cb1019-5"><a href="monsters-and-mixtures.html#cb1019-5" aria-hidden="true" tabindex="-1"></a>  a <span class="ot">&lt;-</span> p <span class="sc">*</span> theta</span>
<span id="cb1019-6"><a href="monsters-and-mixtures.html#cb1019-6" aria-hidden="true" tabindex="-1"></a>  b <span class="ot">&lt;-</span> (<span class="fl">1.0</span> <span class="sc">-</span> p) <span class="sc">*</span> theta</span>
<span id="cb1019-7"><a href="monsters-and-mixtures.html#cb1019-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">a =</span> a, <span class="at">b =</span> b))</span>
<span id="cb1019-8"><a href="monsters-and-mixtures.html#cb1019-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1019-9"><a href="monsters-and-mixtures.html#cb1019-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1019-10"><a href="monsters-and-mixtures.html#cb1019-10" aria-hidden="true" tabindex="-1"></a><span class="fu">transbeta</span>(<span class="fl">0.5</span>, <span class="fl">0.5</span>)</span></code></pre></div>
<pre><code>## $a
## [1] 0.25
## 
## $b
## [1] 0.25</code></pre>
<p>様々なベータ分布を書いてみる（図<a href="monsters-and-mixtures.html#fig:beta">12.1</a>）。</p>
<div class="sourceCode" id="cb1021"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1021-1"><a href="monsters-and-mixtures.html#cb1021-1" aria-hidden="true" tabindex="-1"></a><span class="fu">crossing</span>(<span class="at">p =</span> <span class="fu">c</span>(<span class="fl">0.25</span>, <span class="fl">0.5</span>, <span class="fl">0.75</span>),</span>
<span id="cb1021-2"><a href="monsters-and-mixtures.html#cb1021-2" aria-hidden="true" tabindex="-1"></a>         <span class="at">theta =</span> <span class="fu">c</span>(<span class="fl">0.5</span>,<span class="dv">2</span>,<span class="dv">5</span>,<span class="dv">15</span>,<span class="dv">30</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1021-3"><a href="monsters-and-mixtures.html#cb1021-3" aria-hidden="true" tabindex="-1"></a>   tidyr<span class="sc">::</span><span class="fu">expand</span>(<span class="fu">nesting</span>(p,theta), <span class="at">x =</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="at">length.out=</span><span class="dv">50</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1021-4"><a href="monsters-and-mixtures.html#cb1021-4" aria-hidden="true" tabindex="-1"></a>   <span class="fu">mutate</span>(<span class="at">density =</span> <span class="fu">dbeta2</span>(x, p, theta),</span>
<span id="cb1021-5"><a href="monsters-and-mixtures.html#cb1021-5" aria-hidden="true" tabindex="-1"></a>          <span class="at">mu =</span> <span class="fu">str_c</span>(<span class="st">&quot;mu == &quot;</span>, p <span class="sc">%&gt;%</span> <span class="fu">str_remove</span>(.,<span class="st">&quot;0&quot;</span>)),</span>
<span id="cb1021-6"><a href="monsters-and-mixtures.html#cb1021-6" aria-hidden="true" tabindex="-1"></a>          <span class="at">kappa =</span> <span class="fu">factor</span>(<span class="fu">str_c</span>(<span class="st">&quot;kappa == &quot;</span>, theta),</span>
<span id="cb1021-7"><a href="monsters-and-mixtures.html#cb1021-7" aria-hidden="true" tabindex="-1"></a>                         <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&quot;kappa == 30&quot;</span>, </span>
<span id="cb1021-8"><a href="monsters-and-mixtures.html#cb1021-8" aria-hidden="true" tabindex="-1"></a>                                    <span class="st">&quot;kappa == 15&quot;</span>, <span class="st">&quot;kappa == 5&quot;</span>, <span class="st">&quot;kappa == 2&quot;</span>, <span class="st">&quot;kappa == 0.5&quot;</span>)))<span class="sc">%&gt;%</span> </span>
<span id="cb1021-9"><a href="monsters-and-mixtures.html#cb1021-9" aria-hidden="true" tabindex="-1"></a>   <span class="fu">ggplot</span>(<span class="fu">aes</span>( <span class="at">x=</span>x, <span class="at">y =</span> density))<span class="sc">+</span></span>
<span id="cb1021-10"><a href="monsters-and-mixtures.html#cb1021-10" aria-hidden="true" tabindex="-1"></a>   <span class="fu">geom_area</span>(<span class="at">fill =</span> <span class="st">&quot;navy&quot;</span>)<span class="sc">+</span></span>
<span id="cb1021-11"><a href="monsters-and-mixtures.html#cb1021-11" aria-hidden="true" tabindex="-1"></a>   <span class="fu">scale_x_continuous</span>(<span class="st">&quot;probability space&quot;</span>, </span>
<span id="cb1021-12"><a href="monsters-and-mixtures.html#cb1021-12" aria-hidden="true" tabindex="-1"></a>                     <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>, .<span class="dv">5</span>, <span class="dv">1</span>), </span>
<span id="cb1021-13"><a href="monsters-and-mixtures.html#cb1021-13" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;0&quot;</span>, <span class="st">&quot;.5&quot;</span>, <span class="st">&quot;1&quot;</span>)) <span class="sc">+</span></span>
<span id="cb1021-14"><a href="monsters-and-mixtures.html#cb1021-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="cn">NULL</span>, <span class="at">labels =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb1021-15"><a href="monsters-and-mixtures.html#cb1021-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.ticks.y =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb1021-16"><a href="monsters-and-mixtures.html#cb1021-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(kappa <span class="sc">~</span> mu, <span class="at">labeller =</span> label_parsed)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:beta"></span>
<img src="Rethinking_Bookdown_files/figure-html/beta-1.png" alt="様々なパラメータのベータ分布" width="672" />
<p class="caption">
図12.1: 様々なパラメータのベータ分布
</p>
</div>
<p>それでは、モデリングを行う。モデル式は以下の通り。<span class="math inline">\(\theta\)</span>を2以上にするために工夫がしてある。<br />
<br /></p>
<p><span class="math display">\[
\begin{aligned}
  A_{i} &amp;\sim BetaBinomial(N_{i}, \bar{p_{i}}, \theta)\\
  logit(\bar{p_{i}})&amp; = \alpha_{GID_{[i]}}\\  
  \alpha_{j} &amp;\sim Normal(0,1.5)\\
  \theta &amp;= \phi +2\\
  \phi &amp;\sim Exponential(1)
\end{aligned}
\]</span>
<br /></p>
<div class="sourceCode" id="cb1022"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1022-1"><a href="monsters-and-mixtures.html#cb1022-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;UCBadmit&quot;</span>)</span>
<span id="cb1022-2"><a href="monsters-and-mixtures.html#cb1022-2" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> UCBadmit <span class="sc">%&gt;%</span> </span>
<span id="cb1022-3"><a href="monsters-and-mixtures.html#cb1022-3" aria-hidden="true" tabindex="-1"></a>   <span class="fu">mutate</span>(<span class="at">gid =</span> <span class="fu">ifelse</span>(applicant.gender <span class="sc">==</span> <span class="st">&quot;male&quot;</span>,<span class="st">&quot;1&quot;</span>,<span class="st">&quot;2&quot;</span>))</span></code></pre></div>
<p><code>brms</code>パッケージはβ二項分布を実装していないので、自作する必要がある。</p>
<div class="sourceCode" id="cb1023"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1023-1"><a href="monsters-and-mixtures.html#cb1023-1" aria-hidden="true" tabindex="-1"></a>beta_binomial2 <span class="ot">&lt;-</span> <span class="fu">custom_family</span>(</span>
<span id="cb1023-2"><a href="monsters-and-mixtures.html#cb1023-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;beta_binomial2&quot;</span>, <span class="at">dpars =</span> <span class="fu">c</span>(<span class="st">&quot;mu&quot;</span>, <span class="st">&quot;kappa&quot;</span>),</span>
<span id="cb1023-3"><a href="monsters-and-mixtures.html#cb1023-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">links =</span> <span class="fu">c</span>(<span class="st">&quot;logit&quot;</span>, <span class="st">&quot;log&quot;</span>), <span class="at">lb =</span> <span class="fu">c</span>(<span class="cn">NA</span>, <span class="dv">2</span>),</span>
<span id="cb1023-4"><a href="monsters-and-mixtures.html#cb1023-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">type =</span> <span class="st">&quot;int&quot;</span>, <span class="at">vars =</span> <span class="st">&quot;vint1[n]&quot;</span></span>
<span id="cb1023-5"><a href="monsters-and-mixtures.html#cb1023-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1023-6"><a href="monsters-and-mixtures.html#cb1023-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1023-7"><a href="monsters-and-mixtures.html#cb1023-7" aria-hidden="true" tabindex="-1"></a>stanvars <span class="ot">&lt;-</span> <span class="fu">stanvar</span>(<span class="at">scode =</span> <span class="st">&quot;</span></span>
<span id="cb1023-8"><a href="monsters-and-mixtures.html#cb1023-8" aria-hidden="true" tabindex="-1"></a><span class="st">  real beta_binomial2_lpmf(int y, real mu, real kappa, int T) {</span></span>
<span id="cb1023-9"><a href="monsters-and-mixtures.html#cb1023-9" aria-hidden="true" tabindex="-1"></a><span class="st">    return beta_binomial_lpmf(y | T, mu * kappa, (1 - mu) * kappa);</span></span>
<span id="cb1023-10"><a href="monsters-and-mixtures.html#cb1023-10" aria-hidden="true" tabindex="-1"></a><span class="st">  }</span></span>
<span id="cb1023-11"><a href="monsters-and-mixtures.html#cb1023-11" aria-hidden="true" tabindex="-1"></a><span class="st">  int beta_binomial2_rng(real mu, real kappa, int T) {</span></span>
<span id="cb1023-12"><a href="monsters-and-mixtures.html#cb1023-12" aria-hidden="true" tabindex="-1"></a><span class="st">    return beta_binomial_rng(T, mu * kappa, (1 - mu) * kappa);</span></span>
<span id="cb1023-13"><a href="monsters-and-mixtures.html#cb1023-13" aria-hidden="true" tabindex="-1"></a><span class="st">  }</span></span>
<span id="cb1023-14"><a href="monsters-and-mixtures.html#cb1023-14" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span>,</span>
<span id="cb1023-15"><a href="monsters-and-mixtures.html#cb1023-15" aria-hidden="true" tabindex="-1"></a><span class="at">block =</span> <span class="st">&quot;functions&quot;</span>)</span></code></pre></div>
<p>それでは、モデルにフィットさせる。</p>
<div class="sourceCode" id="cb1024"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1024-1"><a href="monsters-and-mixtures.html#cb1024-1" aria-hidden="true" tabindex="-1"></a>b12<span class="fl">.1</span> <span class="ot">&lt;-</span></span>
<span id="cb1024-2"><a href="monsters-and-mixtures.html#cb1024-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">brm</span>(<span class="at">data =</span> d, </span>
<span id="cb1024-3"><a href="monsters-and-mixtures.html#cb1024-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> beta_binomial2,  <span class="co"># here&#39;s our custom likelihood</span></span>
<span id="cb1024-4"><a href="monsters-and-mixtures.html#cb1024-4" aria-hidden="true" tabindex="-1"></a>      admit <span class="sc">|</span> <span class="fu">vint</span>(applications) <span class="sc">~</span> <span class="dv">0</span> <span class="sc">+</span> gid,</span>
<span id="cb1024-5"><a href="monsters-and-mixtures.html#cb1024-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">1.5</span>), <span class="at">class =</span> b),</span>
<span id="cb1024-6"><a href="monsters-and-mixtures.html#cb1024-6" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>), <span class="at">class =</span> kappa)),</span>
<span id="cb1024-7"><a href="monsters-and-mixtures.html#cb1024-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>, <span class="at">cores =</span> <span class="dv">4</span>, <span class="at">chains =</span> <span class="dv">4</span>,</span>
<span id="cb1024-8"><a href="monsters-and-mixtures.html#cb1024-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">stanvars =</span> stanvars,  <span class="co"># note our `stanvars`</span></span>
<span id="cb1024-9"><a href="monsters-and-mixtures.html#cb1024-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">seed =</span> <span class="dv">12</span>,</span>
<span id="cb1024-10"><a href="monsters-and-mixtures.html#cb1024-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">file =</span> <span class="st">&quot;output/Chapter12/b12.1&quot;</span>)</span></code></pre></div>
<p>結果は以下の通り（表<span class="math inline">\(\ref{res-b12-1}\)</span>）。</p>
<div class="sourceCode" id="cb1025"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1025-1"><a href="monsters-and-mixtures.html#cb1025-1" aria-hidden="true" tabindex="-1"></a><span class="fu">posterior_samples</span>(b12<span class="fl">.1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1025-2"><a href="monsters-and-mixtures.html#cb1025-2" aria-hidden="true" tabindex="-1"></a>   <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1025-3"><a href="monsters-and-mixtures.html#cb1025-3" aria-hidden="true" tabindex="-1"></a>   <span class="fu">mutate</span>(<span class="at">diff =</span> b_gid1 <span class="sc">-</span> b_gid2) <span class="sc">%&gt;%</span> </span>
<span id="cb1025-4"><a href="monsters-and-mixtures.html#cb1025-4" aria-hidden="true" tabindex="-1"></a>   <span class="fu">pivot_longer</span>(<span class="sc">-</span>lp__) <span class="sc">%&gt;%</span> </span>
<span id="cb1025-5"><a href="monsters-and-mixtures.html#cb1025-5" aria-hidden="true" tabindex="-1"></a>   <span class="fu">group_by</span>(name) <span class="sc">%&gt;%</span> </span>
<span id="cb1025-6"><a href="monsters-and-mixtures.html#cb1025-6" aria-hidden="true" tabindex="-1"></a>   <span class="fu">mean_qi</span>(value, <span class="at">.width=</span><span class="fl">0.89</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1025-7"><a href="monsters-and-mixtures.html#cb1025-7" aria-hidden="true" tabindex="-1"></a>   <span class="fu">kable</span>(<span class="at">booktabs =</span>T,</span>
<span id="cb1025-8"><a href="monsters-and-mixtures.html#cb1025-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">digits=</span><span class="dv">2</span>,</span>
<span id="cb1025-9"><a href="monsters-and-mixtures.html#cb1025-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">caption =</span> <span class="st">&quot;b12.1の結果果&quot;</span>,</span>
<span id="cb1025-10"><a href="monsters-and-mixtures.html#cb1025-10" aria-hidden="true" tabindex="-1"></a>         <span class="at">align =</span> <span class="st">&quot;lcccccc&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1025-11"><a href="monsters-and-mixtures.html#cb1025-11" aria-hidden="true" tabindex="-1"></a>   <span class="fu">kable_styling</span>(<span class="at">latex_options =</span> <span class="fu">c</span>(<span class="st">&quot;striped&quot;</span>, <span class="st">&quot;hold_position&quot;</span>))</span></code></pre></div>
<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:res-b12-1">表12.1: </span>b12.1の結果果
</caption>
<thead>
<tr>
<th style="text-align:left;">
name
</th>
<th style="text-align:center;">
value
</th>
<th style="text-align:center;">
.lower
</th>
<th style="text-align:center;">
.upper
</th>
<th style="text-align:center;">
.width
</th>
<th style="text-align:center;">
.point
</th>
<th style="text-align:center;">
.interval
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
b_gid1
</td>
<td style="text-align:center;">
-0.43
</td>
<td style="text-align:center;">
-1.13
</td>
<td style="text-align:center;">
0.22
</td>
<td style="text-align:center;">
0.89
</td>
<td style="text-align:center;">
mean
</td>
<td style="text-align:center;">
qi
</td>
</tr>
<tr>
<td style="text-align:left;">
b_gid2
</td>
<td style="text-align:center;">
-0.33
</td>
<td style="text-align:center;">
-0.96
</td>
<td style="text-align:center;">
0.31
</td>
<td style="text-align:center;">
0.89
</td>
<td style="text-align:center;">
mean
</td>
<td style="text-align:center;">
qi
</td>
</tr>
<tr>
<td style="text-align:left;">
diff
</td>
<td style="text-align:center;">
-0.11
</td>
<td style="text-align:center;">
-1.06
</td>
<td style="text-align:center;">
0.82
</td>
<td style="text-align:center;">
0.89
</td>
<td style="text-align:center;">
mean
</td>
<td style="text-align:center;">
qi
</td>
</tr>
<tr>
<td style="text-align:left;">
kappa
</td>
<td style="text-align:center;">
3.04
</td>
<td style="text-align:center;">
2.10
</td>
<td style="text-align:center;">
4.51
</td>
<td style="text-align:center;">
0.89
</td>
<td style="text-align:center;">
mean
</td>
<td style="text-align:center;">
qi
</td>
</tr>
<tr>
<td style="text-align:left;">
lprior
</td>
<td style="text-align:center;">
-3.83
</td>
<td style="text-align:center;">
-5.30
</td>
<td style="text-align:center;">
-2.85
</td>
<td style="text-align:center;">
0.89
</td>
<td style="text-align:center;">
mean
</td>
<td style="text-align:center;">
qi
</td>
</tr>
</tbody>
</table>
<p>事後分布を可視化する（図<a href="monsters-and-mixtures.html#fig:b12-1">12.2</a>）。</p>
<div class="sourceCode" id="cb1026"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1026-1"><a href="monsters-and-mixtures.html#cb1026-1" aria-hidden="true" tabindex="-1"></a>post <span class="ot">&lt;-</span> <span class="fu">posterior_samples</span>(b12<span class="fl">.1</span>) </span>
<span id="cb1026-2"><a href="monsters-and-mixtures.html#cb1026-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1026-3"><a href="monsters-and-mixtures.html#cb1026-3" aria-hidden="true" tabindex="-1"></a><span class="do">## 確率の事後分布</span></span>
<span id="cb1026-4"><a href="monsters-and-mixtures.html#cb1026-4" aria-hidden="true" tabindex="-1"></a>post <span class="sc">%&gt;%</span> </span>
<span id="cb1026-5"><a href="monsters-and-mixtures.html#cb1026-5" aria-hidden="true" tabindex="-1"></a>   <span class="fu">mutate</span>(<span class="at">iter=</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">n</span>(),</span>
<span id="cb1026-6"><a href="monsters-and-mixtures.html#cb1026-6" aria-hidden="true" tabindex="-1"></a>          <span class="at">p_bar =</span> <span class="fu">inv_logit_scaled</span>(b_gid2)) <span class="sc">%&gt;%</span> </span>
<span id="cb1026-7"><a href="monsters-and-mixtures.html#cb1026-7" aria-hidden="true" tabindex="-1"></a>   <span class="fu">slice_sample</span>(<span class="at">n=</span><span class="dv">100</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1026-8"><a href="monsters-and-mixtures.html#cb1026-8" aria-hidden="true" tabindex="-1"></a>   tidyr<span class="sc">::</span><span class="fu">expand</span>(<span class="fu">nesting</span>(iter, p_bar, kappa),</span>
<span id="cb1026-9"><a href="monsters-and-mixtures.html#cb1026-9" aria-hidden="true" tabindex="-1"></a>          <span class="at">x =</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="at">by=</span>.<span class="dv">005</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1026-10"><a href="monsters-and-mixtures.html#cb1026-10" aria-hidden="true" tabindex="-1"></a>   <span class="fu">mutate</span>(<span class="at">density =</span> <span class="fu">dbeta2</span>(x, p_bar, kappa)) <span class="sc">%&gt;%</span> </span>
<span id="cb1026-11"><a href="monsters-and-mixtures.html#cb1026-11" aria-hidden="true" tabindex="-1"></a>   <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>x, <span class="at">y=</span>density))<span class="sc">+</span></span>
<span id="cb1026-12"><a href="monsters-and-mixtures.html#cb1026-12" aria-hidden="true" tabindex="-1"></a>   <span class="fu">stat_function</span>(<span class="at">fun =</span> dbeta2,</span>
<span id="cb1026-13"><a href="monsters-and-mixtures.html#cb1026-13" aria-hidden="true" tabindex="-1"></a>                 <span class="at">args =</span> <span class="fu">list</span>(<span class="at">prob =</span> <span class="fu">mean</span>(<span class="fu">inv_logit_scaled</span>(post[, <span class="st">&quot;b_gid2&quot;</span>])),</span>
<span id="cb1026-14"><a href="monsters-and-mixtures.html#cb1026-14" aria-hidden="true" tabindex="-1"></a>                            <span class="at">theta =</span> <span class="fu">mean</span>(post[, <span class="st">&quot;kappa&quot;</span>])),</span>
<span id="cb1026-15"><a href="monsters-and-mixtures.html#cb1026-15" aria-hidden="true" tabindex="-1"></a>                <span class="at">size =</span> <span class="fl">1.5</span>, <span class="at">color =</span> <span class="st">&quot;navy&quot;</span>)<span class="sc">+</span></span>
<span id="cb1026-16"><a href="monsters-and-mixtures.html#cb1026-16" aria-hidden="true" tabindex="-1"></a>   <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">group=</span>iter),</span>
<span id="cb1026-17"><a href="monsters-and-mixtures.html#cb1026-17" aria-hidden="true" tabindex="-1"></a>             <span class="at">alpha =</span> .<span class="dv">2</span>, <span class="at">color =</span> <span class="st">&quot;navy&quot;</span>)<span class="sc">+</span></span>
<span id="cb1026-18"><a href="monsters-and-mixtures.html#cb1026-18" aria-hidden="true" tabindex="-1"></a>   <span class="fu">scale_y_continuous</span>(<span class="cn">NULL</span>, <span class="at">breaks =</span> <span class="cn">NULL</span>, <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">3</span>)) <span class="sc">+</span></span>
<span id="cb1026-19"><a href="monsters-and-mixtures.html#cb1026-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">&quot;distribution of female admission rates&quot;</span>,</span>
<span id="cb1026-20"><a href="monsters-and-mixtures.html#cb1026-20" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">&quot;probability admit&quot;</span>)<span class="sc">+</span></span>
<span id="cb1026-21"><a href="monsters-and-mixtures.html#cb1026-21" aria-hidden="true" tabindex="-1"></a>   <span class="fu">theme</span>(<span class="at">aspect.ratio=</span><span class="dv">1</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:b12-1"></span>
<img src="Rethinking_Bookdown_files/figure-html/b12-1-1.png" alt="女性の合格率の事後分布" width="672" />
<p class="caption">
図12.2: 女性の合格率の事後分布
</p>
</div>
<div class="sourceCode" id="cb1027"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1027-1"><a href="monsters-and-mixtures.html#cb1027-1" aria-hidden="true" tabindex="-1"></a><span class="fu">expose_functions</span>(b12<span class="fl">.1</span>, <span class="at">vectorize =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1027-2"><a href="monsters-and-mixtures.html#cb1027-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1027-3"><a href="monsters-and-mixtures.html#cb1027-3" aria-hidden="true" tabindex="-1"></a><span class="co"># required to use `predict()`</span></span>
<span id="cb1027-4"><a href="monsters-and-mixtures.html#cb1027-4" aria-hidden="true" tabindex="-1"></a>log_lik_beta_binomial2 <span class="ot">&lt;-</span> <span class="cf">function</span>(i, prep) {</span>
<span id="cb1027-5"><a href="monsters-and-mixtures.html#cb1027-5" aria-hidden="true" tabindex="-1"></a>  mu     <span class="ot">&lt;-</span> prep<span class="sc">$</span>dpars<span class="sc">$</span>mu[, i]</span>
<span id="cb1027-6"><a href="monsters-and-mixtures.html#cb1027-6" aria-hidden="true" tabindex="-1"></a>  kappa    <span class="ot">&lt;-</span> prep<span class="sc">$</span>dpars<span class="sc">$</span>kappa</span>
<span id="cb1027-7"><a href="monsters-and-mixtures.html#cb1027-7" aria-hidden="true" tabindex="-1"></a>  trials <span class="ot">&lt;-</span> prep<span class="sc">$</span>data<span class="sc">$</span>vint1[i]</span>
<span id="cb1027-8"><a href="monsters-and-mixtures.html#cb1027-8" aria-hidden="true" tabindex="-1"></a>  y      <span class="ot">&lt;-</span> prep<span class="sc">$</span>data<span class="sc">$</span>Y[i]</span>
<span id="cb1027-9"><a href="monsters-and-mixtures.html#cb1027-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">beta_binomial2_lpmf</span>(y, mu, kappa, trials)</span>
<span id="cb1027-10"><a href="monsters-and-mixtures.html#cb1027-10" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1027-11"><a href="monsters-and-mixtures.html#cb1027-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1027-12"><a href="monsters-and-mixtures.html#cb1027-12" aria-hidden="true" tabindex="-1"></a>posterior_predict_beta_binomial2 <span class="ot">&lt;-</span> <span class="cf">function</span>(i, prep, ...) {</span>
<span id="cb1027-13"><a href="monsters-and-mixtures.html#cb1027-13" aria-hidden="true" tabindex="-1"></a>  mu     <span class="ot">&lt;-</span> prep<span class="sc">$</span>dpars<span class="sc">$</span>mu[, i]</span>
<span id="cb1027-14"><a href="monsters-and-mixtures.html#cb1027-14" aria-hidden="true" tabindex="-1"></a>  kappa    <span class="ot">&lt;-</span> prep<span class="sc">$</span>dpars<span class="sc">$</span>kappa</span>
<span id="cb1027-15"><a href="monsters-and-mixtures.html#cb1027-15" aria-hidden="true" tabindex="-1"></a>  trials <span class="ot">&lt;-</span> prep<span class="sc">$</span>data<span class="sc">$</span>vint1[i]</span>
<span id="cb1027-16"><a href="monsters-and-mixtures.html#cb1027-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">beta_binomial2_rng</span>(mu, kappa, trials)</span>
<span id="cb1027-17"><a href="monsters-and-mixtures.html#cb1027-17" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1027-18"><a href="monsters-and-mixtures.html#cb1027-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1027-19"><a href="monsters-and-mixtures.html#cb1027-19" aria-hidden="true" tabindex="-1"></a><span class="co"># required to use `fitted()`</span></span>
<span id="cb1027-20"><a href="monsters-and-mixtures.html#cb1027-20" aria-hidden="true" tabindex="-1"></a>posterior_epred_beta_binomial2 <span class="ot">&lt;-</span> <span class="cf">function</span>(prep) {</span>
<span id="cb1027-21"><a href="monsters-and-mixtures.html#cb1027-21" aria-hidden="true" tabindex="-1"></a>  mu     <span class="ot">&lt;-</span> prep<span class="sc">$</span>dpars<span class="sc">$</span>mu</span>
<span id="cb1027-22"><a href="monsters-and-mixtures.html#cb1027-22" aria-hidden="true" tabindex="-1"></a>  trials <span class="ot">&lt;-</span> prep<span class="sc">$</span>data<span class="sc">$</span>vint1</span>
<span id="cb1027-23"><a href="monsters-and-mixtures.html#cb1027-23" aria-hidden="true" tabindex="-1"></a>  trials <span class="ot">&lt;-</span> <span class="fu">matrix</span>(trials, <span class="at">nrow =</span> <span class="fu">nrow</span>(mu), <span class="at">ncol =</span> <span class="fu">ncol</span>(mu), <span class="at">byrow =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1027-24"><a href="monsters-and-mixtures.html#cb1027-24" aria-hidden="true" tabindex="-1"></a>  mu <span class="sc">*</span> trials</span>
<span id="cb1027-25"><a href="monsters-and-mixtures.html#cb1027-25" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>推定された結果を図示すると以下の通り(図<a href="monsters-and-mixtures.html#fig:b12-1-2">12.3</a>)。予測分布の範囲にうまくデータが納まっているが、広すぎて結果の解釈が難しい。</p>
<div class="sourceCode" id="cb1028"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1028-1"><a href="monsters-and-mixtures.html#cb1028-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fitted</span>(b12<span class="fl">.1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1028-2"><a href="monsters-and-mixtures.html#cb1028-2" aria-hidden="true" tabindex="-1"></a>   <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1028-3"><a href="monsters-and-mixtures.html#cb1028-3" aria-hidden="true" tabindex="-1"></a>   <span class="fu">bind_cols</span>(d) <span class="sc">%&gt;%</span> </span>
<span id="cb1028-4"><a href="monsters-and-mixtures.html#cb1028-4" aria-hidden="true" tabindex="-1"></a>   <span class="fu">mutate</span>(<span class="at">case=</span><span class="dv">1</span><span class="sc">:</span><span class="fu">n</span>()) <span class="ot">-&gt;</span> fitb12<span class="fl">.1</span></span>
<span id="cb1028-5"><a href="monsters-and-mixtures.html#cb1028-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1028-6"><a href="monsters-and-mixtures.html#cb1028-6" aria-hidden="true" tabindex="-1"></a><span class="co">#上手く回らず</span></span>
<span id="cb1028-7"><a href="monsters-and-mixtures.html#cb1028-7" aria-hidden="true" tabindex="-1"></a><span class="fu">predict</span>(b12<span class="fl">.1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1028-8"><a href="monsters-and-mixtures.html#cb1028-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1028-9"><a href="monsters-and-mixtures.html#cb1028-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(d) <span class="sc">%&gt;%</span> </span>
<span id="cb1028-10"><a href="monsters-and-mixtures.html#cb1028-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">case=</span><span class="dv">1</span><span class="sc">:</span><span class="fu">n</span>()) <span class="ot">-&gt;</span> pre12<span class="fl">.1</span></span>
<span id="cb1028-11"><a href="monsters-and-mixtures.html#cb1028-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1028-12"><a href="monsters-and-mixtures.html#cb1028-12" aria-hidden="true" tabindex="-1"></a>d <span class="sc">%&gt;%</span> </span>
<span id="cb1028-13"><a href="monsters-and-mixtures.html#cb1028-13" aria-hidden="true" tabindex="-1"></a>   <span class="fu">mutate</span>(<span class="at">case =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">n</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb1028-14"><a href="monsters-and-mixtures.html#cb1028-14" aria-hidden="true" tabindex="-1"></a>   <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> case))<span class="sc">+</span></span>
<span id="cb1028-15"><a href="monsters-and-mixtures.html#cb1028-15" aria-hidden="true" tabindex="-1"></a>   <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> admit<span class="sc">/</span>applications),</span>
<span id="cb1028-16"><a href="monsters-and-mixtures.html#cb1028-16" aria-hidden="true" tabindex="-1"></a>              <span class="at">color =</span> <span class="st">&quot;navy&quot;</span>, <span class="at">size=</span><span class="dv">2</span>)<span class="sc">+</span></span>
<span id="cb1028-17"><a href="monsters-and-mixtures.html#cb1028-17" aria-hidden="true" tabindex="-1"></a>   <span class="fu">geom_pointinterval</span>(<span class="at">data =</span> fitb12<span class="fl">.1</span>,</span>
<span id="cb1028-18"><a href="monsters-and-mixtures.html#cb1028-18" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">aes</span>(<span class="at">y=</span>Estimate<span class="sc">/</span>applications,</span>
<span id="cb1028-19"><a href="monsters-and-mixtures.html#cb1028-19" aria-hidden="true" tabindex="-1"></a>                          <span class="at">ymin =</span> Q2<span class="fl">.5</span><span class="sc">/</span>applications,</span>
<span id="cb1028-20"><a href="monsters-and-mixtures.html#cb1028-20" aria-hidden="true" tabindex="-1"></a>                          <span class="at">ymax =</span> Q97<span class="fl">.5</span><span class="sc">/</span>applications),</span>
<span id="cb1028-21"><a href="monsters-and-mixtures.html#cb1028-21" aria-hidden="true" tabindex="-1"></a>                      <span class="at">point_size =</span> <span class="dv">3</span>, <span class="at">shape=</span><span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb1028-22"><a href="monsters-and-mixtures.html#cb1028-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> pre12<span class="fl">.1</span>,</span>
<span id="cb1028-23"><a href="monsters-and-mixtures.html#cb1028-23" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">aes</span>(<span class="at">y =</span> Q2<span class="fl">.5</span><span class="sc">/</span>applications),</span>
<span id="cb1028-24"><a href="monsters-and-mixtures.html#cb1028-24" aria-hidden="true" tabindex="-1"></a>                      <span class="at">size=</span><span class="dv">3</span>, <span class="at">shape=</span><span class="dv">3</span>)<span class="sc">+</span></span>
<span id="cb1028-25"><a href="monsters-and-mixtures.html#cb1028-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> pre12<span class="fl">.1</span>,</span>
<span id="cb1028-26"><a href="monsters-and-mixtures.html#cb1028-26" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">aes</span>(<span class="at">y =</span> Q97<span class="fl">.5</span><span class="sc">/</span>applications),</span>
<span id="cb1028-27"><a href="monsters-and-mixtures.html#cb1028-27" aria-hidden="true" tabindex="-1"></a>                      <span class="at">size=</span><span class="dv">3</span>, <span class="at">shape=</span><span class="dv">3</span>)<span class="sc">+</span></span>
<span id="cb1028-28"><a href="monsters-and-mixtures.html#cb1028-28" aria-hidden="true" tabindex="-1"></a>   <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">12</span>)<span class="sc">+</span></span>
<span id="cb1028-29"><a href="monsters-and-mixtures.html#cb1028-29" aria-hidden="true" tabindex="-1"></a>   <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="fl">0.2</span>), <span class="at">limits=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>))<span class="sc">+</span></span>
<span id="cb1028-30"><a href="monsters-and-mixtures.html#cb1028-30" aria-hidden="true" tabindex="-1"></a>   <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">&quot;A&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:b12-1-2"></span>
<img src="Rethinking_Bookdown_files/figure-html/b12-1-2-1.png" alt="b12.1の事後予測分布。白抜き点とエラーバーは95%信用区間を表す。十字の点は95%予測区間の上限と下限を表す。" width="672" />
<p class="caption">
図12.3: b12.1の事後予測分布。白抜き点とエラーバーは95%信用区間を表す。十字の点は95%予測区間の上限と下限を表す。
</p>
</div>
</div>
<div id="negative-binomial-or-gamma-poisson." class="section level3 hasAnchor" number="12.1.2">
<h3><span class="header-section-number">12.1.2</span> Negative binomial or gamma-Poisson.<a href="monsters-and-mixtures.html#negative-binomial-or-gamma-poisson." class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>続いて、ポワソン分布で過分散が起きた際に用いる負の二項分布(もしくはガンマ-ポワソン分布)について学ぶ。負の二項分布はそれぞれの観察に対して平均が与えられ、それらは共通のガンマ分布からもたらされるものとする。
ガンマ分布は、<code>shape</code>(<span class="math inline">\(\alpha\)</span>)と<code>rate</code>(<span class="math inline">\(\beta\)</span>)の2つのパラメータで表される。
<br /></p>
<p><span class="math display">\[
Gamma(y| \alpha, \beta) = \frac{\beta^\alpha y^{\alpha-1}e^{-\beta y}}{\Gamma(\alpha)}
\]</span>
<br /></p>
<p>それでは、実際にモデリングしてみよう。下式で、<span class="math inline">\(\lambda\)</span>は<code>rate</code>を、<span class="math inline">\(\phi\)</span>は<code>shape</code>を表す。
<br /></p>
<p><span class="math display">\[
y_{i} \sim Gamma-Poisson(\lambda_{i}, \phi)
\]</span>
<br /></p>
<p>オセアニアの道具数に関するモデリングを再び考える<span class="citation">(<a href="#ref-Kline2010" role="doc-biblioref">Kline and Boyd 2010</a>)</span>。</p>
<div class="sourceCode" id="cb1029"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1029-1"><a href="monsters-and-mixtures.html#cb1029-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(Kline)</span>
<span id="cb1029-2"><a href="monsters-and-mixtures.html#cb1029-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1029-3"><a href="monsters-and-mixtures.html#cb1029-3" aria-hidden="true" tabindex="-1"></a>d2 <span class="ot">&lt;-</span></span>
<span id="cb1029-4"><a href="monsters-and-mixtures.html#cb1029-4" aria-hidden="true" tabindex="-1"></a>  Kline <span class="sc">%&gt;%</span> </span>
<span id="cb1029-5"><a href="monsters-and-mixtures.html#cb1029-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">P =</span> <span class="fu">standardize</span>(<span class="fu">log</span>(population)),</span>
<span id="cb1029-6"><a href="monsters-and-mixtures.html#cb1029-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">contact_id =</span> <span class="fu">ifelse</span>(contact <span class="sc">==</span> <span class="st">&quot;high&quot;</span>, 2L, 1L),</span>
<span id="cb1029-7"><a href="monsters-and-mixtures.html#cb1029-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">cid        =</span> contact) <span class="ot">-&gt;</span> d2</span></code></pre></div>
<p>モデル式は以下の通り。<br />
<br /></p>
<p><span class="math display">\[
\begin{aligned}
  total_tools_{i} &amp;\sim GammaPoisson(\mu_{i}, \alpha)\\
  \mu_{i} &amp;\sim exp(\beta_{0,cid_{[i]}}) P_{i}^{\beta_{1,cid_{[i]}}}/\gamma\\
  \beta_{0,j} &amp;\sim Normal(1,1)\\
  \beta_{1,j} &amp;\sim Exponential(1)\\
  \gamma &amp;\sim Exponential(1)\\
  \alpha &amp;\sim Exponential(1)
\end{aligned}
\]</span>
<br /></p>
<div class="sourceCode" id="cb1030"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1030-1"><a href="monsters-and-mixtures.html#cb1030-1" aria-hidden="true" tabindex="-1"></a>b12<span class="fl">.2</span> <span class="ot">&lt;-</span> </span>
<span id="cb1030-2"><a href="monsters-and-mixtures.html#cb1030-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">brm</span>(<span class="at">data =</span> d2,</span>
<span id="cb1030-3"><a href="monsters-and-mixtures.html#cb1030-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> <span class="fu">negbinomial</span>(<span class="at">link =</span> <span class="st">&quot;identity&quot;</span>),</span>
<span id="cb1030-4"><a href="monsters-and-mixtures.html#cb1030-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">bf</span>(total_tools <span class="sc">~</span> <span class="fu">exp</span>(b0)<span class="sc">*</span>population<span class="sc">^</span>b1<span class="sc">/</span>g,</span>
<span id="cb1030-5"><a href="monsters-and-mixtures.html#cb1030-5" aria-hidden="true" tabindex="-1"></a>         b0 <span class="sc">+</span> b1 <span class="sc">~</span> <span class="dv">0</span> <span class="sc">+</span> cid,</span>
<span id="cb1030-6"><a href="monsters-and-mixtures.html#cb1030-6" aria-hidden="true" tabindex="-1"></a>         g <span class="sc">~</span><span class="dv">1</span>,</span>
<span id="cb1030-7"><a href="monsters-and-mixtures.html#cb1030-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">nl =</span> <span class="cn">TRUE</span>),</span>
<span id="cb1030-8"><a href="monsters-and-mixtures.html#cb1030-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">1</span>, <span class="dv">1</span>), <span class="at">nlpar =</span> b0),</span>
<span id="cb1030-9"><a href="monsters-and-mixtures.html#cb1030-9" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>), <span class="at">nlpar =</span> b1, <span class="at">lb =</span> <span class="dv">0</span>),</span>
<span id="cb1030-10"><a href="monsters-and-mixtures.html#cb1030-10" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>), <span class="at">nlpar =</span> g, <span class="at">lb =</span> <span class="dv">0</span>),</span>
<span id="cb1030-11"><a href="monsters-and-mixtures.html#cb1030-11" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>), <span class="at">class =</span> shape)),</span>
<span id="cb1030-12"><a href="monsters-and-mixtures.html#cb1030-12" aria-hidden="true" tabindex="-1"></a>      <span class="at">seed =</span> <span class="dv">12</span>, <span class="at">control =</span> <span class="fu">list</span>(<span class="at">adapt_delta =</span> .<span class="dv">95</span>),</span>
<span id="cb1030-13"><a href="monsters-and-mixtures.html#cb1030-13" aria-hidden="true" tabindex="-1"></a>      <span class="at">chains =</span><span class="dv">4</span>, <span class="at">cores =</span><span class="dv">4</span>,</span>
<span id="cb1030-14"><a href="monsters-and-mixtures.html#cb1030-14" aria-hidden="true" tabindex="-1"></a>       <span class="at">backend =</span> <span class="st">&quot;cmdstanr&quot;</span>,</span>
<span id="cb1030-15"><a href="monsters-and-mixtures.html#cb1030-15" aria-hidden="true" tabindex="-1"></a>      <span class="at">file =</span> <span class="st">&quot;output/Chapter12/b12.2&quot;</span>)</span></code></pre></div>
<p>分析の結果は以下の通り（表<a href="monsters-and-mixtures.html#tab:res-b12-2">12.2</a>）。</p>
<div class="sourceCode" id="cb1031"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1031-1"><a href="monsters-and-mixtures.html#cb1031-1" aria-hidden="true" tabindex="-1"></a><span class="fu">posterior_summary</span>(b12<span class="fl">.2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1031-2"><a href="monsters-and-mixtures.html#cb1031-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1031-3"><a href="monsters-and-mixtures.html#cb1031-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>(<span class="at">var =</span> <span class="st">&quot;parameter&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1031-4"><a href="monsters-and-mixtures.html#cb1031-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(parameter <span class="sc">!=</span> <span class="st">&quot;lp__&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1031-5"><a href="monsters-and-mixtures.html#cb1031-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="at">digits =</span><span class="dv">2</span>,</span>
<span id="cb1031-6"><a href="monsters-and-mixtures.html#cb1031-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">booktabs =</span> <span class="cn">TRUE</span>,</span>
<span id="cb1031-7"><a href="monsters-and-mixtures.html#cb1031-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">caption =</span> <span class="st">&quot;b12.2の結果&quot;</span>,</span>
<span id="cb1031-8"><a href="monsters-and-mixtures.html#cb1031-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">align =</span> <span class="st">&quot;lcccc&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1031-9"><a href="monsters-and-mixtures.html#cb1031-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">latex_options =</span> <span class="fu">c</span>(<span class="st">&quot;striped&quot;</span>, <span class="st">&quot;hold_position&quot;</span>))</span></code></pre></div>
<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:res-b12-2">表12.2: </span>b12.2の結果
</caption>
<thead>
<tr>
<th style="text-align:left;">
parameter
</th>
<th style="text-align:center;">
Estimate
</th>
<th style="text-align:center;">
Est.Error
</th>
<th style="text-align:center;">
Q2.5
</th>
<th style="text-align:center;">
Q97.5
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
b_b0_cidhigh
</td>
<td style="text-align:center;">
1.05
</td>
<td style="text-align:center;">
0.92
</td>
<td style="text-align:center;">
-0.77
</td>
<td style="text-align:center;">
2.80
</td>
</tr>
<tr>
<td style="text-align:left;">
b_b0_cidlow
</td>
<td style="text-align:center;">
0.92
</td>
<td style="text-align:center;">
0.80
</td>
<td style="text-align:center;">
-0.68
</td>
<td style="text-align:center;">
2.51
</td>
</tr>
<tr>
<td style="text-align:left;">
b_b1_cidhigh
</td>
<td style="text-align:center;">
0.26
</td>
<td style="text-align:center;">
0.13
</td>
<td style="text-align:center;">
0.03
</td>
<td style="text-align:center;">
0.52
</td>
</tr>
<tr>
<td style="text-align:left;">
b_b1_cidlow
</td>
<td style="text-align:center;">
0.24
</td>
<td style="text-align:center;">
0.10
</td>
<td style="text-align:center;">
0.07
</td>
<td style="text-align:center;">
0.43
</td>
</tr>
<tr>
<td style="text-align:left;">
b_g_Intercept
</td>
<td style="text-align:center;">
1.01
</td>
<td style="text-align:center;">
0.80
</td>
<td style="text-align:center;">
0.15
</td>
<td style="text-align:center;">
3.01
</td>
</tr>
<tr>
<td style="text-align:left;">
shape
</td>
<td style="text-align:center;">
3.61
</td>
<td style="text-align:center;">
1.59
</td>
<td style="text-align:center;">
1.23
</td>
<td style="text-align:center;">
7.33
</td>
</tr>
<tr>
<td style="text-align:left;">
lprior
</td>
<td style="text-align:center;">
-7.72
</td>
<td style="text-align:center;">
2.00
</td>
<td style="text-align:center;">
-12.26
</td>
<td style="text-align:center;">
-4.48
</td>
</tr>
</tbody>
</table>
<p>PSISを計算すると、ポワソン分布を使った場合に比べると、pareto-kが改善している。</p>
<div class="sourceCode" id="cb1032"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1032-1"><a href="monsters-and-mixtures.html#cb1032-1" aria-hidden="true" tabindex="-1"></a>b11<span class="fl">.11</span> <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;output/Chapter11/b11.11.rds&quot;</span>)</span>
<span id="cb1032-2"><a href="monsters-and-mixtures.html#cb1032-2" aria-hidden="true" tabindex="-1"></a>b12<span class="fl">.2</span> <span class="ot">&lt;-</span> <span class="fu">add_criterion</span>(b12<span class="fl">.2</span>, <span class="st">&quot;loo&quot;</span>)</span>
<span id="cb1032-3"><a href="monsters-and-mixtures.html#cb1032-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1032-4"><a href="monsters-and-mixtures.html#cb1032-4" aria-hidden="true" tabindex="-1"></a><span class="co">#ポワソン</span></span>
<span id="cb1032-5"><a href="monsters-and-mixtures.html#cb1032-5" aria-hidden="true" tabindex="-1"></a><span class="fu">loo</span>(b11<span class="fl">.11</span>)</span></code></pre></div>
<pre><code>## 
## Computed from 4000 by 10 log-likelihood matrix
## 
##          Estimate   SE
## elpd_loo    -40.7  6.0
## p_loo         5.3  1.9
## looic        81.3 11.9
## ------
## Monte Carlo SE of elpd_loo is 0.1.
## 
## Pareto k diagnostic values:
##                          Count Pct.    Min. n_eff
## (-Inf, 0.5]   (good)     7     70.0%   288       
##  (0.5, 0.7]   (ok)       3     30.0%   151       
##    (0.7, 1]   (bad)      0      0.0%   &lt;NA&gt;      
##    (1, Inf)   (very bad) 0      0.0%   &lt;NA&gt;      
## 
## All Pareto k estimates are ok (k &lt; 0.7).
## See help(&#39;pareto-k-diagnostic&#39;) for details.</code></pre>
<div class="sourceCode" id="cb1034"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1034-1"><a href="monsters-and-mixtures.html#cb1034-1" aria-hidden="true" tabindex="-1"></a><span class="co">#負の二項分布</span></span>
<span id="cb1034-2"><a href="monsters-and-mixtures.html#cb1034-2" aria-hidden="true" tabindex="-1"></a><span class="fu">loo</span>(b12<span class="fl">.2</span>)</span></code></pre></div>
<pre><code>## 
## Computed from 4000 by 10 log-likelihood matrix
## 
##          Estimate  SE
## elpd_loo    -41.5 1.7
## p_loo         1.2 0.2
## looic        83.0 3.3
## ------
## Monte Carlo SE of elpd_loo is 0.0.
## 
## Pareto k diagnostic values:
##                          Count Pct.    Min. n_eff
## (-Inf, 0.5]   (good)     9     90.0%   1588      
##  (0.5, 0.7]   (ok)       1     10.0%   564       
##    (0.7, 1]   (bad)      0      0.0%   &lt;NA&gt;      
##    (1, Inf)   (very bad) 0      0.0%   &lt;NA&gt;      
## 
## All Pareto k estimates are ok (k &lt; 0.7).
## See help(&#39;pareto-k-diagnostic&#39;) for details.</code></pre>
<div class="sourceCode" id="cb1036"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1036-1"><a href="monsters-and-mixtures.html#cb1036-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Poisson</span></span>
<span id="cb1036-2"><a href="monsters-and-mixtures.html#cb1036-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1036-3"><a href="monsters-and-mixtures.html#cb1036-3" aria-hidden="true" tabindex="-1"></a>nd <span class="ot">&lt;-</span></span>
<span id="cb1036-4"><a href="monsters-and-mixtures.html#cb1036-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(d2, cid) <span class="sc">%&gt;%</span> </span>
<span id="cb1036-5"><a href="monsters-and-mixtures.html#cb1036-5" aria-hidden="true" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">expand</span>(cid, </span>
<span id="cb1036-6"><a href="monsters-and-mixtures.html#cb1036-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">population =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">0</span>, <span class="at">to =</span> <span class="dv">300000</span>, <span class="at">length.out =</span> <span class="dv">100</span>))</span>
<span id="cb1036-7"><a href="monsters-and-mixtures.html#cb1036-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1036-8"><a href="monsters-and-mixtures.html#cb1036-8" aria-hidden="true" tabindex="-1"></a><span class="co"># compute the poster predictions for lambda</span></span>
<span id="cb1036-9"><a href="monsters-and-mixtures.html#cb1036-9" aria-hidden="true" tabindex="-1"></a><span class="fu">fitted</span>(b11<span class="fl">.11</span>,</span>
<span id="cb1036-10"><a href="monsters-and-mixtures.html#cb1036-10" aria-hidden="true" tabindex="-1"></a>       <span class="at">newdata =</span> nd,</span>
<span id="cb1036-11"><a href="monsters-and-mixtures.html#cb1036-11" aria-hidden="true" tabindex="-1"></a>       <span class="at">probs =</span> <span class="fu">c</span>(.<span class="dv">055</span>, .<span class="dv">945</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb1036-12"><a href="monsters-and-mixtures.html#cb1036-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb1036-13"><a href="monsters-and-mixtures.html#cb1036-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(nd) <span class="sc">%&gt;%</span></span>
<span id="cb1036-14"><a href="monsters-and-mixtures.html#cb1036-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> population, <span class="at">group =</span> cid))<span class="sc">+</span></span>
<span id="cb1036-15"><a href="monsters-and-mixtures.html#cb1036-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="fu">aes</span>(<span class="at">y =</span> Estimate, <span class="at">ymin =</span> Q5<span class="fl">.5</span>,</span>
<span id="cb1036-16"><a href="monsters-and-mixtures.html#cb1036-16" aria-hidden="true" tabindex="-1"></a>                  <span class="at">ymax =</span> Q94<span class="fl">.5</span>,</span>
<span id="cb1036-17"><a href="monsters-and-mixtures.html#cb1036-17" aria-hidden="true" tabindex="-1"></a>                  <span class="at">linetype =</span> cid,</span>
<span id="cb1036-18"><a href="monsters-and-mixtures.html#cb1036-18" aria-hidden="true" tabindex="-1"></a>                  <span class="at">fill =</span> cid,</span>
<span id="cb1036-19"><a href="monsters-and-mixtures.html#cb1036-19" aria-hidden="true" tabindex="-1"></a>                  <span class="at">color =</span> cid),</span>
<span id="cb1036-20"><a href="monsters-and-mixtures.html#cb1036-20" aria-hidden="true" tabindex="-1"></a>              <span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>,</span>
<span id="cb1036-21"><a href="monsters-and-mixtures.html#cb1036-21" aria-hidden="true" tabindex="-1"></a>              <span class="at">size=</span><span class="fl">1.5</span>, <span class="at">alpha=</span><span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>)<span class="sc">+</span></span>
<span id="cb1036-22"><a href="monsters-and-mixtures.html#cb1036-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> <span class="fu">bind_cols</span>(d2, b11<span class="fl">.11</span><span class="sc">$</span>criteria<span class="sc">$</span>loo<span class="sc">$</span>diagnostics),</span>
<span id="cb1036-23"><a href="monsters-and-mixtures.html#cb1036-23" aria-hidden="true" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">y =</span> total_tools, <span class="at">size =</span> pareto_k,</span>
<span id="cb1036-24"><a href="monsters-and-mixtures.html#cb1036-24" aria-hidden="true" tabindex="-1"></a>                 <span class="at">color =</span> cid),<span class="at">stroke =</span> <span class="fl">1.5</span>,</span>
<span id="cb1036-25"><a href="monsters-and-mixtures.html#cb1036-25" aria-hidden="true" tabindex="-1"></a>             <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>)<span class="sc">+</span></span>
<span id="cb1036-26"><a href="monsters-and-mixtures.html#cb1036-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_shape_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="dv">16</span>,<span class="dv">1</span>))<span class="sc">+</span></span>
<span id="cb1036-27"><a href="monsters-and-mixtures.html#cb1036-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;lightblue3&quot;</span>,<span class="st">&quot;orange3&quot;</span>))<span class="sc">+</span></span>
<span id="cb1036-28"><a href="monsters-and-mixtures.html#cb1036-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;lightblue&quot;</span>, <span class="st">&quot;orange&quot;</span>))<span class="sc">+</span></span>
<span id="cb1036-29"><a href="monsters-and-mixtures.html#cb1036-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">250000</span>,<span class="at">by=</span><span class="dv">50000</span>))<span class="sc">+</span></span>
<span id="cb1036-30"><a href="monsters-and-mixtures.html#cb1036-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">280000</span>),</span>
<span id="cb1036-31"><a href="monsters-and-mixtures.html#cb1036-31" aria-hidden="true" tabindex="-1"></a>                  <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">80</span>))<span class="sc">+</span></span>
<span id="cb1036-32"><a href="monsters-and-mixtures.html#cb1036-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>,</span>
<span id="cb1036-33"><a href="monsters-and-mixtures.html#cb1036-33" aria-hidden="true" tabindex="-1"></a>        <span class="at">aspect.ratio=</span><span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb1036-34"><a href="monsters-and-mixtures.html#cb1036-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">&quot;pure Poisson model&quot;</span>)<span class="ot">-&gt;</span> p1</span>
<span id="cb1036-35"><a href="monsters-and-mixtures.html#cb1036-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1036-36"><a href="monsters-and-mixtures.html#cb1036-36" aria-hidden="true" tabindex="-1"></a><span class="do">## negbinomial  </span></span>
<span id="cb1036-37"><a href="monsters-and-mixtures.html#cb1036-37" aria-hidden="true" tabindex="-1"></a>text <span class="ot">&lt;-</span></span>
<span id="cb1036-38"><a href="monsters-and-mixtures.html#cb1036-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(d2, cid) <span class="sc">%&gt;%</span> </span>
<span id="cb1036-39"><a href="monsters-and-mixtures.html#cb1036-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">population  =</span> <span class="fu">c</span>(<span class="dv">150000</span>, <span class="dv">110000</span>),</span>
<span id="cb1036-40"><a href="monsters-and-mixtures.html#cb1036-40" aria-hidden="true" tabindex="-1"></a>         <span class="at">total_tools =</span> <span class="fu">c</span>(<span class="dv">57</span>, <span class="dv">69</span>),</span>
<span id="cb1036-41"><a href="monsters-and-mixtures.html#cb1036-41" aria-hidden="true" tabindex="-1"></a>         <span class="at">label       =</span> <span class="fu">str_c</span>(cid, <span class="st">&quot; contact&quot;</span>))</span>
<span id="cb1036-42"><a href="monsters-and-mixtures.html#cb1036-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1036-43"><a href="monsters-and-mixtures.html#cb1036-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1036-44"><a href="monsters-and-mixtures.html#cb1036-44" aria-hidden="true" tabindex="-1"></a><span class="co"># compute the poster predictions for lambda</span></span>
<span id="cb1036-45"><a href="monsters-and-mixtures.html#cb1036-45" aria-hidden="true" tabindex="-1"></a><span class="fu">fitted</span>(b12<span class="fl">.2</span>,</span>
<span id="cb1036-46"><a href="monsters-and-mixtures.html#cb1036-46" aria-hidden="true" tabindex="-1"></a>       <span class="at">newdata =</span> nd,</span>
<span id="cb1036-47"><a href="monsters-and-mixtures.html#cb1036-47" aria-hidden="true" tabindex="-1"></a>       <span class="at">probs =</span> <span class="fu">c</span>(.<span class="dv">055</span>, .<span class="dv">945</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb1036-48"><a href="monsters-and-mixtures.html#cb1036-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb1036-49"><a href="monsters-and-mixtures.html#cb1036-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(nd) <span class="sc">%&gt;%</span></span>
<span id="cb1036-50"><a href="monsters-and-mixtures.html#cb1036-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> population, <span class="at">group =</span> cid))<span class="sc">+</span></span>
<span id="cb1036-51"><a href="monsters-and-mixtures.html#cb1036-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="fu">aes</span>(<span class="at">y =</span> Estimate, <span class="at">ymin =</span> Q5<span class="fl">.5</span>,</span>
<span id="cb1036-52"><a href="monsters-and-mixtures.html#cb1036-52" aria-hidden="true" tabindex="-1"></a>                  <span class="at">ymax =</span> Q94<span class="fl">.5</span>,</span>
<span id="cb1036-53"><a href="monsters-and-mixtures.html#cb1036-53" aria-hidden="true" tabindex="-1"></a>                  <span class="at">linetype =</span> cid,</span>
<span id="cb1036-54"><a href="monsters-and-mixtures.html#cb1036-54" aria-hidden="true" tabindex="-1"></a>                  <span class="at">fill =</span> cid,</span>
<span id="cb1036-55"><a href="monsters-and-mixtures.html#cb1036-55" aria-hidden="true" tabindex="-1"></a>                  <span class="at">color =</span> cid),</span>
<span id="cb1036-56"><a href="monsters-and-mixtures.html#cb1036-56" aria-hidden="true" tabindex="-1"></a>              <span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>,</span>
<span id="cb1036-57"><a href="monsters-and-mixtures.html#cb1036-57" aria-hidden="true" tabindex="-1"></a>              <span class="at">size=</span><span class="fl">1.5</span>, <span class="at">alpha=</span><span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>)<span class="sc">+</span></span>
<span id="cb1036-58"><a href="monsters-and-mixtures.html#cb1036-58" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> <span class="fu">bind_cols</span>(d2, b12<span class="fl">.2</span><span class="sc">$</span>criteria<span class="sc">$</span>loo<span class="sc">$</span>diagnostics),</span>
<span id="cb1036-59"><a href="monsters-and-mixtures.html#cb1036-59" aria-hidden="true" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">y =</span> total_tools, <span class="at">size =</span> pareto_k,</span>
<span id="cb1036-60"><a href="monsters-and-mixtures.html#cb1036-60" aria-hidden="true" tabindex="-1"></a>                 <span class="at">color =</span> cid),<span class="at">stroke =</span> <span class="fl">1.5</span>,</span>
<span id="cb1036-61"><a href="monsters-and-mixtures.html#cb1036-61" aria-hidden="true" tabindex="-1"></a>             <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>)<span class="sc">+</span></span>
<span id="cb1036-62"><a href="monsters-and-mixtures.html#cb1036-62" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_shape_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="dv">16</span>,<span class="dv">1</span>))<span class="sc">+</span></span>
<span id="cb1036-63"><a href="monsters-and-mixtures.html#cb1036-63" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;lightblue3&quot;</span>,<span class="st">&quot;orange3&quot;</span>))<span class="sc">+</span></span>
<span id="cb1036-64"><a href="monsters-and-mixtures.html#cb1036-64" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;lightblue&quot;</span>, <span class="st">&quot;orange&quot;</span>))<span class="sc">+</span></span>
<span id="cb1036-65"><a href="monsters-and-mixtures.html#cb1036-65" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">250000</span>,<span class="at">by=</span><span class="dv">50000</span>))<span class="sc">+</span></span>
<span id="cb1036-66"><a href="monsters-and-mixtures.html#cb1036-66" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">280000</span>),</span>
<span id="cb1036-67"><a href="monsters-and-mixtures.html#cb1036-67" aria-hidden="true" tabindex="-1"></a>                  <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">80</span>))<span class="sc">+</span></span>
<span id="cb1036-68"><a href="monsters-and-mixtures.html#cb1036-68" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>,</span>
<span id="cb1036-69"><a href="monsters-and-mixtures.html#cb1036-69" aria-hidden="true" tabindex="-1"></a>        <span class="at">aspect.ratio=</span><span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb1036-70"><a href="monsters-and-mixtures.html#cb1036-70" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">data =</span> text,</span>
<span id="cb1036-71"><a href="monsters-and-mixtures.html#cb1036-71" aria-hidden="true" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">y =</span> total_tools, <span class="at">label =</span> label))<span class="sc">+</span></span>
<span id="cb1036-72"><a href="monsters-and-mixtures.html#cb1036-72" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">&quot;gamma-Poisson model&quot;</span>)<span class="ot">-&gt;</span>p2</span></code></pre></div>
<p>結果を示すと以下の通り（図<a href="monsters-and-mixtures.html#fig:b12-2">12.4</a>）。ポワソン分布に比べて、かなり広がりが大きくなっていることが分かる。</p>
<div class="sourceCode" id="cb1037"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1037-1"><a href="monsters-and-mixtures.html#cb1037-1" aria-hidden="true" tabindex="-1"></a>p1<span class="sc">+</span>p2</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:b12-2"></span>
<img src="Rethinking_Bookdown_files/figure-html/b12-2-1.png" alt="ポワソン分布（左）と負の二項分布（右）による結果" width="672" />
<p class="caption">
図12.4: ポワソン分布（左）と負の二項分布（右）による結果
</p>
</div>
<p>また、国ごとの予測分布は以下のようになる（図<a href="monsters-and-mixtures.html#fig:predict-b12-2">12.5</a>）。</p>
<div class="sourceCode" id="cb1038"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1038-1"><a href="monsters-and-mixtures.html#cb1038-1" aria-hidden="true" tabindex="-1"></a><span class="fu">predict</span>(b12<span class="fl">.2</span>, <span class="at">summary =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1038-2"><a href="monsters-and-mixtures.html#cb1038-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1038-3"><a href="monsters-and-mixtures.html#cb1038-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_names</span>(d2<span class="sc">$</span>culture) <span class="sc">%&gt;%</span> </span>
<span id="cb1038-4"><a href="monsters-and-mixtures.html#cb1038-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">everything</span>(),</span>
<span id="cb1038-5"><a href="monsters-and-mixtures.html#cb1038-5" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">&quot;culture&quot;</span>,</span>
<span id="cb1038-6"><a href="monsters-and-mixtures.html#cb1038-6" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">&quot;tools&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1038-7"><a href="monsters-and-mixtures.html#cb1038-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(d2) <span class="ot">-&gt;</span> predict</span>
<span id="cb1038-8"><a href="monsters-and-mixtures.html#cb1038-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1038-9"><a href="monsters-and-mixtures.html#cb1038-9" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(predict, <span class="fu">aes</span>(<span class="at">x =</span> tools))<span class="sc">+</span></span>
<span id="cb1038-10"><a href="monsters-and-mixtures.html#cb1038-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_halfeye</span>(<span class="at">point_interval=</span> mean_qi, <span class="at">.width =</span>.<span class="dv">5</span>,</span>
<span id="cb1038-11"><a href="monsters-and-mixtures.html#cb1038-11" aria-hidden="true" tabindex="-1"></a>               <span class="at">fill =</span> <span class="st">&quot;navy&quot;</span>, <span class="at">color =</span><span class="st">&quot;grey&quot;</span>)<span class="sc">+</span></span>
<span id="cb1038-12"><a href="monsters-and-mixtures.html#cb1038-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="fu">aes</span>(<span class="at">xintercept =</span> total_tools),</span>
<span id="cb1038-13"><a href="monsters-and-mixtures.html#cb1038-13" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> <span class="st">&quot;grey&quot;</span>)<span class="sc">+</span></span>
<span id="cb1038-14"><a href="monsters-and-mixtures.html#cb1038-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="fu">expression</span>(lambda[<span class="st">&quot;[culture]&quot;</span>]), <span class="at">breaks =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">2</span> <span class="sc">*</span> <span class="dv">100</span>) <span class="sc">+</span></span>
<span id="cb1038-15"><a href="monsters-and-mixtures.html#cb1038-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="cn">NULL</span>, <span class="at">breaks =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb1038-16"><a href="monsters-and-mixtures.html#cb1038-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">210</span>)) <span class="sc">+</span></span>
<span id="cb1038-17"><a href="monsters-and-mixtures.html#cb1038-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> culture, <span class="at">nrow =</span> <span class="dv">2</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:predict-b12-2"></span>
<img src="Rethinking_Bookdown_files/figure-html/predict-b12-2-1.png" alt="国ごとの予測分布" width="672" />
<p class="caption">
図12.5: 国ごとの予測分布
</p>
</div>
</div>
<div id="over-dispersion-entropy-and-information-criteria." class="section level3 hasAnchor" number="12.1.3">
<h3><span class="header-section-number">12.1.3</span> Over-dispersion, entropy, and information criteria.<a href="monsters-and-mixtures.html#over-dispersion-entropy-and-information-criteria." class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>これらのモデルにWAICやPSISを用いることはできない。</p>
</div>
</div>
<div id="zero-inflated-outcomes" class="section level2 hasAnchor" number="12.2">
<h2><span class="header-section-number">12.2</span> Zero-inflated outcomes<a href="monsters-and-mixtures.html#zero-inflated-outcomes" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>データが複数のプロセスを混合して得られることがある。そのようなデータに対しては<strong>混合モデル</strong>が有用である。本節では、特に0が多いカウントデータを扱う。</p>
<div id="example-zero-inflated-poisson." class="section level3 hasAnchor" number="12.2.1">
<h3><span class="header-section-number">12.2.1</span> Example: Zero-inflated Poisson.<a href="monsters-and-mixtures.html#example-zero-inflated-poisson." class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>11章で考えた修道院の例を考える。何日かに一度僧侶が全員休みを取って酒を飲む場合を考える。この場合、ある日に1つも原稿ができないのは、働いているのに完成しなかった場合と、酒を飲んでいる場合が両方含まれている。ここで、酒を飲む確率を<span class="math inline">\(p\)</span>、働いているときに1日当たり原稿ができる数の平均を<span class="math inline">\(\lambda\)</span>とする。<br />
この現象を考えるため、二つのプロセスが混合された尤度関数を考える。まず、コイン投げで酒を飲むかか否かが決まり（ベルヌーイ分布）、その後働いた場合の原稿製造数がポワソン分布に従うとする。このとき、ある日の製造数が0である確率は以下の通り。</p>
<p><br /></p>
<p><span class="math display">\[
\begin{aligned}
Pr(0|p, \lambda) &amp;= Pr(drink|p) + Pr(work|p) \times Pr(0|\lambda)\\
                 &amp;= p + (1-p)exp(-\lambda)
\end{aligned}
\]</span>
<br /></p>
<p>また、0以外の値が得られる確率は以下の通り。
<br /></p>
<p><span class="math display">\[
Pr(y|y&gt;0, p,\lambda) = (1-p) \frac{\lambda^y exp(-\lambda)}{y!}
\]</span>
<br /></p>
<p>モデル式にすると以下の通り。２つの線形モデルとリンク関数が含まれる点に注意。<br />
<br /></p>
<p><span class="math display">\[
\begin{aligned}
  y_{i} &amp;\sim ZIPoisson(p_{i}, \lambda)\\
  logit(p_{i}) &amp;= \alpha_{p} + \beta_{p}x_{i}\\
  log(\lambda_{i}) &amp;= \alpha_{\lambda} + \beta_{\lambda}x_{i}\\
\end{aligned}
\]</span>
<br /></p>
<p>データをシミュレートしてモデリングする。</p>
<div class="sourceCode" id="cb1039"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1039-1"><a href="monsters-and-mixtures.html#cb1039-1" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fl">0.2</span></span>
<span id="cb1039-2"><a href="monsters-and-mixtures.html#cb1039-2" aria-hidden="true" tabindex="-1"></a>lambda <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb1039-3"><a href="monsters-and-mixtures.html#cb1039-3" aria-hidden="true" tabindex="-1"></a>N <span class="ot">&lt;-</span> <span class="dv">365</span></span>
<span id="cb1039-4"><a href="monsters-and-mixtures.html#cb1039-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1039-5"><a href="monsters-and-mixtures.html#cb1039-5" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">365</span>)</span>
<span id="cb1039-6"><a href="monsters-and-mixtures.html#cb1039-6" aria-hidden="true" tabindex="-1"></a>drink <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(N, <span class="dv">1</span>, p)</span>
<span id="cb1039-7"><a href="monsters-and-mixtures.html#cb1039-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1039-8"><a href="monsters-and-mixtures.html#cb1039-8" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> (<span class="dv">1</span><span class="sc">-</span>drink)<span class="sc">*</span><span class="fu">rpois</span>(N, lambda)</span></code></pre></div>
<p>データをヒストグラムに書くと以下のようになる（図<a href="monsters-and-mixtures.html#fig:count">12.6</a>）。</p>
<div class="sourceCode" id="cb1040"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1040-1"><a href="monsters-and-mixtures.html#cb1040-1" aria-hidden="true" tabindex="-1"></a>d3 <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">drink =</span> <span class="fu">factor</span>(drink, <span class="at">levels =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">0</span>),</span>
<span id="cb1040-2"><a href="monsters-and-mixtures.html#cb1040-2" aria-hidden="true" tabindex="-1"></a>             <span class="at">y =</span> y)</span>
<span id="cb1040-3"><a href="monsters-and-mixtures.html#cb1040-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1040-4"><a href="monsters-and-mixtures.html#cb1040-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(d3, <span class="fu">aes</span>(<span class="at">x=</span>y, <span class="at">fill=</span>drink))<span class="sc">+</span></span>
<span id="cb1040-5"><a href="monsters-and-mixtures.html#cb1040-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">binwidth=</span><span class="dv">1</span>, <span class="at">size=</span><span class="dv">1</span><span class="sc">/</span><span class="dv">10</span>, <span class="at">color =</span> <span class="st">&quot;grey92&quot;</span>)<span class="sc">+</span></span>
<span id="cb1040-6"><a href="monsters-and-mixtures.html#cb1040-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;lemonchiffon4&quot;</span>, <span class="st">&quot;olivedrab4&quot;</span>))<span class="sc">+</span></span>
<span id="cb1040-7"><a href="monsters-and-mixtures.html#cb1040-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;manuscript completed&quot;</span>)<span class="sc">+</span></span>
<span id="cb1040-8"><a href="monsters-and-mixtures.html#cb1040-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span><span class="st">&quot;none&quot;</span>, <span class="at">aspect.ratio=</span><span class="fl">0.7</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:count"></span>
<img src="Rethinking_Bookdown_files/figure-html/count-1.png" alt="1日の原稿完成数。緑は働いた日、灰色は休みの日を表す。" width="672" />
<p class="caption">
図12.6: 1日の原稿完成数。緑は働いた日、灰色は休みの日を表す。
</p>
</div>
<p>それでは、モデリングを行う。</p>
<div class="sourceCode" id="cb1041"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1041-1"><a href="monsters-and-mixtures.html#cb1041-1" aria-hidden="true" tabindex="-1"></a>b12<span class="fl">.3</span> <span class="ot">&lt;-</span> </span>
<span id="cb1041-2"><a href="monsters-and-mixtures.html#cb1041-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">brm</span>(<span class="at">data =</span> d3,</span>
<span id="cb1041-3"><a href="monsters-and-mixtures.html#cb1041-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">family  =</span> zero_inflated_poisson,</span>
<span id="cb1041-4"><a href="monsters-and-mixtures.html#cb1041-4" aria-hidden="true" tabindex="-1"></a>      y<span class="sc">~</span><span class="dv">1</span>,</span>
<span id="cb1041-5"><a href="monsters-and-mixtures.html#cb1041-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">1</span>, <span class="fl">0.5</span>), <span class="at">class =</span> Intercept),</span>
<span id="cb1041-6"><a href="monsters-and-mixtures.html#cb1041-6" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">beta</span>(<span class="dv">2</span>, <span class="dv">6</span>), <span class="at">class =</span> zi)),</span>
<span id="cb1041-7"><a href="monsters-and-mixtures.html#cb1041-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">backend =</span> <span class="st">&quot;cmdstanr&quot;</span>,</span>
<span id="cb1041-8"><a href="monsters-and-mixtures.html#cb1041-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">seed=</span><span class="dv">12</span>, <span class="at">file =</span> <span class="st">&quot;output/Chapter12/b12.3&quot;</span>)</span></code></pre></div>
<p>結果は表<a href="monsters-and-mixtures.html#tab:res-b12-3">12.3</a>の通り。<span class="math inline">\(exp(0.02)=\)</span> 1.0202013なので、うまく推定できているよう。</p>
<div class="sourceCode" id="cb1042"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1042-1"><a href="monsters-and-mixtures.html#cb1042-1" aria-hidden="true" tabindex="-1"></a><span class="fu">posterior_summary</span>(b12<span class="fl">.3</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1042-2"><a href="monsters-and-mixtures.html#cb1042-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1042-3"><a href="monsters-and-mixtures.html#cb1042-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>(<span class="at">var =</span> <span class="st">&quot;parameter&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1042-4"><a href="monsters-and-mixtures.html#cb1042-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(parameter <span class="sc">!=</span> <span class="st">&quot;lp__&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1042-5"><a href="monsters-and-mixtures.html#cb1042-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="at">digits=</span><span class="dv">2</span>,</span>
<span id="cb1042-6"><a href="monsters-and-mixtures.html#cb1042-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">booktabs =</span>T,</span>
<span id="cb1042-7"><a href="monsters-and-mixtures.html#cb1042-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">caption =</span> <span class="st">&quot;b12.3の結果&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1042-8"><a href="monsters-and-mixtures.html#cb1042-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">latex_options =</span> <span class="fu">c</span>(<span class="st">&quot;striped&quot;</span>, <span class="st">&quot;hold_position&quot;</span>))</span></code></pre></div>
<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:res-b12-3">表12.3: </span>b12.3の結果
</caption>
<thead>
<tr>
<th style="text-align:left;">
parameter
</th>
<th style="text-align:right;">
Estimate
</th>
<th style="text-align:right;">
Est.Error
</th>
<th style="text-align:right;">
Q2.5
</th>
<th style="text-align:right;">
Q97.5
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
b_Intercept
</td>
<td style="text-align:right;">
0.02
</td>
<td style="text-align:right;">
0.09
</td>
<td style="text-align:right;">
-0.16
</td>
<td style="text-align:right;">
0.18
</td>
</tr>
<tr>
<td style="text-align:left;">
zi
</td>
<td style="text-align:right;">
0.23
</td>
<td style="text-align:right;">
0.06
</td>
<td style="text-align:right;">
0.12
</td>
<td style="text-align:right;">
0.33
</td>
</tr>
<tr>
<td style="text-align:left;">
lprior
</td>
<td style="text-align:right;">
-1.26
</td>
<td style="text-align:right;">
0.31
</td>
<td style="text-align:right;">
-1.95
</td>
<td style="text-align:right;">
-0.75
</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="ordered-categorical-outcomes" class="section level2 hasAnchor" number="12.3">
<h2><span class="header-section-number">12.3</span> Ordered categorical outcomes<a href="monsters-and-mixtures.html#ordered-categorical-outcomes" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>目的変数がカテゴリカルでかつ順序があるとき（ex. 心理テストで7件法で回答を求めるとき）、その目的変数を連続変数として扱ってはいけない。なぜなら1から2に変わるときと、5から6に変わるときでは意味が違ってくる可能性があるからである。このような変数を扱うために通常用いられるのは、<strong>累積リンク関数</strong>(<em>cumulative link function</em>)と呼ばれるものである。累積確率とは、それより低い値の確率を累計したもので、たとえば3になる累積確率は1, 2, 3になる確率を合計したものである。</p>
<div id="example-moral-intuition." class="section level3 hasAnchor" number="12.3.1">
<h3><span class="header-section-number">12.3.1</span> Example: Moral intuition.<a href="monsters-and-mixtures.html#example-moral-intuition." class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>いわゆるトロッコ問題では、問題の設定を少し変えるだけで、生じる結果が同じであっても異なる判断につながることがある。これまでの研究では、このようなヒトの道徳的判断の変化を説明する無意識の推論には少なくとも3つの原理があることを明らかにしている。</p>
<ol style="list-style-type: decimal">
<li><strong>The action principle</strong><br />
行動によってもたらされた害は、何もしなかったことによってもたらされた同等の害よりも道徳的に悪いとされる。<br />
</li>
<li><strong>The intention principle</strong><br />
目的のためになされた意図的な害は、副産物的な害よりも道徳的に悪いとされる。<br />
</li>
<li><strong>The contact problem</strong><br />
物理的な接触によってもたらされた害は、そうでない害よりも道徳的に悪いとされる。</li>
</ol>
<p>以下では、トロッコ問題について331人に7件法に回答してもらったデータを用いる。</p>
<div class="sourceCode" id="cb1043"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1043-1"><a href="monsters-and-mixtures.html#cb1043-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(Trolley)</span>
<span id="cb1043-2"><a href="monsters-and-mixtures.html#cb1043-2" aria-hidden="true" tabindex="-1"></a>d4 <span class="ot">&lt;-</span> Trolley</span>
<span id="cb1043-3"><a href="monsters-and-mixtures.html#cb1043-3" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(d4)</span></code></pre></div>
<pre><code>## Rows: 9,930
## Columns: 12
## $ case      &lt;fct&gt; cfaqu, cfbur, cfrub, cibox, cibur, cispe, fkaqu, fkboa, fkbo…
## $ response  &lt;int&gt; 4, 3, 4, 3, 3, 3, 5, 4, 4, 4, 4, 4, 4, 5, 4, 4, 4, 4, 4, 3, …
## $ order     &lt;int&gt; 2, 31, 16, 32, 4, 9, 29, 12, 23, 22, 27, 19, 14, 3, 18, 15, …
## $ id        &lt;fct&gt; 96;434, 96;434, 96;434, 96;434, 96;434, 96;434, 96;434, 96;4…
## $ age       &lt;int&gt; 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, …
## $ male      &lt;int&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, …
## $ edu       &lt;fct&gt; Middle School, Middle School, Middle School, Middle School, …
## $ action    &lt;int&gt; 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 1, 1, …
## $ intention &lt;int&gt; 0, 0, 0, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, …
## $ contact   &lt;int&gt; 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, …
## $ story     &lt;fct&gt; aqu, bur, rub, box, bur, spe, aqu, boa, box, bur, car, spe, …
## $ action2   &lt;int&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 1, 1, …</code></pre>
<p>12.3.2. Describing an ordered distribution with intercepts.<br />
問題に対する回答の分布は以下の通り（図<a href="monsters-and-mixtures.html#fig:outcome">12.7</a>のA）。また、累積確率を表したものが図<a href="monsters-and-mixtures.html#fig:outcome">12.7</a>のBである。最後に、対数累積オッズを考える。ある値<span class="math inline">\(k\)</span>に対する対数累積オッズ<span class="math inline">\(\alpha_{k}\)</span>配下の通り。<br />
<br /></p>
<p><span class="math display">\[
\alpha_{k} = log \frac{Pr(y_{i} \leq k )}{1 - Pr(y_{i} \leq k)}
\]</span>
<br /></p>
<p>対数累積オッズを表したものが図<a href="monsters-and-mixtures.html#fig:outcome">12.7</a>のCである。最も大きい値の対数累積オッズは無限大になることに注意(<span class="math inline">\(\frac{1}{1-1} = \infty\)</span>)。</p>
<div class="sourceCode" id="cb1045"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1045-1"><a href="monsters-and-mixtures.html#cb1045-1" aria-hidden="true" tabindex="-1"></a><span class="do">## hist</span></span>
<span id="cb1045-2"><a href="monsters-and-mixtures.html#cb1045-2" aria-hidden="true" tabindex="-1"></a>d4 <span class="sc">%&gt;%</span> </span>
<span id="cb1045-3"><a href="monsters-and-mixtures.html#cb1045-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>response))<span class="sc">+</span></span>
<span id="cb1045-4"><a href="monsters-and-mixtures.html#cb1045-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">binwidth =</span> <span class="fl">0.1</span>)<span class="sc">+</span></span>
<span id="cb1045-5"><a href="monsters-and-mixtures.html#cb1045-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks=</span><span class="fu">seq</span>(<span class="dv">1</span>,<span class="dv">7</span>,<span class="at">by=</span><span class="dv">1</span>))<span class="sc">+</span></span>
<span id="cb1045-6"><a href="monsters-and-mixtures.html#cb1045-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">&quot;A: Histogram&quot;</span>)<span class="sc">+</span></span>
<span id="cb1045-7"><a href="monsters-and-mixtures.html#cb1045-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">aspect.ratio=</span><span class="dv">1</span>) <span class="ot">-&gt;</span> p3</span>
<span id="cb1045-8"><a href="monsters-and-mixtures.html#cb1045-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1045-9"><a href="monsters-and-mixtures.html#cb1045-9" aria-hidden="true" tabindex="-1"></a><span class="do">## cumulative probability  </span></span>
<span id="cb1045-10"><a href="monsters-and-mixtures.html#cb1045-10" aria-hidden="true" tabindex="-1"></a>d4 <span class="sc">%&gt;%</span> </span>
<span id="cb1045-11"><a href="monsters-and-mixtures.html#cb1045-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(response) <span class="sc">%&gt;%</span> </span>
<span id="cb1045-12"><a href="monsters-and-mixtures.html#cb1045-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">pr_k =</span> n<span class="sc">/</span><span class="fu">nrow</span>(d4),</span>
<span id="cb1045-13"><a href="monsters-and-mixtures.html#cb1045-13" aria-hidden="true" tabindex="-1"></a>         <span class="at">cum =</span> <span class="fu">cumsum</span>(pr_k)) <span class="sc">%&gt;%</span> </span>
<span id="cb1045-14"><a href="monsters-and-mixtures.html#cb1045-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> response, <span class="at">y =</span> cum))<span class="sc">+</span></span>
<span id="cb1045-15"><a href="monsters-and-mixtures.html#cb1045-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">shape=</span><span class="dv">21</span>, <span class="at">color=</span><span class="st">&quot;grey92&quot;</span>, <span class="at">size=</span><span class="fl">2.5</span>, </span>
<span id="cb1045-16"><a href="monsters-and-mixtures.html#cb1045-16" aria-hidden="true" tabindex="-1"></a>             <span class="at">stroke =</span><span class="fl">1.5</span>, <span class="at">fill =</span> <span class="st">&quot;khaki4&quot;</span>)<span class="sc">+</span></span>
<span id="cb1045-17"><a href="monsters-and-mixtures.html#cb1045-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">color =</span> <span class="st">&quot;khaki4&quot;</span>)<span class="sc">+</span></span>
<span id="cb1045-18"><a href="monsters-and-mixtures.html#cb1045-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">7</span>) <span class="sc">+</span></span>
<span id="cb1045-19"><a href="monsters-and-mixtures.html#cb1045-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="st">&quot;cumulative proportion&quot;</span>, </span>
<span id="cb1045-20"><a href="monsters-and-mixtures.html#cb1045-20" aria-hidden="true" tabindex="-1"></a>                     <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>, .<span class="dv">5</span>, <span class="dv">1</span>), <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb1045-21"><a href="monsters-and-mixtures.html#cb1045-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.ticks =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb1045-22"><a href="monsters-and-mixtures.html#cb1045-22" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">90</span>),</span>
<span id="cb1045-23"><a href="monsters-and-mixtures.html#cb1045-23" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>,</span>
<span id="cb1045-24"><a href="monsters-and-mixtures.html#cb1045-24" aria-hidden="true" tabindex="-1"></a>        <span class="at">aspect.ratio=</span><span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb1045-25"><a href="monsters-and-mixtures.html#cb1045-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">&quot;B: cumulative proportion&quot;</span>) <span class="ot">-&gt;</span> p4</span>
<span id="cb1045-26"><a href="monsters-and-mixtures.html#cb1045-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1045-27"><a href="monsters-and-mixtures.html#cb1045-27" aria-hidden="true" tabindex="-1"></a>d4 <span class="sc">%&gt;%</span> </span>
<span id="cb1045-28"><a href="monsters-and-mixtures.html#cb1045-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(response) <span class="sc">%&gt;%</span> </span>
<span id="cb1045-29"><a href="monsters-and-mixtures.html#cb1045-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">pr_k =</span> n<span class="sc">/</span><span class="fu">nrow</span>(d4),</span>
<span id="cb1045-30"><a href="monsters-and-mixtures.html#cb1045-30" aria-hidden="true" tabindex="-1"></a>         <span class="at">cum =</span> <span class="fu">cumsum</span>(pr_k),</span>
<span id="cb1045-31"><a href="monsters-and-mixtures.html#cb1045-31" aria-hidden="true" tabindex="-1"></a>         <span class="at">alpha =</span> <span class="fu">logit</span>(cum)) <span class="sc">%&gt;%</span></span>
<span id="cb1045-32"><a href="monsters-and-mixtures.html#cb1045-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(response<span class="sc">&lt;</span><span class="dv">7</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1045-33"><a href="monsters-and-mixtures.html#cb1045-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> response, <span class="at">y =</span> alpha))<span class="sc">+</span></span>
<span id="cb1045-34"><a href="monsters-and-mixtures.html#cb1045-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">shape=</span><span class="dv">21</span>, <span class="at">color=</span><span class="st">&quot;grey92&quot;</span>, <span class="at">size=</span><span class="fl">2.5</span>, </span>
<span id="cb1045-35"><a href="monsters-and-mixtures.html#cb1045-35" aria-hidden="true" tabindex="-1"></a>             <span class="at">stroke =</span><span class="fl">1.5</span>, <span class="at">fill =</span> <span class="st">&quot;khaki4&quot;</span>)<span class="sc">+</span></span>
<span id="cb1045-36"><a href="monsters-and-mixtures.html#cb1045-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">color =</span> <span class="st">&quot;khaki4&quot;</span>)<span class="sc">+</span></span>
<span id="cb1045-37"><a href="monsters-and-mixtures.html#cb1045-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">7</span>) <span class="sc">+</span></span>
<span id="cb1045-38"><a href="monsters-and-mixtures.html#cb1045-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="st">&quot;log-cumulative-odds&quot;</span>, </span>
<span id="cb1045-39"><a href="monsters-and-mixtures.html#cb1045-39" aria-hidden="true" tabindex="-1"></a>                     <span class="at">breaks =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">2</span>, <span class="sc">-</span><span class="dv">1</span>, <span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb1045-40"><a href="monsters-and-mixtures.html#cb1045-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">7</span>))<span class="sc">+</span></span>
<span id="cb1045-41"><a href="monsters-and-mixtures.html#cb1045-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.ticks =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb1045-42"><a href="monsters-and-mixtures.html#cb1045-42" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">90</span>),</span>
<span id="cb1045-43"><a href="monsters-and-mixtures.html#cb1045-43" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>,</span>
<span id="cb1045-44"><a href="monsters-and-mixtures.html#cb1045-44" aria-hidden="true" tabindex="-1"></a>        <span class="at">aspect.ratio=</span><span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb1045-45"><a href="monsters-and-mixtures.html#cb1045-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">&quot;C: log-cumulative-odds&quot;</span>) <span class="ot">-&gt;</span> p5</span></code></pre></div>
<div class="sourceCode" id="cb1046"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1046-1"><a href="monsters-and-mixtures.html#cb1046-1" aria-hidden="true" tabindex="-1"></a>p3<span class="sc">+</span>p4<span class="sc">+</span>p5</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:outcome"></span>
<img src="Rethinking_Bookdown_files/figure-html/outcome-1.png" alt="トロッコ問題に対する回答。A: ヒストグラム、B: 累積確率、C: 対数累積オッズ. " width="672" />
<p class="caption">
図12.7: トロッコ問題に対する回答。A: ヒストグラム、B: 累積確率、C: 対数累積オッズ.
</p>
</div>
<p>モデリングでは、これらの対数累積オッズについての事後分布を得ることが目的なので、累積確率からそれぞれの値を得る確率を計算する必要がある。<br />
<br /></p>
<p><span class="math display">\[
p_{k} = Pr(y_{i} = k) = Pr(y_{i} \leq k) - Pr(y_{i} \leq k-1)
\]</span>
<br /></p>
<p>さて、それでは準備が整ったのでモデリングに移ろう。モデル式は累積確率を<span class="math inline">\(q_{k}\)</span>とすると以下の通り。<br />
<br /></p>
<p><span class="math display">\[
\begin{aligned}
  R_{i} &amp;\sim Categorical(P)\\
  p_{1} &amp;= q_{1}\\
  p_{k} &amp;= q_{k} - q_{k-1} \;\;\; for K&gt;k&gt;1\\
  p_{K} &amp;= 1 - q_{K-1}\\
  logit(q_{k}) &amp;= \alpha_{k} - \phi_{i}\\
  \phi_{i} &amp;= terms \;of\;linear\;model\\
  \alpha_{k} &amp;\sim Normal(0,1.5)
\end{aligned}
\]</span>
<br /></p>
<p>それではモデリングを行う。</p>
<div class="sourceCode" id="cb1047"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1047-1"><a href="monsters-and-mixtures.html#cb1047-1" aria-hidden="true" tabindex="-1"></a>inits <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="st">`</span><span class="at">Intercept[1]</span><span class="st">`</span> <span class="ot">=</span> <span class="sc">-</span><span class="dv">2</span>,</span>
<span id="cb1047-2"><a href="monsters-and-mixtures.html#cb1047-2" aria-hidden="true" tabindex="-1"></a>              <span class="st">`</span><span class="at">Intercept[2]</span><span class="st">`</span> <span class="ot">=</span> <span class="sc">-</span><span class="dv">1</span>,</span>
<span id="cb1047-3"><a href="monsters-and-mixtures.html#cb1047-3" aria-hidden="true" tabindex="-1"></a>              <span class="st">`</span><span class="at">Intercept[3]</span><span class="st">`</span> <span class="ot">=</span> <span class="dv">0</span>,</span>
<span id="cb1047-4"><a href="monsters-and-mixtures.html#cb1047-4" aria-hidden="true" tabindex="-1"></a>              <span class="st">`</span><span class="at">Intercept[4]</span><span class="st">`</span> <span class="ot">=</span> <span class="dv">1</span>,</span>
<span id="cb1047-5"><a href="monsters-and-mixtures.html#cb1047-5" aria-hidden="true" tabindex="-1"></a>              <span class="st">`</span><span class="at">Intercept[5]</span><span class="st">`</span> <span class="ot">=</span> <span class="dv">2</span>,</span>
<span id="cb1047-6"><a href="monsters-and-mixtures.html#cb1047-6" aria-hidden="true" tabindex="-1"></a>              <span class="st">`</span><span class="at">Intercept[6]</span><span class="st">`</span> <span class="ot">=</span> <span class="fl">2.5</span>)</span>
<span id="cb1047-7"><a href="monsters-and-mixtures.html#cb1047-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1047-8"><a href="monsters-and-mixtures.html#cb1047-8" aria-hidden="true" tabindex="-1"></a>inits_list <span class="ot">&lt;-</span> <span class="fu">list</span>(inits, inits, inits, inits)</span>
<span id="cb1047-9"><a href="monsters-and-mixtures.html#cb1047-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1047-10"><a href="monsters-and-mixtures.html#cb1047-10" aria-hidden="true" tabindex="-1"></a>b12<span class="fl">.4</span> <span class="ot">&lt;-</span> </span>
<span id="cb1047-11"><a href="monsters-and-mixtures.html#cb1047-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">brm</span>(<span class="at">data =</span> d4, </span>
<span id="cb1047-12"><a href="monsters-and-mixtures.html#cb1047-12" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> cumulative,</span>
<span id="cb1047-13"><a href="monsters-and-mixtures.html#cb1047-13" aria-hidden="true" tabindex="-1"></a>      response <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb1047-14"><a href="monsters-and-mixtures.html#cb1047-14" aria-hidden="true" tabindex="-1"></a>      <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">1.5</span>), <span class="at">class =</span> Intercept),</span>
<span id="cb1047-15"><a href="monsters-and-mixtures.html#cb1047-15" aria-hidden="true" tabindex="-1"></a>      <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>, <span class="at">cores =</span> <span class="dv">4</span>, <span class="at">chains =</span> <span class="dv">4</span>,</span>
<span id="cb1047-16"><a href="monsters-and-mixtures.html#cb1047-16" aria-hidden="true" tabindex="-1"></a>      <span class="at">inits =</span> inits_list,  </span>
<span id="cb1047-17"><a href="monsters-and-mixtures.html#cb1047-17" aria-hidden="true" tabindex="-1"></a>      <span class="at">file =</span> <span class="st">&quot;output/Chapter12/b12.4&quot;</span>)  </span></code></pre></div>
<p>結果は以下の通り（表<a href="monsters-and-mixtures.html#tab:res-b12-4">12.4</a>）。</p>
<div class="sourceCode" id="cb1048"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1048-1"><a href="monsters-and-mixtures.html#cb1048-1" aria-hidden="true" tabindex="-1"></a><span class="fu">posterior_samples</span>(b12<span class="fl">.4</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1048-2"><a href="monsters-and-mixtures.html#cb1048-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_all</span>(inv_logit_scaled) <span class="sc">%&gt;%</span> </span>
<span id="cb1048-3"><a href="monsters-and-mixtures.html#cb1048-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">starts_with</span>(<span class="st">&quot;b_&quot;</span>),</span>
<span id="cb1048-4"><a href="monsters-and-mixtures.html#cb1048-4" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">&quot;parameter&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1048-5"><a href="monsters-and-mixtures.html#cb1048-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(parameter) <span class="sc">%&gt;%</span> </span>
<span id="cb1048-6"><a href="monsters-and-mixtures.html#cb1048-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean =</span> <span class="fu">mean</span>(value),</span>
<span id="cb1048-7"><a href="monsters-and-mixtures.html#cb1048-7" aria-hidden="true" tabindex="-1"></a>            <span class="at">sd   =</span> <span class="fu">sd</span>(value),</span>
<span id="cb1048-8"><a href="monsters-and-mixtures.html#cb1048-8" aria-hidden="true" tabindex="-1"></a>            <span class="at">ll   =</span> <span class="fu">quantile</span>(value, <span class="at">probs =</span> .<span class="dv">025</span>),</span>
<span id="cb1048-9"><a href="monsters-and-mixtures.html#cb1048-9" aria-hidden="true" tabindex="-1"></a>            <span class="at">ul   =</span> <span class="fu">quantile</span>(value, <span class="at">probs =</span> .<span class="dv">975</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1048-10"><a href="monsters-and-mixtures.html#cb1048-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="at">digits =</span> <span class="dv">3</span>,</span>
<span id="cb1048-11"><a href="monsters-and-mixtures.html#cb1048-11" aria-hidden="true" tabindex="-1"></a>        <span class="at">booktabs =</span> <span class="cn">TRUE</span>,</span>
<span id="cb1048-12"><a href="monsters-and-mixtures.html#cb1048-12" aria-hidden="true" tabindex="-1"></a>        <span class="at">caption =</span> <span class="st">&quot;b12.4の結果。&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1048-13"><a href="monsters-and-mixtures.html#cb1048-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">latex_options =</span> <span class="fu">c</span>(<span class="st">&quot;striped&quot;</span>, <span class="st">&quot;hold_position&quot;</span>))</span></code></pre></div>
<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:res-b12-4">表12.4: </span>b12.4の結果。
</caption>
<thead>
<tr>
<th style="text-align:left;">
parameter
</th>
<th style="text-align:right;">
mean
</th>
<th style="text-align:right;">
sd
</th>
<th style="text-align:right;">
ll
</th>
<th style="text-align:right;">
ul
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
b_Intercept[1]
</td>
<td style="text-align:right;">
0.128
</td>
<td style="text-align:right;">
0.003
</td>
<td style="text-align:right;">
0.122
</td>
<td style="text-align:right;">
0.135
</td>
</tr>
<tr>
<td style="text-align:left;">
b_Intercept[2]
</td>
<td style="text-align:right;">
0.220
</td>
<td style="text-align:right;">
0.004
</td>
<td style="text-align:right;">
0.212
</td>
<td style="text-align:right;">
0.228
</td>
</tr>
<tr>
<td style="text-align:left;">
b_Intercept[3]
</td>
<td style="text-align:right;">
0.328
</td>
<td style="text-align:right;">
0.005
</td>
<td style="text-align:right;">
0.319
</td>
<td style="text-align:right;">
0.337
</td>
</tr>
<tr>
<td style="text-align:left;">
b_Intercept[4]
</td>
<td style="text-align:right;">
0.562
</td>
<td style="text-align:right;">
0.005
</td>
<td style="text-align:right;">
0.552
</td>
<td style="text-align:right;">
0.571
</td>
</tr>
<tr>
<td style="text-align:left;">
b_Intercept[5]
</td>
<td style="text-align:right;">
0.709
</td>
<td style="text-align:right;">
0.005
</td>
<td style="text-align:right;">
0.700
</td>
<td style="text-align:right;">
0.718
</td>
</tr>
<tr>
<td style="text-align:left;">
b_Intercept[6]
</td>
<td style="text-align:right;">
0.854
</td>
<td style="text-align:right;">
0.003
</td>
<td style="text-align:right;">
0.847
</td>
<td style="text-align:right;">
0.861
</td>
</tr>
</tbody>
</table>
<p>元のデータと推定結果を比較しても、かなりうまく推定できたことが分かる（表<a href="monsters-and-mixtures.html#tab:orig-data">12.5</a>）。</p>
<div class="sourceCode" id="cb1049"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1049-1"><a href="monsters-and-mixtures.html#cb1049-1" aria-hidden="true" tabindex="-1"></a>d4 <span class="sc">%&gt;%</span></span>
<span id="cb1049-2"><a href="monsters-and-mixtures.html#cb1049-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(response) <span class="sc">%&gt;%</span></span>
<span id="cb1049-3"><a href="monsters-and-mixtures.html#cb1049-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">pr_k     =</span> n <span class="sc">/</span> <span class="fu">nrow</span>(d4),</span>
<span id="cb1049-4"><a href="monsters-and-mixtures.html#cb1049-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">cum =</span> <span class="fu">cumsum</span>(pr_k)) <span class="sc">%&gt;%</span> </span>
<span id="cb1049-5"><a href="monsters-and-mixtures.html#cb1049-5" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(response, cum) <span class="sc">%&gt;%</span> </span>
<span id="cb1049-6"><a href="monsters-and-mixtures.html#cb1049-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="at">digits =</span><span class="dv">3</span>,</span>
<span id="cb1049-7"><a href="monsters-and-mixtures.html#cb1049-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">booktabs =</span> <span class="cn">TRUE</span>,</span>
<span id="cb1049-8"><a href="monsters-and-mixtures.html#cb1049-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">caption =</span> <span class="st">&quot;元データにおける累積確率&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1049-9"><a href="monsters-and-mixtures.html#cb1049-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">latex_options =</span> <span class="fu">c</span>(<span class="st">&quot;striped&quot;</span>, <span class="st">&quot;hold_position&quot;</span>))</span></code></pre></div>
<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:orig-data">表12.5: </span>元データにおける累積確率
</caption>
<thead>
<tr>
<th style="text-align:right;">
response
</th>
<th style="text-align:right;">
cum
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.128
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
0.220
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
0.328
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
0.562
</td>
</tr>
<tr>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
0.709
</td>
</tr>
<tr>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
0.854
</td>
</tr>
<tr>
<td style="text-align:right;">
7
</td>
<td style="text-align:right;">
1.000
</td>
</tr>
</tbody>
</table>
</div>
<div id="adding-predictor-variables." class="section level3 hasAnchor" number="12.3.2">
<h3><span class="header-section-number">12.3.2</span> Adding predictor variables.<a href="monsters-and-mixtures.html#adding-predictor-variables." class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>説明変数を加えるためには、それぞれの値<span class="math inline">\(k\)</span>について対数累積オッズを以下のようにあらわす。このとき、<span class="math inline">\(\beta\)</span>が増えるほど対数累積オッズも増えることに注意。<br />
<br /></p>
<p><span class="math display">\[
\begin{aligned}
log \frac{Pr(y_{i} \leq k )}{1 - Pr(y_{i} \leq k)} &amp;= \alpha_{k} -\phi_{i}  \\
\phi_{i} &amp;= \beta x_{i}
\end{aligned}
\]</span>
<br /></p>
<p>contactには、actionも伴う。そのため、このデータではcontactとactionを互いに排他的な変数としており、contactとactionを同時に調べることはしていない。よって、条件は以下の6つの場合に分かれるはずである。<br />
(1) No action, contact, or intention<br />
(2) Action only<br />
(3) Intention only<br />
(4) Contact only<br />
(5) Action and intention<br />
(6) Contact and intention</p>
<p>よって以下のようなモデル式になる。<br />
<br /></p>
<p><span class="math display">\[
\begin{aligned}
  R_{i} &amp;\sim Categorical(P)\\
  p_{1} &amp;= q_{1}\\
  p_{k} &amp;= q_{k} - q_{k-1} \;\;\; for K&gt;k&gt;1\\
  p_{K} &amp;= 1 - q_{K-1}\\
  logit(q_{k}) &amp;= \alpha_{k} - \phi_{i}\\
  \phi_{i} &amp;= \beta_{1}action_{i} + \beta_{2}contact_{i} +(\beta_{3} +\beta_{4}action_{i} + \beta_{5} contact_{i})intention_{i}  \\
  \alpha_{k} &amp;\sim Normal(0,1.5)\\
  \beta_{1},...,\beta_{5} &amp;\sim Normal(0,0.5)
\end{aligned}
\]</span>
<br /></p>
<p>それでは、モデリングを行う。</p>
<div class="sourceCode" id="cb1050"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1050-1"><a href="monsters-and-mixtures.html#cb1050-1" aria-hidden="true" tabindex="-1"></a>b12<span class="fl">.5</span> <span class="ot">&lt;-</span> </span>
<span id="cb1050-2"><a href="monsters-and-mixtures.html#cb1050-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">brm</span>(<span class="at">data =</span> d4, </span>
<span id="cb1050-3"><a href="monsters-and-mixtures.html#cb1050-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> cumulative,</span>
<span id="cb1050-4"><a href="monsters-and-mixtures.html#cb1050-4" aria-hidden="true" tabindex="-1"></a>      response <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> action <span class="sc">+</span> contact <span class="sc">+</span> intention <span class="sc">+</span> intention<span class="sc">:</span>action <span class="sc">+</span> intention<span class="sc">:</span>contact,</span>
<span id="cb1050-5"><a href="monsters-and-mixtures.html#cb1050-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">1.5</span>), <span class="at">class =</span> Intercept),</span>
<span id="cb1050-6"><a href="monsters-and-mixtures.html#cb1050-6" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">0.5</span>), <span class="at">class =</span> b)),</span>
<span id="cb1050-7"><a href="monsters-and-mixtures.html#cb1050-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>, <span class="at">cores =</span> <span class="dv">4</span>, <span class="at">chains =</span> <span class="dv">4</span>,</span>
<span id="cb1050-8"><a href="monsters-and-mixtures.html#cb1050-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">seed =</span> <span class="dv">12</span>,</span>
<span id="cb1050-9"><a href="monsters-and-mixtures.html#cb1050-9" aria-hidden="true" tabindex="-1"></a>       <span class="at">backend =</span> <span class="st">&quot;cmdstanr&quot;</span>,</span>
<span id="cb1050-10"><a href="monsters-and-mixtures.html#cb1050-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">file =</span> <span class="st">&quot;output/Chapter12/b12.5&quot;</span>)</span></code></pre></div>
<p>結果は以下の通り（表<a href="monsters-and-mixtures.html#tab:res-b12-5">12.6</a>）。全ての係数は負なので、いずれの場合も物語への許容性が下がることが分かる。また、<span class="math inline">\(\beta_{5}\)</span>すなわち、意図的かつアクションが伴う場合に倫理的評価はもっとも下がることが分かる（図<a href="monsters-and-mixtures.html#fig:b12-5">12.8</a>）。これは、intentionとaction単体ではそこまで大きく影響しないことを考えれば興味深い。</p>
<div class="sourceCode" id="cb1051"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1051-1"><a href="monsters-and-mixtures.html#cb1051-1" aria-hidden="true" tabindex="-1"></a>labs <span class="ot">&lt;-</span> <span class="fu">str_c</span>(<span class="st">&quot;beta[&quot;</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>, <span class="st">&quot;]&quot;</span>)</span>
<span id="cb1051-2"><a href="monsters-and-mixtures.html#cb1051-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1051-3"><a href="monsters-and-mixtures.html#cb1051-3" aria-hidden="true" tabindex="-1"></a><span class="fu">fixef</span>(b12<span class="fl">.5</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1051-4"><a href="monsters-and-mixtures.html#cb1051-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1051-5"><a href="monsters-and-mixtures.html#cb1051-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="at">digits =</span> <span class="dv">2</span>,</span>
<span id="cb1051-6"><a href="monsters-and-mixtures.html#cb1051-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">booktabs =</span> <span class="cn">TRUE</span>,</span>
<span id="cb1051-7"><a href="monsters-and-mixtures.html#cb1051-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">caption =</span> <span class="st">&quot;b12-5の結果&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1051-8"><a href="monsters-and-mixtures.html#cb1051-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">latex_options =</span> <span class="fu">c</span>(<span class="st">&quot;striped&quot;</span>, <span class="st">&quot;hold_position&quot;</span>))</span></code></pre></div>
<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:res-b12-5">表12.6: </span>b12-5の結果
</caption>
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
Estimate
</th>
<th style="text-align:right;">
Est.Error
</th>
<th style="text-align:right;">
Q2.5
</th>
<th style="text-align:right;">
Q97.5
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Intercept[1]
</td>
<td style="text-align:right;">
-2.64
</td>
<td style="text-align:right;">
0.05
</td>
<td style="text-align:right;">
-2.74
</td>
<td style="text-align:right;">
-2.54
</td>
</tr>
<tr>
<td style="text-align:left;">
Intercept[2]
</td>
<td style="text-align:right;">
-1.94
</td>
<td style="text-align:right;">
0.05
</td>
<td style="text-align:right;">
-2.04
</td>
<td style="text-align:right;">
-1.85
</td>
</tr>
<tr>
<td style="text-align:left;">
Intercept[3]
</td>
<td style="text-align:right;">
-1.35
</td>
<td style="text-align:right;">
0.05
</td>
<td style="text-align:right;">
-1.44
</td>
<td style="text-align:right;">
-1.26
</td>
</tr>
<tr>
<td style="text-align:left;">
Intercept[4]
</td>
<td style="text-align:right;">
-0.31
</td>
<td style="text-align:right;">
0.04
</td>
<td style="text-align:right;">
-0.40
</td>
<td style="text-align:right;">
-0.23
</td>
</tr>
<tr>
<td style="text-align:left;">
Intercept[5]
</td>
<td style="text-align:right;">
0.36
</td>
<td style="text-align:right;">
0.04
</td>
<td style="text-align:right;">
0.27
</td>
<td style="text-align:right;">
0.45
</td>
</tr>
<tr>
<td style="text-align:left;">
Intercept[6]
</td>
<td style="text-align:right;">
1.26
</td>
<td style="text-align:right;">
0.05
</td>
<td style="text-align:right;">
1.17
</td>
<td style="text-align:right;">
1.36
</td>
</tr>
<tr>
<td style="text-align:left;">
action
</td>
<td style="text-align:right;">
-0.48
</td>
<td style="text-align:right;">
0.05
</td>
<td style="text-align:right;">
-0.58
</td>
<td style="text-align:right;">
-0.37
</td>
</tr>
<tr>
<td style="text-align:left;">
contact
</td>
<td style="text-align:right;">
-0.34
</td>
<td style="text-align:right;">
0.07
</td>
<td style="text-align:right;">
-0.48
</td>
<td style="text-align:right;">
-0.21
</td>
</tr>
<tr>
<td style="text-align:left;">
intention
</td>
<td style="text-align:right;">
-0.29
</td>
<td style="text-align:right;">
0.06
</td>
<td style="text-align:right;">
-0.41
</td>
<td style="text-align:right;">
-0.18
</td>
</tr>
<tr>
<td style="text-align:left;">
action:intention
</td>
<td style="text-align:right;">
-0.43
</td>
<td style="text-align:right;">
0.08
</td>
<td style="text-align:right;">
-0.59
</td>
<td style="text-align:right;">
-0.27
</td>
</tr>
<tr>
<td style="text-align:left;">
contact:intention
</td>
<td style="text-align:right;">
-1.23
</td>
<td style="text-align:right;">
0.10
</td>
<td style="text-align:right;">
-1.42
</td>
<td style="text-align:right;">
-1.04
</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb1052"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1052-1"><a href="monsters-and-mixtures.html#cb1052-1" aria-hidden="true" tabindex="-1"></a>labs <span class="ot">&lt;-</span> <span class="fu">str_c</span>(<span class="st">&quot;beta[&quot;</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>, <span class="st">&quot;]&quot;</span>)</span>
<span id="cb1052-2"><a href="monsters-and-mixtures.html#cb1052-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1052-3"><a href="monsters-and-mixtures.html#cb1052-3" aria-hidden="true" tabindex="-1"></a><span class="fu">posterior_samples</span>(b12<span class="fl">.5</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1052-4"><a href="monsters-and-mixtures.html#cb1052-4" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(b_action<span class="sc">:</span><span class="st">`</span><span class="at">b_contact:intention</span><span class="st">`</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1052-5"><a href="monsters-and-mixtures.html#cb1052-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_names</span>(labs) <span class="sc">%&gt;%</span> </span>
<span id="cb1052-6"><a href="monsters-and-mixtures.html#cb1052-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">everything</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb1052-7"><a href="monsters-and-mixtures.html#cb1052-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> value, <span class="at">y =</span> name)) <span class="sc">+</span></span>
<span id="cb1052-8"><a href="monsters-and-mixtures.html#cb1052-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>, <span class="at">linetype =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb1052-9"><a href="monsters-and-mixtures.html#cb1052-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_gradientinterval</span>(<span class="at">.width =</span> .<span class="dv">5</span>, <span class="at">size =</span> <span class="dv">1</span>, </span>
<span id="cb1052-10"><a href="monsters-and-mixtures.html#cb1052-10" aria-hidden="true" tabindex="-1"></a>                        <span class="at">point_size =</span> <span class="dv">3</span>, <span class="at">shape =</span> <span class="dv">21</span>,</span>
<span id="cb1052-11"><a href="monsters-and-mixtures.html#cb1052-11" aria-hidden="true" tabindex="-1"></a>                        <span class="at">point_fill =</span> <span class="st">&quot;khaki4&quot;</span>, </span>
<span id="cb1052-12"><a href="monsters-and-mixtures.html#cb1052-12" aria-hidden="true" tabindex="-1"></a>                        <span class="at">fill =</span> <span class="st">&quot;khaki2&quot;</span>, </span>
<span id="cb1052-13"><a href="monsters-and-mixtures.html#cb1052-13" aria-hidden="true" tabindex="-1"></a>                        <span class="at">color =</span> <span class="st">&quot;khaki2&quot;</span>) <span class="sc">+</span></span>
<span id="cb1052-14"><a href="monsters-and-mixtures.html#cb1052-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="st">&quot;marginal posterior&quot;</span>, <span class="at">breaks =</span> <span class="sc">-</span><span class="dv">5</span><span class="sc">:</span><span class="dv">0</span> <span class="sc">/</span> <span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb1052-15"><a href="monsters-and-mixtures.html#cb1052-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_discrete</span>(<span class="cn">NULL</span>, <span class="at">labels =</span> <span class="fu">parse</span>(<span class="at">text =</span> labs)) <span class="sc">+</span></span>
<span id="cb1052-16"><a href="monsters-and-mixtures.html#cb1052-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">1.4</span>, <span class="dv">0</span>))</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:b12-5"></span>
<img src="Rethinking_Bookdown_files/figure-html/b12-5-1.png" alt="係数の事後平均と95%信用区間" width="672" />
<p class="caption">
図12.8: 係数の事後平均と95%信用区間
</p>
</div>
<p>それでは、結果を図示していく。</p>
<div class="sourceCode" id="cb1053"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1053-1"><a href="monsters-and-mixtures.html#cb1053-1" aria-hidden="true" tabindex="-1"></a>nd <span class="ot">&lt;-</span> </span>
<span id="cb1053-2"><a href="monsters-and-mixtures.html#cb1053-2" aria-hidden="true" tabindex="-1"></a>  d4 <span class="sc">%&gt;%</span> </span>
<span id="cb1053-3"><a href="monsters-and-mixtures.html#cb1053-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(action, contact, intention) <span class="sc">%&gt;%</span> </span>
<span id="cb1053-4"><a href="monsters-and-mixtures.html#cb1053-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">combination =</span> <span class="fu">str_c</span>(action, contact, intention, <span class="at">sep =</span> <span class="st">&quot;_&quot;</span>))</span>
<span id="cb1053-5"><a href="monsters-and-mixtures.html#cb1053-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1053-6"><a href="monsters-and-mixtures.html#cb1053-6" aria-hidden="true" tabindex="-1"></a>f12<span class="fl">.5</span> <span class="ot">&lt;-</span> <span class="fu">fitted</span>(b12<span class="fl">.5</span>, nd, <span class="at">summary=</span>F)</span></code></pre></div>
<div class="sourceCode" id="cb1054"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1054-1"><a href="monsters-and-mixtures.html#cb1054-1" aria-hidden="true" tabindex="-1"></a>f <span class="ot">&lt;-</span> <span class="fu">rbind</span>(f12<span class="fl">.5</span>[,,<span class="dv">1</span>],</span>
<span id="cb1054-2"><a href="monsters-and-mixtures.html#cb1054-2" aria-hidden="true" tabindex="-1"></a>           f12<span class="fl">.5</span>[,,<span class="dv">2</span>],</span>
<span id="cb1054-3"><a href="monsters-and-mixtures.html#cb1054-3" aria-hidden="true" tabindex="-1"></a>           f12<span class="fl">.5</span>[,,<span class="dv">3</span>],</span>
<span id="cb1054-4"><a href="monsters-and-mixtures.html#cb1054-4" aria-hidden="true" tabindex="-1"></a>           f12<span class="fl">.5</span>[,,<span class="dv">4</span>],</span>
<span id="cb1054-5"><a href="monsters-and-mixtures.html#cb1054-5" aria-hidden="true" tabindex="-1"></a>           f12<span class="fl">.5</span>[,,<span class="dv">5</span>],</span>
<span id="cb1054-6"><a href="monsters-and-mixtures.html#cb1054-6" aria-hidden="true" tabindex="-1"></a>           f12<span class="fl">.5</span>[,,<span class="dv">6</span>],</span>
<span id="cb1054-7"><a href="monsters-and-mixtures.html#cb1054-7" aria-hidden="true" tabindex="-1"></a>           f12<span class="fl">.5</span>[,,<span class="dv">7</span>]) <span class="sc">%&gt;%</span> </span>
<span id="cb1054-8"><a href="monsters-and-mixtures.html#cb1054-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1054-9"><a href="monsters-and-mixtures.html#cb1054-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_names</span>(<span class="fu">pull</span>(nd, combination)) <span class="sc">%&gt;%</span> </span>
<span id="cb1054-10"><a href="monsters-and-mixtures.html#cb1054-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">response =</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">7</span>, <span class="at">each =</span> <span class="fu">n</span>()<span class="sc">/</span><span class="dv">7</span>),</span>
<span id="cb1054-11"><a href="monsters-and-mixtures.html#cb1054-11" aria-hidden="true" tabindex="-1"></a>         <span class="at">iter =</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">4000</span>, <span class="at">times=</span><span class="dv">7</span>))  <span class="sc">%&gt;%</span> </span>
<span id="cb1054-12"><a href="monsters-and-mixtures.html#cb1054-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span><span class="fu">c</span>(iter,response),</span>
<span id="cb1054-13"><a href="monsters-and-mixtures.html#cb1054-13" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="fu">c</span>(<span class="st">&quot;action&quot;</span>, <span class="st">&quot;contact&quot;</span>, <span class="st">&quot;intention&quot;</span>),</span>
<span id="cb1054-14"><a href="monsters-and-mixtures.html#cb1054-14" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_sep =</span> <span class="st">&quot;_&quot;</span>,</span>
<span id="cb1054-15"><a href="monsters-and-mixtures.html#cb1054-15" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">&quot;pk&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1054-16"><a href="monsters-and-mixtures.html#cb1054-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">intention =</span> intention <span class="sc">%&gt;%</span> <span class="fu">as.integer</span>())</span></code></pre></div>
<div class="sourceCode" id="cb1055"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1055-1"><a href="monsters-and-mixtures.html#cb1055-1" aria-hidden="true" tabindex="-1"></a>levels <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;action=0, contact=0&quot;</span>, <span class="st">&quot;action=1, contact=0&quot;</span>, <span class="st">&quot;action=0, contact=1&quot;</span>)</span>
<span id="cb1055-2"><a href="monsters-and-mixtures.html#cb1055-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1055-3"><a href="monsters-and-mixtures.html#cb1055-3" aria-hidden="true" tabindex="-1"></a><span class="do">## 各条件ごとの確率</span></span>
<span id="cb1055-4"><a href="monsters-and-mixtures.html#cb1055-4" aria-hidden="true" tabindex="-1"></a>f <span class="sc">%&gt;%</span> </span>
<span id="cb1055-5"><a href="monsters-and-mixtures.html#cb1055-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(response <span class="sc">&lt;</span><span class="dv">7</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1055-6"><a href="monsters-and-mixtures.html#cb1055-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">facet =</span> <span class="fu">factor</span>(<span class="fu">str_c</span>(<span class="st">&quot;action=&quot;</span>, action, <span class="st">&quot;, contact=&quot;</span>, contact), <span class="at">levels =</span> levels)) <span class="sc">%&gt;%</span> </span>
<span id="cb1055-7"><a href="monsters-and-mixtures.html#cb1055-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(iter, facet, intention) <span class="sc">%&gt;%</span> </span>
<span id="cb1055-8"><a href="monsters-and-mixtures.html#cb1055-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(iter, facet, intention, response) <span class="sc">%&gt;%</span> </span>
<span id="cb1055-9"><a href="monsters-and-mixtures.html#cb1055-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prob =</span> <span class="fu">cumsum</span>(pk)) <span class="sc">%&gt;%</span> </span>
<span id="cb1055-10"><a href="monsters-and-mixtures.html#cb1055-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1055-11"><a href="monsters-and-mixtures.html#cb1055-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">nest</span>(<span class="at">data=</span><span class="sc">-</span>iter) <span class="sc">%&gt;%</span> </span>
<span id="cb1055-12"><a href="monsters-and-mixtures.html#cb1055-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_sample</span>(<span class="at">n=</span><span class="dv">50</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1055-13"><a href="monsters-and-mixtures.html#cb1055-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(data) <span class="sc">%&gt;%</span> </span>
<span id="cb1055-14"><a href="monsters-and-mixtures.html#cb1055-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> intention, <span class="at">y =</span> prob)) <span class="sc">+</span></span>
<span id="cb1055-15"><a href="monsters-and-mixtures.html#cb1055-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">group =</span> <span class="fu">interaction</span>(iter, response), </span>
<span id="cb1055-16"><a href="monsters-and-mixtures.html#cb1055-16" aria-hidden="true" tabindex="-1"></a>                <span class="at">color =</span> prob),<span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">10</span>) <span class="sc">+</span></span>
<span id="cb1055-17"><a href="monsters-and-mixtures.html#cb1055-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> d4 <span class="sc">%&gt;%</span>  </span>
<span id="cb1055-18"><a href="monsters-and-mixtures.html#cb1055-18" aria-hidden="true" tabindex="-1"></a>               <span class="fu">group_by</span>(intention, contact, action) <span class="sc">%&gt;%</span> </span>
<span id="cb1055-19"><a href="monsters-and-mixtures.html#cb1055-19" aria-hidden="true" tabindex="-1"></a>               <span class="fu">count</span>(response) <span class="sc">%&gt;%</span> </span>
<span id="cb1055-20"><a href="monsters-and-mixtures.html#cb1055-20" aria-hidden="true" tabindex="-1"></a>               <span class="fu">mutate</span>(<span class="at">prob =</span> <span class="fu">cumsum</span>(n <span class="sc">/</span> <span class="fu">sum</span>(n)),</span>
<span id="cb1055-21"><a href="monsters-and-mixtures.html#cb1055-21" aria-hidden="true" tabindex="-1"></a>                      <span class="at">facet =</span> <span class="fu">factor</span>(</span>
<span id="cb1055-22"><a href="monsters-and-mixtures.html#cb1055-22" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">str_c</span>(<span class="st">&quot;action=&quot;</span>, action, <span class="st">&quot;, contact=&quot;</span>, contact), </span>
<span id="cb1055-23"><a href="monsters-and-mixtures.html#cb1055-23" aria-hidden="true" tabindex="-1"></a>                        <span class="at">levels =</span> levels)) <span class="sc">%&gt;%</span> </span>
<span id="cb1055-24"><a href="monsters-and-mixtures.html#cb1055-24" aria-hidden="true" tabindex="-1"></a>               <span class="fu">filter</span>(response <span class="sc">&lt;</span> <span class="dv">7</span>),</span>
<span id="cb1055-25"><a href="monsters-and-mixtures.html#cb1055-25" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> <span class="st">&quot;olivedrab3&quot;</span>) <span class="sc">+</span></span>
<span id="cb1055-26"><a href="monsters-and-mixtures.html#cb1055-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_gradient</span>(<span class="at">low =</span> <span class="st">&quot;olivedrab4&quot;</span>,</span>
<span id="cb1055-27"><a href="monsters-and-mixtures.html#cb1055-27" aria-hidden="true" tabindex="-1"></a>                       <span class="at">high =</span> <span class="st">&quot;olivedrab1&quot;</span>) <span class="sc">+</span></span>
<span id="cb1055-28"><a href="monsters-and-mixtures.html#cb1055-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="st">&quot;intention&quot;</span>, <span class="at">breaks =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb1055-29"><a href="monsters-and-mixtures.html#cb1055-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>, .<span class="dv">5</span>, <span class="dv">1</span>), <span class="at">limits =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb1055-30"><a href="monsters-and-mixtures.html#cb1055-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>,</span>
<span id="cb1055-31"><a href="monsters-and-mixtures.html#cb1055-31" aria-hidden="true" tabindex="-1"></a>        <span class="at">strip.background =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb1055-32"><a href="monsters-and-mixtures.html#cb1055-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> facet) <span class="ot">-&gt;</span> p6</span>
<span id="cb1055-33"><a href="monsters-and-mixtures.html#cb1055-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1055-34"><a href="monsters-and-mixtures.html#cb1055-34" aria-hidden="true" tabindex="-1"></a><span class="do">## 予測分布</span></span>
<span id="cb1055-35"><a href="monsters-and-mixtures.html#cb1055-35" aria-hidden="true" tabindex="-1"></a>predict <span class="ot">&lt;-</span> <span class="fu">predict</span>(b12<span class="fl">.5</span>, nd, <span class="at">scale=</span><span class="st">&quot;response&quot;</span>, <span class="at">summary=</span>F) </span>
<span id="cb1055-36"><a href="monsters-and-mixtures.html#cb1055-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1055-37"><a href="monsters-and-mixtures.html#cb1055-37" aria-hidden="true" tabindex="-1"></a>predict <span class="sc">%&gt;%</span> </span>
<span id="cb1055-38"><a href="monsters-and-mixtures.html#cb1055-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1055-39"><a href="monsters-and-mixtures.html#cb1055-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_names</span>(<span class="fu">pull</span>(nd, combination)) <span class="sc">%&gt;%</span> </span>
<span id="cb1055-40"><a href="monsters-and-mixtures.html#cb1055-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">everything</span>(),</span>
<span id="cb1055-41"><a href="monsters-and-mixtures.html#cb1055-41" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="fu">c</span>(<span class="st">&quot;action&quot;</span>, <span class="st">&quot;contact&quot;</span>, <span class="st">&quot;intention&quot;</span>),</span>
<span id="cb1055-42"><a href="monsters-and-mixtures.html#cb1055-42" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_sep =</span> <span class="st">&quot;_&quot;</span>,</span>
<span id="cb1055-43"><a href="monsters-and-mixtures.html#cb1055-43" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">&quot;response&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1055-44"><a href="monsters-and-mixtures.html#cb1055-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">facet =</span> <span class="fu">factor</span>(<span class="fu">str_c</span>(<span class="st">&quot;action=&quot;</span>, action, </span>
<span id="cb1055-45"><a href="monsters-and-mixtures.html#cb1055-45" aria-hidden="true" tabindex="-1"></a>                              <span class="st">&quot;, contact=&quot;</span>, contact),</span>
<span id="cb1055-46"><a href="monsters-and-mixtures.html#cb1055-46" aria-hidden="true" tabindex="-1"></a>                        <span class="at">levels =</span> levels)) <span class="sc">%&gt;%</span> </span>
<span id="cb1055-47"><a href="monsters-and-mixtures.html#cb1055-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> response, <span class="at">fill =</span> intention)) <span class="sc">+</span></span>
<span id="cb1055-48"><a href="monsters-and-mixtures.html#cb1055-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">width =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">3</span>, <span class="at">position =</span> <span class="fu">position_dodge</span>(<span class="at">width =</span> .<span class="dv">4</span>)) <span class="sc">+</span></span>
<span id="cb1055-49"><a href="monsters-and-mixtures.html#cb1055-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;black&quot;</span>, <span class="st">&quot;navy&quot;</span>)) <span class="sc">+</span></span>
<span id="cb1055-50"><a href="monsters-and-mixtures.html#cb1055-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="st">&quot;response&quot;</span>, <span class="at">breaks =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">7</span>) <span class="sc">+</span></span>
<span id="cb1055-51"><a href="monsters-and-mixtures.html#cb1055-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>,</span>
<span id="cb1055-52"><a href="monsters-and-mixtures.html#cb1055-52" aria-hidden="true" tabindex="-1"></a>        <span class="at">strip.background =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb1055-53"><a href="monsters-and-mixtures.html#cb1055-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> facet) <span class="ot">-&gt;</span> p7</span></code></pre></div>
<p>結果は以下の通り（図<a href="monsters-and-mixtures.html#fig:b12-5-2">12.9</a>）。</p>
<div class="sourceCode" id="cb1056"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1056-1"><a href="monsters-and-mixtures.html#cb1056-1" aria-hidden="true" tabindex="-1"></a>p6<span class="sc">/</span>p7</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:b12-5-2"></span>
<img src="Rethinking_Bookdown_files/figure-html/b12-5-2-1.png" alt="モデルb12.5の推定結果。各プロットは、intentionの有無によってどのように回答が変わるかを示している。上段はそれぞれの事後累積確率を、下段はモデルから予測される回答の分布を図示している。なお、下段で黒はintentionが0のときを、青はintentionが1のときを示している。 \label{fig.b12.5_2}" width="672" />
<p class="caption">
図12.9: モデルb12.5の推定結果。各プロットは、intentionの有無によってどのように回答が変わるかを示している。上段はそれぞれの事後累積確率を、下段はモデルから予測される回答の分布を図示している。なお、下段で黒はintentionが0のときを、青はintentionが1のときを示している。
</p>
</div>
</div>
</div>
<div id="ordered-categorical-predictors" class="section level2 hasAnchor" number="12.4">
<h2><span class="header-section-number">12.4</span> Ordered categorical predictors<a href="monsters-and-mixtures.html#ordered-categorical-predictors" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>説明変数にカテゴリカルな順序尺度を用いることもできる。先ほどのトロッコ問題のデータでは、回答者の最終学歴が変数として格納されている（表<a href="monsters-and-mixtures.html#tab:edu">12.7</a>）。順番が教育の程度とは対応していないので、順番を付け直している。それぞれの値の間の差は等間隔ではないので、連続変数としてはモデリングできない。</p>
<div class="sourceCode" id="cb1057"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1057-1"><a href="monsters-and-mixtures.html#cb1057-1" aria-hidden="true" tabindex="-1"></a>d4 <span class="ot">&lt;-</span>d4 <span class="sc">%&gt;%</span> </span>
<span id="cb1057-2"><a href="monsters-and-mixtures.html#cb1057-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">edu_new =</span> </span>
<span id="cb1057-3"><a href="monsters-and-mixtures.html#cb1057-3" aria-hidden="true" tabindex="-1"></a>           <span class="fu">recode</span>(edu,</span>
<span id="cb1057-4"><a href="monsters-and-mixtures.html#cb1057-4" aria-hidden="true" tabindex="-1"></a>                  <span class="st">&quot;Elementary School&quot;</span> <span class="ot">=</span> <span class="dv">1</span>,</span>
<span id="cb1057-5"><a href="monsters-and-mixtures.html#cb1057-5" aria-hidden="true" tabindex="-1"></a>                  <span class="st">&quot;Middle School&quot;</span> <span class="ot">=</span> <span class="dv">2</span>,</span>
<span id="cb1057-6"><a href="monsters-and-mixtures.html#cb1057-6" aria-hidden="true" tabindex="-1"></a>                  <span class="st">&quot;Some High School&quot;</span> <span class="ot">=</span> <span class="dv">3</span>,</span>
<span id="cb1057-7"><a href="monsters-and-mixtures.html#cb1057-7" aria-hidden="true" tabindex="-1"></a>                  <span class="st">&quot;High School Graduate&quot;</span> <span class="ot">=</span> <span class="dv">4</span>,</span>
<span id="cb1057-8"><a href="monsters-and-mixtures.html#cb1057-8" aria-hidden="true" tabindex="-1"></a>                  <span class="st">&quot;Some College&quot;</span> <span class="ot">=</span> <span class="dv">5</span>, </span>
<span id="cb1057-9"><a href="monsters-and-mixtures.html#cb1057-9" aria-hidden="true" tabindex="-1"></a>                  <span class="st">&quot;Bachelor&#39;s Degree&quot;</span> <span class="ot">=</span> <span class="dv">6</span>,</span>
<span id="cb1057-10"><a href="monsters-and-mixtures.html#cb1057-10" aria-hidden="true" tabindex="-1"></a>                  <span class="st">&quot;Master&#39;s Degree&quot;</span> <span class="ot">=</span> <span class="dv">7</span>,</span>
<span id="cb1057-11"><a href="monsters-and-mixtures.html#cb1057-11" aria-hidden="true" tabindex="-1"></a>                  <span class="st">&quot;Graduate Degree&quot;</span> <span class="ot">=</span> <span class="dv">8</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1057-12"><a href="monsters-and-mixtures.html#cb1057-12" aria-hidden="true" tabindex="-1"></a>           <span class="fu">as.integer</span>())</span></code></pre></div>
<div class="sourceCode" id="cb1058"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1058-1"><a href="monsters-and-mixtures.html#cb1058-1" aria-hidden="true" tabindex="-1"></a>d4 <span class="sc">%&gt;%</span> </span>
<span id="cb1058-2"><a href="monsters-and-mixtures.html#cb1058-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(edu, edu_new) <span class="sc">%&gt;%</span> </span>
<span id="cb1058-3"><a href="monsters-and-mixtures.html#cb1058-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(edu_new) <span class="sc">%&gt;%</span> </span>
<span id="cb1058-4"><a href="monsters-and-mixtures.html#cb1058-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="at">booktabs =</span> <span class="cn">TRUE</span>,</span>
<span id="cb1058-5"><a href="monsters-and-mixtures.html#cb1058-5" aria-hidden="true" tabindex="-1"></a>        <span class="at">align =</span> <span class="st">&quot;lc&quot;</span>,</span>
<span id="cb1058-6"><a href="monsters-and-mixtures.html#cb1058-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">caption =</span> <span class="st">&quot;`Trolley`に含まれる回答者の学歴&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1058-7"><a href="monsters-and-mixtures.html#cb1058-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">latex_options =</span> <span class="st">&quot;stripe&quot;</span>)</span></code></pre></div>
<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:edu">表12.7: </span><code>Trolley</code>に含まれる回答者の学歴
</caption>
<thead>
<tr>
<th style="text-align:left;">
edu
</th>
<th style="text-align:center;">
edu_new
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Elementary School
</td>
<td style="text-align:center;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
Middle School
</td>
<td style="text-align:center;">
2
</td>
</tr>
<tr>
<td style="text-align:left;">
Some High School
</td>
<td style="text-align:center;">
3
</td>
</tr>
<tr>
<td style="text-align:left;">
High School Graduate
</td>
<td style="text-align:center;">
4
</td>
</tr>
<tr>
<td style="text-align:left;">
Some College
</td>
<td style="text-align:center;">
5
</td>
</tr>
<tr>
<td style="text-align:left;">
Bachelor’s Degree
</td>
<td style="text-align:center;">
6
</td>
</tr>
<tr>
<td style="text-align:left;">
Master’s Degree
</td>
<td style="text-align:center;">
7
</td>
</tr>
<tr>
<td style="text-align:left;">
Graduate Degree
</td>
<td style="text-align:center;">
8
</td>
</tr>
</tbody>
</table>
<p>そこで、実際のモデリングでは1つ教育の程度ががるたびの増分をパラメータとして組み込む。例えば、以下の式で<span class="math inline">\(\delta_{1}\)</span>は小学校から中学校に上がるときの増分、<span class="math inline">\(\delta_{2}\)</span>は中学校から高校中退に上がるときの増分を示す。<br />
<br /></p>
<p><span class="math display">\[
\begin{aligned}
\phi_{i} &amp;= \delta_{1} + ... + \delta_{7} + other \; stuff\\
         &amp;= \sum^{7}_{j=1} \delta_{j} + other \; stuff
\end{aligned}
\]</span>
<br /></p>
<p>特定の人<em>i</em>について<span class="math inline">\(\phi_{i}\)</span>を以下のように定める。なお、<span class="math inline">\(E_{i}\)</span>はその人の最終学歴を、<span class="math inline">\(\delta_{j}\)</span>はすべてを足し合わせると1になるとする。つまり、<span class="math inline">\(\\beta_{E}\)</span>は学歴が与える最大の効果（博士課程を卒業した人の効果）を表している。<br />
<br /></p>
<p><span class="math display">\[
\phi_{i} = \beta_{E}\sum^{E_{i}-1}_{j=0} \delta_{j} + other \; stuff
\]</span>
<br /></p>
<p>以下のようなモデルを考える。今回は交互作用は考えない。<br />
<br /></p>
<p><span class="math display">\[
\begin{aligned}
  R_{i} &amp;\sim Ordered\;logit(\phi_{i},\kappa)\\
  \phi_{i} &amp;=  \beta_{E}\sum^{E_{i}-1}_{j=0} \delta_{j} +\beta_{1}action_{i} + \beta_{2}contact_{i} +\beta_{3}intention_{i}  \\
  \kappa_{k} &amp;\sim Normal(0,1.5)\\
  \beta_{1},\beta_{2},\beta_{3},\beta_{E} &amp;\sim Normal(0,1)\\
  \delta &amp;\sim Dirichlet(\alpha)
\end{aligned}
\]</span>
<br /></p>
<p>ディリクレ分布とは、ベータ分布の3変量以上のバージョンであり、パラメータベクトル<span class="math inline">\(\alpha\)</span>によって分布の形が変わる。図<a href="monsters-and-mixtures.html#fig:dirichlet">12.10</a>は、<span class="math inline">\(\alpha = \{2,2,2,2,2,2,2\}\)</span>で10回シミュレーションを行った結果。</p>
<div class="sourceCode" id="cb1059"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1059-1"><a href="monsters-and-mixtures.html#cb1059-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gtools)</span>
<span id="cb1059-2"><a href="monsters-and-mixtures.html#cb1059-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1805</span>)</span>
<span id="cb1059-3"><a href="monsters-and-mixtures.html#cb1059-3" aria-hidden="true" tabindex="-1"></a>delta <span class="ot">&lt;-</span> <span class="fu">rdirichlet</span>(<span class="dv">10</span>, <span class="at">alpha =</span> <span class="fu">rep</span>(<span class="dv">2</span>, <span class="dv">7</span>)) </span>
<span id="cb1059-4"><a href="monsters-and-mixtures.html#cb1059-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1059-5"><a href="monsters-and-mixtures.html#cb1059-5" aria-hidden="true" tabindex="-1"></a>delta <span class="sc">%&gt;%</span> </span>
<span id="cb1059-6"><a href="monsters-and-mixtures.html#cb1059-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1059-7"><a href="monsters-and-mixtures.html#cb1059-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_names</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">7</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1059-8"><a href="monsters-and-mixtures.html#cb1059-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">row =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">n</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb1059-9"><a href="monsters-and-mixtures.html#cb1059-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span>row, <span class="at">names_to =</span> <span class="st">&quot;index&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1059-10"><a href="monsters-and-mixtures.html#cb1059-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> index, <span class="at">y =</span> value, <span class="at">group =</span> row,</span>
<span id="cb1059-11"><a href="monsters-and-mixtures.html#cb1059-11" aria-hidden="true" tabindex="-1"></a>             <span class="at">alpha =</span> row <span class="sc">==</span> <span class="dv">3</span>, <span class="at">color =</span> row <span class="sc">==</span> <span class="dv">3</span>)) <span class="sc">+</span></span>
<span id="cb1059-12"><a href="monsters-and-mixtures.html#cb1059-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb1059-13"><a href="monsters-and-mixtures.html#cb1059-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb1059-14"><a href="monsters-and-mixtures.html#cb1059-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_alpha_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">3</span>, <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb1059-15"><a href="monsters-and-mixtures.html#cb1059-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;olivedrab3&quot;</span>,<span class="st">&quot;olivedrab4&quot;</span>)) <span class="sc">+</span></span>
<span id="cb1059-16"><a href="monsters-and-mixtures.html#cb1059-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;probability&quot;</span>) <span class="sc">+</span></span>
<span id="cb1059-17"><a href="monsters-and-mixtures.html#cb1059-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>,</span>
<span id="cb1059-18"><a href="monsters-and-mixtures.html#cb1059-18" aria-hidden="true" tabindex="-1"></a>        <span class="at">aspect.ratio=</span><span class="fl">0.7</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:dirichlet"></span>
<img src="Rethinking_Bookdown_files/figure-html/dirichlet-1.png" alt="ディリクレ分布から10回シミュレートしたデータ。太線はそのうちの1つを表している。" width="672" />
<p class="caption">
図12.10: ディリクレ分布から10回シミュレートしたデータ。太線はそのうちの1つを表している。
</p>
</div>
<p>それでは、モデリングを行おう。<code>brms</code>パッケージでは、順序カテゴリカルの変数を<code>mo()</code>の中に入れるだけでよい。推定には時間がかなりかかる（1時間以上かかる…）。</p>
<div class="sourceCode" id="cb1060"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1060-1"><a href="monsters-and-mixtures.html#cb1060-1" aria-hidden="true" tabindex="-1"></a>b12<span class="fl">.6</span> <span class="ot">&lt;-</span> </span>
<span id="cb1060-2"><a href="monsters-and-mixtures.html#cb1060-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">brm</span>(<span class="at">data =</span> d4, </span>
<span id="cb1060-3"><a href="monsters-and-mixtures.html#cb1060-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> cumulative,</span>
<span id="cb1060-4"><a href="monsters-and-mixtures.html#cb1060-4" aria-hidden="true" tabindex="-1"></a>      response <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> action <span class="sc">+</span> contact <span class="sc">+</span> intention <span class="sc">+</span> <span class="fu">mo</span>(edu_new),</span>
<span id="cb1060-5"><a href="monsters-and-mixtures.html#cb1060-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">1.5</span>), <span class="at">class =</span> Intercept),</span>
<span id="cb1060-6"><a href="monsters-and-mixtures.html#cb1060-6" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">class =</span> b),</span>
<span id="cb1060-7"><a href="monsters-and-mixtures.html#cb1060-7" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">0.5</span>), <span class="at">class =</span> b, </span>
<span id="cb1060-8"><a href="monsters-and-mixtures.html#cb1060-8" aria-hidden="true" tabindex="-1"></a>                      <span class="at">coef =</span> moedu_new),</span>
<span id="cb1060-9"><a href="monsters-and-mixtures.html#cb1060-9" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">dirichlet</span>(<span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">2</span>), <span class="at">class =</span> simo, <span class="at">coef =</span> moedu_new1)),</span>
<span id="cb1060-10"><a href="monsters-and-mixtures.html#cb1060-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>, <span class="at">cores =</span> <span class="dv">4</span>, <span class="at">chains =</span> <span class="dv">4</span>,</span>
<span id="cb1060-11"><a href="monsters-and-mixtures.html#cb1060-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">seed =</span> <span class="dv">12</span>,</span>
<span id="cb1060-12"><a href="monsters-and-mixtures.html#cb1060-12" aria-hidden="true" tabindex="-1"></a>       <span class="at">backend =</span> <span class="st">&quot;cmdstanr&quot;</span>,</span>
<span id="cb1060-13"><a href="monsters-and-mixtures.html#cb1060-13" aria-hidden="true" tabindex="-1"></a>      <span class="at">file =</span> <span class="st">&quot;output/Chapter12/b12.6&quot;</span>)</span></code></pre></div>
<p>結果は以下の通り（表<a href="monsters-and-mixtures.html#tab:res-b12-6">12.8</a>）。<span class="math inline">\(\beta_{E}\)</span>の推定値が教科書よりもかなり小さい。これは、<code>brms</code>では教科書と違って平均をとっているからである。つまり7倍すれば概ね同じ値になる。係数は負なので、より教育レベルの高い人ほど倫理的に許容できないと答えるということになる。</p>
<div class="sourceCode" id="cb1061"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1061-1"><a href="monsters-and-mixtures.html#cb1061-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fixef</span>(b12<span class="fl">.6</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1061-2"><a href="monsters-and-mixtures.html#cb1061-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1061-3"><a href="monsters-and-mixtures.html#cb1061-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="at">digits =</span> <span class="dv">2</span>,</span>
<span id="cb1061-4"><a href="monsters-and-mixtures.html#cb1061-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">booktabs =</span> <span class="cn">TRUE</span>,</span>
<span id="cb1061-5"><a href="monsters-and-mixtures.html#cb1061-5" aria-hidden="true" tabindex="-1"></a>        <span class="at">caption =</span> <span class="st">&quot;b12.6の結果&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1061-6"><a href="monsters-and-mixtures.html#cb1061-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">latex_options =</span> <span class="fu">c</span>(<span class="st">&quot;striped&quot;</span>, <span class="st">&quot;hold_position&quot;</span>))</span></code></pre></div>
<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:res-b12-6">表12.8: </span>b12.6の結果
</caption>
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
Estimate
</th>
<th style="text-align:right;">
Est.Error
</th>
<th style="text-align:right;">
Q2.5
</th>
<th style="text-align:right;">
Q97.5
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Intercept[1]
</td>
<td style="text-align:right;">
-3.14
</td>
<td style="text-align:right;">
0.17
</td>
<td style="text-align:right;">
-3.53
</td>
<td style="text-align:right;">
-2.85
</td>
</tr>
<tr>
<td style="text-align:left;">
Intercept[2]
</td>
<td style="text-align:right;">
-2.45
</td>
<td style="text-align:right;">
0.17
</td>
<td style="text-align:right;">
-2.85
</td>
<td style="text-align:right;">
-2.17
</td>
</tr>
<tr>
<td style="text-align:left;">
Intercept[3]
</td>
<td style="text-align:right;">
-1.87
</td>
<td style="text-align:right;">
0.17
</td>
<td style="text-align:right;">
-2.26
</td>
<td style="text-align:right;">
-1.59
</td>
</tr>
<tr>
<td style="text-align:left;">
Intercept[4]
</td>
<td style="text-align:right;">
-0.85
</td>
<td style="text-align:right;">
0.17
</td>
<td style="text-align:right;">
-1.24
</td>
<td style="text-align:right;">
-0.57
</td>
</tr>
<tr>
<td style="text-align:left;">
Intercept[5]
</td>
<td style="text-align:right;">
-0.18
</td>
<td style="text-align:right;">
0.17
</td>
<td style="text-align:right;">
-0.58
</td>
<td style="text-align:right;">
0.09
</td>
</tr>
<tr>
<td style="text-align:left;">
Intercept[6]
</td>
<td style="text-align:right;">
0.73
</td>
<td style="text-align:right;">
0.17
</td>
<td style="text-align:right;">
0.34
</td>
<td style="text-align:right;">
1.01
</td>
</tr>
<tr>
<td style="text-align:left;">
action
</td>
<td style="text-align:right;">
-0.71
</td>
<td style="text-align:right;">
0.04
</td>
<td style="text-align:right;">
-0.78
</td>
<td style="text-align:right;">
-0.63
</td>
</tr>
<tr>
<td style="text-align:left;">
contact
</td>
<td style="text-align:right;">
-0.96
</td>
<td style="text-align:right;">
0.05
</td>
<td style="text-align:right;">
-1.06
</td>
<td style="text-align:right;">
-0.86
</td>
</tr>
<tr>
<td style="text-align:left;">
intention
</td>
<td style="text-align:right;">
-0.72
</td>
<td style="text-align:right;">
0.04
</td>
<td style="text-align:right;">
-0.79
</td>
<td style="text-align:right;">
-0.65
</td>
</tr>
<tr>
<td style="text-align:left;">
moedu_new
</td>
<td style="text-align:right;">
-0.05
</td>
<td style="text-align:right;">
0.03
</td>
<td style="text-align:right;">
-0.11
</td>
<td style="text-align:right;">
-0.01
</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb1062"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1062-1"><a href="monsters-and-mixtures.html#cb1062-1" aria-hidden="true" tabindex="-1"></a><span class="fu">posterior_samples</span>(b12<span class="fl">.6</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1062-2"><a href="monsters-and-mixtures.html#cb1062-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">transmute</span>(<span class="at">bE =</span> bsp_moedu_new <span class="sc">*</span> <span class="dv">7</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1062-3"><a href="monsters-and-mixtures.html#cb1062-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">median_qi</span>(<span class="at">.width =</span> .<span class="dv">89</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1062-4"><a href="monsters-and-mixtures.html#cb1062-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_if</span>(is.double, round, <span class="at">digits =</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1062-5"><a href="monsters-and-mixtures.html#cb1062-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="at">booktabs =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<table>
<thead>
<tr>
<th style="text-align:right;">
bE
</th>
<th style="text-align:right;">
.lower
</th>
<th style="text-align:right;">
.upper
</th>
<th style="text-align:right;">
.width
</th>
<th style="text-align:left;">
.point
</th>
<th style="text-align:left;">
.interval
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
-0.36
</td>
<td style="text-align:right;">
-0.69
</td>
<td style="text-align:right;">
-0.11
</td>
<td style="text-align:right;">
0.89
</td>
<td style="text-align:left;">
median
</td>
<td style="text-align:left;">
qi
</td>
</tr>
</tbody>
</table>
<p>なお、<span class="math inline">\(\delta\)</span>は以下の通り(表<a href="monsters-and-mixtures.html#tab:delta-12-6">12.9</a>。教科書の推定値とほとんど一致している。</p>
<pre><code>##  Family: cumulative 
##   Links: mu = logit; disc = identity 
## Formula: response ~ 1 + action + contact + intention + mo(edu_new) 
##    Data: d4 (Number of observations: 9930) 
##   Draws: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
##          total post-warmup draws = 4000
## 
## Population-Level Effects: 
##              Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## Intercept[1]    -3.14      0.17    -3.53    -2.85 1.00     1691     2033
## Intercept[2]    -2.45      0.17    -2.85    -2.17 1.00     1686     1728
## Intercept[3]    -1.87      0.17    -2.26    -1.59 1.00     1685     1755
## Intercept[4]    -0.85      0.17    -1.24    -0.57 1.00     1709     1751
## Intercept[5]    -0.18      0.17    -0.58     0.09 1.00     1694     1804
## Intercept[6]     0.73      0.17     0.34     1.01 1.00     1716     1707
## action          -0.71      0.04    -0.78    -0.63 1.00     4061     2904
## contact         -0.96      0.05    -1.06    -0.86 1.00     4532     3235
## intention       -0.72      0.04    -0.79    -0.65 1.00     4798     3101
## moedu_new       -0.05      0.03    -0.11    -0.01 1.00     1744     1661
## 
## Simplex Parameters: 
##               Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## moedu_new1[1]     0.26      0.15     0.04     0.60 1.00     2339     2608
## moedu_new1[2]     0.14      0.09     0.02     0.37 1.00     4295     2403
## moedu_new1[3]     0.19      0.11     0.03     0.42 1.00     3236     2379
## moedu_new1[4]     0.16      0.09     0.03     0.38 1.00     3436     2300
## moedu_new1[5]     0.04      0.04     0.00     0.14 1.00     3390     2293
## moedu_new1[6]     0.09      0.06     0.01     0.24 1.00     3948     3016
## moedu_new1[7]     0.12      0.07     0.02     0.29 1.00     4222     2879
## 
## Family Specific Parameters: 
##      Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## disc     1.00      0.00     1.00     1.00   NA       NA       NA
## 
## Draws were sampled using sample(hmc). For each parameter, Bulk_ESS
## and Tail_ESS are effective sample size measures, and Rhat is the potential
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<div class="sourceCode" id="cb1064"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1064-1"><a href="monsters-and-mixtures.html#cb1064-1" aria-hidden="true" tabindex="-1"></a>p<span class="sc">$</span>mo <span class="sc">%&gt;%</span> </span>
<span id="cb1064-2"><a href="monsters-and-mixtures.html#cb1064-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1064-3"><a href="monsters-and-mixtures.html#cb1064-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>(<span class="at">var =</span> <span class="st">&quot;delta&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1064-4"><a href="monsters-and-mixtures.html#cb1064-4" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>Bulk_ESS,<span class="sc">-</span>Tail_ESS,<span class="sc">-</span>Rhat) <span class="sc">%&gt;%</span> </span>
<span id="cb1064-5"><a href="monsters-and-mixtures.html#cb1064-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="at">digits=</span><span class="dv">2</span>,</span>
<span id="cb1064-6"><a href="monsters-and-mixtures.html#cb1064-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">booktabs =</span> <span class="cn">TRUE</span>,</span>
<span id="cb1064-7"><a href="monsters-and-mixtures.html#cb1064-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">caption =</span> <span class="st">&quot;b12.6によるδの推定値&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb1064-8"><a href="monsters-and-mixtures.html#cb1064-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">latex_options =</span> <span class="fu">c</span>(<span class="st">&quot;striped&quot;</span>, <span class="st">&quot;hold_position&quot;</span>))</span></code></pre></div>
<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:delta-12-6">表12.9: </span>b12.6によるδの推定値
</caption>
<thead>
<tr>
<th style="text-align:left;">
delta
</th>
<th style="text-align:right;">
Estimate
</th>
<th style="text-align:right;">
Est.Error
</th>
<th style="text-align:right;">
l.95..CI
</th>
<th style="text-align:right;">
u.95..CI
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
moedu_new1[1]
</td>
<td style="text-align:right;">
0.26
</td>
<td style="text-align:right;">
0.15
</td>
<td style="text-align:right;">
0.04
</td>
<td style="text-align:right;">
0.60
</td>
</tr>
<tr>
<td style="text-align:left;">
moedu_new1[2]
</td>
<td style="text-align:right;">
0.14
</td>
<td style="text-align:right;">
0.09
</td>
<td style="text-align:right;">
0.02
</td>
<td style="text-align:right;">
0.37
</td>
</tr>
<tr>
<td style="text-align:left;">
moedu_new1[3]
</td>
<td style="text-align:right;">
0.19
</td>
<td style="text-align:right;">
0.11
</td>
<td style="text-align:right;">
0.03
</td>
<td style="text-align:right;">
0.42
</td>
</tr>
<tr>
<td style="text-align:left;">
moedu_new1[4]
</td>
<td style="text-align:right;">
0.16
</td>
<td style="text-align:right;">
0.09
</td>
<td style="text-align:right;">
0.03
</td>
<td style="text-align:right;">
0.38
</td>
</tr>
<tr>
<td style="text-align:left;">
moedu_new1[5]
</td>
<td style="text-align:right;">
0.04
</td>
<td style="text-align:right;">
0.04
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;">
0.14
</td>
</tr>
<tr>
<td style="text-align:left;">
moedu_new1[6]
</td>
<td style="text-align:right;">
0.09
</td>
<td style="text-align:right;">
0.06
</td>
<td style="text-align:right;">
0.01
</td>
<td style="text-align:right;">
0.24
</td>
</tr>
<tr>
<td style="text-align:left;">
moedu_new1[7]
</td>
<td style="text-align:right;">
0.12
</td>
<td style="text-align:right;">
0.07
</td>
<td style="text-align:right;">
0.02
</td>
<td style="text-align:right;">
0.29
</td>
</tr>
</tbody>
</table>
<p><span class="math inline">\(\delta\)</span>の事後分布をプロットすると以下の通り（図<a href="monsters-and-mixtures.html#fig:b12-6">12.11</a>）。それぞれが負に相関しているのは、合計が1になるという制約があるためである（一方が大きくなると、他方は小さくなる）。</p>
<div class="sourceCode" id="cb1065"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1065-1"><a href="monsters-and-mixtures.html#cb1065-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(GGally)</span>
<span id="cb1065-2"><a href="monsters-and-mixtures.html#cb1065-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1065-3"><a href="monsters-and-mixtures.html#cb1065-3" aria-hidden="true" tabindex="-1"></a>delta_labels <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Elem&quot;</span>, <span class="st">&quot;MidSch&quot;</span>, <span class="st">&quot;SHS&quot;</span>, <span class="st">&quot;HSG&quot;</span>, <span class="st">&quot;SCol&quot;</span>, <span class="st">&quot;Bach&quot;</span>, <span class="st">&quot;Mast&quot;</span>, <span class="st">&quot;Grad&quot;</span>)</span>
<span id="cb1065-4"><a href="monsters-and-mixtures.html#cb1065-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1065-5"><a href="monsters-and-mixtures.html#cb1065-5" aria-hidden="true" tabindex="-1"></a><span class="fu">posterior_samples</span>(b12<span class="fl">.6</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1065-6"><a href="monsters-and-mixtures.html#cb1065-6" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="fu">contains</span>(<span class="st">&quot;moedu_new1&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1065-7"><a href="monsters-and-mixtures.html#cb1065-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_names</span>(<span class="fu">str_c</span>(delta_labels[<span class="dv">2</span><span class="sc">:</span><span class="dv">8</span>],<span class="st">&quot;~(delta[&quot;</span>,<span class="dv">1</span><span class="sc">:</span><span class="dv">7</span>,<span class="st">&quot;])&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1065-8"><a href="monsters-and-mixtures.html#cb1065-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggpairs</span>(<span class="at">upper =</span> <span class="fu">list</span>(<span class="at">continuous =</span> my_upper),</span>
<span id="cb1065-9"><a href="monsters-and-mixtures.html#cb1065-9" aria-hidden="true" tabindex="-1"></a>          <span class="at">diag =</span> <span class="fu">list</span>(<span class="at">continuous =</span> my_diag),</span>
<span id="cb1065-10"><a href="monsters-and-mixtures.html#cb1065-10" aria-hidden="true" tabindex="-1"></a>          <span class="at">lower =</span> <span class="fu">list</span>(<span class="at">continuous =</span> my_lower),</span>
<span id="cb1065-11"><a href="monsters-and-mixtures.html#cb1065-11" aria-hidden="true" tabindex="-1"></a>          <span class="at">labeller=</span>label_parsed) <span class="sc">+</span></span>
<span id="cb1065-12"><a href="monsters-and-mixtures.html#cb1065-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>))</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:b12-6"></span>
<img src="Rethinking_Bookdown_files/figure-html/b12-6-1.png" alt="deltaの事後分布とそれぞれの相関" width="672" />
<p class="caption">
図12.11: deltaの事後分布とそれぞれの相関
</p>
</div>
</div>
<div id="practice-9" class="section level2 hasAnchor" number="12.5">
<h2><span class="header-section-number">12.5</span> Practice<a href="monsters-and-mixtures.html#practice-9" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="m1-6" class="section level3 hasAnchor" number="12.5.1">
<h3><span class="header-section-number">12.5.1</span> 12M1<a href="monsters-and-mixtures.html#m1-6" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<blockquote>
<p>At a certain university, employees are annually rated from 1 to 4 on their productivity, with 1 being least productive and 4 most productive. In a certain department at this certain university in a certain year, the numbers of employees receiving each rating were (from 1 to 4): 12, 36, 7, 41. Compute the log cumulative odds of each rating.</p>
</blockquote>
<div class="sourceCode" id="cb1066"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1066-1"><a href="monsters-and-mixtures.html#cb1066-1" aria-hidden="true" tabindex="-1"></a>rating <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">rating =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>),<span class="at">p =</span> <span class="fu">c</span>(<span class="dv">12</span>,<span class="dv">36</span>,<span class="dv">7</span>,<span class="dv">41</span>))</span>
<span id="cb1066-2"><a href="monsters-and-mixtures.html#cb1066-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1066-3"><a href="monsters-and-mixtures.html#cb1066-3" aria-hidden="true" tabindex="-1"></a>rating <span class="sc">%&gt;%</span> </span>
<span id="cb1066-4"><a href="monsters-and-mixtures.html#cb1066-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prop =</span> p<span class="sc">/</span><span class="fu">sum</span>(p),</span>
<span id="cb1066-5"><a href="monsters-and-mixtures.html#cb1066-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">cum =</span> <span class="fu">cumsum</span>(prop)) <span class="sc">%&gt;%</span> </span>
<span id="cb1066-6"><a href="monsters-and-mixtures.html#cb1066-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">logsum =</span> <span class="fu">logit</span>(cum)) <span class="sc">%&gt;%</span> </span>
<span id="cb1066-7"><a href="monsters-and-mixtures.html#cb1066-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="at">digits=</span><span class="dv">2</span>,</span>
<span id="cb1066-8"><a href="monsters-and-mixtures.html#cb1066-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">booktabs=</span>T,</span>
<span id="cb1066-9"><a href="monsters-and-mixtures.html#cb1066-9" aria-hidden="true" tabindex="-1"></a>        <span class="at">align =</span> <span class="st">&quot;ccccc&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1066-10"><a href="monsters-and-mixtures.html#cb1066-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">latex_options =</span> <span class="fu">c</span>(<span class="st">&quot;striped&quot;</span>, <span class="st">&quot;hold_position&quot;</span>))</span></code></pre></div>
<table class="table" style="margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:center;">
rating
</th>
<th style="text-align:center;">
p
</th>
<th style="text-align:center;">
prop
</th>
<th style="text-align:center;">
cum
</th>
<th style="text-align:center;">
logsum
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
12
</td>
<td style="text-align:center;">
0.12
</td>
<td style="text-align:center;">
0.12
</td>
<td style="text-align:center;">
-1.95
</td>
</tr>
<tr>
<td style="text-align:center;">
2
</td>
<td style="text-align:center;">
36
</td>
<td style="text-align:center;">
0.38
</td>
<td style="text-align:center;">
0.50
</td>
<td style="text-align:center;">
0.00
</td>
</tr>
<tr>
<td style="text-align:center;">
3
</td>
<td style="text-align:center;">
7
</td>
<td style="text-align:center;">
0.07
</td>
<td style="text-align:center;">
0.57
</td>
<td style="text-align:center;">
0.29
</td>
</tr>
<tr>
<td style="text-align:center;">
4
</td>
<td style="text-align:center;">
41
</td>
<td style="text-align:center;">
0.43
</td>
<td style="text-align:center;">
1.00
</td>
<td style="text-align:center;">
Inf
</td>
</tr>
</tbody>
</table>
</div>
<div id="m2-6" class="section level3 hasAnchor" number="12.5.2">
<h3><span class="header-section-number">12.5.2</span> 12M2<a href="monsters-and-mixtures.html#m2-6" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<blockquote>
<p>Make a version of Figure 12.5 for the employee ratings data given just above.</p>
</blockquote>
<div class="sourceCode" id="cb1067"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1067-1"><a href="monsters-and-mixtures.html#cb1067-1" aria-hidden="true" tabindex="-1"></a>rating <span class="sc">%&gt;%</span> </span>
<span id="cb1067-2"><a href="monsters-and-mixtures.html#cb1067-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prop =</span> p<span class="sc">/</span><span class="fu">sum</span>(p),</span>
<span id="cb1067-3"><a href="monsters-and-mixtures.html#cb1067-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">cum =</span> <span class="fu">cumsum</span>(prop),</span>
<span id="cb1067-4"><a href="monsters-and-mixtures.html#cb1067-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">distinct =</span> cum<span class="sc">-</span>prop) <span class="sc">%&gt;%</span> </span>
<span id="cb1067-5"><a href="monsters-and-mixtures.html#cb1067-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> rating, <span class="at">y =</span> cum))<span class="sc">+</span></span>
<span id="cb1067-6"><a href="monsters-and-mixtures.html#cb1067-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">shape=</span><span class="dv">21</span>, <span class="at">color=</span><span class="st">&quot;grey92&quot;</span>, <span class="at">size=</span><span class="fl">2.5</span>, </span>
<span id="cb1067-7"><a href="monsters-and-mixtures.html#cb1067-7" aria-hidden="true" tabindex="-1"></a>             <span class="at">stroke =</span><span class="fl">1.5</span>, <span class="at">fill =</span> <span class="st">&quot;khaki4&quot;</span>)<span class="sc">+</span></span>
<span id="cb1067-8"><a href="monsters-and-mixtures.html#cb1067-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">color =</span> <span class="st">&quot;khaki4&quot;</span>)<span class="sc">+</span></span>
<span id="cb1067-9"><a href="monsters-and-mixtures.html#cb1067-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_linerange</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> <span class="dv">0</span>, <span class="at">ymax =</span> cum),</span>
<span id="cb1067-10"><a href="monsters-and-mixtures.html#cb1067-10" aria-hidden="true" tabindex="-1"></a>                 <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>, <span class="at">color =</span> <span class="st">&quot;khaki2&quot;</span>) <span class="sc">+</span></span>
<span id="cb1067-11"><a href="monsters-and-mixtures.html#cb1067-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_linerange</span>(<span class="fu">aes</span>(<span class="at">x =</span> rating <span class="sc">+</span> .<span class="dv">025</span>,</span>
<span id="cb1067-12"><a href="monsters-and-mixtures.html#cb1067-12" aria-hidden="true" tabindex="-1"></a>                     <span class="at">ymin =</span> <span class="fu">ifelse</span>(rating <span class="sc">==</span> <span class="dv">1</span>, <span class="dv">0</span>,distinct), </span>
<span id="cb1067-13"><a href="monsters-and-mixtures.html#cb1067-13" aria-hidden="true" tabindex="-1"></a>                     <span class="at">ymax =</span> cum),</span>
<span id="cb1067-14"><a href="monsters-and-mixtures.html#cb1067-14" aria-hidden="true" tabindex="-1"></a>                 <span class="at">color =</span> <span class="st">&quot;black&quot;</span>) <span class="sc">+</span></span>
<span id="cb1067-15"><a href="monsters-and-mixtures.html#cb1067-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb1067-16"><a href="monsters-and-mixtures.html#cb1067-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="st">&quot;cumulative proportion&quot;</span>, </span>
<span id="cb1067-17"><a href="monsters-and-mixtures.html#cb1067-17" aria-hidden="true" tabindex="-1"></a>                     <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>, .<span class="dv">5</span>, <span class="dv">1</span>), <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb1067-18"><a href="monsters-and-mixtures.html#cb1067-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">x =</span> rating <span class="sc">+</span> <span class="fl">0.2</span>, <span class="at">y =</span> cum<span class="fl">-0.02</span>,<span class="at">label=</span>rating))<span class="sc">+</span></span>
<span id="cb1067-19"><a href="monsters-and-mixtures.html#cb1067-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.ticks =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb1067-20"><a href="monsters-and-mixtures.html#cb1067-20" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">90</span>),</span>
<span id="cb1067-21"><a href="monsters-and-mixtures.html#cb1067-21" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>,</span>
<span id="cb1067-22"><a href="monsters-and-mixtures.html#cb1067-22" aria-hidden="true" tabindex="-1"></a>        <span class="at">aspect.ratio=</span><span class="dv">1</span>)</span></code></pre></div>
<p><img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-569-1.png" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="m3-3" class="section level3 hasAnchor" number="12.5.3">
<h3><span class="header-section-number">12.5.3</span> 12M3<a href="monsters-and-mixtures.html#m3-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<blockquote>
<p>Can you modify the derivation of the zero-inflated Poisson distribution (ZIPoisson) from the chapter to construct a zero-inflated binomial distribution?</p>
</blockquote>
<p>まずデータが得られない確率を<span class="math inline">\(p\)</span>,そのうえで1が得られる確率を<span class="math inline">\(q\)</span>とする。このとき、0が得られる確率は以下の通り。</p>
<p><span class="math display">\[
Pr(0|p,q,n) = p + (1-p)(1-q)^n
\]</span></p>
<p>0以外の値(1)が得られる確率は以下の通り。</p>
<p><span class="math display">\[
Pr(y=1, p,\lambda) = (1-p) \frac{n!}{y!(n-y)!}
\]</span></p>
</div>
<div id="h1-9" class="section level3 hasAnchor" number="12.5.4">
<h3><span class="header-section-number">12.5.4</span> 12H1<a href="monsters-and-mixtures.html#h1-9" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<blockquote>
<p>In 2014, a paper was published that was entitled “Female hurricanes are deadlier than male hurricanes.” As the title suggests, the paper claimed that hurricanes with female names have caused greater loss of life, and the explanation given is that people unconsciously rate female hurricanes as less dangerous and so are less likely to evacuate. Statisticians severely criticized the paper after publication. Here, you’ll explore the complete data used in the paper and consider the hypothesis that hurricanes with female names are deadlier. Load the data with:</p>
</blockquote>
<blockquote>
<p>Acquaint yourself with the columns by inspecting the help ?Hurricanes. In this problem, you’ll focus on predicting deaths using femininity of each hurricane’s name.Fit and interpret the simplest possible model, a Poisson model of deaths using femininity as a predictor. You can use quap or ulam. Compare the model to an intercept-only Poisson model of deaths. How strong is the association between femininity of name and deaths? Which storms does the model fit (retrodict) well? Which storms does it fit poorly?</p>
</blockquote>
<p>2014年、女性名のハリケーンの方が男性名のものよりも被害が大きいという論文が出版された<span class="citation">(<a href="#ref-Jung2014" role="doc-biblioref">Jung et al. 2014</a>)</span>。論文の著者は、女性名の場合に人々は無意識にリスクを少なく見積もってしまい、避難することが少なくなってしまうと考察している。統計学者はこの論文を批判している<span class="citation">(<a href="#ref-Bakkensen2014" role="doc-biblioref">Bakkensen and Larson 2014</a>)</span>。データを見てみよう（表<a href="monsters-and-mixtures.html#tab:hurricane">12.10</a>）。</p>
<div class="sourceCode" id="cb1068"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1068-1"><a href="monsters-and-mixtures.html#cb1068-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(Hurricanes)</span>
<span id="cb1068-2"><a href="monsters-and-mixtures.html#cb1068-2" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> Hurricanes</span>
<span id="cb1068-3"><a href="monsters-and-mixtures.html#cb1068-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(dat) <span class="sc">%&gt;%</span> </span>
<span id="cb1068-4"><a href="monsters-and-mixtures.html#cb1068-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="at">booktabs=</span>T,</span>
<span id="cb1068-5"><a href="monsters-and-mixtures.html#cb1068-5" aria-hidden="true" tabindex="-1"></a>        <span class="at">caption =</span> <span class="st">&quot;Jung et al.(2014)のデータ&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1068-6"><a href="monsters-and-mixtures.html#cb1068-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">latex_options =</span> <span class="fu">c</span>(<span class="st">&quot;stripe&quot;</span>,<span class="st">&quot;hold_position&quot;</span>))</span></code></pre></div>
<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:hurricane">表12.10: </span>Jung et al.(2014)のデータ
</caption>
<thead>
<tr>
<th style="text-align:left;">
name
</th>
<th style="text-align:right;">
year
</th>
<th style="text-align:right;">
deaths
</th>
<th style="text-align:right;">
category
</th>
<th style="text-align:right;">
min_pressure
</th>
<th style="text-align:right;">
damage_norm
</th>
<th style="text-align:right;">
female
</th>
<th style="text-align:right;">
femininity
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Easy
</td>
<td style="text-align:right;">
1950
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
960
</td>
<td style="text-align:right;">
1590
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
6.77778
</td>
</tr>
<tr>
<td style="text-align:left;">
King
</td>
<td style="text-align:right;">
1950
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
955
</td>
<td style="text-align:right;">
5350
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1.38889
</td>
</tr>
<tr>
<td style="text-align:left;">
Able
</td>
<td style="text-align:right;">
1952
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
985
</td>
<td style="text-align:right;">
150
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
3.83333
</td>
</tr>
<tr>
<td style="text-align:left;">
Barbara
</td>
<td style="text-align:right;">
1953
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
987
</td>
<td style="text-align:right;">
58
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
9.83333
</td>
</tr>
<tr>
<td style="text-align:left;">
Florence
</td>
<td style="text-align:right;">
1953
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
985
</td>
<td style="text-align:right;">
15
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
8.33333
</td>
</tr>
<tr>
<td style="text-align:left;">
Carol
</td>
<td style="text-align:right;">
1954
</td>
<td style="text-align:right;">
60
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
960
</td>
<td style="text-align:right;">
19321
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
8.11111
</td>
</tr>
</tbody>
</table>
<p>台風の名前の女性らしさ(feminity)が死者数(death)に影響しているかをモデリングする。</p>
<div class="sourceCode" id="cb1069"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1069-1"><a href="monsters-and-mixtures.html#cb1069-1" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span> </span>
<span id="cb1069-2"><a href="monsters-and-mixtures.html#cb1069-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">F =</span> <span class="fu">standardize</span>(femininity))</span>
<span id="cb1069-3"><a href="monsters-and-mixtures.html#cb1069-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1069-4"><a href="monsters-and-mixtures.html#cb1069-4" aria-hidden="true" tabindex="-1"></a>b12H1 <span class="ot">&lt;-</span></span>
<span id="cb1069-5"><a href="monsters-and-mixtures.html#cb1069-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">brm</span>(<span class="at">data =</span> dat,</span>
<span id="cb1069-6"><a href="monsters-and-mixtures.html#cb1069-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> poisson,</span>
<span id="cb1069-7"><a href="monsters-and-mixtures.html#cb1069-7" aria-hidden="true" tabindex="-1"></a>      deaths <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> F,</span>
<span id="cb1069-8"><a href="monsters-and-mixtures.html#cb1069-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">3</span>, <span class="fl">0.5</span>),<span class="at">class=</span>Intercept),</span>
<span id="cb1069-9"><a href="monsters-and-mixtures.html#cb1069-9" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>,<span class="dv">1</span>),<span class="at">class =</span>b)),</span>
<span id="cb1069-10"><a href="monsters-and-mixtures.html#cb1069-10" aria-hidden="true" tabindex="-1"></a>       <span class="at">backend =</span> <span class="st">&quot;cmdstanr&quot;</span>,</span>
<span id="cb1069-11"><a href="monsters-and-mixtures.html#cb1069-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">seed=</span><span class="dv">11</span>, <span class="at">file =</span> <span class="st">&quot;output/Chapter12/b12H1&quot;</span>)</span></code></pre></div>
<p>結果は以下の通り（表<a href="monsters-and-mixtures.html#tab:res-b12H1">12.11</a>）。名前の女性らしさは影響しているという結果が出た。</p>
<div class="sourceCode" id="cb1070"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1070-1"><a href="monsters-and-mixtures.html#cb1070-1" aria-hidden="true" tabindex="-1"></a><span class="fu">posterior_summary</span>(b12H1, <span class="at">probs =</span> <span class="fu">c</span>(<span class="fl">0.055</span>,<span class="fl">0.945</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1070-2"><a href="monsters-and-mixtures.html#cb1070-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1070-3"><a href="monsters-and-mixtures.html#cb1070-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>(<span class="at">var =</span> <span class="st">&quot;parameter&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1070-4"><a href="monsters-and-mixtures.html#cb1070-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(parameter<span class="sc">!=</span><span class="st">&quot;lp__&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1070-5"><a href="monsters-and-mixtures.html#cb1070-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="at">booktabs=</span>T,</span>
<span id="cb1070-6"><a href="monsters-and-mixtures.html#cb1070-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">digits=</span><span class="dv">2</span>,</span>
<span id="cb1070-7"><a href="monsters-and-mixtures.html#cb1070-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">caption =</span> <span class="st">&quot;b12H1の結果&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1070-8"><a href="monsters-and-mixtures.html#cb1070-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">latex_options =</span> <span class="fu">c</span>(<span class="st">&quot;stripe&quot;</span>,<span class="st">&quot;hold_position&quot;</span>))</span></code></pre></div>
<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:res-b12H1">表12.11: </span>b12H1の結果
</caption>
<thead>
<tr>
<th style="text-align:left;">
parameter
</th>
<th style="text-align:right;">
Estimate
</th>
<th style="text-align:right;">
Est.Error
</th>
<th style="text-align:right;">
Q5.5
</th>
<th style="text-align:right;">
Q94.5
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
b_Intercept
</td>
<td style="text-align:right;">
3.00
</td>
<td style="text-align:right;">
0.02
</td>
<td style="text-align:right;">
2.96
</td>
<td style="text-align:right;">
3.04
</td>
</tr>
<tr>
<td style="text-align:left;">
b_F
</td>
<td style="text-align:right;">
0.24
</td>
<td style="text-align:right;">
0.03
</td>
<td style="text-align:right;">
0.20
</td>
<td style="text-align:right;">
0.28
</td>
</tr>
<tr>
<td style="text-align:left;">
lprior
</td>
<td style="text-align:right;">
-1.17
</td>
<td style="text-align:right;">
0.01
</td>
<td style="text-align:right;">
-1.19
</td>
<td style="text-align:right;">
-1.17
</td>
</tr>
</tbody>
</table>
<p>PSISを求めてみると、<span class="math inline">\(pareto\)</span>-<span class="math inline">\(k\)</span>が高い点があることが分かる。</p>
<div class="sourceCode" id="cb1071"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1071-1"><a href="monsters-and-mixtures.html#cb1071-1" aria-hidden="true" tabindex="-1"></a>b12H1 <span class="ot">&lt;-</span> <span class="fu">add_criterion</span>(b12H1, <span class="st">&quot;loo&quot;</span>)</span>
<span id="cb1071-2"><a href="monsters-and-mixtures.html#cb1071-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1071-3"><a href="monsters-and-mixtures.html#cb1071-3" aria-hidden="true" tabindex="-1"></a><span class="fu">loo</span>(b12H1) <span class="sc">%&gt;%</span> </span>
<span id="cb1071-4"><a href="monsters-and-mixtures.html#cb1071-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pareto_k_ids</span>(<span class="at">threshold =</span> .<span class="dv">7</span>) <span class="ot">-&gt;</span> k</span>
<span id="cb1071-5"><a href="monsters-and-mixtures.html#cb1071-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1071-6"><a href="monsters-and-mixtures.html#cb1071-6" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">name =</span> dat<span class="sc">$</span>name[k],</span>
<span id="cb1071-7"><a href="monsters-and-mixtures.html#cb1071-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">pareto_k =</span> <span class="fu">pareto_k_values</span>(<span class="fu">loo</span>(b12H1))[k]) <span class="sc">%&gt;%</span> </span>
<span id="cb1071-8"><a href="monsters-and-mixtures.html#cb1071-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="at">booktabs =</span> <span class="cn">TRUE</span>,</span>
<span id="cb1071-9"><a href="monsters-and-mixtures.html#cb1071-9" aria-hidden="true" tabindex="-1"></a>        <span class="at">digits =</span><span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1071-10"><a href="monsters-and-mixtures.html#cb1071-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">latex_options =</span> <span class="fu">c</span>(<span class="st">&quot;stripe&quot;</span>,<span class="st">&quot;hold_position&quot;</span>))</span></code></pre></div>
<table class="table" style="margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;">
name
</th>
<th style="text-align:right;">
pareto_k
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Diane
</td>
<td style="text-align:right;">
2.01
</td>
</tr>
<tr>
<td style="text-align:left;">
Camille
</td>
<td style="text-align:right;">
2.14
</td>
</tr>
<tr>
<td style="text-align:left;">
Agnes
</td>
<td style="text-align:right;">
0.73
</td>
</tr>
<tr>
<td style="text-align:left;">
Andrew
</td>
<td style="text-align:right;">
0.73
</td>
</tr>
<tr>
<td style="text-align:left;">
Ike
</td>
<td style="text-align:right;">
1.10
</td>
</tr>
<tr>
<td style="text-align:left;">
Sandy
</td>
<td style="text-align:right;">
1.21
</td>
</tr>
</tbody>
</table>
<p>実際に推定結果を描写してみる（図<a href="monsters-and-mixtures.html#fig:b12H1">12.12</a>）。傾きはかなり小さく、当てはまりもあまりよくなさそうだということが分かる。</p>
<div class="sourceCode" id="cb1072"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1072-1"><a href="monsters-and-mixtures.html#cb1072-1" aria-hidden="true" tabindex="-1"></a>nd <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">F =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">2</span>,<span class="fl">1.2</span>, <span class="at">length.out=</span><span class="dv">100</span>))</span>
<span id="cb1072-2"><a href="monsters-and-mixtures.html#cb1072-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1072-3"><a href="monsters-and-mixtures.html#cb1072-3" aria-hidden="true" tabindex="-1"></a><span class="fu">fitted</span>(b12H1,nd) <span class="sc">%&gt;%</span> </span>
<span id="cb1072-4"><a href="monsters-and-mixtures.html#cb1072-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1072-5"><a href="monsters-and-mixtures.html#cb1072-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(nd) <span class="ot">-&gt;</span> fit12H1</span>
<span id="cb1072-6"><a href="monsters-and-mixtures.html#cb1072-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1072-7"><a href="monsters-and-mixtures.html#cb1072-7" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span> </span>
<span id="cb1072-8"><a href="monsters-and-mixtures.html#cb1072-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">pareto_k =</span> <span class="fu">pareto_k_values</span>(<span class="fu">loo</span>(b12H1)))</span>
<span id="cb1072-9"><a href="monsters-and-mixtures.html#cb1072-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1072-10"><a href="monsters-and-mixtures.html#cb1072-10" aria-hidden="true" tabindex="-1"></a>dat <span class="sc">%&gt;%</span> </span>
<span id="cb1072-11"><a href="monsters-and-mixtures.html#cb1072-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> F))<span class="sc">+</span></span>
<span id="cb1072-12"><a href="monsters-and-mixtures.html#cb1072-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> deaths, <span class="at">size =</span> pareto_k),</span>
<span id="cb1072-13"><a href="monsters-and-mixtures.html#cb1072-13" aria-hidden="true" tabindex="-1"></a>             <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>)<span class="sc">+</span></span>
<span id="cb1072-14"><a href="monsters-and-mixtures.html#cb1072-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">data =</span> fit12H1,</span>
<span id="cb1072-15"><a href="monsters-and-mixtures.html#cb1072-15" aria-hidden="true" tabindex="-1"></a>              <span class="fu">aes</span>(<span class="at">y =</span> Estimate, <span class="at">ymin =</span> Q2<span class="fl">.5</span>, <span class="at">ymax =</span> Q97<span class="fl">.5</span>),</span>
<span id="cb1072-16"><a href="monsters-and-mixtures.html#cb1072-16" aria-hidden="true" tabindex="-1"></a>              <span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>,</span>
<span id="cb1072-17"><a href="monsters-and-mixtures.html#cb1072-17" aria-hidden="true" tabindex="-1"></a>              <span class="at">fill =</span> <span class="st">&quot;navy&quot;</span>,<span class="at">color =</span> <span class="st">&quot;navy&quot;</span>,</span>
<span id="cb1072-18"><a href="monsters-and-mixtures.html#cb1072-18" aria-hidden="true" tabindex="-1"></a>              <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>)<span class="sc">+</span></span>
<span id="cb1072-19"><a href="monsters-and-mixtures.html#cb1072-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text_repel</span>(<span class="at">data =</span> dat <span class="sc">%&gt;%</span> <span class="fu">filter</span>(pareto_k <span class="sc">&gt;</span> .<span class="dv">7</span>),</span>
<span id="cb1072-20"><a href="monsters-and-mixtures.html#cb1072-20" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">aes</span>(<span class="at">y =</span> deaths,<span class="at">label =</span> name),</span>
<span id="cb1072-21"><a href="monsters-and-mixtures.html#cb1072-21" aria-hidden="true" tabindex="-1"></a>                  <span class="at">color =</span> <span class="st">&quot;red&quot;</span>)<span class="sc">+</span></span>
<span id="cb1072-22"><a href="monsters-and-mixtures.html#cb1072-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">aspect.ratio=</span><span class="dv">1</span>,</span>
<span id="cb1072-23"><a href="monsters-and-mixtures.html#cb1072-23" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>)<span class="sc">+</span></span>
<span id="cb1072-24"><a href="monsters-and-mixtures.html#cb1072-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">breaks=</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">250</span>,<span class="dv">50</span>))<span class="sc">+</span></span>
<span id="cb1072-25"><a href="monsters-and-mixtures.html#cb1072-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;femininity (std)&quot;</span>,</span>
<span id="cb1072-26"><a href="monsters-and-mixtures.html#cb1072-26" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">&quot;Poisson&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:b12H1"></span>
<img src="Rethinking_Bookdown_files/figure-html/b12H1-1.png" alt="b12H1の結果を図示したもの \label{fig.b12H1}" width="672" />
<p class="caption">
図12.12: b12H1の結果を図示したもの
</p>
</div>
<p>切片だけのモデルと比較してみると、いちおう説明変数がある方が予測は向上している。</p>
<div class="sourceCode" id="cb1073"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1073-1"><a href="monsters-and-mixtures.html#cb1073-1" aria-hidden="true" tabindex="-1"></a>b12H1_2 <span class="ot">&lt;-</span> </span>
<span id="cb1073-2"><a href="monsters-and-mixtures.html#cb1073-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">brm</span>(<span class="at">data =</span> dat,</span>
<span id="cb1073-3"><a href="monsters-and-mixtures.html#cb1073-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> poisson,</span>
<span id="cb1073-4"><a href="monsters-and-mixtures.html#cb1073-4" aria-hidden="true" tabindex="-1"></a>      deaths <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb1073-5"><a href="monsters-and-mixtures.html#cb1073-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">prior =</span> <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">3</span>, <span class="fl">0.5</span>),<span class="at">class=</span>Intercept),</span>
<span id="cb1073-6"><a href="monsters-and-mixtures.html#cb1073-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">backend =</span> <span class="st">&quot;cmdstanr&quot;</span>,</span>
<span id="cb1073-7"><a href="monsters-and-mixtures.html#cb1073-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">seed=</span><span class="dv">11</span>, <span class="at">file =</span> <span class="st">&quot;output/Chapter12/b12H1_2&quot;</span>)</span>
<span id="cb1073-8"><a href="monsters-and-mixtures.html#cb1073-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1073-9"><a href="monsters-and-mixtures.html#cb1073-9" aria-hidden="true" tabindex="-1"></a>b12H1_2 <span class="ot">&lt;-</span> <span class="fu">add_criterion</span>(b12H1_2, <span class="st">&quot;loo&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb1074"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1074-1"><a href="monsters-and-mixtures.html#cb1074-1" aria-hidden="true" tabindex="-1"></a><span class="fu">loo_compare</span>(b12H1, b12H1_2) <span class="sc">%&gt;%</span> </span>
<span id="cb1074-2"><a href="monsters-and-mixtures.html#cb1074-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1074-3"><a href="monsters-and-mixtures.html#cb1074-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>se_p_loo) <span class="sc">%&gt;%</span> </span>
<span id="cb1074-4"><a href="monsters-and-mixtures.html#cb1074-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="at">booktabs =</span> <span class="cn">TRUE</span>,</span>
<span id="cb1074-5"><a href="monsters-and-mixtures.html#cb1074-5" aria-hidden="true" tabindex="-1"></a>        <span class="at">digits=</span><span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1074-6"><a href="monsters-and-mixtures.html#cb1074-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">latex_options =</span> <span class="st">&quot;hold_position&quot;</span>)</span></code></pre></div>
<table class="table" style="margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
elpd_diff
</th>
<th style="text-align:right;">
se_diff
</th>
<th style="text-align:right;">
elpd_loo
</th>
<th style="text-align:right;">
se_elpd_loo
</th>
<th style="text-align:right;">
p_loo
</th>
<th style="text-align:right;">
looic
</th>
<th style="text-align:right;">
se_looic
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
b12H1
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;">
-2193.33
</td>
<td style="text-align:right;">
494.30
</td>
<td style="text-align:right;">
118.94
</td>
<td style="text-align:right;">
4386.65
</td>
<td style="text-align:right;">
988.59
</td>
</tr>
<tr>
<td style="text-align:left;">
b12H1_2
</td>
<td style="text-align:right;">
-17.54
</td>
<td style="text-align:right;">
70.56
</td>
<td style="text-align:right;">
-2210.87
</td>
<td style="text-align:right;">
532.54
</td>
<td style="text-align:right;">
66.43
</td>
<td style="text-align:right;">
4421.74
</td>
<td style="text-align:right;">
1065.08
</td>
</tr>
</tbody>
</table>
</div>
<div id="h2-9" class="section level3 hasAnchor" number="12.5.5">
<h3><span class="header-section-number">12.5.5</span> 12H2<a href="monsters-and-mixtures.html#h2-9" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<blockquote>
<p>Counts are nearly always over-dispersed relative to Poisson. So fit a gamma-Poisson (aka negative-binomial) model to predict deaths using femininity. Show that the over-dispersed model no longer shows as precise a positive association between femininity and deaths, with an 89% interval that overlaps zero. Can you explain why the association diminished in strength?</p>
</blockquote>
<p>負の二項分布へのあてはめを行う。</p>
<div class="sourceCode" id="cb1075"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1075-1"><a href="monsters-and-mixtures.html#cb1075-1" aria-hidden="true" tabindex="-1"></a>b12H2 <span class="ot">&lt;-</span></span>
<span id="cb1075-2"><a href="monsters-and-mixtures.html#cb1075-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">brm</span>(<span class="at">data =</span> dat,</span>
<span id="cb1075-3"><a href="monsters-and-mixtures.html#cb1075-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> negbinomial,</span>
<span id="cb1075-4"><a href="monsters-and-mixtures.html#cb1075-4" aria-hidden="true" tabindex="-1"></a>      deaths <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> F,</span>
<span id="cb1075-5"><a href="monsters-and-mixtures.html#cb1075-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">3</span>, <span class="fl">0.5</span>),<span class="at">class=</span>Intercept),</span>
<span id="cb1075-6"><a href="monsters-and-mixtures.html#cb1075-6" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>,<span class="dv">1</span>),<span class="at">class =</span>b),</span>
<span id="cb1075-7"><a href="monsters-and-mixtures.html#cb1075-7" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>), <span class="at">class =</span> shape)),</span>
<span id="cb1075-8"><a href="monsters-and-mixtures.html#cb1075-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">backend =</span> <span class="st">&quot;cmdstanr&quot;</span>,</span>
<span id="cb1075-9"><a href="monsters-and-mixtures.html#cb1075-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">seed=</span><span class="dv">11</span>, <span class="at">file =</span> <span class="st">&quot;output/Chapter12/b12H2&quot;</span>)</span></code></pre></div>
<p>結果、先ほどよりも係数が小さくなり、89%信用区間も0をまたいでいることが分かる(表<a href="monsters-and-mixtures.html#tab:res-b12H2">12.12</a>)。</p>
<div class="sourceCode" id="cb1076"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1076-1"><a href="monsters-and-mixtures.html#cb1076-1" aria-hidden="true" tabindex="-1"></a><span class="fu">posterior_summary</span>(b12H2, <span class="at">probs =</span> <span class="fu">c</span>(<span class="fl">0.055</span>,<span class="fl">0.945</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1076-2"><a href="monsters-and-mixtures.html#cb1076-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1076-3"><a href="monsters-and-mixtures.html#cb1076-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>(<span class="at">var =</span> <span class="st">&quot;parameter&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1076-4"><a href="monsters-and-mixtures.html#cb1076-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(parameter<span class="sc">!=</span><span class="st">&quot;lp__&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1076-5"><a href="monsters-and-mixtures.html#cb1076-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="at">booktabs=</span>T,</span>
<span id="cb1076-6"><a href="monsters-and-mixtures.html#cb1076-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">digits=</span><span class="dv">2</span>,</span>
<span id="cb1076-7"><a href="monsters-and-mixtures.html#cb1076-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">caption =</span> <span class="st">&quot;b12H2の結果&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1076-8"><a href="monsters-and-mixtures.html#cb1076-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">latex_options =</span> <span class="fu">c</span>(<span class="st">&quot;stripe&quot;</span>,<span class="st">&quot;hold_position&quot;</span>))</span></code></pre></div>
<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:res-b12H2">表12.12: </span>b12H2の結果
</caption>
<thead>
<tr>
<th style="text-align:left;">
parameter
</th>
<th style="text-align:right;">
Estimate
</th>
<th style="text-align:right;">
Est.Error
</th>
<th style="text-align:right;">
Q5.5
</th>
<th style="text-align:right;">
Q94.5
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
b_Intercept
</td>
<td style="text-align:right;">
3.02
</td>
<td style="text-align:right;">
0.15
</td>
<td style="text-align:right;">
2.78
</td>
<td style="text-align:right;">
3.26
</td>
</tr>
<tr>
<td style="text-align:left;">
b_F
</td>
<td style="text-align:right;">
0.21
</td>
<td style="text-align:right;">
0.16
</td>
<td style="text-align:right;">
-0.04
</td>
<td style="text-align:right;">
0.46
</td>
</tr>
<tr>
<td style="text-align:left;">
shape
</td>
<td style="text-align:right;">
0.45
</td>
<td style="text-align:right;">
0.06
</td>
<td style="text-align:right;">
0.36
</td>
<td style="text-align:right;">
0.56
</td>
</tr>
<tr>
<td style="text-align:left;">
lprior
</td>
<td style="text-align:right;">
-1.68
</td>
<td style="text-align:right;">
0.10
</td>
<td style="text-align:right;">
-1.85
</td>
<td style="text-align:right;">
-1.55
</td>
</tr>
</tbody>
</table>
<p>一方、<span class="math inline">\(pareto\)</span>-<span class="math inline">\(k\)</span>が0.7以上のデータは一つもなくなり、過分散は解消された。</p>
<div class="sourceCode" id="cb1077"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1077-1"><a href="monsters-and-mixtures.html#cb1077-1" aria-hidden="true" tabindex="-1"></a>b12H2 <span class="ot">&lt;-</span> <span class="fu">add_criterion</span>(b12H2, <span class="st">&quot;loo&quot;</span>)</span>
<span id="cb1077-2"><a href="monsters-and-mixtures.html#cb1077-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1077-3"><a href="monsters-and-mixtures.html#cb1077-3" aria-hidden="true" tabindex="-1"></a><span class="fu">loo</span>(b12H2) <span class="sc">%&gt;%</span> </span>
<span id="cb1077-4"><a href="monsters-and-mixtures.html#cb1077-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pareto_k_ids</span>(<span class="at">threshold =</span> .<span class="dv">7</span>) </span></code></pre></div>
<pre><code>## integer(0)</code></pre>
<p>結果を図示すると以下の通り（図<a href="monsters-and-mixtures.html#fig:b12H2">12.13</a>。推定の幅が広くなっており、女性らしさの影響はほとんどないことが分かる。</p>
<div class="sourceCode" id="cb1079"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1079-1"><a href="monsters-and-mixtures.html#cb1079-1" aria-hidden="true" tabindex="-1"></a>nd <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">F =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">2</span>,<span class="fl">1.2</span>, <span class="at">length.out=</span><span class="dv">100</span>))</span>
<span id="cb1079-2"><a href="monsters-and-mixtures.html#cb1079-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1079-3"><a href="monsters-and-mixtures.html#cb1079-3" aria-hidden="true" tabindex="-1"></a><span class="fu">fitted</span>(b12H2,nd) <span class="sc">%&gt;%</span> </span>
<span id="cb1079-4"><a href="monsters-and-mixtures.html#cb1079-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1079-5"><a href="monsters-and-mixtures.html#cb1079-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(nd) <span class="ot">-&gt;</span> fit12H2</span>
<span id="cb1079-6"><a href="monsters-and-mixtures.html#cb1079-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1079-7"><a href="monsters-and-mixtures.html#cb1079-7" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span> </span>
<span id="cb1079-8"><a href="monsters-and-mixtures.html#cb1079-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">pareto_k =</span> <span class="fu">pareto_k_values</span>(<span class="fu">loo</span>(b12H2)))</span>
<span id="cb1079-9"><a href="monsters-and-mixtures.html#cb1079-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1079-10"><a href="monsters-and-mixtures.html#cb1079-10" aria-hidden="true" tabindex="-1"></a>dat <span class="sc">%&gt;%</span> </span>
<span id="cb1079-11"><a href="monsters-and-mixtures.html#cb1079-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> F))<span class="sc">+</span></span>
<span id="cb1079-12"><a href="monsters-and-mixtures.html#cb1079-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> deaths, <span class="at">size =</span> pareto_k),</span>
<span id="cb1079-13"><a href="monsters-and-mixtures.html#cb1079-13" aria-hidden="true" tabindex="-1"></a>             <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>)<span class="sc">+</span></span>
<span id="cb1079-14"><a href="monsters-and-mixtures.html#cb1079-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">data =</span> fit12H2,</span>
<span id="cb1079-15"><a href="monsters-and-mixtures.html#cb1079-15" aria-hidden="true" tabindex="-1"></a>              <span class="fu">aes</span>(<span class="at">y =</span> Estimate, <span class="at">ymin =</span> Q2<span class="fl">.5</span>, <span class="at">ymax =</span> Q97<span class="fl">.5</span>),</span>
<span id="cb1079-16"><a href="monsters-and-mixtures.html#cb1079-16" aria-hidden="true" tabindex="-1"></a>              <span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>,</span>
<span id="cb1079-17"><a href="monsters-and-mixtures.html#cb1079-17" aria-hidden="true" tabindex="-1"></a>              <span class="at">fill =</span> <span class="st">&quot;navy&quot;</span>,<span class="at">color =</span> <span class="st">&quot;navy&quot;</span>,</span>
<span id="cb1079-18"><a href="monsters-and-mixtures.html#cb1079-18" aria-hidden="true" tabindex="-1"></a>              <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">3</span>)<span class="sc">+</span></span>
<span id="cb1079-19"><a href="monsters-and-mixtures.html#cb1079-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">aspect.ratio=</span><span class="dv">1</span>,</span>
<span id="cb1079-20"><a href="monsters-and-mixtures.html#cb1079-20" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>)<span class="sc">+</span></span>
<span id="cb1079-21"><a href="monsters-and-mixtures.html#cb1079-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">breaks=</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">250</span>,<span class="dv">50</span>))<span class="sc">+</span></span>
<span id="cb1079-22"><a href="monsters-and-mixtures.html#cb1079-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;femininity (std)&quot;</span>,</span>
<span id="cb1079-23"><a href="monsters-and-mixtures.html#cb1079-23" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">&quot;negative binomial&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:b12H2"></span>
<img src="Rethinking_Bookdown_files/figure-html/b12H2-1.png" alt="b12H2の結果を図示したもの" width="672" />
<p class="caption">
図12.13: b12H2の結果を図示したもの
</p>
</div>
</div>
<div id="h3-9" class="section level3 hasAnchor" number="12.5.6">
<h3><span class="header-section-number">12.5.6</span> 12H3<a href="monsters-and-mixtures.html#h3-9" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<blockquote>
<p>In order to infer a strong association between deaths and femininity, it’s necessary to include an interaction effect. In the data, there are two measures of a hurricane’s potential to cause death: damage_norm and min_pressure. Consult ?Hurricanes for their meanings. It makes some sense to imagine that femininity of a name matters more when the hurricane is itself deadly. This implies an interaction between femininity and either or both of damage_norm and min_pressure. Fit a series of models evaluating these interactions. Interpret and compare the models. In interpreting the estimates, it may help to generate counterfactual predictions contrasting hurricanes with masculine and feminine names. Are the effect sizes plausible?</p>
</blockquote>
<p>台風の規模そのものの影響も考慮したモデルを考えるため、min pressure（小さいほど規模は大きい）も入れたモデルを考える。交互作用ありのモデル(b12H3)と交互作用なしのモデル(b12H3b)の両方を考える。</p>
<div class="sourceCode" id="cb1080"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1080-1"><a href="monsters-and-mixtures.html#cb1080-1" aria-hidden="true" tabindex="-1"></a>dat <span class="sc">%&gt;%</span> </span>
<span id="cb1080-2"><a href="monsters-and-mixtures.html#cb1080-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">M =</span> <span class="fu">standardize</span>(min_pressure)) <span class="ot">-&gt;</span> dat</span>
<span id="cb1080-3"><a href="monsters-and-mixtures.html#cb1080-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1080-4"><a href="monsters-and-mixtures.html#cb1080-4" aria-hidden="true" tabindex="-1"></a>b12H3 <span class="ot">&lt;-</span></span>
<span id="cb1080-5"><a href="monsters-and-mixtures.html#cb1080-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">brm</span>(<span class="at">data =</span> dat,</span>
<span id="cb1080-6"><a href="monsters-and-mixtures.html#cb1080-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> negbinomial,</span>
<span id="cb1080-7"><a href="monsters-and-mixtures.html#cb1080-7" aria-hidden="true" tabindex="-1"></a>      deaths <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> F <span class="sc">+</span> M <span class="sc">+</span> F<span class="sc">:</span>M,</span>
<span id="cb1080-8"><a href="monsters-and-mixtures.html#cb1080-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">3</span>, <span class="fl">0.5</span>),<span class="at">class=</span>Intercept),</span>
<span id="cb1080-9"><a href="monsters-and-mixtures.html#cb1080-9" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>,<span class="dv">1</span>),<span class="at">class =</span>b),</span>
<span id="cb1080-10"><a href="monsters-and-mixtures.html#cb1080-10" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>), <span class="at">class =</span> shape)),</span>
<span id="cb1080-11"><a href="monsters-and-mixtures.html#cb1080-11" aria-hidden="true" tabindex="-1"></a>       <span class="at">backend =</span> <span class="st">&quot;cmdstanr&quot;</span>,</span>
<span id="cb1080-12"><a href="monsters-and-mixtures.html#cb1080-12" aria-hidden="true" tabindex="-1"></a>      <span class="at">seed=</span><span class="dv">11</span>, <span class="at">file =</span> <span class="st">&quot;output/Chapter12/b12H3&quot;</span>)</span>
<span id="cb1080-13"><a href="monsters-and-mixtures.html#cb1080-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1080-14"><a href="monsters-and-mixtures.html#cb1080-14" aria-hidden="true" tabindex="-1"></a>b12H3b <span class="ot">&lt;-</span></span>
<span id="cb1080-15"><a href="monsters-and-mixtures.html#cb1080-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">brm</span>(<span class="at">data =</span> dat,</span>
<span id="cb1080-16"><a href="monsters-and-mixtures.html#cb1080-16" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> negbinomial,</span>
<span id="cb1080-17"><a href="monsters-and-mixtures.html#cb1080-17" aria-hidden="true" tabindex="-1"></a>      deaths <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> F <span class="sc">+</span> M,</span>
<span id="cb1080-18"><a href="monsters-and-mixtures.html#cb1080-18" aria-hidden="true" tabindex="-1"></a>      <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">3</span>, <span class="fl">0.5</span>),<span class="at">class=</span>Intercept),</span>
<span id="cb1080-19"><a href="monsters-and-mixtures.html#cb1080-19" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>,<span class="dv">1</span>),<span class="at">class =</span>b),</span>
<span id="cb1080-20"><a href="monsters-and-mixtures.html#cb1080-20" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>), <span class="at">class =</span> shape)),</span>
<span id="cb1080-21"><a href="monsters-and-mixtures.html#cb1080-21" aria-hidden="true" tabindex="-1"></a>       <span class="at">backend =</span> <span class="st">&quot;cmdstanr&quot;</span>,</span>
<span id="cb1080-22"><a href="monsters-and-mixtures.html#cb1080-22" aria-hidden="true" tabindex="-1"></a>      <span class="at">seed=</span><span class="dv">11</span>, <span class="at">file =</span> <span class="st">&quot;output/Chapter12/b12H3b&quot;</span>)</span></code></pre></div>
<p>交互作用ありモデルの結果は以下の通り（表<a href="monsters-and-mixtures.html#tab:res-b12H3">12.13</a>）。交互作用がかなり効いているという結果になった。この結果は、規模が小さくなるほど女性らしさが死者数に与える影響が強くなる、もしくは名前が女性らしくなるほど規模が死者数に与える影響が弱くなることを意味している。</p>
<div class="sourceCode" id="cb1081"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1081-1"><a href="monsters-and-mixtures.html#cb1081-1" aria-hidden="true" tabindex="-1"></a><span class="fu">posterior_summary</span>(b12H3, <span class="at">probs =</span> <span class="fu">c</span>(<span class="fl">0.055</span>,<span class="fl">0.945</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1081-2"><a href="monsters-and-mixtures.html#cb1081-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1081-3"><a href="monsters-and-mixtures.html#cb1081-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>(<span class="at">var =</span> <span class="st">&quot;parameter&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1081-4"><a href="monsters-and-mixtures.html#cb1081-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(parameter<span class="sc">!=</span><span class="st">&quot;lp__&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1081-5"><a href="monsters-and-mixtures.html#cb1081-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="at">booktabs=</span>T,</span>
<span id="cb1081-6"><a href="monsters-and-mixtures.html#cb1081-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">digits=</span><span class="dv">2</span>,</span>
<span id="cb1081-7"><a href="monsters-and-mixtures.html#cb1081-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">caption =</span> <span class="st">&quot;b12H3の結果&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1081-8"><a href="monsters-and-mixtures.html#cb1081-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">latex_options =</span> <span class="fu">c</span>(<span class="st">&quot;stripe&quot;</span>,<span class="st">&quot;hold_position&quot;</span>))</span></code></pre></div>
<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:res-b12H3">表12.13: </span>b12H3の結果
</caption>
<thead>
<tr>
<th style="text-align:left;">
parameter
</th>
<th style="text-align:right;">
Estimate
</th>
<th style="text-align:right;">
Est.Error
</th>
<th style="text-align:right;">
Q5.5
</th>
<th style="text-align:right;">
Q94.5
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
b_Intercept
</td>
<td style="text-align:right;">
2.81
</td>
<td style="text-align:right;">
0.14
</td>
<td style="text-align:right;">
2.59
</td>
<td style="text-align:right;">
3.03
</td>
</tr>
<tr>
<td style="text-align:left;">
b_F
</td>
<td style="text-align:right;">
0.30
</td>
<td style="text-align:right;">
0.15
</td>
<td style="text-align:right;">
0.06
</td>
<td style="text-align:right;">
0.53
</td>
</tr>
<tr>
<td style="text-align:left;">
b_M
</td>
<td style="text-align:right;">
-0.67
</td>
<td style="text-align:right;">
0.14
</td>
<td style="text-align:right;">
-0.90
</td>
<td style="text-align:right;">
-0.45
</td>
</tr>
<tr>
<td style="text-align:left;">
b_F:M
</td>
<td style="text-align:right;">
0.30
</td>
<td style="text-align:right;">
0.15
</td>
<td style="text-align:right;">
0.06
</td>
<td style="text-align:right;">
0.54
</td>
</tr>
<tr>
<td style="text-align:left;">
shape
</td>
<td style="text-align:right;">
0.55
</td>
<td style="text-align:right;">
0.08
</td>
<td style="text-align:right;">
0.43
</td>
<td style="text-align:right;">
0.69
</td>
</tr>
<tr>
<td style="text-align:left;">
lprior
</td>
<td style="text-align:right;">
-4.01
</td>
<td style="text-align:right;">
0.19
</td>
<td style="text-align:right;">
-4.35
</td>
<td style="text-align:right;">
-3.73
</td>
</tr>
</tbody>
</table>
<p>当てはまりの悪い点は1点のみ。</p>
<div class="sourceCode" id="cb1082"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1082-1"><a href="monsters-and-mixtures.html#cb1082-1" aria-hidden="true" tabindex="-1"></a>b12H3 <span class="ot">&lt;-</span> <span class="fu">add_criterion</span>(b12H3, <span class="st">&quot;loo&quot;</span>)</span>
<span id="cb1082-2"><a href="monsters-and-mixtures.html#cb1082-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1082-3"><a href="monsters-and-mixtures.html#cb1082-3" aria-hidden="true" tabindex="-1"></a><span class="fu">loo</span>(b12H3) <span class="sc">%&gt;%</span> </span>
<span id="cb1082-4"><a href="monsters-and-mixtures.html#cb1082-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pareto_k_ids</span>(<span class="at">threshold =</span> .<span class="dv">7</span>)</span></code></pre></div>
<pre><code>## [1] 10</code></pre>
<p>交互作用も入れた方が予測は若干向上する(ただし、ほとんど変わらない)。</p>
<div class="sourceCode" id="cb1084"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1084-1"><a href="monsters-and-mixtures.html#cb1084-1" aria-hidden="true" tabindex="-1"></a>b12H3b <span class="ot">&lt;-</span> <span class="fu">add_criterion</span>(b12H3b, <span class="st">&quot;loo&quot;</span>)</span>
<span id="cb1084-2"><a href="monsters-and-mixtures.html#cb1084-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1084-3"><a href="monsters-and-mixtures.html#cb1084-3" aria-hidden="true" tabindex="-1"></a><span class="fu">loo_compare</span>(b12H3,b12H3b, b12H2) <span class="sc">%&gt;%</span> </span>
<span id="cb1084-4"><a href="monsters-and-mixtures.html#cb1084-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1084-5"><a href="monsters-and-mixtures.html#cb1084-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="at">booktabs =</span> <span class="cn">TRUE</span>,</span>
<span id="cb1084-6"><a href="monsters-and-mixtures.html#cb1084-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">digits=</span><span class="dv">2</span>,</span>
<span id="cb1084-7"><a href="monsters-and-mixtures.html#cb1084-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">caption =</span> <span class="st">&quot;b12H3,b12H3b, b12H2の比較&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1084-8"><a href="monsters-and-mixtures.html#cb1084-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">latex_options =</span> <span class="st">&quot;hold_position&quot;</span>)</span></code></pre></div>
<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:unnamed-chunk-578">表12.14: </span>b12H3,b12H3b, b12H2の比較
</caption>
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
elpd_diff
</th>
<th style="text-align:right;">
se_diff
</th>
<th style="text-align:right;">
elpd_loo
</th>
<th style="text-align:right;">
se_elpd_loo
</th>
<th style="text-align:right;">
p_loo
</th>
<th style="text-align:right;">
se_p_loo
</th>
<th style="text-align:right;">
looic
</th>
<th style="text-align:right;">
se_looic
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
b12H3b
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;">
-348.39
</td>
<td style="text-align:right;">
19.86
</td>
<td style="text-align:right;">
7.80
</td>
<td style="text-align:right;">
4.98
</td>
<td style="text-align:right;">
696.79
</td>
<td style="text-align:right;">
39.72
</td>
</tr>
<tr>
<td style="text-align:left;">
b12H3
</td>
<td style="text-align:right;">
-0.33
</td>
<td style="text-align:right;">
1.48
</td>
<td style="text-align:right;">
-348.73
</td>
<td style="text-align:right;">
19.93
</td>
<td style="text-align:right;">
9.79
</td>
<td style="text-align:right;">
6.14
</td>
<td style="text-align:right;">
697.46
</td>
<td style="text-align:right;">
39.86
</td>
</tr>
<tr>
<td style="text-align:left;">
b12H2
</td>
<td style="text-align:right;">
-6.24
</td>
<td style="text-align:right;">
9.37
</td>
<td style="text-align:right;">
-354.63
</td>
<td style="text-align:right;">
16.04
</td>
<td style="text-align:right;">
3.43
</td>
<td style="text-align:right;">
1.00
</td>
<td style="text-align:right;">
709.26
</td>
<td style="text-align:right;">
32.08
</td>
</tr>
</tbody>
</table>
<p>名前が女性らしいとき(F = 1)と最も男性らしいとき(F = -1)で台風の規模が死者数に与える影響が異なるかを図示すると以下のようになる（図<a href="monsters-and-mixtures.html#fig:12H3">12.14</a>）。</p>
<div class="sourceCode" id="cb1085"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1085-1"><a href="monsters-and-mixtures.html#cb1085-1" aria-hidden="true" tabindex="-1"></a>nd <span class="ot">&lt;-</span> <span class="fu">crossing</span>(<span class="at">F =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>,<span class="dv">1</span>),</span>
<span id="cb1085-2"><a href="monsters-and-mixtures.html#cb1085-2" aria-hidden="true" tabindex="-1"></a>               <span class="at">M =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">3</span>,<span class="dv">2</span>,<span class="at">length.out=</span><span class="dv">100</span>))</span>
<span id="cb1085-3"><a href="monsters-and-mixtures.html#cb1085-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1085-4"><a href="monsters-and-mixtures.html#cb1085-4" aria-hidden="true" tabindex="-1"></a><span class="fu">fitted</span>(b12H3, nd, <span class="at">probs=</span><span class="fu">c</span>(<span class="fl">0.055</span>,<span class="fl">0.945</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1085-5"><a href="monsters-and-mixtures.html#cb1085-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1085-6"><a href="monsters-and-mixtures.html#cb1085-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(nd) <span class="sc">%&gt;%</span> </span>
<span id="cb1085-7"><a href="monsters-and-mixtures.html#cb1085-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">MorF =</span> <span class="fu">factor</span>(F)) <span class="ot">-&gt;</span> fit12H3</span>
<span id="cb1085-8"><a href="monsters-and-mixtures.html#cb1085-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1085-9"><a href="monsters-and-mixtures.html#cb1085-9" aria-hidden="true" tabindex="-1"></a>dat <span class="sc">%&gt;%</span> </span>
<span id="cb1085-10"><a href="monsters-and-mixtures.html#cb1085-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">MorF =</span> <span class="fu">ifelse</span>(F <span class="sc">&gt;</span> <span class="fu">mean</span>(F),<span class="st">&quot;1&quot;</span>,<span class="st">&quot;-1&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1085-11"><a href="monsters-and-mixtures.html#cb1085-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> M))<span class="sc">+</span></span>
<span id="cb1085-12"><a href="monsters-and-mixtures.html#cb1085-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y=</span>deaths, <span class="at">color =</span> MorF),</span>
<span id="cb1085-13"><a href="monsters-and-mixtures.html#cb1085-13" aria-hidden="true" tabindex="-1"></a>             <span class="at">shape =</span><span class="dv">1</span>, <span class="at">stroke =</span> <span class="fl">1.5</span>, <span class="at">size=</span><span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb1085-14"><a href="monsters-and-mixtures.html#cb1085-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">data =</span> fit12H3,</span>
<span id="cb1085-15"><a href="monsters-and-mixtures.html#cb1085-15" aria-hidden="true" tabindex="-1"></a>              <span class="fu">aes</span>(<span class="at">y =</span> Estimate,</span>
<span id="cb1085-16"><a href="monsters-and-mixtures.html#cb1085-16" aria-hidden="true" tabindex="-1"></a>                  <span class="at">ymin =</span> Q5<span class="fl">.5</span>,</span>
<span id="cb1085-17"><a href="monsters-and-mixtures.html#cb1085-17" aria-hidden="true" tabindex="-1"></a>                  <span class="at">ymax =</span> Q94<span class="fl">.5</span>,</span>
<span id="cb1085-18"><a href="monsters-and-mixtures.html#cb1085-18" aria-hidden="true" tabindex="-1"></a>                  <span class="at">color =</span> MorF,</span>
<span id="cb1085-19"><a href="monsters-and-mixtures.html#cb1085-19" aria-hidden="true" tabindex="-1"></a>                  <span class="at">fill =</span> MorF,</span>
<span id="cb1085-20"><a href="monsters-and-mixtures.html#cb1085-20" aria-hidden="true" tabindex="-1"></a>                  <span class="at">linetype=</span>MorF),</span>
<span id="cb1085-21"><a href="monsters-and-mixtures.html#cb1085-21" aria-hidden="true" tabindex="-1"></a>              <span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>)<span class="sc">+</span></span>
<span id="cb1085-22"><a href="monsters-and-mixtures.html#cb1085-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;steelblue1&quot;</span>,<span class="st">&quot;lightcoral&quot;</span>))<span class="sc">+</span></span>
<span id="cb1085-23"><a href="monsters-and-mixtures.html#cb1085-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;steelblue1&quot;</span>,<span class="st">&quot;lightcoral&quot;</span>))<span class="sc">+</span></span>
<span id="cb1085-24"><a href="monsters-and-mixtures.html#cb1085-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">300</span>))<span class="sc">+</span></span>
<span id="cb1085-25"><a href="monsters-and-mixtures.html#cb1085-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x=</span><span class="st">&quot;minimum pressure (std)&quot;</span>)<span class="sc">+</span></span>
<span id="cb1085-26"><a href="monsters-and-mixtures.html#cb1085-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">aspect.ratio=</span><span class="dv">1</span>,</span>
<span id="cb1085-27"><a href="monsters-and-mixtures.html#cb1085-27" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:12H3"></span>
<img src="Rethinking_Bookdown_files/figure-html/12H3-1.png" alt="b12H3の推定結果。点は、Fが0以下のものを水色、0以上のものをピンクとしており、回帰曲線は水色がF=-1, ピンクがF=1のときを表す。塗りつぶしは89%信用区間である。" width="672" />
<p class="caption">
図12.14: b12H3の推定結果。点は、Fが0以下のものを水色、0以上のものをピンクとしており、回帰曲線は水色がF=-1, ピンクがF=1のときを表す。塗りつぶしは89%信用区間である。
</p>
</div>
<p>続いて、台風の損害(ドル換算)と名前の女性らしさの交互作用を考慮したモデルを考える。</p>
<div class="sourceCode" id="cb1086"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1086-1"><a href="monsters-and-mixtures.html#cb1086-1" aria-hidden="true" tabindex="-1"></a>dat <span class="sc">%&gt;%</span> </span>
<span id="cb1086-2"><a href="monsters-and-mixtures.html#cb1086-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">D =</span> <span class="fu">standardize</span>(damage_norm)) <span class="ot">-&gt;</span> dat</span>
<span id="cb1086-3"><a href="monsters-and-mixtures.html#cb1086-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1086-4"><a href="monsters-and-mixtures.html#cb1086-4" aria-hidden="true" tabindex="-1"></a>b12H3_2 <span class="ot">&lt;-</span></span>
<span id="cb1086-5"><a href="monsters-and-mixtures.html#cb1086-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">brm</span>(<span class="at">data =</span> dat,</span>
<span id="cb1086-6"><a href="monsters-and-mixtures.html#cb1086-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> negbinomial,</span>
<span id="cb1086-7"><a href="monsters-and-mixtures.html#cb1086-7" aria-hidden="true" tabindex="-1"></a>      deaths <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> F <span class="sc">+</span> D <span class="sc">+</span> F<span class="sc">:</span>D,</span>
<span id="cb1086-8"><a href="monsters-and-mixtures.html#cb1086-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">3</span>, <span class="fl">0.5</span>),<span class="at">class=</span>Intercept),</span>
<span id="cb1086-9"><a href="monsters-and-mixtures.html#cb1086-9" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>,<span class="dv">1</span>),<span class="at">class =</span>b),</span>
<span id="cb1086-10"><a href="monsters-and-mixtures.html#cb1086-10" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>), <span class="at">class =</span> shape)),</span>
<span id="cb1086-11"><a href="monsters-and-mixtures.html#cb1086-11" aria-hidden="true" tabindex="-1"></a>       <span class="at">backend =</span> <span class="st">&quot;cmdstanr&quot;</span>,</span>
<span id="cb1086-12"><a href="monsters-and-mixtures.html#cb1086-12" aria-hidden="true" tabindex="-1"></a>      <span class="at">seed=</span><span class="dv">11</span>, <span class="at">file =</span> <span class="st">&quot;output/Chapter12/b12H3_2&quot;</span>)</span>
<span id="cb1086-13"><a href="monsters-and-mixtures.html#cb1086-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1086-14"><a href="monsters-and-mixtures.html#cb1086-14" aria-hidden="true" tabindex="-1"></a>b12H3_2b <span class="ot">&lt;-</span></span>
<span id="cb1086-15"><a href="monsters-and-mixtures.html#cb1086-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">brm</span>(<span class="at">data =</span> dat,</span>
<span id="cb1086-16"><a href="monsters-and-mixtures.html#cb1086-16" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> negbinomial,</span>
<span id="cb1086-17"><a href="monsters-and-mixtures.html#cb1086-17" aria-hidden="true" tabindex="-1"></a>      deaths <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> F <span class="sc">+</span> D,</span>
<span id="cb1086-18"><a href="monsters-and-mixtures.html#cb1086-18" aria-hidden="true" tabindex="-1"></a>      <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">3</span>, <span class="fl">0.5</span>),<span class="at">class=</span>Intercept),</span>
<span id="cb1086-19"><a href="monsters-and-mixtures.html#cb1086-19" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>,<span class="dv">1</span>),<span class="at">class =</span>b),</span>
<span id="cb1086-20"><a href="monsters-and-mixtures.html#cb1086-20" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>), <span class="at">class =</span> shape)),</span>
<span id="cb1086-21"><a href="monsters-and-mixtures.html#cb1086-21" aria-hidden="true" tabindex="-1"></a>       <span class="at">backend =</span> <span class="st">&quot;cmdstanr&quot;</span>,</span>
<span id="cb1086-22"><a href="monsters-and-mixtures.html#cb1086-22" aria-hidden="true" tabindex="-1"></a>      <span class="at">seed=</span><span class="dv">11</span>, <span class="at">file =</span> <span class="st">&quot;output/Chapter12/b12H3_2b&quot;</span>)</span></code></pre></div>
<p>交互作用ありモデルの結果は以下の通り（表<a href="monsters-and-mixtures.html#tab:res-b12H3-2">12.15</a>）。被害の大きさがかなり強く影響しており、名前の女性らしさの影響が小さくなっていることが分かる。交互作用もありそう。</p>
<div class="sourceCode" id="cb1087"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1087-1"><a href="monsters-and-mixtures.html#cb1087-1" aria-hidden="true" tabindex="-1"></a><span class="fu">posterior_summary</span>(b12H3_2, <span class="at">probs =</span> <span class="fu">c</span>(<span class="fl">0.055</span>,<span class="fl">0.945</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1087-2"><a href="monsters-and-mixtures.html#cb1087-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1087-3"><a href="monsters-and-mixtures.html#cb1087-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>(<span class="at">var =</span> <span class="st">&quot;parameter&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1087-4"><a href="monsters-and-mixtures.html#cb1087-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(parameter<span class="sc">!=</span><span class="st">&quot;lp__&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1087-5"><a href="monsters-and-mixtures.html#cb1087-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="at">booktabs=</span>T,</span>
<span id="cb1087-6"><a href="monsters-and-mixtures.html#cb1087-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">digits=</span><span class="dv">2</span>,</span>
<span id="cb1087-7"><a href="monsters-and-mixtures.html#cb1087-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">caption =</span> <span class="st">&quot;b12H3_2の結果&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1087-8"><a href="monsters-and-mixtures.html#cb1087-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">latex_options =</span> <span class="fu">c</span>(<span class="st">&quot;stripe&quot;</span>,<span class="st">&quot;hold_position&quot;</span>))  </span></code></pre></div>
<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:res-b12H3-2">表12.15: </span>b12H3_2の結果
</caption>
<thead>
<tr>
<th style="text-align:left;">
parameter
</th>
<th style="text-align:right;">
Estimate
</th>
<th style="text-align:right;">
Est.Error
</th>
<th style="text-align:right;">
Q5.5
</th>
<th style="text-align:right;">
Q94.5
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
b_Intercept
</td>
<td style="text-align:right;">
2.62
</td>
<td style="text-align:right;">
0.13
</td>
<td style="text-align:right;">
2.41
</td>
<td style="text-align:right;">
2.84
</td>
</tr>
<tr>
<td style="text-align:left;">
b_F
</td>
<td style="text-align:right;">
0.09
</td>
<td style="text-align:right;">
0.13
</td>
<td style="text-align:right;">
-0.13
</td>
<td style="text-align:right;">
0.29
</td>
</tr>
<tr>
<td style="text-align:left;">
b_D
</td>
<td style="text-align:right;">
1.24
</td>
<td style="text-align:right;">
0.22
</td>
<td style="text-align:right;">
0.91
</td>
<td style="text-align:right;">
1.60
</td>
</tr>
<tr>
<td style="text-align:left;">
b_F:D
</td>
<td style="text-align:right;">
0.31
</td>
<td style="text-align:right;">
0.20
</td>
<td style="text-align:right;">
-0.03
</td>
<td style="text-align:right;">
0.63
</td>
</tr>
<tr>
<td style="text-align:left;">
shape
</td>
<td style="text-align:right;">
0.68
</td>
<td style="text-align:right;">
0.10
</td>
<td style="text-align:right;">
0.53
</td>
<td style="text-align:right;">
0.85
</td>
</tr>
<tr>
<td style="text-align:left;">
lprior
</td>
<td style="text-align:right;">
-4.88
</td>
<td style="text-align:right;">
0.38
</td>
<td style="text-align:right;">
-5.52
</td>
<td style="text-align:right;">
-4.30
</td>
</tr>
</tbody>
</table>
<p>当てはまりの悪い点はなさそう。</p>
<div class="sourceCode" id="cb1088"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1088-1"><a href="monsters-and-mixtures.html#cb1088-1" aria-hidden="true" tabindex="-1"></a>b12H3_2 <span class="ot">&lt;-</span> <span class="fu">add_criterion</span>(b12H3_2, <span class="st">&quot;loo&quot;</span>)</span>
<span id="cb1088-2"><a href="monsters-and-mixtures.html#cb1088-2" aria-hidden="true" tabindex="-1"></a>b12H3_2b <span class="ot">&lt;-</span> <span class="fu">add_criterion</span>(b12H3_2b, <span class="st">&quot;loo&quot;</span>)</span>
<span id="cb1088-3"><a href="monsters-and-mixtures.html#cb1088-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1088-4"><a href="monsters-and-mixtures.html#cb1088-4" aria-hidden="true" tabindex="-1"></a><span class="fu">loo</span>(b12H3) <span class="sc">%&gt;%</span> </span>
<span id="cb1088-5"><a href="monsters-and-mixtures.html#cb1088-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pareto_k_ids</span>(<span class="at">threshold =</span> .<span class="dv">7</span>)</span></code></pre></div>
<pre><code>## [1] 10</code></pre>
<p>交互作用が入ったモデルの方が若干よいが、あまり変わらない。</p>
<div class="sourceCode" id="cb1090"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1090-1"><a href="monsters-and-mixtures.html#cb1090-1" aria-hidden="true" tabindex="-1"></a><span class="fu">loo_compare</span>(b12H3_2,b12H3_2b) <span class="sc">%&gt;%</span> </span>
<span id="cb1090-2"><a href="monsters-and-mixtures.html#cb1090-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1090-3"><a href="monsters-and-mixtures.html#cb1090-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="at">booktabs =</span> <span class="cn">TRUE</span>,</span>
<span id="cb1090-4"><a href="monsters-and-mixtures.html#cb1090-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">digits=</span><span class="dv">2</span>)</span></code></pre></div>
<table>
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
elpd_diff
</th>
<th style="text-align:right;">
se_diff
</th>
<th style="text-align:right;">
elpd_loo
</th>
<th style="text-align:right;">
se_elpd_loo
</th>
<th style="text-align:right;">
p_loo
</th>
<th style="text-align:right;">
se_p_loo
</th>
<th style="text-align:right;">
looic
</th>
<th style="text-align:right;">
se_looic
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
b12H3_2b
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;">
-335.36
</td>
<td style="text-align:right;">
16.57
</td>
<td style="text-align:right;">
5.33
</td>
<td style="text-align:right;">
1.30
</td>
<td style="text-align:right;">
670.72
</td>
<td style="text-align:right;">
33.14
</td>
</tr>
<tr>
<td style="text-align:left;">
b12H3_2
</td>
<td style="text-align:right;">
-0.04
</td>
<td style="text-align:right;">
2.15
</td>
<td style="text-align:right;">
-335.40
</td>
<td style="text-align:right;">
16.74
</td>
<td style="text-align:right;">
6.73
</td>
<td style="text-align:right;">
1.67
</td>
<td style="text-align:right;">
670.80
</td>
<td style="text-align:right;">
33.49
</td>
</tr>
</tbody>
</table>
<p>名前が女性らしいとき(F = 1)と最も男性らしいとき(F = -1)で被害規模が死者数に与える影響が異なるかを図示すると以下のようになる（図<a href="monsters-and-mixtures.html#fig:12H3-2">12.15</a>）。名前が女性らしいときに若干死者数は大きくなる。</p>
<div class="sourceCode" id="cb1091"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1091-1"><a href="monsters-and-mixtures.html#cb1091-1" aria-hidden="true" tabindex="-1"></a>nd <span class="ot">&lt;-</span> <span class="fu">crossing</span>(<span class="at">F =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>,<span class="dv">1</span>),</span>
<span id="cb1091-2"><a href="monsters-and-mixtures.html#cb1091-2" aria-hidden="true" tabindex="-1"></a>               <span class="at">D =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">1</span>,<span class="fl">5.5</span>,<span class="at">length.out=</span><span class="dv">100</span>))</span>
<span id="cb1091-3"><a href="monsters-and-mixtures.html#cb1091-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1091-4"><a href="monsters-and-mixtures.html#cb1091-4" aria-hidden="true" tabindex="-1"></a><span class="fu">fitted</span>(b12H3_2, nd, <span class="at">probs=</span><span class="fu">c</span>(<span class="fl">0.055</span>,<span class="fl">0.945</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1091-5"><a href="monsters-and-mixtures.html#cb1091-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1091-6"><a href="monsters-and-mixtures.html#cb1091-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(nd) <span class="sc">%&gt;%</span> </span>
<span id="cb1091-7"><a href="monsters-and-mixtures.html#cb1091-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">MorF =</span> <span class="fu">factor</span>(F)) <span class="ot">-&gt;</span> fit12H3_2</span>
<span id="cb1091-8"><a href="monsters-and-mixtures.html#cb1091-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1091-9"><a href="monsters-and-mixtures.html#cb1091-9" aria-hidden="true" tabindex="-1"></a>dat <span class="sc">%&gt;%</span> </span>
<span id="cb1091-10"><a href="monsters-and-mixtures.html#cb1091-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">MorF =</span> <span class="fu">ifelse</span>(F <span class="sc">&gt;</span> <span class="fu">mean</span>(F),<span class="st">&quot;1&quot;</span>,<span class="st">&quot;-1&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1091-11"><a href="monsters-and-mixtures.html#cb1091-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> D))<span class="sc">+</span></span>
<span id="cb1091-12"><a href="monsters-and-mixtures.html#cb1091-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y=</span>deaths, <span class="at">color =</span> MorF),</span>
<span id="cb1091-13"><a href="monsters-and-mixtures.html#cb1091-13" aria-hidden="true" tabindex="-1"></a>             <span class="at">shape =</span><span class="dv">1</span>, <span class="at">stroke =</span> <span class="fl">1.5</span>, <span class="at">size=</span><span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb1091-14"><a href="monsters-and-mixtures.html#cb1091-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">data =</span> fit12H3_2,</span>
<span id="cb1091-15"><a href="monsters-and-mixtures.html#cb1091-15" aria-hidden="true" tabindex="-1"></a>              <span class="fu">aes</span>(<span class="at">y =</span> Estimate,</span>
<span id="cb1091-16"><a href="monsters-and-mixtures.html#cb1091-16" aria-hidden="true" tabindex="-1"></a>                  <span class="at">ymin =</span> Q5<span class="fl">.5</span>,</span>
<span id="cb1091-17"><a href="monsters-and-mixtures.html#cb1091-17" aria-hidden="true" tabindex="-1"></a>                  <span class="at">ymax =</span> Q94<span class="fl">.5</span>,</span>
<span id="cb1091-18"><a href="monsters-and-mixtures.html#cb1091-18" aria-hidden="true" tabindex="-1"></a>                  <span class="at">color =</span> MorF,</span>
<span id="cb1091-19"><a href="monsters-and-mixtures.html#cb1091-19" aria-hidden="true" tabindex="-1"></a>                  <span class="at">fill =</span> MorF,</span>
<span id="cb1091-20"><a href="monsters-and-mixtures.html#cb1091-20" aria-hidden="true" tabindex="-1"></a>                  <span class="at">linetype=</span>MorF),</span>
<span id="cb1091-21"><a href="monsters-and-mixtures.html#cb1091-21" aria-hidden="true" tabindex="-1"></a>              <span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>)<span class="sc">+</span></span>
<span id="cb1091-22"><a href="monsters-and-mixtures.html#cb1091-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;steelblue1&quot;</span>,<span class="st">&quot;lightcoral&quot;</span>))<span class="sc">+</span></span>
<span id="cb1091-23"><a href="monsters-and-mixtures.html#cb1091-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;steelblue1&quot;</span>,<span class="st">&quot;lightcoral&quot;</span>))<span class="sc">+</span></span>
<span id="cb1091-24"><a href="monsters-and-mixtures.html#cb1091-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">300</span>))<span class="sc">+</span></span>
<span id="cb1091-25"><a href="monsters-and-mixtures.html#cb1091-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;damage (std)&quot;</span>)<span class="sc">+</span></span>
<span id="cb1091-26"><a href="monsters-and-mixtures.html#cb1091-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">aspect.ratio=</span><span class="dv">1</span>,</span>
<span id="cb1091-27"><a href="monsters-and-mixtures.html#cb1091-27" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:12H3-2"></span>
<img src="Rethinking_Bookdown_files/figure-html/12H3-2-1.png" alt="b12H3_2の推定結果。点は、Fが0以下のものを水色、0以上のものをピンクとしており、回帰曲線は水色がF=-1, ピンクがF=1のときを表す。塗りつぶしは89%信用区間である。" width="672" />
<p class="caption">
図12.15: b12H3_2の推定結果。点は、Fが0以下のものを水色、0以上のものをピンクとしており、回帰曲線は水色がF=-1, ピンクがF=1のときを表す。塗りつぶしは89%信用区間である。
</p>
</div>
<p>ここで、これまで出てきたすべての変数とその交互作用を入れたモデルを考える(なお、MとDの交互作用は入れない)。</p>
<div class="sourceCode" id="cb1092"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1092-1"><a href="monsters-and-mixtures.html#cb1092-1" aria-hidden="true" tabindex="-1"></a>b12H3_all <span class="ot">&lt;-</span></span>
<span id="cb1092-2"><a href="monsters-and-mixtures.html#cb1092-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">brm</span>(<span class="at">data =</span> dat,</span>
<span id="cb1092-3"><a href="monsters-and-mixtures.html#cb1092-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> negbinomial,</span>
<span id="cb1092-4"><a href="monsters-and-mixtures.html#cb1092-4" aria-hidden="true" tabindex="-1"></a>      deaths <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> F <span class="sc">+</span> D <span class="sc">+</span> F<span class="sc">:</span>D <span class="sc">+</span> M <span class="sc">+</span> F<span class="sc">:</span>M,</span>
<span id="cb1092-5"><a href="monsters-and-mixtures.html#cb1092-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">3</span>, <span class="fl">0.5</span>),<span class="at">class=</span>Intercept),</span>
<span id="cb1092-6"><a href="monsters-and-mixtures.html#cb1092-6" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>,<span class="dv">1</span>),<span class="at">class =</span>b),</span>
<span id="cb1092-7"><a href="monsters-and-mixtures.html#cb1092-7" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>), <span class="at">class =</span> shape)),</span>
<span id="cb1092-8"><a href="monsters-and-mixtures.html#cb1092-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">backend =</span> <span class="st">&quot;cmdstanr&quot;</span>,</span>
<span id="cb1092-9"><a href="monsters-and-mixtures.html#cb1092-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">seed=</span><span class="dv">11</span>, <span class="at">file =</span> <span class="st">&quot;output/Chapter12/b12H3_all&quot;</span>)</span>
<span id="cb1092-10"><a href="monsters-and-mixtures.html#cb1092-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1092-11"><a href="monsters-and-mixtures.html#cb1092-11" aria-hidden="true" tabindex="-1"></a>b12H3_all <span class="ot">&lt;-</span> <span class="fu">add_criterion</span>(b12H3_all, <span class="st">&quot;loo&quot;</span>)</span></code></pre></div>
<p>これまでの全てのモデルのPSISを比べてみると、全部入れたモデル(<code>b12H3_all</code>)が最も予測がよいことが分かる。<code>b12H3_2</code>と<code>b12H3_2b</code>はそれより少し悪くなり、それ以外はもっと悪い。</p>
<div class="sourceCode" id="cb1093"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1093-1"><a href="monsters-and-mixtures.html#cb1093-1" aria-hidden="true" tabindex="-1"></a><span class="fu">loo_compare</span>(b12H3_2,b12H2,b12H3, b12H3b, b12H3_2b, b12H3_all) <span class="sc">%&gt;%</span></span>
<span id="cb1093-2"><a href="monsters-and-mixtures.html#cb1093-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1093-3"><a href="monsters-and-mixtures.html#cb1093-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="at">booktabs =</span> <span class="cn">TRUE</span>,</span>
<span id="cb1093-4"><a href="monsters-and-mixtures.html#cb1093-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">digits=</span><span class="dv">2</span>,</span>
<span id="cb1093-5"><a href="monsters-and-mixtures.html#cb1093-5" aria-hidden="true" tabindex="-1"></a>        <span class="at">caption =</span> <span class="st">&quot;全モデルの比較&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1093-6"><a href="monsters-and-mixtures.html#cb1093-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">latex_options =</span> <span class="st">&quot;hold_position&quot;</span>)</span></code></pre></div>
<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:unnamed-chunk-583">表12.16: </span>全モデルの比較
</caption>
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
elpd_diff
</th>
<th style="text-align:right;">
se_diff
</th>
<th style="text-align:right;">
elpd_loo
</th>
<th style="text-align:right;">
se_elpd_loo
</th>
<th style="text-align:right;">
p_loo
</th>
<th style="text-align:right;">
se_p_loo
</th>
<th style="text-align:right;">
looic
</th>
<th style="text-align:right;">
se_looic
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
b12H3_all
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;">
-333.35
</td>
<td style="text-align:right;">
18.08
</td>
<td style="text-align:right;">
10.06
</td>
<td style="text-align:right;">
3.88
</td>
<td style="text-align:right;">
666.70
</td>
<td style="text-align:right;">
36.16
</td>
</tr>
<tr>
<td style="text-align:left;">
b12H3_2b
</td>
<td style="text-align:right;">
-2.01
</td>
<td style="text-align:right;">
5.09
</td>
<td style="text-align:right;">
-335.36
</td>
<td style="text-align:right;">
16.57
</td>
<td style="text-align:right;">
5.33
</td>
<td style="text-align:right;">
1.30
</td>
<td style="text-align:right;">
670.72
</td>
<td style="text-align:right;">
33.14
</td>
</tr>
<tr>
<td style="text-align:left;">
b12H3_2
</td>
<td style="text-align:right;">
-2.05
</td>
<td style="text-align:right;">
4.81
</td>
<td style="text-align:right;">
-335.40
</td>
<td style="text-align:right;">
16.74
</td>
<td style="text-align:right;">
6.73
</td>
<td style="text-align:right;">
1.67
</td>
<td style="text-align:right;">
670.80
</td>
<td style="text-align:right;">
33.49
</td>
</tr>
<tr>
<td style="text-align:left;">
b12H3b
</td>
<td style="text-align:right;">
-15.04
</td>
<td style="text-align:right;">
7.17
</td>
<td style="text-align:right;">
-348.39
</td>
<td style="text-align:right;">
19.86
</td>
<td style="text-align:right;">
7.80
</td>
<td style="text-align:right;">
4.98
</td>
<td style="text-align:right;">
696.79
</td>
<td style="text-align:right;">
39.72
</td>
</tr>
<tr>
<td style="text-align:left;">
b12H3
</td>
<td style="text-align:right;">
-15.38
</td>
<td style="text-align:right;">
7.00
</td>
<td style="text-align:right;">
-348.73
</td>
<td style="text-align:right;">
19.93
</td>
<td style="text-align:right;">
9.79
</td>
<td style="text-align:right;">
6.14
</td>
<td style="text-align:right;">
697.46
</td>
<td style="text-align:right;">
39.86
</td>
</tr>
<tr>
<td style="text-align:left;">
b12H2
</td>
<td style="text-align:right;">
-21.28
</td>
<td style="text-align:right;">
6.89
</td>
<td style="text-align:right;">
-354.63
</td>
<td style="text-align:right;">
16.04
</td>
<td style="text-align:right;">
3.43
</td>
<td style="text-align:right;">
1.00
</td>
<td style="text-align:right;">
709.26
</td>
<td style="text-align:right;">
32.08
</td>
</tr>
</tbody>
</table>
<p>全部入れたモデルの結果は以下の通り（表<a href="monsters-and-mixtures.html#tab:res-b12H3-all">12.17</a>）。D, Mが強く効いており、D:F, M:Fも効いていそう。</p>
<div class="sourceCode" id="cb1094"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1094-1"><a href="monsters-and-mixtures.html#cb1094-1" aria-hidden="true" tabindex="-1"></a><span class="fu">posterior_summary</span>(b12H3_all, <span class="at">probs =</span> <span class="fu">c</span>(<span class="fl">0.055</span>,<span class="fl">0.945</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1094-2"><a href="monsters-and-mixtures.html#cb1094-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1094-3"><a href="monsters-and-mixtures.html#cb1094-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>(<span class="at">var =</span> <span class="st">&quot;parameter&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1094-4"><a href="monsters-and-mixtures.html#cb1094-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(parameter<span class="sc">!=</span><span class="st">&quot;lp__&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1094-5"><a href="monsters-and-mixtures.html#cb1094-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="at">booktabs=</span>T,</span>
<span id="cb1094-6"><a href="monsters-and-mixtures.html#cb1094-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">digits=</span><span class="dv">2</span>,</span>
<span id="cb1094-7"><a href="monsters-and-mixtures.html#cb1094-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">caption =</span> <span class="st">&quot;b12H3_allの結果&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1094-8"><a href="monsters-and-mixtures.html#cb1094-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">latex_options =</span> <span class="fu">c</span>(<span class="st">&quot;stripe&quot;</span>,<span class="st">&quot;hold_position&quot;</span>))</span></code></pre></div>
<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:res-b12H3-all">表12.17: </span>b12H3_allの結果
</caption>
<thead>
<tr>
<th style="text-align:left;">
parameter
</th>
<th style="text-align:right;">
Estimate
</th>
<th style="text-align:right;">
Est.Error
</th>
<th style="text-align:right;">
Q5.5
</th>
<th style="text-align:right;">
Q94.5
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
b_Intercept
</td>
<td style="text-align:right;">
2.57
</td>
<td style="text-align:right;">
0.13
</td>
<td style="text-align:right;">
2.37
</td>
<td style="text-align:right;">
2.78
</td>
</tr>
<tr>
<td style="text-align:left;">
b_F
</td>
<td style="text-align:right;">
0.11
</td>
<td style="text-align:right;">
0.13
</td>
<td style="text-align:right;">
-0.10
</td>
<td style="text-align:right;">
0.32
</td>
</tr>
<tr>
<td style="text-align:left;">
b_D
</td>
<td style="text-align:right;">
0.93
</td>
<td style="text-align:right;">
0.22
</td>
<td style="text-align:right;">
0.58
</td>
<td style="text-align:right;">
1.29
</td>
</tr>
<tr>
<td style="text-align:left;">
b_M
</td>
<td style="text-align:right;">
-0.52
</td>
<td style="text-align:right;">
0.16
</td>
<td style="text-align:right;">
-0.79
</td>
<td style="text-align:right;">
-0.25
</td>
</tr>
<tr>
<td style="text-align:left;">
b_F:D
</td>
<td style="text-align:right;">
0.59
</td>
<td style="text-align:right;">
0.21
</td>
<td style="text-align:right;">
0.25
</td>
<td style="text-align:right;">
0.91
</td>
</tr>
<tr>
<td style="text-align:left;">
b_F:M
</td>
<td style="text-align:right;">
0.34
</td>
<td style="text-align:right;">
0.18
</td>
<td style="text-align:right;">
0.06
</td>
<td style="text-align:right;">
0.62
</td>
</tr>
<tr>
<td style="text-align:left;">
shape
</td>
<td style="text-align:right;">
0.75
</td>
<td style="text-align:right;">
0.12
</td>
<td style="text-align:right;">
0.58
</td>
<td style="text-align:right;">
0.94
</td>
</tr>
<tr>
<td style="text-align:left;">
lprior
</td>
<td style="text-align:right;">
-6.91
</td>
<td style="text-align:right;">
0.37
</td>
<td style="text-align:right;">
-7.53
</td>
<td style="text-align:right;">
-6.33
</td>
</tr>
</tbody>
</table>
</div>
<div id="h4-9" class="section level3 hasAnchor" number="12.5.7">
<h3><span class="header-section-number">12.5.7</span> 12H4<a href="monsters-and-mixtures.html#h4-9" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<blockquote>
<p>In the original hurricanes paper, storm damage (damage_norm) was used directly. This assumption implies that mortality increases exponentially with a linear increase in storm strength, because a Poisson regression uses a log link. So it’s worth exploring an alternative hypothesis: that the logarithm of storm strength is what matters. Explore this by using the logarithm of damage_norm as a predictor. Using the best model structure from the previous problem, compare a model that uses log(damage_norm) to a model that uses damage_norm directly. Compare their DIC/WAIC values as well as their implied predictions. What do you conclude?</p>
</blockquote>
<p>damageの対数をとったものを説明変数とする。</p>
<div class="sourceCode" id="cb1095"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1095-1"><a href="monsters-and-mixtures.html#cb1095-1" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span>  dat <span class="sc">%&gt;%</span> </span>
<span id="cb1095-2"><a href="monsters-and-mixtures.html#cb1095-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">logD =</span> <span class="fu">standardize</span>(<span class="fu">log</span>(damage_norm)))</span>
<span id="cb1095-3"><a href="monsters-and-mixtures.html#cb1095-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1095-4"><a href="monsters-and-mixtures.html#cb1095-4" aria-hidden="true" tabindex="-1"></a>b12H4 <span class="ot">&lt;-</span></span>
<span id="cb1095-5"><a href="monsters-and-mixtures.html#cb1095-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">brm</span>(<span class="at">data =</span> dat,</span>
<span id="cb1095-6"><a href="monsters-and-mixtures.html#cb1095-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> negbinomial,</span>
<span id="cb1095-7"><a href="monsters-and-mixtures.html#cb1095-7" aria-hidden="true" tabindex="-1"></a>      deaths <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> F <span class="sc">+</span> logD <span class="sc">+</span> F<span class="sc">:</span>logD <span class="sc">+</span> M <span class="sc">+</span> F<span class="sc">:</span>M,</span>
<span id="cb1095-8"><a href="monsters-and-mixtures.html#cb1095-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">3</span>, <span class="fl">0.5</span>),<span class="at">class=</span>Intercept),</span>
<span id="cb1095-9"><a href="monsters-and-mixtures.html#cb1095-9" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>,<span class="dv">1</span>),<span class="at">class =</span>b),</span>
<span id="cb1095-10"><a href="monsters-and-mixtures.html#cb1095-10" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>), <span class="at">class =</span> shape)),</span>
<span id="cb1095-11"><a href="monsters-and-mixtures.html#cb1095-11" aria-hidden="true" tabindex="-1"></a>       <span class="at">backend =</span> <span class="st">&quot;cmdstanr&quot;</span>,</span>
<span id="cb1095-12"><a href="monsters-and-mixtures.html#cb1095-12" aria-hidden="true" tabindex="-1"></a>      <span class="at">seed=</span><span class="dv">11</span>, <span class="at">file =</span> <span class="st">&quot;output/Chapter12/b12H4&quot;</span>)</span>
<span id="cb1095-13"><a href="monsters-and-mixtures.html#cb1095-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1095-14"><a href="monsters-and-mixtures.html#cb1095-14" aria-hidden="true" tabindex="-1"></a>b12H4 <span class="ot">&lt;-</span> <span class="fu">add_criterion</span>(b12H4, <span class="st">&quot;loo&quot;</span>)</span></code></pre></div>
<p><code>b12H3_all</code>とモデル比較をしてみると、<code>b12H4</code>の方がかなり良いことが分かる。</p>
<div class="sourceCode" id="cb1096"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1096-1"><a href="monsters-and-mixtures.html#cb1096-1" aria-hidden="true" tabindex="-1"></a><span class="fu">loo_compare</span>(b12H3_all, b12H4) <span class="sc">%&gt;%</span></span>
<span id="cb1096-2"><a href="monsters-and-mixtures.html#cb1096-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1096-3"><a href="monsters-and-mixtures.html#cb1096-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="at">booktabs =</span> <span class="cn">TRUE</span>,</span>
<span id="cb1096-4"><a href="monsters-and-mixtures.html#cb1096-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">digits=</span><span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1096-5"><a href="monsters-and-mixtures.html#cb1096-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">latex_options =</span> <span class="st">&quot;hold_position&quot;</span>)</span></code></pre></div>
<table class="table" style="margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
elpd_diff
</th>
<th style="text-align:right;">
se_diff
</th>
<th style="text-align:right;">
elpd_loo
</th>
<th style="text-align:right;">
se_elpd_loo
</th>
<th style="text-align:right;">
p_loo
</th>
<th style="text-align:right;">
se_p_loo
</th>
<th style="text-align:right;">
looic
</th>
<th style="text-align:right;">
se_looic
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
b12H4
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;">
-318.82
</td>
<td style="text-align:right;">
16.06
</td>
<td style="text-align:right;">
8.81
</td>
<td style="text-align:right;">
2.68
</td>
<td style="text-align:right;">
637.65
</td>
<td style="text-align:right;">
32.11
</td>
</tr>
<tr>
<td style="text-align:left;">
b12H3_all
</td>
<td style="text-align:right;">
-14.53
</td>
<td style="text-align:right;">
6.85
</td>
<td style="text-align:right;">
-333.35
</td>
<td style="text-align:right;">
18.08
</td>
<td style="text-align:right;">
10.06
</td>
<td style="text-align:right;">
3.88
</td>
<td style="text-align:right;">
666.70
</td>
<td style="text-align:right;">
36.16
</td>
</tr>
</tbody>
</table>
<p>結果は以下の通り（表<a href="monsters-and-mixtures.html#tab:res-b12H4">12.18</a>）。logD以外はほとんど推定値が0に近くなり、いずれも89%CIが0にかぶっている。</p>
<div class="sourceCode" id="cb1097"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1097-1"><a href="monsters-and-mixtures.html#cb1097-1" aria-hidden="true" tabindex="-1"></a><span class="fu">posterior_summary</span>(b12H4, <span class="at">probs =</span> <span class="fu">c</span>(<span class="fl">0.055</span>,<span class="fl">0.945</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1097-2"><a href="monsters-and-mixtures.html#cb1097-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1097-3"><a href="monsters-and-mixtures.html#cb1097-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>(<span class="at">var =</span> <span class="st">&quot;parameter&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1097-4"><a href="monsters-and-mixtures.html#cb1097-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(parameter<span class="sc">!=</span><span class="st">&quot;lp__&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1097-5"><a href="monsters-and-mixtures.html#cb1097-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="at">booktabs=</span>T,</span>
<span id="cb1097-6"><a href="monsters-and-mixtures.html#cb1097-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">digits=</span><span class="dv">2</span>,</span>
<span id="cb1097-7"><a href="monsters-and-mixtures.html#cb1097-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">caption =</span> <span class="st">&quot;b12H4の結果&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1097-8"><a href="monsters-and-mixtures.html#cb1097-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">latex_options =</span> <span class="fu">c</span>(<span class="st">&quot;stripe&quot;</span>,<span class="st">&quot;hold_position&quot;</span>))</span></code></pre></div>
<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:res-b12H4">表12.18: </span>b12H4の結果
</caption>
<thead>
<tr>
<th style="text-align:left;">
parameter
</th>
<th style="text-align:right;">
Estimate
</th>
<th style="text-align:right;">
Est.Error
</th>
<th style="text-align:right;">
Q5.5
</th>
<th style="text-align:right;">
Q94.5
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
b_Intercept
</td>
<td style="text-align:right;">
2.30
</td>
<td style="text-align:right;">
0.12
</td>
<td style="text-align:right;">
2.11
</td>
<td style="text-align:right;">
2.49
</td>
</tr>
<tr>
<td style="text-align:left;">
b_F
</td>
<td style="text-align:right;">
0.03
</td>
<td style="text-align:right;">
0.12
</td>
<td style="text-align:right;">
-0.16
</td>
<td style="text-align:right;">
0.22
</td>
</tr>
<tr>
<td style="text-align:left;">
b_logD
</td>
<td style="text-align:right;">
1.31
</td>
<td style="text-align:right;">
0.19
</td>
<td style="text-align:right;">
1.01
</td>
<td style="text-align:right;">
1.62
</td>
</tr>
<tr>
<td style="text-align:left;">
b_M
</td>
<td style="text-align:right;">
-0.07
</td>
<td style="text-align:right;">
0.17
</td>
<td style="text-align:right;">
-0.34
</td>
<td style="text-align:right;">
0.20
</td>
</tr>
<tr>
<td style="text-align:left;">
b_F:logD
</td>
<td style="text-align:right;">
0.17
</td>
<td style="text-align:right;">
0.20
</td>
<td style="text-align:right;">
-0.16
</td>
<td style="text-align:right;">
0.49
</td>
</tr>
<tr>
<td style="text-align:left;">
b_F:M
</td>
<td style="text-align:right;">
-0.01
</td>
<td style="text-align:right;">
0.19
</td>
<td style="text-align:right;">
-0.30
</td>
<td style="text-align:right;">
0.29
</td>
</tr>
<tr>
<td style="text-align:left;">
shape
</td>
<td style="text-align:right;">
1.03
</td>
<td style="text-align:right;">
0.17
</td>
<td style="text-align:right;">
0.78
</td>
<td style="text-align:right;">
1.32
</td>
</tr>
<tr>
<td style="text-align:left;">
lprior
</td>
<td style="text-align:right;">
-7.80
</td>
<td style="text-align:right;">
0.49
</td>
<td style="text-align:right;">
-8.63
</td>
<td style="text-align:right;">
-7.05
</td>
</tr>
</tbody>
</table>
<p>結果を図示する（図<a href="monsters-and-mixtures.html#fig:12H4">12.16</a>）。データにはかなり良く当てはまっていることが分かる。名前の女性らしさによる影響はほとんどない。</p>
<div class="sourceCode" id="cb1098"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1098-1"><a href="monsters-and-mixtures.html#cb1098-1" aria-hidden="true" tabindex="-1"></a>nd <span class="ot">&lt;-</span> <span class="fu">crossing</span>(<span class="at">F =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>,<span class="dv">1</span>),</span>
<span id="cb1098-2"><a href="monsters-and-mixtures.html#cb1098-2" aria-hidden="true" tabindex="-1"></a>               <span class="at">logD =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="fl">3.5</span>,<span class="dv">2</span>,<span class="at">length.out=</span><span class="dv">100</span>),</span>
<span id="cb1098-3"><a href="monsters-and-mixtures.html#cb1098-3" aria-hidden="true" tabindex="-1"></a>               <span class="at">M =</span> <span class="dv">0</span>)</span>
<span id="cb1098-4"><a href="monsters-and-mixtures.html#cb1098-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1098-5"><a href="monsters-and-mixtures.html#cb1098-5" aria-hidden="true" tabindex="-1"></a><span class="fu">fitted</span>(b12H4, nd, <span class="at">probs=</span><span class="fu">c</span>(<span class="fl">0.055</span>,<span class="fl">0.945</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1098-6"><a href="monsters-and-mixtures.html#cb1098-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1098-7"><a href="monsters-and-mixtures.html#cb1098-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(nd) <span class="sc">%&gt;%</span> </span>
<span id="cb1098-8"><a href="monsters-and-mixtures.html#cb1098-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">MorF =</span> <span class="fu">factor</span>(F)) <span class="ot">-&gt;</span> fit12H4</span>
<span id="cb1098-9"><a href="monsters-and-mixtures.html#cb1098-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1098-10"><a href="monsters-and-mixtures.html#cb1098-10" aria-hidden="true" tabindex="-1"></a>dat <span class="sc">%&gt;%</span> </span>
<span id="cb1098-11"><a href="monsters-and-mixtures.html#cb1098-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">MorF =</span> <span class="fu">ifelse</span>(F <span class="sc">&gt;</span> <span class="fu">mean</span>(F),<span class="st">&quot;1&quot;</span>,<span class="st">&quot;-1&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1098-12"><a href="monsters-and-mixtures.html#cb1098-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> logD))<span class="sc">+</span></span>
<span id="cb1098-13"><a href="monsters-and-mixtures.html#cb1098-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y=</span>deaths, <span class="at">color =</span> MorF),</span>
<span id="cb1098-14"><a href="monsters-and-mixtures.html#cb1098-14" aria-hidden="true" tabindex="-1"></a>             <span class="at">shape =</span><span class="dv">1</span>, <span class="at">stroke =</span> <span class="fl">1.5</span>, <span class="at">size=</span><span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb1098-15"><a href="monsters-and-mixtures.html#cb1098-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">data =</span> fit12H4,</span>
<span id="cb1098-16"><a href="monsters-and-mixtures.html#cb1098-16" aria-hidden="true" tabindex="-1"></a>              <span class="fu">aes</span>(<span class="at">y =</span> Estimate,</span>
<span id="cb1098-17"><a href="monsters-and-mixtures.html#cb1098-17" aria-hidden="true" tabindex="-1"></a>                  <span class="at">ymin =</span> Q5<span class="fl">.5</span>,</span>
<span id="cb1098-18"><a href="monsters-and-mixtures.html#cb1098-18" aria-hidden="true" tabindex="-1"></a>                  <span class="at">ymax =</span> Q94<span class="fl">.5</span>,</span>
<span id="cb1098-19"><a href="monsters-and-mixtures.html#cb1098-19" aria-hidden="true" tabindex="-1"></a>                  <span class="at">color =</span> MorF,</span>
<span id="cb1098-20"><a href="monsters-and-mixtures.html#cb1098-20" aria-hidden="true" tabindex="-1"></a>                  <span class="at">fill =</span> MorF,</span>
<span id="cb1098-21"><a href="monsters-and-mixtures.html#cb1098-21" aria-hidden="true" tabindex="-1"></a>                  <span class="at">linetype=</span>MorF),</span>
<span id="cb1098-22"><a href="monsters-and-mixtures.html#cb1098-22" aria-hidden="true" tabindex="-1"></a>              <span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>)<span class="sc">+</span></span>
<span id="cb1098-23"><a href="monsters-and-mixtures.html#cb1098-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;steelblue1&quot;</span>,<span class="st">&quot;lightcoral&quot;</span>))<span class="sc">+</span></span>
<span id="cb1098-24"><a href="monsters-and-mixtures.html#cb1098-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;steelblue1&quot;</span>,<span class="st">&quot;lightcoral&quot;</span>))<span class="sc">+</span></span>
<span id="cb1098-25"><a href="monsters-and-mixtures.html#cb1098-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">300</span>))<span class="sc">+</span></span>
<span id="cb1098-26"><a href="monsters-and-mixtures.html#cb1098-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;damage (std)&quot;</span>)<span class="sc">+</span></span>
<span id="cb1098-27"><a href="monsters-and-mixtures.html#cb1098-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">aspect.ratio=</span><span class="dv">1</span>,</span>
<span id="cb1098-28"><a href="monsters-and-mixtures.html#cb1098-28" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:12H4"></span>
<img src="Rethinking_Bookdown_files/figure-html/12H4-1.png" alt="b12H3_2の推定結果。点は、Fが0以下のものを水色、0以上のものをピンクとしており、回帰曲線は水色がF=-1, ピンクがF=1のときを表す。塗りつぶしは89%信用区間である。}" width="672" />
<p class="caption">
図12.16: b12H3_2の推定結果。点は、Fが0以下のものを水色、0以上のものをピンクとしており、回帰曲線は水色がF=-1, ピンクがF=1のときを表す。塗りつぶしは89%信用区間である。}
</p>
</div>
</div>
<div id="h5-7" class="section level3 hasAnchor" number="12.5.8">
<h3><span class="header-section-number">12.5.8</span> 12H5<a href="monsters-and-mixtures.html#h5-7" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<blockquote>
<p>One hypothesis from developmental psychology, usually attributed to Carol Gilligan, proposes that women and men have different average tendencies in moral reasoning. Like most hypotheses in social psychology, it is merely descriptive. The notion is that women are more concerned with care (avoiding harm), while men are more concerned with justice and rights. Culture-bound nonsense? Yes. Descriptively accurate? Maybe.<br />
Evaluate this hypothesis, using the Trolley data, supposing that contact provides a proxy for physical harm. Are women more or less bothered by contact than are men, in these data? Figure out the model(s) that is needed to address this question.</p>
</blockquote>
<p>性別とcontactを説明変数とし、交互作用があるかを調べる。</p>
<div class="sourceCode" id="cb1099"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1099-1"><a href="monsters-and-mixtures.html#cb1099-1" aria-hidden="true" tabindex="-1"></a>d4 <span class="ot">&lt;-</span> d4 <span class="sc">%&gt;%</span> </span>
<span id="cb1099-2"><a href="monsters-and-mixtures.html#cb1099-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">gid =</span> <span class="fu">ifelse</span>(male<span class="sc">==</span><span class="dv">1</span>,<span class="st">&quot;2&quot;</span>,<span class="st">&quot;1&quot;</span>))</span>
<span id="cb1099-3"><a href="monsters-and-mixtures.html#cb1099-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1099-4"><a href="monsters-and-mixtures.html#cb1099-4" aria-hidden="true" tabindex="-1"></a>b12H5 <span class="ot">&lt;-</span> </span>
<span id="cb1099-5"><a href="monsters-and-mixtures.html#cb1099-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">brm</span>(<span class="at">data =</span> d4, </span>
<span id="cb1099-6"><a href="monsters-and-mixtures.html#cb1099-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> cumulative,</span>
<span id="cb1099-7"><a href="monsters-and-mixtures.html#cb1099-7" aria-hidden="true" tabindex="-1"></a>      response <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> contact <span class="sc">+</span> gid <span class="sc">+</span> contact<span class="sc">:</span>gid,</span>
<span id="cb1099-8"><a href="monsters-and-mixtures.html#cb1099-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">1.5</span>), <span class="at">class =</span> Intercept),</span>
<span id="cb1099-9"><a href="monsters-and-mixtures.html#cb1099-9" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">class =</span> b)),</span>
<span id="cb1099-10"><a href="monsters-and-mixtures.html#cb1099-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>, <span class="at">cores =</span> <span class="dv">4</span>, <span class="at">chains =</span> <span class="dv">4</span>,</span>
<span id="cb1099-11"><a href="monsters-and-mixtures.html#cb1099-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">seed =</span> <span class="dv">12</span>,</span>
<span id="cb1099-12"><a href="monsters-and-mixtures.html#cb1099-12" aria-hidden="true" tabindex="-1"></a>       <span class="at">backend =</span> <span class="st">&quot;cmdstanr&quot;</span>,</span>
<span id="cb1099-13"><a href="monsters-and-mixtures.html#cb1099-13" aria-hidden="true" tabindex="-1"></a>      <span class="at">file =</span> <span class="st">&quot;output/Chapter12/b12H5&quot;</span>)</span></code></pre></div>
<p>結果は以下の通り（表<a href="monsters-and-mixtures.html#tab:res-b12H5">12.19</a>）。交互作用が影響していそう。
男性の方がむしろcontactの効果を強く受けているという結果。</p>
<div class="sourceCode" id="cb1100"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1100-1"><a href="monsters-and-mixtures.html#cb1100-1" aria-hidden="true" tabindex="-1"></a><span class="fu">posterior_summary</span>(b12H5, <span class="at">probs =</span> <span class="fu">c</span>(<span class="fl">0.055</span>,<span class="fl">0.945</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1100-2"><a href="monsters-and-mixtures.html#cb1100-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1100-3"><a href="monsters-and-mixtures.html#cb1100-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>(<span class="at">var =</span> <span class="st">&quot;parameter&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1100-4"><a href="monsters-and-mixtures.html#cb1100-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(parameter<span class="sc">!=</span><span class="st">&quot;lp__&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1100-5"><a href="monsters-and-mixtures.html#cb1100-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="at">booktabs=</span>T,</span>
<span id="cb1100-6"><a href="monsters-and-mixtures.html#cb1100-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">digits=</span><span class="dv">2</span>,</span>
<span id="cb1100-7"><a href="monsters-and-mixtures.html#cb1100-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">caption =</span> <span class="st">&quot;b12H5の結果&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1100-8"><a href="monsters-and-mixtures.html#cb1100-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">latex_options =</span> <span class="fu">c</span>(<span class="st">&quot;stripe&quot;</span>,<span class="st">&quot;hold_position&quot;</span>))</span></code></pre></div>
<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:res-b12H5">表12.19: </span>b12H5の結果
</caption>
<thead>
<tr>
<th style="text-align:left;">
parameter
</th>
<th style="text-align:right;">
Estimate
</th>
<th style="text-align:right;">
Est.Error
</th>
<th style="text-align:right;">
Q5.5
</th>
<th style="text-align:right;">
Q94.5
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
b_Intercept[1]
</td>
<td style="text-align:right;">
-1.75
</td>
<td style="text-align:right;">
0.04
</td>
<td style="text-align:right;">
-1.81
</td>
<td style="text-align:right;">
-1.70
</td>
</tr>
<tr>
<td style="text-align:left;">
b_Intercept[2]
</td>
<td style="text-align:right;">
-1.10
</td>
<td style="text-align:right;">
0.03
</td>
<td style="text-align:right;">
-1.15
</td>
<td style="text-align:right;">
-1.05
</td>
</tr>
<tr>
<td style="text-align:left;">
b_Intercept[3]
</td>
<td style="text-align:right;">
-0.54
</td>
<td style="text-align:right;">
0.03
</td>
<td style="text-align:right;">
-0.59
</td>
<td style="text-align:right;">
-0.49
</td>
</tr>
<tr>
<td style="text-align:left;">
b_Intercept[4]
</td>
<td style="text-align:right;">
0.46
</td>
<td style="text-align:right;">
0.03
</td>
<td style="text-align:right;">
0.41
</td>
<td style="text-align:right;">
0.51
</td>
</tr>
<tr>
<td style="text-align:left;">
b_Intercept[5]
</td>
<td style="text-align:right;">
1.13
</td>
<td style="text-align:right;">
0.03
</td>
<td style="text-align:right;">
1.07
</td>
<td style="text-align:right;">
1.18
</td>
</tr>
<tr>
<td style="text-align:left;">
b_Intercept[6]
</td>
<td style="text-align:right;">
2.03
</td>
<td style="text-align:right;">
0.04
</td>
<td style="text-align:right;">
1.97
</td>
<td style="text-align:right;">
2.09
</td>
</tr>
<tr>
<td style="text-align:left;">
b_contact
</td>
<td style="text-align:right;">
-0.48
</td>
<td style="text-align:right;">
0.07
</td>
<td style="text-align:right;">
-0.58
</td>
<td style="text-align:right;">
-0.37
</td>
</tr>
<tr>
<td style="text-align:left;">
b_gid2
</td>
<td style="text-align:right;">
0.59
</td>
<td style="text-align:right;">
0.04
</td>
<td style="text-align:right;">
0.53
</td>
<td style="text-align:right;">
0.66
</td>
</tr>
<tr>
<td style="text-align:left;">
b_contact:gid2
</td>
<td style="text-align:right;">
-0.21
</td>
<td style="text-align:right;">
0.09
</td>
<td style="text-align:right;">
-0.36
</td>
<td style="text-align:right;">
-0.07
</td>
</tr>
<tr>
<td style="text-align:left;">
disc
</td>
<td style="text-align:right;">
1.00
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;">
1.00
</td>
<td style="text-align:right;">
1.00
</td>
</tr>
<tr>
<td style="text-align:left;">
lprior
</td>
<td style="text-align:right;">
-13.32
</td>
<td style="text-align:right;">
0.06
</td>
<td style="text-align:right;">
-13.43
</td>
<td style="text-align:right;">
-13.23
</td>
</tr>
</tbody>
</table>
<p>結果は以下の通り（図<a href="monsters-and-mixtures.html#fig:b12H5">12.17</a>）。あまり交互作用はよくわからない。</p>
<div class="sourceCode" id="cb1101"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1101-1"><a href="monsters-and-mixtures.html#cb1101-1" aria-hidden="true" tabindex="-1"></a>nd <span class="ot">&lt;-</span> <span class="fu">crossing</span>(<span class="at">gid =</span> <span class="fu">c</span>(<span class="st">&quot;1&quot;</span>,<span class="st">&quot;2&quot;</span>),</span>
<span id="cb1101-2"><a href="monsters-and-mixtures.html#cb1101-2" aria-hidden="true" tabindex="-1"></a>             <span class="at">contact =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1101-3"><a href="monsters-and-mixtures.html#cb1101-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">combi =</span> <span class="fu">str_c</span>(gid, contact, <span class="at">sep=</span><span class="st">&quot;_&quot;</span>))</span>
<span id="cb1101-4"><a href="monsters-and-mixtures.html#cb1101-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1101-5"><a href="monsters-and-mixtures.html#cb1101-5" aria-hidden="true" tabindex="-1"></a>f <span class="ot">&lt;-</span> <span class="fu">fitted</span>(b12H5, nd, <span class="at">summary=</span> F)</span>
<span id="cb1101-6"><a href="monsters-and-mixtures.html#cb1101-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1101-7"><a href="monsters-and-mixtures.html#cb1101-7" aria-hidden="true" tabindex="-1"></a>f2 <span class="ot">&lt;-</span> <span class="fu">rbind</span>(f[,,<span class="dv">1</span>],</span>
<span id="cb1101-8"><a href="monsters-and-mixtures.html#cb1101-8" aria-hidden="true" tabindex="-1"></a>            f[,,<span class="dv">2</span>],</span>
<span id="cb1101-9"><a href="monsters-and-mixtures.html#cb1101-9" aria-hidden="true" tabindex="-1"></a>            f[,,<span class="dv">3</span>],</span>
<span id="cb1101-10"><a href="monsters-and-mixtures.html#cb1101-10" aria-hidden="true" tabindex="-1"></a>            f[,,<span class="dv">4</span>],</span>
<span id="cb1101-11"><a href="monsters-and-mixtures.html#cb1101-11" aria-hidden="true" tabindex="-1"></a>            f[,,<span class="dv">5</span>],</span>
<span id="cb1101-12"><a href="monsters-and-mixtures.html#cb1101-12" aria-hidden="true" tabindex="-1"></a>            f[,,<span class="dv">6</span>],</span>
<span id="cb1101-13"><a href="monsters-and-mixtures.html#cb1101-13" aria-hidden="true" tabindex="-1"></a>            f[,,<span class="dv">7</span>]) <span class="sc">%&gt;%</span> </span>
<span id="cb1101-14"><a href="monsters-and-mixtures.html#cb1101-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1101-15"><a href="monsters-and-mixtures.html#cb1101-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_names</span>(nd<span class="sc">$</span>combi) <span class="sc">%&gt;%</span> </span>
<span id="cb1101-16"><a href="monsters-and-mixtures.html#cb1101-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">response =</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">7</span>, <span class="at">each =</span><span class="dv">4000</span>),</span>
<span id="cb1101-17"><a href="monsters-and-mixtures.html#cb1101-17" aria-hidden="true" tabindex="-1"></a>         <span class="at">iter =</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">4000</span>, <span class="at">times =</span><span class="dv">7</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb1101-18"><a href="monsters-and-mixtures.html#cb1101-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span><span class="fu">c</span>(response, iter),</span>
<span id="cb1101-19"><a href="monsters-and-mixtures.html#cb1101-19" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="fu">c</span>(<span class="st">&quot;gid&quot;</span>, <span class="st">&quot;contact&quot;</span>),</span>
<span id="cb1101-20"><a href="monsters-and-mixtures.html#cb1101-20" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_sep=</span><span class="st">&quot;_&quot;</span>,</span>
<span id="cb1101-21"><a href="monsters-and-mixtures.html#cb1101-21" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">&quot;p&quot;</span>)</span>
<span id="cb1101-22"><a href="monsters-and-mixtures.html#cb1101-22" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1101-23"><a href="monsters-and-mixtures.html#cb1101-23" aria-hidden="true" tabindex="-1"></a>f2 <span class="sc">%&gt;%</span> </span>
<span id="cb1101-24"><a href="monsters-and-mixtures.html#cb1101-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(response <span class="sc">&lt;</span> <span class="dv">7</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1101-25"><a href="monsters-and-mixtures.html#cb1101-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">facet =</span> <span class="fu">ifelse</span>(gid <span class="sc">==</span> <span class="st">&quot;1&quot;</span>,<span class="st">&quot;female&quot;</span>,<span class="st">&quot;male&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1101-26"><a href="monsters-and-mixtures.html#cb1101-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(iter, facet, contact) <span class="sc">%&gt;%</span> </span>
<span id="cb1101-27"><a href="monsters-and-mixtures.html#cb1101-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(iter, facet, contact,response) <span class="sc">%&gt;%</span> </span>
<span id="cb1101-28"><a href="monsters-and-mixtures.html#cb1101-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prob =</span> <span class="fu">cumsum</span>(p)) <span class="sc">%&gt;%</span> </span>
<span id="cb1101-29"><a href="monsters-and-mixtures.html#cb1101-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1101-30"><a href="monsters-and-mixtures.html#cb1101-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">nest</span>(<span class="at">data =</span> <span class="sc">-</span>iter) <span class="sc">%&gt;%</span> </span>
<span id="cb1101-31"><a href="monsters-and-mixtures.html#cb1101-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_sample</span>(<span class="at">n=</span><span class="dv">100</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1101-32"><a href="monsters-and-mixtures.html#cb1101-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(data) <span class="sc">%&gt;%</span> </span>
<span id="cb1101-33"><a href="monsters-and-mixtures.html#cb1101-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">contact =</span> <span class="fu">as.integer</span>(contact)) <span class="sc">%&gt;%</span> </span>
<span id="cb1101-34"><a href="monsters-and-mixtures.html#cb1101-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> contact, <span class="at">y =</span> prob))<span class="sc">+</span></span>
<span id="cb1101-35"><a href="monsters-and-mixtures.html#cb1101-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">group=</span><span class="fu">interaction</span>(iter, response),</span>
<span id="cb1101-36"><a href="monsters-and-mixtures.html#cb1101-36" aria-hidden="true" tabindex="-1"></a>                <span class="at">color =</span> prob),</span>
<span id="cb1101-37"><a href="monsters-and-mixtures.html#cb1101-37" aria-hidden="true" tabindex="-1"></a>            <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">10</span>)<span class="sc">+</span></span>
<span id="cb1101-38"><a href="monsters-and-mixtures.html#cb1101-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span>d4 <span class="sc">%&gt;%</span> </span>
<span id="cb1101-39"><a href="monsters-and-mixtures.html#cb1101-39" aria-hidden="true" tabindex="-1"></a>               <span class="fu">group_by</span>(gid, contact) <span class="sc">%&gt;%</span> </span>
<span id="cb1101-40"><a href="monsters-and-mixtures.html#cb1101-40" aria-hidden="true" tabindex="-1"></a>               <span class="fu">count</span>(response) <span class="sc">%&gt;%</span> </span>
<span id="cb1101-41"><a href="monsters-and-mixtures.html#cb1101-41" aria-hidden="true" tabindex="-1"></a>               <span class="fu">mutate</span>(<span class="at">prob =</span> <span class="fu">cumsum</span>(n<span class="sc">/</span><span class="fu">sum</span>(n)),</span>
<span id="cb1101-42"><a href="monsters-and-mixtures.html#cb1101-42" aria-hidden="true" tabindex="-1"></a>              <span class="at">facet=</span><span class="fu">ifelse</span>(gid <span class="sc">==</span> <span class="st">&quot;1&quot;</span>,<span class="st">&quot;female&quot;</span>,<span class="st">&quot;male&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1101-43"><a href="monsters-and-mixtures.html#cb1101-43" aria-hidden="true" tabindex="-1"></a>               <span class="fu">filter</span>(response<span class="sc">&lt;</span><span class="dv">7</span>),</span>
<span id="cb1101-44"><a href="monsters-and-mixtures.html#cb1101-44" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> <span class="st">&quot;olivedrab3&quot;</span>)<span class="sc">+</span></span>
<span id="cb1101-45"><a href="monsters-and-mixtures.html#cb1101-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_gradient</span>(<span class="at">low =</span> <span class="st">&quot;olivedrab4&quot;</span>,</span>
<span id="cb1101-46"><a href="monsters-and-mixtures.html#cb1101-46" aria-hidden="true" tabindex="-1"></a>                       <span class="at">high =</span> <span class="st">&quot;olivedrab1&quot;</span>)<span class="sc">+</span></span>
<span id="cb1101-47"><a href="monsters-and-mixtures.html#cb1101-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="st">&quot;contact&quot;</span>, <span class="at">breaks =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb1101-48"><a href="monsters-and-mixtures.html#cb1101-48" aria-hidden="true" tabindex="-1"></a><span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>, .<span class="dv">5</span>, <span class="dv">1</span>), <span class="at">limits =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb1101-49"><a href="monsters-and-mixtures.html#cb1101-49" aria-hidden="true" tabindex="-1"></a><span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>,</span>
<span id="cb1101-50"><a href="monsters-and-mixtures.html#cb1101-50" aria-hidden="true" tabindex="-1"></a><span class="at">strip.background =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb1101-51"><a href="monsters-and-mixtures.html#cb1101-51" aria-hidden="true" tabindex="-1"></a><span class="fu">facet_wrap</span>(<span class="sc">~</span> facet)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:b12H5"></span>
<img src="Rethinking_Bookdown_files/figure-html/b12H5-1.png" alt="b12H5の結果を図示したもの。" width="672" />
<p class="caption">
図12.17: b12H5の結果を図示したもの。
</p>
</div>
<p>予測分布を表すと以下のようになる図<a href="monsters-and-mixtures.html#fig:pred-b12H5">12.18</a>。全体として女性の方が道徳的に許容できない人が多い（小さいresponseの割合が高い）が、contactの効果は男性の方がある。</p>
<div class="sourceCode" id="cb1102"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1102-1"><a href="monsters-and-mixtures.html#cb1102-1" aria-hidden="true" tabindex="-1"></a>predict <span class="ot">&lt;-</span> <span class="fu">predict</span>(b12H5, nd, <span class="at">scale=</span><span class="st">&quot;response&quot;</span>, <span class="at">summary=</span>F)</span>
<span id="cb1102-2"><a href="monsters-and-mixtures.html#cb1102-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1102-3"><a href="monsters-and-mixtures.html#cb1102-3" aria-hidden="true" tabindex="-1"></a>predict <span class="sc">%&gt;%</span></span>
<span id="cb1102-4"><a href="monsters-and-mixtures.html#cb1102-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb1102-5"><a href="monsters-and-mixtures.html#cb1102-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_names</span>(<span class="fu">pull</span>(nd, combi)) <span class="sc">%&gt;%</span></span>
<span id="cb1102-6"><a href="monsters-and-mixtures.html#cb1102-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">everything</span>(),</span>
<span id="cb1102-7"><a href="monsters-and-mixtures.html#cb1102-7" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="fu">c</span>(<span class="st">&quot;gid&quot;</span>, <span class="st">&quot;contact&quot;</span>),</span>
<span id="cb1102-8"><a href="monsters-and-mixtures.html#cb1102-8" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_sep=</span><span class="st">&quot;_&quot;</span>,</span>
<span id="cb1102-9"><a href="monsters-and-mixtures.html#cb1102-9" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">&quot;response&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb1102-10"><a href="monsters-and-mixtures.html#cb1102-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">facet =</span> <span class="fu">ifelse</span>(gid <span class="sc">==</span> <span class="st">&quot;1&quot;</span>,<span class="st">&quot;female&quot;</span>,<span class="st">&quot;male&quot;</span>))<span class="sc">%&gt;%</span></span>
<span id="cb1102-11"><a href="monsters-and-mixtures.html#cb1102-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> response, <span class="at">fill =</span> contact)) <span class="sc">+</span></span>
<span id="cb1102-12"><a href="monsters-and-mixtures.html#cb1102-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">width =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">3</span>, <span class="at">position =</span> <span class="fu">position_dodge</span>(<span class="at">width =</span> .<span class="dv">4</span>)) <span class="sc">+</span></span>
<span id="cb1102-13"><a href="monsters-and-mixtures.html#cb1102-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;black&quot;</span>, <span class="st">&quot;blue&quot;</span>)) <span class="sc">+</span></span>
<span id="cb1102-14"><a href="monsters-and-mixtures.html#cb1102-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="st">&quot;response&quot;</span>, <span class="at">breaks =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">7</span>) <span class="sc">+</span></span>
<span id="cb1102-15"><a href="monsters-and-mixtures.html#cb1102-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>,</span>
<span id="cb1102-16"><a href="monsters-and-mixtures.html#cb1102-16" aria-hidden="true" tabindex="-1"></a>        <span class="at">strip.background =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb1102-17"><a href="monsters-and-mixtures.html#cb1102-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> facet) </span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:pred-b12H5"></span>
<img src="Rethinking_Bookdown_files/figure-html/pred-b12H5-1.png" alt="b12H5による予測分布。黒いバーがcontactが0のとき、青いバーがcontactが1の時を表す。" width="672" />
<p class="caption">
図12.18: b12H5による予測分布。黒いバーがcontactが0のとき、青いバーがcontactが1の時を表す。
</p>
</div>
</div>
<div id="h6-4" class="section level3 hasAnchor" number="12.5.9">
<h3><span class="header-section-number">12.5.9</span> 12H6<a href="monsters-and-mixtures.html#h6-4" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<blockquote>
<p>The data in data(Fish) are records of visits to a national park. See ?Fish for details. The question of interest is how many fish an average visitor takes per hour, when fishing. The problem is that not everyone tried to fish, so the fish_caught numbers are zero-inflated. As with the monks example in the chapter, there is a process that determines who is fishing (working) and another process that determines fish per hour (manuscripts per day), conditional on fishing (working). We want to model both. Otherwise we’ll end up with an underestimate of rate of fish extraction from the park.<br />
You will model these data using zero-inflated Poisson GLMs. Predict fish_caught as a function of any of the other variables you think are relevant. One thing you must do, however, is use a proper Poisson offset/exposure in the Poisson portion of the zero-inflated model. Then use the hours variable to construct the offset. This will adjust the model for the differing amount of time individuals spent in the park.</p>
</blockquote>
<p>キャンプ場を訪れた人たちが魚をどれだけ釣ったのかをモデリングする。問題は、キャンプ場を訪れたすべての人が魚釣りをしたわけではないということである。よって、ゼロ過剰ポワソンモデルを用いてモデリングを行う。<br />
含まれる変数は以下のものである。ここでは、図<a href="monsters-and-mixtures.html#fig:plot-fish">12.19</a>をもとに<code>camper</code>と<code>child</code>, <code>person</code>が釣りをするか否かの判断に影響し、<code>livebait</code>と<code>person</code>, <code>camper</code>, <code>child</code>が釣った魚の数に影響していたとする。<code>hours</code>は宿泊した客とそうでない客で大きく異なるため除外する。</p>
<ul>
<li>livebait: 魚釣りに生餌を使ったか否か。<br />
</li>
<li>camper: キャンプをするか否か。<br />
</li>
<li>person: 大人の数。<br />
</li>
<li>child: 子供の数。<br />
</li>
<li>hours: キャンプ場にいた時間。</li>
</ul>
<div class="sourceCode" id="cb1103"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1103-1"><a href="monsters-and-mixtures.html#cb1103-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(Fish)</span>
<span id="cb1103-2"><a href="monsters-and-mixtures.html#cb1103-2" aria-hidden="true" tabindex="-1"></a>dat3 <span class="ot">&lt;-</span> Fish</span>
<span id="cb1103-3"><a href="monsters-and-mixtures.html#cb1103-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1103-4"><a href="monsters-and-mixtures.html#cb1103-4" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(dat3) <span class="sc">%&gt;%</span> </span>
<span id="cb1103-5"><a href="monsters-and-mixtures.html#cb1103-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="at">booktabs=</span>T,</span>
<span id="cb1103-6"><a href="monsters-and-mixtures.html#cb1103-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">caption =</span> <span class="st">&quot;データ`Fish`&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1103-7"><a href="monsters-and-mixtures.html#cb1103-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">latex_options =</span> <span class="fu">c</span>(<span class="st">&quot;hold_position&quot;</span>,<span class="st">&quot;stripe&quot;</span>))</span></code></pre></div>
<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:unnamed-chunk-587">表12.20: </span>データ<code>Fish</code>
</caption>
<thead>
<tr>
<th style="text-align:right;">
fish_caught
</th>
<th style="text-align:right;">
livebait
</th>
<th style="text-align:right;">
camper
</th>
<th style="text-align:right;">
persons
</th>
<th style="text-align:right;">
child
</th>
<th style="text-align:right;">
hours
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
21.124
</td>
</tr>
<tr>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
5.732
</td>
</tr>
<tr>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1.323
</td>
</tr>
<tr>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.548
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1.695
</td>
</tr>
<tr>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
0.493
</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb1104"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1104-1"><a href="monsters-and-mixtures.html#cb1104-1" aria-hidden="true" tabindex="-1"></a>dat3 <span class="sc">%&gt;%</span> </span>
<span id="cb1104-2"><a href="monsters-and-mixtures.html#cb1104-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span><span class="fu">c</span>(fish_caught,hours)) <span class="sc">%&gt;%</span> </span>
<span id="cb1104-3"><a href="monsters-and-mixtures.html#cb1104-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>value, <span class="at">y =</span> fish_caught))<span class="sc">+</span></span>
<span id="cb1104-4"><a href="monsters-and-mixtures.html#cb1104-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">shape=</span>name), <span class="at">color =</span> <span class="st">&quot;navy&quot;</span>, </span>
<span id="cb1104-5"><a href="monsters-and-mixtures.html#cb1104-5" aria-hidden="true" tabindex="-1"></a>             <span class="at">size=</span><span class="dv">3</span>, <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>)<span class="sc">+</span></span>
<span id="cb1104-6"><a href="monsters-and-mixtures.html#cb1104-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">&quot;Number of fish&quot;</span>)<span class="sc">+</span></span>
<span id="cb1104-7"><a href="monsters-and-mixtures.html#cb1104-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">strip.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb1104-8"><a href="monsters-and-mixtures.html#cb1104-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">12</span>),</span>
<span id="cb1104-9"><a href="monsters-and-mixtures.html#cb1104-9" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>, <span class="at">aspect.ratio=</span><span class="fl">0.7</span>)<span class="sc">+</span></span>
<span id="cb1104-10"><a href="monsters-and-mixtures.html#cb1104-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>name, <span class="at">nrow =</span> <span class="dv">2</span>, <span class="at">scales =</span> <span class="st">&quot;free_x&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:plot-fish"></span>
<img src="Rethinking_Bookdown_files/figure-html/plot-fish-1.png" alt="データ`Fish`のplot" width="672" />
<p class="caption">
図12.19: データ<code>Fish</code>のplot
</p>
</div>
<p>それではモデリングを行う。</p>
<div class="sourceCode" id="cb1105"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1105-1"><a href="monsters-and-mixtures.html#cb1105-1" aria-hidden="true" tabindex="-1"></a>dat3 <span class="sc">%&gt;%</span> </span>
<span id="cb1105-2"><a href="monsters-and-mixtures.html#cb1105-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">C =</span> <span class="fu">ifelse</span>(camper<span class="sc">==</span><span class="st">&quot;1&quot;</span>,<span class="st">&quot;2&quot;</span>,<span class="st">&quot;1&quot;</span>),</span>
<span id="cb1105-3"><a href="monsters-and-mixtures.html#cb1105-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">L =</span> <span class="fu">ifelse</span>(livebait <span class="sc">==</span> <span class="st">&quot;1&quot;</span>,<span class="st">&quot;2&quot;</span>,<span class="st">&quot;1&quot;</span>)) <span class="ot">-&gt;</span> dat3</span>
<span id="cb1105-4"><a href="monsters-and-mixtures.html#cb1105-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1105-5"><a href="monsters-and-mixtures.html#cb1105-5" aria-hidden="true" tabindex="-1"></a>b12H6 <span class="ot">&lt;-</span> <span class="fu">brm</span>(<span class="at">data =</span> dat3,</span>
<span id="cb1105-6"><a href="monsters-and-mixtures.html#cb1105-6" aria-hidden="true" tabindex="-1"></a>             <span class="at">family =</span> zero_inflated_poisson,</span>
<span id="cb1105-7"><a href="monsters-and-mixtures.html#cb1105-7" aria-hidden="true" tabindex="-1"></a>             <span class="fu">bf</span>(fish_caught <span class="sc">~</span> C <span class="sc">+</span> child <span class="sc">+</span>L <span class="sc">+</span> persons,</span>
<span id="cb1105-8"><a href="monsters-and-mixtures.html#cb1105-8" aria-hidden="true" tabindex="-1"></a>                zi <span class="sc">~</span> C <span class="sc">+</span> child <span class="sc">+</span> persons),</span>
<span id="cb1105-9"><a href="monsters-and-mixtures.html#cb1105-9" aria-hidden="true" tabindex="-1"></a>             <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">3</span>,<span class="fl">0.5</span>), <span class="at">class =</span> Intercept),</span>
<span id="cb1105-10"><a href="monsters-and-mixtures.html#cb1105-10" aria-hidden="true" tabindex="-1"></a>                       <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">10</span>), <span class="at">class =</span> b),</span>
<span id="cb1105-11"><a href="monsters-and-mixtures.html#cb1105-11" aria-hidden="true" tabindex="-1"></a>                       <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">1.5</span>), <span class="at">class =</span> Intercept,</span>
<span id="cb1105-12"><a href="monsters-and-mixtures.html#cb1105-12" aria-hidden="true" tabindex="-1"></a>                             <span class="at">dpar =</span> zi),</span>
<span id="cb1105-13"><a href="monsters-and-mixtures.html#cb1105-13" aria-hidden="true" tabindex="-1"></a>                       <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">10</span>), <span class="at">class =</span>b, <span class="at">dpar=</span>zi)),</span>
<span id="cb1105-14"><a href="monsters-and-mixtures.html#cb1105-14" aria-hidden="true" tabindex="-1"></a>              <span class="at">backend =</span> <span class="st">&quot;cmdstanr&quot;</span>,</span>
<span id="cb1105-15"><a href="monsters-and-mixtures.html#cb1105-15" aria-hidden="true" tabindex="-1"></a>             <span class="at">seed =</span> <span class="dv">11</span>, <span class="at">file =</span> <span class="st">&quot;output/Chapter12/b12H6&quot;</span>)</span></code></pre></div>
<p>結果は以下の通り（表<a href="monsters-and-mixtures.html#tab:res-b12H6">12.21</a>）。全ての説明変数が影響を与えていることが分かる。</p>
<div class="sourceCode" id="cb1106"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1106-1"><a href="monsters-and-mixtures.html#cb1106-1" aria-hidden="true" tabindex="-1"></a><span class="fu">posterior_summary</span>(b12H6, <span class="at">probs =</span> <span class="fu">c</span>(<span class="fl">0.055</span>,<span class="fl">0.945</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1106-2"><a href="monsters-and-mixtures.html#cb1106-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1106-3"><a href="monsters-and-mixtures.html#cb1106-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>(<span class="at">var =</span> <span class="st">&quot;parameter&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1106-4"><a href="monsters-and-mixtures.html#cb1106-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(parameter<span class="sc">!=</span><span class="st">&quot;lp__&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1106-5"><a href="monsters-and-mixtures.html#cb1106-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="at">booktabs=</span>T,</span>
<span id="cb1106-6"><a href="monsters-and-mixtures.html#cb1106-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">digits=</span><span class="dv">2</span>,</span>
<span id="cb1106-7"><a href="monsters-and-mixtures.html#cb1106-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">caption =</span> <span class="st">&quot;b12H5の結果&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1106-8"><a href="monsters-and-mixtures.html#cb1106-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">latex_options =</span> <span class="fu">c</span>(<span class="st">&quot;stripe&quot;</span>,<span class="st">&quot;hold_position&quot;</span>))</span></code></pre></div>
<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:res-b12H6">表12.21: </span>b12H5の結果
</caption>
<thead>
<tr>
<th style="text-align:left;">
parameter
</th>
<th style="text-align:right;">
Estimate
</th>
<th style="text-align:right;">
Est.Error
</th>
<th style="text-align:right;">
Q5.5
</th>
<th style="text-align:right;">
Q94.5
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
b_Intercept
</td>
<td style="text-align:right;">
-2.27
</td>
<td style="text-align:right;">
0.28
</td>
<td style="text-align:right;">
-2.72
</td>
<td style="text-align:right;">
-1.85
</td>
</tr>
<tr>
<td style="text-align:left;">
b_zi_Intercept
</td>
<td style="text-align:right;">
1.63
</td>
<td style="text-align:right;">
0.52
</td>
<td style="text-align:right;">
0.80
</td>
<td style="text-align:right;">
2.46
</td>
</tr>
<tr>
<td style="text-align:left;">
b_C2
</td>
<td style="text-align:right;">
0.58
</td>
<td style="text-align:right;">
0.09
</td>
<td style="text-align:right;">
0.44
</td>
<td style="text-align:right;">
0.74
</td>
</tr>
<tr>
<td style="text-align:left;">
b_child
</td>
<td style="text-align:right;">
-1.14
</td>
<td style="text-align:right;">
0.09
</td>
<td style="text-align:right;">
-1.28
</td>
<td style="text-align:right;">
-1.00
</td>
</tr>
<tr>
<td style="text-align:left;">
b_L2
</td>
<td style="text-align:right;">
1.70
</td>
<td style="text-align:right;">
0.24
</td>
<td style="text-align:right;">
1.33
</td>
<td style="text-align:right;">
2.10
</td>
</tr>
<tr>
<td style="text-align:left;">
b_persons
</td>
<td style="text-align:right;">
0.82
</td>
<td style="text-align:right;">
0.04
</td>
<td style="text-align:right;">
0.75
</td>
<td style="text-align:right;">
0.89
</td>
</tr>
<tr>
<td style="text-align:left;">
b_zi_C2
</td>
<td style="text-align:right;">
-0.87
</td>
<td style="text-align:right;">
0.36
</td>
<td style="text-align:right;">
-1.46
</td>
<td style="text-align:right;">
-0.30
</td>
</tr>
<tr>
<td style="text-align:left;">
b_zi_child
</td>
<td style="text-align:right;">
2.06
</td>
<td style="text-align:right;">
0.34
</td>
<td style="text-align:right;">
1.54
</td>
<td style="text-align:right;">
2.61
</td>
</tr>
<tr>
<td style="text-align:left;">
b_zi_persons
</td>
<td style="text-align:right;">
-0.98
</td>
<td style="text-align:right;">
0.21
</td>
<td style="text-align:right;">
-1.33
</td>
<td style="text-align:right;">
-0.65
</td>
</tr>
<tr>
<td style="text-align:left;">
lprior
</td>
<td style="text-align:right;">
-33.52
</td>
<td style="text-align:right;">
0.68
</td>
<td style="text-align:right;">
-34.65
</td>
<td style="text-align:right;">
-32.47
</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb1107"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1107-1"><a href="monsters-and-mixtures.html#cb1107-1" aria-hidden="true" tabindex="-1"></a><span class="fu">conditional_effects</span>(b12H6) <span class="sc">%&gt;%</span> </span>
<span id="cb1107-2"><a href="monsters-and-mixtures.html#cb1107-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>(<span class="at">points =</span> <span class="cn">TRUE</span>, <span class="at">jitter_width =</span> <span class="fl">0.1</span>,</span>
<span id="cb1107-3"><a href="monsters-and-mixtures.html#cb1107-3" aria-hidden="true" tabindex="-1"></a>       <span class="at">stype =</span> <span class="st">&quot;contour&quot;</span>, <span class="at">theme=</span><span class="fu">theme</span>(<span class="at">aspect.ratio=</span><span class="dv">1</span>))</span></code></pre></div>
<p><img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-589-1.png" width="672" style="display: block; margin: auto;" /><img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-589-2.png" width="672" style="display: block; margin: auto;" /><img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-589-3.png" width="672" style="display: block; margin: auto;" /><img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-589-4.png" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="h7-1" class="section level3 hasAnchor" number="12.5.10">
<h3><span class="header-section-number">12.5.10</span> 12H7<a href="monsters-and-mixtures.html#h7-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<blockquote>
<p>In the trolley data we saw how education level (models as an ordered category) is associated with responses. But is this association causal? One possible confound is that education is also associated with age, through a causal process: People are
older when they finish school thatn when they begin it. Reconsider the Trolley data in this light. Draw a DAG that represents hypothetical causal relationships among response, education, and age. Which statical model or models do you need to evaluate the causal influence of education on responses ? Fit these models to the trolley data. This will adjust the model for the differing amount of time individuals spent in the park.</p>
</blockquote>
<div class="sourceCode" id="cb1108"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1108-1"><a href="monsters-and-mixtures.html#cb1108-1" aria-hidden="true" tabindex="-1"></a>d4 <span class="ot">&lt;-</span> <span class="fu">mutate</span>(d4, <span class="at">A =</span> <span class="fu">standardize</span>(age))</span>
<span id="cb1108-2"><a href="monsters-and-mixtures.html#cb1108-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1108-3"><a href="monsters-and-mixtures.html#cb1108-3" aria-hidden="true" tabindex="-1"></a>b12H7 <span class="ot">&lt;-</span> </span>
<span id="cb1108-4"><a href="monsters-and-mixtures.html#cb1108-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">brm</span>(<span class="at">data =</span> d4, </span>
<span id="cb1108-5"><a href="monsters-and-mixtures.html#cb1108-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> cumulative,</span>
<span id="cb1108-6"><a href="monsters-and-mixtures.html#cb1108-6" aria-hidden="true" tabindex="-1"></a>      response <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> action <span class="sc">+</span> contact <span class="sc">+</span> intention <span class="sc">+</span>A<span class="sc">+</span> <span class="fu">mo</span>(edu_new),</span>
<span id="cb1108-7"><a href="monsters-and-mixtures.html#cb1108-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">1.5</span>), <span class="at">class =</span> Intercept),</span>
<span id="cb1108-8"><a href="monsters-and-mixtures.html#cb1108-8" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">class =</span> b),</span>
<span id="cb1108-9"><a href="monsters-and-mixtures.html#cb1108-9" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">0.5</span>), <span class="at">class =</span> b, </span>
<span id="cb1108-10"><a href="monsters-and-mixtures.html#cb1108-10" aria-hidden="true" tabindex="-1"></a>                      <span class="at">coef =</span> moedu_new),</span>
<span id="cb1108-11"><a href="monsters-and-mixtures.html#cb1108-11" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">dirichlet</span>(<span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">2</span>), <span class="at">class =</span> simo, <span class="at">coef =</span> moedu_new1)),</span>
<span id="cb1108-12"><a href="monsters-and-mixtures.html#cb1108-12" aria-hidden="true" tabindex="-1"></a>      <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>, <span class="at">cores =</span> <span class="dv">4</span>, <span class="at">chains =</span> <span class="dv">4</span>,</span>
<span id="cb1108-13"><a href="monsters-and-mixtures.html#cb1108-13" aria-hidden="true" tabindex="-1"></a>      <span class="at">seed =</span> <span class="dv">12</span>,</span>
<span id="cb1108-14"><a href="monsters-and-mixtures.html#cb1108-14" aria-hidden="true" tabindex="-1"></a>       <span class="at">backend =</span> <span class="st">&quot;cmdstanr&quot;</span>,</span>
<span id="cb1108-15"><a href="monsters-and-mixtures.html#cb1108-15" aria-hidden="true" tabindex="-1"></a>      <span class="at">file =</span> <span class="st">&quot;output/Chapter12/b12H7&quot;</span>)</span></code></pre></div>
<p>結果は以下の通り（表<a href="monsters-and-mixtures.html#tab:res-b12H7">12.22</a>）。年齢を説明変数に入れると、学歴の影響は小さくなり、係数の正負も反対になった。</p>
<div class="sourceCode" id="cb1109"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1109-1"><a href="monsters-and-mixtures.html#cb1109-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fixef</span>(b12H7) <span class="sc">%&gt;%</span> </span>
<span id="cb1109-2"><a href="monsters-and-mixtures.html#cb1109-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1109-3"><a href="monsters-and-mixtures.html#cb1109-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="at">digits =</span> <span class="dv">2</span>,</span>
<span id="cb1109-4"><a href="monsters-and-mixtures.html#cb1109-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">booktabs =</span> <span class="cn">TRUE</span>,</span>
<span id="cb1109-5"><a href="monsters-and-mixtures.html#cb1109-5" aria-hidden="true" tabindex="-1"></a>        <span class="at">caption =</span> <span class="st">&quot;b12H7の結果。&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1109-6"><a href="monsters-and-mixtures.html#cb1109-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">latex_options =</span> <span class="fu">c</span>(<span class="st">&quot;striped&quot;</span>, <span class="st">&quot;hold_position&quot;</span>))</span></code></pre></div>
<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:res-b12H7">表12.22: </span>b12H7の結果。
</caption>
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
Estimate
</th>
<th style="text-align:right;">
Est.Error
</th>
<th style="text-align:right;">
Q2.5
</th>
<th style="text-align:right;">
Q97.5
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Intercept[1]
</td>
<td style="text-align:right;">
-2.70
</td>
<td style="text-align:right;">
0.10
</td>
<td style="text-align:right;">
-2.97
</td>
<td style="text-align:right;">
-2.54
</td>
</tr>
<tr>
<td style="text-align:left;">
Intercept[2]
</td>
<td style="text-align:right;">
-2.02
</td>
<td style="text-align:right;">
0.10
</td>
<td style="text-align:right;">
-2.28
</td>
<td style="text-align:right;">
-1.86
</td>
</tr>
<tr>
<td style="text-align:left;">
Intercept[3]
</td>
<td style="text-align:right;">
-1.43
</td>
<td style="text-align:right;">
0.10
</td>
<td style="text-align:right;">
-1.69
</td>
<td style="text-align:right;">
-1.28
</td>
</tr>
<tr>
<td style="text-align:left;">
Intercept[4]
</td>
<td style="text-align:right;">
-0.41
</td>
<td style="text-align:right;">
0.10
</td>
<td style="text-align:right;">
-0.68
</td>
<td style="text-align:right;">
-0.25
</td>
</tr>
<tr>
<td style="text-align:left;">
Intercept[5]
</td>
<td style="text-align:right;">
0.26
</td>
<td style="text-align:right;">
0.10
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;">
0.42
</td>
</tr>
<tr>
<td style="text-align:left;">
Intercept[6]
</td>
<td style="text-align:right;">
1.17
</td>
<td style="text-align:right;">
0.10
</td>
<td style="text-align:right;">
0.89
</td>
<td style="text-align:right;">
1.33
</td>
</tr>
<tr>
<td style="text-align:left;">
action
</td>
<td style="text-align:right;">
-0.71
</td>
<td style="text-align:right;">
0.04
</td>
<td style="text-align:right;">
-0.79
</td>
<td style="text-align:right;">
-0.63
</td>
</tr>
<tr>
<td style="text-align:left;">
contact
</td>
<td style="text-align:right;">
-0.96
</td>
<td style="text-align:right;">
0.05
</td>
<td style="text-align:right;">
-1.06
</td>
<td style="text-align:right;">
-0.87
</td>
</tr>
<tr>
<td style="text-align:left;">
intention
</td>
<td style="text-align:right;">
-0.72
</td>
<td style="text-align:right;">
0.04
</td>
<td style="text-align:right;">
-0.79
</td>
<td style="text-align:right;">
-0.65
</td>
</tr>
<tr>
<td style="text-align:left;">
A
</td>
<td style="text-align:right;">
-0.10
</td>
<td style="text-align:right;">
0.02
</td>
<td style="text-align:right;">
-0.14
</td>
<td style="text-align:right;">
-0.05
</td>
</tr>
<tr>
<td style="text-align:left;">
moedu_new
</td>
<td style="text-align:right;">
0.03
</td>
<td style="text-align:right;">
0.02
</td>
<td style="text-align:right;">
-0.02
</td>
<td style="text-align:right;">
0.06
</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb1110"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1110-1"><a href="monsters-and-mixtures.html#cb1110-1" aria-hidden="true" tabindex="-1"></a><span class="fu">posterior_samples</span>(b12H7) <span class="sc">%&gt;%</span> </span>
<span id="cb1110-2"><a href="monsters-and-mixtures.html#cb1110-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">transmute</span>(<span class="at">bE =</span> bsp_moedu_new <span class="sc">*</span> <span class="dv">7</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1110-3"><a href="monsters-and-mixtures.html#cb1110-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">median_qi</span>(<span class="at">.width =</span> .<span class="dv">89</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1110-4"><a href="monsters-and-mixtures.html#cb1110-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_if</span>(is.double, round, <span class="at">digits =</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1110-5"><a href="monsters-and-mixtures.html#cb1110-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="at">booktabs=</span>T) <span class="sc">%&gt;%</span> </span>
<span id="cb1110-6"><a href="monsters-and-mixtures.html#cb1110-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">latex_options =</span> <span class="st">&quot;hold_position&quot;</span>)</span></code></pre></div>
<table class="table" style="margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:right;">
bE
</th>
<th style="text-align:right;">
.lower
</th>
<th style="text-align:right;">
.upper
</th>
<th style="text-align:right;">
.width
</th>
<th style="text-align:left;">
.point
</th>
<th style="text-align:left;">
.interval
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
0.24
</td>
<td style="text-align:right;">
-0.01
</td>
<td style="text-align:right;">
0.36
</td>
<td style="text-align:right;">
0.89
</td>
<td style="text-align:left;">
median
</td>
<td style="text-align:left;">
qi
</td>
</tr>
</tbody>
</table>
<p>なお、<span class="math inline">\(\delta\)</span>は以下の通り(表<a href="monsters-and-mixtures.html#tab:delta-12H7">12.23</a>)。</p>
<pre><code>##  Family: cumulative 
##   Links: mu = logit; disc = identity 
## Formula: response ~ 1 + action + contact + intention + A + mo(edu_new) 
##    Data: d4 (Number of observations: 9930) 
##   Draws: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
##          total post-warmup draws = 4000
## 
## Population-Level Effects: 
##              Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## Intercept[1]    -2.70      0.10    -2.97    -2.54 1.00      984      496
## Intercept[2]    -2.02      0.10    -2.28    -1.86 1.00      972      497
## Intercept[3]    -1.43      0.10    -1.69    -1.28 1.00      981      493
## Intercept[4]    -0.41      0.10    -0.68    -0.25 1.00     1005      475
## Intercept[5]     0.26      0.10    -0.00     0.42 1.00      993      460
## Intercept[6]     1.17      0.10     0.89     1.33 1.00     1010      482
## action          -0.71      0.04    -0.79    -0.63 1.00     2828     3058
## contact         -0.96      0.05    -1.06    -0.87 1.00     3010     3059
## intention       -0.72      0.04    -0.79    -0.65 1.00     3125     2823
## A               -0.10      0.02    -0.14    -0.05 1.00     1448     1145
## moedu_new        0.03      0.02    -0.02     0.06 1.00      957      446
## 
## Simplex Parameters: 
##               Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## moedu_new1[1]     0.11      0.08     0.01     0.31 1.00     3368     2378
## moedu_new1[2]     0.12      0.08     0.02     0.31 1.00     3878     2486
## moedu_new1[3]     0.09      0.07     0.01     0.26 1.00     2869     2368
## moedu_new1[4]     0.07      0.06     0.01     0.24 1.00     1632      989
## moedu_new1[5]     0.42      0.15     0.04     0.67 1.00     1052      503
## moedu_new1[6]     0.09      0.06     0.01     0.23 1.00     3956     2896
## moedu_new1[7]     0.10      0.06     0.01     0.25 1.00     4953     3026
## 
## Family Specific Parameters: 
##      Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## disc     1.00      0.00     1.00     1.00   NA       NA       NA
## 
## Draws were sampled using sample(hmc). For each parameter, Bulk_ESS
## and Tail_ESS are effective sample size measures, and Rhat is the potential
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<div class="sourceCode" id="cb1112"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1112-1"><a href="monsters-and-mixtures.html#cb1112-1" aria-hidden="true" tabindex="-1"></a>p<span class="sc">$</span>mo <span class="sc">%&gt;%</span> </span>
<span id="cb1112-2"><a href="monsters-and-mixtures.html#cb1112-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1112-3"><a href="monsters-and-mixtures.html#cb1112-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>(<span class="at">var =</span> <span class="st">&quot;delta&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1112-4"><a href="monsters-and-mixtures.html#cb1112-4" aria-hidden="true" tabindex="-1"></a>   dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>Bulk_ESS,<span class="sc">-</span>Tail_ESS,<span class="sc">-</span>Rhat) <span class="sc">%&gt;%</span> </span>
<span id="cb1112-5"><a href="monsters-and-mixtures.html#cb1112-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="at">digits=</span><span class="dv">2</span>,</span>
<span id="cb1112-6"><a href="monsters-and-mixtures.html#cb1112-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">booktabs =</span> <span class="cn">TRUE</span>,</span>
<span id="cb1112-7"><a href="monsters-and-mixtures.html#cb1112-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">caption =</span> <span class="st">&quot;b12.6によるδの推定値&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb1112-8"><a href="monsters-and-mixtures.html#cb1112-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">latex_options =</span> <span class="fu">c</span>(<span class="st">&quot;striped&quot;</span>, <span class="st">&quot;hold_position&quot;</span>))</span></code></pre></div>
<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:delta-12H7">表12.23: </span>b12.6によるδの推定値
</caption>
<thead>
<tr>
<th style="text-align:left;">
delta
</th>
<th style="text-align:right;">
Estimate
</th>
<th style="text-align:right;">
Est.Error
</th>
<th style="text-align:right;">
l.95..CI
</th>
<th style="text-align:right;">
u.95..CI
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
moedu_new1[1]
</td>
<td style="text-align:right;">
0.11
</td>
<td style="text-align:right;">
0.08
</td>
<td style="text-align:right;">
0.01
</td>
<td style="text-align:right;">
0.31
</td>
</tr>
<tr>
<td style="text-align:left;">
moedu_new1[2]
</td>
<td style="text-align:right;">
0.12
</td>
<td style="text-align:right;">
0.08
</td>
<td style="text-align:right;">
0.02
</td>
<td style="text-align:right;">
0.31
</td>
</tr>
<tr>
<td style="text-align:left;">
moedu_new1[3]
</td>
<td style="text-align:right;">
0.09
</td>
<td style="text-align:right;">
0.07
</td>
<td style="text-align:right;">
0.01
</td>
<td style="text-align:right;">
0.26
</td>
</tr>
<tr>
<td style="text-align:left;">
moedu_new1[4]
</td>
<td style="text-align:right;">
0.07
</td>
<td style="text-align:right;">
0.06
</td>
<td style="text-align:right;">
0.01
</td>
<td style="text-align:right;">
0.24
</td>
</tr>
<tr>
<td style="text-align:left;">
moedu_new1[5]
</td>
<td style="text-align:right;">
0.42
</td>
<td style="text-align:right;">
0.15
</td>
<td style="text-align:right;">
0.04
</td>
<td style="text-align:right;">
0.67
</td>
</tr>
<tr>
<td style="text-align:left;">
moedu_new1[6]
</td>
<td style="text-align:right;">
0.09
</td>
<td style="text-align:right;">
0.06
</td>
<td style="text-align:right;">
0.01
</td>
<td style="text-align:right;">
0.23
</td>
</tr>
<tr>
<td style="text-align:left;">
moedu_new1[7]
</td>
<td style="text-align:right;">
0.10
</td>
<td style="text-align:right;">
0.06
</td>
<td style="text-align:right;">
0.01
</td>
<td style="text-align:right;">
0.25
</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb1113"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1113-1"><a href="monsters-and-mixtures.html#cb1113-1" aria-hidden="true" tabindex="-1"></a>delta_labels <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Elem&quot;</span>, <span class="st">&quot;MidSch&quot;</span>, <span class="st">&quot;SHS&quot;</span>, <span class="st">&quot;HSG&quot;</span>, <span class="st">&quot;SCol&quot;</span>, <span class="st">&quot;Bach&quot;</span>, <span class="st">&quot;Mast&quot;</span>, <span class="st">&quot;Grad&quot;</span>)</span>
<span id="cb1113-2"><a href="monsters-and-mixtures.html#cb1113-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1113-3"><a href="monsters-and-mixtures.html#cb1113-3" aria-hidden="true" tabindex="-1"></a><span class="fu">posterior_samples</span>(b12H7) <span class="sc">%&gt;%</span> </span>
<span id="cb1113-4"><a href="monsters-and-mixtures.html#cb1113-4" aria-hidden="true" tabindex="-1"></a>   dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="fu">contains</span>(<span class="st">&quot;moedu_new1&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1113-5"><a href="monsters-and-mixtures.html#cb1113-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_names</span>(<span class="fu">str_c</span>(delta_labels[<span class="dv">2</span><span class="sc">:</span><span class="dv">8</span>],<span class="st">&quot;~(delta[&quot;</span>,<span class="dv">1</span><span class="sc">:</span><span class="dv">7</span>,<span class="st">&quot;])&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1113-6"><a href="monsters-and-mixtures.html#cb1113-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggpairs</span>(<span class="at">upper =</span> <span class="fu">list</span>(<span class="at">continuous =</span> my_upper),</span>
<span id="cb1113-7"><a href="monsters-and-mixtures.html#cb1113-7" aria-hidden="true" tabindex="-1"></a>          <span class="at">diag =</span> <span class="fu">list</span>(<span class="at">continuous =</span> my_diag),</span>
<span id="cb1113-8"><a href="monsters-and-mixtures.html#cb1113-8" aria-hidden="true" tabindex="-1"></a>          <span class="at">lower =</span> <span class="fu">list</span>(<span class="at">continuous =</span> my_lower),</span>
<span id="cb1113-9"><a href="monsters-and-mixtures.html#cb1113-9" aria-hidden="true" tabindex="-1"></a>          <span class="at">labeller=</span>label_parsed) <span class="sc">+</span></span>
<span id="cb1113-10"><a href="monsters-and-mixtures.html#cb1113-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>))</span></code></pre></div>
<p><img src="Rethinking_Bookdown_files/figure-html/unnamed-chunk-593-1.png" width="672" style="display: block; margin: auto;" /></p>

</div>
</div>
</div>
<h3>References</h3>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-Bakkensen2014" class="csl-entry">
Bakkensen LA, Larson W (2014) Population matters when modeling hurricane fatalities. Proc Natl Acad Sci U S A 111:E5331–2
</div>
<div id="ref-Jung2014" class="csl-entry">
Jung K, Shavitt S, Viswanathan M, Hilbe JM (2014) Female hurricanes are deadlier than male hurricanes. Proc Natl Acad Sci U S A 111:8782–8787
</div>
<div id="ref-Kline2010" class="csl-entry">
Kline MA, Boyd R (2010) Population size predicts technological complexity in oceania. Proc Biol Sci 277:2559–2564
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="god-spiked-the-integers.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="models-with-memory.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
